<!doctype html><html lang="en"><head><title>Zombie Rolled | 7Rocky</title>
<meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="author" content="7Rocky's Blog. Cybersecurity and Maths"><meta name="description" content="Fractions. Diophantine equation solution with elliptic curve. RSA signature. LLL lattice reduction. Groebner basis"><meta name="image" content="https://7rocky.github.io/images/cryptography.png"><meta name="robots" content="index, follow"><meta name="viewport" content="width=device-width,minimum-scale=1"><meta itemprop="description" content="Fractions. Diophantine equation solution with elliptic curve. RSA signature. LLL lattice reduction. Groebner basis"><meta itemprop="keywords" content><meta itemprop="name" content="Zombie Rolled"><meta property="article:published_time" content><meta property="og:author" content="7Rocky's Blog. Cybersecurity and Maths"><meta property="og:description" content="Fractions. Diophantine equation solution with elliptic curve. RSA signature. LLL lattice reduction. Groebner basis"><meta property="og:image" content="https://7rocky.github.io/images/cryptography.png"><meta property="og:locale" content="en_US"><meta property="og:site_name" content="7Rocky's Blog. Cybersecurity and Maths"><meta property="og:title" content="Zombie Rolled"><meta property="og:type" content="website"><meta property="og:url" content="https://7rocky.github.io/en/ctf/htb-challenges/crypto/zombie-rolled/"><meta name="twitter:author" content="7Rocky's Blog. Cybersecurity and Maths"><meta name="twitter:card" content="Fractions. Diophantine equation solution with elliptic curve. RSA signature. LLL lattice reduction. Groebner basis"><meta name="twitter:description" content="Fractions. Diophantine equation solution with elliptic curve. RSA signature. LLL lattice reduction. Groebner basis"><meta name="twitter:image" content="https://7rocky.github.io/images/cryptography.png"><meta name="twitter:title" content="Zombie Rolled"><link href="/favicon.ico" rel="shortcut icon" type="image/x-icon"><link href="/css/style.css" rel="stylesheet"><link href="/css/main.css" rel="stylesheet"><link href="/css/code.css" rel="stylesheet"><link href="https://7rocky.github.io/en/ctf/htb-challenges/crypto/zombie-rolled/" rel="canonical"><script async src="https://www.googletagmanager.com/gtag/js?id=G-Z1HQGH3M4D"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-Z1HQGH3M4D",{anonymize_ip:!1})}</script><script>MathJax={loader:{load:["[tex]/noerrors"]},options:{ignoreHtmlClass:"tex2jax_ignore",processHtmlClass:"tex2jax_process",skipHtmlTags:["noscript","pre","script","style","textarea"]},tex:{autoload:{color:[],colorv2:["color"]},displayMath:[["$$","$$"]],inlineMath:[["$","$"]],packages:{"[+]":["noerrors"]},processEnvironments:!0,processEscapes:!0}}</script><script type="text/javascript" src="//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script><div id="math-consts" style="display:none">$
\newcommand{\e}{e}
\newcommand{\N}[1][]{\mathbb{N}^{#1}}
\newcommand{\Q}[1][]{\mathbb{Q}^{#1}}
\newcommand{\R}[1][]{\mathbb{R}^{#1}}
\newcommand{\Z}[1][]{\mathbb{Z}^{#1}}
\newcommand{\C}[1][]{\mathbb{C}^{#1}}
\newcommand{\dx}{\,\mathrm{d}x}
\newcommand{\dy}{\,\mathrm{d}y}
\newcommand{\dz}{\,\mathrm{d}z}
\newcommand{\dt}{\,\mathrm{d}t}
\newcommand{\divides}{\, | \,}
\newcommand{\st}{\; | \;}
\renewcommand{\geq}{\geqslant}
\renewcommand{\leq}{\leqslant}
\renewcommand{\i}{\mathrm{i}}
\newcommand{\rank}{\mathop{\mathrm{rank}}}
\newcommand{\gcd}{\mathop{\mathrm{gcd}}}
\newcommand{\tr}{\mathop{\mathrm{tr}}}
\newcommand{\charField}{\mathop{\mathrm{char}}}
\newcommand{\Image}{\mathop{\mathrm{Im}}}
$</div><script src="/js/imc.js"></script><script>(async()=>await typeset(()=>[`#math-consts`]))()</script></head><body class="ma0 production"><header style="position:sticky;top:0;z-index:9"><div class="bg-black"><nav class="ph4-ns" id="navigation" role="navigation"><div class="flex-l justify-between items-center center"><a class="f3 fw2 hover-white no-underline white-90 dib" href="/en/" title="7Rocky">7Rocky</a><div class="flex-l items-center"><a href="/en/search" target class="link-transition link dib z-999 pt3 pt0-l mr1 search-link" title="Search" rel="noopener" aria-label="Search"><svg height="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 487.95 487.95" style="enable-background:new 0 0 487.95 487.95"><g><g><path d="M481.8 453l-140-140.1c27.6-33.1 44.2-75.4 44.2-121.6C386 85.9 299.5.2 193.1.2S0 86 0 191.4s86.5 191.1 192.9 191.1c45.2.0 86.8-15.5 119.8-41.4l140.5 140.5c8.2 8.2 20.4 8.2 28.6.0C490 473.4 490 461.2 481.8 453zM41 191.4c0-82.8 68.2-150.1 151.9-150.1s151.9 67.3 151.9 150.1-68.2 150.1-151.9 150.1S41 274.1 41 191.4z" style="fill-rule:evenodd;clip-rule:evenodd;fill:#a9a9b3"/></g></g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/></svg></a><a class="link-transition lang link dib z-999 pt3 pt0-l mr3" href="/ctf/htb-challenges/crypto/zombie-rolled/" title="es"><img alt="es" height="30px" src="/images/es.png" style="border:4px solid#000;border-radius:100%" width="30px">
</a><a class="link-transition lang link dib z-999 pt3 pt0-l" href="#" title="en"><img alt="en" height="30px" src="/images/en.png" width="30px"></a><ul class="pl0 ml3 mr3" style="line-height:30px"><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href="/en/ctf/" title="CTF">CTF</a></li><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href="/en/htb/" title="HTB">HTB</a></li><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href="/en/imc/" title="IMC">IMC</a></li></ul><a href="https://www.linkedin.com/in/roberto-gesteira-minarro/" target="_blank" class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel="noopener" aria-label="follow on LinkedIn——Opens in a new window"><svg height="30" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg><span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a><a href="https://github.com/7Rocky" target="_blank" class="link-transition github link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel="noopener" aria-label="follow on GitHub——Opens in a new window"><svg height="30" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg><span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a></div></div></nav></div></header><main class="pb5" role="main" style="min-height:720px"><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-80-l"><a aria-label="aside" class="instapaper_ignoref b tracked" href="../" style="font-size:1.2rem">&lt;- CRYPTO</a><div id="sharing" class="mt3"><a aria-label="share on Facebook" class="facebook no-underline" href="https://www.facebook.com/sharer.php?u=https://7rocky.github.io/en/ctf/htb-challenges/crypto/zombie-rolled/" title="share on Facebook"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765 50.32h6.744V33.998h4.499l.596-5.624h-5.095l.007-2.816c0-1.466.14-2.253 2.244-2.253h2.812V17.68h-4.5c-5.405.0-7.307 2.729-7.307 7.317v3.377h-3.369v5.625h3.369V50.32zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></a><a aria-label="share on Twitter" class="twitter no-underline" href="https://twitter.com/share?url=https://7rocky.github.io/en/ctf/htb-challenges/crypto/zombie-rolled/&amp;text=Zombie%20Rolled" title="share on Twitter"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a><a aria-label="share on LinkedIn" class="linkedin no-underline" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://7rocky.github.io/en/ctf/htb-challenges/crypto/zombie-rolled/&amp;title=Zombie%20Rolled" title="share on LinkedIn"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a></div><h1 class="f1 mt3 mb1">Zombie Rolled</h1><p class="mb4 f6 dib tracked">13 minutes to read</p></header><aside aria-label="aside" class="w-20-l mt6-l aside-mobile"><div class="bg-card pa3 nested-list-reset nested-copy-line-height nested-links" style="position:sticky;top:5rem;padding-bottom:0"><p class="f5 b pb2" style="border-bottom:5px solid var(--background);margin:0">Contents</p><nav id="TableOfContents"><ul><li><a href="#source-code-analysis">Source code analysis</a><ul><li><a href="#public-key-generation">Public key generation</a></li><li><a href="#encryption-and-decryption">Encryption and decryption</a></li><li><a href="#signature-and-verification-process">Signature and verification process</a></li></ul></li><li><a href="#solution">Solution</a><ul><li><a href="#cubic-diophantine-equation">Cubic diophantine equation</a></li><li><a href="#rsa-decryption">RSA decryption</a></li><li><a href="#lll-lattice-reduction">LLL lattice reduction</a></li><li><a href="#system-of-multivariate-polynomials">System of multivariate polynomials</a></li></ul></li><li><a href="#flag">Flag</a></li></ul></nav><div class="bg-card" style="border-top:5px solid var(--background)"><a class="bmc-btn w-100" target="_blank" href="http://buymeacoffee.com/7Rocky" style="padding:0" title="Buy me a beer">🍺 <span class="bmc-btn-text" style="font-family:Cookie!important;color:#fff">Buy me a beer</span></a></div></div></aside><div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img pr4-l w-80-l"><p>We are given the Python source code to encrypt the flag:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk5">from</span><span class="mtk1"> </span><span class="mtk8 mtku">Crypto</span><span class="mtk1">.</span><span class="mtk8 mtku">Util</span><span class="mtk1">.</span><span class="mtk8 mtku">number</span><span class="mtk1"> </span><span class="mtk5">import</span><span class="mtk1"> </span><span class="mtk8">getPrime</span><span class="mtk1">, </span><span class="mtk8">bytes_to_long</span>
<span class="mtk5">from</span><span class="mtk1"> </span><span class="mtk8 mtku">fractions</span><span class="mtk1"> </span><span class="mtk5">import</span><span class="mtk1"> </span><span class="mtk8 mtku">Fraction</span>
<span class="mtk5">from</span><span class="mtk1"> </span><span class="mtk8 mtku">math</span><span class="mtk1"> </span><span class="mtk5">import</span><span class="mtk1"> </span><span class="mtk8">prod</span>
<span class="mtk5">from</span><span class="mtk1"> </span><span class="mtk8 mtku">hashlib</span><span class="mtk1"> </span><span class="mtk5">import</span><span class="mtk1"> </span><span class="mtk8">sha256</span>
<span class="mtk5">from</span><span class="mtk1"> </span><span class="mtk8 mtku">secrets</span><span class="mtk1"> </span><span class="mtk5">import</span><span class="mtk1"> </span><span class="mtk8">randbelow</span>

<span class="mtk3"># I hope no one cares about Kerckhoff's principle </span><span class="mtk3">:)</span>
<span class="mtk5">from</span><span class="mtk1"> secret </span><span class="mtk5">import</span><span class="mtk1"> derive_public_key, </span><span class="mtk6">FLAG</span>


<span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">fraction_mod</span><span class="mtk1">(</span><span class="mtk9 mtki">f</span><span class="mtk1">, </span><span class="mtk9 mtki">n</span><span class="mtk1">):</span>
<span class="mtk1">    </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk9 mtki">f</span><span class="mtk1">.numerator </span><span class="mtk5">*</span><span class="mtk1"> </span><span class="mtk8">pow</span><span class="mtk1">(</span><span class="mtk9 mtki">f</span><span class="mtk1">.denominator, </span><span class="mtk5">-</span><span class="mtk6">1</span><span class="mtk1">, </span><span class="mtk9 mtki">n</span><span class="mtk1">) </span><span class="mtk5">%</span><span class="mtk1"> </span><span class="mtk9 mtki">n</span>


<span class="mtk7 mtki">class</span><span class="mtk1"> </span><span class="mtk8 mtku">PublicKey</span><span class="mtk1">:</span>

<span class="mtk1">    </span><span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk7">__init__</span><span class="mtk1">(</span><span class="mtk9 mtki">self</span><span class="mtk1">, </span><span class="mtk9 mtki">pub</span><span class="mtk1">, </span><span class="mtk9 mtki">n</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">pub</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk9 mtki">pub</span>
<span class="mtk1">        </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">f</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk8">magic</span><span class="mtk1">(</span><span class="mtk9 mtki">pub</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">n</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk9 mtki">n</span>
<span class="mtk1">        </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">nb</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> (</span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">n</span><span class="mtk1">.bit_length() </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">7</span><span class="mtk1">) </span><span class="mtk5">//</span><span class="mtk1"> </span><span class="mtk6">8</span>

<span class="mtk1">    </span><span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">encrypt</span><span class="mtk1">(</span><span class="mtk9 mtki">self</span><span class="mtk1">, </span><span class="mtk9 mtki">m</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk8">pow</span><span class="mtk1">(</span><span class="mtk9 mtki">m</span><span class="mtk1">, </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">f</span><span class="mtk1">.</span><span class="mtk1">numerator</span><span class="mtk1">, </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">n</span><span class="mtk1">)</span>

<span class="mtk1">    </span><span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">verify</span><span class="mtk1">(</span><span class="mtk9 mtki">self</span><span class="mtk1">, </span><span class="mtk9 mtki">m</span><span class="mtk1">, </span><span class="mtk9 mtki">sig</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk1">s1</span><span class="mtk1">, </span><span class="mtk1">s2</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk9 mtki">sig</span>
<span class="mtk1">        </span><span class="mtk1">h</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">bytes_to_long</span><span class="mtk1">(</span><span class="mtk8">sha256</span><span class="mtk1">(</span><span class="mtk9 mtki">m</span><span class="mtk1">.to_bytes(</span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">nb</span><span class="mtk1">, </span><span class="mtk4">"big"</span><span class="mtk1">)).</span><span class="mtk8">digest</span><span class="mtk1">())</span>
<span class="mtk1">        </span><span class="mtk1">a</span><span class="mtk1">, </span><span class="mtk1">b</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk9 mtki">m</span><span class="mtk1">, </span><span class="mtk1">h</span>
<span class="mtk1">        </span><span class="mtk1">r</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk8">encrypt</span><span class="mtk1">(</span><span class="mtk1">s1</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk1">c</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk8">encrypt</span><span class="mtk1">(</span><span class="mtk1">s2</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk8">fraction_mod</span><span class="mtk1">(</span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk8">magic</span><span class="mtk1">((</span><span class="mtk1">a</span><span class="mtk1">, </span><span class="mtk1">b</span><span class="mtk1">, </span><span class="mtk1">c</span><span class="mtk1">)), </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">n</span><span class="mtk1">) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk1">r</span>

<span class="mtk1">    </span><span class="mtk8">@</span><span class="mtk8 mtku">staticmethod</span>
<span class="mtk1">    </span><span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">magic</span><span class="mtk1">(</span><span class="mtk9 mtki">ar</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk1">a</span><span class="mtk1">, </span><span class="mtk1">b</span><span class="mtk1">, </span><span class="mtk1">c</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk9 mtki">ar</span>
<span class="mtk1">        </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk8 mtku">Fraction</span><span class="mtk1">(</span><span class="mtk1">a</span><span class="mtk5">+</span><span class="mtk1">b</span><span class="mtk1">, </span><span class="mtk1">b</span><span class="mtk5">+</span><span class="mtk1">c</span><span class="mtk1">) </span><span class="mtk7">+</span><span class="mtk1"> </span><span class="mtk8 mtku">Fraction</span><span class="mtk1">(</span><span class="mtk1">b</span><span class="mtk5">+</span><span class="mtk1">c</span><span class="mtk1">, </span><span class="mtk1">a</span><span class="mtk5">+</span><span class="mtk1">c</span><span class="mtk1">) </span><span class="mtk7">+</span><span class="mtk1"> </span><span class="mtk8 mtku">Fraction</span><span class="mtk1">(</span><span class="mtk1">a</span><span class="mtk5">+</span><span class="mtk1">c</span><span class="mtk1">, </span><span class="mtk1">a</span><span class="mtk5">+</span><span class="mtk1">b</span><span class="mtk1">)</span>  


<span class="mtk7 mtki">class</span><span class="mtk1"> </span><span class="mtk8 mtku">PrivateKey</span><span class="mtk1">(</span><span class="mtk8 mtku">PublicKey</span><span class="mtk1">):</span>

<span class="mtk1">    </span><span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk7">__init__</span><span class="mtk1">(</span><span class="mtk9 mtki">self</span><span class="mtk1">, </span><span class="mtk9 mtki">priv</span><span class="mtk1">, </span><span class="mtk9 mtki">pub</span><span class="mtk1">, </span><span class="mtk9 mtki">n</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk8 mtku">super</span><span class="mtk1">().</span><span class="mtk7">__init__</span><span class="mtk1">(</span><span class="mtk9 mtki">pub</span><span class="mtk1">, </span><span class="mtk9 mtki">n</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk8">magic</span><span class="mtk1">(</span><span class="mtk9 mtki">priv</span><span class="mtk1">) </span><span class="mtk5">!=</span><span class="mtk1"> </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">f</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk5">raise</span><span class="mtk1"> </span><span class="mtk8 mtku">ValueError</span><span class="mtk1">(</span><span class="mtk4">"Invalid key pair"</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">priv</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk9 mtki">priv</span>
<span class="mtk1">        </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">d</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">pow</span><span class="mtk1">(</span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">f</span><span class="mtk1">.</span><span class="mtk1">numerator</span><span class="mtk1">, </span><span class="mtk5">-</span><span class="mtk6">1</span><span class="mtk1">, </span><span class="mtk8">prod</span><span class="mtk1">([</span><span class="mtk1">x</span><span class="mtk1"> </span><span class="mtk5">-</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1"> </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">x</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk9 mtki">priv</span><span class="mtk1">]))</span>

<span class="mtk1">    </span><span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">decrypt</span><span class="mtk1">(</span><span class="mtk9 mtki">self</span><span class="mtk1">, </span><span class="mtk9 mtki">c</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk8">pow</span><span class="mtk1">(</span><span class="mtk9 mtki">c</span><span class="mtk1">, </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">d</span><span class="mtk1">, </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">n</span><span class="mtk1">)</span>

<span class="mtk1">    </span><span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">sign</span><span class="mtk1">(</span><span class="mtk9 mtki">self</span><span class="mtk1">, </span><span class="mtk9 mtki">m</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk1">h</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">bytes_to_long</span><span class="mtk1">(</span><span class="mtk8">sha256</span><span class="mtk1">(</span><span class="mtk9 mtki">m</span><span class="mtk1">.to_bytes(</span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">nb</span><span class="mtk1">, </span><span class="mtk4">"big"</span><span class="mtk1">)).</span><span class="mtk8">digest</span><span class="mtk1">())</span>
<span class="mtk1">        </span><span class="mtk1">a</span><span class="mtk1">, </span><span class="mtk1">b</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk9 mtki">m</span><span class="mtk1">, </span><span class="mtk1">h</span>
<span class="mtk1">        </span><span class="mtk1">c</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">randbelow</span><span class="mtk1">(</span><span class="mtk6">1</span><span class="mtk1"> </span><span class="mtk5">&lt;&lt;</span><span class="mtk1"> </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">nb</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk1">r</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">fraction_mod</span><span class="mtk1">(</span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk8">magic</span><span class="mtk1">((</span><span class="mtk1">a</span><span class="mtk1">, </span><span class="mtk1">b</span><span class="mtk1">, </span><span class="mtk1">c</span><span class="mtk1">)), </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">n</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk1">s1</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk8">decrypt</span><span class="mtk1">(</span><span class="mtk1">r</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk1">s2</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk8">decrypt</span><span class="mtk1">(</span><span class="mtk1">c</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk1">s1</span><span class="mtk1">, </span><span class="mtk1">s2</span>

<span class="mtk1">    </span><span class="mtk8">@</span><span class="mtk8 mtku">staticmethod</span>
<span class="mtk1">    </span><span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">generate</span><span class="mtk1">(</span><span class="mtk9 mtki">nbits</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk5">while</span><span class="mtk1"> </span><span class="mtk6">True</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk5">try</span><span class="mtk1">:</span>
<span class="mtk1">                </span><span class="mtk1">priv</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">tuple</span><span class="mtk1">([</span><span class="mtk8">getPrime</span><span class="mtk1">(</span><span class="mtk9 mtki">nbits</span><span class="mtk1">) </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">_</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8 mtku">range</span><span class="mtk1">(</span><span class="mtk6">3</span><span class="mtk1">)])</span>
<span class="mtk1">                </span><span class="mtk1">pub</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> derive_public_key(</span><span class="mtk1">priv</span><span class="mtk1">)</span>
<span class="mtk1">                </span><span class="mtk1">n</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">prod</span><span class="mtk1">(</span><span class="mtk1">priv</span><span class="mtk1">)</span>
<span class="mtk1">                </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk8 mtku">PrivateKey</span><span class="mtk1">(</span><span class="mtk1">priv</span><span class="mtk1">, </span><span class="mtk1">pub</span><span class="mtk1">, </span><span class="mtk1">n</span><span class="mtk1">)</span>
<span class="mtk1">            </span><span class="mtk5">except</span><span class="mtk1"> </span><span class="mtk8 mtku">ValueError</span><span class="mtk1">:</span>
<span class="mtk1">                </span><span class="mtk5">pass</span>


<span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">main</span><span class="mtk1">():</span>
<span class="mtk1">    </span><span class="mtk5">assert</span><span class="mtk1"> </span><span class="mtk8">len</span><span class="mtk1">(</span><span class="mtk6">FLAG</span><span class="mtk1">) </span><span class="mtk5">&lt;=</span><span class="mtk1"> </span><span class="mtk6">64</span>
<span class="mtk1">    </span><span class="mtk1">m</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">bytes_to_long</span><span class="mtk1">(</span><span class="mtk6">FLAG</span><span class="mtk1">)</span>

<span class="mtk1">    </span><span class="mtk1">key</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">PrivateKey</span><span class="mtk1">.</span><span class="mtk8">generate</span><span class="mtk1">(</span><span class="mtk6">1024</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">data</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk7 mtki">f</span><span class="mtk4">"pub = </span><span class="mtk6">{</span><span class="mtk1">key</span><span class="mtk1">.</span><span class="mtk1">pub</span><span class="mtk6">}\n</span><span class="mtk4">"</span>

<span class="mtk1">    </span><span class="mtk3"># make sure it really works</span>
<span class="mtk1">    </span><span class="mtk1">enc</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">key</span><span class="mtk1">.</span><span class="mtk8">encrypt</span><span class="mtk1">(</span><span class="mtk1">m</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk5">assert</span><span class="mtk1"> </span><span class="mtk1">key</span><span class="mtk1">.</span><span class="mtk8">decrypt</span><span class="mtk1">(</span><span class="mtk1">enc</span><span class="mtk1">) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk1">m</span>
<span class="mtk1">    </span><span class="mtk1">sig</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">key</span><span class="mtk1">.</span><span class="mtk8">sign</span><span class="mtk1">(</span><span class="mtk1">m</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk5">assert</span><span class="mtk1"> </span><span class="mtk1">key</span><span class="mtk1">.</span><span class="mtk8">verify</span><span class="mtk1">(</span><span class="mtk1">m</span><span class="mtk1">, </span><span class="mtk1">sig</span><span class="mtk1">)</span>

<span class="mtk1">    </span><span class="mtk3"># mixing them :)</span>
<span class="mtk1">    </span><span class="mtk1">mix</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> [</span><span class="mtk1">sig</span><span class="mtk1">[</span><span class="mtk6">0</span><span class="mtk1">] </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk1">sig</span><span class="mtk1">[</span><span class="mtk6">1</span><span class="mtk1">], </span><span class="mtk1">sig</span><span class="mtk1">[</span><span class="mtk6">0</span><span class="mtk1">] </span><span class="mtk5">-</span><span class="mtk1"> </span><span class="mtk1">sig</span><span class="mtk1">[</span><span class="mtk6">1</span><span class="mtk1">]]</span>
<span class="mtk1">    </span><span class="mtk1">mix</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> [</span><span class="mtk1">key</span><span class="mtk1">.</span><span class="mtk8">encrypt</span><span class="mtk1">(</span><span class="mtk1">x</span><span class="mtk1">) </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">x</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk1">mix</span><span class="mtk1">]</span>
<span class="mtk1">    </span><span class="mtk1">data</span><span class="mtk1"> </span><span class="mtk5">+=</span><span class="mtk1"> </span><span class="mtk7 mtki">f</span><span class="mtk4">"mix = </span><span class="mtk6">{</span><span class="mtk1">mix</span><span class="mtk6">}</span><span class="mtk4">"</span>

<span class="mtk1">    </span><span class="mtk5">with</span><span class="mtk1"> </span><span class="mtk8">open</span><span class="mtk1">(</span><span class="mtk4">"output.txt"</span><span class="mtk1">, </span><span class="mtk4">"w"</span><span class="mtk1">) </span><span class="mtk5">as</span><span class="mtk1"> </span><span class="mtk1">f</span><span class="mtk1">:</span>
<span class="mtk1">        </span><span class="mtk1">f</span><span class="mtk1">.</span><span class="mtk8">write</span><span class="mtk1">(</span><span class="mtk1">data</span><span class="mtk1">)</span>


<span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk1">__name__</span><span class="mtk1"> </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk4">"__main__"</span><span class="mtk1">:</span>
<span class="mtk1">    </span><span class="mtk8">main</span><span class="mtk1">()</span>
</code></pre></div><p>And we have the result in <code>output.txt</code>:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">pub = (-210460004064658545149323270027125585053769531535575407350548992758255183408956300581776562753733749147991850793425366295331667362050138873330003194124140770281180202423447393078536478578946868914766383656089736270769788751224790405249013826635560803115098339073827135185826800939385978982619079483041610504047360527984966942969476938139600034002723364891052748171817924407580597412822624685840388733150562475191261733959754302870066881457439368383797860179354173905065196438650796693994506662218070106433605252371699975224015082241530805008715676767375587161483265765928867425947585319697598716342929731654599546786312158055192372546719883973931468047435521481784391209900070757353943121542277996362196911350140936374803527008606311714911826664001861344148925432456604114027567871907313538504631322730338913938316266631382676518400709132275709208557215429334792606216034973795842808506218623336928645873355528451647090676781751760050107610570392509919226018971445825324823288871147536975132689880688845587543605955579179730900403874103993879894103493722630349071444752690194369435903192722227882789473747568915937633017628653003841969130850224276467088238242967030703252034634998838450149987830988170632158593090342822378422506206718162866788489383954424520400309687446396922689894702349422494539870822982165352296752757838249758847248954901520084148063833208536651742341062164244017879477206939664935238944946527073936644149311943102740610769083279706502997296755709766586056165002192995150546453376411375946735666151030041089735143874012598684485919998838606432520697668756217572519576983009160506152352207045277432241713427473866239668163675448604724328457217539264682046367317013329398485410857195615049823175203925245252476463981844247115175989610533376228024079063115447932497123000468533406318130678663522920114992487564435224227779829370167357854542102259851547210728204680236254781690752101737776286349310317871408511173261016327829488783128124238185622581734373566268247117224296866158777566843574447075623007306270893524221590605260716241323455401522724392760024858027770598653347708025277948266108534992117950744942247538387691821093590335831543492934619905845153938941387523633891920168775933273356246150913687287580005738308853842778146772472161206052698833816938811736333968533167868483246719752201140628448572481749697124587956816178331696810978096173224327142109508407599863959977452073108504801967731216012715964184501653322161959765640703181, 48092167959932577089665706598220165781675771390752790227245377485859485947881571546031811781823531847290145883570391381336778582646376615617889209041048861514625245618391721904143628115253008909601418469608473423398811492009174166243685961257740358835633188280095876080795489899534519571369848752371797579799946381022948625049501467395264530262180573337083241907562614192878574144739061761541532656064621319804504351482986554734034210707836134653811450482725467108642223588121505067372994985292445520001174499519401437153507541826140463290765362583187446831892904451524623790721268161001505010481230620204674812222356870636305377968155481717890541702589197283597439323265314022562812242179576784749209668144438109469457078988559669837452513366063950036113075144671910134836382726061473126596550646614146078443174581105422846476318083629216862717532462628808127510223310132293885710468097698984259717619848649531077210788062624065543549381024587940656696251443503084172682617980324949080794778369101476911695987538917170783888585139170905742797701946636143246389557327737817504828854418238552918710493680241317067229833001240440514379022640617590974019364950318928389827811099478122002451161835713755344612988172028689418803025998639828426011191461104344294996539829176323901970637792252523712675333669643021955732902568937344239074357264968149516161281055403110376979324305028602766172174883302154360855869543967352800198912263276004643959465449518606967096622877028244289928766147905890748205869026637227939534515251009369887727237698461495359469851241721149456159709360150623548149581359231657983430999420794121959127958134018098368856357393108801463187546862737776427868272569433029692425993859830526727241723993224189921729311066393181076960370979893551066586057187601990674487017141841203651494165412078824016216754534826975530662024505444138560368190331434252079819695526471547437779865513089729452268860789068729093350931932611352070995981169035623937574282154283574443761574061931582345766796531904501680567328867512168123101442032309382206953539164445916851695172111176960556792392084525760682929517743118401815662873213111364254472092662871664405216936355120399440412953512383116635297774548790160970019719792538575510949649801729271389813372049233273940011935172643734336578398019766131368283650306004979181140230735068877461269713653548413632936784854356608036728978669525070594086171522597576796441820273981883356320986465325910023468305252933853, 295680237318969834583481350558045576069593397434250114268436392515105169191935289027375497778723372682513840734207932618190330189517739831911523847702330549481897559170495540721652247420337613272507142470605966203844911067854272669874935602731760616153213014890133142801239192079947159594861361601316909850841003469924342012486894936276047149241609037499591917591895130811114625418446330611492030654343430138478099676751910050330177587495855685857580069837873749334025367386942484569200376276585839574077306764891344426845642147405113306157668890178540851789817824614402737945630733737882024042823084893907616969914474832694719037443444818465434680322725745534751292520813842900322357596056857411573205554845465657322776026906939671854071190622648044326841578658423897845211643831096140970428604677609426173111469986019593063904916756246862724809757031532573248196113934118167511345376202958349994847533599803302816875080995188540954333242472866288368356433000012641533588227196752255533968884901760351526179286226813116146805328519695058833653483175617155524796170315815030198082197252295143664620853012864343932707621691692301666805387191857665541247527691509939498006149235577928744988285274380407878815137597089985965284441453525606984850948169652950770654611407196062991198720683081845399004437598542824766225913256140462688017991149014643840857737669793609045002562156298085352771410764034902539507427824936008812792316353855076217474511027376324964324258381503327600240847068580184327069988899673860991472703503982213831152492161359690522185944809136541502229303028310970512499852428336274934693121000245417851454895814281309411653690987796653842598705383750863545849146632339464355340312413889619057550789920777741216497799023886731790428675508850191436528845210345233154209449815183440739968081125328477883943958120844772517543814408943265674355655325470607676318683037563323920211491222704859819893440021032032779436664971290722627579527689013107226911966671185548413889504849802792656272827006947483605480044492484117853415676118939728854488844585782571371102778347974774155341887561550811966344521652867740827641565526459587452560357733493573548740842552438280369419404671314951756797396105930460945603675920681705201005229355597434166687085158453441941920742876590640482018781974161883195654719122551742622613429276209109558416257393084810842677543509590116448722500988340213756485998183685287230874073206039147869000598425185218952661827499422115)  
mix = [2757730114159077389149698432635923981837301729613836384821565970385413527287691303546550071418389460869153265388793288168218992857076782393276221793088140996712795952988234917553350760904749861274926130040479200999429727248629683885916287922239431512820824780777954623772876620507269441914094023673807162641852804725138549956405696699115992461751212100433365705709888998783961544036761746518152663764468503408338480433435667952025380728443297958328995861002595831477329613145876325119604318873183779731991800100149300453012374526367862223973666642160703278246134349210011935898797845233856417363897814513913560313373938031644170526217562189440749278611074828271277104045968930855308000341736235120452258250999462234119531102229181591002350278544442729901864691776115513351943684918165600813284119872912267330400545353503839148657803170834314260914120288293705317513662212847101683300574727947089599033219552668719815029040408, 504994496960270139574946670894069299431207241073364481107436674373406781743273696715057719201622004604281774275828786758698939566785199569446395919976297320011795400301194061227784647070778305874870978021644569959853017603794627523140118519605135041612547135975756808050442548006245570578440457971432120788018096254980159404343207191110068743936220169743056476599906402449120877843887111307810902465612716393076554531289608909139586938005968169706464844575482719379839259559227740024158017349642299710203478526165482299268838854867695568738299929667468342278771679001361343570395883313247212144180543867644990780207723987043462219435393004802347242735452985011336597806947860484258115007949848766287513407339843432999716727634381116327557264348049187312387308303580287236597542911203816391268299325974510924298072270564103660391793686666200192144475147526288929033464511058363590578958753909920404740300100217899387268556668]
</code></pre></div><h2 id="source-code-analysis">Source code analysis</h2><p>The server generates 3 prime numbers $p$, $q$ and $r$, which form the private key.</p><h3 id="public-key-generation">Public key generation</h3><p>There is an unknown function called <code>derive_public_key</code> that is used to get a public key from the private one. The comment about <a href="https://en.wikipedia.org/wiki/Kerckhoffs%27s_principle">Kerckhoff&rsquo;s principle</a> is relevant here because this approach is security through obscurity, which is not always secure. Kerckhoff&rsquo;s principle states that security must rely on the keys, rather than the algorithms.</p><p>The result of <code>derive_public_key</code> is a list of 3 numbers, given to us.</p><p>These public-key numbers are transformed with <code>magic</code>:</p><p class="scroll">$$
\begin{align}
\mathrm{magic}(a, b, c) & = \frac{a + b}{b + c} + \frac{b + c}{c + a} + \frac{c + a}{a + b} = \\ \\
& = \frac{(a + b)^2 (c + a) + (b + c)^2 (a + b) + (c + a)^2 (b + c)}{(a + b) (b + c) (c + a)}
\end{align}
$$</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">    </span><span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">magic</span><span class="mtk1">(</span><span class="mtk9 mtki">ar</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk1">a</span><span class="mtk1">, </span><span class="mtk1">b</span><span class="mtk1">, </span><span class="mtk1">c</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk9 mtki">ar</span>
<span class="mtk1">        </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk8 mtku">Fraction</span><span class="mtk1">(</span><span class="mtk1">a</span><span class="mtk5">+</span><span class="mtk1">b</span><span class="mtk1">, </span><span class="mtk1">b</span><span class="mtk5">+</span><span class="mtk1">c</span><span class="mtk1">) </span><span class="mtk7">+</span><span class="mtk1"> </span><span class="mtk8 mtku">Fraction</span><span class="mtk1">(</span><span class="mtk1">b</span><span class="mtk5">+</span><span class="mtk1">c</span><span class="mtk1">, </span><span class="mtk1">a</span><span class="mtk5">+</span><span class="mtk1">c</span><span class="mtk1">) </span><span class="mtk7">+</span><span class="mtk1"> </span><span class="mtk8 mtku">Fraction</span><span class="mtk1">(</span><span class="mtk1">a</span><span class="mtk5">+</span><span class="mtk1">c</span><span class="mtk1">, </span><span class="mtk1">a</span><span class="mtk5">+</span><span class="mtk1">b</span><span class="mtk1">)</span>  
</code></pre></div><p>We can apply <code>magic</code> to the 3 public-key numbers and get a fraction $f$ with numerator $N$ and denominator $D$. These two values are used in the rest of the script.</p><h3 id="encryption-and-decryption">Encryption and decryption</h3><p>In order to encrypt a message, the server takes the message $m$ in decimal format and computes $\mathrm{ct}$:</p><p class="scroll">$$
\mathrm{ct} = m^N \mod{n}
$$</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">    </span><span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">encrypt</span><span class="mtk1">(</span><span class="mtk9 mtki">self</span><span class="mtk1">, </span><span class="mtk9 mtki">m</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk8">pow</span><span class="mtk1">(</span><span class="mtk9 mtki">m</span><span class="mtk1">, </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">f</span><span class="mtk1">.</span><span class="mtk1">numerator</span><span class="mtk1">, </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">n</span><span class="mtk1">)</span>  
</code></pre></div><p>Where $n = p \cdot q \cdot r$, the product of the private prime numbers.</p><p>In order to decrypt, the server calculates</p><p class="scroll">$$
m = \mathrm{ct}^d \mod{n} \qquad d = N^{-1} \mod{(p - 1) (q - 1) (r - 1)}
$$</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">        </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">d</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">pow</span><span class="mtk1">(</span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">f</span><span class="mtk1">.</span><span class="mtk1">numerator</span><span class="mtk1">, </span><span class="mtk5">-</span><span class="mtk6">1</span><span class="mtk1">, </span><span class="mtk8">prod</span><span class="mtk1">([</span><span class="mtk1">x</span><span class="mtk1"> </span><span class="mtk5">-</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1"> </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">x</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk9 mtki">priv</span><span class="mtk1">]))</span>  

<span class="mtk1">    </span><span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">decrypt</span><span class="mtk1">(</span><span class="mtk9 mtki">self</span><span class="mtk1">, </span><span class="mtk9 mtki">c</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk8">pow</span><span class="mtk1">(</span><span class="mtk9 mtki">c</span><span class="mtk1">, </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">d</span><span class="mtk1">, </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">n</span><span class="mtk1">)</span>
</code></pre></div><p>The code also shows us that both functions work as expected, and they are inverses:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">    </span><span class="mtk3"># make sure it really works</span>
<span class="mtk1">    </span><span class="mtk1">enc</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">key</span><span class="mtk1">.</span><span class="mtk8">encrypt</span><span class="mtk1">(</span><span class="mtk1">m</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk5">assert</span><span class="mtk1"> </span><span class="mtk1">key</span><span class="mtk1">.</span><span class="mtk8">decrypt</span><span class="mtk1">(</span><span class="mtk1">enc</span><span class="mtk1">) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk1">m</span>  
<span class="mtk1">    </span><span class="mtk1">sig</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">key</span><span class="mtk1">.</span><span class="mtk8">sign</span><span class="mtk1">(</span><span class="mtk1">m</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk5">assert</span><span class="mtk1"> </span><span class="mtk1">key</span><span class="mtk1">.</span><span class="mtk8">verify</span><span class="mtk1">(</span><span class="mtk1">m</span><span class="mtk1">, </span><span class="mtk1">sig</span><span class="mtk1">)</span>
</code></pre></div><h3 id="signature-and-verification-process">Signature and verification process</h3><p>As can be seen, there are also signature and verification routines that work as expected.</p><p>In order to sign, the server takes the message $m$, its SHA256 hash $h$ and a random value $c$ to compute $\mathrm{magic}(m, h, c) = \frac{A}{B}$.</p><p>The values $A$ and $B$ are used to compute $R = A \cdot B^{-1} \mod{n}$ with <code>fraction_mod</code>:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">fraction_mod</span><span class="mtk1">(</span><span class="mtk9 mtki">f</span><span class="mtk1">, </span><span class="mtk9 mtki">n</span><span class="mtk1">):</span>
<span class="mtk1">    </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk9 mtki">f</span><span class="mtk1">.numerator </span><span class="mtk5">*</span><span class="mtk1"> </span><span class="mtk8">pow</span><span class="mtk1">(</span><span class="mtk9 mtki">f</span><span class="mtk1">.denominator, </span><span class="mtk5">-</span><span class="mtk6">1</span><span class="mtk1">, </span><span class="mtk9 mtki">n</span><span class="mtk1">) </span><span class="mtk5">%</span><span class="mtk1"> </span><span class="mtk9 mtki">n</span>  
</code></pre></div><p>The signature is just a pair of values:</p><p class="scroll">$$
(s_1, s_2) = (R^d, c^d) \mod{n}
$$</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">    </span><span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">sign</span><span class="mtk1">(</span><span class="mtk9 mtki">self</span><span class="mtk1">, </span><span class="mtk9 mtki">m</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk1">h</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">bytes_to_long</span><span class="mtk1">(</span><span class="mtk8">sha256</span><span class="mtk1">(</span><span class="mtk9 mtki">m</span><span class="mtk1">.to_bytes(</span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">nb</span><span class="mtk1">, </span><span class="mtk4">"big"</span><span class="mtk1">)).</span><span class="mtk8">digest</span><span class="mtk1">())</span>  
<span class="mtk1">        </span><span class="mtk1">a</span><span class="mtk1">, </span><span class="mtk1">b</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk9 mtki">m</span><span class="mtk1">, </span><span class="mtk1">h</span>
<span class="mtk1">        </span><span class="mtk1">c</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">randbelow</span><span class="mtk1">(</span><span class="mtk6">1</span><span class="mtk1"> </span><span class="mtk5">&lt;&lt;</span><span class="mtk1"> </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">nb</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk1">r</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">fraction_mod</span><span class="mtk1">(</span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk8">magic</span><span class="mtk1">((</span><span class="mtk1">a</span><span class="mtk1">, </span><span class="mtk1">b</span><span class="mtk1">, </span><span class="mtk1">c</span><span class="mtk1">)), </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">n</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk1">s1</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk8">decrypt</span><span class="mtk1">(</span><span class="mtk1">r</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk1">s2</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk8">decrypt</span><span class="mtk1">(</span><span class="mtk1">c</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk1">s1</span><span class="mtk1">, </span><span class="mtk1">s2</span>
</code></pre></div><p>The verification function takes the message and the values $(s_1, s_2)$ to perform almost the same operations. First, it finds $R = s_1^N \mod{n}$ and $c = s_2^N \mod{n}$, then it compares it with the expected value of $R$ by using $m$, $h$ and $c$:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">    </span><span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">verify</span><span class="mtk1">(</span><span class="mtk9 mtki">self</span><span class="mtk1">, </span><span class="mtk9 mtki">m</span><span class="mtk1">, </span><span class="mtk9 mtki">sig</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk1">s1</span><span class="mtk1">, </span><span class="mtk1">s2</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk9 mtki">sig</span>
<span class="mtk1">        </span><span class="mtk1">h</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">bytes_to_long</span><span class="mtk1">(</span><span class="mtk8">sha256</span><span class="mtk1">(</span><span class="mtk9 mtki">m</span><span class="mtk1">.to_bytes(</span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">nb</span><span class="mtk1">, </span><span class="mtk4">"big"</span><span class="mtk1">)).</span><span class="mtk8">digest</span><span class="mtk1">())</span>  
<span class="mtk1">        </span><span class="mtk1">a</span><span class="mtk1">, </span><span class="mtk1">b</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk9 mtki">m</span><span class="mtk1">, </span><span class="mtk1">h</span>
<span class="mtk1">        </span><span class="mtk1">r</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk8">encrypt</span><span class="mtk1">(</span><span class="mtk1">s1</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk1">c</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk8">encrypt</span><span class="mtk1">(</span><span class="mtk1">s2</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk8">fraction_mod</span><span class="mtk1">(</span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk8">magic</span><span class="mtk1">((</span><span class="mtk1">a</span><span class="mtk1">, </span><span class="mtk1">b</span><span class="mtk1">, </span><span class="mtk1">c</span><span class="mtk1">)), </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">n</span><span class="mtk1">) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk1">r</span>
</code></pre></div><p>We are given some values that are related to the signature of the flag. Specifically, we have $(s_1 + s_2)^N \mod{n}$ and $(s_1 - s_2)^N \mod{n}$, where $(s_1, s_2)$ is the signature of the flag:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">    </span><span class="mtk3"># mixing them :)</span>
<span class="mtk1">    </span><span class="mtk1">mix</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> [</span><span class="mtk1">sig</span><span class="mtk1">[</span><span class="mtk6">0</span><span class="mtk1">] </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk1">sig</span><span class="mtk1">[</span><span class="mtk6">1</span><span class="mtk1">], </span><span class="mtk1">sig</span><span class="mtk1">[</span><span class="mtk6">0</span><span class="mtk1">] </span><span class="mtk5">-</span><span class="mtk1"> </span><span class="mtk1">sig</span><span class="mtk1">[</span><span class="mtk6">1</span><span class="mtk1">]]</span>  
<span class="mtk1">    </span><span class="mtk1">mix</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> [</span><span class="mtk1">key</span><span class="mtk1">.</span><span class="mtk8">encrypt</span><span class="mtk1">(</span><span class="mtk1">x</span><span class="mtk1">) </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">x</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk1">mix</span><span class="mtk1">]</span>
<span class="mtk1">    </span><span class="mtk1">data</span><span class="mtk1"> </span><span class="mtk5">+=</span><span class="mtk1"> </span><span class="mtk7 mtki">f</span><span class="mtk4">"mix = </span><span class="mtk6">{</span><span class="mtk1">mix</span><span class="mtk6">}</span><span class="mtk4">"</span>
</code></pre></div><h2 id="solution">Solution</h2><p>Since we know that <code>encrypt</code> and <code>decrypt</code> are inverse functions and that work well, comparing with a classic RSA, we have $N$ as the public exponent and $n = p \cdot q \cdot r$ as the public modulus. Hence, in order to decrypt we need to find the private exponent, which needs to be $d = N^{-1} \mod{\phi(n)}$, where $\phi(n) = (p - 1) (q - 1) (r - 1)$.</p><p>On the other hand, the static method <code>generate_key</code> of <code>PrivateKey</code> generates the private key and derives the public one. Then, it returns an instance of <code>PrivateKey</code>:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">    </span><span class="mtk8">@</span><span class="mtk8 mtku">staticmethod</span>
<span class="mtk1">    </span><span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">generate</span><span class="mtk1">(</span><span class="mtk9 mtki">nbits</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk5">while</span><span class="mtk1"> </span><span class="mtk6">True</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk5">try</span><span class="mtk1">:</span>
<span class="mtk1">                </span><span class="mtk1">priv</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">tuple</span><span class="mtk1">([</span><span class="mtk8">getPrime</span><span class="mtk1">(</span><span class="mtk9 mtki">nbits</span><span class="mtk1">) </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">_</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8 mtku">range</span><span class="mtk1">(</span><span class="mtk6">3</span><span class="mtk1">)])</span>  
<span class="mtk1">                </span><span class="mtk1">pub</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> derive_public_key(</span><span class="mtk1">priv</span><span class="mtk1">)</span>
<span class="mtk1">                </span><span class="mtk1">n</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">prod</span><span class="mtk1">(</span><span class="mtk1">priv</span><span class="mtk1">)</span>
<span class="mtk1">                </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk8 mtku">PrivateKey</span><span class="mtk1">(</span><span class="mtk1">priv</span><span class="mtk1">, </span><span class="mtk1">pub</span><span class="mtk1">, </span><span class="mtk1">n</span><span class="mtk1">)</span>
<span class="mtk1">            </span><span class="mtk5">except</span><span class="mtk1"> </span><span class="mtk8 mtku">ValueError</span><span class="mtk1">:</span>
<span class="mtk1">                </span><span class="mtk5">pass</span>
</code></pre></div><p>The constructor does the following:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk7 mtki">class</span><span class="mtk1"> </span><span class="mtk8 mtku">PrivateKey</span><span class="mtk1">(</span><span class="mtk8 mtku">PublicKey</span><span class="mtk1">):</span>

<span class="mtk1">    </span><span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk7">__init__</span><span class="mtk1">(</span><span class="mtk9 mtki">self</span><span class="mtk1">, </span><span class="mtk9 mtki">priv</span><span class="mtk1">, </span><span class="mtk9 mtki">pub</span><span class="mtk1">, </span><span class="mtk9 mtki">n</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk8 mtku">super</span><span class="mtk1">().</span><span class="mtk7">__init__</span><span class="mtk1">(</span><span class="mtk9 mtki">pub</span><span class="mtk1">, </span><span class="mtk9 mtki">n</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk8">magic</span><span class="mtk1">(</span><span class="mtk9 mtki">priv</span><span class="mtk1">) </span><span class="mtk5">!=</span><span class="mtk1"> </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">f</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk5">raise</span><span class="mtk1"> </span><span class="mtk8 mtku">ValueError</span><span class="mtk1">(</span><span class="mtk4">"Invalid key pair"</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">priv</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk9 mtki">priv</span>
<span class="mtk1">        </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">d</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">pow</span><span class="mtk1">(</span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">f</span><span class="mtk1">.</span><span class="mtk1">numerator</span><span class="mtk1">, </span><span class="mtk5">-</span><span class="mtk6">1</span><span class="mtk1">, </span><span class="mtk8">prod</span><span class="mtk1">([</span><span class="mtk1">x</span><span class="mtk1"> </span><span class="mtk5">-</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1"> </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">x</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk9 mtki">priv</span><span class="mtk1">]))</span>  
</code></pre></div><p>Class <code>PrivateKey</code> extends from <code>PublicKey</code>, and its constructor is called with the public key:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk7 mtki">class</span><span class="mtk1"> </span><span class="mtk8 mtku">PublicKey</span><span class="mtk1">:</span>

<span class="mtk1">    </span><span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk7">__init__</span><span class="mtk1">(</span><span class="mtk9 mtki">self</span><span class="mtk1">, </span><span class="mtk9 mtki">pub</span><span class="mtk1">, </span><span class="mtk9 mtki">n</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">pub</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk9 mtki">pub</span>
<span class="mtk1">        </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">f</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk8">magic</span><span class="mtk1">(</span><span class="mtk9 mtki">pub</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">n</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk9 mtki">n</span>
<span class="mtk1">        </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">nb</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> (</span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">n</span><span class="mtk1">.bit_length() </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">7</span><span class="mtk1">) </span><span class="mtk5">//</span><span class="mtk1"> </span><span class="mtk6">8</span>  
</code></pre></div><p>Here, the value of the fraction <code>f</code> is computed, which holds numerator $N$ and denominator $D$.</p><p>But look at this ckeck:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">        </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk8">magic</span><span class="mtk1">(</span><span class="mtk9 mtki">priv</span><span class="mtk1">) </span><span class="mtk5">!=</span><span class="mtk1"> </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">f</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk5">raise</span><span class="mtk1"> </span><span class="mtk8 mtku">ValueError</span><span class="mtk1">(</span><span class="mtk4">"Invalid key pair"</span><span class="mtk1">)</span>  
</code></pre></div><p>This fact tells us that $N$ and $D$, which are the output of <code>magic</code> and the public key (let&rsquo;s say $P$, $Q$, $R$) must satisfy that</p><p class="scroll">$$
\begin{align}
f = \mathrm{magic}(P, Q, R) = \frac{P + Q}{Q + R} + \frac{Q + R}{R + P} + \frac{R + P}{Q + R} = \frac{N}{D}
\end{align}
$$</p><p>So, we know that</p><p class="scroll">$$
\frac{N}{D} = \frac{p + q}{q + r} + \frac{q + r}{r + p} + \frac{r + p}{q + r} = \frac{P + Q}{Q + R} + \frac{Q + R}{R + P} + \frac{R + P}{Q + R}
$$</p><p>Rearranging the equations, we get that:</p><p class="scroll">$$
\begin{cases}
D\big((p + q)^2 (r + p) + (q + r)^2 (p + q) + (r + p)^2 (q + r)\big) = \\
\qquad \qquad = N (p + q) (q + r) (r + p) \\ \\
D\big((P + Q)^2 (R + P) + (Q + R)^2 (P + Q) + (R + P)^2 (Q + R)\big) = \\
\qquad \qquad = N (P + Q) (Q + R) (R + P)
\end{cases}
$$</p><h3 id="cubic-diophantine-equation">Cubic diophantine equation</h3><p>As a result, we have that both $(p, q, r)$ and $(P, Q, R)$ are solutions to this equation:</p><p class="scroll">$$
D \big((x + y)^2 (z + x) + (y + z)^2 (x + y) + (z + x)^2 (y + z)\big) = N (x + y) (y + z) (z + x)
$$</p><p>The above is a diophantine equation, because we are working with integer coefficients and we are interested in integer solutions. Usually, diophantine equations have more than one solution, so we need to find a way to solve the above to find $(p, q, r)$.</p><p>While reading about cubic diophantine equations, I found that if we interpret the above equation as a curve and its <a href="https://en.wikipedia.org/wiki/Genus_%28mathematics%29">genus</a> equals $1$, then it can be expressed as an elliptic curve (more information at <a href="https://math.stackexchange.com/questions/4038543/cubic-diophantine-equations">math.stackexchange.com</a>). Notice that we already have a <a href="https://en.wikipedia.org/wiki/Rational_point">rational point</a> $(P, Q, R)$, which is a point in the cubic curve, so we can have a point in the elliptic curve using the conversion from the cubic equation to the elliptic curve.</p><p>In fact, rational points on curves with genus equal to $1$ form an abelian group (see <a href="https://en.wikipedia.org/wiki/Rational_point#Genus_1">Wikipedia</a>). As a result, if we have a point $G$ on the elliptic curve, then any multiple of $G$ is also a rational point. Therefore, we can use the inverse mapping to get another solution to the cubic diophantine equation.</p><p>In SageMath, we can test it:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-dark-green">sage: </span>P, Q, R = <span class="sage-green">map</span>(ZZ, pub)
<span class="code-dark-green">sage: </span>f = (P + Q) / (Q + R) + (Q + R) / (R + P) + (R + P) / (P + Q)
<span class="code-dark-green">sage: </span>x, y, z = PolynomialRing(QQ, <span class="code-dark-yellow">'x, y, z'</span>).gens()
<span class="code-dark-green">sage: </span>eq = (x + y) / (y + z) + (y + z) / (z + x) + (z + x) / (x + y) - f  
<span class="code-dark-green">sage: </span>eq.subs({x: P, y: Q, z: R})
0
<span class="code-dark-green">sage: </span>Curve(eq.numerator()).genus()
1
</code></pre></div><p>So, we can now find the transformation function from the cubic curve (the numerator of the fraction) to the elliptic curve and its inverse:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-dark-green">sage: </span>F = EllipticCurve_from_cubic(eq.numerator(), [<span class="code-dark-green">1</span>, -<span class="code-dark-green">1</span>, -<span class="code-dark-green">1</span>])  
<span class="code-dark-green">sage: </span>Fi = F.inverse()
<span class="code-dark-green">sage: </span>G = F((P, Q, R))
</code></pre></div><p>Notice that SageMath requires a projection point. We have used $(1, -1, -1)$ because it lies on the curve:</p><p class="scroll">$$
D \big((1 - 1)^2 (-1 + 1) + (-1 - 1)^2 (1 - 1) + (-1 + 1)^2 (-1 - 1)\big) = 0
$$</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-dark-green">sage: </span>eq.numerator().subs({x: <span class="code-dark-green">1</span>, y: -<span class="code-dark-green">1</span>, z: -<span class="code-dark-green">1</span>})  
0
</code></pre></div><p>Now, for any multiple of $G$ on the elliptic curve, we can find a solution to the cubic equation:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-dark-green">sage: </span>a, b, c = Fi(<span class="code-dark-green">2</span> * G)
<span class="code-dark-green">sage: </span>eq.subs({x: a, y: b, z: c})  
0
<span class="code-dark-green">sage: </span>a, b, c = Fi(<span class="code-dark-green">3</span> * G)
<span class="code-dark-green">sage: </span>eq.subs({x: a, y: b, z: c})
0
</code></pre></div><p>However, these solutions are huge:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-dark-green">sage: </span><span class="sage-green">int</span>(a.numerator()).bit_length()
73531
<span class="code-dark-green">sage: </span><span class="sage-green">int</span>(a.denominator()).bit_length()  
73533
</code></pre></div><p>As a result, we can think that $(p, q, r)$ must be mapped to some point $X$ on the elliptic curve such that $X = k \cdot G$ for a small $k$. In SageMath, we can use <code>division_points</code> to find such points if they exist:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-dark-green">sage: </span>G.division_points(<span class="code-dark-green">2</span>)
[(-11216861528612357904709318323797825103611635554286577958475334550348151151315666856299468989376617096553244928065545313371458796206429540872813808955590930758338036843726243575048631869172869505334509221892197553131605119378635734438105878806588165687881032792115400021951252530130324532853758986296001408426368/144240654022460844172429641403725503935202209257643993096916929585756576585331767464119928794157332435912040969304785834742518075172676019046361048029554928484679994496146947766370303707634565325687643349850072021159085718920701209043206321178849924310301589611357140710066912578177437285803650655446529748287 : 13025263855694143849316460018134611063424114376924022869406842256509079187787970112740648354982930197289845019172843431795213791698268869552344636095321153037986829279656291314625645228516379214043756425299457441478454187446943681064922024219626948616945758958875179368572245547947707980817291490264173834656439383434474180289378565030173813558603834784914700901577031846579404068663972959222235284821658808277896926190730311909004974087764790044159213759404500513676018802196526804380853808127831330590164708887757994965342003758741891267444444533821773329653432617730860726098561837718556479371683384877446819819819008/20805366272827249706151170011055856031008300931172142563300452624354646479834064436244883908378307204303812733579985772386796413559281607979640796692496339119875121316310874909773572506782891631848197068090507105923516994542873369241645859808271821761596570861029848560655988120900215283281679689432956499158522032256993570482216817404857073042336432977419672853714663687843003938138924573855794226540958071093301775135873274494980760065542480586771434070965595924766036340903190019888152543154496669362391515363862128566934094733923177055027869577281761277952260620120681427190808286187194236165054172075251579434369 : 1)]  
<span class="code-dark-green">sage: </span>G.division_points(<span class="code-dark-green">3</span>)
[]
<span class="code-dark-green">sage: </span>G.division_points(<span class="code-dark-green">4</span>)
[]
<span class="code-dark-green">sage: </span>G.division_points(<span class="code-dark-green">5</span>)
[]
</code></pre></div><p>So, we must have $X = 2 \cdot G$:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-dark-green">sage: </span>X = G.division_points(<span class="code-dark-green">2</span>)[<span class="code-dark-green">0</span>]
<span class="code-dark-green">sage: </span>a, b, c = Fi(X)
<span class="code-dark-green">sage: </span>eq.subs({x: a, y: b, z: c})
0
<span class="code-dark-green">sage: </span><span class="sage-green">type</span>(a)
&lt;class 'sage.rings.rational.Rational'&gt;  
</code></pre></div><p>Alright, but although we have another solution to the cubic equation, <code>a</code>, <code>b</code> and <code>c</code> are rational numbers. We must find integer solutions. For this, we can simply find a common denominator and multiply each rational number by that:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-dark-green">sage: </span>cd = lcm(lcm(a.denominator(), b.denominator()), c.denominator())  
<span class="code-dark-green">sage: </span>a, b, c = ZZ(a * cd), ZZ(b * cd), ZZ(c * cd)
<span class="code-dark-green">sage: </span>eq.subs({x: a, y: b, z: c})
0
</code></pre></div><p>The values are now integers, and they are solutions to the cubic equation. But the important thing is that we have found $p$, $q$ and $r$:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-dark-green">sage: </span><span class="sage-green">int</span>(a).bit_length()  
1024
<span class="code-dark-green">sage: </span>is_prime(a)
True
<span class="code-dark-green">sage: </span><span class="sage-green">int</span>(b).bit_length()
1024
<span class="code-dark-green">sage: </span>is_prime(b)
True
<span class="code-dark-green">sage: </span><span class="sage-green">int</span>(c).bit_length()
1024
<span class="code-dark-green">sage: </span>is_prime(c)
True
<span class="code-dark-green">sage: </span>p, q, r = a, b, c
</code></pre></div><h3 id="rsa-decryption">RSA decryption</h3><p>Once we have $p$, $q$ and $r$ we can compute $d = N^{-1} \mod{\phi(n)}$ and decrypt the <code>mix</code> we have. Moreover, we can easily find $s_1$ and $s_2$:</p><p class="scroll">$$
\begin{cases}
s_p = s_1 + s_2 \mod{n} \\
s_m = s_1 - s_2 \mod{n}
\end{cases} \iff \begin{cases}
s_1 = 2^{-1} \cdot (s_p + s_m) \mod{n} \\
s_2 = 2^{-1} \cdot (s_p - s_m) \mod{n}
\end{cases}
$$</p><p>Remember the values of $s_1$ and $s_2$:</p><p class="scroll">$$
s_1 = R^d \mod{n} \qquad s_2 = c^d \mod{n}
$$</p><p>At this point, we can have the signatures $R$ and $c$, and we can check that their bit lengths are correct:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-dark-green">sage: </span>n = p * q * r
<span class="code-dark-green">sage: </span>N = f.numerator()
<span class="code-dark-green">sage: </span>
<span class="code-dark-green">sage: </span>nb = (<span class="sage-green">int</span>(n).bit_length() + <span class="code-dark-green">7</span>) // <span class="code-dark-green">8</span>
<span class="code-dark-green">sage: </span>
<span class="code-dark-green">sage: </span>d = <span class="sage-green">pow</span>(N, -<span class="code-dark-green">1</span>, (p - <span class="code-dark-green">1</span>) * (q - <span class="code-dark-green">1</span>) * (r - <span class="code-dark-green">1</span>))  
<span class="code-dark-green">sage: </span>
<span class="code-dark-green">sage: </span>sp = <span class="sage-green">pow</span>(mix[<span class="code-dark-green">0</span>], d, n)
<span class="code-dark-green">sage: </span>sm = <span class="sage-green">pow</span>(mix[<span class="code-dark-green">1</span>], d, n)
<span class="code-dark-green">sage: </span>
<span class="code-dark-green">sage: </span>s1 = (sp + sm) * <span class="sage-green">pow</span>(<span class="code-dark-green">2</span>, -<span class="code-dark-green">1</span>, n) % n
<span class="code-dark-green">sage: </span>s2 = (sp - sm) * <span class="sage-green">pow</span>(<span class="code-dark-green">2</span>, -<span class="code-dark-green">1</span>, n) % n
<span class="code-dark-green">sage:</span>
<span class="code-dark-green">sage: </span>R = <span class="sage-green">pow</span>(s1, N, n)
<span class="code-dark-green">sage: </span>c = <span class="sage-green">pow</span>(s2, N, n)
<span class="code-dark-green">sage: </span><span class="sage-green">assert</span> c.bit_length() &lt;= nb
</code></pre></div><p>Notice that $R = A \cdot B^{-1} \mod{n}$, where</p><p class="scroll">$$
\frac{A}{B} = \mathrm{magic}(m, h, c) = \frac{m + h}{h + c} + \frac{h + c}{c + m} + \frac{c + m}{m + h}
$$</p><h3 id="lll-lattice-reduction">LLL lattice reduction</h3><p>Here, we might need to apply <a href="https://en.wikipedia.org/wiki/Coppersmith_method">Coppersmith method</a> or a lattice-based technique, since the flag has at most 64 bytes (512 bits) and the SHA256 hash is a 256-bit integer, whereas $n$ is around 3072 bits.</p><p>However, instead of finding $m$ and $h$, let&rsquo;s find $A$ and $B$. We know that both $A$ and $B$ are short compared to $n$, and it follows that</p><p class="scroll">$$
R = A \cdot B^{-1} \mod{n} \iff A = R \cdot B \mod{n} \iff A = R \cdot B - k \, n
$$</p><p>As a result, we can use the following lattice basis:</p><p class="scroll">$$
L = \begin{pmatrix}
R & n \\
  1 & 0
\end{pmatrix}
$$</p><p>So that we can use LLL to find a short vector $(A, B)$, which belongs to the lattice because</p><p class="scroll">$$
\begin{pmatrix}
R & n \\
  1 & 0
\end{pmatrix} \cdot \begin{pmatrix}
B \\ -k
\end{pmatrix} = \begin{pmatrix}
A \\ B
\end{pmatrix}
$$</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-dark-green">sage: </span>A, B = Matrix(ZZ, [[R, n], [<span class="code-dark-green">1</span>, <span class="code-dark-green">0</span>]]).transpose().LLL()[<span class="code-dark-green">0</span>]  
<span class="code-dark-green">sage: </span><span class="sage-green">assert</span> R == A * <span class="sage-green">pow</span>(B, -<span class="code-dark-green">1</span>, n) % n
<span class="code-dark-green">sage: </span>A.bit_length()
1148
<span class="code-dark-green">sage: </span>B.bit_length()
1022
</code></pre></div><h3 id="system-of-multivariate-polynomials">System of multivariate polynomials</h3><p>At this point, we know that:</p><p class="scroll">$$
\frac{A}{B} = \frac{m + h}{h + c} + \frac{h + c}{c + m} + \frac{c + m}{m + h}
$$</p><p>Which is equivalent to:</p><p class="scroll">$$
\begin{cases}
g \cdot A = (m + h)^2 (c + m) + (h + c)^2 (m + h) + (c + m)^2 (h + c) \\
g \cdot B = (m + h) (c + m) (h + c)
\end{cases}
$$</p><p>For some positive integer $g$, probably small.</p><p>We might be tempted to try using multivariate <a href="https://en.wikipedia.org/wiki/Coppersmith_method">Coppersmith method</a>, but the above are 3-degree polynomials, so the variable values are not short enough to find small roots.</p><p>However, we can use <a href="https://en.wikipedia.org/wiki/Gr%C3%B6bner_basis">Groebner basis</a> to find a solution to the system of multivariate non-linear polynomials:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-dark-green">sage: </span>m, h = PolynomialRing(QQ, <span class="code-dark-yellow">'m, h'</span>).gens()
<span class="code-dark-green">sage:</span>
<span class="code-dark-green">sage: </span>g = <span class="code-dark-green">1</span>
<span class="code-dark-green">sage:</span>
<span class="code-dark-green">sage: </span>p1 = (m + h) ** <span class="code-dark-green">2</span> * (c + m) + (h + c) ** <span class="code-dark-green">2</span> * (m + h) + (c + m) ** <span class="code-dark-green">2</span> * (h + c) - g * A
<span class="code-dark-green">sage: </span>p2 = (m + h) * (c + m) * (h + c) - g * B
<span class="code-dark-green">sage:</span>
<span class="code-dark-green">sage: </span>Ideal([p1, p2]).variety()
[{h: 112505123084813325142525029007183899144558205055924378385155078283235959674654, m: 1949989741335361589319748039104353895461329509777569313050438882238845}]  
</code></pre></div><p>And so we find both $m$ and $h$.</p><h2 id="flag">Flag</h2><p>Here we have the flag:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-dark-green">sage: </span>m = Ideal([p1, p2]).variety()[<span class="code-dark-green">0</span>].get(m)  
<span class="code-dark-green">sage: </span><span class="sage-green">bytes</span>.fromhex(<span class="sage-green">hex</span>(m)[<span class="code-dark-green">2</span>:])
b'HTB{3CC_1s_m4g1c___15nt_1t?!}'
</code></pre></div><p>The full script can be found in here: <a href="https://github.com/7Rocky/HackTheBox-scripts/tree/main/Challenges/Crypto/Zombie%20Rolled/solve.sage"><code>solve.sage</code></a>.</p><div class="mt6 instapaper_ignoref"></div></div><aside aria-label="aside" class="w-20-l aside-desktop"><div class="bg-card pa3 nested-list-reset nested-copy-line-height nested-links" style="position:sticky;top:5rem;padding-bottom:0"><p class="f5 b pb2" style="border-bottom:5px solid var(--background);margin:0">Contents</p><nav id="TableOfContents"><ul><li><a href="#source-code-analysis">Source code analysis</a><ul><li><a href="#public-key-generation">Public key generation</a></li><li><a href="#encryption-and-decryption">Encryption and decryption</a></li><li><a href="#signature-and-verification-process">Signature and verification process</a></li></ul></li><li><a href="#solution">Solution</a><ul><li><a href="#cubic-diophantine-equation">Cubic diophantine equation</a></li><li><a href="#rsa-decryption">RSA decryption</a></li><li><a href="#lll-lattice-reduction">LLL lattice reduction</a></li><li><a href="#system-of-multivariate-polynomials">System of multivariate polynomials</a></li></ul></li><li><a href="#flag">Flag</a></li></ul></nav><div class="bg-card" style="border-top:5px solid var(--background)"><a class="bmc-btn w-100" target="_blank" href="http://buymeacoffee.com/7Rocky" style="padding:0" title="Buy me a beer">🍺 <span class="bmc-btn-text" style="font-family:Cookie!important;color:#fff">Buy me a beer</span></a></div></div></aside></article></main><footer class="bottom-0 w-100" role="contentinfo"><div class="tc mw8 ph3" style="margin:auto"><form style="background-color:var(--background-card)" class="tc mw8 pv3 mb3" action="https://mailchi.mp/59ffae939360/7rockys-blog-weekly-newsletter" target="popupwindow" onsubmit='return window.open("https://mailchi.mp/59ffae939360/7rockys-blog-weekly-newsletter"),!0'><h3 class="tc">7Rocky's Blog Weekly Newsletter</h3><p class="tc"><input class="f5 pv3 ph3 bn" style="background-color:var(--background);color:inherit;font-weight:700;line-height:normal" type="submit" value="Receive a weekly blog digest"></p><input type="hidden" value="1" name="embed">
<input style="display:none;color:var(--header)" type="submit" value="Subscribe"><p class="tc"><a href="/en/newsletters/" target="_blank" title="View letter archive">View letter archive</a></p><p class="tc">powered by <a href="http://www.mailchimp.com" target="_blank" title="Mailchimp">Mailchimp</a></p></form></div><div class="bg-black w-100 pa3" role="contentinfo"><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://7rocky.github.io/" title="https://7rocky.github.io/">&copy; 7Rocky's Blog. Cybersecurity and Maths 2024</a><div style="margin-top:8px"><div><div><a href="https://www.linkedin.com/in/roberto-gesteira-minarro/" target="_blank" class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel="noopener" aria-label="follow on LinkedIn——Opens in a new window"><svg height="30" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg><span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a><a href="https://github.com/7Rocky" target="_blank" class="link-transition github link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel="noopener" aria-label="follow on GitHub——Opens in a new window"><svg height="30" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg><span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a></div></div></div></div></div></footer></body></html>