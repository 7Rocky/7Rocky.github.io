<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Web on 7Rocky's Blog. Cybersecurity and Maths</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/</link><description>Recent content in Web on 7Rocky's Blog. Cybersecurity and Maths</description><generator>Hugo</generator><language>en</language><atom:link href="https://7rocky.github.io/en/ctf/htb-challenges/web/index.xml" rel="self" type="application/rss+xml"/><item><title>0xBOverchunked</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/0xboverchunked/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/0xboverchunked/</guid><description>&lt;p>We are given this webpage:&lt;/p>
&lt;p>&lt;img alt="0xBOverchunked 1" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-0xBOverchunked-1.webp">&lt;/p>
&lt;p>This webpage allows us to search some games by ID:&lt;/p>
&lt;p>&lt;img alt="0xBOverchunked 2" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-0xBOverchunked-2.webp">&lt;/p>
&lt;h2 id="source-code-analysis">Source code analysis&lt;/h2>
&lt;p>We are also given the PHP source code of the server. According to &lt;code>db/init.sql&lt;/code>, we must read the contents of ID 6 to get the flag, but we can&amp;rsquo;t do that directly:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="mtk5">CREATE&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">TABLE&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">posts&lt;/span>&lt;span class="mtk1"> (&lt;/span>
&lt;span class="mtk1"> id &lt;/span>&lt;span class="mtk7 mtki">INTEGER&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">PRIMARY KEY&lt;/span>&lt;span class="mtk1">,&lt;/span>
&lt;span class="mtk1"> gamename &lt;/span>&lt;span class="mtk7 mtki">TEXT&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">NOT NULL&lt;/span>&lt;span class="mtk1">,&lt;/span>
&lt;span class="mtk1"> gamedesc &lt;/span>&lt;span class="mtk7 mtki">TEXT&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">NOT NULL&lt;/span>&lt;span class="mtk1">,&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">image&lt;/span>&lt;span class="mtk1"> BLOB &lt;/span>&lt;span class="mtk5">NOT NULL&lt;/span>
&lt;span class="mtk1">);&lt;/span>

&lt;span class="mtk5">INSERT INTO&lt;/span>&lt;span class="mtk1"> posts (gamename, gamedesc, &lt;/span>&lt;span class="mtk5">image&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk5">VALUES&lt;/span>
&lt;span class="mtk1"> (&lt;/span>&lt;span class="mtk4">'Pikachu'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">'A small, yellow, mouse-like creature with a light&lt;/span>&lt;span class="mtk4">ning bolt-shaped tail. Pikachu is one of the most &lt;/span>&lt;span class="mtk4">popular and recognizable characters from the Pokem&lt;/span>&lt;span class="mtk4">on franchise.'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">'1.png'&lt;/span>&lt;span class="mtk1">),&lt;/span> 
&lt;span class="mtk1"> (&lt;/span>&lt;span class="mtk4">'Pac-Man'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">'Pac-Man is a classic arcade game where you contro&lt;/span>&lt;span class="mtk4">l a yellow character and navigate through a maze, &lt;/span>&lt;span class="mtk4">eating dots and avoiding ghosts.'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">'2.png'&lt;/span>&lt;span class="mtk1">),&lt;/span>
&lt;span class="mtk1"> (&lt;/span>&lt;span class="mtk4">'Sonic'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">'He is a blue anthropomorphic hedgehog who is know&lt;/span>&lt;span class="mtk4">n for his incredible speed and his ability to run &lt;/span>&lt;span class="mtk4">faster than the speed of sound.'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">'3.png'&lt;/span>&lt;span class="mtk1">),&lt;/span>
&lt;span class="mtk1"> (&lt;/span>&lt;span class="mtk4">'Super Mario'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">'Its me, Mario, an Italian plumber who must save P&lt;/span>&lt;span class="mtk4">rincess Toadstool from the evil Bowser.'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">'4.png'&lt;/span>&lt;span class="mtk1">),&lt;/span>
&lt;span class="mtk1"> (&lt;/span>&lt;span class="mtk4">'Donkey Kong'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">'Donkey Kong is known for his incredible strength,&lt;/span>&lt;span class="mtk4"> agility, and his ability to swing from vines and &lt;/span>&lt;span class="mtk4">barrels.'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">'5.png'&lt;/span>&lt;span class="mtk1">),&lt;/span>
&lt;span class="mtk1"> (&lt;/span>&lt;span class="mtk4">'Flag'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">'HTB{f4k3_fl4_f0r_t35t1ng}'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">'6.png'&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>&lt;img alt="0xBOverchunked 3" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-0xBOverchunked-3.webp">&lt;/p></description></item><item><title>AbuseHumanDB</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/abusehumandb/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/abusehumandb/</guid><description>&lt;p>We have a website that allows us to enter URL. Then a bot will access it:&lt;/p>
&lt;p>&lt;img alt="AbuseHumanDB index" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-AbuseHumanDB-1.webp">&lt;/p>
&lt;h2 id="source-code-analysis">Source code analysis&lt;/h2>
&lt;p>On the source code we have an Express JS application. This is the &lt;code>routes/index.js&lt;/code> file:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="mtk7 mtki">const&lt;/span> &lt;span class="mtk1">bot&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk8">require&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'../bot'&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk7 mtki">const&lt;/span> &lt;span class="mtk1">path&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk8">require&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'path'&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk7 mtki">const&lt;/span> &lt;span class="mtk8">express&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk8">require&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'express'&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk7 mtki">const&lt;/span> &lt;span class="mtk1">router&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk8">express&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">Router&lt;/span>&lt;span class="mtk1">()&lt;/span>

&lt;span class="mtk7 mtki">const&lt;/span> &lt;span class="mtk8">response&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk9 mtki">data&lt;/span> &lt;span class="mtk7 mtki">=&amp;gt;&lt;/span> &lt;span class="mtk1">({&lt;/span> &lt;span class="mtk1">message&lt;/span>&lt;span class="mtk1">:&lt;/span> &lt;span class="mtk9 mtki">data&lt;/span> &lt;span class="mtk1">})&lt;/span>
&lt;span class="mtk7 mtki">const&lt;/span> &lt;span class="mtk8">isLocalhost&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk9 mtki">req&lt;/span> &lt;span class="mtk7 mtki">=&amp;gt;&lt;/span> &lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">req&lt;/span>&lt;span class="mtk1">.ip&lt;/span> &lt;span class="mtk5">==&lt;/span> &lt;span class="mtk4">'127.0.0.1'&lt;/span> &lt;span class="mtk5">&amp;amp;&amp;amp;&lt;/span> &lt;span class="mtk9 mtki">req&lt;/span>&lt;span class="mtk1">.headers.host&lt;/span> &lt;span class="mtk5">==&lt;/span> &lt;span class="mtk4">'127.0.0.1:1337'&lt;/span> &lt;span class="mtk5">?&lt;/span> &lt;span class="mtk6">0&lt;/span> &lt;span class="mtk5">:&lt;/span> &lt;span class="mtk6">1&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk7 mtki">let&lt;/span> &lt;span class="mtk1">db&lt;/span>

&lt;span class="mtk3">/* snip */&lt;/span>

&lt;span class="mtk1">router&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">post&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'/api/entries'&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">req&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">)&lt;/span> &lt;span class="mtk7 mtki">=&amp;gt;&lt;/span> &lt;span class="mtk1">{&lt;/span>
 &lt;span class="mtk7 mtki">const&lt;/span> &lt;span class="mtk1">{&lt;/span> &lt;span class="mtk1">url&lt;/span> &lt;span class="mtk1">}&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk9 mtki">req&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">body&lt;/span>
 &lt;span class="mtk5">if&lt;/span> &lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">url&lt;/span>&lt;span class="mtk1">)&lt;/span> &lt;span class="mtk1">{&lt;/span>
 &lt;span class="mtk1">uregex&lt;/span> &lt;span class="mtk5">=&lt;/span>
 &lt;span class="mtk4">/https&lt;/span>&lt;span class="mtk5">?&lt;/span>&lt;span class="mtk4">:&lt;/span>&lt;span class="mtk6">\/\/&lt;/span>&lt;span class="mtk4">(www&lt;/span>&lt;span class="mtk6">\.&lt;/span>&lt;span class="mtk4">)&lt;/span>&lt;span class="mtk5">?&lt;/span>&lt;span class="mtk6">[-a-zA-Z0-9@:%._\+~#=]&lt;/span>&lt;span class="mtk5">{1,256}&lt;/span>&lt;span class="mtk6">\.[a-zA-Z0-9()]&lt;/span>&lt;span class="mtk5">{1,6}\b&lt;/span>&lt;span class="mtk4">(&lt;/span>&lt;span class="mtk6">[-a-zA-Z0-9()@:%_\+.~#?&amp;amp;\/\/=]&lt;/span>&lt;span class="mtk5">*&lt;/span>&lt;span class="mtk4">)/&lt;/span> 
 &lt;span class="mtk5">if&lt;/span> &lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">url&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">match&lt;/span>&lt;span class="mtk1">(uregex))&lt;/span> &lt;span class="mtk1">{&lt;/span>
 &lt;span class="mtk5">return&lt;/span> &lt;span class="mtk1">bot&lt;/span>
 &lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">visitPage&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">url&lt;/span>&lt;span class="mtk1">)&lt;/span>
 &lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">then&lt;/span>&lt;span class="mtk1">(()&lt;/span> &lt;span class="mtk7 mtki">=&amp;gt;&lt;/span> &lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">send&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk8">response&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'Your&lt;/span> &lt;span class="mtk4">submission&lt;/span> &lt;span class="mtk4">is&lt;/span> &lt;span class="mtk4">now&lt;/span> &lt;span class="mtk4">pending&lt;/span> &lt;span class="mtk4">review!'&lt;/span>&lt;span class="mtk1">)))&lt;/span>
 &lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">catch&lt;/span>&lt;span class="mtk1">(()&lt;/span> &lt;span class="mtk7 mtki">=&amp;gt;&lt;/span> &lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">send&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk8">response&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'Something&lt;/span> &lt;span class="mtk4">went&lt;/span> &lt;span class="mtk4">wrong!&lt;/span> &lt;span class="mtk4">Please&lt;/span> &lt;span class="mtk4">try&lt;/span> &lt;span class="mtk4">again!'&lt;/span>&lt;span class="mtk1">)))&lt;/span>
 &lt;span class="mtk1">}&lt;/span>
 &lt;span class="mtk5">return&lt;/span> &lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">status&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk6">403&lt;/span>&lt;span class="mtk1">).&lt;/span>&lt;span class="mtk8">json&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk8">response&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'Please&lt;/span> &lt;span class="mtk4">submit&lt;/span> &lt;span class="mtk4">a&lt;/span> &lt;span class="mtk4">valid&lt;/span> &lt;span class="mtk4">URL!'&lt;/span>&lt;span class="mtk1">))&lt;/span>
 &lt;span class="mtk1">}&lt;/span>
 &lt;span class="mtk5">return&lt;/span> &lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">status&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk6">403&lt;/span>&lt;span class="mtk1">).&lt;/span>&lt;span class="mtk8">json&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk8">response&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'Missing&lt;/span> &lt;span class="mtk4">required&lt;/span> &lt;span class="mtk4">parameters!'&lt;/span>&lt;span class="mtk1">))&lt;/span>
&lt;span class="mtk1">})&lt;/span>

&lt;span class="mtk1">router&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">get&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'/api/entries/search'&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">req&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">)&lt;/span> &lt;span class="mtk7 mtki">=&amp;gt;&lt;/span> &lt;span class="mtk1">{&lt;/span>
 &lt;span class="mtk5">if&lt;/span> &lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">req&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">query&lt;/span>&lt;span class="mtk1">.q)&lt;/span> &lt;span class="mtk1">{&lt;/span>
 &lt;span class="mtk7 mtki">const&lt;/span> &lt;span class="mtk1">query&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk4">`&lt;/span>&lt;span class="mtk5">${&lt;/span>&lt;span class="mtk9 mtki">req&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">query&lt;/span>&lt;span class="mtk1">.q&lt;/span>&lt;span class="mtk5">}&lt;/span>&lt;span class="mtk4">%`&lt;/span>
 &lt;span class="mtk5">return&lt;/span> &lt;span class="mtk1">db&lt;/span>
 &lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">getEntry&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">query&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk8">isLocalhost&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">req&lt;/span>&lt;span class="mtk1">))&lt;/span>
 &lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">then&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">entries&lt;/span> &lt;span class="mtk7 mtki">=&amp;gt;&lt;/span> &lt;span class="mtk1">{&lt;/span>
 &lt;span class="mtk5">if&lt;/span> &lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">entries&lt;/span>&lt;span class="mtk1">.length&lt;/span> &lt;span class="mtk5">==&lt;/span> &lt;span class="mtk6">0&lt;/span>&lt;span class="mtk1">)&lt;/span>
 &lt;span class="mtk5">return&lt;/span> &lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">status&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk6">404&lt;/span>&lt;span class="mtk1">).&lt;/span>&lt;span class="mtk8">send&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk8">response&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'Your&lt;/span> &lt;span class="mtk4">search&lt;/span> &lt;span class="mtk4">did&lt;/span> &lt;span class="mtk4">not&lt;/span> &lt;span class="mtk4">yield&lt;/span> &lt;span class="mtk4">any&lt;/span> &lt;span class="mtk4">results!'&lt;/span>&lt;span class="mtk1">))&lt;/span>
 &lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">json&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">entries&lt;/span>&lt;span class="mtk1">)&lt;/span>
 &lt;span class="mtk1">})&lt;/span>
 &lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">catch&lt;/span>&lt;span class="mtk1">(()&lt;/span> &lt;span class="mtk7 mtki">=&amp;gt;&lt;/span> &lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">send&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk8">response&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'Something&lt;/span> &lt;span class="mtk4">went&lt;/span> &lt;span class="mtk4">wrong!&lt;/span> &lt;span class="mtk4">Please&lt;/span> &lt;span class="mtk4">try&lt;/span> &lt;span class="mtk4">again!'&lt;/span>&lt;span class="mtk1">)))&lt;/span>
 &lt;span class="mtk1">}&lt;/span>
 &lt;span class="mtk5">return&lt;/span> &lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">status&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk6">403&lt;/span>&lt;span class="mtk1">).&lt;/span>&lt;span class="mtk8">json&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk8">response&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'Missing&lt;/span> &lt;span class="mtk4">required&lt;/span> &lt;span class="mtk4">parameters!'&lt;/span>&lt;span class="mtk1">))&lt;/span>
&lt;span class="mtk1">})&lt;/span>

&lt;span class="mtk7 mtki">module&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk7 mtki">exports&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk9 mtki">database&lt;/span> &lt;span class="mtk7 mtki">=&amp;gt;&lt;/span> &lt;span class="mtk1">{&lt;/span>
 &lt;span class="mtk1">db&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk9 mtki">database&lt;/span>
 &lt;span class="mtk5">return&lt;/span> &lt;span class="mtk1">router&lt;/span>
&lt;span class="mtk1">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>Looking at those endpoints, it seems that we must force the bot to access our malicious site and use some Cross-Site Request Forgery (CSRF) techniques in order to get the flag. We need so because the flag can only be obtained when the request is done from &lt;code>127.0.0.1&lt;/code> (there is a check).&lt;/p></description></item><item><title>Amidst Us</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/amidst-us/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/amidst-us/</guid><description>&lt;p>We have the following website, that mimics the game Among Us:&lt;/p>
&lt;p>&lt;img alt="Amidst Us 1" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-Amidst-Us-1.webp">&lt;/p>
&lt;p>&lt;img alt="Amidst Us 2" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-Amidst-Us-2.webp">&lt;/p>
&lt;p>There is a button to select a color with a color picker:&lt;/p>
&lt;p>&lt;img alt="Amidst Us 3" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-Amidst-Us-3.webp">&lt;/p>
&lt;p>&lt;img alt="Amidst Us 4" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-Amidst-Us-4.webp">&lt;/p>
&lt;p>If we analyze the given source code, we have a Flask application (in Python). This is &lt;code>application/blueprints/routes.py&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="mtk5">from&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">flask&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">Blueprint&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk1">request&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk8">render_template&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk8">abort&lt;/span> 
&lt;span class="mtk5">from&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">application&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8 mtku">util&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">make_alpha&lt;/span>

&lt;span class="mtk1">web&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">Blueprint&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'web'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk1">__name__&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1">api&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">Blueprint&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'api'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk1">__name__&lt;/span>&lt;span class="mtk1">)&lt;/span>

&lt;span class="mtk8">@&lt;/span>&lt;span class="mtk1">web&lt;/span>&lt;span class="mtk8">.&lt;/span>&lt;span class="mtk8">route&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'/'&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk7 mtki">def&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">index&lt;/span>&lt;span class="mtk1">():&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">render_template&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'index.html'&lt;/span>&lt;span class="mtk1">)&lt;/span>

&lt;span class="mtk8">@&lt;/span>&lt;span class="mtk1">api&lt;/span>&lt;span class="mtk8">.&lt;/span>&lt;span class="mtk8">route&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'/alphafy'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">methods&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1">[&lt;/span>&lt;span class="mtk4">'POST'&lt;/span>&lt;span class="mtk1">])&lt;/span>
&lt;span class="mtk7 mtki">def&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">alphafy&lt;/span>&lt;span class="mtk1">():&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">not&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">request&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">is_json&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">or&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">'image'&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">not&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">in&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">request&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">json&lt;/span>&lt;span class="mtk1">:&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">abort&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk6">400&lt;/span>&lt;span class="mtk1">)&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">make_alpha&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">request&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">json&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>The function &lt;code>make_alpha&lt;/code> is defined in &lt;code>application/util.py&lt;/code>:&lt;/p></description></item><item><title>baby auth</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/baby-auth/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/baby-auth/</guid><description>&lt;p>We are provided with this webpage:&lt;/p>
&lt;p>&lt;img alt="baby auth 1" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-baby-auth-1.webp">&lt;/p>
&lt;p>First, we can register a new account (&lt;code>asdf&lt;/code> as username):&lt;/p>
&lt;p>&lt;img alt="baby auth 2" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-baby-auth-2.webp">&lt;/p>
&lt;p>And we are told that we are not &lt;code>admin&lt;/code>. In fact, the authentication is handled with session cookies:&lt;/p>
&lt;p>&lt;img alt="baby auth 3" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-baby-auth-3.webp">&lt;/p>
&lt;p>The session cookie looks encoded in Base64, so let&amp;rsquo;s try to decode it (beware of URL encoding):&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="code-cyan">$&lt;/span> &lt;span class="code-dark-green">echo&lt;/span> eyJ1c2VybmFtZSI6ImFzZGYifQ== | &lt;span class="code-dark-green">base64&lt;/span> -d 
{"username":"asdf"}
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>It shows our username, so maybe we can modify the cookie and get access as &lt;code>admin&lt;/code>:&lt;/p></description></item><item><title>baby BoneChewerCon</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/baby-bonechewercon/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/baby-bonechewercon/</guid><description>&lt;p>We are provided with this webpage:&lt;/p>
&lt;p>&lt;img alt="baby BoneChewerCon 1" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-baby-BoneChewerCon-1.webp">&lt;/p>
&lt;p>At the bottom of the page we have a text input. Let&amp;rsquo;s enter something and submit.&lt;/p>
&lt;p>It shows an error in the Laravel debugger (a PHP framework):&lt;/p>
&lt;p>&lt;img alt="baby BoneChewerCon 2" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-baby-BoneChewerCon-2.webp">&lt;/p>
&lt;p>This is a bad practice and a security issue, since debuggers might contain sensitive information and most of them provide ways to execute code.&lt;/p>
&lt;h2 id="flag">Flag&lt;/h2>
&lt;p>Indeed, we can find the flag in an environment variable named &lt;code>APP_KEY&lt;/code>:&lt;/p></description></item><item><title>baby breaking grad</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/baby-breaking-grad/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/baby-breaking-grad/</guid><description>&lt;p>We are provided with this webpage:&lt;/p>
&lt;p>&lt;img alt="baby breaking grad 1" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-baby-breaking-grad-1.webp">&lt;/p>
&lt;p>Let&amp;rsquo;s click in the button:&lt;/p>
&lt;p>&lt;img alt="baby breaking grad 2" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-baby-breaking-grad-2.webp">&lt;/p>
&lt;h2 id="source-code-analysis">Source code analysis&lt;/h2>
&lt;p>Alright, since we are provided with source code, let&amp;rsquo;s take a look. It is a Node.js project using Express JS. This is &lt;code>index.js&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="mtk7 mtki">const&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">express&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">require&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'express'&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk7 mtki">const&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">express&lt;/span>&lt;span class="mtk1">();&lt;/span>
&lt;span class="mtk7 mtki">const&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">bodyParser&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">require&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'body-parser'&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk7 mtki">const&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">routes&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">require&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'./routes'&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk7 mtki">const&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">path&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">require&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'path'&lt;/span>&lt;span class="mtk1">);&lt;/span>

&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">use&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">bodyParser&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">json&lt;/span>&lt;span class="mtk1">());&lt;/span>
&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">set&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'views'&lt;/span>&lt;span class="mtk1">,&lt;/span>&lt;span class="mtk4">'./views'&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">use&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'/static'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk8">express&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">static&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">path&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">resolve&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'static'&lt;/span>&lt;span class="mtk1">)));&lt;/span>

&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">use&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">routes&lt;/span>&lt;span class="mtk1">);&lt;/span>

&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">all&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'*'&lt;/span>&lt;span class="mtk1">, (&lt;/span>&lt;span class="mtk9 mtki">req&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">) &lt;/span>&lt;span class="mtk7 mtki">=&amp;gt;&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">status&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk6">404&lt;/span>&lt;span class="mtk1">).&lt;/span>&lt;span class="mtk8">send&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'404 page not found'&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk1">});&lt;/span>

&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">listen&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk6">1337&lt;/span>&lt;span class="mtk1">, () &lt;/span>&lt;span class="mtk7 mtki">=&amp;gt;&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">console&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">log&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'Listening on port 1337'&lt;/span>&lt;span class="mtk1">));&lt;/span> 
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>This file is quite standard. Let&amp;rsquo;s take a look at the routes (&lt;code>routes/index.js&lt;/code>):&lt;/p></description></item><item><title>baby CachedView</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/baby-cachedview/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/baby-cachedview/</guid><description>&lt;p>We have a Flask web application that allows us to render other websites inside it as an image:&lt;/p>
&lt;p>&lt;img alt="baby CachedView" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-baby-CachedView-1.webp">&lt;/p>
&lt;p>Behind the hoods, the server is launching a Headless Chrome with &lt;code>selenium&lt;/code>, accessing the site we provided and taking a screenshot to show it. Here is an example:&lt;/p>
&lt;p>&lt;img alt="baby CachedView example" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-baby-CachedView-2.webp">&lt;/p>
&lt;p>The objective is to reach the endpoint &lt;code>/flag&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="mtk8">@&lt;/span>&lt;span class="mtk1">web&lt;/span>&lt;span class="mtk8">.&lt;/span>&lt;span class="mtk8">route&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'/flag'&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk8">@&lt;/span>&lt;span class="mtk8">is_from_localhost&lt;/span>
&lt;span class="mtk7 mtki">def&lt;/span> &lt;span class="mtk8">flag&lt;/span>&lt;span class="mtk1">():&lt;/span>
 &lt;span class="mtk5">return&lt;/span> &lt;span class="mtk8">send_file&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'flag.png'&lt;/span>&lt;span class="mtk1">)&lt;/span> 
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>However, it is protected by checking that the request is done from &lt;code>127.0.0.1&lt;/code> and has no &lt;code>Referer&lt;/code> header:&lt;/p></description></item><item><title>baby interdimensional internet</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/baby-interdimensional-internet/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/baby-interdimensional-internet/</guid><description>&lt;p>We are provided with this webpage:&lt;/p>
&lt;p>&lt;img alt="baby interdimensional internet 1" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-baby-interdimensional-internet-1.webp">&lt;/p>
&lt;p>If we look into the HTML source code, we see &lt;code>/debug&lt;/code>:&lt;/p>
&lt;p>&lt;img alt="baby interdimensional internet 2" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-baby-interdimensional-internet-2.webp">&lt;/p>
&lt;p>And there we can find the source code of the web application:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="mtk5">from&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">flask&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">Flask&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk8 mtku">Response&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk1">request&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk8">render_template&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk1">request&lt;/span>
&lt;span class="mtk5">from&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">random&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">choice&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk1">randint&lt;/span>
&lt;span class="mtk5">from&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">string&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> lowercase&lt;/span>
&lt;span class="mtk5">from&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">functools&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">wraps&lt;/span>

&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">Flask&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">__name__&lt;/span>&lt;span class="mtk1">)&lt;/span>

&lt;span class="mtk7 mtki">def&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">calc&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">recipe&lt;/span>&lt;span class="mtk1">):&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">global&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">garage&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">garage&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> {}&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">try&lt;/span>&lt;span class="mtk1">: &lt;/span>&lt;span class="mtk8">exec&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">recipe&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk1">garage&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">except&lt;/span>&lt;span class="mtk1">: &lt;/span>&lt;span class="mtk5">pass&lt;/span>

&lt;span class="mtk7 mtki">def&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">GCR&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">func&lt;/span>&lt;span class="mtk1">): &lt;/span>&lt;span class="mtk3"># Great Calculator of the observable universe and &lt;/span>&lt;span class="mtk3">it's infinite timelines&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">@&lt;/span>&lt;span class="mtk8">wraps&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">func&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">def&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">federation&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk5">*&lt;/span>&lt;span class="mtk9 mtki">args&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk5">**&lt;/span>&lt;span class="mtk9 mtki">kwargs&lt;/span>&lt;span class="mtk1">):&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">ingredient&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">''&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">join&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">choice&lt;/span>&lt;span class="mtk1">(lowercase) &lt;/span>&lt;span class="mtk5">for&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">_&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">in&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">range&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk6">10&lt;/span>&lt;span class="mtk1">))&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">recipe&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">'&lt;/span>&lt;span class="mtk6">%s&lt;/span>&lt;span class="mtk4"> = &lt;/span>&lt;span class="mtk6">%s&lt;/span>&lt;span class="mtk4">'&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">%&lt;/span>&lt;span class="mtk1"> (&lt;/span>&lt;span class="mtk1">ingredient&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">''&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">join&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk8 mtku">map&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk8 mtku">str&lt;/span>&lt;span class="mtk1">, [&lt;/span>&lt;span class="mtk1">randint&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk6">1&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk6">69&lt;/span>&lt;span class="mtk1">), &lt;/span>&lt;span class="mtk1">choice&lt;/span>&lt;span class="mtk1">([&lt;/span>&lt;span class="mtk4">'+'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">'-'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">'*'&lt;/span>&lt;span class="mtk1">]), &lt;/span>&lt;span class="mtk1">randint&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk6">1&lt;/span>&lt;span class="mtk1">,&lt;/span>&lt;span class="mtk6">69&lt;/span>&lt;span class="mtk1">)])))&lt;/span> 

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">request&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">method&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">==&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">'POST'&lt;/span>&lt;span class="mtk1">:&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">ingredient&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">request&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">form&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">get&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'ingredient'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">''&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">recipe&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">'&lt;/span>&lt;span class="mtk6">%s&lt;/span>&lt;span class="mtk4"> = &lt;/span>&lt;span class="mtk6">%s&lt;/span>&lt;span class="mtk4">'&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">%&lt;/span>&lt;span class="mtk1"> (&lt;/span>&lt;span class="mtk1">ingredient&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk1">request&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">form&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">get&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'measurements'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">''&lt;/span>&lt;span class="mtk1">))&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">calc&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">recipe&lt;/span>&lt;span class="mtk1">)&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">garage&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">get&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">ingredient&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">''&lt;/span>&lt;span class="mtk1">):&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">render_template&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'index.html'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">calculations&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1">garage&lt;/span>&lt;span class="mtk1">[&lt;/span>&lt;span class="mtk1">ingredient&lt;/span>&lt;span class="mtk1">])&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">func&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk5">*&lt;/span>&lt;span class="mtk9 mtki">args&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk5">**&lt;/span>&lt;span class="mtk9 mtki">kwargs&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">federation&lt;/span>

&lt;span class="mtk8">@&lt;/span>&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk8">.&lt;/span>&lt;span class="mtk8">route&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'/'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">methods&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1">[&lt;/span>&lt;span class="mtk4">'GET'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">'POST'&lt;/span>&lt;span class="mtk1">])&lt;/span>
&lt;span class="mtk8">@&lt;/span>&lt;span class="mtk8">GCR&lt;/span>
&lt;span class="mtk7 mtki">def&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">index&lt;/span>&lt;span class="mtk1">():&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">render_template&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'index.html'&lt;/span>&lt;span class="mtk1">)&lt;/span>

&lt;span class="mtk8">@&lt;/span>&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk8">.&lt;/span>&lt;span class="mtk8">route&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'/debug'&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk7 mtki">def&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">debug&lt;/span>&lt;span class="mtk1">():&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">Response&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk8">open&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">__file__&lt;/span>&lt;span class="mtk1">).&lt;/span>&lt;span class="mtk8">read&lt;/span>&lt;span class="mtk1">(), &lt;/span>&lt;span class="mtk9 mtki">mimetype&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk4">'text/plain'&lt;/span>&lt;span class="mtk1">)&lt;/span>

&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">__name__&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">==&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">'__main__'&lt;/span>&lt;span class="mtk1">:&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">run&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'0.0.0.0'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">port&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk6">1337&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>When we execute a POST request against &lt;code>/&lt;/code>, we can provide &lt;code>ingredient&lt;/code> and &lt;code>measurements&lt;/code> parameters and control the &lt;code>recipe&lt;/code> variable:&lt;/p></description></item><item><title>baby nginxatsu</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/baby-nginxatsu/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/baby-nginxatsu/</guid><description>&lt;p>We are provided with this webpage:&lt;/p>
&lt;p>&lt;img alt="baby nginxatsu 1" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-baby-nginxatsu-1.webp">&lt;/p>
&lt;p>After registering an account and logging in, we have this feature:&lt;/p>
&lt;p>&lt;img alt="baby nginxatsu 2" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-baby-nginxatsu-2.webp">&lt;/p>
&lt;p>Basically, we can create nginx configuration files.&lt;/p>
&lt;h2 id="nginx-exploitation">nginx exploitation&lt;/h2>
&lt;p>Notice that the &lt;code>location&lt;/code> field is &lt;code>/storage&lt;/code>. Let&amp;rsquo;s create the default configuration and see what we have:&lt;/p>
&lt;p>&lt;img alt="baby nginxatsu 3" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-baby-nginxatsu-3.webp">&lt;/p>
&lt;p>We have this configuration:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="mtk5">user&lt;/span> www;
&lt;span class="mtk5">pid&lt;/span> /run/nginx.pid;
&lt;span class="mtk5">error_log&lt;/span> /dev/stderr info;

&lt;span class="mtk7">events&lt;/span> {
 &lt;span class="mtk5">worker_connections&lt;/span> &lt;span class="mtk4">1024&lt;/span>;
}

&lt;span class="mtk7">http&lt;/span> {
 &lt;span class="mtk5">server_tokens&lt;/span> &lt;span class="mtk6">off&lt;/span>;

 &lt;span class="mtk5">charset&lt;/span> utf-8;
 &lt;span class="mtk5">keepalive_timeout&lt;/span> &lt;span class="mtk6">20s&lt;/span>;
 &lt;span class="mtk5">sendfile&lt;/span> &lt;span class="mtk6">on&lt;/span>;
 &lt;span class="mtk5">tcp_nopush&lt;/span> &lt;span class="mtk6">on&lt;/span>;
 &lt;span class="mtk5">client_max_body_size&lt;/span> &lt;span class="mtk6">2M&lt;/span>;

 &lt;span class="mtk5">include&lt;/span> /etc/nginx/mime.types;

 &lt;span class="mtk7">server&lt;/span> {
 &lt;span class="mtk5">listen&lt;/span> &lt;span class="mtk4">80&lt;/span>;
 &lt;span class="mtk5">server_name&lt;/span> _;

 &lt;span class="mtk5">index&lt;/span> index.php;
 &lt;span class="mtk5">root&lt;/span> /www/public;

 &lt;span class="mtk3"># We sure hope so that we don't spill any secrets&lt;/span>
 &lt;span class="mtk3"># within the open directory on /storage&lt;/span>

 &lt;span class="mtk7">location&lt;/span> &lt;span class="mtk8">/storage&lt;/span> {
 &lt;span class="mtk5">autoindex&lt;/span> &lt;span class="mtk6">on&lt;/span>;
 }

 &lt;span class="mtk7">location&lt;/span> &lt;span class="mtk8">/&lt;/span> {
 &lt;span class="mtk5">try_files&lt;/span> $uri $uri/ /index.php?$query_string;
 &lt;span class="mtk7">location&lt;/span> ~ &lt;span class="mtk9">\.php$&lt;/span> {
 &lt;span class="mtk5">try_files&lt;/span> $uri &lt;span class="mtk6">=404&lt;/span>;
 &lt;span class="mtk5">fastcgi_pass&lt;/span> unix:/run/php-fpm.sock;
 &lt;span class="mtk5">fastcgi_index&lt;/span> index.php;
 &lt;span class="mtk5">fastcgi_param&lt;/span> SCRIPT_FILENAME $document_root$fastcgi_script_name; 
 &lt;span class="mtk5">include&lt;/span> fastcgi_params;
 }
 }
 }
}
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>In the &lt;code>location /storage&lt;/code> block, there is an &lt;code>autoindex on&lt;/code> configuration, which tells nginx to show a directory listing (more information at &lt;a target="_blank" href="https://nginx.org/en/docs/http/ngx_http_autoindex_module.html">nginx.org&lt;/a>).&lt;/p></description></item><item><title>baby ninja jinja</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/baby-ninja-jinja/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/baby-ninja-jinja/</guid><description>&lt;p>We are provided with this web page:&lt;/p>
&lt;p>&lt;img alt="baby ninja jinja 1" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-baby-ninja-jinja-1.webp">&lt;/p>
&lt;p>There is an HTML comment on the &lt;code>index.html&lt;/code> that points to a debugging URL (&lt;code>/debug&lt;/code>):&lt;/p>
&lt;p>&lt;img alt="baby ninja jinja 2" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-baby-ninja-jinja-2.webp">&lt;/p>
&lt;p>In this &lt;code>/debug&lt;/code> endpoint, the source code is found:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="code-cyan">$&lt;/span> &lt;span class="code-dark-green">curl&lt;/span> 157.245.33.77:31650/debug 
&lt;/code>&lt;/pre>&lt;/div>

&lt;div class="highlight">&lt;pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="mtk5">from&lt;/span> &lt;span class="mtk8 mtku">flask&lt;/span> &lt;span class="mtk5">import&lt;/span> &lt;span class="mtk8 mtku">Flask&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk1">session&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk8">render_template&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk1">request&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk8 mtku">Response&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk8">render_template_string&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk1">g&lt;/span>
&lt;span class="mtk5">import&lt;/span> &lt;span class="mtk8 mtku">functools&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk8 mtku">sqlite3&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk8 mtku">os&lt;/span>

&lt;span class="mtk1">app&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk8 mtku">Flask&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">__name__&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">config&lt;/span>&lt;span class="mtk1">[&lt;/span>&lt;span class="mtk4">'SECRET_KEY'&lt;/span>&lt;span class="mtk1">]&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk8 mtku">os&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">urandom&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk6">120&lt;/span>&lt;span class="mtk1">)&lt;/span>

&lt;span class="mtk1">acc_tmpl&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk4">'''{%&lt;/span> &lt;span class="mtk4">extends&lt;/span> &lt;span class="mtk4">'index.html'&lt;/span> &lt;span class="mtk4">%}&lt;/span>
&lt;span class="mtk4">{%&lt;/span> &lt;span class="mtk4">block&lt;/span> &lt;span class="mtk4">content&lt;/span> &lt;span class="mtk4">%}&lt;/span>
&lt;span class="mtk4">&amp;lt;h3&amp;gt;baby_ninja&lt;/span> &lt;span class="mtk4">joined,&lt;/span> &lt;span class="mtk4">total&lt;/span> &lt;span class="mtk4">number&lt;/span> &lt;span class="mtk4">of&lt;/span> &lt;span class="mtk4">rebels:&lt;/span> &lt;span class="mtk4">reb_num&amp;lt;br&amp;gt;&lt;/span>
&lt;span class="mtk4">{%&lt;/span> &lt;span class="mtk4">endblock&lt;/span> &lt;span class="mtk4">%}&lt;/span>
&lt;span class="mtk4">'''&lt;/span>

&lt;span class="mtk7 mtki">def&lt;/span> &lt;span class="mtk8">get_db&lt;/span>&lt;span class="mtk1">():&lt;/span>
 &lt;span class="mtk1">db&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk8">getattr&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">g&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk4">'_database'&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk6">None&lt;/span>&lt;span class="mtk1">)&lt;/span>
 &lt;span class="mtk5">if&lt;/span> &lt;span class="mtk1">db&lt;/span> &lt;span class="mtk5">is&lt;/span> &lt;span class="mtk6">None&lt;/span>&lt;span class="mtk1">:&lt;/span>
 &lt;span class="mtk1">db&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk1">g&lt;/span>&lt;span class="mtk1">._database&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk8 mtku">sqlite3&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">connect&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'/tmp/ninjas.db'&lt;/span>&lt;span class="mtk1">)&lt;/span>
 &lt;span class="mtk1">db&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">isolation_level&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk6">None&lt;/span>
 &lt;span class="mtk1">db&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">row_factory&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk8 mtku">sqlite3&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8 mtku">Row&lt;/span>
 &lt;span class="mtk1">db&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">text_factory&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk1">(&lt;/span>&lt;span class="mtk7 mtki">lambda&lt;/span> &lt;span class="mtk9 mtki">s&lt;/span>&lt;span class="mtk1">:&lt;/span> &lt;span class="mtk9 mtki">s&lt;/span>&lt;span class="mtk1">.replace(&lt;/span>&lt;span class="mtk4">'&lt;/span>&lt;span class="mtk6">{&lt;/span>&lt;span class="mtk6">{&lt;/span>&lt;span class="mtk4">'&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk4">''&lt;/span>&lt;span class="mtk1">).&lt;/span>
 &lt;span class="mtk1">replace(&lt;/span>&lt;span class="mtk4">"'"&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk4">'&amp;amp;#x27;'&lt;/span>&lt;span class="mtk1">).&lt;/span>
 &lt;span class="mtk1">replace(&lt;/span>&lt;span class="mtk4">'"'&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk4">'&amp;amp;quot;'&lt;/span>&lt;span class="mtk1">).&lt;/span>
 &lt;span class="mtk1">replace(&lt;/span>&lt;span class="mtk4">'&amp;lt;'&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk4">'&amp;amp;lt;'&lt;/span>&lt;span class="mtk1">).&lt;/span>
 &lt;span class="mtk1">replace(&lt;/span>&lt;span class="mtk4">'&amp;gt;'&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk4">'&amp;amp;gt;'&lt;/span>&lt;span class="mtk1">)&lt;/span>
 &lt;span class="mtk1">)&lt;/span>
 &lt;span class="mtk5">return&lt;/span> &lt;span class="mtk1">db&lt;/span>

&lt;span class="mtk7 mtki">def&lt;/span> &lt;span class="mtk8">query_db&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">query&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk9 mtki">args&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1">(),&lt;/span> &lt;span class="mtk9 mtki">one&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk6">False&lt;/span>&lt;span class="mtk1">):&lt;/span>
 &lt;span class="mtk5">with&lt;/span> &lt;span class="mtk1">app&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">app_context&lt;/span>&lt;span class="mtk1">():&lt;/span>
 &lt;span class="mtk1">cur&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk8">get_db&lt;/span>&lt;span class="mtk1">().&lt;/span>&lt;span class="mtk8">execute&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">query&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk9 mtki">args&lt;/span>&lt;span class="mtk1">)&lt;/span>
 &lt;span class="mtk1">rv&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk1">[&lt;/span>&lt;span class="mtk8 mtku">dict&lt;/span>&lt;span class="mtk1">((&lt;/span>&lt;span class="mtk1">cur&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">description&lt;/span>&lt;span class="mtk1">[&lt;/span>&lt;span class="mtk1">idx&lt;/span>&lt;span class="mtk1">][&lt;/span>&lt;span class="mtk6">0&lt;/span>&lt;span class="mtk1">],&lt;/span> &lt;span class="mtk8 mtku">str&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">value&lt;/span>&lt;span class="mtk1">))&lt;/span> &lt;span class="mtk1">\&lt;/span>
 &lt;span class="mtk5">for&lt;/span> &lt;span class="mtk1">idx&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk1">value&lt;/span> &lt;span class="mtk5">in&lt;/span> &lt;span class="mtk8 mtku">enumerate&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">row&lt;/span>&lt;span class="mtk1">))&lt;/span> &lt;span class="mtk5">for&lt;/span> &lt;span class="mtk1">row&lt;/span> &lt;span class="mtk5">in&lt;/span> &lt;span class="mtk1">cur&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">fetchall&lt;/span>&lt;span class="mtk1">()]&lt;/span>
 &lt;span class="mtk5">return&lt;/span> &lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">rv&lt;/span>&lt;span class="mtk1">[&lt;/span>&lt;span class="mtk6">0&lt;/span>&lt;span class="mtk1">]&lt;/span> &lt;span class="mtk5">if&lt;/span> &lt;span class="mtk1">rv&lt;/span> &lt;span class="mtk5">else&lt;/span> &lt;span class="mtk6">None&lt;/span>&lt;span class="mtk1">)&lt;/span> &lt;span class="mtk5">if&lt;/span> &lt;span class="mtk9 mtki">one&lt;/span> &lt;span class="mtk5">else&lt;/span> &lt;span class="mtk1">rv&lt;/span>

&lt;span class="mtk8">@&lt;/span>&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk8">.&lt;/span>&lt;span class="mtk8">before_first_request&lt;/span>
&lt;span class="mtk7 mtki">def&lt;/span> &lt;span class="mtk8">init_db&lt;/span>&lt;span class="mtk1">():&lt;/span>
 &lt;span class="mtk5">with&lt;/span> &lt;span class="mtk1">app&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">open_resource&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'schema.sql'&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk9 mtki">mode&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk4">'r'&lt;/span>&lt;span class="mtk1">)&lt;/span> &lt;span class="mtk5">as&lt;/span> &lt;span class="mtk1">f&lt;/span>&lt;span class="mtk1">:&lt;/span>
 &lt;span class="mtk8">get_db&lt;/span>&lt;span class="mtk1">().&lt;/span>&lt;span class="mtk8">cursor&lt;/span>&lt;span class="mtk1">().&lt;/span>&lt;span class="mtk8">executescript&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">f&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">read&lt;/span>&lt;span class="mtk1">())&lt;/span>

&lt;span class="mtk8">@&lt;/span>&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk8">.&lt;/span>&lt;span class="mtk8">teardown_appcontext&lt;/span>
&lt;span class="mtk7 mtki">def&lt;/span> &lt;span class="mtk8">close_connection&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">exception&lt;/span>&lt;span class="mtk1">):&lt;/span>
 &lt;span class="mtk1">db&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk8">getattr&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">g&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk4">'_database'&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk6">None&lt;/span>&lt;span class="mtk1">)&lt;/span>
 &lt;span class="mtk5">if&lt;/span> &lt;span class="mtk1">db&lt;/span> &lt;span class="mtk5">is&lt;/span> &lt;span class="mtk5">not&lt;/span> &lt;span class="mtk6">None&lt;/span>&lt;span class="mtk1">:&lt;/span> &lt;span class="mtk1">db&lt;/span>&lt;span class="mtk1">.close()&lt;/span>

&lt;span class="mtk7 mtki">def&lt;/span> &lt;span class="mtk8">rite_of_passage&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">func&lt;/span>&lt;span class="mtk1">):&lt;/span>
 &lt;span class="mtk8">@&lt;/span>&lt;span class="mtk8 mtku">functools&lt;/span>&lt;span class="mtk8">.&lt;/span>&lt;span class="mtk8">wraps&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">func&lt;/span>&lt;span class="mtk1">)&lt;/span>
 &lt;span class="mtk7 mtki">def&lt;/span> &lt;span class="mtk8">born2pwn&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk5">*&lt;/span>&lt;span class="mtk9 mtki">args&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk5">**&lt;/span>&lt;span class="mtk9 mtki">kwargs&lt;/span>&lt;span class="mtk1">):&lt;/span>

 &lt;span class="mtk1">name&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk1">request&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">args&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">get&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'name'&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk4">''&lt;/span>&lt;span class="mtk1">)&lt;/span>

 &lt;span class="mtk5">if&lt;/span> &lt;span class="mtk1">name&lt;/span>&lt;span class="mtk1">:&lt;/span>
 &lt;span class="mtk8">query_db&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'INSERT&lt;/span> &lt;span class="mtk4">INTO&lt;/span> &lt;span class="mtk4">ninjas&lt;/span> &lt;span class="mtk4">(name)&lt;/span> &lt;span class="mtk4">VALUES&lt;/span> &lt;span class="mtk4">("&lt;/span>&lt;span class="mtk6">%s&lt;/span>&lt;span class="mtk4">")'&lt;/span> &lt;span class="mtk5">%&lt;/span> &lt;span class="mtk1">name&lt;/span>&lt;span class="mtk1">)&lt;/span>

 &lt;span class="mtk1">report&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk8">render_template_string&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">acc_tmpl&lt;/span>&lt;span class="mtk1">.&lt;/span>
 &lt;span class="mtk8">replace&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'baby_ninja'&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk8">query_db&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'SELECT&lt;/span> &lt;span class="mtk4">name&lt;/span> &lt;span class="mtk4">FROM&lt;/span> &lt;span class="mtk4">ninjas&lt;/span> &lt;span class="mtk4">ORDER&lt;/span> &lt;span class="mtk4">BY&lt;/span> &lt;span class="mtk4">id&lt;/span> &lt;span class="mtk4">DESC'&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk9 mtki">one&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk6">True&lt;/span>&lt;span class="mtk1">)[&lt;/span>&lt;span class="mtk4">'name'&lt;/span>&lt;span class="mtk1">]).&lt;/span> 
 &lt;span class="mtk8">replace&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'reb_num'&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk8">query_db&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'SELECT&lt;/span> &lt;span class="mtk4">COUNT(id)&lt;/span> &lt;span class="mtk4">FROM&lt;/span> &lt;span class="mtk4">ninjas'&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk9 mtki">one&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk6">True&lt;/span>&lt;span class="mtk1">).itervalues().next())&lt;/span>
 &lt;span class="mtk1">)&lt;/span>

 &lt;span class="mtk5">if&lt;/span> &lt;span class="mtk1">session&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">get&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'leader'&lt;/span>&lt;span class="mtk1">):&lt;/span>
 &lt;span class="mtk5">return&lt;/span> &lt;span class="mtk1">report&lt;/span>

 &lt;span class="mtk5">return&lt;/span> &lt;span class="mtk8">render_template&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'welcome.jinja2'&lt;/span>&lt;span class="mtk1">)&lt;/span>
 &lt;span class="mtk5">return&lt;/span> &lt;span class="mtk9 mtki">func&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk5">*&lt;/span>&lt;span class="mtk9 mtki">args&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk5">**&lt;/span>&lt;span class="mtk9 mtki">kwargs&lt;/span>&lt;span class="mtk1">)&lt;/span>
 &lt;span class="mtk5">return&lt;/span> &lt;span class="mtk8">born2pwn&lt;/span>

&lt;span class="mtk8">@&lt;/span>&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk8">.&lt;/span>&lt;span class="mtk8">route&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'/'&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk8">@&lt;/span>&lt;span class="mtk8">rite_of_passage&lt;/span>
&lt;span class="mtk7 mtki">def&lt;/span> &lt;span class="mtk8">index&lt;/span>&lt;span class="mtk1">():&lt;/span>
 &lt;span class="mtk5">return&lt;/span> &lt;span class="mtk8">render_template&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'index.html'&lt;/span>&lt;span class="mtk1">)&lt;/span>

&lt;span class="mtk8">@&lt;/span>&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk8">.&lt;/span>&lt;span class="mtk8">route&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'/debug'&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk7 mtki">def&lt;/span> &lt;span class="mtk8">debug&lt;/span>&lt;span class="mtk1">():&lt;/span>
 &lt;span class="mtk5">return&lt;/span> &lt;span class="mtk8 mtku">Response&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk8">open&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">__file__&lt;/span>&lt;span class="mtk1">).&lt;/span>&lt;span class="mtk8">read&lt;/span>&lt;span class="mtk1">(),&lt;/span> &lt;span class="mtk9 mtki">mimetype&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk4">'text/plain'&lt;/span>&lt;span class="mtk1">)&lt;/span>

&lt;span class="mtk5">if&lt;/span> &lt;span class="mtk1">__name__&lt;/span> &lt;span class="mtk5">==&lt;/span> &lt;span class="mtk4">'__main__'&lt;/span>&lt;span class="mtk1">:&lt;/span>
 &lt;span class="mtk1">app&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">run&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">host&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk4">'0.0.0.0'&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk9 mtki">port&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk6">1337&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk9 mtki">debug&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk6">True&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>As it is using Flask as web framework and Jinja2 as template engine, the vulnerability is related to Server-Side Template Injection (SSTI).&lt;/p></description></item><item><title>baby todo or not todo</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/baby-todo-or-not-todo/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/baby-todo-or-not-todo/</guid><description>&lt;p>We are provided with this webpage:&lt;/p>
&lt;p>&lt;img alt="baby todo or not todo 1" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-baby-todo-or-not-todo-1.webp">&lt;/p>
&lt;h2 id="source-code-analysis">Source code analysis&lt;/h2>
&lt;p>We are also provided with the source code, which is a Flask application (Python). This is &lt;code>application/app.py&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="mtk5">from&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">flask&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">Flask&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk1">session&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk1">g&lt;/span>
&lt;span class="mtk5">from&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">flask&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8 mtku">json&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">JSONEncoder&lt;/span>
&lt;span class="mtk5">from&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">application&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8 mtku">blueprints&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8 mtku">routes&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">main&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk1">api&lt;/span>
&lt;span class="mtk5">from&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">application&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8 mtku">util&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">generate&lt;/span>
&lt;span class="mtk5">from&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">application&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8 mtku">database&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">get_db&lt;/span>
&lt;span class="mtk5">from&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">application&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8 mtku">models&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">todo&lt;/span>
&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">time&lt;/span>

&lt;span class="mtk7 mtki">class&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">toJSON&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk8 mtku">JSONEncoder&lt;/span>&lt;span class="mtk1">):&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">def&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">default&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">self&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">obj&lt;/span>&lt;span class="mtk1">):&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">isinstance&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">obj&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk8 mtku">todo&lt;/span>&lt;span class="mtk1">):&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">'id'&lt;/span>&lt;span class="mtk1"> : &lt;/span>&lt;span class="mtk9 mtki">obj&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">id&lt;/span>&lt;span class="mtk1">,&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">'name'&lt;/span>&lt;span class="mtk1"> : &lt;/span>&lt;span class="mtk9 mtki">obj&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">name&lt;/span>&lt;span class="mtk1">,&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">'assignee'&lt;/span>&lt;span class="mtk1">: &lt;/span>&lt;span class="mtk9 mtki">obj&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">assignee&lt;/span>&lt;span class="mtk1">,&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">'done'&lt;/span>&lt;span class="mtk1"> : &lt;/span>&lt;span class="mtk9 mtki">obj&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">done&lt;/span>
&lt;span class="mtk1"> }&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">super&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk8 mtku">toJSON&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">self&lt;/span>&lt;span class="mtk1">).&lt;/span>&lt;span class="mtk8">default&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">obj&lt;/span>&lt;span class="mtk1">)&lt;/span>

&lt;span class="mtk7 mtki">class&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">HTB&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk8 mtku">Flask&lt;/span>&lt;span class="mtk1">):&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">def&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">process_response&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">self&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">response&lt;/span>&lt;span class="mtk1">):&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">response&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">headers&lt;/span>&lt;span class="mtk1">[&lt;/span>&lt;span class="mtk4">'Server'&lt;/span>&lt;span class="mtk1">] &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">'made with &amp;lt;3 by makelarides'&lt;/span> 
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">super&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk8 mtku">HTB&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">self&lt;/span>&lt;span class="mtk1">).&lt;/span>&lt;span class="mtk8">process_response&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">response&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">response&lt;/span>

&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">HTB&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">__name__&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">config&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">from_object&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'application.config.Config'&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">json_encoder&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">toJSON&lt;/span>

&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">register_blueprint&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">main&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">url_prefix&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk4">'/'&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">register_blueprint&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">api&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">url_prefix&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk4">'/api'&lt;/span>&lt;span class="mtk1">)&lt;/span>

&lt;span class="mtk8">@&lt;/span>&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk8">.&lt;/span>&lt;span class="mtk8">before_first_request&lt;/span>
&lt;span class="mtk7 mtki">def&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">wake_bots&lt;/span>&lt;span class="mtk1">():&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">with&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">open_resource&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'schema.sql'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">mode&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk4">'r'&lt;/span>&lt;span class="mtk1">) &lt;/span>&lt;span class="mtk5">as&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">f&lt;/span>&lt;span class="mtk1">:&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">get_db&lt;/span>&lt;span class="mtk1">().&lt;/span>&lt;span class="mtk8">cursor&lt;/span>&lt;span class="mtk1">().&lt;/span>&lt;span class="mtk8">executescript&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">f&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">read&lt;/span>&lt;span class="mtk1">() &lt;/span>&lt;span class="mtk5">%&lt;/span>&lt;span class="mtk1"> (&lt;/span>&lt;span class="mtk1">generate&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk6">15&lt;/span>&lt;span class="mtk1">)))&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">time&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">sleep&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk6">0.2&lt;/span>&lt;span class="mtk1">)&lt;/span>

&lt;span class="mtk8">@&lt;/span>&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk8">.&lt;/span>&lt;span class="mtk8">before_request&lt;/span>
&lt;span class="mtk7 mtki">def&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">is_authenticated&lt;/span>&lt;span class="mtk1">():&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">g&lt;/span>&lt;span class="mtk1">.user &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">session&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">get&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'authentication'&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">not&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">g&lt;/span>&lt;span class="mtk1">.user:&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">username&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">f&lt;/span>&lt;span class="mtk4">'user&lt;/span>&lt;span class="mtk6">{&lt;/span>&lt;span class="mtk1">generate&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk6">8&lt;/span>&lt;span class="mtk1">)&lt;/span>&lt;span class="mtk6">}&lt;/span>&lt;span class="mtk4">'&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">todo&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">create_user&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">username&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk1">generate&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk6">15&lt;/span>&lt;span class="mtk1">))&lt;/span>
&lt;span class="mtk1"> g.user &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">session&lt;/span>&lt;span class="mtk1">[&lt;/span>&lt;span class="mtk4">'authentication'&lt;/span>&lt;span class="mtk1">] &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">username&lt;/span>


&lt;span class="mtk8">@&lt;/span>&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk8">.&lt;/span>&lt;span class="mtk8">teardown_appcontext&lt;/span>
&lt;span class="mtk7 mtki">def&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">close_connection&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">exception&lt;/span>&lt;span class="mtk1">):&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">db&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">getattr&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">g&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">'_database'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk6">None&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">db&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">is&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">not&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk6">None&lt;/span>&lt;span class="mtk1">: &lt;/span>&lt;span class="mtk1">db&lt;/span>&lt;span class="mtk1">.close()&lt;/span>

&lt;span class="mtk8">@&lt;/span>&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk8">.&lt;/span>&lt;span class="mtk8">errorhandler&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk6">404&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk7 mtki">def&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">not_found&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">error&lt;/span>&lt;span class="mtk1">):&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> {&lt;/span>&lt;span class="mtk4">'error'&lt;/span>&lt;span class="mtk1">: &lt;/span>&lt;span class="mtk4">'Not Found'&lt;/span>&lt;span class="mtk1">}, &lt;/span>&lt;span class="mtk6">404&lt;/span>

&lt;span class="mtk8">@&lt;/span>&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk8">.&lt;/span>&lt;span class="mtk8">errorhandler&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk6">403&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk7 mtki">def&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">forbidden&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">error&lt;/span>&lt;span class="mtk1">):&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> {&lt;/span>&lt;span class="mtk4">'error'&lt;/span>&lt;span class="mtk1">: &lt;/span>&lt;span class="mtk4">'Not Allowed'&lt;/span>&lt;span class="mtk1">}, &lt;/span>&lt;span class="mtk6">403&lt;/span>

&lt;span class="mtk8">@&lt;/span>&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk8">.&lt;/span>&lt;span class="mtk8">errorhandler&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk6">400&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk7 mtki">def&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">bad_request&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">error&lt;/span>&lt;span class="mtk1">):&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> {&lt;/span>&lt;span class="mtk4">'error'&lt;/span>&lt;span class="mtk1">: &lt;/span>&lt;span class="mtk4">'Bad Request'&lt;/span>&lt;span class="mtk1">}, &lt;/span>&lt;span class="mtk6">400&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>Something interesting are these endpoints:&lt;/p></description></item><item><title>baby WAFfles order</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/baby-waffles-order/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/baby-waffles-order/</guid><description>&lt;p>We are provided with this webpage:&lt;/p>
&lt;p>&lt;img alt="baby WAFfles order 1" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-baby-WAFfles-order-1.webp">&lt;/p>
&lt;h2 id="static-code-analysis">Static code analysis&lt;/h2>
&lt;p>We also have the PHP source code. This is &lt;code>index.php&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="mtk5">&amp;lt;?php&lt;/span>
&lt;span class="mtk7">spl_autoload_register&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk7 mtki">function&lt;/span>&lt;span class="mtk1"> ($name){&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> (&lt;/span>&lt;span class="mtk7">preg_match&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'/Controller&lt;/span>&lt;span class="mtk5">$&lt;/span>&lt;span class="mtk4">/'&lt;/span>&lt;span class="mtk1">, $name))&lt;/span>
&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> $name &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">"controllers/&lt;/span>&lt;span class="mtk1">${name}&lt;/span>&lt;span class="mtk4">"&lt;/span>&lt;span class="mtk1">;&lt;/span>
&lt;span class="mtk1"> }&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">include_once&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">"&lt;/span>&lt;span class="mtk1">${name}&lt;/span>&lt;span class="mtk4">.php"&lt;/span>&lt;span class="mtk1">;&lt;/span>
&lt;span class="mtk1">});&lt;/span>

&lt;span class="mtk1">$router &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">new&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">Router&lt;/span>&lt;span class="mtk1">();&lt;/span>

&lt;span class="mtk1">$router&lt;/span>&lt;span class="mtk5">-&amp;gt;&lt;/span>&lt;span class="mtk8">new&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'GET'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">'/'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk7 mtki">fn&lt;/span>&lt;span class="mtk1">($router) =&amp;gt; $router&lt;/span>&lt;span class="mtk5">-&amp;gt;&lt;/span>&lt;span class="mtk8">view&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'menu'&lt;/span>&lt;span class="mtk1">));&lt;/span> 
&lt;span class="mtk1">$router&lt;/span>&lt;span class="mtk5">-&amp;gt;&lt;/span>&lt;span class="mtk8">new&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'POST'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">'/api/order'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">'OrderController@order'&lt;/span>&lt;span class="mtk1">);&lt;/span>

&lt;span class="mtk5">die&lt;/span>&lt;span class="mtk1">($router&lt;/span>&lt;span class="mtk5">-&amp;gt;&lt;/span>&lt;span class="mtk8">match&lt;/span>&lt;span class="mtk1">());&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>Here we only see two routes. The one that is most interesting is the one handled by &lt;code>OrderController.php&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="mtk5">&amp;lt;?php&lt;/span>
&lt;span class="mtk7 mtki">class&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">OrderController&lt;/span>
&lt;span class="mtk1">{&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">public&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">function&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">order&lt;/span>&lt;span class="mtk1">($router)&lt;/span>
&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> $body &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7">file_get_contents&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'php://input'&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> ($_SERVER[&lt;/span>&lt;span class="mtk4">'HTTP_CONTENT_TYPE'&lt;/span>&lt;span class="mtk1">] &lt;/span>&lt;span class="mtk5">===&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">'application/json'&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> $order &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7">json_decode&lt;/span>&lt;span class="mtk1">($body);&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> (&lt;/span>&lt;span class="mtk5">!&lt;/span>&lt;span class="mtk1">$order&lt;/span>&lt;span class="mtk5">-&amp;gt;&lt;/span>&lt;span class="mtk1">food) &lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7">json_encode&lt;/span>&lt;span class="mtk1">([&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">'status'&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&amp;gt;&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">'danger'&lt;/span>&lt;span class="mtk1">,&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">'message'&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&amp;gt;&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">'You need to select a food option first'&lt;/span>
&lt;span class="mtk1"> ]);&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7">json_encode&lt;/span>&lt;span class="mtk1">([&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">'status'&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&amp;gt;&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">'success'&lt;/span>&lt;span class="mtk1">,&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">'message'&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&amp;gt;&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">"Your {&lt;/span>&lt;span class="mtk1">$order&lt;/span>&lt;span class="mtk5">-&amp;gt;&lt;/span>&lt;span class="mtk1">food&lt;/span>&lt;span class="mtk4">} order has been submitted successfully."&lt;/span> 
&lt;span class="mtk1"> ]);&lt;/span>
&lt;span class="mtk1"> }&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">else&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> ($_SERVER[&lt;/span>&lt;span class="mtk4">'HTTP_CONTENT_TYPE'&lt;/span>&lt;span class="mtk1">] &lt;/span>&lt;span class="mtk5">===&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">'application/xml'&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> $order &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7">simplexml_load_string&lt;/span>&lt;span class="mtk1">($body, &lt;/span>&lt;span class="mtk4">'SimpleXMLElement'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk7">LIBXML_NOENT&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> (&lt;/span>&lt;span class="mtk5">!&lt;/span>&lt;span class="mtk1">$order&lt;/span>&lt;span class="mtk5">-&amp;gt;&lt;/span>&lt;span class="mtk1">food) &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">'You need to select a food option first'&lt;/span>&lt;span class="mtk1">;&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">"Your {&lt;/span>&lt;span class="mtk1">$order&lt;/span>&lt;span class="mtk5">-&amp;gt;&lt;/span>&lt;span class="mtk1">food&lt;/span>&lt;span class="mtk4">} order has been submitted successfully."&lt;/span>&lt;span class="mtk1">;&lt;/span>
&lt;span class="mtk1"> }&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">else&lt;/span>
&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> $router&lt;/span>&lt;span class="mtk5">-&amp;gt;&lt;/span>&lt;span class="mtk8">abort&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk6">400&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk1"> }&lt;/span>
&lt;span class="mtk1"> }&lt;/span>
&lt;span class="mtk1">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>Basically, the controller allows us to enter data with JSON format or with XML format:&lt;/p></description></item><item><title>baby website rick</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/baby-website-rick/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/baby-website-rick/</guid><description>&lt;p>We are provided with this webpage:&lt;/p>
&lt;p>&lt;img alt="baby website rick 1" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-baby-website-rick-1.webp">&lt;/p>
&lt;h2 id="analyzing-the-website">Analyzing the website&lt;/h2>
&lt;p>This time, we don&amp;rsquo;t have any source code to analyze. However, the above image shows something suspicious:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;__main__.anti_pickle_serum object at 0x7f0ed62d1810> 
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>This looks like a Python class:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="code-cyan">$&lt;/span> &lt;span class="code-dark-green">python3&lt;/span> -q
&amp;gt;&amp;gt;&amp;gt; class Test():
... pass
...
&amp;gt;&amp;gt;&amp;gt; Test()
&amp;lt;__main__.Test object at 0x1007fbd30&amp;gt; 
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>Moreover, we have a cookie named &lt;code>plan_b&lt;/code>:&lt;/p>
&lt;p>&lt;img alt="baby website rick 2" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-baby-website-rick-2.webp">&lt;/p>
&lt;p>This looks like a Base64-encoded string:&lt;/p></description></item><item><title>BatchCraft Potions</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/batchcraft-potions/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/batchcraft-potions/</guid><description>&lt;p>We are given this website:&lt;/p>
&lt;p>&lt;img alt="BatchCraft Potions 1" src="https://7rocky.github.io/images/other/HTB%20UniCTF/BatchCraft-Potions-1.webp">&lt;/p>
&lt;h2 id="static-code-analysis">Static code analysis&lt;/h2>
&lt;p>We are provided with the JavaScript source code of the web application, built with Node.js and Express JS. This is &lt;code>index.js&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="mtk7 mtki">const&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">express&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">require&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'express'&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk7 mtki">const&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">express&lt;/span>&lt;span class="mtk1">();&lt;/span>
&lt;span class="mtk7 mtki">const&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">path&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">require&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'path'&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk7 mtki">const&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">cookieParser&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">require&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'cookie-parser'&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk7 mtki">const&lt;/span>&lt;span class="mtk1"> nunjucks &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">require&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'nunjucks'&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk7 mtki">const&lt;/span>&lt;span class="mtk1"> routes &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">require&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'./routes'&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk7 mtki">const&lt;/span>&lt;span class="mtk1"> Database &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">require&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'./database'&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk1">global&lt;/span>&lt;span class="mtk1">.db &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">new&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">Database&lt;/span>&lt;span class="mtk1">();&lt;/span>

&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">use&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk8">express&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">json&lt;/span>&lt;span class="mtk1">());&lt;/span>
&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">use&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk8">cookieParser&lt;/span>&lt;span class="mtk1">());&lt;/span>

&lt;span class="mtk1">nunjucks.&lt;/span>&lt;span class="mtk8">configure&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'views'&lt;/span>&lt;span class="mtk1">, {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">autoescape&lt;/span>&lt;span class="mtk1">: &lt;/span>&lt;span class="mtk6">true&lt;/span>&lt;span class="mtk1">,&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">express&lt;/span>&lt;span class="mtk1">: &lt;/span>&lt;span class="mtk1">app&lt;/span>
&lt;span class="mtk1">});&lt;/span>

&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">set&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'views'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">'./views'&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">use&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'/static'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk8">express&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">static&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">path&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">resolve&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'static'&lt;/span>&lt;span class="mtk1">)));&lt;/span>
&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">set&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'etag'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk6">false&lt;/span>&lt;span class="mtk1">);&lt;/span>

&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">use&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk8">routes&lt;/span>&lt;span class="mtk1">());&lt;/span>

&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">all&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'*'&lt;/span>&lt;span class="mtk1">, (&lt;/span>&lt;span class="mtk9 mtki">req&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">) &lt;/span>&lt;span class="mtk7 mtki">=&amp;gt;&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">status&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk6">404&lt;/span>&lt;span class="mtk1">).&lt;/span>&lt;span class="mtk8">send&lt;/span>&lt;span class="mtk1">({&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">message&lt;/span>&lt;span class="mtk1">: &lt;/span>&lt;span class="mtk4">'404 page not found'&lt;/span>
&lt;span class="mtk1"> });&lt;/span>
&lt;span class="mtk1">});&lt;/span>

&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk5">async&lt;/span>&lt;span class="mtk1"> () &lt;/span>&lt;span class="mtk7 mtki">=&amp;gt;&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">await&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">global&lt;/span>&lt;span class="mtk1">.db.&lt;/span>&lt;span class="mtk8">connect&lt;/span>&lt;span class="mtk1">();&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">await&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">global&lt;/span>&lt;span class="mtk1">.db.&lt;/span>&lt;span class="mtk8">migrate&lt;/span>&lt;span class="mtk1">();&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">listen&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk6">1337&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">'0.0.0.0'&lt;/span>&lt;span class="mtk1">, () &lt;/span>&lt;span class="mtk7 mtki">=&amp;gt;&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">console&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">log&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'Listening on port 1337'&lt;/span>&lt;span class="mtk1">));&lt;/span> 
&lt;span class="mtk1">})();&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>This is a normal script. It points to &lt;code>routes/index.js&lt;/code> and &lt;code>database.js&lt;/code>.&lt;/p></description></item><item><title>BlinkerFluids</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/blinkerfluids/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/blinkerfluids/</guid><description>&lt;p>We have a website where we can write Markdown and transform the document to PDF:&lt;/p>
&lt;p>&lt;img alt="BlinkerFluids 1" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-BlinkerFluids-1.webp">&lt;/p>
&lt;p>By default, we have this Markdown content:&lt;/p>
&lt;p>&lt;img alt="BlinkerFluids 2" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-BlinkerFluids-2.webp">&lt;/p>
&lt;p>As we have a Node.js project, if we read &lt;code>package.json&lt;/code> we can see the versions of the third-party dependencies:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="mtk1">{&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">"name"&lt;/span>&lt;span class="mtk1">: &lt;/span>&lt;span class="mtk11">"blinker-fluids"&lt;/span>&lt;span class="mtk1">,&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">"version"&lt;/span>&lt;span class="mtk1">: &lt;/span>&lt;span class="mtk11">"1.0.0"&lt;/span>&lt;span class="mtk1">,&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">"description"&lt;/span>&lt;span class="mtk1">: &lt;/span>&lt;span class="mtk11">""&lt;/span>&lt;span class="mtk1">,&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">"main"&lt;/span>&lt;span class="mtk1">: &lt;/span>&lt;span class="mtk11">"index.js"&lt;/span>&lt;span class="mtk1">,&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">"scripts"&lt;/span>&lt;span class="mtk1">: {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">"start"&lt;/span>&lt;span class="mtk1">: &lt;/span>&lt;span class="mtk11">"node index.js"&lt;/span> 
&lt;span class="mtk1"> },&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">"keywords"&lt;/span>&lt;span class="mtk1">: [],&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">"author"&lt;/span>&lt;span class="mtk1">: &lt;/span>&lt;span class="mtk11">"rayhan0x01"&lt;/span>&lt;span class="mtk1">,&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">"license"&lt;/span>&lt;span class="mtk1">: &lt;/span>&lt;span class="mtk11">"ISC"&lt;/span>&lt;span class="mtk1">,&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">"dependencies"&lt;/span>&lt;span class="mtk1">: {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">"express"&lt;/span>&lt;span class="mtk1">: &lt;/span>&lt;span class="mtk11">"4.17.3"&lt;/span>&lt;span class="mtk1">,&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">"md-to-pdf"&lt;/span>&lt;span class="mtk1">: &lt;/span>&lt;span class="mtk11">"4.1.0"&lt;/span>&lt;span class="mtk1">,&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">"nunjucks"&lt;/span>&lt;span class="mtk1">: &lt;/span>&lt;span class="mtk11">"3.2.3"&lt;/span>&lt;span class="mtk1">,&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">"sqlite-async"&lt;/span>&lt;span class="mtk1">: &lt;/span>&lt;span class="mtk11">"1.1.3"&lt;/span>&lt;span class="mtk1">,&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">"uuid"&lt;/span>&lt;span class="mtk1">: &lt;/span>&lt;span class="mtk11">"8.3.2"&lt;/span>
&lt;span class="mtk1"> },&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">"devDependencies"&lt;/span>&lt;span class="mtk1">: {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">"nodemon"&lt;/span>&lt;span class="mtk1">: &lt;/span>&lt;span class="mtk11">"^1.19.1"&lt;/span>
&lt;span class="mtk1"> }&lt;/span>
&lt;span class="mtk1">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>We notice that &lt;code>md-to-pdf&lt;/code> version 4.1.0 has a critical vulnerability (&lt;a target="_blank" href="https://snyk.io/test/npm/md-to-pdf/4.1.0">snyk.io&lt;/a>). We only need to use this payload:&lt;/p></description></item><item><title>CandyVault</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/candyvault/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/candyvault/</guid><description>&lt;p>We are given the following website:&lt;/p>
&lt;p>&lt;img alt="CandyVault 1" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-CandyVault-1.webp">&lt;/p>
&lt;p>We also have the Python source code of the server (Flask).&lt;/p>
&lt;h2 id="source-code-analysis">Source code analysis&lt;/h2>
&lt;p>The relevant file is &lt;code>app.py&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="mtk5">from&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">flask&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">Flask&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk8 mtku">Blueprint&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk8">render_template&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk8">redirect&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk8">jsonify&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk1">request&lt;/span>
&lt;span class="mtk5">from&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">flask_bcrypt&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">Bcrypt&lt;/span>
&lt;span class="mtk5">from&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">pymongo&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">MongoClient&lt;/span>

&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">Flask&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">__name__&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">config&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">from_object&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"application.config.Config"&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1">bcrypt&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">Bcrypt&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk1">)&lt;/span>

&lt;span class="mtk1">client&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">MongoClient&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">config&lt;/span>&lt;span class="mtk1">[&lt;/span>&lt;span class="mtk4">"MONGO_URI"&lt;/span>&lt;span class="mtk1">])&lt;/span>
&lt;span class="mtk1">db&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">client&lt;/span>&lt;span class="mtk1">[&lt;/span>&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">config&lt;/span>&lt;span class="mtk1">[&lt;/span>&lt;span class="mtk4">"DB_NAME"&lt;/span>&lt;span class="mtk1">]]&lt;/span>
&lt;span class="mtk1">users_collection&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">db&lt;/span>&lt;span class="mtk1">[&lt;/span>&lt;span class="mtk4">"users"&lt;/span>&lt;span class="mtk1">]&lt;/span>

&lt;span class="mtk8">@&lt;/span>&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk8">.&lt;/span>&lt;span class="mtk8">errorhandler&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk8 mtku">Exception&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk7 mtki">def&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">handle_error&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">error&lt;/span>&lt;span class="mtk1">):&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">message&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">error&lt;/span>&lt;span class="mtk1">.description &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">hasattr&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">error&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">"description"&lt;/span>&lt;span class="mtk1">) &lt;/span>&lt;span class="mtk5">else&lt;/span>&lt;span class="mtk1"> [&lt;/span>&lt;span class="mtk8 mtku">str&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">x&lt;/span>&lt;span class="mtk1">) &lt;/span>&lt;span class="mtk5">for&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">x&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">in&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">error&lt;/span>&lt;span class="mtk1">.args]&lt;/span> 
&lt;span class="mtk1"> &lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">response&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">"error"&lt;/span>&lt;span class="mtk1">: {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">"type"&lt;/span>&lt;span class="mtk1">: &lt;/span>&lt;span class="mtk9 mtki">error&lt;/span>&lt;span class="mtk1">.__class__.__name__,&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">"message"&lt;/span>&lt;span class="mtk1">: &lt;/span>&lt;span class="mtk1">message&lt;/span>
&lt;span class="mtk1"> }&lt;/span>
&lt;span class="mtk1"> }&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">response&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">error&lt;/span>&lt;span class="mtk1">.code &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">hasattr&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">error&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">"code"&lt;/span>&lt;span class="mtk1">) &lt;/span>&lt;span class="mtk5">else&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk6">500&lt;/span>


&lt;span class="mtk8">@&lt;/span>&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk8">.&lt;/span>&lt;span class="mtk8">route&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"/"&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">methods&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1">[&lt;/span>&lt;span class="mtk4">"GET"&lt;/span>&lt;span class="mtk1">])&lt;/span>
&lt;span class="mtk7 mtki">def&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">index&lt;/span>&lt;span class="mtk1">():&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">render_template&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"index.html"&lt;/span>&lt;span class="mtk1">)&lt;/span>


&lt;span class="mtk8">@&lt;/span>&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk8">.&lt;/span>&lt;span class="mtk8">route&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"/login"&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">methods&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1">[&lt;/span>&lt;span class="mtk4">"POST"&lt;/span>&lt;span class="mtk1">])&lt;/span>
&lt;span class="mtk7 mtki">def&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">login&lt;/span>&lt;span class="mtk1">():&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">content_type&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">request&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">headers&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">get&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"Content-Type"&lt;/span>&lt;span class="mtk1">)&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">content_type&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">==&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">"application/x-www-form-urlencoded"&lt;/span>&lt;span class="mtk1">:&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">email&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">request&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">form&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">get&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"email"&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">password&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">request&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">form&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">get&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"password"&lt;/span>&lt;span class="mtk1">)&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">elif&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">content_type&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">==&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">"application/json"&lt;/span>&lt;span class="mtk1">:&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">data&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">request&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">get_json&lt;/span>&lt;span class="mtk1">()&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">email&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">data&lt;/span>&lt;span class="mtk1">.get(&lt;/span>&lt;span class="mtk4">"email"&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">password&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">data&lt;/span>&lt;span class="mtk1">.get(&lt;/span>&lt;span class="mtk4">"password"&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">else&lt;/span>&lt;span class="mtk1">:&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">jsonify&lt;/span>&lt;span class="mtk1">({&lt;/span>&lt;span class="mtk4">"error"&lt;/span>&lt;span class="mtk1">: &lt;/span>&lt;span class="mtk4">"Unsupported Content-Type"&lt;/span>&lt;span class="mtk1">}), &lt;/span>&lt;span class="mtk6">400&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">user&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">users_collection&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">find_one&lt;/span>&lt;span class="mtk1">({&lt;/span>&lt;span class="mtk4">"email"&lt;/span>&lt;span class="mtk1">: &lt;/span>&lt;span class="mtk1">email&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">"password"&lt;/span>&lt;span class="mtk1">: &lt;/span>&lt;span class="mtk1">password&lt;/span>&lt;span class="mtk1">})&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">user&lt;/span>&lt;span class="mtk1">:&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">render_template&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"candy.html"&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">flag&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk8">open&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"flag.txt"&lt;/span>&lt;span class="mtk1">).&lt;/span>&lt;span class="mtk8">read&lt;/span>&lt;span class="mtk1">())&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">else&lt;/span>&lt;span class="mtk1">:&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">redirect&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"/"&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>There is only a &lt;code>/login&lt;/code> endpoint, where we can supply POST data as &lt;code>application/x-www-form-urlencoded&lt;/code> or &lt;code>application/json&lt;/code>. Then, our credentials will be checked against a database managed by MongoDB. If we get to log in successfully, we will see the flag because &lt;code>candy.html&lt;/code> will show it:&lt;/p></description></item><item><title>CurlAsAService</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/curlasaservice/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/curlasaservice/</guid><description>&lt;p>We are provided with this webpage, which allows us to execute &lt;code>curl&lt;/code>:&lt;/p>
&lt;p>&lt;img alt="CurlAsAService 1" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-CurlAsAService-1.webp">&lt;/p>
&lt;p>&lt;img alt="CurlAsAService 2" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-CurlAsAService-2.webp">&lt;/p>
&lt;h2 id="source-code-analysis">Source code analysis&lt;/h2>
&lt;p>We also have the PHP source code. This is &lt;code>index.php&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="mtk5">&amp;lt;?php&lt;/span>&lt;span class="mtk1"> &lt;/span>
&lt;span class="mtk7">date_default_timezone_set&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'UTC'&lt;/span>&lt;span class="mtk1">);&lt;/span>

&lt;span class="mtk7">spl_autoload_register&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk7 mtki">function&lt;/span>&lt;span class="mtk1"> ($name){&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> (&lt;/span>&lt;span class="mtk7">preg_match&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'/Controller&lt;/span>&lt;span class="mtk5">$&lt;/span>&lt;span class="mtk4">/'&lt;/span>&lt;span class="mtk1">, $name))&lt;/span>
&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> $name &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">"controllers/&lt;/span>&lt;span class="mtk1">${name}&lt;/span>&lt;span class="mtk4">"&lt;/span>&lt;span class="mtk1">;&lt;/span>
&lt;span class="mtk1"> }&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">else&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> (&lt;/span>&lt;span class="mtk7">preg_match&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'/Model&lt;/span>&lt;span class="mtk5">$&lt;/span>&lt;span class="mtk4">/'&lt;/span>&lt;span class="mtk1">, $name))&lt;/span>
&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> $name &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">"models/&lt;/span>&lt;span class="mtk1">${name}&lt;/span>&lt;span class="mtk4">"&lt;/span>&lt;span class="mtk1">;&lt;/span>
&lt;span class="mtk1"> }&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">include_once&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">"&lt;/span>&lt;span class="mtk1">${name}&lt;/span>&lt;span class="mtk4">.php"&lt;/span>&lt;span class="mtk1">;&lt;/span>
&lt;span class="mtk1">});&lt;/span>

&lt;span class="mtk1">$router &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">new&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">Router&lt;/span>&lt;span class="mtk1">();&lt;/span>
&lt;span class="mtk1">$router&lt;/span>&lt;span class="mtk5">-&amp;gt;&lt;/span>&lt;span class="mtk8">new&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'GET'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">'/'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">'CurlController@index'&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk1">$router&lt;/span>&lt;span class="mtk5">-&amp;gt;&lt;/span>&lt;span class="mtk8">new&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'POST'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">'/api/curl'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">'CurlController@execute'&lt;/span>&lt;span class="mtk1"> );&lt;/span> 

&lt;span class="mtk1">$response &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> $router&lt;/span>&lt;span class="mtk5">-&amp;gt;&lt;/span>&lt;span class="mtk8">match&lt;/span>&lt;span class="mtk1">();&lt;/span>

&lt;span class="mtk5">die&lt;/span>&lt;span class="mtk1">($response);&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>Here we only see two routes. The one that is most interesting is handled by &lt;code>CurlController.php&lt;/code>:&lt;/p></description></item><item><title>Cursed Secret Party</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/cursed-secret-party/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/cursed-secret-party/</guid><description>&lt;p>We are given this website:&lt;/p>
&lt;p>&lt;img alt="Cursed Secret Party 1" src="https://7rocky.github.io/images/other/HackTheBooCTF/Cursed-Secret-Party-1.webp">&lt;/p>
&lt;h2 id="static-code-analysis">Static code analysis&lt;/h2>
&lt;p>We are provided with the JavaScript source code of the web application, built in Node.js with Express JS. This is &lt;code>routes/index.js&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="mtk7 mtki">const&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">express&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">require&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'express'&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk7 mtki">const&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">router&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">express&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">Router&lt;/span>&lt;span class="mtk1">({ &lt;/span>&lt;span class="mtk1">caseSensitive&lt;/span>&lt;span class="mtk1">: &lt;/span>&lt;span class="mtk6">true&lt;/span>&lt;span class="mtk1"> });&lt;/span>
&lt;span class="mtk7 mtki">const&lt;/span>&lt;span class="mtk1"> AuthMiddleware &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">require&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'../middleware/AuthMiddleware'&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk7 mtki">const&lt;/span>&lt;span class="mtk1"> bot &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">require&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'../bot'&lt;/span>&lt;span class="mtk1">);&lt;/span>

&lt;span class="mtk7 mtki">let&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">db&lt;/span>&lt;span class="mtk1">;&lt;/span>

&lt;span class="mtk7 mtki">const&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">response&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">data&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">=&amp;gt;&lt;/span>&lt;span class="mtk1"> ({ &lt;/span>&lt;span class="mtk1">message&lt;/span>&lt;span class="mtk1">: &lt;/span>&lt;span class="mtk9 mtki">data&lt;/span>&lt;span class="mtk1"> });&lt;/span>

&lt;span class="mtk1">router&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">get&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'/'&lt;/span>&lt;span class="mtk1">, (&lt;/span>&lt;span class="mtk9 mtki">req&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">) &lt;/span>&lt;span class="mtk7 mtki">=&amp;gt;&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">render&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'index.html'&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk1">});&lt;/span>

&lt;span class="mtk1">router&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">post&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'/api/submit'&lt;/span>&lt;span class="mtk1">, (&lt;/span>&lt;span class="mtk9 mtki">req&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">) &lt;/span>&lt;span class="mtk7 mtki">=&amp;gt;&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">const&lt;/span>&lt;span class="mtk1"> { &lt;/span>&lt;span class="mtk1">halloween_name&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk1">email&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk1">costume_type&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk1">trick_or_treat&lt;/span>&lt;span class="mtk1"> } &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">req&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">body&lt;/span>&lt;span class="mtk1">;&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> (&lt;/span>&lt;span class="mtk1">halloween_name&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">&amp;amp;&amp;amp;&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">email&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">&amp;amp;&amp;amp;&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">costume_type&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">&amp;amp;&amp;amp;&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">trick_or_treat&lt;/span>&lt;span class="mtk1">) {&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">db&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">party_request_add&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">halloween_name&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk1">email&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk1">costume_type&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk1">trick_or_treat&lt;/span>&lt;span class="mtk1">)&lt;/span> 
&lt;span class="mtk1"> .&lt;/span>&lt;span class="mtk8">then&lt;/span>&lt;span class="mtk1">(() &lt;/span>&lt;span class="mtk7 mtki">=&amp;gt;&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">send&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk8">response&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'Your request will be reviewed by our team!'&lt;/span>&lt;span class="mtk1">));&lt;/span>

&lt;span class="mtk1"> bot.&lt;/span>&lt;span class="mtk8">visit&lt;/span>&lt;span class="mtk1">();&lt;/span>
&lt;span class="mtk1"> })&lt;/span>
&lt;span class="mtk1"> .&lt;/span>&lt;span class="mtk8">catch&lt;/span>&lt;span class="mtk1">(() &lt;/span>&lt;span class="mtk7 mtki">=&amp;gt;&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">send&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk8">response&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'Something Went Wrong!'&lt;/span>&lt;span class="mtk1">)));&lt;/span>
&lt;span class="mtk1"> }&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">status&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk6">401&lt;/span>&lt;span class="mtk1">).&lt;/span>&lt;span class="mtk8">send&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk8">response&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'Please fill out all the required fields!'&lt;/span>&lt;span class="mtk1">));&lt;/span>
&lt;span class="mtk1">});&lt;/span>

&lt;span class="mtk1">router&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">get&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'/admin'&lt;/span>&lt;span class="mtk1">, AuthMiddleware, (&lt;/span>&lt;span class="mtk9 mtki">req&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">) &lt;/span>&lt;span class="mtk7 mtki">=&amp;gt;&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> (&lt;/span>&lt;span class="mtk9 mtki">req&lt;/span>&lt;span class="mtk1">.user.user_role &lt;/span>&lt;span class="mtk5">!==&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">'admin'&lt;/span>&lt;span class="mtk1">) {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">status&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk6">401&lt;/span>&lt;span class="mtk1">).&lt;/span>&lt;span class="mtk8">send&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk8">response&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'Unautorized!'&lt;/span>&lt;span class="mtk1">));&lt;/span>
&lt;span class="mtk1"> }&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">db&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">get_party_requests&lt;/span>&lt;span class="mtk1">()&lt;/span>
&lt;span class="mtk1"> .&lt;/span>&lt;span class="mtk8">then&lt;/span>&lt;span class="mtk1">((&lt;/span>&lt;span class="mtk9 mtki">data&lt;/span>&lt;span class="mtk1">) &lt;/span>&lt;span class="mtk7 mtki">=&amp;gt;&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">render&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'admin.html'&lt;/span>&lt;span class="mtk1">, { &lt;/span>&lt;span class="mtk1">requests&lt;/span>&lt;span class="mtk1">: &lt;/span>&lt;span class="mtk9 mtki">data&lt;/span>&lt;span class="mtk1"> });&lt;/span>
&lt;span class="mtk1"> });&lt;/span>
&lt;span class="mtk1">});&lt;/span>

&lt;span class="mtk1">router&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">get&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'/admin/delete_all'&lt;/span>&lt;span class="mtk1">, AuthMiddleware, (&lt;/span>&lt;span class="mtk9 mtki">req&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">) &lt;/span>&lt;span class="mtk7 mtki">=&amp;gt;&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> (&lt;/span>&lt;span class="mtk9 mtki">req&lt;/span>&lt;span class="mtk1">.user.user_role &lt;/span>&lt;span class="mtk5">!==&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">'admin'&lt;/span>&lt;span class="mtk1">) {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">status&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk6">401&lt;/span>&lt;span class="mtk1">).&lt;/span>&lt;span class="mtk8">send&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk8">response&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'Unautorized!'&lt;/span>&lt;span class="mtk1">));&lt;/span>
&lt;span class="mtk1"> }&lt;/span>
&lt;span class="mtk1"> &lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">db&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">remove_requests&lt;/span>&lt;span class="mtk1">()&lt;/span>
&lt;span class="mtk1"> .&lt;/span>&lt;span class="mtk8">then&lt;/span>&lt;span class="mtk1">(() &lt;/span>&lt;span class="mtk7 mtki">=&amp;gt;&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">send&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk8">response&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'All records are deleted!'&lt;/span>&lt;span class="mtk1">)));&lt;/span>
&lt;span class="mtk1">})&lt;/span>

&lt;span class="mtk7 mtki">module&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk7 mtki">exports&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">database&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">=&amp;gt;&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">db&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">database&lt;/span>&lt;span class="mtk1">;&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">router&lt;/span>&lt;span class="mtk1">;&lt;/span>
&lt;span class="mtk1">};&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>We see that when we submit the above form, there will be a bot analyzing our information. This is &lt;code>bot.js&lt;/code>:&lt;/p></description></item><item><title>Didactic Octo Paddles</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/didactic-octo-paddles/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/didactic-octo-paddles/</guid><description>&lt;p>We are given a website like this:&lt;/p>
&lt;p>&lt;img alt="Didactic Octo Paddles 1" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-Didactic-Octo-Paddles-1.webp">&lt;/p>
&lt;p>We also have the source code in Node.js.&lt;/p>
&lt;h2 id="source-code-analysis">Source code analysis&lt;/h2>
&lt;p>The web application is built with Express JS. After reading some files, one that stands out is &lt;code>middlewares/AdminMiddleware.js&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="mtk7 mtki">const&lt;/span>&lt;span class="mtk1"> jwt &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">require&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"jsonwebtoken"&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk7 mtki">const&lt;/span>&lt;span class="mtk1"> { &lt;/span>&lt;span class="mtk1">tokenKey&lt;/span>&lt;span class="mtk1"> } &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">require&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"../utils/authorization"&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk7 mtki">const&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">db&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">require&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"../utils/database"&lt;/span>&lt;span class="mtk1">);&lt;/span>

&lt;span class="mtk7 mtki">const&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">AdminMiddleware&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">async&lt;/span>&lt;span class="mtk1"> (&lt;/span>&lt;span class="mtk9 mtki">req&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">next&lt;/span>&lt;span class="mtk1">) &lt;/span>&lt;span class="mtk7 mtki">=&amp;gt;&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">try&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">const&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">sessionCookie&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">req&lt;/span>&lt;span class="mtk1">.cookies.session;&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> (&lt;/span>&lt;span class="mtk5">!&lt;/span>&lt;span class="mtk1">sessionCookie&lt;/span>&lt;span class="mtk1">) {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">redirect&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"/login"&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk1"> }&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">const&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">decoded&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> jwt.&lt;/span>&lt;span class="mtk8">decode&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">sessionCookie&lt;/span>&lt;span class="mtk1">, { &lt;/span>&lt;span class="mtk1">complete&lt;/span>&lt;span class="mtk1">: &lt;/span>&lt;span class="mtk6">true&lt;/span>&lt;span class="mtk1"> });&lt;/span> 

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> (&lt;/span>&lt;span class="mtk1">decoded&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">header&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">alg&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">==&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">'none'&lt;/span>&lt;span class="mtk1">) {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">redirect&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"/login"&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk1"> } &lt;/span>&lt;span class="mtk5">else&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> (&lt;/span>&lt;span class="mtk1">decoded&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">header&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">alg&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">==&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">"HS256"&lt;/span>&lt;span class="mtk1">) {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">const&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">user&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> jwt.&lt;/span>&lt;span class="mtk8">verify&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">sessionCookie&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk1">tokenKey&lt;/span>&lt;span class="mtk1">, {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">algorithms&lt;/span>&lt;span class="mtk1">: [&lt;/span>&lt;span class="mtk1">decoded&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">header&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">alg&lt;/span>&lt;span class="mtk1">],&lt;/span>
&lt;span class="mtk1"> });&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> (&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">!&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk5">await&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">db&lt;/span>&lt;span class="mtk1">.Users.&lt;/span>&lt;span class="mtk8">findOne&lt;/span>&lt;span class="mtk1">({&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">where&lt;/span>&lt;span class="mtk1">: { &lt;/span>&lt;span class="mtk1">id&lt;/span>&lt;span class="mtk1">: &lt;/span>&lt;span class="mtk1">user&lt;/span>&lt;span class="mtk1">.id, &lt;/span>&lt;span class="mtk1">username&lt;/span>&lt;span class="mtk1">: &lt;/span>&lt;span class="mtk4">"admin"&lt;/span>&lt;span class="mtk1"> },&lt;/span>
&lt;span class="mtk1"> }))&lt;/span>
&lt;span class="mtk1"> ) {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">status&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk6">403&lt;/span>&lt;span class="mtk1">).&lt;/span>&lt;span class="mtk8">send&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"You are not an admin"&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk1"> }&lt;/span>
&lt;span class="mtk1"> } &lt;/span>&lt;span class="mtk5">else&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">const&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">user&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> jwt.&lt;/span>&lt;span class="mtk8">verify&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">sessionCookie&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk6">null&lt;/span>&lt;span class="mtk1">, {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">algorithms&lt;/span>&lt;span class="mtk1">: [&lt;/span>&lt;span class="mtk1">decoded&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">header&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">alg&lt;/span>&lt;span class="mtk1">],&lt;/span>
&lt;span class="mtk1"> });&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> (&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">!&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk5">await&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">db&lt;/span>&lt;span class="mtk1">.Users.&lt;/span>&lt;span class="mtk8">findOne&lt;/span>&lt;span class="mtk1">({&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">where&lt;/span>&lt;span class="mtk1">: { &lt;/span>&lt;span class="mtk1">id&lt;/span>&lt;span class="mtk1">: &lt;/span>&lt;span class="mtk1">user&lt;/span>&lt;span class="mtk1">.id, &lt;/span>&lt;span class="mtk1">username&lt;/span>&lt;span class="mtk1">: &lt;/span>&lt;span class="mtk4">"admin"&lt;/span>&lt;span class="mtk1"> },&lt;/span>
&lt;span class="mtk1"> }))&lt;/span>
&lt;span class="mtk1"> ) {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>
&lt;span class="mtk1"> .&lt;/span>&lt;span class="mtk8">status&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk6">403&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> .&lt;/span>&lt;span class="mtk8">send&lt;/span>&lt;span class="mtk1">({ &lt;/span>&lt;span class="mtk1">message&lt;/span>&lt;span class="mtk1">: &lt;/span>&lt;span class="mtk4">"You are not an admin"&lt;/span>&lt;span class="mtk1"> });&lt;/span>
&lt;span class="mtk1"> }&lt;/span>
&lt;span class="mtk1"> }&lt;/span>
&lt;span class="mtk1"> } &lt;/span>&lt;span class="mtk5">catch&lt;/span>&lt;span class="mtk1"> (&lt;/span>&lt;span class="mtk1">err&lt;/span>&lt;span class="mtk1">) {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">redirect&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"/login"&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk1"> }&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">next&lt;/span>&lt;span class="mtk1">();&lt;/span>
&lt;span class="mtk1">};&lt;/span>

&lt;span class="mtk1">module&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">exports&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">AdminMiddleware&lt;/span>&lt;span class="mtk1">;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>The server is using JSON Web Token (JWT) as authentication method. However, it behaves differently depending on the signing method (it varies between &lt;code>None&lt;/code> and &lt;code>HS256&lt;/code>).&lt;/p></description></item><item><title>E.Tree</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/e.tree/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/e.tree/</guid><description>&lt;p>We are given this website:&lt;/p>
&lt;p>&lt;img alt="E.Tree 1" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-E.Tree-1.webp">&lt;/p>
&lt;p>We are also given the source code of the project in Python (Flask).&lt;/p>
&lt;h2 id="source-code-analysis">Source code analysis&lt;/h2>
&lt;p>The application has three endpoints in &lt;code>blueprints/routes.py&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="mtk5">from&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">flask&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">Blueprint&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk8">render_template&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk1">request&lt;/span>
&lt;span class="mtk5">from&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">application&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8 mtku">util&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">leaderboard&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk8">search_staff&lt;/span>

&lt;span class="mtk1">web&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">Blueprint&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'web'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk1">__name__&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1">api&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">Blueprint&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'api'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk1">__name__&lt;/span>&lt;span class="mtk1">)&lt;/span>

&lt;span class="mtk8">@&lt;/span>&lt;span class="mtk1">web&lt;/span>&lt;span class="mtk8">.&lt;/span>&lt;span class="mtk8">route&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'/'&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk7 mtki">def&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">index&lt;/span>&lt;span class="mtk1">():&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">render_template&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'index.html'&lt;/span>&lt;span class="mtk1">)&lt;/span>

&lt;span class="mtk8">@&lt;/span>&lt;span class="mtk1">web&lt;/span>&lt;span class="mtk8">.&lt;/span>&lt;span class="mtk8">route&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'/leaderboard'&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk7 mtki">def&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">web_leaderboard&lt;/span>&lt;span class="mtk1">():&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">render_template&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'leaderboard.html'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">leaderboard&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk8">leaderboard&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'DSC-N-1547'&lt;/span>&lt;span class="mtk1">))&lt;/span> 
&lt;span class="mtk1"> &lt;/span>
&lt;span class="mtk8">@&lt;/span>&lt;span class="mtk1">api&lt;/span>&lt;span class="mtk8">.&lt;/span>&lt;span class="mtk8">route&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'/search'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">methods&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1">[&lt;/span>&lt;span class="mtk4">'POST'&lt;/span>&lt;span class="mtk1">])&lt;/span>
&lt;span class="mtk7 mtki">def&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">api_search&lt;/span>&lt;span class="mtk1">():&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">name&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">request&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">json&lt;/span>&lt;span class="mtk1">.get(&lt;/span>&lt;span class="mtk4">'search'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">''&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">search_staff&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">name&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>The relevant one is &lt;code>/search&lt;/code>, which calls a function &lt;code>search_staff&lt;/code> that is defined in &lt;code>util.py&lt;/code>:&lt;/p></description></item><item><title>emoji voting</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/emoji-voting/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/emoji-voting/</guid><description>&lt;p>We are given this website:&lt;/p>
&lt;p>&lt;img alt="emoji voting 1" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-emoji-voting-1.webp">&lt;/p>
&lt;p>We are also given the source code of the project in Node.js (Express).&lt;/p>
&lt;h2 id="source-code-analysis">Source code analysis&lt;/h2>
&lt;p>The available endpoints are in &lt;code>routes/index.js&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="mtk7 mtki">const&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">path&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">require&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'path'&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk7 mtki">const&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">express&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">require&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'express'&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk7 mtki">const&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">router&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">express&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">Router&lt;/span>&lt;span class="mtk1">();&lt;/span>

&lt;span class="mtk7 mtki">let&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">db&lt;/span>&lt;span class="mtk1">;&lt;/span>

&lt;span class="mtk7 mtki">const&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">response&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">data&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">=&amp;gt;&lt;/span>&lt;span class="mtk1"> ({ &lt;/span>&lt;span class="mtk1">message&lt;/span>&lt;span class="mtk1">: &lt;/span>&lt;span class="mtk9 mtki">data&lt;/span>&lt;span class="mtk1"> });&lt;/span>

&lt;span class="mtk1">router&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">get&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'/'&lt;/span>&lt;span class="mtk1">, (&lt;/span>&lt;span class="mtk9 mtki">req&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">) &lt;/span>&lt;span class="mtk7 mtki">=&amp;gt;&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">sendFile&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">path&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">resolve&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'views/index.html'&lt;/span>&lt;span class="mtk1">));&lt;/span>
&lt;span class="mtk1">});&lt;/span>

&lt;span class="mtk1">router&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">post&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'/api/vote'&lt;/span>&lt;span class="mtk1">, (&lt;/span>&lt;span class="mtk9 mtki">req&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">) &lt;/span>&lt;span class="mtk7 mtki">=&amp;gt;&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">let&lt;/span>&lt;span class="mtk1"> { &lt;/span>&lt;span class="mtk1">id&lt;/span>&lt;span class="mtk1"> } &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">req&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">body&lt;/span>&lt;span class="mtk1">;&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> (&lt;/span>&lt;span class="mtk1">id&lt;/span>&lt;span class="mtk1">) {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">db&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">vote&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">id&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> .&lt;/span>&lt;span class="mtk8">then&lt;/span>&lt;span class="mtk1">(() &lt;/span>&lt;span class="mtk7 mtki">=&amp;gt;&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">send&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk8">response&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'Successfully voted'&lt;/span>&lt;span class="mtk1">)) ;&lt;/span>
&lt;span class="mtk1"> })&lt;/span>
&lt;span class="mtk1"> .&lt;/span>&lt;span class="mtk8">catch&lt;/span>&lt;span class="mtk1">((&lt;/span>&lt;span class="mtk9 mtki">e&lt;/span>&lt;span class="mtk1">) &lt;/span>&lt;span class="mtk7 mtki">=&amp;gt;&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">send&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk8">response&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'Something went wrong'&lt;/span>&lt;span class="mtk1">));&lt;/span>
&lt;span class="mtk1"> })&lt;/span>
&lt;span class="mtk1"> }&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">send&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk8">response&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'Missing parameters'&lt;/span>&lt;span class="mtk1">));&lt;/span>
&lt;span class="mtk1">})&lt;/span>

&lt;span class="mtk1">router&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">post&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'/api/list'&lt;/span>&lt;span class="mtk1">, (&lt;/span>&lt;span class="mtk9 mtki">req&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">) &lt;/span>&lt;span class="mtk7 mtki">=&amp;gt;&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">let&lt;/span>&lt;span class="mtk1"> { &lt;/span>&lt;span class="mtk1">order&lt;/span>&lt;span class="mtk1"> } &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">req&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">body&lt;/span>&lt;span class="mtk1">;&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> (&lt;/span>&lt;span class="mtk1">order&lt;/span>&lt;span class="mtk1">) {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">db&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">getEmojis&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">order&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> .&lt;/span>&lt;span class="mtk8">then&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">data&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">=&amp;gt;&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> (&lt;/span>&lt;span class="mtk9 mtki">data&lt;/span>&lt;span class="mtk1">) {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">json&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">data&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk1"> }&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">send&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk8">response&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'Seems like there are no emojis'&lt;/span>&lt;span class="mtk1">));&lt;/span> 
&lt;span class="mtk1"> })&lt;/span>
&lt;span class="mtk1"> .&lt;/span>&lt;span class="mtk8">catch&lt;/span>&lt;span class="mtk1">((&lt;/span>&lt;span class="mtk9 mtki">e&lt;/span>&lt;span class="mtk1">) &lt;/span>&lt;span class="mtk7 mtki">=&amp;gt;&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">send&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk8">response&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'Something went wrong'&lt;/span>&lt;span class="mtk1">));&lt;/span>
&lt;span class="mtk1"> })&lt;/span>
&lt;span class="mtk1"> }&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">send&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk8">response&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'Missing parameters'&lt;/span>&lt;span class="mtk1">))&lt;/span>
&lt;span class="mtk1">}); &lt;/span>

&lt;span class="mtk7 mtki">module&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk7 mtki">exports&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">database&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">=&amp;gt;&lt;/span>&lt;span class="mtk1"> { &lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">db&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">database&lt;/span>&lt;span class="mtk1">;&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">router&lt;/span>&lt;span class="mtk1">;&lt;/span>
&lt;span class="mtk1">};&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>There are two POST endpoints that allow user input. Both of them perform certain actions on the database (&lt;code>database.js&lt;/code>):&lt;/p></description></item><item><title>ExpressionalRebel</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/expressionalrebel/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/expressionalrebel/</guid><description>&lt;p>We have a website that evaluates some given Content Security Policy (CSP) restrictions:&lt;/p>
&lt;p>&lt;img alt="CSP validator" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-ExpressionalRebel-1.webp">&lt;/p>
&lt;h2 id="source-code-analysis">Source code analysis&lt;/h2>
&lt;p>We also have the source project, which is a Node.js Express web application. We can see some routes in &lt;code>routes/api.js&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="mtk7 mtki">const&lt;/span> &lt;span class="mtk8">express&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk8">require&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'express'&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk7 mtki">const&lt;/span> &lt;span class="mtk1">router&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk8">express&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">Router&lt;/span>&lt;span class="mtk1">()&lt;/span>
&lt;span class="mtk7 mtki">const&lt;/span> &lt;span class="mtk1">{&lt;/span> &lt;span class="mtk8">evaluateCsp&lt;/span> &lt;span class="mtk1">}&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk8">require&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'../utils'&lt;/span>&lt;span class="mtk1">)&lt;/span>

&lt;span class="mtk1">router&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">post&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'/evaluate'&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk5">async&lt;/span> &lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">req&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">)&lt;/span> &lt;span class="mtk7 mtki">=&amp;gt;&lt;/span> &lt;span class="mtk1">{&lt;/span> 
 &lt;span class="mtk7 mtki">const&lt;/span> &lt;span class="mtk1">{&lt;/span> &lt;span class="mtk1">csp&lt;/span> &lt;span class="mtk1">}&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk9 mtki">req&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">body&lt;/span>
 &lt;span class="mtk5">try&lt;/span> &lt;span class="mtk1">{&lt;/span>
 &lt;span class="mtk7 mtki">const&lt;/span> &lt;span class="mtk1">cspIssues&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk5">await&lt;/span> &lt;span class="mtk8">evaluateCsp&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">csp&lt;/span>&lt;span class="mtk1">)&lt;/span>
 &lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">json&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">cspIssues&lt;/span>&lt;span class="mtk1">)&lt;/span>
 &lt;span class="mtk1">}&lt;/span> &lt;span class="mtk5">catch&lt;/span> &lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">error&lt;/span>&lt;span class="mtk1">)&lt;/span> &lt;span class="mtk1">{&lt;/span>
 &lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">status&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk6">400&lt;/span>&lt;span class="mtk1">).&lt;/span>&lt;span class="mtk8">send&lt;/span>&lt;span class="mtk1">()&lt;/span>
 &lt;span class="mtk1">}&lt;/span>
&lt;span class="mtk1">})&lt;/span>

&lt;span class="mtk1">module&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">exports&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk1">router&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>And also in &lt;code>routes/index.js&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="mtk7 mtki">const&lt;/span> &lt;span class="mtk8">express&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk8">require&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'express'&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk7 mtki">const&lt;/span> &lt;span class="mtk1">router&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk8">express&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">Router&lt;/span>&lt;span class="mtk1">()&lt;/span>
&lt;span class="mtk7 mtki">const&lt;/span> &lt;span class="mtk1">isLocal&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk8">require&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'../middleware/isLocal.middleware'&lt;/span>&lt;span class="mtk1">)&lt;/span> 
&lt;span class="mtk7 mtki">const&lt;/span> &lt;span class="mtk1">{&lt;/span> &lt;span class="mtk8">validateSecret&lt;/span> &lt;span class="mtk1">}&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk8">require&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'../utils'&lt;/span>&lt;span class="mtk1">)&lt;/span>

&lt;span class="mtk1">router&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">get&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'/'&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki squiggly-inline-unnecessary">req&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">)&lt;/span> &lt;span class="mtk7 mtki">=&amp;gt;&lt;/span> &lt;span class="mtk1">{&lt;/span>
 &lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">render&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'home'&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1">})&lt;/span>

&lt;span class="mtk1">router&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">get&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'/deactivate'&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk1">isLocal,&lt;/span> &lt;span class="mtk5">async&lt;/span> &lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">req&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">)&lt;/span> &lt;span class="mtk7 mtki">=&amp;gt;&lt;/span> &lt;span class="mtk1">{&lt;/span>
 &lt;span class="mtk7 mtki">const&lt;/span> &lt;span class="mtk1">{&lt;/span> &lt;span class="mtk1">secretCode&lt;/span> &lt;span class="mtk1">}&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk9 mtki">req&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">query&lt;/span>
 &lt;span class="mtk5">if&lt;/span> &lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">secretCode&lt;/span>&lt;span class="mtk1">)&lt;/span> &lt;span class="mtk1">{&lt;/span>
 &lt;span class="mtk7 mtki">const&lt;/span> &lt;span class="mtk1">success&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk5">await&lt;/span> &lt;span class="mtk8">validateSecret&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">secretCode&lt;/span>&lt;span class="mtk1">)&lt;/span>
 &lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">render&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'deactivate'&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk1">{&lt;/span> &lt;span class="mtk1">secretCode&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk1">success&lt;/span> &lt;span class="mtk1">})&lt;/span>
 &lt;span class="mtk1">}&lt;/span> &lt;span class="mtk5">else&lt;/span> &lt;span class="mtk1">{&lt;/span>
 &lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">render&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'deactivate'&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk1">{&lt;/span> &lt;span class="mtk1">secretCode&lt;/span> &lt;span class="mtk1">})&lt;/span>
 &lt;span class="mtk1">}&lt;/span>
&lt;span class="mtk1">})&lt;/span>

&lt;span class="mtk1">module&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">exports&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk1">router&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>There is a middleware that checks that &lt;code>/deactivate&lt;/code> is accessed from &lt;code>localhost&lt;/code>. The source file is in &lt;code>middleware/isLocal.middleware.js&lt;/code>:&lt;/p></description></item><item><title>Flag Command</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/flag-command/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/flag-command/</guid><description>&lt;p>We are given a website like this:&lt;/p>
&lt;p>&lt;img alt="Flag Command 1" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-Flag-Command-1.webp">&lt;/p>
&lt;h2 id="solution">Solution&lt;/h2>
&lt;p>It is actually a game in JavaScript, using an API to get available commands from &lt;code>/api/options&lt;/code>. If we check these, we see 4 steps, and commands for each of the steps:&lt;/p>
&lt;p>&lt;img alt="Flag Command 2" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-Flag-Command-2.webp">&lt;/p>
&lt;p>Actually, there is a secret step, so maybe we can use that command to get the flag&amp;hellip;&lt;/p>
&lt;h2 id="flag">Flag&lt;/h2>
&lt;p>And that&amp;rsquo;s it, here we have the flag:&lt;/p></description></item><item><title>Full Stack Conf</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/full-stack-conf/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/full-stack-conf/</guid><description>&lt;p>We are provided with this webpage:&lt;/p>
&lt;p>&lt;img alt="Full Stack Conf 1" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-Full-Stack-Conf-1.webp">&lt;/p>
&lt;p>At the bottom of the page we have a text input:&lt;/p>
&lt;p>&lt;img alt="Full Stack Conf 2" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-Full-Stack-Conf-2.webp">&lt;/p>
&lt;p>If we provide some data, we see a message:&lt;/p>
&lt;p>&lt;img alt="Full Stack Conf 3" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-Full-Stack-Conf-3.webp">&lt;/p>
&lt;p>However, the website tells us to pop an &lt;code>alert()&lt;/code>. This is usually a proof of concept for Cross-Site Scripting (XSS) payloads. One of the simplest payloads for XSS is:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="mtk1">&amp;lt;&lt;/span>&lt;span class="mtk5">img&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">src&lt;/span>&lt;span class="mtk1">=&lt;/span>&lt;span class="mtk4 detected-link">x&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">onerror&lt;/span>&lt;span class="mtk1">=&lt;/span>&lt;span class="mtk7">alert&lt;/span>&lt;span class="mtk4">(&lt;/span>&lt;span class="mtk6">1&lt;/span>&lt;span class="mtk4">)&lt;/span>&lt;span class="mtk1">&amp;gt;&lt;/span> 
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>If we use it, we will see the flag in the &lt;code>alert&lt;/code> (&lt;code>HTB{p0p..p0p..p0p...alert(1337)}&lt;/code>):&lt;/p></description></item><item><title>GhostlyTemplates</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/ghostlytemplates/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/ghostlytemplates/</guid><description>&lt;p>We are given the following website:&lt;/p>
&lt;p>&lt;img alt="GhostlyTemplates 1" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-GhostlyTemplates-1.webp">&lt;/p>
&lt;p>We also have the Go source code of the server.&lt;/p>
&lt;h2 id="source-code-analysis">Source code analysis&lt;/h2>
&lt;p>The relevant file is &lt;code>main.go&lt;/code>, which is a bit long:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="mtk5">package&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">main&lt;/span>

&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> (&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">"&lt;/span>&lt;span class="mtk4 detected-link">encoding/json&lt;/span>&lt;span class="mtk4">"&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">"&lt;/span>&lt;span class="mtk4 detected-link">fmt&lt;/span>&lt;span class="mtk4">"&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">"&lt;/span>&lt;span class="mtk4 detected-link">html/template&lt;/span>&lt;span class="mtk4">"&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">"&lt;/span>&lt;span class="mtk4 detected-link">io&lt;/span>&lt;span class="mtk4">"&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">"&lt;/span>&lt;span class="mtk4 detected-link">net/http&lt;/span>&lt;span class="mtk4">"&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">"&lt;/span>&lt;span class="mtk4 detected-link">os&lt;/span>&lt;span class="mtk4">"&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">"&lt;/span>&lt;span class="mtk4 detected-link">os/exec&lt;/span>&lt;span class="mtk4">"&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">"&lt;/span>&lt;span class="mtk4 detected-link">path/filepath&lt;/span>&lt;span class="mtk4">"&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">"&lt;/span>&lt;span class="mtk4 detected-link">strings&lt;/span>&lt;span class="mtk4">"&lt;/span>
&lt;span class="mtk1">)&lt;/span>

&lt;span class="mtk5">const&lt;/span>&lt;span class="mtk1"> WEB_PORT &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">"1337"&lt;/span>
&lt;span class="mtk5">const&lt;/span>&lt;span class="mtk1"> TEMPLATE_DIR &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">"./templates"&lt;/span>

&lt;span class="mtk5">type&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">LocationInfo&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">struct&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> Status &lt;/span>&lt;span class="mtk7 mtki">string&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">`json:"status"`&lt;/span>
&lt;span class="mtk1"> Country &lt;/span>&lt;span class="mtk7 mtki">string&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">`json:"country"`&lt;/span>
&lt;span class="mtk1"> CountryCode &lt;/span>&lt;span class="mtk7 mtki">string&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">`json:"countryCode"`&lt;/span>
&lt;span class="mtk1"> Region &lt;/span>&lt;span class="mtk7 mtki">string&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">`json:"region"`&lt;/span>
&lt;span class="mtk1"> RegionName &lt;/span>&lt;span class="mtk7 mtki">string&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">`json:"regionName"`&lt;/span>
&lt;span class="mtk1"> City &lt;/span>&lt;span class="mtk7 mtki">string&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">`json:"city"`&lt;/span>
&lt;span class="mtk1"> Zip &lt;/span>&lt;span class="mtk7 mtki">string&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">`json:"zip"`&lt;/span>
&lt;span class="mtk1"> Lat &lt;/span>&lt;span class="mtk7 mtki">float64&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">`json:"lat"`&lt;/span>
&lt;span class="mtk1"> Lon &lt;/span>&lt;span class="mtk7 mtki">float64&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">`json:"lon"`&lt;/span>
&lt;span class="mtk1"> Timezone &lt;/span>&lt;span class="mtk7 mtki">string&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">`json:"timezone"`&lt;/span>
&lt;span class="mtk1"> ISP &lt;/span>&lt;span class="mtk7 mtki">string&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">`json:"isp"`&lt;/span>
&lt;span class="mtk1"> Org &lt;/span>&lt;span class="mtk7 mtki">string&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">`json:"org"`&lt;/span>
&lt;span class="mtk1"> AS &lt;/span>&lt;span class="mtk7 mtki">string&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">`json:"as"`&lt;/span>
&lt;span class="mtk1"> Query &lt;/span>&lt;span class="mtk7 mtki">string&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">`json:"query"`&lt;/span>
&lt;span class="mtk1">}&lt;/span>

&lt;span class="mtk5">type&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">MachineInfo&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">struct&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> Hostname &lt;/span>&lt;span class="mtk7 mtki">string&lt;/span>
&lt;span class="mtk1"> OS &lt;/span>&lt;span class="mtk7 mtki">string&lt;/span>
&lt;span class="mtk1"> KernelVersion &lt;/span>&lt;span class="mtk7 mtki">string&lt;/span>
&lt;span class="mtk1"> Memory &lt;/span>&lt;span class="mtk7 mtki">string&lt;/span>
&lt;span class="mtk1">}&lt;/span>

&lt;span class="mtk5">type&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">RequestData&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">struct&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> ClientIP &lt;/span>&lt;span class="mtk7 mtki">string&lt;/span>
&lt;span class="mtk1"> ClientUA &lt;/span>&lt;span class="mtk7 mtki">string&lt;/span>
&lt;span class="mtk1"> ServerInfo &lt;/span>&lt;span class="mtk8 mtku">MachineInfo&lt;/span>
&lt;span class="mtk1"> ClientIpInfo &lt;/span>&lt;span class="mtk8 mtku">LocationInfo&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">`json:"location"`&lt;/span>
&lt;span class="mtk1">}&lt;/span>

&lt;span class="mtk5">func&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">GetServerInfo&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">command&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">string&lt;/span>&lt;span class="mtk1">) &lt;/span>&lt;span class="mtk7 mtki">string&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> out, err &lt;/span>&lt;span class="mtk5">:=&lt;/span>&lt;span class="mtk1"> exec.&lt;/span>&lt;span class="mtk8">Command&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"sh"&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">"-c"&lt;/span>&lt;span class="mtk1">, command).&lt;/span>&lt;span class="mtk8">Output&lt;/span>&lt;span class="mtk1">()&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> err &lt;/span>&lt;span class="mtk5">!=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk6">nil&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">""&lt;/span>
&lt;span class="mtk1"> }&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">string&lt;/span>&lt;span class="mtk1">(out)&lt;/span>
&lt;span class="mtk1">}&lt;/span>

&lt;span class="mtk5">func&lt;/span>&lt;span class="mtk1"> (&lt;/span>&lt;span class="mtk9 mtki">p &lt;/span>&lt;span class="mtk8 mtku">RequestData&lt;/span>&lt;span class="mtk1">) &lt;/span>&lt;span class="mtk8">GetLocationInfo&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">endpointURL&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">string&lt;/span>&lt;span class="mtk1">) (&lt;/span>&lt;span class="mtk5">*&lt;/span>&lt;span class="mtk8 mtku">LocationInfo&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk7 mtki">error&lt;/span>&lt;span class="mtk1">) {&lt;/span>
&lt;span class="mtk1"> resp, err &lt;/span>&lt;span class="mtk5">:=&lt;/span>&lt;span class="mtk1"> http.&lt;/span>&lt;span class="mtk8">Get&lt;/span>&lt;span class="mtk1">(endpointURL)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> err &lt;/span>&lt;span class="mtk5">!=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk6">nil&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk6">nil&lt;/span>&lt;span class="mtk1">, err&lt;/span>
&lt;span class="mtk1"> }&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">defer&lt;/span>&lt;span class="mtk1"> resp.Body.&lt;/span>&lt;span class="mtk8">Close&lt;/span>&lt;span class="mtk1">()&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> resp.StatusCode &lt;/span>&lt;span class="mtk5">!=&lt;/span>&lt;span class="mtk1"> http.StatusOK {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk6">nil&lt;/span>&lt;span class="mtk1">, fmt.&lt;/span>&lt;span class="mtk8">Errorf&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"HTTP request failed with status code: &lt;/span>&lt;span class="mtk6">%d&lt;/span>&lt;span class="mtk4">"&lt;/span>&lt;span class="mtk1">, resp.StatusCode)&lt;/span>
&lt;span class="mtk1"> }&lt;/span>

&lt;span class="mtk1"> body, err &lt;/span>&lt;span class="mtk5">:=&lt;/span>&lt;span class="mtk1"> io.&lt;/span>&lt;span class="mtk8">ReadAll&lt;/span>&lt;span class="mtk1">(resp.Body)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> err &lt;/span>&lt;span class="mtk5">!=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk6">nil&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk6">nil&lt;/span>&lt;span class="mtk1">, err&lt;/span>
&lt;span class="mtk1"> }&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">var&lt;/span>&lt;span class="mtk1"> locationInfo &lt;/span>&lt;span class="mtk8 mtku">LocationInfo&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> err &lt;/span>&lt;span class="mtk5">:=&lt;/span>&lt;span class="mtk1"> json.&lt;/span>&lt;span class="mtk8">Unmarshal&lt;/span>&lt;span class="mtk1">(body, &lt;/span>&lt;span class="mtk5">&amp;amp;&lt;/span>&lt;span class="mtk1">locationInfo); err &lt;/span>&lt;span class="mtk5">!=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk6">nil&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk6">nil&lt;/span>&lt;span class="mtk1">, err&lt;/span>
&lt;span class="mtk1"> }&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">&amp;amp;&lt;/span>&lt;span class="mtk1">locationInfo, &lt;/span>&lt;span class="mtk6">nil&lt;/span>
&lt;span class="mtk1">}&lt;/span>

&lt;span class="mtk5">func&lt;/span>&lt;span class="mtk1"> (&lt;/span>&lt;span class="mtk9 mtki">p &lt;/span>&lt;span class="mtk8 mtku">RequestData&lt;/span>&lt;span class="mtk1">) &lt;/span>&lt;span class="mtk8">IsSubdirectory&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">basePath&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">path&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">string&lt;/span>&lt;span class="mtk1">) &lt;/span>&lt;span class="mtk7 mtki">bool&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> rel, err &lt;/span>&lt;span class="mtk5">:=&lt;/span>&lt;span class="mtk1"> filepath.&lt;/span>&lt;span class="mtk8">Rel&lt;/span>&lt;span class="mtk1">(basePath, path)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> err &lt;/span>&lt;span class="mtk5">!=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk6">nil&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk6">false&lt;/span>
&lt;span class="mtk1"> }&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">!&lt;/span>&lt;span class="mtk1">strings.&lt;/span>&lt;span class="mtk8">HasPrefix&lt;/span>&lt;span class="mtk1">(rel, &lt;/span>&lt;span class="mtk4">".."&lt;/span>&lt;span class="mtk5">+&lt;/span>&lt;span class="mtk7 mtki">string&lt;/span>&lt;span class="mtk1">(filepath.Separator))&lt;/span>
&lt;span class="mtk1">}&lt;/span>

&lt;span class="mtk5">func&lt;/span>&lt;span class="mtk1"> (&lt;/span>&lt;span class="mtk9 mtki">p &lt;/span>&lt;span class="mtk8 mtku">RequestData&lt;/span>&lt;span class="mtk1">) &lt;/span>&lt;span class="mtk8">OutFileContents&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">filePath&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">string&lt;/span>&lt;span class="mtk1">) &lt;/span>&lt;span class="mtk7 mtki">string&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> data, err &lt;/span>&lt;span class="mtk5">:=&lt;/span>&lt;span class="mtk1"> os.&lt;/span>&lt;span class="mtk8">ReadFile&lt;/span>&lt;span class="mtk1">(filePath)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> err &lt;/span>&lt;span class="mtk5">!=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk6">nil&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> err.&lt;/span>&lt;span class="mtk8">Error&lt;/span>&lt;span class="mtk1">()&lt;/span>
&lt;span class="mtk1"> }&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">string&lt;/span>&lt;span class="mtk1">(data)&lt;/span>
&lt;span class="mtk1">}&lt;/span>

&lt;span class="mtk5">func&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">readRemoteFile&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">url&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">string&lt;/span>&lt;span class="mtk1">) (&lt;/span>&lt;span class="mtk7 mtki">string&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk7 mtki">error&lt;/span>&lt;span class="mtk1">) {&lt;/span>
&lt;span class="mtk1"> response, err &lt;/span>&lt;span class="mtk5">:=&lt;/span>&lt;span class="mtk1"> http.&lt;/span>&lt;span class="mtk8">Get&lt;/span>&lt;span class="mtk1">(url)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> err &lt;/span>&lt;span class="mtk5">!=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk6">nil&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">""&lt;/span>&lt;span class="mtk1">, err&lt;/span>
&lt;span class="mtk1"> }&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">defer&lt;/span>&lt;span class="mtk1"> response.Body.&lt;/span>&lt;span class="mtk8">Close&lt;/span>&lt;span class="mtk1">()&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> response.StatusCode &lt;/span>&lt;span class="mtk5">!=&lt;/span>&lt;span class="mtk1"> http.StatusOK {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">""&lt;/span>&lt;span class="mtk1">, fmt.&lt;/span>&lt;span class="mtk8">Errorf&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"HTTP request failed with status code: &lt;/span>&lt;span class="mtk6">%d&lt;/span>&lt;span class="mtk4">"&lt;/span>&lt;span class="mtk1">, response.StatusCode)&lt;/span>
&lt;span class="mtk1"> }&lt;/span>

&lt;span class="mtk1"> content, err &lt;/span>&lt;span class="mtk5">:=&lt;/span>&lt;span class="mtk1"> io.&lt;/span>&lt;span class="mtk8">ReadAll&lt;/span>&lt;span class="mtk1">(response.Body)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> err &lt;/span>&lt;span class="mtk5">!=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk6">nil&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">""&lt;/span>&lt;span class="mtk1">, err&lt;/span>
&lt;span class="mtk1"> }&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">string&lt;/span>&lt;span class="mtk1">(content), &lt;/span>&lt;span class="mtk6">nil&lt;/span>
&lt;span class="mtk1">}&lt;/span>

&lt;span class="mtk5">func&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">getIndex&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">w&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">http&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8 mtku">ResponseWriter&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">r&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">*&lt;/span>&lt;span class="mtk8 mtku">http&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8 mtku">Request&lt;/span>&lt;span class="mtk1">) {&lt;/span>
&lt;span class="mtk1"> http.&lt;/span>&lt;span class="mtk8">Redirect&lt;/span>&lt;span class="mtk1">(w, r, &lt;/span>&lt;span class="mtk4">"/view?page=index.tpl"&lt;/span>&lt;span class="mtk1">, http.StatusMovedPermanently)&lt;/span>
&lt;span class="mtk1">}&lt;/span>

&lt;span class="mtk5">func&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">getTpl&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">w&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">http&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8 mtku">ResponseWriter&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">r&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">*&lt;/span>&lt;span class="mtk8 mtku">http&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8 mtku">Request&lt;/span>&lt;span class="mtk1">) {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">var&lt;/span>&lt;span class="mtk1"> page &lt;/span>&lt;span class="mtk7 mtki">string&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> r.URL.&lt;/span>&lt;span class="mtk8">Query&lt;/span>&lt;span class="mtk1">().&lt;/span>&lt;span class="mtk8">Get&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"page"&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">var&lt;/span>&lt;span class="mtk1"> remote &lt;/span>&lt;span class="mtk7 mtki">string&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> r.URL.&lt;/span>&lt;span class="mtk8">Query&lt;/span>&lt;span class="mtk1">().&lt;/span>&lt;span class="mtk8">Get&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"remote"&lt;/span>&lt;span class="mtk1">)&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> page &lt;/span>&lt;span class="mtk5">==&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">""&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> http.&lt;/span>&lt;span class="mtk8">Error&lt;/span>&lt;span class="mtk1">(w, &lt;/span>&lt;span class="mtk4">"Missing required parameters"&lt;/span>&lt;span class="mtk1">, http.StatusBadRequest)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>
&lt;span class="mtk1"> }&lt;/span>

&lt;span class="mtk1"> reqData &lt;/span>&lt;span class="mtk5">:=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">&amp;amp;&lt;/span>&lt;span class="mtk8 mtku">RequestData&lt;/span>&lt;span class="mtk1">{}&lt;/span>

&lt;span class="mtk1"> userIPCookie, err &lt;/span>&lt;span class="mtk5">:=&lt;/span>&lt;span class="mtk1"> r.&lt;/span>&lt;span class="mtk8">Cookie&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"user_ip"&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> clientIP &lt;/span>&lt;span class="mtk5">:=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">""&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> err &lt;/span>&lt;span class="mtk5">==&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk6">nil&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> clientIP &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> userIPCookie.Value&lt;/span>
&lt;span class="mtk1"> } &lt;/span>&lt;span class="mtk5">else&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> clientIP &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> strings.&lt;/span>&lt;span class="mtk8">Split&lt;/span>&lt;span class="mtk1">(r.RemoteAddr, &lt;/span>&lt;span class="mtk4">":"&lt;/span>&lt;span class="mtk1">)[&lt;/span>&lt;span class="mtk6">0&lt;/span>&lt;span class="mtk1">]&lt;/span>
&lt;span class="mtk1"> }&lt;/span>

&lt;span class="mtk1"> userAgent &lt;/span>&lt;span class="mtk5">:=&lt;/span>&lt;span class="mtk1"> r.Header.&lt;/span>&lt;span class="mtk8">Get&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"User-Agent"&lt;/span>&lt;span class="mtk1">)&lt;/span>

&lt;span class="mtk1"> locationInfo, err &lt;/span>&lt;span class="mtk5">:=&lt;/span>&lt;span class="mtk1"> reqData.&lt;/span>&lt;span class="mtk8">GetLocationInfo&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"&lt;/span>&lt;span class="mtk4 detected-link">https://freeipapi.com/api/json/&lt;/span>&lt;span class="mtk4">"&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">+&lt;/span>&lt;span class="mtk1"> clientIP)&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> err &lt;/span>&lt;span class="mtk5">!=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk6">nil&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> http.&lt;/span>&lt;span class="mtk8">Error&lt;/span>&lt;span class="mtk1">(w, &lt;/span>&lt;span class="mtk4">"Could not fetch IP location info"&lt;/span>&lt;span class="mtk1">, http.StatusInternalServerError)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>
&lt;span class="mtk1"> }&lt;/span>

&lt;span class="mtk1"> reqData.ClientIP &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> clientIP&lt;/span>
&lt;span class="mtk1"> reqData.ClientUA &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> userAgent&lt;/span>
&lt;span class="mtk1"> reqData.ClientIpInfo &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">*&lt;/span>&lt;span class="mtk1">locationInfo&lt;/span>
&lt;span class="mtk1"> reqData.ServerInfo.Hostname &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">GetServerInfo&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"hostname"&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> reqData.ServerInfo.OS &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">GetServerInfo&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"cat /etc/os-release | grep PRETTY_NAME | cut -d '&lt;/span>&lt;span class="mtk6">\"&lt;/span>&lt;span class="mtk4">' -f 2"&lt;/span>&lt;span class="mtk1">)&lt;/span> 
&lt;span class="mtk1"> reqData.ServerInfo.KernelVersion &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">GetServerInfo&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"uname -r"&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> reqData.ServerInfo.Memory &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">GetServerInfo&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"free -h | awk '/^Mem/{print $2}'"&lt;/span>&lt;span class="mtk1">)&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">var&lt;/span>&lt;span class="mtk1"> tmplFile &lt;/span>&lt;span class="mtk7 mtki">string&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> remote &lt;/span>&lt;span class="mtk5">==&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">"true"&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> tmplFile, err &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">readRemoteFile&lt;/span>&lt;span class="mtk1">(page)&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> err &lt;/span>&lt;span class="mtk5">!=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk6">nil&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> http.&lt;/span>&lt;span class="mtk8">Error&lt;/span>&lt;span class="mtk1">(w, &lt;/span>&lt;span class="mtk4">"Internal Server Error"&lt;/span>&lt;span class="mtk1">, http.StatusInternalServerError)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>
&lt;span class="mtk1"> }&lt;/span>
&lt;span class="mtk1"> } &lt;/span>&lt;span class="mtk5">else&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">!&lt;/span>&lt;span class="mtk1">reqData.&lt;/span>&lt;span class="mtk8">IsSubdirectory&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"./"&lt;/span>&lt;span class="mtk1">, TEMPLATE_DIR&lt;/span>&lt;span class="mtk5">+&lt;/span>&lt;span class="mtk4">"/"&lt;/span>&lt;span class="mtk5">+&lt;/span>&lt;span class="mtk1">page) {&lt;/span>
&lt;span class="mtk1"> http.&lt;/span>&lt;span class="mtk8">Error&lt;/span>&lt;span class="mtk1">(w, &lt;/span>&lt;span class="mtk4">"Internal Server Error"&lt;/span>&lt;span class="mtk1">, http.StatusInternalServerError)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>
&lt;span class="mtk1"> }&lt;/span>

&lt;span class="mtk1"> tmplFile &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> reqData.&lt;/span>&lt;span class="mtk8">OutFileContents&lt;/span>&lt;span class="mtk1">(TEMPLATE_DIR &lt;/span>&lt;span class="mtk5">+&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">"/"&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">+&lt;/span>&lt;span class="mtk1"> page)&lt;/span>
&lt;span class="mtk1"> }&lt;/span>

&lt;span class="mtk1"> tmpl, err &lt;/span>&lt;span class="mtk5">:=&lt;/span>&lt;span class="mtk1"> template.&lt;/span>&lt;span class="mtk8">New&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"page"&lt;/span>&lt;span class="mtk1">).&lt;/span>&lt;span class="mtk8">Parse&lt;/span>&lt;span class="mtk1">(tmplFile)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> err &lt;/span>&lt;span class="mtk5">!=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk6">nil&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> http.&lt;/span>&lt;span class="mtk8">Error&lt;/span>&lt;span class="mtk1">(w, &lt;/span>&lt;span class="mtk4">"Internal Server Error"&lt;/span>&lt;span class="mtk1">, http.StatusInternalServerError)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>
&lt;span class="mtk1"> }&lt;/span>

&lt;span class="mtk1"> err &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> tmpl.&lt;/span>&lt;span class="mtk8">Execute&lt;/span>&lt;span class="mtk1">(w, reqData)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> err &lt;/span>&lt;span class="mtk5">!=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk6">nil&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> http.&lt;/span>&lt;span class="mtk8">Error&lt;/span>&lt;span class="mtk1">(w, &lt;/span>&lt;span class="mtk4">"Internal Server Error"&lt;/span>&lt;span class="mtk1">, http.StatusInternalServerError)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>
&lt;span class="mtk1"> }&lt;/span>
&lt;span class="mtk1">}&lt;/span>

&lt;span class="mtk5">func&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">main&lt;/span>&lt;span class="mtk1">() {&lt;/span>
&lt;span class="mtk1"> mux &lt;/span>&lt;span class="mtk5">:=&lt;/span>&lt;span class="mtk1"> http.&lt;/span>&lt;span class="mtk8">NewServeMux&lt;/span>&lt;span class="mtk1">()&lt;/span>

&lt;span class="mtk1"> mux.&lt;/span>&lt;span class="mtk8">HandleFunc&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"/"&lt;/span>&lt;span class="mtk1">, getIndex)&lt;/span>
&lt;span class="mtk1"> mux.&lt;/span>&lt;span class="mtk8">HandleFunc&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"/view"&lt;/span>&lt;span class="mtk1">, getTpl)&lt;/span>
&lt;span class="mtk1"> mux.&lt;/span>&lt;span class="mtk8">Handle&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"/static/"&lt;/span>&lt;span class="mtk1">, http.&lt;/span>&lt;span class="mtk8">StripPrefix&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"/static/"&lt;/span>&lt;span class="mtk1">, http.&lt;/span>&lt;span class="mtk8">FileServer&lt;/span>&lt;span class="mtk1">(http.&lt;/span>&lt;span class="mtk8">Dir&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"static"&lt;/span>&lt;span class="mtk1">))))&lt;/span>

&lt;span class="mtk1"> fmt.&lt;/span>&lt;span class="mtk8">Println&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"Server started at port "&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">+&lt;/span>&lt;span class="mtk1"> WEB_PORT)&lt;/span>
&lt;span class="mtk1"> http.&lt;/span>&lt;span class="mtk8">ListenAndServe&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">":"&lt;/span>&lt;span class="mtk5">+&lt;/span>&lt;span class="mtk1">WEB_PORT, mux)&lt;/span>
&lt;span class="mtk1">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>The &lt;code>main&lt;/code> function shows the available endpoints. The relevant one is &lt;code>/view&lt;/code>, which allows us to render local and remote templates.&lt;/p></description></item><item><title>Gunship</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/gunship/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/gunship/</guid><description>&lt;p>We have a website with a nice style:&lt;/p>
&lt;p>&lt;img alt="Gunship index" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-Gunship-1.webp">&lt;/p>
&lt;p>There is only one user input:&lt;/p>
&lt;p>&lt;img alt="Gunship input" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-Gunship-2.webp">&lt;/p>
&lt;p>This is a Node.js application that uses &lt;code>pug&lt;/code> as a template renderer (as shown in the available files from the challenge).&lt;/p>
&lt;p>It also uses &lt;code>flat&lt;/code> to parse JSON data, as shown in the following file called &lt;code>routes/index.js&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="mtk7 mtki">const&lt;/span> &lt;span class="mtk1">path&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk8">require&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'path'&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk7 mtki">const&lt;/span> &lt;span class="mtk8">express&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk8">require&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'express'&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk7 mtki">const&lt;/span> &lt;span class="mtk8 mtku">pug&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk8">require&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'pug'&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk7 mtki">const&lt;/span> &lt;span class="mtk1">{&lt;/span> &lt;span class="mtk8">unflatten&lt;/span> &lt;span class="mtk1">}&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk8">require&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'flat'&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk7 mtki">const&lt;/span> &lt;span class="mtk1">router&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk8">express&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">Router&lt;/span>&lt;span class="mtk1">()&lt;/span>

&lt;span class="mtk1">router&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">get&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'/'&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki squiggly-inline-unnecessary">req&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">)&lt;/span> &lt;span class="mtk7 mtki">=&amp;gt;&lt;/span> &lt;span class="mtk1">{&lt;/span>
 &lt;span class="mtk5">return&lt;/span> &lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">sendFile&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">path&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">resolve&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'views/index.html'&lt;/span>&lt;span class="mtk1">))&lt;/span>
&lt;span class="mtk1">})&lt;/span>

&lt;span class="mtk1">router&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">post&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'/api/submit'&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">req&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">)&lt;/span> &lt;span class="mtk7 mtki">=&amp;gt;&lt;/span> &lt;span class="mtk1">{&lt;/span>
 &lt;span class="mtk7 mtki">const&lt;/span> &lt;span class="mtk1">{&lt;/span> &lt;span class="mtk1">artist&lt;/span> &lt;span class="mtk1">}&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk8">unflatten&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">req&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">body&lt;/span>&lt;span class="mtk1">)&lt;/span>

 &lt;span class="mtk5">if&lt;/span> &lt;span class="mtk1">(&lt;/span>
 &lt;span class="mtk1">artist&lt;/span>&lt;span class="mtk1">.name.&lt;/span>&lt;span class="mtk8">includes&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'Haigh'&lt;/span>&lt;span class="mtk1">)&lt;/span> &lt;span class="mtk5">||&lt;/span>
 &lt;span class="mtk1">artist&lt;/span>&lt;span class="mtk1">.name.&lt;/span>&lt;span class="mtk8">includes&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'Westaway'&lt;/span>&lt;span class="mtk1">)&lt;/span> &lt;span class="mtk5">||&lt;/span>
 &lt;span class="mtk1">artist&lt;/span>&lt;span class="mtk1">.name.&lt;/span>&lt;span class="mtk8">includes&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'Gingell'&lt;/span>&lt;span class="mtk1">)&lt;/span>
 &lt;span class="mtk1">)&lt;/span> &lt;span class="mtk1">{&lt;/span>
 &lt;span class="mtk5">return&lt;/span> &lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">json&lt;/span>&lt;span class="mtk1">({&lt;/span>
 &lt;span class="mtk1">response&lt;/span>&lt;span class="mtk1">:&lt;/span> &lt;span class="mtk8 mtku">pug&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">compile&lt;/span>&lt;span class="mtk1">(&lt;/span>
 &lt;span class="mtk4">'span&lt;/span> &lt;span class="mtk4">Hello&lt;/span> &lt;span class="mtk4">#{user},&lt;/span> &lt;span class="mtk4">thank&lt;/span> &lt;span class="mtk4">you&lt;/span> &lt;span class="mtk4">for&lt;/span> &lt;span class="mtk4">letting&lt;/span> &lt;span class="mtk4">us&lt;/span> &lt;span class="mtk4">know!'&lt;/span>
 &lt;span class="mtk1">)({&lt;/span> &lt;span class="mtk1">user&lt;/span>&lt;span class="mtk1">:&lt;/span> &lt;span class="mtk4">'guest'&lt;/span> &lt;span class="mtk1">})&lt;/span>
 &lt;span class="mtk1">})&lt;/span>
 &lt;span class="mtk1">}&lt;/span>

 &lt;span class="mtk5">return&lt;/span> &lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">json&lt;/span>&lt;span class="mtk1">({&lt;/span>
 &lt;span class="mtk1">response&lt;/span>&lt;span class="mtk1">:&lt;/span> &lt;span class="mtk4">'Please&lt;/span> &lt;span class="mtk4">provide&lt;/span> &lt;span class="mtk4">us&lt;/span> &lt;span class="mtk4">with&lt;/span> &lt;span class="mtk4">the&lt;/span> &lt;span class="mtk4">full&lt;/span> &lt;span class="mtk4">name&lt;/span> &lt;span class="mtk4">of&lt;/span> &lt;span class="mtk4">an&lt;/span> &lt;span class="mtk4">existing&lt;/span> &lt;span class="mtk4">member.'&lt;/span> 
 &lt;span class="mtk1">})&lt;/span>
&lt;span class="mtk1">})&lt;/span>

&lt;span class="mtk7 mtki">module&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk7 mtki">exports&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk1">router&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>There is a well-known vulnerability of &lt;code>unflatten&lt;/code> from the &lt;code>flat&lt;/code> module. It is a Prototype Pollution vulnerability, which basically allows to define global variables.&lt;/p></description></item><item><title>HauntMart</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/hauntmart/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/hauntmart/</guid><description>&lt;p>We are given the following website:&lt;/p>
&lt;p>&lt;img alt="HauntMart 1" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-HauntMart-1.webp">&lt;/p>
&lt;p>We also have the Python source code of the server (Flask).&lt;/p>
&lt;p>First of all, we can register a new account and log in:&lt;/p>
&lt;p>&lt;img alt="HauntMart 2" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-HauntMart-2.webp">&lt;/p>
&lt;p>And we get to this dashboard:&lt;/p>
&lt;p>&lt;img alt="HauntMart 3" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-HauntMart-3.webp">&lt;/p>
&lt;p>The only functionality is &amp;ldquo;Sell Product&amp;rdquo;:&lt;/p>
&lt;p>&lt;img alt="HauntMart 4" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-HauntMart-4.webp">&lt;/p>
&lt;p>At this point, let&amp;rsquo;s analyze the source code.&lt;/p>
&lt;h2 id="source-code-analysis">Source code analysis&lt;/h2>
&lt;p>In &lt;code>blueprints/routes.py&lt;/code>, we find this endpoint that handles the previous funcionality:&lt;/p></description></item><item><title>Horror Feeds</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/horror-feeds/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/horror-feeds/</guid><description>&lt;p>We are given this website:&lt;/p>
&lt;p>&lt;img alt="Horror Feeds 1" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-Horror-Feeds-1.webp">&lt;/p>
&lt;h2 id="static-code-analysis">Static code analysis&lt;/h2>
&lt;p>We are also given the Python source code of the web application, built in Flask. Since we are dealing with a login form, let&amp;rsquo;s take a look at the database interaction (&lt;code>application/database.py&lt;/code>):&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="mtk5">from&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">colorama&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">Cursor&lt;/span>
&lt;span class="mtk5">from&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">application&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8 mtku">util&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">generate_password_hash&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk8">verify_hash&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk8">generate_token&lt;/span>
&lt;span class="mtk5">from&lt;/span>&lt;span class="mtk1"> flask_mysqldb &lt;/span>&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> MySQL&lt;/span>

&lt;span class="mtk1">mysql&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> MySQL()&lt;/span>

&lt;span class="mtk7 mtki">def&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">query_db&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">query&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">args&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1">(), &lt;/span>&lt;span class="mtk9 mtki">one&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk6">False&lt;/span>&lt;span class="mtk1">):&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">with&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">open&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'/tmp/log'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">'a'&lt;/span>&lt;span class="mtk1">) &lt;/span>&lt;span class="mtk5">as&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">f&lt;/span>&lt;span class="mtk1">:&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">f&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">write&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">query&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">+&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">'&lt;/span>&lt;span class="mtk6">\n&lt;/span>&lt;span class="mtk4">'&lt;/span>&lt;span class="mtk1">)&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">cursor&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">mysql&lt;/span>&lt;span class="mtk1">.connection.cursor()&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">cursor&lt;/span>&lt;span class="mtk1">.execute(&lt;/span>&lt;span class="mtk9 mtki">query&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">args&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">rv&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> [&lt;/span>&lt;span class="mtk8 mtku">dict&lt;/span>&lt;span class="mtk1">((&lt;/span>&lt;span class="mtk1">cursor&lt;/span>&lt;span class="mtk1">.description[&lt;/span>&lt;span class="mtk1">idx&lt;/span>&lt;span class="mtk1">][&lt;/span>&lt;span class="mtk6">0&lt;/span>&lt;span class="mtk1">], &lt;/span>&lt;span class="mtk1">value&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">for&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">idx&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk1">value&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">in&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">enumerate&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">row&lt;/span>&lt;span class="mtk1">)) &lt;/span>&lt;span class="mtk5">for&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">row&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">in&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">cursor&lt;/span>&lt;span class="mtk1">.fetchall()]&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> (&lt;/span>&lt;span class="mtk1">rv&lt;/span>&lt;span class="mtk1">[&lt;/span>&lt;span class="mtk6">0&lt;/span>&lt;span class="mtk1">] &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">rv&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">else&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk6">None&lt;/span>&lt;span class="mtk1">) &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">one&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">else&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">rv&lt;/span>


&lt;span class="mtk7 mtki">def&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">login&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">username&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">password&lt;/span>&lt;span class="mtk1">):&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">user&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">query_db&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'SELECT password FROM users WHERE username = &lt;/span>&lt;span class="mtk6">%s&lt;/span>&lt;span class="mtk4">'&lt;/span>&lt;span class="mtk1">, (&lt;/span>&lt;span class="mtk9 mtki">username&lt;/span>&lt;span class="mtk1">,), &lt;/span>&lt;span class="mtk9 mtki">one&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk6">True&lt;/span>&lt;span class="mtk1">)&lt;/span> 

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">user&lt;/span>&lt;span class="mtk1">:&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">password_check&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">verify_hash&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">password&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk1">user&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">get&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'password'&lt;/span>&lt;span class="mtk1">))&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">password_check&lt;/span>&lt;span class="mtk1">:&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">token&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">generate_token&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">username&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">token&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">else&lt;/span>&lt;span class="mtk1">:&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk6">False&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">else&lt;/span>&lt;span class="mtk1">:&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk6">False&lt;/span>

&lt;span class="mtk7 mtki">def&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">register&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">username&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">password&lt;/span>&lt;span class="mtk1">):&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">exists&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">query_db&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'SELECT * FROM users WHERE username = &lt;/span>&lt;span class="mtk6">%s&lt;/span>&lt;span class="mtk4">'&lt;/span>&lt;span class="mtk1">, (&lt;/span>&lt;span class="mtk9 mtki">username&lt;/span>&lt;span class="mtk1">,))&lt;/span>
&lt;span class="mtk1"> &lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">exists&lt;/span>&lt;span class="mtk1">:&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk6">False&lt;/span>
&lt;span class="mtk1"> &lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">hashed&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">generate_password_hash&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">password&lt;/span>&lt;span class="mtk1">)&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">query_db&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk7 mtki">f&lt;/span>&lt;span class="mtk4">'INSERT INTO users (username, password) VALUES ("&lt;/span>&lt;span class="mtk6">{&lt;/span>&lt;span class="mtk9 mtki">username&lt;/span>&lt;span class="mtk6">}&lt;/span>&lt;span class="mtk4">", "&lt;/span>&lt;span class="mtk6">{&lt;/span>&lt;span class="mtk1">hashed&lt;/span>&lt;span class="mtk6">}&lt;/span>&lt;span class="mtk4">")'&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">mysql&lt;/span>&lt;span class="mtk1">.connection.commit()&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk6">True&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>Indeed, there&amp;rsquo;s something exploitable here.&lt;/p></description></item><item><title>HTBank</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/htbank/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/htbank/</guid><description>&lt;p>We are given this website:&lt;/p>
&lt;p>&lt;img alt="HTBank 1" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-HTBank-1.webp">&lt;/p>
&lt;p>This time we don&amp;rsquo;t have source code available, so we must poke around with the website.&lt;/p>
&lt;h2 id="registering-a-new-account">Registering a new account&lt;/h2>
&lt;p>First of all, we can register a new account:&lt;/p>
&lt;p>&lt;img alt="HTBank 2" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-HTBank-2.webp">&lt;/p>
&lt;p>And then we can log in to access our dashboard:&lt;/p>
&lt;p>&lt;img alt="HTBank 3" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-HTBank-3.webp">&lt;/p>
&lt;h2 id="analyzing-javascript-files">Analyzing JavaScript files&lt;/h2>
&lt;p>We can withdraw money clicking the button:&lt;/p>
&lt;p>&lt;img alt="HTBank 4" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-HTBank-4.webp">&lt;/p>
&lt;p>But we can&amp;rsquo;t add money because the other button is not working.&lt;/p></description></item><item><title>Intergalactic Post</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/intergalactic-post/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/intergalactic-post/</guid><description>&lt;p>We are given a PHP web application with a single functionality, that is to post an email address.&lt;/p>
&lt;p>We can start by analyzing the source code. The file &lt;code>index.php&lt;/code> shows that there are only two endpoints (GET and POST):&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="mtk5">&amp;lt;?php&lt;/span>
&lt;span class="mtk7">spl_autoload_register&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk7 mtki">function&lt;/span> &lt;span class="mtk1">($name){&lt;/span>
 &lt;span class="mtk5">if&lt;/span> &lt;span class="mtk1">(&lt;/span>&lt;span class="mtk7">preg_match&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'/Controller&lt;/span>&lt;span class="mtk5">$&lt;/span>&lt;span class="mtk4">/'&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk1">$name))&lt;/span>
 &lt;span class="mtk1">{&lt;/span>
 &lt;span class="mtk1">$name&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk4">"controllers/&lt;/span>&lt;span class="mtk1">${name}&lt;/span>&lt;span class="mtk4">"&lt;/span>&lt;span class="mtk1">;&lt;/span>
 &lt;span class="mtk1">}&lt;/span>
 &lt;span class="mtk5">else&lt;/span> &lt;span class="mtk5">if&lt;/span> &lt;span class="mtk1">(&lt;/span>&lt;span class="mtk7">preg_match&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'/Model&lt;/span>&lt;span class="mtk5">$&lt;/span>&lt;span class="mtk4">/'&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk1">$name))&lt;/span>
 &lt;span class="mtk1">{&lt;/span>
 &lt;span class="mtk1">$name&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk4">"models/&lt;/span>&lt;span class="mtk1">${name}&lt;/span>&lt;span class="mtk4">"&lt;/span>&lt;span class="mtk1">;&lt;/span>
 &lt;span class="mtk1">}&lt;/span>
 &lt;span class="mtk5">include_once&lt;/span> &lt;span class="mtk4">"&lt;/span>&lt;span class="mtk1">${name}&lt;/span>&lt;span class="mtk4">.php"&lt;/span>&lt;span class="mtk1">;&lt;/span>
&lt;span class="mtk1">});&lt;/span>


&lt;span class="mtk1">$database&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk5">new&lt;/span> &lt;span class="mtk7 mtki">Database&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'/tmp/challenge.db'&lt;/span>&lt;span class="mtk1">);&lt;/span>

&lt;span class="mtk1">$router&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk5">new&lt;/span> &lt;span class="mtk7 mtki">Router&lt;/span>&lt;span class="mtk1">();&lt;/span>
&lt;span class="mtk1">$router&lt;/span>&lt;span class="mtk5">-&amp;gt;&lt;/span>&lt;span class="mtk8">new&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'GET'&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk4">'/'&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk4">'IndexController@index'&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk1">$router&lt;/span>&lt;span class="mtk5">-&amp;gt;&lt;/span>&lt;span class="mtk8">new&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'POST'&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk4">'/subscribe'&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk4">'SubsController@store'&lt;/span>&lt;span class="mtk1">);&lt;/span> 

&lt;span class="mtk5">die&lt;/span>&lt;span class="mtk1">($router&lt;/span>&lt;span class="mtk5">-&amp;gt;&lt;/span>&lt;span class="mtk8">match&lt;/span>&lt;span class="mtk1">());&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>We can see that &lt;code>Database.php&lt;/code> is vulnerable to SQL injection:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="mtk5">&amp;lt;?php&lt;/span>
&lt;span class="mtk7 mtki">class&lt;/span> &lt;span class="mtk8 mtku">Database&lt;/span>
&lt;span class="mtk1">{&lt;/span>
 &lt;span class="mtk5">private&lt;/span> &lt;span class="mtk5">static&lt;/span> &lt;span class="mtk1">$database&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk6">null&lt;/span>&lt;span class="mtk1">;&lt;/span>

 &lt;span class="mtk5">public&lt;/span> &lt;span class="mtk7 mtki">function&lt;/span> &lt;span class="mtk7">__construct&lt;/span>&lt;span class="mtk1">($file)&lt;/span>
 &lt;span class="mtk1">{&lt;/span>
 &lt;span class="mtk5">if&lt;/span> &lt;span class="mtk1">(&lt;/span>&lt;span class="mtk5">!&lt;/span>&lt;span class="mtk7">file_exists&lt;/span>&lt;span class="mtk1">($file))&lt;/span>
 &lt;span class="mtk1">{&lt;/span>
 &lt;span class="mtk7">file_put_contents&lt;/span>&lt;span class="mtk1">($file,&lt;/span> &lt;span class="mtk4">''&lt;/span>&lt;span class="mtk1">);&lt;/span>
 &lt;span class="mtk1">}&lt;/span>
 &lt;span class="mtk9">$this&lt;/span>&lt;span class="mtk5">-&amp;gt;&lt;/span>&lt;span class="mtk1">db&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk5">new&lt;/span> &lt;span class="mtk7 mtki">SQLite3&lt;/span>&lt;span class="mtk1">($file);&lt;/span>
 &lt;span class="mtk9">$this&lt;/span>&lt;span class="mtk5">-&amp;gt;&lt;/span>&lt;span class="mtk8">migrate&lt;/span>&lt;span class="mtk1">();&lt;/span>

 &lt;span class="mtk7 mtki">self&lt;/span>&lt;span class="mtk5">::&lt;/span>&lt;span class="mtk1">$database&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk9">$this&lt;/span>&lt;span class="mtk1">;&lt;/span>
 &lt;span class="mtk1">}&lt;/span>

 &lt;span class="mtk5">public&lt;/span> &lt;span class="mtk5">static&lt;/span> &lt;span class="mtk7 mtki">function&lt;/span> &lt;span class="mtk8">getDatabase&lt;/span>&lt;span class="mtk1">()&lt;/span>&lt;span class="mtk5">:&lt;/span> &lt;span class="mtk7 mtki">Database&lt;/span>
 &lt;span class="mtk1">{&lt;/span>
 &lt;span class="mtk5">return&lt;/span> &lt;span class="mtk7 mtki">self&lt;/span>&lt;span class="mtk5">::&lt;/span>&lt;span class="mtk1">$database;&lt;/span>
 &lt;span class="mtk1">}&lt;/span>

 &lt;span class="mtk5">public&lt;/span> &lt;span class="mtk7 mtki">function&lt;/span> &lt;span class="mtk8">migrate&lt;/span>&lt;span class="mtk1">()&lt;/span>
 &lt;span class="mtk1">{&lt;/span>
 &lt;span class="mtk9">$this&lt;/span>&lt;span class="mtk5">-&amp;gt;&lt;/span>&lt;span class="mtk1">db&lt;/span>&lt;span class="mtk5">-&amp;gt;&lt;/span>&lt;span class="mtk8">query&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'&lt;/span>
 &lt;span class="mtk4">CREATE&lt;/span> &lt;span class="mtk4">TABLE&lt;/span> &lt;span class="mtk4">IF&lt;/span> &lt;span class="mtk4">NOT&lt;/span> &lt;span class="mtk4">EXISTS&lt;/span> &lt;span class="mtk4">`subscribers`&lt;/span> &lt;span class="mtk4">(&lt;/span>
 &lt;span class="mtk4">id&lt;/span> &lt;span class="mtk4">INTEGER&lt;/span> &lt;span class="mtk4">PRIMARY&lt;/span> &lt;span class="mtk4">KEY&lt;/span> &lt;span class="mtk4">AUTOINCREMENT,&lt;/span>
 &lt;span class="mtk4">ip_address&lt;/span> &lt;span class="mtk4">VARCHAR(255)&lt;/span> &lt;span class="mtk4">NOT&lt;/span> &lt;span class="mtk4">NULL,&lt;/span>
 &lt;span class="mtk4">email&lt;/span> &lt;span class="mtk4">VARCHAR(255)&lt;/span> &lt;span class="mtk4">NOT&lt;/span> &lt;span class="mtk4">NULL&lt;/span>
 &lt;span class="mtk4">);&lt;/span>
 &lt;span class="mtk4">'&lt;/span>&lt;span class="mtk1">);&lt;/span>
 &lt;span class="mtk1">}&lt;/span>

 &lt;span class="mtk5">public&lt;/span> &lt;span class="mtk7 mtki">function&lt;/span> &lt;span class="mtk8">subscribeUser&lt;/span>&lt;span class="mtk1">($ip_address,&lt;/span> &lt;span class="mtk1">$email)&lt;/span>
 &lt;span class="mtk1">{&lt;/span>
 &lt;span class="mtk5">return&lt;/span> &lt;span class="mtk9">$this&lt;/span>&lt;span class="mtk5">-&amp;gt;&lt;/span>&lt;span class="mtk1">db&lt;/span>&lt;span class="mtk5">-&amp;gt;&lt;/span>&lt;span class="mtk8">exec&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"&lt;/span>&lt;span class="mtk5">INSERT&lt;/span> &lt;span class="mtk5">INTO&lt;/span> &lt;span class="mtk4">subscribers&lt;/span> &lt;span class="mtk4">(ip_address,&lt;/span> &lt;span class="mtk4">email)&lt;/span> &lt;span class="mtk5">VALUES&lt;/span>&lt;span class="mtk4">('&lt;/span>&lt;span class="mtk1">$ip_address&lt;/span>&lt;span class="mtk4">',&lt;/span> &lt;span class="mtk4">'&lt;/span>&lt;span class="mtk1">$email&lt;/span>&lt;span class="mtk4">')&lt;/span>&lt;span class="mtk4">"&lt;/span>&lt;span class="mtk1">);&lt;/span> 
 &lt;span class="mtk1">}&lt;/span>
&lt;span class="mtk1">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>This is because it is using string interpolation in PHP, so the contents of variables &lt;code>$ip_address&lt;/code> and &lt;code>$email&lt;/code> is inserted in the SQL query without sanitization:&lt;/p></description></item><item><title>Juggling facts</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/juggling-facts/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/juggling-facts/</guid><description>&lt;p>We are given this website:&lt;/p>
&lt;p>&lt;img alt="Juggling Facts 1" src="https://7rocky.github.io/images/other/HackTheBooCTF/Juggling-Facts-1.webp">&lt;/p>
&lt;h2 id="static-code-analysis">Static code analysis&lt;/h2>
&lt;p>We also have the PHP source code of the web application. The relevant part is in &lt;code>controllers/IndexController.php&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="mtk5">&amp;lt;?php&lt;/span>

&lt;span class="mtk7 mtki">class&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">IndexController&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">extends&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtki mtku">Controller&lt;/span>
&lt;span class="mtk1">{&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">public&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">function&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7">__construct&lt;/span>&lt;span class="mtk1">()&lt;/span>
&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">parent&lt;/span>&lt;span class="mtk5">::&lt;/span>&lt;span class="mtk8">__construct&lt;/span>&lt;span class="mtk1">();&lt;/span>
&lt;span class="mtk1"> }&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">public&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">function&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">index&lt;/span>&lt;span class="mtk1">($router)&lt;/span>
&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> $router&lt;/span>&lt;span class="mtk5">-&amp;gt;&lt;/span>&lt;span class="mtk8">view&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'index'&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk1"> }&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">public&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">function&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">getfacts&lt;/span>&lt;span class="mtk1">($router)&lt;/span>
&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> $jsondata &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7">json_decode&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk7">file_get_contents&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'php://input'&lt;/span>&lt;span class="mtk1">), &lt;/span>&lt;span class="mtk6">true&lt;/span>&lt;span class="mtk1">);&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> ( &lt;/span>&lt;span class="mtk7">empty&lt;/span>&lt;span class="mtk1">($jsondata) &lt;/span>&lt;span class="mtk5">||&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">!&lt;/span>&lt;span class="mtk7">array_key_exists&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'type'&lt;/span>&lt;span class="mtk1">, $jsondata))&lt;/span>
&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> $router&lt;/span>&lt;span class="mtk5">-&amp;gt;&lt;/span>&lt;span class="mtk8">jsonify&lt;/span>&lt;span class="mtk1">([&lt;/span>&lt;span class="mtk4">'message'&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&amp;gt;&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">'Insufficient parameters!'&lt;/span>&lt;span class="mtk1">]);&lt;/span>
&lt;span class="mtk1"> }&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> ($jsondata[&lt;/span>&lt;span class="mtk4">'type'&lt;/span>&lt;span class="mtk1">] &lt;/span>&lt;span class="mtk5">===&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">'secrets'&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">&amp;amp;&amp;amp;&lt;/span>&lt;span class="mtk1"> $_SERVER[&lt;/span>&lt;span class="mtk4">'REMOTE_ADDR'&lt;/span>&lt;span class="mtk1">] &lt;/span>&lt;span class="mtk5">!==&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">'127.0.0.1'&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> $router&lt;/span>&lt;span class="mtk5">-&amp;gt;&lt;/span>&lt;span class="mtk8">jsonify&lt;/span>&lt;span class="mtk1">([&lt;/span>&lt;span class="mtk4">'message'&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&amp;gt;&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">'Currently this type can be only accessed through &lt;/span>&lt;span class="mtk4">localhost!'&lt;/span>&lt;span class="mtk1">]);&lt;/span> 
&lt;span class="mtk1"> }&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">switch&lt;/span>&lt;span class="mtk1"> ($jsondata[&lt;/span>&lt;span class="mtk4">'type'&lt;/span>&lt;span class="mtk1">])&lt;/span>
&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">case&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">'secrets'&lt;/span>&lt;span class="mtk1">:&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> $router&lt;/span>&lt;span class="mtk5">-&amp;gt;&lt;/span>&lt;span class="mtk8">jsonify&lt;/span>&lt;span class="mtk1">([&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">'facts'&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&amp;gt;&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9">$this&lt;/span>&lt;span class="mtk5">-&amp;gt;&lt;/span>&lt;span class="mtk1">facts&lt;/span>&lt;span class="mtk5">-&amp;gt;&lt;/span>&lt;span class="mtk8">get_facts&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'secrets'&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> ]);&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">case&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">'spooky'&lt;/span>&lt;span class="mtk1">:&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> $router&lt;/span>&lt;span class="mtk5">-&amp;gt;&lt;/span>&lt;span class="mtk8">jsonify&lt;/span>&lt;span class="mtk1">([&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">'facts'&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&amp;gt;&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9">$this&lt;/span>&lt;span class="mtk5">-&amp;gt;&lt;/span>&lt;span class="mtk1">facts&lt;/span>&lt;span class="mtk5">-&amp;gt;&lt;/span>&lt;span class="mtk8">get_facts&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'spooky'&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> ]);&lt;/span>
&lt;span class="mtk1"> &lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">case&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">'not_spooky'&lt;/span>&lt;span class="mtk1">:&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> $router&lt;/span>&lt;span class="mtk5">-&amp;gt;&lt;/span>&lt;span class="mtk8">jsonify&lt;/span>&lt;span class="mtk1">([&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">'facts'&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&amp;gt;&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9">$this&lt;/span>&lt;span class="mtk5">-&amp;gt;&lt;/span>&lt;span class="mtk1">facts&lt;/span>&lt;span class="mtk5">-&amp;gt;&lt;/span>&lt;span class="mtk8">get_facts&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'not_spooky'&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> ]);&lt;/span>
&lt;span class="mtk1"> &lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">default&lt;/span>&lt;span class="mtk1">:&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> $router&lt;/span>&lt;span class="mtk5">-&amp;gt;&lt;/span>&lt;span class="mtk8">jsonify&lt;/span>&lt;span class="mtk1">([&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">'message'&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&amp;gt;&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">'Invalid type!'&lt;/span>
&lt;span class="mtk1"> ]);&lt;/span>
&lt;span class="mtk1"> }&lt;/span>
&lt;span class="mtk1"> }&lt;/span>
&lt;span class="mtk1">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>We are interested in executing &lt;code>$this-&amp;gt;facts-&amp;gt;get_facts('secrets')&lt;/code>, because there&amp;rsquo;s the flag (as shown in &lt;code>entrypoint.sh&lt;/code>). Moreover, to interact with &lt;code>IndexController&lt;/code>, we must use endpoint &lt;code>/api/getfacts&lt;/code>:&lt;/p></description></item><item><title>KORP Terminal</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/korp-terminal/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/korp-terminal/</guid><description>&lt;p>We are provided with this webpage:&lt;/p>
&lt;p>&lt;img alt="KORP Terminal 1" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-KORP-Terminal-1.webp">&lt;/p>
&lt;p>It only allows us to log in. We can test a random account, but it is not successful:&lt;/p>
&lt;p>&lt;img alt="KORP Terminal 2" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-KORP-Terminal-2.webp">&lt;/p>
&lt;p>&lt;img alt="KORP Terminal 3" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-KORP-Terminal-3.webp">&lt;/p>
&lt;h2 id="sql-injection">SQL injection&lt;/h2>
&lt;p>Since we don&amp;rsquo;t have any source code and we only have a login form, let&amp;rsquo;s try to inject SQL code. We can assume that the credentials are checked against a database, which is very likely to be a SQL database.&lt;/p></description></item><item><title>Kryptos Support</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/kryptos-support/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/kryptos-support/</guid><description>&lt;p>We are provided with this webpage:&lt;/p>
&lt;p>&lt;img alt="Kryptos Support 1" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-Kryptos-Support-1.webp">&lt;/p>
&lt;p>It allows us to send messages that will be reviewed by an administrator:&lt;/p>
&lt;p>&lt;img alt="Kryptos Support 2" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-Kryptos-Support-2.webp">&lt;/p>
&lt;h2 id="enumeration">Enumeration&lt;/h2>
&lt;p>Since we don&amp;rsquo;t have any source code, let&amp;rsquo;s start using &lt;code>ffuf&lt;/code> to enumerate some routes:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="code-cyan">$&lt;/span> &lt;span class="code-dark-green">ffuf&lt;/span> -w $WORDLISTS/dirbuster/directory-list-2.3-medium.txt -u http://188.166.146.25:32282/FUZZ 

&lt;span class="code-dark-green">[Status: 200, Size: 2352, Words: 1056, Lines: 53, Duration: 46ms]&lt;/span>
 * FUZZ: login

&lt;span class="code-dark-blue">[Status: 302, Size: 23, Words: 4, Lines: 1, Duration: 37ms]&lt;/span>
 * FUZZ: admin

&lt;span class="code-dark-blue">[Status: 301, Size: 179, Words: 7, Lines: 11, Duration: 39ms]&lt;/span>
 * FUZZ: static

&lt;span class="code-dark-green">[Status: 200, Size: 2352, Words: 1056, Lines: 53, Duration: 41ms]&lt;/span>
 * FUZZ: Login

&lt;span class="code-dark-blue">[Status: 302, Size: 23, Words: 4, Lines: 1, Duration: 37ms]&lt;/span>
 * FUZZ: logout

&lt;span class="code-dark-blue">[Status: 302, Size: 23, Words: 4, Lines: 1, Duration: 36ms]&lt;/span>
 * FUZZ: settings

&lt;span class="code-dark-blue">[Status: 302, Size: 23, Words: 4, Lines: 1, Duration: 39ms]&lt;/span>
 * FUZZ: tickets

&lt;span class="code-dark-blue">[Status: 302, Size: 23, Words: 4, Lines: 1, Duration: 68ms]&lt;/span>
 * FUZZ: Admin

&lt;span class="code-dark-blue">[Status: 302, Size: 23, Words: 4, Lines: 1, Duration: 39ms]&lt;/span>
 * FUZZ: Logout

&lt;span class="code-dark-blue">[Status: 301, Size: 179, Words: 7, Lines: 11, Duration: 39ms]&lt;/span>
 * FUZZ: Static

&lt;span class="code-dark-blue">[Status: 302, Size: 23, Words: 4, Lines: 1, Duration: 62ms]&lt;/span>
 * FUZZ: Tickets

&lt;span class="code-dark-blue">[Status: 302, Size: 23, Words: 4, Lines: 1, Duration: 36ms]&lt;/span>
 * FUZZ: SETTINGS

&lt;span class="code-dark-green">[Status: 200, Size: 2067, Words: 934, Lines: 54, Duration: 39ms]&lt;/span>
 * FUZZ:

&lt;span class="code-dark-red">[Status: 500, Size: 35, Words: 3, Lines: 1, Duration: 41ms]&lt;/span>
 * FUZZ: %C0

&lt;span class="code-dark-green">[Status: 200, Size: 2352, Words: 1056, Lines: 53, Duration: 41ms]&lt;/span>
 * FUZZ: LogIn

&lt;span class="code-dark-green">[Status: 200, Size: 2352, Words: 1056, Lines: 53, Duration: 42ms]&lt;/span>
 * FUZZ: LOGIN

&lt;span class="code-dark-red">[Status: 500, Size: 35, Words: 3, Lines: 1, Duration: 39ms]&lt;/span>
 * FUZZ: %CF

&lt;span class="code-dark-red">[Status: 500, Size: 35, Words: 3, Lines: 1, Duration: 40ms]&lt;/span>
 * FUZZ: %CD

&lt;span class="code-dark-red">[Status: 500, Size: 35, Words: 3, Lines: 1, Duration: 40ms]&lt;/span>
 * FUZZ: %CE

&lt;span class="code-dark-red">[Status: 500, Size: 35, Words: 3, Lines: 1, Duration: 41ms]&lt;/span>
 * FUZZ: %D8

&lt;span class="code-dark-red">[Status: 500, Size: 35, Words: 3, Lines: 1, Duration: 41ms]&lt;/span>
 * FUZZ: %CC

&lt;span class="code-dark-red">[Status: 500, Size: 35, Words: 3, Lines: 1, Duration: 42ms]&lt;/span>
 * FUZZ: %CB

&lt;span class="code-dark-red">[Status: 500, Size: 35, Words: 3, Lines: 1, Duration: 42ms]&lt;/span>
 * FUZZ: %CA

&lt;span class="code-dark-red">[Status: 500, Size: 35, Words: 3, Lines: 1, Duration: 42ms]&lt;/span>
 * FUZZ: %D0

&lt;span class="code-dark-red">[Status: 500, Size: 35, Words: 3, Lines: 1, Duration: 38ms]&lt;/span>
 * FUZZ: %D1

&lt;span class="code-dark-red">[Status: 500, Size: 35, Words: 3, Lines: 1, Duration: 36ms]&lt;/span>
 * FUZZ: %D7

&lt;span class="code-dark-red">[Status: 500, Size: 35, Words: 3, Lines: 1, Duration: 41ms]&lt;/span>
 * FUZZ: %D6

&lt;span class="code-dark-red">[Status: 500, Size: 35, Words: 3, Lines: 1, Duration: 44ms]&lt;/span>
 * FUZZ: %D5

&lt;span class="code-dark-red">[Status: 500, Size: 35, Words: 3, Lines: 1, Duration: 44ms]&lt;/span>
 * FUZZ: %D4

&lt;span class="code-dark-red">[Status: 500, Size: 35, Words: 3, Lines: 1, Duration: 37ms]&lt;/span>
 * FUZZ: %C2

&lt;span class="code-dark-red">[Status: 500, Size: 35, Words: 3, Lines: 1, Duration: 42ms]&lt;/span>
 * FUZZ: %C8

&lt;span class="code-dark-red">[Status: 500, Size: 35, Words: 3, Lines: 1, Duration: 44ms]&lt;/span>
 * FUZZ: %C9

&lt;span class="code-dark-red">[Status: 500, Size: 35, Words: 3, Lines: 1, Duration: 44ms]&lt;/span>
 * FUZZ: %C1

&lt;span class="code-dark-red">[Status: 500, Size: 35, Words: 3, Lines: 1, Duration: 48ms]&lt;/span>
 * FUZZ: %D2

&lt;span class="code-dark-red">[Status: 500, Size: 35, Words: 3, Lines: 1, Duration: 48ms]&lt;/span>
 * FUZZ: %D3

&lt;span class="code-dark-red">[Status: 500, Size: 35, Words: 3, Lines: 1, Duration: 39ms]&lt;/span>
 * FUZZ: %C6

&lt;span class="code-dark-red">[Status: 500, Size: 35, Words: 3, Lines: 1, Duration: 40ms]&lt;/span>
 * FUZZ: %C7

&lt;span class="code-dark-red">[Status: 500, Size: 35, Words: 3, Lines: 1, Duration: 38ms]&lt;/span>
 * FUZZ: %C4

&lt;span class="code-dark-red">[Status: 500, Size: 35, Words: 3, Lines: 1, Duration: 41ms]&lt;/span>
 * FUZZ: %C5

&lt;span class="code-dark-red">[Status: 500, Size: 35, Words: 3, Lines: 1, Duration: 40ms]&lt;/span>
 * FUZZ: %C3

&lt;span class="code-dark-red">[Status: 500, Size: 35, Words: 3, Lines: 1, Duration: 40ms]&lt;/span>
 * FUZZ: %D9

&lt;span class="code-dark-red">[Status: 500, Size: 35, Words: 3, Lines: 1, Duration: 39ms]&lt;/span>
 * FUZZ: %DD

&lt;span class="code-dark-red">[Status: 500, Size: 35, Words: 3, Lines: 1, Duration: 40ms]&lt;/span>
 * FUZZ: %DE

&lt;span class="code-dark-red">[Status: 500, Size: 35, Words: 3, Lines: 1, Duration: 42ms]&lt;/span>
 * FUZZ: %DF

&lt;span class="code-dark-red">[Status: 500, Size: 35, Words: 3, Lines: 1, Duration: 40ms]&lt;/span>
 * FUZZ: %DB
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>We see that we have a login page:&lt;/p></description></item><item><title>Lazy Ballot</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/lazy-ballot/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/lazy-ballot/</guid><description>&lt;p>We are given a website like this:&lt;/p>
&lt;p>&lt;img alt="Lazy Ballot 1" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-Lazy-Ballot-1.webp">&lt;/p>
&lt;p>We are also given the server source code in Node.js.&lt;/p>
&lt;h2 id="source-code-analysis">Source code analysis&lt;/h2>
&lt;p>This is &lt;code>routes/index.js&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="mtk7 mtki">const&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">express&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">require&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"express"&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk7 mtki">const&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">router&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">express&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">Router&lt;/span>&lt;span class="mtk1">({ &lt;/span>&lt;span class="mtk1">caseSensitive&lt;/span>&lt;span class="mtk1">: &lt;/span>&lt;span class="mtk6">true&lt;/span>&lt;span class="mtk1"> });&lt;/span>
&lt;span class="mtk7 mtki">const&lt;/span>&lt;span class="mtk1"> AuthMiddleware &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">require&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"../middleware/auth"&lt;/span>&lt;span class="mtk1">);&lt;/span>

&lt;span class="mtk7 mtki">let&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">db&lt;/span>&lt;span class="mtk1">;&lt;/span>
&lt;span class="mtk7 mtki">const&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">response&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> (&lt;/span>&lt;span class="mtk9 mtki">data&lt;/span>&lt;span class="mtk1">) &lt;/span>&lt;span class="mtk7 mtki">=&amp;gt;&lt;/span>&lt;span class="mtk1"> ({ &lt;/span>&lt;span class="mtk1">resp&lt;/span>&lt;span class="mtk1">: &lt;/span>&lt;span class="mtk9 mtki">data&lt;/span>&lt;span class="mtk1"> });&lt;/span>

&lt;span class="mtk1">router&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">get&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"/"&lt;/span>&lt;span class="mtk1">, (&lt;/span>&lt;span class="mtk9 mtki">req&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">) &lt;/span>&lt;span class="mtk7 mtki">=&amp;gt;&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">render&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"index.pug"&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk1">});&lt;/span>

&lt;span class="mtk1">router&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">get&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"/login"&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk5">async&lt;/span>&lt;span class="mtk1"> (&lt;/span>&lt;span class="mtk9 mtki">req&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">) &lt;/span>&lt;span class="mtk7 mtki">=&amp;gt;&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> (&lt;/span>&lt;span class="mtk9 mtki">req&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">session&lt;/span>&lt;span class="mtk1">.authenticated) {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">redirect&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"/dashboard"&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk1"> }&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">render&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"login.pug"&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk1">});&lt;/span>

&lt;span class="mtk1">router&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">get&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"/logout"&lt;/span>&lt;span class="mtk1">, (&lt;/span>&lt;span class="mtk9 mtki">req&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">) &lt;/span>&lt;span class="mtk7 mtki">=&amp;gt;&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">req&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">session&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">destroy&lt;/span>&lt;span class="mtk1">();&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">redirect&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"/"&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk1">});&lt;/span>

&lt;span class="mtk1">router&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">get&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"/dashboard"&lt;/span>&lt;span class="mtk1">, AuthMiddleware, &lt;/span>&lt;span class="mtk5">async&lt;/span>&lt;span class="mtk1"> (&lt;/span>&lt;span class="mtk9 mtki">req&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">) &lt;/span>&lt;span class="mtk7 mtki">=&amp;gt;&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">render&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"panel.pug"&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk1">});&lt;/span>

&lt;span class="mtk1">router&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">get&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"/api/votes/list"&lt;/span>&lt;span class="mtk1">, AuthMiddleware, &lt;/span>&lt;span class="mtk5">async&lt;/span>&lt;span class="mtk1"> (&lt;/span>&lt;span class="mtk9 mtki">req&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">) &lt;/span>&lt;span class="mtk7 mtki">=&amp;gt;&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">const&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">allVotes&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">await&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">db&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">listVotes&lt;/span>&lt;span class="mtk1">();&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">send&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk8">response&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">allVotes&lt;/span>&lt;span class="mtk1">));&lt;/span>
&lt;span class="mtk1">});&lt;/span>

&lt;span class="mtk1">router&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">post&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"/api/login"&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk5">async&lt;/span>&lt;span class="mtk1"> (&lt;/span>&lt;span class="mtk9 mtki">req&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">) &lt;/span>&lt;span class="mtk7 mtki">=&amp;gt;&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">const&lt;/span>&lt;span class="mtk1"> { &lt;/span>&lt;span class="mtk1">username&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk1">password&lt;/span>&lt;span class="mtk1"> } &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">req&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">body&lt;/span>&lt;span class="mtk1">;&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> (&lt;/span>&lt;span class="mtk5">!&lt;/span>&lt;span class="mtk1">username&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">||&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">!&lt;/span>&lt;span class="mtk1">password&lt;/span>&lt;span class="mtk1">) {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">status&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk6">403&lt;/span>&lt;span class="mtk1">).&lt;/span>&lt;span class="mtk8">send&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk8">response&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"Missing parameters"&lt;/span>&lt;span class="mtk1">));&lt;/span>
&lt;span class="mtk1"> }&lt;/span>
&lt;span class="mtk1"> &lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> (&lt;/span>&lt;span class="mtk5">!await&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">db&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">loginUser&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">username&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk1">password&lt;/span>&lt;span class="mtk1">)) {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">status&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk6">403&lt;/span>&lt;span class="mtk1">).&lt;/span>&lt;span class="mtk8">send&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk8">response&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"Invalid username or password"&lt;/span>&lt;span class="mtk1">));&lt;/span> 
&lt;span class="mtk1"> }&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">req&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">session&lt;/span>&lt;span class="mtk1">.authenticated &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk6">true&lt;/span>&lt;span class="mtk1">;&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">send&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk8">response&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"User authenticated successfully"&lt;/span>&lt;span class="mtk1">));&lt;/span>
&lt;span class="mtk1">});&lt;/span>

&lt;span class="mtk7 mtki">module&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk7 mtki">exports&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> (&lt;/span>&lt;span class="mtk9 mtki">database&lt;/span>&lt;span class="mtk1">) &lt;/span>&lt;span class="mtk7 mtki">=&amp;gt;&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">db&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">database&lt;/span>&lt;span class="mtk1">;&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">router&lt;/span>&lt;span class="mtk1">;&lt;/span>
&lt;span class="mtk1">};&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>As can be seen, we have a login form:&lt;/p></description></item><item><title>Letter Dispair</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/letter-dispair/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/letter-dispair/</guid><description>&lt;p>We are provided with this webpage:&lt;/p>
&lt;p>&lt;img alt="Letter Dispair 1" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-Letter-Dispair-1.webp">&lt;/p>
&lt;p>It shows a directory listing. If we go to &lt;code>/mailer.php&lt;/code> we will have this website to send emails:&lt;/p>
&lt;p>&lt;img alt="Letter Dispair 2" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-Letter-Dispair-2.webp">&lt;/p>
&lt;p>The &lt;code>mailer.zip&lt;/code> file contains the &lt;code>mailer.php&lt;/code> source code. It is quite large to insert it here.&lt;/p>
&lt;p>The key thing is that it uses PHPMailer, which is vulnerable to &lt;a target="_blank" href="https://nvd.nist.gov/vuln/detail/CVE-2016-10033">CVE-2016-10033&lt;/a> and &lt;a target="_blank" href="https://nvd.nist.gov/vuln/detail/CVE-2016-10045">CVE-2016-10045&lt;/a>. In fact, there are public exploits like the one in &lt;a target="_blank" href="https://www.exploit-db.com/exploits/40969">www.exploit-db.com&lt;/a>.&lt;/p>
&lt;p>Basically, the exploit says to enter this payload as the email:&lt;/p></description></item><item><title>looking glass</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/looking-glass/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/looking-glass/</guid><description>&lt;p>We are provided with this webpage:&lt;/p>
&lt;p>&lt;img alt="looking glass 1" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-looking-glass-1.webp">&lt;/p>
&lt;p>There is a feature to use &lt;code>ping&lt;/code> command:&lt;/p>
&lt;p>&lt;img alt="looking glass 2" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-looking-glass-2.webp">&lt;/p>
&lt;p>The problem might be related to command injection, because probably the server does something like this:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="mtk5">&amp;lt;?php&lt;/span>
&lt;span class="mtk1">$cmd &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">'ping -c 4 '&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">.&lt;/span>&lt;span class="mtk1"> $_POST[&lt;/span>&lt;span class="mtk4">'ip_address'&lt;/span>&lt;span class="mtk1">];&lt;/span> 
&lt;span class="mtk7">system&lt;/span>&lt;span class="mtk1">($cmd);&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>Maybe not in PHP, but the concept is the same. Hence, we can try and add a semicolon to inject another system command (&lt;code>; id&lt;/code>):&lt;/p>
&lt;p>&lt;img alt="looking glass 3" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-looking-glass-3.webp">&lt;/p></description></item><item><title>LoveTok</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/lovetok/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/lovetok/</guid><description>&lt;p>We are given the following website:&lt;/p>
&lt;p>&lt;img alt="LoveTok 1" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-LoveTok-1.webp">&lt;/p>
&lt;p>We also have the PHP source code of the server.&lt;/p>
&lt;h2 id="source-code-analysis">Source code analysis&lt;/h2>
&lt;p>There is only one controller (&lt;code>controllers/TimeController.php&lt;/code>):&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="mtk5">&amp;lt;?php&lt;/span>
&lt;span class="mtk7 mtki">class&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">TimeController&lt;/span>
&lt;span class="mtk1">{&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">public&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">function&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">index&lt;/span>&lt;span class="mtk1">($router)&lt;/span>
&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> $format &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7">isset&lt;/span>&lt;span class="mtk1">($_GET[&lt;/span>&lt;span class="mtk4">'format'&lt;/span>&lt;span class="mtk1">]) &lt;/span>&lt;span class="mtk5">?&lt;/span>&lt;span class="mtk1"> $_GET[&lt;/span>&lt;span class="mtk4">'format'&lt;/span>&lt;span class="mtk1">] &lt;/span>&lt;span class="mtk5">:&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">'r'&lt;/span>&lt;span class="mtk1">;&lt;/span>
&lt;span class="mtk1"> $time &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">new&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">TimeModel&lt;/span>&lt;span class="mtk1">($format);&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> $router&lt;/span>&lt;span class="mtk5">-&amp;gt;&lt;/span>&lt;span class="mtk8">view&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'index'&lt;/span>&lt;span class="mtk1">, [&lt;/span>&lt;span class="mtk4">'time'&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&amp;gt;&lt;/span>&lt;span class="mtk1"> $time&lt;/span>&lt;span class="mtk5">-&amp;gt;&lt;/span>&lt;span class="mtk8">getTime&lt;/span>&lt;span class="mtk1">()]);&lt;/span> 
&lt;span class="mtk1"> }&lt;/span>
&lt;span class="mtk1">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>As can be seen, it takes a &lt;code>format&lt;/code> parameter and calls &lt;code>TimeModel&lt;/code> (&lt;code>models/TimeModel.php&lt;/code>):&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="mtk5">&amp;lt;?php&lt;/span>
&lt;span class="mtk7 mtki">class&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">TimeModel&lt;/span>
&lt;span class="mtk1">{&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">public&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">function&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7">__construct&lt;/span>&lt;span class="mtk1">($format)&lt;/span>
&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9">$this&lt;/span>&lt;span class="mtk5">-&amp;gt;&lt;/span>&lt;span class="mtk1">format &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7">addslashes&lt;/span>&lt;span class="mtk1">($format);&lt;/span>

&lt;span class="mtk1"> [ $d, $h, $m, $s ] &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> [ &lt;/span>&lt;span class="mtk7">rand&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk6">1&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk6">6&lt;/span>&lt;span class="mtk1">), &lt;/span>&lt;span class="mtk7">rand&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk6">1&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk6">23&lt;/span>&lt;span class="mtk1">), &lt;/span>&lt;span class="mtk7">rand&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk6">1&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk6">59&lt;/span>&lt;span class="mtk1">), &lt;/span>&lt;span class="mtk7">rand&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk6">1&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk6">69&lt;/span>&lt;span class="mtk1">) ];&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9">$this&lt;/span>&lt;span class="mtk5">-&amp;gt;&lt;/span>&lt;span class="mtk1">prediction &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">"+&lt;/span>&lt;span class="mtk1">${d}&lt;/span>&lt;span class="mtk4"> day +&lt;/span>&lt;span class="mtk1">${h}&lt;/span>&lt;span class="mtk4"> hour +&lt;/span>&lt;span class="mtk1">${m}&lt;/span>&lt;span class="mtk4"> minute +&lt;/span>&lt;span class="mtk1">${s}&lt;/span>&lt;span class="mtk4"> second"&lt;/span>&lt;span class="mtk1">;&lt;/span>
&lt;span class="mtk1"> }&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">public&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">function&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">getTime&lt;/span>&lt;span class="mtk1">()&lt;/span>
&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7">eval&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'$time = date("'&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">.&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9">$this&lt;/span>&lt;span class="mtk5">-&amp;gt;&lt;/span>&lt;span class="mtk1">format &lt;/span>&lt;span class="mtk5">.&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">'", strtotime("'&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">.&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9">$this&lt;/span>&lt;span class="mtk5">-&amp;gt;&lt;/span>&lt;span class="mtk1">prediction &lt;/span>&lt;span class="mtk5">.&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">'"));'&lt;/span>&lt;span class="mtk1">);&lt;/span> 
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7">isset&lt;/span>&lt;span class="mtk1">($time) &lt;/span>&lt;span class="mtk5">?&lt;/span>&lt;span class="mtk1"> $time &lt;/span>&lt;span class="mtk5">:&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">'Something went terribly wrong'&lt;/span>&lt;span class="mtk1">;&lt;/span>
&lt;span class="mtk1"> }&lt;/span>
&lt;span class="mtk1">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>This &lt;code>format&lt;/code> is sanitized with &lt;a target="_blank" href="https://www.php.net/manual/es/function.addslashes.php">&lt;code>addslashes&lt;/code>&lt;/a>, which escapes single quotes, double quotes, backslashes an null bytes. However, the &lt;code>getTime&lt;/code> method inserts the contents of &lt;code>format&lt;/code> inside the following PHP code:&lt;/p></description></item><item><title>Mutation Lab</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/mutation-lab/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/mutation-lab/</guid><description>&lt;p>We are given a website like this:&lt;/p>
&lt;p>&lt;img alt="Mutation Lab 1" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-Mutation-Lab-1.webp">&lt;/p>
&lt;p>We must register a new account and login to view a nice dashboard:&lt;/p>
&lt;p>&lt;img alt="Mutation Lab 2" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-Mutation-Lab-2.webp">&lt;/p>
&lt;p>The only functionality we have is to export the SVG images we see as PNG files. We can capture the request with Burp Suite:&lt;/p>
&lt;p>&lt;img alt="Mutation Lab 3" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-Mutation-Lab-3.webp">&lt;/p>
&lt;p>After some research, we can see that there is a vulnerability regarding SVG conversion that leads to Local File Read (more information at &lt;a target="_blank" href="https://security.snyk.io/vuln/SNYK-JS-CONVERTSVGCORE-1582785">security.snyk.io&lt;/a>).&lt;/p></description></item><item><title>Neonify</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/neonify/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/neonify/</guid><description>&lt;p>We have a website that allows us to introduce a message and print it as neon:&lt;/p>
&lt;p>&lt;img alt="Neonify 1" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-Neonify-1.webp">&lt;/p>
&lt;h2 id="source-code-analysis">Source code analysis&lt;/h2>
&lt;p>The source code shows a simple web application build with Ruby. This is the file &lt;code>app/controllers/neon.rb&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="mtk5">class&lt;/span> &lt;span class="mtk8 mtku">NeonControllers&lt;/span> &lt;span class="mtk8 mtki mtku">&amp;lt;&lt;/span> &lt;span class="mtk8 mtki mtku">Sinatra::Base&lt;/span>

 &lt;span class="mtk1">configure&lt;/span> &lt;span class="mtk5">do&lt;/span>
 &lt;span class="mtk1">set&lt;/span> &lt;span class="mtk6">:views&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk4">"app/views"&lt;/span>
 &lt;span class="mtk1">set&lt;/span> &lt;span class="mtk6">:public_dir&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk4">"public"&lt;/span>
 &lt;span class="mtk5">end&lt;/span>

 &lt;span class="mtk1">get&lt;/span> &lt;span class="mtk4">'/'&lt;/span> &lt;span class="mtk5">do&lt;/span>
 &lt;span class="mtk1">@neon&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk4">"Glow With The Flow"&lt;/span>
 &lt;span class="mtk1">erb&lt;/span> &lt;span class="mtk6">:'index'&lt;/span>
 &lt;span class="mtk5">end&lt;/span>

 &lt;span class="mtk1">post&lt;/span> &lt;span class="mtk4">'/'&lt;/span> &lt;span class="mtk5">do&lt;/span>
 &lt;span class="mtk5">if&lt;/span> &lt;span class="mtk1">params[&lt;/span>&lt;span class="mtk6">:neon&lt;/span>&lt;span class="mtk1">]&lt;/span> &lt;span class="mtk5">=~&lt;/span> &lt;span class="mtk4">/^[0-9a-z&lt;/span> &lt;span class="mtk4">]+$/i&lt;/span>
 &lt;span class="mtk1">@neon&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk7 mtki">ERB&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk5">new&lt;/span>&lt;span class="mtk1">(params[&lt;/span>&lt;span class="mtk6">:neon&lt;/span>&lt;span class="mtk1">]).&lt;/span>&lt;span class="mtk8">result&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk7">binding&lt;/span>&lt;span class="mtk1">)&lt;/span> 
 &lt;span class="mtk5">else&lt;/span>
 &lt;span class="mtk1">@neon&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk4">"Malicious Input Detected"&lt;/span>
 &lt;span class="mtk5">end&lt;/span>
 &lt;span class="mtk1">erb&lt;/span> &lt;span class="mtk6">:'index'&lt;/span>
 &lt;span class="mtk5">end&lt;/span>

&lt;span class="mtk5">end&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>The server applies a validation over the text we want to print as neon. A regular expression (RegEx) is used so that it only accepts numbers, letters and white space (&lt;code>/^[0-9a-z ]+$/i&lt;/code>).&lt;/p></description></item><item><title>Orbital</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/orbital/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/orbital/</guid><description>&lt;p>We are given a website like this:&lt;/p>
&lt;p>&lt;img alt="Orbital 1" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-Orbital-1.webp">&lt;/p>
&lt;p>We also have the source code in Python.&lt;/p>
&lt;h2 id="source-code-analysis">Source code analysis&lt;/h2>
&lt;p>The web application is built with Flask. A clear SQL injection (SQLi) vulnerability can be found at &lt;code>database.py&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="mtk5">from&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">colorama&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">Cursor&lt;/span>
&lt;span class="mtk5">from&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">application&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8 mtku">util&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">createJWT&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk8">passwordVerify&lt;/span>
&lt;span class="mtk5">from&lt;/span>&lt;span class="mtk1"> flask_mysqldb &lt;/span>&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> MySQL&lt;/span>

&lt;span class="mtk1">mysql&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> MySQL()&lt;/span>

&lt;span class="mtk7 mtki">def&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">query&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">query&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">args&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1">(), &lt;/span>&lt;span class="mtk9 mtki">one&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk6">False&lt;/span>&lt;span class="mtk1">):&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">cursor&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">mysql&lt;/span>&lt;span class="mtk1">.connection.cursor()&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">cursor&lt;/span>&lt;span class="mtk1">.execute(&lt;/span>&lt;span class="mtk9 mtki">query&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">args&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">rv&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> [&lt;/span>&lt;span class="mtk8 mtku">dict&lt;/span>&lt;span class="mtk1">((&lt;/span>&lt;span class="mtk1">cursor&lt;/span>&lt;span class="mtk1">.description[&lt;/span>&lt;span class="mtk1">idx&lt;/span>&lt;span class="mtk1">][&lt;/span>&lt;span class="mtk6">0&lt;/span>&lt;span class="mtk1">], &lt;/span>&lt;span class="mtk1">value&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">for&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">idx&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk1">value&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">in&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">enumerate&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">row&lt;/span>&lt;span class="mtk1">)) &lt;/span>&lt;span class="mtk5">for&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">row&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">in&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">cursor&lt;/span>&lt;span class="mtk1">.fetchall()]&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> (&lt;/span>&lt;span class="mtk1">rv&lt;/span>&lt;span class="mtk1">[&lt;/span>&lt;span class="mtk6">0&lt;/span>&lt;span class="mtk1">] &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">rv&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">else&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk6">None&lt;/span>&lt;span class="mtk1">) &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">one&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">else&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">rv&lt;/span>


&lt;span class="mtk7 mtki">def&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">login&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">username&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">password&lt;/span>&lt;span class="mtk1">):&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk3"># I don't think it's not possible to bypass login &lt;/span>&lt;span class="mtk3">because I'm verifying the password later.&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">user&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">query&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk7 mtki">f&lt;/span>&lt;span class="mtk4">'SELECT username, password FROM users WHERE userna&lt;/span>&lt;span class="mtk4">me = "&lt;/span>&lt;span class="mtk6">{&lt;/span>&lt;span class="mtk9 mtki">username&lt;/span>&lt;span class="mtk6">}&lt;/span>&lt;span class="mtk4">"'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">one&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk6">True&lt;/span>&lt;span class="mtk1">)&lt;/span> 

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">user&lt;/span>&lt;span class="mtk1">:&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">passwordCheck&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">passwordVerify&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">user&lt;/span>&lt;span class="mtk1">[&lt;/span>&lt;span class="mtk4">'password'&lt;/span>&lt;span class="mtk1">], &lt;/span>&lt;span class="mtk9 mtki">password&lt;/span>&lt;span class="mtk1">)&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">passwordCheck&lt;/span>&lt;span class="mtk1">:&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">token&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">createJWT&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">user&lt;/span>&lt;span class="mtk1">[&lt;/span>&lt;span class="mtk4">'username'&lt;/span>&lt;span class="mtk1">])&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">token&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">else&lt;/span>&lt;span class="mtk1">:&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk6">False&lt;/span>

&lt;span class="mtk7 mtki">def&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">getCommunication&lt;/span>&lt;span class="mtk1">():&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">query&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'SELECT * from communication'&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>Moreover, the password is verified against a MD5 hash:&lt;/p></description></item><item><title>Passman</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/passman/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/passman/</guid><description>&lt;p>We are given a website like this:&lt;/p>
&lt;p>&lt;img alt="Passman 1" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-Passman-1.webp">&lt;/p>
&lt;p>We also have the source code in Node.js.&lt;/p>
&lt;h2 id="source-code-analysis">Source code analysis&lt;/h2>
&lt;p>The web application is built with Express JS. A relevant file is &lt;code>routes/index.js&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="mtk7 mtki">const&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">express&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">require&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'express'&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk7 mtki">const&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">router&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">express&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">Router&lt;/span>&lt;span class="mtk1">();&lt;/span>
&lt;span class="mtk7 mtki">const&lt;/span>&lt;span class="mtk1"> { graphqlHTTP } &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">require&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'express-graphql'&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk7 mtki">const&lt;/span>&lt;span class="mtk1"> AuthMiddleware &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">require&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'../middleware/AuthMiddleware'&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk7 mtki">const&lt;/span>&lt;span class="mtk1"> GraphqlSchema &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">require&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'../helpers/GraphqlHelper'&lt;/span>&lt;span class="mtk1">);&lt;/span>

&lt;span class="mtk1">router&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">get&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'/'&lt;/span>&lt;span class="mtk1">, (&lt;/span>&lt;span class="mtk9 mtki">req&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">) &lt;/span>&lt;span class="mtk7 mtki">=&amp;gt;&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">render&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'login.html'&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk1">});&lt;/span>

&lt;span class="mtk1">router&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">get&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'/register'&lt;/span>&lt;span class="mtk1">, (&lt;/span>&lt;span class="mtk9 mtki">req&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">) &lt;/span>&lt;span class="mtk7 mtki">=&amp;gt;&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">render&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'register.html'&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk1">});&lt;/span>

&lt;span class="mtk1">router&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">use&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'/graphql'&lt;/span>&lt;span class="mtk1">, AuthMiddleware, &lt;/span>&lt;span class="mtk8">graphqlHTTP&lt;/span>&lt;span class="mtk1">({&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">schema&lt;/span>&lt;span class="mtk1">: GraphqlSchema,&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">graphiql&lt;/span>&lt;span class="mtk1">: &lt;/span>&lt;span class="mtk6">false&lt;/span>
&lt;span class="mtk1">}));&lt;/span>

&lt;span class="mtk1">router&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">get&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'/dashboard'&lt;/span>&lt;span class="mtk1">, AuthMiddleware, &lt;/span>&lt;span class="mtk5">async&lt;/span>&lt;span class="mtk1"> (&lt;/span>&lt;span class="mtk9 mtki">req&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk8">next&lt;/span>&lt;span class="mtk1">) &lt;/span>&lt;span class="mtk7 mtki">=&amp;gt;&lt;/span>&lt;span class="mtk1"> {&lt;/span> 
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">render&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'dashboard.html'&lt;/span>&lt;span class="mtk1">, {&lt;/span>&lt;span class="mtk1">user&lt;/span>&lt;span class="mtk1">: &lt;/span>&lt;span class="mtk9 mtki">req&lt;/span>&lt;span class="mtk1">.user});&lt;/span>
&lt;span class="mtk1">});&lt;/span>

&lt;span class="mtk1">router&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">get&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'/logout'&lt;/span>&lt;span class="mtk1">, (&lt;/span>&lt;span class="mtk9 mtki">req&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">) &lt;/span>&lt;span class="mtk7 mtki">=&amp;gt;&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">clearCookie&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'session'&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">redirect&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'/'&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk1">});&lt;/span>

&lt;span class="mtk7 mtki">module&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk7 mtki">exports&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> () &lt;/span>&lt;span class="mtk7 mtki">=&amp;gt;&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">router&lt;/span>&lt;span class="mtk1">;&lt;/span>
&lt;span class="mtk1">};&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>It is very interesting that it uses GraphQL to manage the interaction with the database.&lt;/p></description></item><item><title>Percetron</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/percetron/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/percetron/</guid><description>&lt;p>We are given a website where we can register and log in to have this dashboard:&lt;/p>
&lt;p>&lt;img alt="Percetron 1" src="https://7rocky.github.io/images/other/HTB%20Cyber%20Apocalypse%202024/Percetron-1.webp">&lt;/p>
&lt;p>Moreover, we are given the whole web project for analysis.&lt;/p>
&lt;h2 id="source-code-analysis">Source code analysis&lt;/h2>
&lt;p>The web server is running Express JS (Node.js). The &lt;code>index.js&lt;/code> file is quite standard, but we can see that it uses MongoDB and neo4j:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="mtk8">require&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"dotenv"&lt;/span>&lt;span class="mtk1">).&lt;/span>&lt;span class="mtk8">config&lt;/span>&lt;span class="mtk1">();&lt;/span>

&lt;span class="mtk7 mtki">const&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">path&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">require&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"path"&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk7 mtki">const&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">express&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">require&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"express"&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk7 mtki">const&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">session&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">require&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"express-session"&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk7 mtki">const&lt;/span>&lt;span class="mtk1"> mongoose &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">require&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"mongoose"&lt;/span>&lt;span class="mtk1">);&lt;/span>

&lt;span class="mtk7 mtki">const&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">Neo4jConnection&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">require&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"./util/neo4j"&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk7 mtki">const&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">MongoDBConnection&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">require&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"./util/mongo"&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk7 mtki">const&lt;/span>&lt;span class="mtk1"> { migrate } &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">require&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"./util/generic"&lt;/span>&lt;span class="mtk1">);&lt;/span>

&lt;span class="mtk7 mtki">const&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">genericRoutes&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">require&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"./routes/generic"&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk7 mtki">const&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">panelRoutes&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">require&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"./routes/panel"&lt;/span>&lt;span class="mtk1">);&lt;/span>

&lt;span class="mtk7 mtki">const&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">application&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">express&lt;/span>&lt;span class="mtk1">();&lt;/span>
&lt;span class="mtk7 mtki">const&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">neo4j&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">new&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">Neo4jConnection&lt;/span>&lt;span class="mtk1">();&lt;/span>
&lt;span class="mtk7 mtki">const&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">mongodb&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">new&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">MongoDBConnection&lt;/span>&lt;span class="mtk1">();&lt;/span>

&lt;span class="mtk1">application&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">use&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"/static"&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk8">express&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">static&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">path&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">join&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">__dirname&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">"static"&lt;/span>&lt;span class="mtk1">)));&lt;/span> 

&lt;span class="mtk1">application&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">use&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk8">express&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">urlencoded&lt;/span>&lt;span class="mtk1">({ &lt;/span>&lt;span class="mtk1">extended&lt;/span>&lt;span class="mtk1">: &lt;/span>&lt;span class="mtk6">true&lt;/span>&lt;span class="mtk1"> }));&lt;/span>
&lt;span class="mtk1">application&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">use&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk8">express&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">json&lt;/span>&lt;span class="mtk1">());&lt;/span>

&lt;span class="mtk1">application&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">use&lt;/span>&lt;span class="mtk1">(&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">session&lt;/span>&lt;span class="mtk1">({&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">secret&lt;/span>&lt;span class="mtk1">: &lt;/span>&lt;span class="mtk1">process&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">env&lt;/span>&lt;span class="mtk1">.SESSION_SECRET,&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">resave&lt;/span>&lt;span class="mtk1">: &lt;/span>&lt;span class="mtk6">true&lt;/span>&lt;span class="mtk1">,&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">saveUninitialized&lt;/span>&lt;span class="mtk1">: &lt;/span>&lt;span class="mtk6">true&lt;/span>&lt;span class="mtk1">,&lt;/span>
&lt;span class="mtk1"> })&lt;/span>
&lt;span class="mtk1">);&lt;/span>

&lt;span class="mtk1">application&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">set&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"view engine"&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">"pug"&lt;/span>&lt;span class="mtk1">);&lt;/span>

&lt;span class="mtk1">application&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">use&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">genericRoutes&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk1">application&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">use&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">panelRoutes&lt;/span>&lt;span class="mtk1">);&lt;/span>

&lt;span class="mtk7">setTimeout&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk5">async&lt;/span>&lt;span class="mtk1"> () &lt;/span>&lt;span class="mtk7 mtki">=&amp;gt;&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">await&lt;/span>&lt;span class="mtk1"> mongoose.&lt;/span>&lt;span class="mtk8">connect&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">process&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">env&lt;/span>&lt;span class="mtk1">.MONGODB_URL);&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">await&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">migrate&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">neo4j&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk1">mongodb&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">await&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">application&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">listen&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk6">3000&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">"0.0.0.0"&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">console&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">log&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"Listening on port 3000"&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk1">}, &lt;/span>&lt;span class="mtk6">10000&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>MongoDB is used for user authentication and authorization, using &lt;code>mongoose&lt;/code>. This is the only model we have:&lt;/p></description></item><item><title>PumpkinSpice</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/pumpkinspice/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/pumpkinspice/</guid><description>&lt;p>We are given the following website:&lt;/p>
&lt;p>&lt;img alt="PumpkinSpice 1" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-PumpkinSpice-1.webp">&lt;/p>
&lt;p>We also have the Python source code of the server (Flask).&lt;/p>
&lt;h2 id="source-code-analysis">Source code analysis&lt;/h2>
&lt;p>The relevant file is &lt;code>app.py&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">string&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk8 mtku">time&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk8 mtku">subprocess&lt;/span>
&lt;span class="mtk5">from&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">flask&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">Flask&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk1">request&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk8">render_template&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk8">abort&lt;/span>
&lt;span class="mtk5">from&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">threading&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">Thread&lt;/span>

&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">Flask&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">__name__&lt;/span>&lt;span class="mtk1">)&lt;/span>

&lt;span class="mtk1">addresses&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> []&lt;/span>

&lt;span class="mtk7 mtki">def&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">start_bot&lt;/span>&lt;span class="mtk1">():&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">from&lt;/span>&lt;span class="mtk1"> selenium &lt;/span>&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> webdriver&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">from&lt;/span>&lt;span class="mtk1"> selenium.webdriver.chrome.options &lt;/span>&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> Options&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">from&lt;/span>&lt;span class="mtk1"> selenium.webdriver.chrome.service &lt;/span>&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> Service&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">from&lt;/span>&lt;span class="mtk1"> selenium.webdriver.support.ui &lt;/span>&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">WebDriverWait&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">host&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk1">port&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">"localhost"&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk6">1337&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">HOST&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">f&lt;/span>&lt;span class="mtk4">"&lt;/span>&lt;span class="mtk4 detected-link">http://&lt;/span>&lt;span class="mtk6 detected-link">{&lt;/span>&lt;span class="mtk1 detected-link">host&lt;/span>&lt;span class="mtk6">}&lt;/span>&lt;span class="mtk4">:&lt;/span>&lt;span class="mtk6">{&lt;/span>&lt;span class="mtk1">port&lt;/span>&lt;span class="mtk6">}&lt;/span>&lt;span class="mtk4">"&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">options&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> Options()&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">options&lt;/span>&lt;span class="mtk1">.add_argument(&lt;/span>&lt;span class="mtk4">"--headless"&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">options&lt;/span>&lt;span class="mtk1">.add_argument(&lt;/span>&lt;span class="mtk4">"--no-sandbox"&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">options&lt;/span>&lt;span class="mtk1">.add_argument(&lt;/span>&lt;span class="mtk4">"--disable-dev-shm-usage"&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">options&lt;/span>&lt;span class="mtk1">.add_argument(&lt;/span>&lt;span class="mtk4">"--disable-infobars"&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">options&lt;/span>&lt;span class="mtk1">.add_argument(&lt;/span>&lt;span class="mtk4">"--disable-background-networking"&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">options&lt;/span>&lt;span class="mtk1">.add_argument(&lt;/span>&lt;span class="mtk4">"--disable-default-apps"&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">options&lt;/span>&lt;span class="mtk1">.add_argument(&lt;/span>&lt;span class="mtk4">"--disable-extensions"&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">options&lt;/span>&lt;span class="mtk1">.add_argument(&lt;/span>&lt;span class="mtk4">"--disable-gpu"&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">options&lt;/span>&lt;span class="mtk1">.add_argument(&lt;/span>&lt;span class="mtk4">"--disable-sync"&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">options&lt;/span>&lt;span class="mtk1">.add_argument(&lt;/span>&lt;span class="mtk4">"--disable-translate"&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">options&lt;/span>&lt;span class="mtk1">.add_argument(&lt;/span>&lt;span class="mtk4">"--hide-scrollbars"&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">options&lt;/span>&lt;span class="mtk1">.add_argument(&lt;/span>&lt;span class="mtk4">"--metrics-recording-only"&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">options&lt;/span>&lt;span class="mtk1">.add_argument(&lt;/span>&lt;span class="mtk4">"--mute-audio"&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">options&lt;/span>&lt;span class="mtk1">.add_argument(&lt;/span>&lt;span class="mtk4">"--no-first-run"&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">options&lt;/span>&lt;span class="mtk1">.add_argument(&lt;/span>&lt;span class="mtk4">"--dns-prefetch-disable"&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">options&lt;/span>&lt;span class="mtk1">.add_argument(&lt;/span>&lt;span class="mtk4">"--safebrowsing-disable-auto-update"&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">options&lt;/span>&lt;span class="mtk1">.add_argument(&lt;/span>&lt;span class="mtk4">"--media-cache-size=1"&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">options&lt;/span>&lt;span class="mtk1">.add_argument(&lt;/span>&lt;span class="mtk4">"--disk-cache-size=1"&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">options&lt;/span>&lt;span class="mtk1">.add_argument(&lt;/span>&lt;span class="mtk4">"--user-agent=HTB/1.0"&lt;/span>&lt;span class="mtk1">)&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">service&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> Service(&lt;/span>&lt;span class="mtk9 mtki">executable_path&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk4">"/usr/bin/chromedriver"&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">browser&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> webdriver.Chrome(&lt;/span>&lt;span class="mtk9 mtki">service&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1">service&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">options&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1">options&lt;/span>&lt;span class="mtk1">)&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">browser&lt;/span>&lt;span class="mtk1">.get(&lt;/span>&lt;span class="mtk7 mtki">f&lt;/span>&lt;span class="mtk4">"&lt;/span>&lt;span class="mtk6">{&lt;/span>&lt;span class="mtk1">HOST&lt;/span>&lt;span class="mtk6">}&lt;/span>&lt;span class="mtk4">/addresses"&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">time&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">sleep&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk6">5&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">browser&lt;/span>&lt;span class="mtk1">.quit()&lt;/span>


&lt;span class="mtk8">@&lt;/span>&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk8">.&lt;/span>&lt;span class="mtk8">route&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"/"&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">methods&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1">[&lt;/span>&lt;span class="mtk4">"GET"&lt;/span>&lt;span class="mtk1">])&lt;/span>
&lt;span class="mtk7 mtki">def&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">index&lt;/span>&lt;span class="mtk1">():&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">render_template&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"index.html"&lt;/span>&lt;span class="mtk1">)&lt;/span>


&lt;span class="mtk8">@&lt;/span>&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk8">.&lt;/span>&lt;span class="mtk8">route&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"/addresses"&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">methods&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1">[&lt;/span>&lt;span class="mtk4">"GET"&lt;/span>&lt;span class="mtk1">])&lt;/span>
&lt;span class="mtk7 mtki">def&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">all_addresses&lt;/span>&lt;span class="mtk1">():&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">remote_address&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">request&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">remote_addr&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">remote_address&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">!=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">"127.0.0.1"&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">and&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">remote_address&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">!=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">"::1"&lt;/span>&lt;span class="mtk1">:&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">render_template&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"index.html"&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">message&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk4">"Only localhost allowed"&lt;/span>&lt;span class="mtk1">)&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">render_template&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"addresses.html"&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">addresses&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1">addresses&lt;/span>&lt;span class="mtk1">)&lt;/span>


&lt;span class="mtk8">@&lt;/span>&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk8">.&lt;/span>&lt;span class="mtk8">route&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"/add/address"&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">methods&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1">[&lt;/span>&lt;span class="mtk4">"POST"&lt;/span>&lt;span class="mtk1">])&lt;/span>
&lt;span class="mtk7 mtki">def&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">add_address&lt;/span>&lt;span class="mtk1">():&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">address&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">request&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">form&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">get&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"address"&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">not&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">address&lt;/span>&lt;span class="mtk1">:&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">render_template&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"index.html"&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">message&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk4">"No address provided"&lt;/span>&lt;span class="mtk1">)&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">addresses&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">append&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">address&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">Thread&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">target&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk8">start_bot&lt;/span>&lt;span class="mtk1">,).&lt;/span>&lt;span class="mtk8">start&lt;/span>&lt;span class="mtk1">()&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">render_template&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"index.html"&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">message&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk4">"Address registered"&lt;/span>&lt;span class="mtk1">)&lt;/span>


&lt;span class="mtk8">@&lt;/span>&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk8">.&lt;/span>&lt;span class="mtk8">route&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"/api/stats"&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">methods&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1">[&lt;/span>&lt;span class="mtk4">"GET"&lt;/span>&lt;span class="mtk1">])&lt;/span>
&lt;span class="mtk7 mtki">def&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">stats&lt;/span>&lt;span class="mtk1">():&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">remote_address&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">request&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">remote_addr&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">remote_address&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">!=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">"127.0.0.1"&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">and&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">remote_address&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">!=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">"::1"&lt;/span>&lt;span class="mtk1">:&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">render_template&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"index.html"&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">message&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk4">"Only localhost allowed"&lt;/span>&lt;span class="mtk1">)&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">command&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">request&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">args&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">get&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"command"&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">not&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">command&lt;/span>&lt;span class="mtk1">:&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">render_template&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"index.html"&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">message&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk4">"No command provided"&lt;/span>&lt;span class="mtk1">)&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">results&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">subprocess&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">check_output&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">command&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">shell&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk6">True&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">universal_newlines&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk6">True&lt;/span>&lt;span class="mtk1">)&lt;/span> 
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">results&lt;/span>


&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">__name__&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">==&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">"__main__"&lt;/span>&lt;span class="mtk1">:&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">run&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">host&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk4">"0.0.0.0"&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">port&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk6">1337&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">debug&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk6">False&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>We can only interact directly with &lt;code>/add/address&lt;/code>:&lt;/p></description></item><item><title>Red Island</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/red-island/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/red-island/</guid><description>&lt;p>We are given a website like this:&lt;/p>
&lt;p>&lt;img alt="Red Island 1" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-Red-Island-1.webp">&lt;/p>
&lt;p>We can register a new account and then login to see this functionality:&lt;/p>
&lt;p>&lt;img alt="Red Island 2" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-Red-Island-2.webp">&lt;/p>
&lt;p>This time we don&amp;rsquo;t have the source code for the web application, so we must find a clear vulnerability or get the source code somehow.&lt;/p>
&lt;p>We can start thinking of Server-Side Request Forgery (SSRF). As in other challenges, we know that the web server listens on port 1337, so let&amp;rsquo;s try and get &lt;code>http://127.0.0.1:1337&lt;/code>:&lt;/p></description></item><item><title>sanitize</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/sanitize/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/sanitize/</guid><description>&lt;p>We are provided with this webpage:&lt;/p>
&lt;p>&lt;img alt="sanitize 1" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-sanitize-1.webp">&lt;/p>
&lt;p>If we look into the HTML source code, we see &lt;code>/debug&lt;/code>:&lt;/p>
&lt;p>&lt;img alt="sanitize 2" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-sanitize-2.webp">&lt;/p>
&lt;p>And there we can find the source code of the web application:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="mtk5">from&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">flask&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">Flask&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk1">request&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk8">render_template&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk8 mtku">Response&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk8">url_for&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk1">g&lt;/span>
&lt;span class="mtk5">from&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">sqlite3&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">dbapi2&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">as&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">sqlite3&lt;/span>
&lt;span class="mtk5">from&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">functools&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">wraps&lt;/span>

&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">Flask&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">__name__&lt;/span>&lt;span class="mtk1">)&lt;/span>

&lt;span class="mtk7 mtki">def&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">get_db&lt;/span>&lt;span class="mtk1">():&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">db&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">getattr&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">g&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">'_database'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk6">None&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">db&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">is&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk6">None&lt;/span>&lt;span class="mtk1">:&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">db&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">g&lt;/span>&lt;span class="mtk1">._database &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">sqlite3&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">connect&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">':memory:'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">isolation_level&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk6">None&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">db&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">row_factory&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">sqlite3&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8 mtku">Row&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">with&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">app_context&lt;/span>&lt;span class="mtk1">():&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">db&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">cursor&lt;/span>&lt;span class="mtk1">().&lt;/span>&lt;span class="mtk8">execute&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'CREATE TABLE users (id INTEGER PRIMARY KEY, usern&lt;/span>&lt;span class="mtk4">ame TEXT, password TEXT);'&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">with&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">open_resource&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'schema.sql'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">mode&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk4">'r'&lt;/span>&lt;span class="mtk1">) &lt;/span>&lt;span class="mtk5">as&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">f&lt;/span>&lt;span class="mtk1">:&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">db&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">cursor&lt;/span>&lt;span class="mtk1">().&lt;/span>&lt;span class="mtk8">executescript&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">f&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">read&lt;/span>&lt;span class="mtk1">())&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">db&lt;/span>

&lt;span class="mtk8">@&lt;/span>&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk8">.&lt;/span>&lt;span class="mtk8">teardown_appcontext&lt;/span>
&lt;span class="mtk7 mtki">def&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">close_connection&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">exception&lt;/span>&lt;span class="mtk1">):&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">db&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">getattr&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">g&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">'_database'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk6">None&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">db&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">is&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">not&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk6">None&lt;/span>&lt;span class="mtk1">: &lt;/span>&lt;span class="mtk1">db&lt;/span>&lt;span class="mtk1">.close()&lt;/span>

&lt;span class="mtk7 mtki">def&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">query_db&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">query&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">args&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1">(), &lt;/span>&lt;span class="mtk9 mtki">one&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk6">False&lt;/span>&lt;span class="mtk1">):&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">try&lt;/span>&lt;span class="mtk1">:&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">with&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">app_context&lt;/span>&lt;span class="mtk1">():&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">cur&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">get_db&lt;/span>&lt;span class="mtk1">().&lt;/span>&lt;span class="mtk8">execute&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">query&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">args&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">rv&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> [&lt;/span>&lt;span class="mtk8 mtku">dict&lt;/span>&lt;span class="mtk1">((&lt;/span>&lt;span class="mtk1">cur&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">description&lt;/span>&lt;span class="mtk1">[&lt;/span>&lt;span class="mtk1">idx&lt;/span>&lt;span class="mtk1">][&lt;/span>&lt;span class="mtk6">0&lt;/span>&lt;span class="mtk1">], &lt;/span>&lt;span class="mtk1">value&lt;/span>&lt;span class="mtk1">) &lt;/span>&lt;span class="mtk5">for&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">idx&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk1">value&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">in&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">enumerate&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">row&lt;/span>&lt;span class="mtk1">)) &lt;/span>&lt;span class="mtk5">for&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">row&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">in&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">cur&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">fetchall&lt;/span>&lt;span class="mtk1">()]&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> (&lt;/span>&lt;span class="mtk1">rv&lt;/span>&lt;span class="mtk1">[&lt;/span>&lt;span class="mtk6">0&lt;/span>&lt;span class="mtk1">] &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">rv&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">else&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk6">None&lt;/span>&lt;span class="mtk1">) &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">one&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">else&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">rv&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">except&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">Exception&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">as&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">e&lt;/span>&lt;span class="mtk1">:&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">e&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk6">None&lt;/span>

&lt;span class="mtk8">@&lt;/span>&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk8">.&lt;/span>&lt;span class="mtk8">route&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'/'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">methods&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1">[&lt;/span>&lt;span class="mtk4">'GET'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">'POST'&lt;/span>&lt;span class="mtk1">])&lt;/span>
&lt;span class="mtk7 mtki">def&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">login&lt;/span>&lt;span class="mtk1">():&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">request&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">method&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">==&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">'POST'&lt;/span>&lt;span class="mtk1">:&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">q&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">"select * from users where username = '&lt;/span>&lt;span class="mtk6">%s&lt;/span>&lt;span class="mtk4">' AND password = '&lt;/span>&lt;span class="mtk6">%s&lt;/span>&lt;span class="mtk4">';"&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">%&lt;/span>&lt;span class="mtk1"> (&lt;/span>&lt;span class="mtk1">request&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">form&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">get&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'username'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">''&lt;/span>&lt;span class="mtk1">), &lt;/span>&lt;span class="mtk1">request&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">form&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">get&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'password'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">''&lt;/span>&lt;span class="mtk1">))&lt;/span> 

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">login&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">query_db&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">q&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">one&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk6">True&lt;/span>&lt;span class="mtk1">)&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">isinstance&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">login&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk8 mtku">Exception&lt;/span>&lt;span class="mtk1">):&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">error&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">'&lt;/span>&lt;span class="mtk6">%s&lt;/span>&lt;span class="mtk4"> : &lt;/span>&lt;span class="mtk6">%s&lt;/span>&lt;span class="mtk4">'&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">%&lt;/span>&lt;span class="mtk1"> (&lt;/span>&lt;span class="mtk1">login&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">__class__&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk1">login&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">render_template&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'index.html'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">query&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1">q&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">error&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1">error&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">image&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk8">url_for&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'static'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">filename&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk4">'images/dog.png'&lt;/span>&lt;span class="mtk1">))&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">login&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">is&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk6">None&lt;/span>&lt;span class="mtk1">:&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">render_template&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'index.html'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">query&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1">q&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">image&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk8">url_for&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'static'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">filename&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk4">'images/dog.png'&lt;/span>&lt;span class="mtk1">))&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">login&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">get&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'username'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">''&lt;/span>&lt;span class="mtk1">) &lt;/span>&lt;span class="mtk5">==&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">'admin'&lt;/span>&lt;span class="mtk1">:&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">render_template&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'index.html'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">query&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk8">open&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'flag'&lt;/span>&lt;span class="mtk1">).&lt;/span>&lt;span class="mtk8">read&lt;/span>&lt;span class="mtk1">())&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">render_template&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'index.html'&lt;/span>&lt;span class="mtk1">)&lt;/span>

&lt;span class="mtk8">@&lt;/span>&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk8">.&lt;/span>&lt;span class="mtk8">route&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'/debug'&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk7 mtki">def&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">debug&lt;/span>&lt;span class="mtk1">():&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">Response&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk8">open&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">__file__&lt;/span>&lt;span class="mtk1">).&lt;/span>&lt;span class="mtk8">read&lt;/span>&lt;span class="mtk1">(), &lt;/span>&lt;span class="mtk9 mtki">mimetype&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk4">'text/plain'&lt;/span>&lt;span class="mtk1">)&lt;/span>

&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">__name__&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">==&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">'__main__'&lt;/span>&lt;span class="mtk1">:&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">run&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'0.0.0.0'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">port&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk6">1337&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>It is running Flask, but the key point is this one:&lt;/p></description></item><item><title>Saturn</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/saturn/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/saturn/</guid><description>&lt;p>We are given the following website:&lt;/p>
&lt;p>&lt;img alt="Saturn 1" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-Saturn-1.webp">&lt;/p>
&lt;p>Moreover, we have the source code of the server, which is in Flask (Python).&lt;/p>
&lt;h2 id="source-code-analysis">Source code analysis&lt;/h2>
&lt;p>This is &lt;code>app.py&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="mtk5">from&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">flask&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">Flask&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk1">request&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk8">render_template&lt;/span>
&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">requests&lt;/span>
&lt;span class="mtk5">from&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">safeurl&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">safeurl&lt;/span>

&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">Flask&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">__name__&lt;/span>&lt;span class="mtk1">)&lt;/span>

&lt;span class="mtk8">@&lt;/span>&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk8">.&lt;/span>&lt;span class="mtk8">route&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'/'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">methods&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1">[&lt;/span>&lt;span class="mtk4">'GET'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">'POST'&lt;/span>&lt;span class="mtk1">])&lt;/span>
&lt;span class="mtk7 mtki">def&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">index&lt;/span>&lt;span class="mtk1">():&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">request&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">method&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">==&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">'POST'&lt;/span>&lt;span class="mtk1">:&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">url&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">request&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">form&lt;/span>&lt;span class="mtk1">[&lt;/span>&lt;span class="mtk4">'url'&lt;/span>&lt;span class="mtk1">]&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">try&lt;/span>&lt;span class="mtk1">:&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">su&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">safeurl&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8 mtku">SafeURL&lt;/span>&lt;span class="mtk1">()&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">opt&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">safeurl&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8 mtku">Options&lt;/span>&lt;span class="mtk1">()&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">opt&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">enableFollowLocation&lt;/span>&lt;span class="mtk1">().&lt;/span>&lt;span class="mtk8">setFollowLocationLimit&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk6">0&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">su&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">setOptions&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">opt&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">su&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">execute&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">url&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">except&lt;/span>&lt;span class="mtk1">:&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">render_template&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'index.html'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">error&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk7 mtki">f&lt;/span>&lt;span class="mtk4">"Malicious input detected."&lt;/span>&lt;span class="mtk1">)&lt;/span> 
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">r&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">requests&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">get&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">url&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">render_template&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'index.html'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">result&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1">r&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">text&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">render_template&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'index.html'&lt;/span>&lt;span class="mtk1">)&lt;/span>


&lt;span class="mtk8">@&lt;/span>&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk8">.&lt;/span>&lt;span class="mtk8">route&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'/secret'&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk7 mtki">def&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">secret&lt;/span>&lt;span class="mtk1">():&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">request&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">remote_addr&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">==&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">'127.0.0.1'&lt;/span>&lt;span class="mtk1">:&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">flag&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">""&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">with&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">open&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'./flag.txt'&lt;/span>&lt;span class="mtk1">) &lt;/span>&lt;span class="mtk5">as&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">f&lt;/span>&lt;span class="mtk1">:&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">flag&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">f&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">readline&lt;/span>&lt;span class="mtk1">()&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">render_template&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'secret.html'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">SECRET&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1">flag&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">else&lt;/span>&lt;span class="mtk1">:&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">render_template&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'forbidden.html'&lt;/span>&lt;span class="mtk1">), &lt;/span>&lt;span class="mtk6">403&lt;/span>


&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">__name__&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">==&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">'__main__'&lt;/span>&lt;span class="mtk1">:&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">run&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">host&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk4">"0.0.0.0"&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">port&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk6">1337&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">threaded&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk6">True&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>As can be seen, there are two endpoints. We are interested in &lt;code>/secret&lt;/code> in order to get the flag. However, the endpoint handler checks that the request is made from &lt;code>127.0.0.1&lt;/code>.&lt;/p></description></item><item><title>Slippy</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/slippy/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/slippy/</guid><description>&lt;p>We have a simple web back-end that allows us to upload a &lt;code>.tar.gz&lt;/code> file. As we have a &lt;code>Dockerfile&lt;/code>, let&amp;rsquo;s use a Docker container locally:&lt;/p>
&lt;p>&lt;img alt="Slippy index" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-Slippy-1.webp">&lt;/p>
&lt;h2 id="source-code-analysis">Source code analysis&lt;/h2>
&lt;p>On the source code we have a simple Python Flask application:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="mtk8">@api.route&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'/unslippy'&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk9 mtki">methods&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1">[&lt;/span>&lt;span class="mtk4">'POST'&lt;/span>&lt;span class="mtk1">])&lt;/span>
&lt;span class="mtk7 mtki">def&lt;/span> &lt;span class="mtk8">cache&lt;/span>&lt;span class="mtk1">():&lt;/span>
 &lt;span class="mtk5">if&lt;/span> &lt;span class="mtk4">'file'&lt;/span> &lt;span class="mtk5">not&lt;/span> &lt;span class="mtk5">in&lt;/span> &lt;span class="mtk1">request.files:&lt;/span>
 &lt;span class="mtk5">return&lt;/span> &lt;span class="mtk1">abort(&lt;/span>&lt;span class="mtk6">400&lt;/span>&lt;span class="mtk1">)&lt;/span>

 &lt;span class="mtk1">extraction&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk1">extract_from_archive(request.files[&lt;/span>&lt;span class="mtk4">'file'&lt;/span>&lt;span class="mtk1">])&lt;/span> 
 &lt;span class="mtk5">if&lt;/span> &lt;span class="mtk1">extraction&lt;/span>&lt;span class="mtk1">:&lt;/span>
 &lt;span class="mtk5">return&lt;/span> &lt;span class="mtk1">{&lt;/span>&lt;span class="mtk4">'list'&lt;/span>&lt;span class="mtk1">:&lt;/span> &lt;span class="mtk1">extraction&lt;/span>&lt;span class="mtk1">},&lt;/span> &lt;span class="mtk6">200&lt;/span>

 &lt;span class="mtk5">return&lt;/span> &lt;span class="mtk4">''&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk6">204&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>The file is being extracted and written to &lt;code>/tmp&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="mtk5">import&lt;/span> &lt;span class="mtk8 mtku">tarfile&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk8 mtku">tempfile&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk8 mtku">os&lt;/span>
&lt;span class="mtk5">from&lt;/span> &lt;span class="mtk1">application&lt;/span> &lt;span class="mtk5">import&lt;/span> &lt;span class="mtk1">main&lt;/span>

&lt;span class="mtk1">generate&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk7 mtki">lambda&lt;/span> &lt;span class="mtk9 mtki">x&lt;/span>&lt;span class="mtk1">:&lt;/span> &lt;span class="mtk8 mtku">os&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">urandom&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">x&lt;/span>&lt;span class="mtk1">).&lt;/span>&lt;span class="mtk8">hex&lt;/span>&lt;span class="mtk1">()&lt;/span>

&lt;span class="mtk7 mtki">def&lt;/span> &lt;span class="mtk8">extract_from_archive&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">file&lt;/span>&lt;span class="mtk1">):&lt;/span>
 &lt;span class="mtk1">tmp&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk8 mtku">tempfile&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">gettempdir&lt;/span>&lt;span class="mtk1">()&lt;/span>
 &lt;span class="mtk1">path&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk8 mtku">os&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">path&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">join&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">tmp&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk9 mtki">file&lt;/span>&lt;span class="mtk1">.filename)&lt;/span>
 &lt;span class="mtk9 mtki">file&lt;/span>&lt;span class="mtk1">.save(&lt;/span>&lt;span class="mtk1">path&lt;/span>&lt;span class="mtk1">)&lt;/span>

 &lt;span class="mtk5">if&lt;/span> &lt;span class="mtk8 mtku">tarfile&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">is_tarfile&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">path&lt;/span>&lt;span class="mtk1">):&lt;/span>
 &lt;span class="mtk1">tar&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk8 mtku">tarfile&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">open&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">path&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk4">'r:gz'&lt;/span>&lt;span class="mtk1">)&lt;/span>
 &lt;span class="mtk1">tar&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">extractall&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">tmp&lt;/span>&lt;span class="mtk1">)&lt;/span>

 &lt;span class="mtk1">extractdir&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk7 mtki">f&lt;/span>&lt;span class="mtk4">'&lt;/span>&lt;span class="mtk6">{&lt;/span>&lt;span class="mtk1">main.app.config[&lt;/span>&lt;span class="mtk4">"UPLOAD_FOLDER"&lt;/span>&lt;span class="mtk1">]&lt;/span>&lt;span class="mtk6">}&lt;/span>&lt;span class="mtk4">/&lt;/span>&lt;span class="mtk6">{&lt;/span>&lt;span class="mtk1">generate&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk6">15&lt;/span>&lt;span class="mtk1">)&lt;/span>&lt;span class="mtk6">}&lt;/span>&lt;span class="mtk4">'&lt;/span> 
 &lt;span class="mtk8 mtku">os&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">makedirs&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">extractdir&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk9 mtki">exist_ok&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk6">True&lt;/span>&lt;span class="mtk1">)&lt;/span>

 &lt;span class="mtk1">extracted_filenames&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk1">[]&lt;/span>

 &lt;span class="mtk5">for&lt;/span> &lt;span class="mtk1">tarinfo&lt;/span> &lt;span class="mtk5">in&lt;/span> &lt;span class="mtk1">tar&lt;/span>&lt;span class="mtk1">:&lt;/span>
 &lt;span class="mtk1">name&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk1">tarinfo&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">name&lt;/span>
 &lt;span class="mtk5">if&lt;/span> &lt;span class="mtk1">tarinfo&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">isreg&lt;/span>&lt;span class="mtk1">():&lt;/span>
 &lt;span class="mtk1">filename&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk7 mtki">f&lt;/span>&lt;span class="mtk4">'&lt;/span>&lt;span class="mtk6">{&lt;/span>&lt;span class="mtk1">extractdir&lt;/span>&lt;span class="mtk6">}&lt;/span>&lt;span class="mtk4">/&lt;/span>&lt;span class="mtk6">{&lt;/span>&lt;span class="mtk1">name&lt;/span>&lt;span class="mtk6">}&lt;/span>&lt;span class="mtk4">'&lt;/span>
 &lt;span class="mtk8 mtku">os&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">rename&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk8 mtku">os&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">path&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">join&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">tmp&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk1">name&lt;/span>&lt;span class="mtk1">),&lt;/span> &lt;span class="mtk1">filename&lt;/span>&lt;span class="mtk1">)&lt;/span>
 &lt;span class="mtk1">extracted_filenames&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">append&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">filename&lt;/span>&lt;span class="mtk1">)&lt;/span>
 &lt;span class="mtk5">continue&lt;/span>

 &lt;span class="mtk8 mtku">os&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">makedirs&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk7 mtki">f&lt;/span>&lt;span class="mtk4">'&lt;/span>&lt;span class="mtk6">{&lt;/span>&lt;span class="mtk1">extractdir&lt;/span>&lt;span class="mtk6">}&lt;/span>&lt;span class="mtk4">/&lt;/span>&lt;span class="mtk6">{&lt;/span>&lt;span class="mtk1">name&lt;/span>&lt;span class="mtk6">}&lt;/span>&lt;span class="mtk4">'&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk9 mtki">exist_ok&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk6">True&lt;/span>&lt;span class="mtk1">)&lt;/span>

 &lt;span class="mtk1">tar&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">close&lt;/span>&lt;span class="mtk1">()&lt;/span>
 &lt;span class="mtk5">return&lt;/span> &lt;span class="mtk1">extracted_filenames&lt;/span>

 &lt;span class="mtk5">return&lt;/span> &lt;span class="mtk6">False&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>

&lt;h2 id="zip-slip">Zip Slip&lt;/h2>
&lt;p>Since the challenge is called &lt;code>Slippy&lt;/code>, one can think of Zip Slip, but in &lt;code>.tar.gz&lt;/code> files. This consists of compressing a file that contains a path traversal, so that when extracted, the path traversal is done and the file is written to another directory.&lt;/p></description></item><item><title>Spellbound Servants</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/spellbound-servants/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/spellbound-servants/</guid><description>&lt;p>We are given the following website:&lt;/p>
&lt;p>&lt;img alt="Spellbound Servants 1" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-Spellbound-Servants-1.webp">&lt;/p>
&lt;p>We also have the Python source code of the server (Flask).&lt;/p>
&lt;p>First of all, we can register a new account and log in:&lt;/p>
&lt;p>&lt;img alt="Spellbound Servants 2" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-Spellbound-Servants-2.webp">&lt;/p>
&lt;p>And we get to this dashboard:&lt;/p>
&lt;p>&lt;img alt="Spellbound Servants 3" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-Spellbound-Servants-3.webp">&lt;/p>
&lt;p>There is no funcionality! So, let&amp;rsquo;s analyze the source code.&lt;/p>
&lt;h2 id="source-code-analysis">Source code analysis&lt;/h2>
&lt;p>These are the available endpoints (&lt;code>blueprints/routes.py&lt;/code>):&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="mtk5">from&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">application&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8 mtku">database&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">*&lt;/span>
&lt;span class="mtk5">from&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">flask&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">Blueprint&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk8">redirect&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk8">render_template&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk1">request&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk8">make_response&lt;/span> 
&lt;span class="mtk5">from&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">application&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8 mtku">util&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">response&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk8">isAuthenticated&lt;/span>

&lt;span class="mtk1">web&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">Blueprint&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'web'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk1">__name__&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1">api&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">Blueprint&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'api'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk1">__name__&lt;/span>&lt;span class="mtk1">)&lt;/span>

&lt;span class="mtk8">@&lt;/span>&lt;span class="mtk1">web&lt;/span>&lt;span class="mtk8">.&lt;/span>&lt;span class="mtk8">route&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'/'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">methods&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1">[&lt;/span>&lt;span class="mtk4">'GET'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">'POST'&lt;/span>&lt;span class="mtk1">])&lt;/span>
&lt;span class="mtk7 mtki">def&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">loginView&lt;/span>&lt;span class="mtk1">():&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">render_template&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'login.html'&lt;/span>&lt;span class="mtk1">)&lt;/span>

&lt;span class="mtk8">@&lt;/span>&lt;span class="mtk1">web&lt;/span>&lt;span class="mtk8">.&lt;/span>&lt;span class="mtk8">route&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'/register'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">methods&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1">[&lt;/span>&lt;span class="mtk4">'GET'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">'POST'&lt;/span>&lt;span class="mtk1">])&lt;/span>
&lt;span class="mtk7 mtki">def&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">registerView&lt;/span>&lt;span class="mtk1">():&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">render_template&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'register.html'&lt;/span>&lt;span class="mtk1">)&lt;/span>

&lt;span class="mtk8">@&lt;/span>&lt;span class="mtk1">web&lt;/span>&lt;span class="mtk8">.&lt;/span>&lt;span class="mtk8">route&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'/home'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">methods&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1">[&lt;/span>&lt;span class="mtk4">'GET'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">'POST'&lt;/span>&lt;span class="mtk1">])&lt;/span>
&lt;span class="mtk8">@&lt;/span>&lt;span class="mtk8">isAuthenticated&lt;/span>
&lt;span class="mtk7 mtki">def&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">homeView&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">user&lt;/span>&lt;span class="mtk1">):&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">render_template&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'index.html'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">user&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk9 mtki">user&lt;/span>&lt;span class="mtk1">)&lt;/span>

&lt;span class="mtk8">@&lt;/span>&lt;span class="mtk1">api&lt;/span>&lt;span class="mtk8">.&lt;/span>&lt;span class="mtk8">route&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'/login'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">methods&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1">[&lt;/span>&lt;span class="mtk4">'POST'&lt;/span>&lt;span class="mtk1">])&lt;/span>
&lt;span class="mtk7 mtki">def&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">api_login&lt;/span>&lt;span class="mtk1">():&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">not&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">request&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">is_json&lt;/span>&lt;span class="mtk1">:&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">response&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'Invalid JSON!'&lt;/span>&lt;span class="mtk1">), &lt;/span>&lt;span class="mtk6">400&lt;/span>
&lt;span class="mtk1"> &lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">data&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">request&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">get_json&lt;/span>&lt;span class="mtk1">()&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">username&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">data&lt;/span>&lt;span class="mtk1">.get(&lt;/span>&lt;span class="mtk4">'username'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">''&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">password&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">data&lt;/span>&lt;span class="mtk1">.get(&lt;/span>&lt;span class="mtk4">'password'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">''&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">not&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">username&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">or&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">not&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">password&lt;/span>&lt;span class="mtk1">:&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">response&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'All fields are required!'&lt;/span>&lt;span class="mtk1">), &lt;/span>&lt;span class="mtk6">401&lt;/span>
&lt;span class="mtk1"> &lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">user&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">login_user_db&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">username&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk1">password&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">user&lt;/span>&lt;span class="mtk1">:&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">res&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">make_response&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk8">response&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'Logged In sucessfully'&lt;/span>&lt;span class="mtk1">))&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">res&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">set_cookie&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'auth'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk1">user&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">res&lt;/span>
&lt;span class="mtk1"> &lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">response&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'Invalid credentials!'&lt;/span>&lt;span class="mtk1">), &lt;/span>&lt;span class="mtk6">403&lt;/span>

&lt;span class="mtk8">@&lt;/span>&lt;span class="mtk1">api&lt;/span>&lt;span class="mtk8">.&lt;/span>&lt;span class="mtk8">route&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'/register'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">methods&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1">[&lt;/span>&lt;span class="mtk4">'POST'&lt;/span>&lt;span class="mtk1">])&lt;/span>
&lt;span class="mtk7 mtki">def&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">api_register&lt;/span>&lt;span class="mtk1">():&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">not&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">request&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">is_json&lt;/span>&lt;span class="mtk1">:&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">response&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'Invalid JSON!'&lt;/span>&lt;span class="mtk1">), &lt;/span>&lt;span class="mtk6">400&lt;/span>
&lt;span class="mtk1"> &lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">data&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">request&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">get_json&lt;/span>&lt;span class="mtk1">()&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">username&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">data&lt;/span>&lt;span class="mtk1">.get(&lt;/span>&lt;span class="mtk4">'username'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">''&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">password&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">data&lt;/span>&lt;span class="mtk1">.get(&lt;/span>&lt;span class="mtk4">'password'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">''&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">not&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">username&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">or&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">not&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">password&lt;/span>&lt;span class="mtk1">:&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">response&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'All fields are required!'&lt;/span>&lt;span class="mtk1">), &lt;/span>&lt;span class="mtk6">401&lt;/span>
&lt;span class="mtk1"> &lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">user&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">register_user_db&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">username&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk1">password&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">user&lt;/span>&lt;span class="mtk1">:&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">response&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'User registered! Please login'&lt;/span>&lt;span class="mtk1">), &lt;/span>&lt;span class="mtk6">200&lt;/span>
&lt;span class="mtk1"> &lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">response&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'User already exists!'&lt;/span>&lt;span class="mtk1">), &lt;/span>&lt;span class="mtk6">403&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>As can be seen, we only have the ability to register and log in. But notice that our username appears on the home page, so there is some kind of session management. Indeed, we have an &lt;code>auth&lt;/code> cookie:&lt;/p></description></item><item><title>Spiky Tamagotchi</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/spiky-tamagotchi/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/spiky-tamagotchi/</guid><description>&lt;p>We are given the source code of a Node.js web project using Express JS and MySQL.&lt;/p>
&lt;h2 id="source-code-analysis">Source code analysis&lt;/h2>
&lt;p>In the &lt;code>Dockerfile&lt;/code> an &lt;code>entrypoint.sh&lt;/code> script is run:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="mtk3">#!/bin/ash&lt;/span>

&lt;span class="mtk3">#&lt;/span> &lt;span class="mtk3">Secure&lt;/span> &lt;span class="mtk3">entrypoint&lt;/span>
&lt;span class="mtk1">chmod&lt;/span> &lt;span class="mtk1">600&lt;/span> &lt;span class="mtk1">/entrypoint.sh&lt;/span>

&lt;span class="mtk3">#&lt;/span> &lt;span class="mtk3">Initialize&lt;/span> &lt;span class="mtk3">&amp;amp;&lt;/span> &lt;span class="mtk3">Start&lt;/span> &lt;span class="mtk3">MariaDB&lt;/span>
&lt;span class="mtk1">mkdir&lt;/span> &lt;span class="mtk1">-p&lt;/span> &lt;span class="mtk1">/run/mysqld&lt;/span>
&lt;span class="mtk1">chown&lt;/span> &lt;span class="mtk1">-R&lt;/span> &lt;span class="mtk1">mysql:mysql&lt;/span> &lt;span class="mtk1">/run/mysqld&lt;/span>
&lt;span class="mtk1">mysql_install_db&lt;/span> &lt;span class="mtk1">--user=mysql&lt;/span> &lt;span class="mtk1">--ldata=/var/lib/mysql&lt;/span>
&lt;span class="mtk1">mysqld&lt;/span> &lt;span class="mtk1">--user=mysql&lt;/span> &lt;span class="mtk1">--console&lt;/span> &lt;span class="mtk1">--skip-name-resolve&lt;/span> &lt;span class="mtk1">--skip-networking=0&lt;/span> &lt;span class="mtk5">&amp;amp;&lt;/span>

&lt;span class="mtk3">#&lt;/span> &lt;span class="mtk3">Wait&lt;/span> &lt;span class="mtk3">for&lt;/span> &lt;span class="mtk3">mysql&lt;/span> &lt;span class="mtk3">to&lt;/span> &lt;span class="mtk3">start&lt;/span>
&lt;span class="mtk5">while&lt;/span> &lt;span class="mtk5">!&lt;/span> &lt;span class="mtk1">mysqladmin&lt;/span> &lt;span class="mtk1">ping&lt;/span> &lt;span class="mtk1">-h&lt;/span>&lt;span class="mtk4">'localhost'&lt;/span> &lt;span class="mtk1">--silent&lt;/span>&lt;span class="mtk5">;&lt;/span> &lt;span class="mtk5">do&lt;/span> &lt;span class="mtk7">echo&lt;/span> &lt;span class="mtk4">"mysqld&lt;/span> &lt;span class="mtk4">is&lt;/span> &lt;span class="mtk4">not&lt;/span> &lt;span class="mtk4">yet&lt;/span> &lt;span class="mtk4">alive"&lt;/span> &lt;span class="mtk5">&amp;amp;&amp;amp;&lt;/span> &lt;span class="mtk1">sleep&lt;/span> &lt;span class="mtk1">.2&lt;/span>&lt;span class="mtk5">;&lt;/span> &lt;span class="mtk5">done&lt;/span> 

&lt;span class="mtk3">#&lt;/span> &lt;span class="mtk3">admin&lt;/span> &lt;span class="mtk3">password&lt;/span>
&lt;span class="mtk1">PASSWORD=&lt;/span>&lt;span class="mtk4">$(cat&lt;/span> &lt;span class="mtk4">/dev/urandom&lt;/span> &lt;span class="mtk5">|&lt;/span> &lt;span class="mtk4">tr&lt;/span> &lt;span class="mtk4">-dc&lt;/span> &lt;span class="mtk4">'a-zA-Z0-9'&lt;/span> &lt;span class="mtk5">|&lt;/span> &lt;span class="mtk4">fold&lt;/span> &lt;span class="mtk4">-w&lt;/span> &lt;span class="mtk4">16&lt;/span> &lt;span class="mtk5">|&lt;/span> &lt;span class="mtk4">head&lt;/span> &lt;span class="mtk4">-n&lt;/span> &lt;span class="mtk4">1)&lt;/span>

&lt;span class="mtk3">#&lt;/span> &lt;span class="mtk3">create&lt;/span> &lt;span class="mtk3">database&lt;/span>
&lt;span class="mtk1">mysql&lt;/span> &lt;span class="mtk1">-u&lt;/span> &lt;span class="mtk1">root&lt;/span> &lt;span class="mtk5">&amp;lt;&amp;lt;&lt;/span> &lt;span class="mtk5">EOF&lt;/span>
&lt;span class="mtk4">CREATE&lt;/span> &lt;span class="mtk4">DATABASE&lt;/span> &lt;span class="mtk4">spiky_tamagotchi;&lt;/span>

&lt;span class="mtk4">CREATE&lt;/span> &lt;span class="mtk4">TABLE&lt;/span> &lt;span class="mtk4">spiky_tamagotchi.users&lt;/span> &lt;span class="mtk4">(&lt;/span>
 &lt;span class="mtk4">id&lt;/span> &lt;span class="mtk4">INT&lt;/span> &lt;span class="mtk4">AUTO_INCREMENT&lt;/span> &lt;span class="mtk4">NOT&lt;/span> &lt;span class="mtk4">NULL,&lt;/span>
 &lt;span class="mtk4">username&lt;/span> &lt;span class="mtk4">varchar(255)&lt;/span> &lt;span class="mtk4">UNIQUE&lt;/span> &lt;span class="mtk4">NOT&lt;/span> &lt;span class="mtk4">NULL,&lt;/span>
 &lt;span class="mtk4">password&lt;/span> &lt;span class="mtk4">varchar(255)&lt;/span> &lt;span class="mtk4">NOT&lt;/span> &lt;span class="mtk4">NULL,&lt;/span>
 &lt;span class="mtk4">PRIMARY&lt;/span> &lt;span class="mtk4">KEY&lt;/span> &lt;span class="mtk4">(id)&lt;/span>
&lt;span class="mtk4">);&lt;/span>

&lt;span class="mtk4">INSERT&lt;/span> &lt;span class="mtk4">INTO&lt;/span> &lt;span class="mtk4">spiky_tamagotchi.users&lt;/span> &lt;span class="mtk4">VALUES&lt;/span>
&lt;span class="mtk4">(1,'admin','&lt;/span>&lt;span class="mtk1">${PASSWORD}&lt;/span>&lt;span class="mtk4">');&lt;/span>

&lt;span class="mtk4">GRANT&lt;/span> &lt;span class="mtk4">ALL&lt;/span> &lt;span class="mtk4">PRIVILEGES&lt;/span> &lt;span class="mtk4">ON&lt;/span> &lt;span class="mtk4">spiky_tamagotchi.*&lt;/span> &lt;span class="mtk4">TO&lt;/span> &lt;span class="mtk4">'rh0x01'@'%'&lt;/span> &lt;span class="mtk4">IDENTIFIED&lt;/span> &lt;span class="mtk4">BY&lt;/span> &lt;span class="mtk4">'r4yh4nb34t5b1gm4c';&lt;/span>
&lt;span class="mtk4">FLUSH&lt;/span> &lt;span class="mtk4">PRIVILEGES;&lt;/span>
&lt;span class="mtk5">EOF&lt;/span>

&lt;span class="mtk3">#&lt;/span> &lt;span class="mtk3">launch&lt;/span> &lt;span class="mtk3">supervisord&lt;/span>
&lt;span class="mtk1">/usr/bin/supervisord&lt;/span> &lt;span class="mtk1">-c&lt;/span> &lt;span class="mtk1">/etc/supervisord.conf&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>Here we see that the database contains a username called &lt;code>admin&lt;/code> and a random password.&lt;/p>
&lt;p>There are functions called &lt;code>registerUser&lt;/code> and &lt;code>loginUser&lt;/code> in the source code (&lt;code>database.js&lt;/code>). Both of them use prepared statements, so SQL injection is not possible:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="mtk7 mtki">let&lt;/span> &lt;span class="mtk1">mysql&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk8">require&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'mysql'&lt;/span>&lt;span class="mtk1">)&lt;/span>

&lt;span class="mtk7 mtki">class&lt;/span> &lt;span class="mtk8 mtku">Database&lt;/span> &lt;span class="mtk1">{&lt;/span>

 &lt;span class="mtk7 mtki">constructor&lt;/span>&lt;span class="mtk1">()&lt;/span> &lt;span class="mtk1">{&lt;/span>
 &lt;span class="mtk9">this&lt;/span>&lt;span class="mtk1">.connection&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk1">mysql.&lt;/span>&lt;span class="mtk8">createConnection&lt;/span>&lt;span class="mtk1">({&lt;/span>
 &lt;span class="mtk1">host&lt;/span>&lt;span class="mtk1">:&lt;/span> &lt;span class="mtk4">'localhost'&lt;/span>&lt;span class="mtk1">,&lt;/span>
 &lt;span class="mtk1">user&lt;/span>&lt;span class="mtk1">:&lt;/span> &lt;span class="mtk4">'rh0x01'&lt;/span>&lt;span class="mtk1">,&lt;/span>
 &lt;span class="mtk1">password&lt;/span>&lt;span class="mtk1">:&lt;/span> &lt;span class="mtk4">'r4yh4nb34t5b1gm4c'&lt;/span>&lt;span class="mtk1">,&lt;/span>
 &lt;span class="mtk1">database&lt;/span>&lt;span class="mtk1">:&lt;/span> &lt;span class="mtk4">'spiky_tamagotchi'&lt;/span>
 &lt;span class="mtk1">});&lt;/span>
 &lt;span class="mtk1">}&lt;/span>

 &lt;span class="mtk5">async&lt;/span> &lt;span class="mtk8">registerUser&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">user&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk9 mtki">pass&lt;/span>&lt;span class="mtk1">)&lt;/span> &lt;span class="mtk1">{&lt;/span>
 &lt;span class="mtk5">return&lt;/span> &lt;span class="mtk5">new&lt;/span> &lt;span class="mtk7 mtki">Promise&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk5">async&lt;/span> &lt;span class="mtk1">(&lt;/span>&lt;span class="mtk8">resolve&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk8">reject&lt;/span>&lt;span class="mtk1">)&lt;/span> &lt;span class="mtk7 mtki">=&amp;gt;&lt;/span> &lt;span class="mtk1">{&lt;/span>
 &lt;span class="mtk7 mtki">let&lt;/span> &lt;span class="mtk1">stmt&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk4">'INSERT&lt;/span> &lt;span class="mtk4">INTO&lt;/span> &lt;span class="mtk4">users&lt;/span> &lt;span class="mtk4">(username,&lt;/span> &lt;span class="mtk4">password)&lt;/span> &lt;span class="mtk4">VALUES&lt;/span> &lt;span class="mtk4">(?,&lt;/span> &lt;span class="mtk4">?)'&lt;/span>&lt;span class="mtk1">;&lt;/span>
 &lt;span class="mtk9">this&lt;/span>&lt;span class="mtk1">.connection.&lt;/span>&lt;span class="mtk8">query&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">stmt&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk1">[&lt;/span>&lt;span class="mtk9 mtki">user&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk9 mtki">pass&lt;/span>&lt;span class="mtk1">],&lt;/span> &lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">err&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk9 mtki">result&lt;/span>&lt;span class="mtk1">)&lt;/span> &lt;span class="mtk7 mtki">=&amp;gt;&lt;/span> &lt;span class="mtk1">{&lt;/span>
 &lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">err&lt;/span>&lt;span class="mtk1">)&lt;/span>
 &lt;span class="mtk8">reject&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">err&lt;/span>&lt;span class="mtk1">)&lt;/span>
 &lt;span class="mtk8">resolve&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">result&lt;/span>&lt;span class="mtk1">)&lt;/span>
 &lt;span class="mtk1">})&lt;/span>
 &lt;span class="mtk1">});&lt;/span>
 &lt;span class="mtk1">}&lt;/span>

 &lt;span class="mtk5">async&lt;/span> &lt;span class="mtk8">loginUser&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">user&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk9 mtki">pass&lt;/span>&lt;span class="mtk1">)&lt;/span> &lt;span class="mtk1">{&lt;/span>
 &lt;span class="mtk5">return&lt;/span> &lt;span class="mtk5">new&lt;/span> &lt;span class="mtk7 mtki">Promise&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk5">async&lt;/span> &lt;span class="mtk1">(&lt;/span>&lt;span class="mtk8">resolve&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk8">reject&lt;/span>&lt;span class="mtk1">)&lt;/span> &lt;span class="mtk7 mtki">=&amp;gt;&lt;/span> &lt;span class="mtk1">{&lt;/span>
 &lt;span class="mtk7 mtki">let&lt;/span> &lt;span class="mtk1">stmt&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk4">'SELECT&lt;/span> &lt;span class="mtk4">username&lt;/span> &lt;span class="mtk4">FROM&lt;/span> &lt;span class="mtk4">users&lt;/span> &lt;span class="mtk4">WHERE&lt;/span> &lt;span class="mtk4">username&lt;/span> &lt;span class="mtk4">=&lt;/span> &lt;span class="mtk4">?&lt;/span> &lt;span class="mtk4">AND&lt;/span> &lt;span class="mtk4">password&lt;/span> &lt;span class="mtk4">=&lt;/span> &lt;span class="mtk4">?'&lt;/span>&lt;span class="mtk1">;&lt;/span> 
 &lt;span class="mtk7 mtki">let&lt;/span> &lt;span class="mtk1">x&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk9">this&lt;/span>&lt;span class="mtk1">.connection.&lt;/span>&lt;span class="mtk8">query&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">stmt&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk1">[&lt;/span>&lt;span class="mtk9 mtki">user&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk9 mtki">pass&lt;/span>&lt;span class="mtk1">],&lt;/span> &lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">err&lt;/span>&lt;span class="mtk1">,&lt;/span> &lt;span class="mtk9 mtki">result&lt;/span>&lt;span class="mtk1">)&lt;/span> &lt;span class="mtk7 mtki">=&amp;gt;&lt;/span> &lt;span class="mtk1">{&lt;/span>
 &lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">err&lt;/span> &lt;span class="mtk5">||&lt;/span> &lt;span class="mtk9 mtki">result&lt;/span>&lt;span class="mtk1">.length&lt;/span> &lt;span class="mtk5">==&lt;/span> &lt;span class="mtk6">0&lt;/span>&lt;span class="mtk1">)&lt;/span>
 &lt;span class="mtk8">reject&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">err&lt;/span>&lt;span class="mtk1">)&lt;/span>
 &lt;span class="mtk8">resolve&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">result&lt;/span>&lt;span class="mtk1">)&lt;/span>
 &lt;span class="mtk1">})&lt;/span>
 &lt;span class="mtk1">});&lt;/span>
 &lt;span class="mtk1">}&lt;/span>

&lt;span class="mtk1">}&lt;/span>

&lt;span class="mtk8 mtku">module&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8 mtku">exports&lt;/span> &lt;span class="mtk5">=&lt;/span> &lt;span class="mtk8 mtku">Database&lt;/span>&lt;span class="mtk1">;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>Unfortunately, there is no way to register a new user using &lt;code>registerUser&lt;/code>:&lt;/p></description></item><item><title>Spookifier</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/spookifier/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/spookifier/</guid><description>&lt;p>We are given this website:&lt;/p>
&lt;p>&lt;img alt="Spookifier 1" src="https://7rocky.github.io/images/other/HackTheBooCTF/Spookifier-1.webp">&lt;/p>
&lt;p>We can enter some string and it will be shown in different fonts:&lt;/p>
&lt;p>&lt;img alt="Spookifier 2" src="https://7rocky.github.io/images/other/HackTheBooCTF/Spookifier-2.webp">&lt;/p>
&lt;h2 id="static-code-analysis">Static code analysis&lt;/h2>
&lt;p>We are provided with the Python source code of the web application, built with Flask. This is &lt;code>application/blueprints/routes.py&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="mtk5">from&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">flask&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">Blueprint&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk1">request&lt;/span>
&lt;span class="mtk5">from&lt;/span> &lt;span class="mtk8 mtku">flask_mako&lt;/span> &lt;span class="mtk5">import&lt;/span>&lt;span class="mtk8"> render_template&lt;/span>
&lt;span class="mtk5">from&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">application&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8 mtku">util&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">spookify&lt;/span>

&lt;span class="mtk1">web&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">Blueprint&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'web'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk1">__name__&lt;/span>&lt;span class="mtk1">)&lt;/span>

&lt;span class="mtk8">@&lt;/span>&lt;span class="mtk1">web&lt;/span>&lt;span class="mtk8">.&lt;/span>&lt;span class="mtk8">route&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'/'&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk7 mtki">def&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">index&lt;/span>&lt;span class="mtk1">():&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">text&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">request&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">args&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">get&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'text'&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span> text:
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">converted&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">spookify&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">text&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span> &lt;span class="mtk8">render_template&lt;/span>(&lt;span class="mtk4">'index.html'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">output&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1">converted&lt;/span>&lt;span class="mtk1">)&lt;/span> 
&lt;span class="mtk1"> &lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span> &lt;span class="mtk8">render_template&lt;/span>(&lt;span class="mtk4">'index.html'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">output&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk4">''&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>The first thing we see here is that it is using templates, but using &lt;code>mako&lt;/code> instead of the usual Jinja2 template engine.&lt;/p></description></item><item><title>SpookTastic</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/spooktastic/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/spooktastic/</guid><description>&lt;p>We are given the following website:&lt;/p>
&lt;p>&lt;img alt="SpookTastic 1" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-SpookTastic-1.webp">&lt;/p>
&lt;p>We also have the Python source code of the server (Flask).&lt;/p>
&lt;h2 id="source-code-analysis">Source code analysis&lt;/h2>
&lt;p>The relevant file is &lt;code>app.py&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">random&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk8 mtku">string&lt;/span>
&lt;span class="mtk5">from&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">flask&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">Flask&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk1">request&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk8">render_template&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk8">abort&lt;/span>
&lt;span class="mtk5">from&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">flask_socketio&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">SocketIO&lt;/span>
&lt;span class="mtk5">from&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">threading&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">Thread&lt;/span>

&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">Flask&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">__name__&lt;/span>&lt;span class="mtk1">)&lt;/span>

&lt;span class="mtk1">socketio&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">SocketIO&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk1">)&lt;/span>

&lt;span class="mtk1">registered_emails&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk1">socket_clients&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> [], {}&lt;/span>

&lt;span class="mtk1">generate&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">lambda&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">x&lt;/span>&lt;span class="mtk1">: &lt;/span>&lt;span class="mtk4">""&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">join&lt;/span>&lt;span class="mtk1">([&lt;/span>&lt;span class="mtk8 mtku">random&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">choice&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk8 mtku">string&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">hexdigits&lt;/span>&lt;span class="mtk1">) &lt;/span>&lt;span class="mtk5">for&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">_&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">in&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">range&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">x&lt;/span>&lt;span class="mtk1">)])&lt;/span> 
&lt;span class="mtk1">BOT_TOKEN&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">generate&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk6">16&lt;/span>&lt;span class="mtk1">)&lt;/span>

&lt;span class="mtk7 mtki">def&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">blacklist_pass&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">email&lt;/span>&lt;span class="mtk1">):&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">email&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">email&lt;/span>&lt;span class="mtk1">.lower()&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">"script"&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">in&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">email&lt;/span>&lt;span class="mtk1">:&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk6">False&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk6">True&lt;/span>


&lt;span class="mtk7 mtki">def&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">send_flag&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">user_ip&lt;/span>&lt;span class="mtk1">):&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">for&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">id&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk1">ip&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7">in&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">socket_clients&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">items&lt;/span>&lt;span class="mtk1">():&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">ip&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">==&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">user_ip&lt;/span>&lt;span class="mtk1">:&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">socketio&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">emit&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"flag"&lt;/span>&lt;span class="mtk1">, {&lt;/span>&lt;span class="mtk4">"flag"&lt;/span>&lt;span class="mtk1">: &lt;/span>&lt;span class="mtk8">open&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"flag.txt"&lt;/span>&lt;span class="mtk1">).&lt;/span>&lt;span class="mtk8">read&lt;/span>&lt;span class="mtk1">()}, &lt;/span>&lt;span class="mtk9 mtki">room&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1">id&lt;/span>&lt;span class="mtk1">)&lt;/span>


&lt;span class="mtk7 mtki">def&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">start_bot&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">user_ip&lt;/span>&lt;span class="mtk1">):&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">from&lt;/span>&lt;span class="mtk1"> selenium &lt;/span>&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> webdriver&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">from&lt;/span>&lt;span class="mtk1"> selenium.webdriver.chrome.options &lt;/span>&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> Options&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">from&lt;/span>&lt;span class="mtk1"> selenium.webdriver.chrome.service &lt;/span>&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> Service&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">from&lt;/span>&lt;span class="mtk1"> selenium.webdriver.support.ui &lt;/span>&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> WebDriverWait&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">from&lt;/span>&lt;span class="mtk1"> selenium.webdriver.support &lt;/span>&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> expected_conditions &lt;/span>&lt;span class="mtk5">as&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk6">EC&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">host&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk1">port&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">"localhost"&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk6">1337&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">HOST&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">f&lt;/span>&lt;span class="mtk4">"&lt;/span>&lt;span class="mtk4 detected-link">http://&lt;/span>&lt;span class="mtk6 detected-link">{&lt;/span>&lt;span class="mtk1 detected-link">host&lt;/span>&lt;span class="mtk6">}&lt;/span>&lt;span class="mtk4">:&lt;/span>&lt;span class="mtk6">{&lt;/span>&lt;span class="mtk1">port&lt;/span>&lt;span class="mtk6">}&lt;/span>&lt;span class="mtk4">"&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">options&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> Options()&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">options&lt;/span>&lt;span class="mtk1">.add_argument(&lt;/span>&lt;span class="mtk4">"--headless"&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">options&lt;/span>&lt;span class="mtk1">.add_argument(&lt;/span>&lt;span class="mtk4">"--no-sandbox"&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">options&lt;/span>&lt;span class="mtk1">.add_argument(&lt;/span>&lt;span class="mtk4">"--disable-dev-shm-usage"&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">options&lt;/span>&lt;span class="mtk1">.add_argument(&lt;/span>&lt;span class="mtk4">"--disable-infobars"&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">options&lt;/span>&lt;span class="mtk1">.add_argument(&lt;/span>&lt;span class="mtk4">"--disable-background-networking"&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">options&lt;/span>&lt;span class="mtk1">.add_argument(&lt;/span>&lt;span class="mtk4">"--disable-default-apps"&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">options&lt;/span>&lt;span class="mtk1">.add_argument(&lt;/span>&lt;span class="mtk4">"--disable-extensions"&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">options&lt;/span>&lt;span class="mtk1">.add_argument(&lt;/span>&lt;span class="mtk4">"--disable-gpu"&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">options&lt;/span>&lt;span class="mtk1">.add_argument(&lt;/span>&lt;span class="mtk4">"--disable-sync"&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">options&lt;/span>&lt;span class="mtk1">.add_argument(&lt;/span>&lt;span class="mtk4">"--disable-translate"&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">options&lt;/span>&lt;span class="mtk1">.add_argument(&lt;/span>&lt;span class="mtk4">"--hide-scrollbars"&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">options&lt;/span>&lt;span class="mtk1">.add_argument(&lt;/span>&lt;span class="mtk4">"--metrics-recording-only"&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">options&lt;/span>&lt;span class="mtk1">.add_argument(&lt;/span>&lt;span class="mtk4">"--mute-audio"&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">options&lt;/span>&lt;span class="mtk1">.add_argument(&lt;/span>&lt;span class="mtk4">"--no-first-run"&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">options&lt;/span>&lt;span class="mtk1">.add_argument(&lt;/span>&lt;span class="mtk4">"--dns-prefetch-disable"&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">options&lt;/span>&lt;span class="mtk1">.add_argument(&lt;/span>&lt;span class="mtk4">"--safebrowsing-disable-auto-update"&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">options&lt;/span>&lt;span class="mtk1">.add_argument(&lt;/span>&lt;span class="mtk4">"--media-cache-size=1"&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">options&lt;/span>&lt;span class="mtk1">.add_argument(&lt;/span>&lt;span class="mtk4">"--disk-cache-size=1"&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">options&lt;/span>&lt;span class="mtk1">.add_argument(&lt;/span>&lt;span class="mtk4">"--user-agent=HTB/1.0"&lt;/span>&lt;span class="mtk1">)&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">service&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> Service(&lt;/span>&lt;span class="mtk9 mtki">executable_path&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk4">"/usr/bin/chromedriver"&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">browser&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> webdriver.Chrome(&lt;/span>&lt;span class="mtk9 mtki">service&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1">service&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">options&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1">options&lt;/span>&lt;span class="mtk1">)&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">try&lt;/span>&lt;span class="mtk1">:&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">browser&lt;/span>&lt;span class="mtk1">.get(&lt;/span>&lt;span class="mtk7 mtki">f&lt;/span>&lt;span class="mtk4">"&lt;/span>&lt;span class="mtk6">{&lt;/span>&lt;span class="mtk1">HOST&lt;/span>&lt;span class="mtk6">}&lt;/span>&lt;span class="mtk4">/bot?token=&lt;/span>&lt;span class="mtk6">{&lt;/span>&lt;span class="mtk1">BOT_TOKEN&lt;/span>&lt;span class="mtk6">}&lt;/span>&lt;span class="mtk4">"&lt;/span>&lt;span class="mtk1">)&lt;/span>

&lt;span class="mtk1"> WebDriverWait(&lt;/span>&lt;span class="mtk1">browser&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk6">3&lt;/span>&lt;span class="mtk1">).until(&lt;/span>&lt;span class="mtk6">EC&lt;/span>&lt;span class="mtk1">.alert_is_present())&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">alert&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">browser&lt;/span>&lt;span class="mtk1">.switch_to.alert&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">alert&lt;/span>&lt;span class="mtk1">.accept()&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">send_flag&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">user_ip&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">except&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">Exception&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">as&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">e&lt;/span>&lt;span class="mtk1">:&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">pass&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">finally&lt;/span>&lt;span class="mtk1">:&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">registered_emails&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">clear&lt;/span>&lt;span class="mtk1">()&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">browser&lt;/span>&lt;span class="mtk1">.quit()&lt;/span>


&lt;span class="mtk8">@&lt;/span>&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk8">.&lt;/span>&lt;span class="mtk8">route&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"/"&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk7 mtki">def&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">index&lt;/span>&lt;span class="mtk1">():&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">render_template&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"index.html"&lt;/span>&lt;span class="mtk1">)&lt;/span>


&lt;span class="mtk8">@&lt;/span>&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk8">.&lt;/span>&lt;span class="mtk8">route&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"/api/register"&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">methods&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1">[&lt;/span>&lt;span class="mtk4">"POST"&lt;/span>&lt;span class="mtk1">])&lt;/span>
&lt;span class="mtk7 mtki">def&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">register&lt;/span>&lt;span class="mtk1">():&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">not&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">request&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">is_json&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">or&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">not&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">request&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">json&lt;/span>&lt;span class="mtk1">[&lt;/span>&lt;span class="mtk4">"email"&lt;/span>&lt;span class="mtk1">]:&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">abort&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk6">400&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">not&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">blacklist_pass&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">request&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">json&lt;/span>&lt;span class="mtk1">[&lt;/span>&lt;span class="mtk4">"email"&lt;/span>&lt;span class="mtk1">]):&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">abort&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk6">401&lt;/span>&lt;span class="mtk1">)&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">registered_emails&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">append&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">request&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">json&lt;/span>&lt;span class="mtk1">[&lt;/span>&lt;span class="mtk4">"email"&lt;/span>&lt;span class="mtk1">])&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">Thread&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">target&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk8">start_bot&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">args&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">request&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">remote_addr&lt;/span>&lt;span class="mtk1">,)).&lt;/span>&lt;span class="mtk8">start&lt;/span>&lt;span class="mtk1">()&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> {&lt;/span>&lt;span class="mtk4">"success"&lt;/span>&lt;span class="mtk1">:&lt;/span>&lt;span class="mtk6">True&lt;/span>&lt;span class="mtk1">}&lt;/span>


&lt;span class="mtk8">@&lt;/span>&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk8">.&lt;/span>&lt;span class="mtk8">route&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"/bot"&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk7 mtki">def&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">bot&lt;/span>&lt;span class="mtk1">():&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">request&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">args&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">get&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"token"&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">""&lt;/span>&lt;span class="mtk1">) &lt;/span>&lt;span class="mtk5">!=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">BOT_TOKEN&lt;/span>&lt;span class="mtk1">:&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">abort&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk6">404&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">render_template&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"bot.html"&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">emails&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1">registered_emails&lt;/span>&lt;span class="mtk1">)&lt;/span>


&lt;span class="mtk8">@&lt;/span>&lt;span class="mtk1">socketio&lt;/span>&lt;span class="mtk8">.&lt;/span>&lt;span class="mtk8">on&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"connect"&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk7 mtki">def&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">on_connect&lt;/span>&lt;span class="mtk1">():&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">socket_clients&lt;/span>&lt;span class="mtk1">[&lt;/span>&lt;span class="mtk1">request&lt;/span>&lt;span class="mtk1">.sid] &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">request&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk1">remote_addr&lt;/span>


&lt;span class="mtk8">@&lt;/span>&lt;span class="mtk1">socketio&lt;/span>&lt;span class="mtk8">.&lt;/span>&lt;span class="mtk8">on&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"disconnect"&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk7 mtki">def&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">on_disconnect&lt;/span>&lt;span class="mtk1">():&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">del&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">socket_clients&lt;/span>&lt;span class="mtk1">[&lt;/span>&lt;span class="mtk1">request&lt;/span>&lt;span class="mtk1">.sid]&lt;/span>


&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">__name__&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">==&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">"__main__"&lt;/span>&lt;span class="mtk1">:&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">run&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">host&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk4">"0.0.0.0"&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">port&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk6">1337&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">debug&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk6">False&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>The only user input in the website is at the bottom of the page, where we are supposed to put an email address:&lt;/p></description></item><item><title>Spybug</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/spybug/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/spybug/</guid><description>&lt;p>We are given a website like this:&lt;/p>
&lt;p>&lt;img alt="SpyBug 1" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-Spybug-1.webp">&lt;/p>
&lt;p>We also have the source code of the web application in Node.js and the source code of an agent in Go.&lt;/p>
&lt;h2 id="source-code-analysis">Source code analysis&lt;/h2>
&lt;p>The web application is built with Express JS. In &lt;code>index.js&lt;/code> we can see a Content Security Policy (CSP) header and a function &lt;code>visitPanel&lt;/code> that runs every minute:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="mtk1">application&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">use&lt;/span>&lt;span class="mtk1">((&lt;/span>&lt;span class="mtk9 mtki">req&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk8">next&lt;/span>&lt;span class="mtk1">) &lt;/span>&lt;span class="mtk7 mtki">=&amp;gt;&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">setHeader&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"Content-Security-Policy"&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">"script-src 'self'; frame-ancestors 'none'; object&lt;/span>&lt;span class="mtk4">-src 'none'; base-uri 'none';"&lt;/span>&lt;span class="mtk1">);&lt;/span> 
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">setHeader&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"Cache-Control"&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">"no-cache, no-store, must-revalidate"&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">setHeader&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"Pragma"&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">"no-cache"&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">setHeader&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"Expires"&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">"0"&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">next&lt;/span>&lt;span class="mtk1">();&lt;/span>
&lt;span class="mtk1">});&lt;/span>

&lt;span class="mtk1">application&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">set&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"view engine"&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">"pug"&lt;/span>&lt;span class="mtk1">);&lt;/span>

&lt;span class="mtk1">application&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">use&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">genericRoutes&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk1">application&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">use&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">panelRoutes&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk1">application&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">use&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">agentRoutes&lt;/span>&lt;span class="mtk1">);&lt;/span>

&lt;span class="mtk1">application&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">listen&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk6">1337&lt;/span>, &lt;/span>&lt;span class="mtk4">"0.0.0.0"&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk5">async&lt;/span>&lt;span class="mtk1"> () &lt;/span>&lt;span class="mtk7 mtki">=&amp;gt;&lt;/span>&lt;span class="mtk1"> {
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">console&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">log&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">`Listening on port 1337`&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk1">});&lt;/span>

&lt;span class="mtk8">createAdmin&lt;/span>&lt;span class="mtk1">();&lt;/span>
&lt;span class="mtk7">setInterval&lt;/span>&lt;span class="mtk1">(visitPanel, &lt;/span>&lt;span class="mtk6">60000&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>The CSP is very strict, we can see some comments on it in a &lt;a target="_blank" href="https://csp-evaluator.withgoogle.com">CSP evaluator&lt;/a>:&lt;/p></description></item><item><title>Templated</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/templated/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/templated/</guid><description>&lt;p>We are given a website built with Flask:&lt;/p>
&lt;p>&lt;img alt="Templated 1" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-Templated-1.webp">&lt;/p>
&lt;p>If we try a random route, it is reflected in the HTML document:&lt;/p>
&lt;p>&lt;img alt="Templated 2" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-Templated-2.webp">&lt;/p>
&lt;p>So, if might be probably vulnerable to a Server-Side Template Injection (SSTI). Let&amp;rsquo;s try with &lt;code>{{7*7}}&lt;/code>:&lt;/p>
&lt;p>&lt;img alt="Templated 3" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-Templated-3.webp">&lt;/p>
&lt;p>And indeed it is vulnerable, because we see &lt;code>49&lt;/code>. Now, we can go to &lt;a target="_blank" href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#jinja2">PayloadsAllTheThings&lt;/a> and use another SSTI payload to obtain Remote Code Execution (RCE) on the server:&lt;/p></description></item><item><title>Testimonial</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/testimonial/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/testimonial/</guid><description>&lt;p>We are given the following website:&lt;/p>
&lt;p>&lt;img alt="Testimonial 1" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-Testimonial-1.webp">&lt;/p>
&lt;p>Moreover, we have a gRPC endpoint at &lt;code>94.237.58.102:53551&lt;/code>.&lt;/p>
&lt;p>We are also given the source code of the project in Go.&lt;/p>
&lt;h2 id="source-code-analysis">Source code analysis&lt;/h2>
&lt;p>This is the main file (&lt;code>main.go&lt;/code>):&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="mtk5">package&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">main&lt;/span>

&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> (&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">"&lt;/span>&lt;span class="mtk4 detected-link">embed&lt;/span>&lt;span class="mtk4">"&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">"&lt;/span>&lt;span class="mtk4 detected-link">htbchal/handler&lt;/span>&lt;span class="mtk4">"&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">"&lt;/span>&lt;span class="mtk4 detected-link">htbchal/pb&lt;/span>&lt;span class="mtk4">"&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">"&lt;/span>&lt;span class="mtk4 detected-link">log&lt;/span>&lt;span class="mtk4">"&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">"&lt;/span>&lt;span class="mtk4 detected-link">net&lt;/span>&lt;span class="mtk4">"&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">"&lt;/span>&lt;span class="mtk4 detected-link">net/http&lt;/span>&lt;span class="mtk4">"&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">"&lt;/span>&lt;span class="mtk4 detected-link">github.com/go-chi/chi/v5&lt;/span>&lt;span class="mtk4">"&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">"&lt;/span>&lt;span class="mtk4 detected-link">google.golang.org/grpc&lt;/span>&lt;span class="mtk4">"&lt;/span>
&lt;span class="mtk1">)&lt;/span>

&lt;span class="mtk3">//go:embed public&lt;/span>
&lt;span class="mtk5">var&lt;/span>&lt;span class="mtk1"> FS &lt;/span>&lt;span class="mtk8 mtku">embed&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8 mtku">FS&lt;/span>

&lt;span class="mtk5">func&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">main&lt;/span>&lt;span class="mtk1">() {&lt;/span>
&lt;span class="mtk1"> router &lt;/span>&lt;span class="mtk5">:=&lt;/span>&lt;span class="mtk1"> chi.&lt;/span>&lt;span class="mtk8">NewMux&lt;/span>&lt;span class="mtk1">()&lt;/span>

&lt;span class="mtk1"> router.&lt;/span>&lt;span class="mtk8">Handle&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"/*"&lt;/span>&lt;span class="mtk1">, http.&lt;/span>&lt;span class="mtk8">StripPrefix&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"/"&lt;/span>&lt;span class="mtk1">, http.&lt;/span>&lt;span class="mtk8">FileServer&lt;/span>&lt;span class="mtk1">(http.&lt;/span>&lt;span class="mtk8">FS&lt;/span>&lt;span class="mtk1">(FS))))&lt;/span> 
&lt;span class="mtk1"> router.&lt;/span>&lt;span class="mtk8">Get&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"/"&lt;/span>&lt;span class="mtk1">, handler.&lt;/span>&lt;span class="mtk8">MakeHandler&lt;/span>&lt;span class="mtk1">(handler.HandleHomeIndex))&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">go&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">startGRPC&lt;/span>&lt;span class="mtk1">()&lt;/span>
&lt;span class="mtk1"> log.&lt;/span>&lt;span class="mtk8">Fatal&lt;/span>&lt;span class="mtk1">(http.&lt;/span>&lt;span class="mtk8">ListenAndServe&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">":1337"&lt;/span>&lt;span class="mtk1">, router))&lt;/span>
&lt;span class="mtk1">}&lt;/span>

&lt;span class="mtk5">type&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">server&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">struct&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">pb&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8 mtku">RickyServiceServer&lt;/span>
&lt;span class="mtk1">}&lt;/span>

&lt;span class="mtk5">func&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">startGRPC&lt;/span>&lt;span class="mtk1">() &lt;/span>&lt;span class="mtk7 mtki">error&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> lis, err &lt;/span>&lt;span class="mtk5">:=&lt;/span>&lt;span class="mtk1"> net.&lt;/span>&lt;span class="mtk8">Listen&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"tcp"&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">":50045"&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> err &lt;/span>&lt;span class="mtk5">!=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk6">nil&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> log.&lt;/span>&lt;span class="mtk8">Fatal&lt;/span>&lt;span class="mtk1">(err)&lt;/span>
&lt;span class="mtk1"> }&lt;/span>
&lt;span class="mtk1"> s &lt;/span>&lt;span class="mtk5">:=&lt;/span>&lt;span class="mtk1"> grpc.&lt;/span>&lt;span class="mtk8">NewServer&lt;/span>&lt;span class="mtk1">()&lt;/span>

&lt;span class="mtk1"> pb.&lt;/span>&lt;span class="mtk8">RegisterRickyServiceServer&lt;/span>&lt;span class="mtk1">(s, &lt;/span>&lt;span class="mtk5">&amp;amp;&lt;/span>&lt;span class="mtk8 mtku">server&lt;/span>&lt;span class="mtk1">{})&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> err &lt;/span>&lt;span class="mtk5">:=&lt;/span>&lt;span class="mtk1"> s.&lt;/span>&lt;span class="mtk8">Serve&lt;/span>&lt;span class="mtk1">(lis); err &lt;/span>&lt;span class="mtk5">!=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk6">nil&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> log.&lt;/span>&lt;span class="mtk8">Fatal&lt;/span>&lt;span class="mtk1">(err)&lt;/span>
&lt;span class="mtk1"> }&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk6">nil&lt;/span>
&lt;span class="mtk1">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>As can be seen, it uses a handler to manage HTTP requests (&lt;code>handler/home.go&lt;/code>):&lt;/p></description></item><item><title>The Magic Informer</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/the-magic-informer/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/the-magic-informer/</guid><description>&lt;p>We are given this website:&lt;/p>
&lt;p>&lt;img alt="The Magic Informer 1" src="https://7rocky.github.io/images/other/HTB%20UniCTF/The-Magic-Informer-1.webp">&lt;/p>
&lt;p>This time we don&amp;rsquo;t have source code available, so we must poke around with the website.&lt;/p>
&lt;h2 id="registering-a-new-account">Registering a new account&lt;/h2>
&lt;p>At the bottom of the page we can find a link to a registration form:&lt;/p>
&lt;p>&lt;img alt="The Magic Informer 2" src="https://7rocky.github.io/images/other/HTB%20UniCTF/The-Magic-Informer-2.webp">&lt;/p>
&lt;p>So we can register and then log in:&lt;/p>
&lt;p>&lt;img alt="The Magic Informer 3" src="https://7rocky.github.io/images/other/HTB%20UniCTF/The-Magic-Informer-3.webp">&lt;/p>
&lt;p>And we get access to our dashboard:&lt;/p>
&lt;p>&lt;img alt="The Magic Informer 4" src="https://7rocky.github.io/images/other/HTB%20UniCTF/The-Magic-Informer-4.webp">&lt;/p></description></item><item><title>TimeKORP</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/timekorp/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/timekorp/</guid><description>&lt;p>We are provided with this webpage:&lt;/p>
&lt;p>&lt;img alt="TimeKORP 1" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-TimeKORP-1.webp">&lt;/p>
&lt;p>It only shows the time/date using a given format (default is &lt;code>%H:%M:%S&lt;/code>)&lt;/p>
&lt;p>&lt;img alt="TimeKORP 2" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-TimeKORP-2.webp">&lt;/p>
&lt;h2 id="command-injection">Command injection&lt;/h2>
&lt;p>If we use another string as &lt;code>format&lt;/code> it is printed on the page:&lt;/p>
&lt;p>&lt;img alt="TimeKORP 3" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-TimeKORP-3.webp">&lt;/p>
&lt;p>We might guess that the server is just running something like:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="code-cyan">$&lt;/span> &lt;span class="code-dark-green">date&lt;/span> +&lt;span class="code-dark-yellow">'%H:%M:%S'&lt;/span> 
15:43:24

&lt;span class="code-cyan">$&lt;/span> &lt;span class="code-dark-green">date&lt;/span> +&lt;span class="code-dark-yellow">'asdf'&lt;/span>
asdf
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>Hence, the webserver might have a function like this one:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="mtk5">from&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">subprocess&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">check_output&lt;/span>

&lt;span class="mtk7 mtki">def&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">date&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk9 mtki">format&lt;/span>&lt;span class="mtk1">: &lt;/span>&lt;span class="mtk8 mtku">str&lt;/span>&lt;span class="mtk1">) -&amp;gt; &lt;/span>&lt;span class="mtk8 mtku">str&lt;/span>&lt;span class="mtk1">:&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">check_output&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk7 mtki">f&lt;/span>&lt;span class="mtk4">"date +'&lt;/span>&lt;span class="mtk6">{&lt;/span>&lt;span class="mtk9 mtki">format&lt;/span>&lt;span class="mtk6">}&lt;/span>&lt;span class="mtk4">'"&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">shell&lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk6">True&lt;/span>&lt;span class="mtk1">).&lt;/span>&lt;span class="mtk8">decode&lt;/span>&lt;span class="mtk1">()&lt;/span> 
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>If this is true, we might be able to add a single quote and inject another command.&lt;/p></description></item><item><title>Toxic</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/toxic/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/toxic/</guid><description>&lt;p>We are given a website like this:&lt;/p>
&lt;p>&lt;img alt="Toxic 1" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-Toxic-1.webp">&lt;/p>
&lt;p>We are also given the server source code in PHP.&lt;/p>
&lt;h2 id="source-code-analysis">Source code analysis&lt;/h2>
&lt;p>This is &lt;code>index.php&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="mtk5">&amp;lt;?php&lt;/span>
&lt;span class="mtk7">spl_autoload_register&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk7 mtki">function&lt;/span>&lt;span class="mtk1"> ($name){&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> (&lt;/span>&lt;span class="mtk7">preg_match&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'/Model&lt;/span>&lt;span class="mtk5">$&lt;/span>&lt;span class="mtk4">/'&lt;/span>&lt;span class="mtk1">, $name))&lt;/span>
&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> $name &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">"models/&lt;/span>&lt;span class="mtk1">${name}&lt;/span>&lt;span class="mtk4">"&lt;/span>&lt;span class="mtk1">;&lt;/span>
&lt;span class="mtk1"> }&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">include_once&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">"&lt;/span>&lt;span class="mtk1">${name}&lt;/span>&lt;span class="mtk4">.php"&lt;/span>&lt;span class="mtk1">;&lt;/span>
&lt;span class="mtk1">});&lt;/span>

&lt;span class="mtk5">if&lt;/span>&lt;span class="mtk1"> (&lt;/span>&lt;span class="mtk7">empty&lt;/span>&lt;span class="mtk1">($_COOKIE[&lt;/span>&lt;span class="mtk4">'PHPSESSID'&lt;/span>&lt;span class="mtk1">]))&lt;/span>
&lt;span class="mtk1">{&lt;/span>
&lt;span class="mtk1"> $page &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">new&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">PageModel&lt;/span>&lt;span class="mtk1">;&lt;/span>
&lt;span class="mtk1"> $page&lt;/span>&lt;span class="mtk5">-&amp;gt;&lt;/span>&lt;span class="mtk1">file &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">'/www/index.html'&lt;/span>&lt;span class="mtk1">;&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7">setcookie&lt;/span>&lt;span class="mtk1">(&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">'PHPSESSID'&lt;/span>&lt;span class="mtk1">, &lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7">base64_encode&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk7">serialize&lt;/span>&lt;span class="mtk1">($page)), &lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7">time&lt;/span>&lt;span class="mtk1">()&lt;/span>&lt;span class="mtk5">+&lt;/span>&lt;span class="mtk6">60&lt;/span>&lt;span class="mtk5">*&lt;/span>&lt;span class="mtk6">60&lt;/span>&lt;span class="mtk5">*&lt;/span>&lt;span class="mtk6">24&lt;/span>&lt;span class="mtk1">, &lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">'/'&lt;/span>
&lt;span class="mtk1"> );&lt;/span>
&lt;span class="mtk1">} &lt;/span>

&lt;span class="mtk1">$cookie &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7">base64_decode&lt;/span>&lt;span class="mtk1">($_COOKIE[&lt;/span>&lt;span class="mtk4">'PHPSESSID'&lt;/span>&lt;span class="mtk1">]);&lt;/span> 
&lt;span class="mtk7">unserialize&lt;/span>&lt;span class="mtk1">($cookie);&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>As we can see, the server encodes a page (&lt;code>/www/index.html&lt;/code> by default) in the &lt;code>PHPSESSID&lt;/code> cookie, and it is also serialized:&lt;/p></description></item><item><title>Trapped Source</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/trapped-source/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/trapped-source/</guid><description>&lt;p>We are given this website:&lt;/p>
&lt;p>&lt;img alt="Trapped Source 1" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-Trapped-Source-1.webp">&lt;/p>
&lt;p>It looks like a panel where we must enter a PIN.&lt;/p>
&lt;h2 id="inspecting-html-code">Inspecting HTML code&lt;/h2>
&lt;p>If we press &lt;code>Ctrl-U&lt;/code> on the keyboard, we will see the HTML code of the website:&lt;/p>
&lt;p>&lt;img alt="Trapped Source 2" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-Trapped-Source-2.webp">&lt;/p>
&lt;p>Surprise! The expected pin is there in clear text: &lt;code>1425&lt;/code>. Let&amp;rsquo;s put it:&lt;/p>
&lt;p>&lt;img alt="Trapped Source 3" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-Trapped-Source-3.webp">&lt;/p>
&lt;h2 id="flag">Flag&lt;/h2>
&lt;p>And there&amp;rsquo;s the flag:&lt;/p>
&lt;p>&lt;img alt="Trapped Source 4" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-Trapped-Source-4.webp">&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">HTB{vi3w_cli13nt_s0urc3_S3cr3ts!} 
&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>TrapTrack</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/traptrack/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/traptrack/</guid><description>&lt;p>We are given a website like this:&lt;/p>
&lt;p>&lt;img alt="TrapTrack 1" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-TrapTrack-1.webp">&lt;/p>
&lt;p>We are also given the source code of the project.&lt;/p>
&lt;h2 id="website-functionality">Website functionality&lt;/h2>
&lt;p>The web application allows us to enter URLs that will be stored in a SQLite3 database. Just reading the code from &lt;code>challenge/application/config.py&lt;/code>, we have valid credentials (&lt;code>admin:admin&lt;/code>):&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="mtk5">from&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">application&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8 mtku">util&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">generate&lt;/span>
&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">os&lt;/span>

&lt;span class="mtk7 mtki">class&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">Config&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk8 mtku">object&lt;/span>&lt;span class="mtk1">):&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">SECRET_KEY&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">generate&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk6">50&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">ADMIN_USERNAME&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">'admin'&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">ADMIN_PASSWORD&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">'admin'&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">SESSION_PERMANENT&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk6">False&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">SESSION_TYPE&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">'filesystem'&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">SQLALCHEMY_DATABASE_URI&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">'sqlite:////tmp/database.db'&lt;/span> 
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">REDIS_HOST&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">'127.0.0.1'&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">REDIS_PORT&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk6">6379&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">REDIS_JOBS&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">'jobs'&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">REDIS_QUEUE&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">'jobqueue'&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">REDIS_NUM_JOBS&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk6">100&lt;/span>

&lt;span class="mtk7 mtki">class&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">ProductionConfig&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk8 mtku">Config&lt;/span>&lt;span class="mtk1">):&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">pass&lt;/span>

&lt;span class="mtk7 mtki">class&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">DevelopmentConfig&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk8 mtku">Config&lt;/span>&lt;span class="mtk1">):&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">DEBUG&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk6">True&lt;/span>

&lt;span class="mtk7 mtki">class&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">TestingConfig&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk8 mtku">Config&lt;/span>&lt;span class="mtk1">):&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">TESTING&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk6">True&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>So we can access to the main panel:&lt;/p></description></item><item><title>Userland City</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/userland-city/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/userland-city/</guid><description>&lt;p>We are provided with this webpage:&lt;/p>
&lt;p>&lt;img alt="Userland City 1" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-Userland-City-1.webp">&lt;/p>
&lt;h2 id="enumeration">Enumeration&lt;/h2>
&lt;p>It shows a login form. Fortunately, we are given credentials in the challenge description: &lt;code>lxkid02:8rsNN9ohfLp69cVRFEgk4Qzs&lt;/code>. Hence, we can use them to access:&lt;/p>
&lt;p>&lt;img alt="Userland City 2" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-Userland-City-2.webp">&lt;/p>
&lt;p>It is a simple web page for some fake online store for cybercriminals.&lt;/p>
&lt;p>The description of the challenge is quite long. The important things are the already used credentials and that it uses Laravel with debug mode activated.&lt;/p></description></item><item><title>wafwaf</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/wafwaf/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/wafwaf/</guid><description>&lt;p>We are given the following website, which also shows the relevant PHP source code:&lt;/p>
&lt;p>&lt;img alt="wafwaf 1" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-wafwaf-1.webp">&lt;/p>
&lt;h2 id="source-code-analysis">Source code analysis&lt;/h2>
&lt;p>The first thing we notice is a clear SQL injection:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="mtk1"> $obj &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> $db&lt;/span>&lt;span class="mtk5">-&amp;gt;&lt;/span>&lt;span class="mtk8">waf&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk7">file_get_contents&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'php://input'&lt;/span>&lt;span class="mtk1">));&lt;/span>
&lt;span class="mtk1"> $db&lt;/span>&lt;span class="mtk5">-&amp;gt;&lt;/span>&lt;span class="mtk8">query&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"&lt;/span>&lt;span class="mtk5">SELECT&lt;/span>&lt;span class="mtk4"> note &lt;/span>&lt;span class="mtk5">FROM&lt;/span>&lt;span class="mtk4"> notes &lt;/span>&lt;span class="mtk5">WHERE&lt;/span>&lt;span class="mtk4"> assignee &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk4"> '%s'&lt;/span>&lt;span class="mtk4">"&lt;/span>&lt;span class="mtk1">, $obj&lt;/span>&lt;span class="mtk5">-&amp;gt;&lt;/span>&lt;span class="mtk1">user);&lt;/span> 
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>This happens because the value of &lt;code>$obj-&amp;gt;user&lt;/code> is inserted directly into the SQL query, without prepared statements.&lt;/p>
&lt;p>However, there is a &lt;code>waf&lt;/code> function that acts like a WAF (Web Application Firewall):&lt;/p></description></item><item><title>Watersnake</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/watersnake/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/watersnake/</guid><description>&lt;p>We are given a website like this:&lt;/p>
&lt;p>&lt;img alt="Watersnake 1" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-Watersnake-1.webp">&lt;/p>
&lt;p>We also have the source code in Java (SpringBoot).&lt;/p>
&lt;h2 id="source-code-analysis">Source code analysis&lt;/h2>
&lt;p>This is the main application file (&lt;code>Application.java&lt;/code>):&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="mtk5">package&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">com.lean.watersnake&lt;/span>&lt;span class="mtk1">;&lt;/span>

&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">java.util.Arrays&lt;/span>&lt;span class="mtk1">;&lt;/span>

&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">org.springframework.boot.CommandLineRunner&lt;/span>&lt;span class="mtk1">;&lt;/span>
&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">org.springframework.boot.SpringApplication&lt;/span>&lt;span class="mtk1">;&lt;/span>
&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">org.springframework.boot.autoconfigure.SpringBootA&lt;/span>&lt;span class="mtk5">pplication&lt;/span>&lt;span class="mtk1">;&lt;/span> 
&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">org.springframework.context.ApplicationContext&lt;/span>&lt;span class="mtk1">;&lt;/span>

&lt;span class="mtk1">@&lt;/span>&lt;span class="mtk7 mtki">SpringBootApplication&lt;/span>
&lt;span class="mtk5">public&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">class&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">Application&lt;/span>&lt;span class="mtk1"> {&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">public&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">static&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">void&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">main&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk7 mtki">String&lt;/span>&lt;span class="mtk1">[] &lt;/span>&lt;span class="mtk9 mtki">args&lt;/span>&lt;span class="mtk1">) {&lt;/span>
&lt;span class="mtk1"> SpringApplication.&lt;/span>&lt;span class="mtk8">run&lt;/span>&lt;span class="mtk1">(Application.class, args);&lt;/span>
&lt;span class="mtk1"> }&lt;/span>

&lt;span class="mtk1">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>We can find the available endpoints at &lt;code>Controller.java&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="mtk5">package&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">com.lean.watersnake&lt;/span>&lt;span class="mtk1">;&lt;/span>

&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">org.springframework.web.bind.annotation.GetMapping&lt;/span>&lt;span class="mtk1">;&lt;/span>
&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">org.springframework.web.bind.annotation.PostMappin&lt;/span>&lt;span class="mtk5">g&lt;/span>&lt;span class="mtk1">;&lt;/span>
&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">org.springframework.web.bind.annotation.RequestPar&lt;/span>&lt;span class="mtk5">am&lt;/span>&lt;span class="mtk1">;&lt;/span>
&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">org.springframework.web.bind.annotation.RestContro&lt;/span>&lt;span class="mtk5">ller&lt;/span>&lt;span class="mtk1">;&lt;/span>

&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">org.yaml.snakeyaml.Yaml&lt;/span>&lt;span class="mtk1">;&lt;/span>

&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">java.io.IOException&lt;/span>&lt;span class="mtk1">; &lt;/span>
&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">java.io.ByteArrayInputStream&lt;/span>&lt;span class="mtk1">;&lt;/span>
&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">java.io.InputStream&lt;/span>&lt;span class="mtk1">;&lt;/span>
&lt;span class="mtk5">import&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">java.util.Map&lt;/span>&lt;span class="mtk1">;&lt;/span>

&lt;span class="mtk1">@&lt;/span>&lt;span class="mtk7 mtki">RestController&lt;/span>
&lt;span class="mtk5">public&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">class&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8 mtku">Controller&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">GetWaterLevel&lt;/span>&lt;span class="mtk1"> sensorReader &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">new&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">GetWaterLevel&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"./watersensor --init"&lt;/span>&lt;span class="mtk1">);&lt;/span>

&lt;span class="mtk1"> @&lt;/span>&lt;span class="mtk7 mtki">GetMapping&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"/"&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">public&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">String&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">index&lt;/span>&lt;span class="mtk1">() {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">"&amp;lt;meta http-equiv=&lt;/span>&lt;span class="mtk6">\"&lt;/span>&lt;span class="mtk4">Refresh&lt;/span>&lt;span class="mtk6">\"&lt;/span>&lt;span class="mtk4"> content=&lt;/span>&lt;span class="mtk6">\"&lt;/span>&lt;span class="mtk4">0; url='https://7rocky.github.io/index.html'&lt;/span>&lt;span class="mtk6">\"&lt;/span>&lt;span class="mtk4"> /&amp;gt;"&lt;/span>&lt;span class="mtk1">;&lt;/span> 
&lt;span class="mtk1"> }&lt;/span>

&lt;span class="mtk1"> @&lt;/span>&lt;span class="mtk7 mtki">GetMapping&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"/stats"&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">public&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">String&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">stats&lt;/span>&lt;span class="mtk1">() {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">try&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> sensorReader.&lt;/span>&lt;span class="mtk8">readFromSensor&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"./watersensor --stats"&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk1"> } &lt;/span>&lt;span class="mtk5">catch&lt;/span>&lt;span class="mtk1"> (&lt;/span>&lt;span class="mtk7 mtki">IOException&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">e&lt;/span>&lt;span class="mtk1">) {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">"Sensor error"&lt;/span>&lt;span class="mtk1">;&lt;/span>
&lt;span class="mtk1"> }&lt;/span>
&lt;span class="mtk1"> }&lt;/span>

&lt;span class="mtk1"> @&lt;/span>&lt;span class="mtk7 mtki">PostMapping&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">"/update"&lt;/span>&lt;span class="mtk1">)&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">public&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">String&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">update&lt;/span>&lt;span class="mtk1">(@&lt;/span>&lt;span class="mtk7 mtki">RequestParam&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk6">name&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">"config"&lt;/span>&lt;span class="mtk1">) &lt;/span>&lt;span class="mtk7 mtki">String&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">updateConfig&lt;/span>&lt;span class="mtk1">) {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">InputStream&lt;/span>&lt;span class="mtk1"> is &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">new&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">ByteArrayInputStream&lt;/span>&lt;span class="mtk1">(updateConfig.&lt;/span>&lt;span class="mtk8">getBytes&lt;/span>&lt;span class="mtk1">());&lt;/span>
&lt;span class="mtk1"> &lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">Yaml&lt;/span>&lt;span class="mtk1"> yaml &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">new&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">Yaml&lt;/span>&lt;span class="mtk1">();&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk7 mtki">Map&lt;/span>&lt;span class="mtk1">&amp;lt;&lt;/span>&lt;span class="mtk7 mtki">String&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk7 mtki">Object&lt;/span>&lt;span class="mtk1">&amp;gt; obj &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> yaml.&lt;/span>&lt;span class="mtk8">load&lt;/span>&lt;span class="mtk1">(is);&lt;/span>

&lt;span class="mtk1"> obj.&lt;/span>&lt;span class="mtk8">forEach&lt;/span>&lt;span class="mtk1">((key, value) &lt;/span>&lt;span class="mtk7 mtki">-&amp;gt;&lt;/span>&lt;span class="mtk1"> System.out.&lt;/span>&lt;span class="mtk8">println&lt;/span>&lt;span class="mtk1">(key &lt;/span>&lt;span class="mtk5">+&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">":"&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">+&lt;/span>&lt;span class="mtk1"> value));&lt;/span>

&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk4">"Config queued for firmware update"&lt;/span>&lt;span class="mtk1">;&lt;/span>
&lt;span class="mtk1"> }&lt;/span>
&lt;span class="mtk1">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>Here we can see a way to update some configuration using YAML (&lt;code>/update&lt;/code>). This the page that performs the firmware update:&lt;/p></description></item><item><title>Wild Goose Hunt</title><link>https://7rocky.github.io/en/ctf/htb-challenges/web/wild-goose-hunt/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://7rocky.github.io/en/ctf/htb-challenges/web/wild-goose-hunt/</guid><description>&lt;p>We are given this website:&lt;/p>
&lt;p>&lt;img alt="Wild Goose Hunt 1" src="https://7rocky.github.io/images/HTB-Challenges/HTB-Web-Wild-Goose-Hunt-1.webp">&lt;/p>
&lt;p>We are also given the source code of the project in Node.js (Express).&lt;/p>
&lt;h2 id="source-code-analysis">Source code analysis&lt;/h2>
&lt;p>This is &lt;code>index.js&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2">&lt;code class="no-highlight">&lt;span class="mtk7 mtki">const&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">express&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">require&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'express'&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk7 mtki">const&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">express&lt;/span>&lt;span class="mtk1">();&lt;/span>
&lt;span class="mtk7 mtki">const&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">bodyParser&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">require&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'body-parser'&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk7 mtki">const&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">routes&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">require&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'./routes'&lt;/span>&lt;span class="mtk1">);&lt;/span>
&lt;span class="mtk7 mtki">const&lt;/span>&lt;span class="mtk1"> mongoose &lt;/span>&lt;span class="mtk5">=&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk8">require&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'mongoose'&lt;/span>&lt;span class="mtk1">);&lt;/span>

&lt;span class="mtk1">mongoose.&lt;/span>&lt;span class="mtk8">connect&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'mongodb://localhost:27017/heros'&lt;/span>&lt;span class="mtk1">, { &lt;/span>&lt;span class="mtk1">useNewUrlParser&lt;/span>&lt;span class="mtk1">: &lt;/span>&lt;span class="mtk6">true&lt;/span>&lt;span class="mtk1"> , &lt;/span>&lt;span class="mtk1">useUnifiedTopology&lt;/span>&lt;span class="mtk1">: &lt;/span>&lt;span class="mtk6">true&lt;/span>&lt;span class="mtk1"> });&lt;/span> 

&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">use&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">bodyParser&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">json&lt;/span>&lt;span class="mtk1">());&lt;/span>
&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">use&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">bodyParser&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">urlencoded&lt;/span>&lt;span class="mtk1">({ &lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">extended&lt;/span>&lt;span class="mtk1">: &lt;/span>&lt;span class="mtk6">true&lt;/span>&lt;span class="mtk1"> &lt;/span>
&lt;span class="mtk1">}));&lt;/span>

&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">use&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk8">express&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">static&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'static'&lt;/span>&lt;span class="mtk1">));&lt;/span>
&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">set&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'view engine'&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk4">'pug'&lt;/span>&lt;span class="mtk1">);&lt;/span>

&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">use&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk1">routes&lt;/span>&lt;span class="mtk1">);&lt;/span>

&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">all&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'*'&lt;/span>&lt;span class="mtk1">, (&lt;/span>&lt;span class="mtk9 mtki">req&lt;/span>&lt;span class="mtk1">, &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">) &lt;/span>&lt;span class="mtk7 mtki">=&amp;gt;&lt;/span>&lt;span class="mtk1"> {&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk5">return&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk9 mtki">res&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">status&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk6">404&lt;/span>&lt;span class="mtk1">).&lt;/span>&lt;span class="mtk8">send&lt;/span>&lt;span class="mtk1">({&lt;/span>
&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">message&lt;/span>&lt;span class="mtk1">: &lt;/span>&lt;span class="mtk4">'404 page not found'&lt;/span>
&lt;span class="mtk1"> });&lt;/span>
&lt;span class="mtk1">});&lt;/span>

&lt;span class="mtk1">app&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">listen&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk6">1337&lt;/span>&lt;span class="mtk1">, () &lt;/span>&lt;span class="mtk7 mtki">=&amp;gt;&lt;/span>&lt;span class="mtk1"> &lt;/span>&lt;span class="mtk1">console&lt;/span>&lt;span class="mtk1">.&lt;/span>&lt;span class="mtk8">log&lt;/span>&lt;span class="mtk1">(&lt;/span>&lt;span class="mtk4">'Listening on port 1337'&lt;/span>&lt;span class="mtk1">));&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>

&lt;p>Here we see that the server uses MongoDB for the database using &lt;code>mongoose&lt;/code> as Object-Document Mapper (ODM). Its version is 5.10.10, according to &lt;code>package.json&lt;/code>:&lt;/p></description></item></channel></rss>