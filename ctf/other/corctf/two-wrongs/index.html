<!doctype html><html lang="es"><head><title>two-wrongs | 7Rocky</title>
<meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="author" content="Blog de 7Rocky. Ciberseguridad y Mates"><meta name="description" content="corCTF 2024. Computación cuántica. Corrección de errores cuánticos"><meta name="image" content="https://7rocky.github.io/images/cryptography.png"><meta name="robots" content="index, follow"><meta name="viewport" content="width=device-width,minimum-scale=1"><meta itemprop="description" content="corCTF 2024. Computación cuántica. Corrección de errores cuánticos"><meta itemprop="keywords" content><meta itemprop="name" content="two-wrongs"><meta property="article:published_time" content><meta property="og:author" content="Blog de 7Rocky. Ciberseguridad y Mates"><meta property="og:description" content="corCTF 2024. Computación cuántica. Corrección de errores cuánticos"><meta property="og:image" content="https://7rocky.github.io/images/cryptography.png"><meta property="og:locale" content="es_ES"><meta property="og:site_name" content="Blog de 7Rocky. Ciberseguridad y Mates"><meta property="og:title" content="two-wrongs"><meta property="og:type" content="website"><meta property="og:url" content="https://7rocky.github.io/ctf/other/corctf/two-wrongs/"><meta name="twitter:author" content="Blog de 7Rocky. Ciberseguridad y Mates"><meta name="twitter:card" content="corCTF 2024. Computación cuántica. Corrección de errores cuánticos"><meta name="twitter:description" content="corCTF 2024. Computación cuántica. Corrección de errores cuánticos"><meta name="twitter:image" content="https://7rocky.github.io/images/cryptography.png"><meta name="twitter:title" content="two-wrongs"><link href="/favicon.ico" rel="shortcut icon" type="image/x-icon"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tachyons@4.12.0/css/tachyons.min.css" integrity="sha256-MgEf5i1a74lVzhT+1R6mBbWCUeUaxC8sQTaN5GY+CoI=" crossorigin="anonymous"><link href="/css/main.css" rel="stylesheet"><link href="/css/code.css" rel="stylesheet"><link href="https://7rocky.github.io/ctf/other/corctf/two-wrongs/" rel="canonical"><script async src="https://www.googletagmanager.com/gtag/js?id=G-Z1HQGH3M4D"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-Z1HQGH3M4D")}</script><script>MathJax={loader:{load:["[tex]/noerrors"]},options:{ignoreHtmlClass:"tex2jax_ignore",processHtmlClass:"tex2jax_process",skipHtmlTags:["noscript","pre","script","style","textarea"]},tex:{autoload:{color:[],colorv2:["color"]},displayMath:[["$$","$$"]],inlineMath:[["$","$"]],packages:{"[+]":["noerrors"]},processEnvironments:!0,processEscapes:!0}}</script><script type="text/javascript" src="//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script><div id="math-consts" style="display:none">$
\newcommand{\e}{e}
\newcommand{\N}[1][]{\mathbb{N}^{#1}}
\newcommand{\Q}[1][]{\mathbb{Q}^{#1}}
\newcommand{\R}[1][]{\mathbb{R}^{#1}}
\newcommand{\Z}[1][]{\mathbb{Z}^{#1}}
\newcommand{\C}[1][]{\mathbb{C}^{#1}}
\newcommand{\dx}{\,\mathrm{d}x}
\newcommand{\dy}{\,\mathrm{d}y}
\newcommand{\dz}{\,\mathrm{d}z}
\newcommand{\dt}{\,\mathrm{d}t}
\newcommand{\divides}{\, | \,}
\newcommand{\st}{\; | \;}
\renewcommand{\geq}{\geqslant}
\renewcommand{\leq}{\leqslant}
\renewcommand{\i}{\mathrm{i}}
\newcommand{\rank}{\mathop{\mathrm{rank}}}
\newcommand{\gcd}{\mathop{\mathrm{gcd}}}
\newcommand{\lcm}{\mathop{\mathrm{lcm}}}
\newcommand{\tr}{\mathop{\mathrm{tr}}}
\newcommand{\charField}{\mathop{\mathrm{char}}}
\newcommand{\Image}{\mathop{\mathrm{Im}}}
$</div><script src="/js/imc.js"></script><script>(async()=>await typeset(()=>[`#math-consts`]))()</script></head><body class="ma0 production"><header style="position:sticky;top:0;z-index:9"><div class="bg-black"><nav class="ph4-ns" id="navigation" role="navigation"><div class="flex-l justify-between items-center center"><a class="f3 fw2 hover-white no-underline white-90 dib" href="/" title="7Rocky">7Rocky</a><div class="flex-l items-center"><a href="/search" target class="link-transition link dib z-999 pt3 pt0-l mr1 search-link" title="Buscar" rel="noopener" aria-label="Buscar"><svg height="30" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 487.95 487.95" style="enable-background:new 0 0 487.95 487.95"><g><g><path d="M481.8 453l-140-140.1c27.6-33.1 44.2-75.4 44.2-121.6C386 85.9 299.5.2 193.1.2S0 86 0 191.4s86.5 191.1 192.9 191.1c45.2.0 86.8-15.5 119.8-41.4l140.5 140.5c8.2 8.2 20.4 8.2 28.6.0C490 473.4 490 461.2 481.8 453zM41 191.4c0-82.8 68.2-150.1 151.9-150.1s151.9 67.3 151.9 150.1-68.2 150.1-151.9 150.1S41 274.1 41 191.4z" style="fill-rule:evenodd;clip-rule:evenodd;fill:#a9a9b3"/></g></g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/></svg>
</a><a class="link-transition lang link dib z-999 pt3 pt0-l mr3" href="#" title="es"><img alt="es" height="30px" src="/images/es.png" width="30px">
</a><a class="link-transition lang link dib z-999 pt3 pt0-l" href="/en/ctf/other/corctf/two-wrongs/" title="en"><img alt="en" height="30px" src="/images/en.png" style="border:4px solid#000;border-radius:100%" width="30px"></a><ul class="pl0 ml3 mr3" style="line-height:30px"><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href="/ctf/" title="CTF">CTF</a></li><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href="/htb/" title="HTB">HTB</a></li><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href="/imc/" title="IMC">IMC</a></li></ul><a href="https://www.linkedin.com/in/roberto-gesteira-minarro/" target="_blank" class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel="noopener" aria-label="follow on LinkedIn——Opens in a new window"><svg height="30" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="30" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
<span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</span></a><a href="https://github.com/7Rocky" target="_blank" class="link-transition github link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel="noopener" aria-label="follow on GitHub——Opens in a new window"><svg height="30" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="30" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg>
<span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a></div></div></nav></div></header><main class="pb5" role="main" style="min-height:720px"><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-80-l"><a aria-label="aside" class="instapaper_ignoref b tracked" href="../" style="font-size:1.2rem">&lt;- CORCTF</a><div id="sharing" class="mt3"><a aria-label="share on Facebook" class="facebook no-underline" href="https://www.facebook.com/sharer.php?u=https://7rocky.github.io/ctf/other/corctf/two-wrongs/" title="share on Facebook"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765 50.32h6.744V33.998h4.499l.596-5.624h-5.095l.007-2.816c0-1.466.14-2.253 2.244-2.253h2.812V17.68h-4.5c-5.405.0-7.307 2.729-7.307 7.317v3.377h-3.369v5.625h3.369V50.32zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg>
</a><a aria-label="share on Twitter" class="twitter no-underline" href="https://twitter.com/share?url=https://7rocky.github.io/ctf/other/corctf/two-wrongs/&amp;text=two-wrongs" title="share on Twitter"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</a><a aria-label="share on LinkedIn" class="linkedin no-underline" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://7rocky.github.io/ctf/other/corctf/two-wrongs/&amp;title=two-wrongs" title="share on LinkedIn"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a></div><h1 class="f1 mt3 mb1">two-wrongs</h1><p class="mb4 f6 dib tracked">18 minutos de lectura</p></header><aside aria-label="aside" class="w-20-l mt6-l aside-mobile"><div class="bg-card pa3 nested-list-reset nested-copy-line-height nested-links" style="position:sticky;top:5rem;padding-bottom:0"><p class="f5 b pb2" style="border-bottom:5px solid var(--background);margin:0">Contenidos</p><nav id="TableOfContents"><ul><li><a href="#análisis-del-código-fuente">Análisis del código fuente</a><ul><li><a href="#codificación-de-bits">Codificación de bits</a></li></ul></li><li><a href="#contexto">Contexto</a></li><li><a href="#solución">Solución</a><ul><li><a href="#implementación">Implementación</a></li></ul></li><li><a href="#_flag_"><em>Flag</em></a></li></ul></nav><div class="bg-card" style="border-top:5px solid var(--background)"><a class="bmc-btn w-100" target="_blank" href="http://buymeacoffee.com/7Rocky" style="padding:0" title="Buy me a beer">🍺 <span class="bmc-btn-text" style="font-family:Cookie!important;color:#fff">Buy me a beer</span></a></div></div></aside><div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img pr4-l w-80-l"><p>Se nos proporciona el código fuente en Python que cifra la <em>flag</em>:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk5">from</span><span class="mtk1"> qiskit </span><span class="mtk5">import</span><span class="mtk1"> QuantumCircuit, QuantumRegister, ClassicalRegiste</span><span class="mtk1">r, transpile</span>
<span class="mtk5">from</span><span class="mtk1"> qiskit_aer </span><span class="mtk5">import</span><span class="mtk1"> AerSimulator</span>
<span class="mtk5">import</span><span class="mtk1"> </span><span class="mtk8 mtku">numpy</span><span class="mtk1"> </span><span class="mtk5">as</span><span class="mtk1"> </span><span class="mtk8 mtku">np</span>
<span class="mtk5">import</span><span class="mtk1"> </span><span class="mtk8 mtku">random</span><span class="mtk1">, </span><span class="mtk8 mtku">os</span><span class="mtk1">, </span><span class="mtk8 mtku">binascii</span><span class="mtk1">, </span><span class="mtk8 mtku">sys</span>
<span class="mtk5">from</span><span class="mtk1"> </span><span class="mtk8 mtku">Crypto</span><span class="mtk1">.</span><span class="mtk8 mtku">Cipher</span><span class="mtk1"> </span><span class="mtk5">import</span><span class="mtk1"> </span><span class="mtk8 mtku">AES</span>
<span class="mtk5">from</span><span class="mtk1"> flag </span><span class="mtk5">import</span><span class="mtk1"> flag</span>

<span class="mtk1">key</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">os</span><span class="mtk1">.</span><span class="mtk8">urandom</span><span class="mtk1">(</span><span class="mtk6">16</span><span class="mtk1">)</span>
<span class="mtk1">cipher</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">AES</span><span class="mtk1">.</span><span class="mtk8">new</span><span class="mtk1">(</span><span class="mtk1">key</span><span class="mtk1">, </span><span class="mtk8 mtku">AES</span><span class="mtk1">.</span><span class="mtk1">MODE_ECB</span><span class="mtk1">)</span>

<span class="mtk1">sv_sim</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> AerSimulator(</span><span class="mtk9 mtki">method</span><span class="mtk5">=</span><span class="mtk4">"statevector"</span><span class="mtk1">)</span>
<span class="mtk1">bit_idxs</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">list</span><span class="mtk1">(</span><span class="mtk8 mtku">map</span><span class="mtk1">(</span><span class="mtk8 mtku">int</span><span class="mtk1">, </span><span class="mtk8">input</span><span class="mtk1">(</span><span class="mtk4">'Select a sensor index to remove from each bit: '</span><span class="mtk1">).</span><span class="mtk8">split</span><span class="mtk1">(</span><span class="mtk4">' '</span><span class="mtk1">)))</span>

<span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">enc_byte</span><span class="mtk1">(</span><span class="mtk9 mtki">b</span><span class="mtk1">):</span>
<span class="mtk1">    </span><span class="mtk1">sensor_vals</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk4">''</span>
<span class="mtk1">    </span><span class="mtk1">bit_encs</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> []</span>
<span class="mtk1">    </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">bit</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8">format</span><span class="mtk1">(</span><span class="mtk9 mtki">b</span><span class="mtk1">, </span><span class="mtk4">'08b'</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk1">seed</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">int</span><span class="mtk1">.</span><span class="mtk8">from_bytes</span><span class="mtk1">(</span><span class="mtk8 mtku">os</span><span class="mtk1">.</span><span class="mtk8">urandom</span><span class="mtk1">(</span><span class="mtk6">8</span><span class="mtk1">), </span><span class="mtk8 mtku">sys</span><span class="mtk1">.</span><span class="mtk1">byteorder</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk1">sensor_val</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">enc_bit</span><span class="mtk1">(</span><span class="mtk1">bit</span><span class="mtk1">, </span><span class="mtk1">seed</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk1">sensor_vals</span><span class="mtk1"> </span><span class="mtk5">+=</span><span class="mtk1"> </span><span class="mtk4">''</span><span class="mtk1">.</span><span class="mtk8">join</span><span class="mtk1">(</span><span class="mtk1">sensor_val</span><span class="mtk1">.split(</span><span class="mtk4">' '</span><span class="mtk1">))</span>
<span class="mtk1">        </span><span class="mtk1">bit_encs</span><span class="mtk1">.</span><span class="mtk8">append</span><span class="mtk1">((</span><span class="mtk1">bit</span><span class="mtk1">, </span><span class="mtk1">seed</span><span class="mtk1">))</span>
<span class="mtk1">    </span><span class="mtk1">sensor_vals</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">list</span><span class="mtk1">(</span><span class="mtk1">sensor_vals</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">i</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8 mtku">range</span><span class="mtk1">(</span><span class="mtk6">8</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk1">sensor_vals</span><span class="mtk1">[</span><span class="mtk1">i</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1"> </span><span class="mtk6">6</span><span class="mtk1"> </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk1">bit_idxs</span><span class="mtk1">[</span><span class="mtk1">i</span><span class="mtk1">]] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk4">'?'</span>
<span class="mtk1">    </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk4">''</span><span class="mtk1">.</span><span class="mtk8">join</span><span class="mtk1">(</span><span class="mtk1">sensor_vals</span><span class="mtk1">), </span><span class="mtk1">bit_encs</span>

<span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">rand_bit_flip</span><span class="mtk1">(</span><span class="mtk9 mtki">qc</span><span class="mtk1">, </span><span class="mtk9 mtki">main</span><span class="mtk1">, </span><span class="mtk9 mtki">seed</span><span class="mtk1">):</span>
<span class="mtk1">    </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk9 mtki">seed</span><span class="mtk1"> </span><span class="mtk5">%</span><span class="mtk1"> </span><span class="mtk6">3</span><span class="mtk1"> </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">:</span>
<span class="mtk1">        </span><span class="mtk9 mtki">qc</span><span class="mtk1">.x(</span><span class="mtk9 mtki">main</span><span class="mtk1">[</span><span class="mtk9 mtki">seed</span><span class="mtk1"> </span><span class="mtk5">%</span><span class="mtk1"> </span><span class="mtk6">7</span><span class="mtk1">])</span>
<span class="mtk1">    </span><span class="mtk5">elif</span><span class="mtk1"> </span><span class="mtk9 mtki">seed</span><span class="mtk1"> </span><span class="mtk5">%</span><span class="mtk1"> </span><span class="mtk6">3</span><span class="mtk1"> </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">:</span>
<span class="mtk1">        </span><span class="mtk9 mtki">qc</span><span class="mtk1">.z(</span><span class="mtk9 mtki">main</span><span class="mtk1">[</span><span class="mtk9 mtki">seed</span><span class="mtk1"> </span><span class="mtk5">%</span><span class="mtk1"> </span><span class="mtk6">7</span><span class="mtk1">])</span>

<span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">enc_bit</span><span class="mtk1">(</span><span class="mtk9 mtki">bit</span><span class="mtk1">, </span><span class="mtk9 mtki">seed</span><span class="mtk1">):</span>
<span class="mtk1">    </span><span class="mtk1">main</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> QuantumRegister(</span><span class="mtk6">7</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">anc_x</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> QuantumRegister(</span><span class="mtk6">3</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">anc_z</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> QuantumRegister(</span><span class="mtk6">3</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">syn_x</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> ClassicalRegister(</span><span class="mtk6">3</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">syn_z</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> ClassicalRegister(</span><span class="mtk6">3</span><span class="mtk1">)</span>

<span class="mtk1">    </span><span class="mtk1">qc</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> QuantumCircuit(</span><span class="mtk1">main</span><span class="mtk1">, </span><span class="mtk1">anc_x</span><span class="mtk1">, </span><span class="mtk1">anc_z</span><span class="mtk1">, </span><span class="mtk1">syn_x</span><span class="mtk1">, </span><span class="mtk1">syn_z</span><span class="mtk1">)</span>

<span class="mtk1">    </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk9 mtki">bit</span><span class="mtk1"> </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk4">'1'</span><span class="mtk1">:</span>
<span class="mtk1">        </span><span class="mtk1">qc</span><span class="mtk1">.initialize([</span><span class="mtk6">0</span><span class="mtk1">, </span><span class="mtk6">1</span><span class="mtk1">], </span><span class="mtk1">main</span><span class="mtk1">[</span><span class="mtk6">6</span><span class="mtk1">])</span>

<span class="mtk1">    </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">i</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8 mtku">range</span><span class="mtk1">(</span><span class="mtk6">3</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk1">qc</span><span class="mtk1">.h(</span><span class="mtk1">main</span><span class="mtk1">[</span><span class="mtk1">i</span><span class="mtk1">])</span>

<span class="mtk1">    </span><span class="mtk1">qc</span><span class="mtk1">.cx(</span><span class="mtk1">main</span><span class="mtk1">[</span><span class="mtk6">6</span><span class="mtk1">], </span><span class="mtk1">main</span><span class="mtk1">[</span><span class="mtk6">3</span><span class="mtk1">])</span>
<span class="mtk1">    </span><span class="mtk1">qc</span><span class="mtk1">.cx(</span><span class="mtk1">main</span><span class="mtk1">[</span><span class="mtk6">6</span><span class="mtk1">], </span><span class="mtk1">main</span><span class="mtk1">[</span><span class="mtk6">4</span><span class="mtk1">])</span>

<span class="mtk1">    </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">idx</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> [</span><span class="mtk6">3</span><span class="mtk1">,</span><span class="mtk6">4</span><span class="mtk1">,</span><span class="mtk6">5</span><span class="mtk1">]:</span>
<span class="mtk1">        </span><span class="mtk1">qc</span><span class="mtk1">.cx(</span><span class="mtk1">main</span><span class="mtk1">[</span><span class="mtk6">0</span><span class="mtk1">], </span><span class="mtk1">main</span><span class="mtk1">[</span><span class="mtk1">idx</span><span class="mtk1">])</span>

<span class="mtk1">    </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">idx</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> [</span><span class="mtk6">3</span><span class="mtk1">,</span><span class="mtk6">5</span><span class="mtk1">,</span><span class="mtk6">6</span><span class="mtk1">]:</span>
<span class="mtk1">        </span><span class="mtk1">qc</span><span class="mtk1">.cx(</span><span class="mtk1">main</span><span class="mtk1">[</span><span class="mtk6">1</span><span class="mtk1">], </span><span class="mtk1">main</span><span class="mtk1">[</span><span class="mtk1">idx</span><span class="mtk1">])</span>

<span class="mtk1">    </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">idx</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> [</span><span class="mtk6">4</span><span class="mtk1">,</span><span class="mtk6">5</span><span class="mtk1">,</span><span class="mtk6">6</span><span class="mtk1">]:</span>
<span class="mtk1">        </span><span class="mtk1">qc</span><span class="mtk1">.cx(</span><span class="mtk1">main</span><span class="mtk1">[</span><span class="mtk6">2</span><span class="mtk1">], </span><span class="mtk1">main</span><span class="mtk1">[</span><span class="mtk1">idx</span><span class="mtk1">])</span>

<span class="mtk1">    </span><span class="mtk8">rand_bit_flip</span><span class="mtk1">(</span><span class="mtk1">qc</span><span class="mtk1">, </span><span class="mtk1">main</span><span class="mtk1">, </span><span class="mtk9 mtki">seed</span><span class="mtk1">)</span>

<span class="mtk1">    </span><span class="mtk1">qc</span><span class="mtk1">.h(</span><span class="mtk1">anc_x</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">qc</span><span class="mtk1">.h(</span><span class="mtk1">anc_z</span><span class="mtk1">)</span>


<span class="mtk1">    </span><span class="mtk1">norms</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> [[</span><span class="mtk6">1</span><span class="mtk1">, </span><span class="mtk6">0</span><span class="mtk1">, </span><span class="mtk6">0</span><span class="mtk1">, </span><span class="mtk6">1</span><span class="mtk1">, </span><span class="mtk6">1</span><span class="mtk1">, </span><span class="mtk6">1</span><span class="mtk1">, </span><span class="mtk6">0</span><span class="mtk1">],</span>
<span class="mtk1">             [</span><span class="mtk6">0</span><span class="mtk1">, </span><span class="mtk6">1</span><span class="mtk1">, </span><span class="mtk6">0</span><span class="mtk1">, </span><span class="mtk6">1</span><span class="mtk1">, </span><span class="mtk6">0</span><span class="mtk1">, </span><span class="mtk6">1</span><span class="mtk1">, </span><span class="mtk6">1</span><span class="mtk1">],</span>
<span class="mtk1">             [</span><span class="mtk6">0</span><span class="mtk1">, </span><span class="mtk6">0</span><span class="mtk1">, </span><span class="mtk6">1</span><span class="mtk1">, </span><span class="mtk6">0</span><span class="mtk1">, </span><span class="mtk6">1</span><span class="mtk1">, </span><span class="mtk6">1</span><span class="mtk1">, </span><span class="mtk6">1</span><span class="mtk1">]]</span>

<span class="mtk1">    </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">i</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8 mtku">range</span><span class="mtk1">(</span><span class="mtk6">3</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">j</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8 mtku">range</span><span class="mtk1">(</span><span class="mtk8">len</span><span class="mtk1">(</span><span class="mtk1">norms</span><span class="mtk1">[</span><span class="mtk1">i</span><span class="mtk1">])):</span>
<span class="mtk1">            </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk1">norms</span><span class="mtk1">[</span><span class="mtk1">i</span><span class="mtk1">][</span><span class="mtk1">j</span><span class="mtk1">] </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">:</span>
<span class="mtk1">                </span><span class="mtk1">qc</span><span class="mtk1">.cx(</span><span class="mtk1">anc_x</span><span class="mtk1">[</span><span class="mtk1">i</span><span class="mtk1">], </span><span class="mtk1">main</span><span class="mtk1">[</span><span class="mtk1">j</span><span class="mtk1">])</span>
<span class="mtk1">                </span><span class="mtk1">qc</span><span class="mtk1">.cz(</span><span class="mtk1">anc_z</span><span class="mtk1">[</span><span class="mtk1">i</span><span class="mtk1">], </span><span class="mtk1">main</span><span class="mtk1">[</span><span class="mtk1">j</span><span class="mtk1">])</span>

<span class="mtk1">    </span><span class="mtk1">qc</span><span class="mtk1">.h(</span><span class="mtk1">anc_x</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">qc</span><span class="mtk1">.h(</span><span class="mtk1">anc_z</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">qc</span><span class="mtk1">.measure(</span><span class="mtk1">anc_x</span><span class="mtk1">, </span><span class="mtk1">syn_x</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">qc</span><span class="mtk1">.measure(</span><span class="mtk1">anc_z</span><span class="mtk1">, </span><span class="mtk1">syn_z</span><span class="mtk1">)</span>

<span class="mtk1">    </span><span class="mtk1">cc</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> transpile(</span><span class="mtk1">qc</span><span class="mtk1">, </span><span class="mtk1">sv_sim</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">result</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">sv_sim</span><span class="mtk1">.run(</span><span class="mtk1">cc</span><span class="mtk1">).result()</span>
<span class="mtk1">    </span><span class="mtk1">sv</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> [</span><span class="mtk5">*</span><span class="mtk1">result</span><span class="mtk1">.get_counts()][</span><span class="mtk6">0</span><span class="mtk1">]</span>
<span class="mtk1">    </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk1">sv</span>

<span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">run_insts</span><span class="mtk1">(</span><span class="mtk9 mtki">qc</span><span class="mtk1">, </span><span class="mtk9 mtki">main</span><span class="mtk1">, </span><span class="mtk9 mtki">res</span><span class="mtk1">, </span><span class="mtk9 mtki">insts</span><span class="mtk1">):</span>
<span class="mtk1">    </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">inst</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk9 mtki">insts</span><span class="mtk1">:</span>
<span class="mtk1">        </span><span class="mtk1">toks</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">inst</span><span class="mtk1">.split(</span><span class="mtk4">' '</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk8">len</span><span class="mtk1">(</span><span class="mtk1">toks</span><span class="mtk1">) </span><span class="mtk5">&lt;</span><span class="mtk1"> </span><span class="mtk6">2</span><span class="mtk1"> </span><span class="mtk5">or</span><span class="mtk1"> </span><span class="mtk8">len</span><span class="mtk1">(</span><span class="mtk1">toks</span><span class="mtk1">) </span><span class="mtk5">&gt;</span><span class="mtk1"> </span><span class="mtk6">3</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk5">continue</span>
<span class="mtk1">        </span><span class="mtk1">arg1</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk9 mtki">res</span><span class="mtk1"> </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk1">toks</span><span class="mtk1">[</span><span class="mtk6">1</span><span class="mtk1">] </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk4">'r'</span><span class="mtk1"> </span><span class="mtk5">else</span><span class="mtk1"> </span><span class="mtk9 mtki">main</span><span class="mtk1">[</span><span class="mtk8 mtku">int</span><span class="mtk1">(</span><span class="mtk1">toks</span><span class="mtk1">[</span><span class="mtk6">1</span><span class="mtk1">])]</span>
<span class="mtk1">        </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk8">len</span><span class="mtk1">(</span><span class="mtk1">toks</span><span class="mtk1">) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">3</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk1">arg2</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk9 mtki">res</span><span class="mtk1"> </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk1">toks</span><span class="mtk1">[</span><span class="mtk6">2</span><span class="mtk1">] </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk4">'r'</span><span class="mtk1"> </span><span class="mtk5">else</span><span class="mtk1"> </span><span class="mtk9 mtki">main</span><span class="mtk1">[</span><span class="mtk8 mtku">int</span><span class="mtk1">(</span><span class="mtk1">toks</span><span class="mtk1">[</span><span class="mtk6">2</span><span class="mtk1">])]</span>
<span class="mtk1">        </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk1">toks</span><span class="mtk1">[</span><span class="mtk6">0</span><span class="mtk1">] </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk4">'x'</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk9 mtki">qc</span><span class="mtk1">.x(</span><span class="mtk1">arg1</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk5">elif</span><span class="mtk1"> </span><span class="mtk1">toks</span><span class="mtk1">[</span><span class="mtk6">0</span><span class="mtk1">] </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk4">'y'</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk9 mtki">qc</span><span class="mtk1">.y(</span><span class="mtk1">arg1</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk5">elif</span><span class="mtk1"> </span><span class="mtk1">toks</span><span class="mtk1">[</span><span class="mtk6">0</span><span class="mtk1">] </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk4">'z'</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk9 mtki">qc</span><span class="mtk1">.z(</span><span class="mtk1">arg1</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk5">elif</span><span class="mtk1"> </span><span class="mtk1">toks</span><span class="mtk1">[</span><span class="mtk6">0</span><span class="mtk1">] </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk4">'h'</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk9 mtki">qc</span><span class="mtk1">.h(</span><span class="mtk1">arg1</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk5">elif</span><span class="mtk1"> </span><span class="mtk1">toks</span><span class="mtk1">[</span><span class="mtk6">0</span><span class="mtk1">] </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk4">'cx'</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk9 mtki">qc</span><span class="mtk1">.cx(</span><span class="mtk1">arg1</span><span class="mtk1">, </span><span class="mtk1">arg2</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk5">elif</span><span class="mtk1"> </span><span class="mtk1">toks</span><span class="mtk1">[</span><span class="mtk6">0</span><span class="mtk1">] </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk4">'cy'</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk9 mtki">qc</span><span class="mtk1">.cy(</span><span class="mtk1">arg1</span><span class="mtk1">, </span><span class="mtk1">arg2</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk5">elif</span><span class="mtk1"> </span><span class="mtk1">toks</span><span class="mtk1">[</span><span class="mtk6">0</span><span class="mtk1">] </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk4">'cz'</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk9 mtki">qc</span><span class="mtk1">.cz(</span><span class="mtk1">arg1</span><span class="mtk1">, </span><span class="mtk1">arg2</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk5">else</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk8">exit</span><span class="mtk1">()</span>

<span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">measure_bit</span><span class="mtk1">(</span><span class="mtk9 mtki">bit</span><span class="mtk1">, </span><span class="mtk9 mtki">seed</span><span class="mtk1">, </span><span class="mtk9 mtki">insts</span><span class="mtk1">):</span>
<span class="mtk1">    </span><span class="mtk1">main</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> QuantumRegister(</span><span class="mtk6">7</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">res</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> QuantumRegister(</span><span class="mtk6">1</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">ans</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> ClassicalRegister(</span><span class="mtk6">1</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">anc_x</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> QuantumRegister(</span><span class="mtk6">3</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">anc_z</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> QuantumRegister(</span><span class="mtk6">3</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">syn_x</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> ClassicalRegister(</span><span class="mtk6">3</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">syn_z</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> ClassicalRegister(</span><span class="mtk6">3</span><span class="mtk1">)</span>

<span class="mtk1">    </span><span class="mtk1">qc</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> QuantumCircuit(</span><span class="mtk1">main</span><span class="mtk1">, </span><span class="mtk1">res</span><span class="mtk1">, </span><span class="mtk1">ans</span><span class="mtk1">, </span><span class="mtk1">anc_x</span><span class="mtk1">, </span><span class="mtk1">anc_z</span><span class="mtk1">, </span><span class="mtk1">syn_x</span><span class="mtk1">, </span><span class="mtk1">syn_z</span><span class="mtk1">)</span>

<span class="mtk1">    </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk9 mtki">bit</span><span class="mtk1"> </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk4">'1'</span><span class="mtk1">:</span>
<span class="mtk1">        </span><span class="mtk1">qc</span><span class="mtk1">.initialize([</span><span class="mtk6">0</span><span class="mtk1">, </span><span class="mtk6">1</span><span class="mtk1">], </span><span class="mtk1">main</span><span class="mtk1">[</span><span class="mtk6">6</span><span class="mtk1">])</span>

<span class="mtk1">    </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">i</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8 mtku">range</span><span class="mtk1">(</span><span class="mtk6">3</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk1">qc</span><span class="mtk1">.h(</span><span class="mtk1">main</span><span class="mtk1">[</span><span class="mtk1">i</span><span class="mtk1">])</span>

<span class="mtk1">    </span><span class="mtk1">qc</span><span class="mtk1">.cx(</span><span class="mtk1">main</span><span class="mtk1">[</span><span class="mtk6">6</span><span class="mtk1">], </span><span class="mtk1">main</span><span class="mtk1">[</span><span class="mtk6">3</span><span class="mtk1">])</span>
<span class="mtk1">    </span><span class="mtk1">qc</span><span class="mtk1">.cx(</span><span class="mtk1">main</span><span class="mtk1">[</span><span class="mtk6">6</span><span class="mtk1">], </span><span class="mtk1">main</span><span class="mtk1">[</span><span class="mtk6">4</span><span class="mtk1">])</span>

<span class="mtk1">    </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">idx</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> [</span><span class="mtk6">3</span><span class="mtk1">,</span><span class="mtk6">4</span><span class="mtk1">,</span><span class="mtk6">5</span><span class="mtk1">]:</span>
<span class="mtk1">        </span><span class="mtk1">qc</span><span class="mtk1">.cx(</span><span class="mtk1">main</span><span class="mtk1">[</span><span class="mtk6">0</span><span class="mtk1">], </span><span class="mtk1">main</span><span class="mtk1">[</span><span class="mtk1">idx</span><span class="mtk1">])</span>

<span class="mtk1">    </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">idx</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> [</span><span class="mtk6">3</span><span class="mtk1">,</span><span class="mtk6">5</span><span class="mtk1">,</span><span class="mtk6">6</span><span class="mtk1">]:</span>
<span class="mtk1">        </span><span class="mtk1">qc</span><span class="mtk1">.cx(</span><span class="mtk1">main</span><span class="mtk1">[</span><span class="mtk6">1</span><span class="mtk1">], </span><span class="mtk1">main</span><span class="mtk1">[</span><span class="mtk1">idx</span><span class="mtk1">])</span>

<span class="mtk1">    </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">idx</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> [</span><span class="mtk6">4</span><span class="mtk1">,</span><span class="mtk6">5</span><span class="mtk1">,</span><span class="mtk6">6</span><span class="mtk1">]:</span>
<span class="mtk1">        </span><span class="mtk1">qc</span><span class="mtk1">.cx(</span><span class="mtk1">main</span><span class="mtk1">[</span><span class="mtk6">2</span><span class="mtk1">], </span><span class="mtk1">main</span><span class="mtk1">[</span><span class="mtk1">idx</span><span class="mtk1">])</span>

<span class="mtk1">    </span><span class="mtk8">rand_bit_flip</span><span class="mtk1">(</span><span class="mtk1">qc</span><span class="mtk1">, </span><span class="mtk1">main</span><span class="mtk1">, </span><span class="mtk9 mtki">seed</span><span class="mtk1">)</span>

<span class="mtk1">    </span><span class="mtk1">qc</span><span class="mtk1">.h(</span><span class="mtk1">anc_x</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">qc</span><span class="mtk1">.h(</span><span class="mtk1">anc_z</span><span class="mtk1">)</span>

<span class="mtk1">    </span><span class="mtk1">norms</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> [[</span><span class="mtk6">1</span><span class="mtk1">, </span><span class="mtk6">0</span><span class="mtk1">, </span><span class="mtk6">0</span><span class="mtk1">, </span><span class="mtk6">1</span><span class="mtk1">, </span><span class="mtk6">1</span><span class="mtk1">, </span><span class="mtk6">1</span><span class="mtk1">, </span><span class="mtk6">0</span><span class="mtk1">],</span>
<span class="mtk1">             [</span><span class="mtk6">0</span><span class="mtk1">, </span><span class="mtk6">1</span><span class="mtk1">, </span><span class="mtk6">0</span><span class="mtk1">, </span><span class="mtk6">1</span><span class="mtk1">, </span><span class="mtk6">0</span><span class="mtk1">, </span><span class="mtk6">1</span><span class="mtk1">, </span><span class="mtk6">1</span><span class="mtk1">],</span>
<span class="mtk1">             [</span><span class="mtk6">0</span><span class="mtk1">, </span><span class="mtk6">0</span><span class="mtk1">, </span><span class="mtk6">1</span><span class="mtk1">, </span><span class="mtk6">0</span><span class="mtk1">, </span><span class="mtk6">1</span><span class="mtk1">, </span><span class="mtk6">1</span><span class="mtk1">, </span><span class="mtk6">1</span><span class="mtk1">]]</span>

<span class="mtk1">    </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">i</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8 mtku">range</span><span class="mtk1">(</span><span class="mtk6">3</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">j</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8 mtku">range</span><span class="mtk1">(</span><span class="mtk8">len</span><span class="mtk1">(</span><span class="mtk1">norms</span><span class="mtk1">[</span><span class="mtk1">i</span><span class="mtk1">])):</span>
<span class="mtk1">            </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk1">norms</span><span class="mtk1">[</span><span class="mtk1">i</span><span class="mtk1">][</span><span class="mtk1">j</span><span class="mtk1">] </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">:</span>
<span class="mtk1">                </span><span class="mtk1">qc</span><span class="mtk1">.cx(</span><span class="mtk1">anc_x</span><span class="mtk1">[</span><span class="mtk1">i</span><span class="mtk1">], </span><span class="mtk1">main</span><span class="mtk1">[</span><span class="mtk1">j</span><span class="mtk1">])</span>
<span class="mtk1">                </span><span class="mtk1">qc</span><span class="mtk1">.cz(</span><span class="mtk1">anc_z</span><span class="mtk1">[</span><span class="mtk1">i</span><span class="mtk1">], </span><span class="mtk1">main</span><span class="mtk1">[</span><span class="mtk1">j</span><span class="mtk1">])</span>

<span class="mtk1">    </span><span class="mtk1">qc</span><span class="mtk1">.h(</span><span class="mtk1">anc_x</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">qc</span><span class="mtk1">.h(</span><span class="mtk1">anc_z</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">qc</span><span class="mtk1">.measure(</span><span class="mtk1">anc_x</span><span class="mtk1">, </span><span class="mtk1">syn_x</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">qc</span><span class="mtk1">.measure(</span><span class="mtk1">anc_z</span><span class="mtk1">, </span><span class="mtk1">syn_z</span><span class="mtk1">)</span>

<span class="mtk1">    </span><span class="mtk8">run_insts</span><span class="mtk1">(</span><span class="mtk1">qc</span><span class="mtk1">, </span><span class="mtk1">main</span><span class="mtk1">, </span><span class="mtk1">res</span><span class="mtk1">, </span><span class="mtk9 mtki">insts</span><span class="mtk1">)</span>

<span class="mtk1">    </span><span class="mtk1">qc</span><span class="mtk1">.measure(</span><span class="mtk1">res</span><span class="mtk1">, </span><span class="mtk1">ans</span><span class="mtk1">)</span>

<span class="mtk1">    </span><span class="mtk1">cc</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> transpile(</span><span class="mtk1">qc</span><span class="mtk1">, </span><span class="mtk1">sv_sim</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">result</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">sv_sim</span><span class="mtk1">.run(</span><span class="mtk1">cc</span><span class="mtk1">).result()</span>
<span class="mtk1">    </span><span class="mtk1">sv</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> [</span><span class="mtk5">*</span><span class="mtk1">result</span><span class="mtk1">.get_counts()][</span><span class="mtk6">0</span><span class="mtk1">]</span>
<span class="mtk1">    </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk1">sv</span><span class="mtk1">[</span><span class="mtk5">-</span><span class="mtk6">1</span><span class="mtk1">]</span>

<span class="mtk8">print</span><span class="mtk1">(</span><span class="mtk4">"Here's your flag:"</span><span class="mtk1">, </span><span class="mtk8 mtku">binascii</span><span class="mtk1">.</span><span class="mtk8">hexlify</span><span class="mtk1">(</span><span class="mtk1">cipher</span><span class="mtk1">.</span><span class="mtk8">encrypt</span><span class="mtk1">(flag.encode())))</span>
<span class="mtk8">print</span><span class="mtk1">(</span><span class="mtk4">"Alright, good luck decoding."</span><span class="mtk1">)</span>
<span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">b</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk1">key</span><span class="mtk1">:</span>
<span class="mtk1">    </span><span class="mtk1">sens</span><span class="mtk1">, </span><span class="mtk1">bits</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">enc_byte</span><span class="mtk1">(</span><span class="mtk1">b</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk8">print</span><span class="mtk1">(</span><span class="mtk4">'Sensor measurements:'</span><span class="mtk1">, </span><span class="mtk1">sens</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">insts</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> []</span>
<span class="mtk1">    </span><span class="mtk8">print</span><span class="mtk1">(</span><span class="mtk4">'Help me decode, one bit per line, instructions (e</span><span class="mtk4">x. x 1, z 2) separated by semicolons:'</span><span class="mtk1">)</span>  
<span class="mtk1">    </span><span class="mtk8">print</span><span class="mtk1">(</span><span class="mtk4">'You can only touch main or res. Use an integer to</span><span class="mtk4"> index main, or r for res.'</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">_</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8 mtku">range</span><span class="mtk1">(</span><span class="mtk8">len</span><span class="mtk1">(</span><span class="mtk1">bits</span><span class="mtk1">)):</span>
<span class="mtk1">        </span><span class="mtk1">inst_set</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">input</span><span class="mtk1">(</span><span class="mtk4">''</span><span class="mtk1">).</span><span class="mtk8">split</span><span class="mtk1">(</span><span class="mtk4">';'</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk1">insts</span><span class="mtk1">.</span><span class="mtk8">append</span><span class="mtk1">(</span><span class="mtk1">inst_set</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">bit_ans</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk4">''</span>
<span class="mtk1">    </span><span class="mtk8">print</span><span class="mtk1">(</span><span class="mtk1">insts</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">i</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8 mtku">range</span><span class="mtk1">(</span><span class="mtk8">len</span><span class="mtk1">(</span><span class="mtk1">bits</span><span class="mtk1">)):</span>
<span class="mtk1">        </span><span class="mtk1">bit</span><span class="mtk1">, </span><span class="mtk1">seed</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">bits</span><span class="mtk1">[</span><span class="mtk1">i</span><span class="mtk1">]</span>
<span class="mtk1">        </span><span class="mtk1">bit_ans</span><span class="mtk1"> </span><span class="mtk5">+=</span><span class="mtk1"> </span><span class="mtk8">measure_bit</span><span class="mtk1">(</span><span class="mtk1">bit</span><span class="mtk1">, </span><span class="mtk1">seed</span><span class="mtk1">, </span><span class="mtk1">insts</span><span class="mtk1">[</span><span class="mtk1">i</span><span class="mtk1">])</span>
<span class="mtk1">    </span><span class="mtk8">print</span><span class="mtk1">(</span><span class="mtk4">'Your byte:'</span><span class="mtk1">, </span><span class="mtk1">bit_ans</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk8">print</span><span class="mtk1">(</span><span class="mtk4">'On to the next byte!'</span><span class="mtk1">)</span>
</code></pre></div><p>El servidor del reto genera una clave de AES aleatoria de 16 bytes para cifrar la <em>flag</em>. Se nos da el texto cifrado, y luego el servidor usa un circuito cuántico para codificar cada bit de la clave de AES. Se nos permite obtener algunas medidas y agregar instrucciones al circuito después para que podamos intentar adivinar cada bit de la clave de AES.</p><h2 id="análisis-del-código-fuente">Análisis del código fuente</h2><p>Aquí está la <em>flag</em> cifrada:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk3"># ...</span>

<span class="mtk5">from</span><span class="mtk1"> </span><span class="mtk8 mtku">Crypto</span><span class="mtk1">.</span><span class="mtk8 mtku">Cipher</span><span class="mtk1"> </span><span class="mtk5">import</span><span class="mtk1"> </span><span class="mtk8 mtku">AES</span>
<span class="mtk5">from</span><span class="mtk1"> flag </span><span class="mtk5">import</span><span class="mtk1"> flag</span>

<span class="mtk1">key</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">os</span><span class="mtk1">.</span><span class="mtk8">urandom</span><span class="mtk1">(</span><span class="mtk6">16</span><span class="mtk1">)</span>
<span class="mtk1">cipher</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">AES</span><span class="mtk1">.</span><span class="mtk8">new</span><span class="mtk1">(</span><span class="mtk1">key</span><span class="mtk1">, </span><span class="mtk8 mtku">AES</span><span class="mtk1">.</span><span class="mtk1">MODE_ECB</span><span class="mtk1">)</span>

<span class="mtk3"># ...</span>

<span class="mtk8">print</span><span class="mtk1">(</span><span class="mtk4">"Here's your flag:"</span><span class="mtk1">, </span><span class="mtk8 mtku">binascii</span><span class="mtk1">.</span><span class="mtk8">hexlify</span><span class="mtk1">(</span><span class="mtk1">cipher</span><span class="mtk1">.</span><span class="mtk8">encrypt</span><span class="mtk1">(flag.encode())))</span>  
<span class="mtk8">print</span><span class="mtk1">(</span><span class="mtk4">"Alright, good luck decoding."</span><span class="mtk1">)</span>

<span class="mtk3"># ...</span>
</code></pre></div><p>Luego, debemos ingresar algunos índices de mediciones que queremos &ldquo;ocultar&rdquo;:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">sv_sim</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> AerSimulator(</span><span class="mtk9 mtki">method</span><span class="mtk5">=</span><span class="mtk4">"statevector"</span><span class="mtk1">)</span>
<span class="mtk1">bit_idxs</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">list</span><span class="mtk1">(</span><span class="mtk8 mtku">map</span><span class="mtk1">(</span><span class="mtk8 mtku">int</span><span class="mtk1">, </span><span class="mtk8">input</span><span class="mtk1">(</span><span class="mtk4">'Select a sensor index to remove from each bit: '</span><span class="mtk1">).</span><span class="mtk8">split</span><span class="mtk1">(</span><span class="mtk4">' '</span><span class="mtk1">)))</span>  

<span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">enc_byte</span><span class="mtk1">(</span><span class="mtk9 mtki">b</span><span class="mtk1">):</span>
<span class="mtk1">    </span><span class="mtk1">sensor_vals</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk4">''</span>
<span class="mtk1">    </span><span class="mtk1">bit_encs</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> []</span>
<span class="mtk1">    </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">bit</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8">format</span><span class="mtk1">(</span><span class="mtk9 mtki">b</span><span class="mtk1">, </span><span class="mtk4">'08b'</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk1">seed</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">int</span><span class="mtk1">.</span><span class="mtk8">from_bytes</span><span class="mtk1">(</span><span class="mtk8 mtku">os</span><span class="mtk1">.</span><span class="mtk8">urandom</span><span class="mtk1">(</span><span class="mtk6">8</span><span class="mtk1">), </span><span class="mtk8 mtku">sys</span><span class="mtk1">.</span><span class="mtk1">byteorder</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk1">sensor_val</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">enc_bit</span><span class="mtk1">(</span><span class="mtk1">bit</span><span class="mtk1">, </span><span class="mtk1">seed</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk1">sensor_vals</span><span class="mtk1"> </span><span class="mtk5">+=</span><span class="mtk1"> </span><span class="mtk4">''</span><span class="mtk1">.</span><span class="mtk8">join</span><span class="mtk1">(</span><span class="mtk1">sensor_val</span><span class="mtk1">.split(</span><span class="mtk4">' '</span><span class="mtk1">))</span>
<span class="mtk1">        </span><span class="mtk1">bit_encs</span><span class="mtk1">.</span><span class="mtk8">append</span><span class="mtk1">((</span><span class="mtk1">bit</span><span class="mtk1">, </span><span class="mtk1">seed</span><span class="mtk1">))</span>
<span class="mtk1">    </span><span class="mtk1">sensor_vals</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">list</span><span class="mtk1">(</span><span class="mtk1">sensor_vals</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">i</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8 mtku">range</span><span class="mtk1">(</span><span class="mtk6">8</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk1">sensor_vals</span><span class="mtk1">[</span><span class="mtk1">i</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1"> </span><span class="mtk6">6</span><span class="mtk1"> </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk1">bit_idxs</span><span class="mtk1">[</span><span class="mtk1">i</span><span class="mtk1">]] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk4">'?'</span>
<span class="mtk1">    </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk4">''</span><span class="mtk1">.</span><span class="mtk8">join</span><span class="mtk1">(</span><span class="mtk1">sensor_vals</span><span class="mtk1">), </span><span class="mtk1">bit_encs</span>
</code></pre></div><p>Durante los pasos iniciales de la resolución del reto, no entendí para qué era esto. Luego, me di cuenta de que cada byte de la clave de AES está codificado por separado, y luego cada uno de los 8 bits también está codificado por separado. La cuestión es que, en cada circuito cuántico, habrá 6 qbits que actúan como &ldquo;sensores&rdquo;, y el servidor medirá estos qbits. Sin embargo, se nos dice que ocultemos una de estas medidas.</p><p>Cada una de las 6 mediciones para cada bit se concatena a las siguientes 6 medidas del siguiente bit, y así sucesivamente. Después de eso, el servidor reemplazará los índices elegidos con un signo <code>?</code>. Debido al formato de la salida de mediciones, fui más inteligente que el servidor y logré ocultar una sola medida para las 48 medidas ($6 \times 8$) mediante:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">0 -6 -12 -18 -24 -30 -36 -42  
</code></pre></div><p>El <em>payload</em> anterior engaña al bucle <code>for</code> para sobrescribir siempre la primera medición por un signo <code>?</code>.</p><p>Además, el servidor calculará una semilla aleatoria y la usará para codificar el bit en el circuito cuántico. Entonces, recibiremos las medidas de los sensores.</p><h3 id="codificación-de-bits">Codificación de bits</h3><p>Para cada bit, se genera un nuevo circuito cuántico con esta función:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">enc_bit</span><span class="mtk1">(</span><span class="mtk9 mtki">bit</span><span class="mtk1">, </span><span class="mtk9 mtki">seed</span><span class="mtk1">):</span>
<span class="mtk1">    </span><span class="mtk1">main</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> QuantumRegister(</span><span class="mtk6">7</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">anc_x</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> QuantumRegister(</span><span class="mtk6">3</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">anc_z</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> QuantumRegister(</span><span class="mtk6">3</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">syn_x</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> ClassicalRegister(</span><span class="mtk6">3</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">syn_z</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> ClassicalRegister(</span><span class="mtk6">3</span><span class="mtk1">)</span>

<span class="mtk1">    </span><span class="mtk1">qc</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> QuantumCircuit(</span><span class="mtk1">main</span><span class="mtk1">, </span><span class="mtk1">anc_x</span><span class="mtk1">, </span><span class="mtk1">anc_z</span><span class="mtk1">, </span><span class="mtk1">syn_x</span><span class="mtk1">, </span><span class="mtk1">syn_z</span><span class="mtk1">)</span>  

<span class="mtk1">    </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk9 mtki">bit</span><span class="mtk1"> </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk4">'1'</span><span class="mtk1">:</span>
<span class="mtk1">        </span><span class="mtk1">qc</span><span class="mtk1">.initialize([</span><span class="mtk6">0</span><span class="mtk1">, </span><span class="mtk6">1</span><span class="mtk1">], </span><span class="mtk1">main</span><span class="mtk1">[</span><span class="mtk6">6</span><span class="mtk1">])</span>

<span class="mtk1">    </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">i</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8 mtku">range</span><span class="mtk1">(</span><span class="mtk6">3</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk1">qc</span><span class="mtk1">.h(</span><span class="mtk1">main</span><span class="mtk1">[</span><span class="mtk1">i</span><span class="mtk1">])</span>

<span class="mtk1">    </span><span class="mtk1">qc</span><span class="mtk1">.cx(</span><span class="mtk1">main</span><span class="mtk1">[</span><span class="mtk6">6</span><span class="mtk1">], </span><span class="mtk1">main</span><span class="mtk1">[</span><span class="mtk6">3</span><span class="mtk1">])</span>
<span class="mtk1">    </span><span class="mtk1">qc</span><span class="mtk1">.cx(</span><span class="mtk1">main</span><span class="mtk1">[</span><span class="mtk6">6</span><span class="mtk1">], </span><span class="mtk1">main</span><span class="mtk1">[</span><span class="mtk6">4</span><span class="mtk1">])</span>

<span class="mtk1">    </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">idx</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> [</span><span class="mtk6">3</span><span class="mtk1">,</span><span class="mtk6">4</span><span class="mtk1">,</span><span class="mtk6">5</span><span class="mtk1">]:</span>
<span class="mtk1">        </span><span class="mtk1">qc</span><span class="mtk1">.cx(</span><span class="mtk1">main</span><span class="mtk1">[</span><span class="mtk6">0</span><span class="mtk1">], </span><span class="mtk1">main</span><span class="mtk1">[</span><span class="mtk1">idx</span><span class="mtk1">])</span>

<span class="mtk1">    </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">idx</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> [</span><span class="mtk6">3</span><span class="mtk1">,</span><span class="mtk6">5</span><span class="mtk1">,</span><span class="mtk6">6</span><span class="mtk1">]:</span>
<span class="mtk1">        </span><span class="mtk1">qc</span><span class="mtk1">.cx(</span><span class="mtk1">main</span><span class="mtk1">[</span><span class="mtk6">1</span><span class="mtk1">], </span><span class="mtk1">main</span><span class="mtk1">[</span><span class="mtk1">idx</span><span class="mtk1">])</span>

<span class="mtk1">    </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">idx</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> [</span><span class="mtk6">4</span><span class="mtk1">,</span><span class="mtk6">5</span><span class="mtk1">,</span><span class="mtk6">6</span><span class="mtk1">]:</span>
<span class="mtk1">        </span><span class="mtk1">qc</span><span class="mtk1">.cx(</span><span class="mtk1">main</span><span class="mtk1">[</span><span class="mtk6">2</span><span class="mtk1">], </span><span class="mtk1">main</span><span class="mtk1">[</span><span class="mtk1">idx</span><span class="mtk1">])</span>

<span class="mtk1">    </span><span class="mtk8">rand_bit_flip</span><span class="mtk1">(</span><span class="mtk1">qc</span><span class="mtk1">, </span><span class="mtk1">main</span><span class="mtk1">, </span><span class="mtk9 mtki">seed</span><span class="mtk1">)</span>

<span class="mtk1">    </span><span class="mtk1">qc</span><span class="mtk1">.h(</span><span class="mtk1">anc_x</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">qc</span><span class="mtk1">.h(</span><span class="mtk1">anc_z</span><span class="mtk1">)</span>


<span class="mtk1">    </span><span class="mtk1">norms</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> [[</span><span class="mtk6">1</span><span class="mtk1">, </span><span class="mtk6">0</span><span class="mtk1">, </span><span class="mtk6">0</span><span class="mtk1">, </span><span class="mtk6">1</span><span class="mtk1">, </span><span class="mtk6">1</span><span class="mtk1">, </span><span class="mtk6">1</span><span class="mtk1">, </span><span class="mtk6">0</span><span class="mtk1">],</span>
<span class="mtk1">             [</span><span class="mtk6">0</span><span class="mtk1">, </span><span class="mtk6">1</span><span class="mtk1">, </span><span class="mtk6">0</span><span class="mtk1">, </span><span class="mtk6">1</span><span class="mtk1">, </span><span class="mtk6">0</span><span class="mtk1">, </span><span class="mtk6">1</span><span class="mtk1">, </span><span class="mtk6">1</span><span class="mtk1">],</span>
<span class="mtk1">             [</span><span class="mtk6">0</span><span class="mtk1">, </span><span class="mtk6">0</span><span class="mtk1">, </span><span class="mtk6">1</span><span class="mtk1">, </span><span class="mtk6">0</span><span class="mtk1">, </span><span class="mtk6">1</span><span class="mtk1">, </span><span class="mtk6">1</span><span class="mtk1">, </span><span class="mtk6">1</span><span class="mtk1">]]</span>

<span class="mtk1">    </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">i</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8 mtku">range</span><span class="mtk1">(</span><span class="mtk6">3</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">j</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8 mtku">range</span><span class="mtk1">(</span><span class="mtk8">len</span><span class="mtk1">(</span><span class="mtk1">norms</span><span class="mtk1">[</span><span class="mtk1">i</span><span class="mtk1">])):</span>
<span class="mtk1">            </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk1">norms</span><span class="mtk1">[</span><span class="mtk1">i</span><span class="mtk1">][</span><span class="mtk1">j</span><span class="mtk1">] </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">:</span>
<span class="mtk1">                </span><span class="mtk1">qc</span><span class="mtk1">.cx(</span><span class="mtk1">anc_x</span><span class="mtk1">[</span><span class="mtk1">i</span><span class="mtk1">], </span><span class="mtk1">main</span><span class="mtk1">[</span><span class="mtk1">j</span><span class="mtk1">])</span>
<span class="mtk1">                </span><span class="mtk1">qc</span><span class="mtk1">.cz(</span><span class="mtk1">anc_z</span><span class="mtk1">[</span><span class="mtk1">i</span><span class="mtk1">], </span><span class="mtk1">main</span><span class="mtk1">[</span><span class="mtk1">j</span><span class="mtk1">])</span>

<span class="mtk1">    </span><span class="mtk1">qc</span><span class="mtk1">.h(</span><span class="mtk1">anc_x</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">qc</span><span class="mtk1">.h(</span><span class="mtk1">anc_z</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">qc</span><span class="mtk1">.measure(</span><span class="mtk1">anc_x</span><span class="mtk1">, </span><span class="mtk1">syn_x</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">qc</span><span class="mtk1">.measure(</span><span class="mtk1">anc_z</span><span class="mtk1">, </span><span class="mtk1">syn_z</span><span class="mtk1">)</span>

<span class="mtk1">    </span><span class="mtk1">cc</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> transpile(</span><span class="mtk1">qc</span><span class="mtk1">, </span><span class="mtk1">sv_sim</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">result</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">sv_sim</span><span class="mtk1">.run(</span><span class="mtk1">cc</span><span class="mtk1">).result()</span>
<span class="mtk1">    </span><span class="mtk1">sv</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> [</span><span class="mtk5">*</span><span class="mtk1">result</span><span class="mtk1">.get_counts()][</span><span class="mtk6">0</span><span class="mtk1">]</span>
<span class="mtk1">    </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk1">sv</span>
</code></pre></div><p>Parece aterrador, ¡y lo es! En resumen, tenemos un circuito cuántico con 7 qbits llamados <code>main</code>, luego 3 qbits nombrados <code>anc_x</code> y 3 qbits llamados <code>anc_z</code>. También hay registros clásicos para almacenar las medidas de <code>anc_x</code> y <code>anc_z</code>.</p><p>Lo único que cambia entre codificar un bit <code>0</code> o un bit <code>1</code> es que el qbit <code>main[6]</code> se inicializa en $\ket{0}$ o en $\ket{1}$, respectivamente.</p><p>El circuito comprende muchas puertas cuánticas, principalmente puertas de Hadamard, X-controlada y Z-controlads entre los qbits de <code>main</code>. Después de eso, se produce un <em>bit-flip</em> aleatorio, que depende de la semilla:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">rand_bit_flip</span><span class="mtk1">(</span><span class="mtk9 mtki">qc</span><span class="mtk1">, </span><span class="mtk9 mtki">main</span><span class="mtk1">, </span><span class="mtk9 mtki">seed</span><span class="mtk1">):</span>  
<span class="mtk1">    </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk9 mtki">seed</span><span class="mtk1"> </span><span class="mtk5">%</span><span class="mtk1"> </span><span class="mtk6">3</span><span class="mtk1"> </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">:</span>
<span class="mtk1">        </span><span class="mtk9 mtki">qc</span><span class="mtk1">.x(</span><span class="mtk9 mtki">main</span><span class="mtk1">[</span><span class="mtk9 mtki">seed</span><span class="mtk1"> </span><span class="mtk5">%</span><span class="mtk1"> </span><span class="mtk6">7</span><span class="mtk1">])</span>
<span class="mtk1">    </span><span class="mtk5">elif</span><span class="mtk1"> </span><span class="mtk9 mtki">seed</span><span class="mtk1"> </span><span class="mtk5">%</span><span class="mtk1"> </span><span class="mtk6">3</span><span class="mtk1"> </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">:</span>
<span class="mtk1">        </span><span class="mtk9 mtki">qc</span><span class="mtk1">.z(</span><span class="mtk9 mtki">main</span><span class="mtk1">[</span><span class="mtk9 mtki">seed</span><span class="mtk1"> </span><span class="mtk5">%</span><span class="mtk1"> </span><span class="mtk6">7</span><span class="mtk1">])</span>
</code></pre></div><p>Esta función agrega una puerta X o una puerta Z a uno de los qbits de <code>main</code>. Como se puede ver, hay 21 casos posibles ($3 \times 7$), aunque 7 de ellos (<code>seed % 3 == 2</code>) son equivalentes (no hay <em>bit-flip</em>).</p><p>Después del <em>bit-flip</em>, se aplican algunas puertas entre <code>anc_x</code>, <code>anc_z</code> y <code>main</code>. El servidor mide <code>anc_z</code> y <code>anc_z</code> y genera los resultados como una cadena de 6 bits. Una vez que se completan los 8 bits de un byte, recibimos la cadena de 48 bits de las mediciones (con signos <code>?</code> en las ocultas):</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">b</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk1">key</span><span class="mtk1">:</span>
<span class="mtk1">    </span><span class="mtk1">sens</span><span class="mtk1">, </span><span class="mtk1">bits</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">enc_byte</span><span class="mtk1">(</span><span class="mtk1">b</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk8">print</span><span class="mtk1">(</span><span class="mtk4">'Sensor measurements:'</span><span class="mtk1">, </span><span class="mtk1">sens</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">insts</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> []</span>
<span class="mtk1">    </span><span class="mtk8">print</span><span class="mtk1">(</span><span class="mtk4">'Help me decode, one bit per line, instructions (e</span><span class="mtk4">x. x 1, z 2) separated by semicolons:'</span><span class="mtk1">)</span>  
<span class="mtk1">    </span><span class="mtk8">print</span><span class="mtk1">(</span><span class="mtk4">'You can only touch main or res. Use an integer to</span><span class="mtk4"> index main, or r for res.'</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">_</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8 mtku">range</span><span class="mtk1">(</span><span class="mtk8">len</span><span class="mtk1">(</span><span class="mtk1">bits</span><span class="mtk1">)):</span>
<span class="mtk1">        </span><span class="mtk1">inst_set</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">input</span><span class="mtk1">(</span><span class="mtk4">''</span><span class="mtk1">).</span><span class="mtk8">split</span><span class="mtk1">(</span><span class="mtk4">';'</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk1">insts</span><span class="mtk1">.</span><span class="mtk8">append</span><span class="mtk1">(</span><span class="mtk1">inst_set</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">bit_ans</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk4">''</span>
<span class="mtk1">    </span><span class="mtk8">print</span><span class="mtk1">(</span><span class="mtk1">insts</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">i</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8 mtku">range</span><span class="mtk1">(</span><span class="mtk8">len</span><span class="mtk1">(</span><span class="mtk1">bits</span><span class="mtk1">)):</span>
<span class="mtk1">        </span><span class="mtk1">bit</span><span class="mtk1">, </span><span class="mtk1">seed</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">bits</span><span class="mtk1">[</span><span class="mtk1">i</span><span class="mtk1">]</span>
<span class="mtk1">        </span><span class="mtk1">bit_ans</span><span class="mtk1"> </span><span class="mtk5">+=</span><span class="mtk1"> </span><span class="mtk8">measure_bit</span><span class="mtk1">(</span><span class="mtk1">bit</span><span class="mtk1">, </span><span class="mtk1">seed</span><span class="mtk1">, </span><span class="mtk1">insts</span><span class="mtk1">[</span><span class="mtk1">i</span><span class="mtk1">])</span>
<span class="mtk1">    </span><span class="mtk8">print</span><span class="mtk1">(</span><span class="mtk4">'Your byte:'</span><span class="mtk1">, </span><span class="mtk1">bit_ans</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk8">print</span><span class="mtk1">(</span><span class="mtk4">'On to the next byte!'</span><span class="mtk1">)</span>
</code></pre></div><p>A continuación, se nos permite agregar más puertas al circuito y tener una medición adicional, utilizando <code>measure_bit</code>:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">measure_bit</span><span class="mtk1">(</span><span class="mtk9 mtki">bit</span><span class="mtk1">, </span><span class="mtk9 mtki">seed</span><span class="mtk1">, </span><span class="mtk9 mtki">insts</span><span class="mtk1">):</span>
<span class="mtk1">    </span><span class="mtk1">main</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> QuantumRegister(</span><span class="mtk6">7</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">res</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> QuantumRegister(</span><span class="mtk6">1</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">ans</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> ClassicalRegister(</span><span class="mtk6">1</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">anc_x</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> QuantumRegister(</span><span class="mtk6">3</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">anc_z</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> QuantumRegister(</span><span class="mtk6">3</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">syn_x</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> ClassicalRegister(</span><span class="mtk6">3</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">syn_z</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> ClassicalRegister(</span><span class="mtk6">3</span><span class="mtk1">)</span>

<span class="mtk1">    </span><span class="mtk1">qc</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> QuantumCircuit(</span><span class="mtk1">main</span><span class="mtk1">, </span><span class="mtk1">res</span><span class="mtk1">, </span><span class="mtk1">ans</span><span class="mtk1">, </span><span class="mtk1">anc_x</span><span class="mtk1">, </span><span class="mtk1">anc_z</span><span class="mtk1">, </span><span class="mtk1">syn_x</span><span class="mtk1">, </span><span class="mtk1">syn_z</span><span class="mtk1">)</span>  

<span class="mtk1">    </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk9 mtki">bit</span><span class="mtk1"> </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk4">'1'</span><span class="mtk1">:</span>
<span class="mtk1">        </span><span class="mtk1">qc</span><span class="mtk1">.initialize([</span><span class="mtk6">0</span><span class="mtk1">, </span><span class="mtk6">1</span><span class="mtk1">], </span><span class="mtk1">main</span><span class="mtk1">[</span><span class="mtk6">6</span><span class="mtk1">])</span>

<span class="mtk1">    </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">i</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8 mtku">range</span><span class="mtk1">(</span><span class="mtk6">3</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk1">qc</span><span class="mtk1">.h(</span><span class="mtk1">main</span><span class="mtk1">[</span><span class="mtk1">i</span><span class="mtk1">])</span>

<span class="mtk1">    </span><span class="mtk1">qc</span><span class="mtk1">.cx(</span><span class="mtk1">main</span><span class="mtk1">[</span><span class="mtk6">6</span><span class="mtk1">], </span><span class="mtk1">main</span><span class="mtk1">[</span><span class="mtk6">3</span><span class="mtk1">])</span>
<span class="mtk1">    </span><span class="mtk1">qc</span><span class="mtk1">.cx(</span><span class="mtk1">main</span><span class="mtk1">[</span><span class="mtk6">6</span><span class="mtk1">], </span><span class="mtk1">main</span><span class="mtk1">[</span><span class="mtk6">4</span><span class="mtk1">])</span>

<span class="mtk1">    </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">idx</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> [</span><span class="mtk6">3</span><span class="mtk1">,</span><span class="mtk6">4</span><span class="mtk1">,</span><span class="mtk6">5</span><span class="mtk1">]:</span>
<span class="mtk1">        </span><span class="mtk1">qc</span><span class="mtk1">.cx(</span><span class="mtk1">main</span><span class="mtk1">[</span><span class="mtk6">0</span><span class="mtk1">], </span><span class="mtk1">main</span><span class="mtk1">[</span><span class="mtk1">idx</span><span class="mtk1">])</span>

<span class="mtk1">    </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">idx</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> [</span><span class="mtk6">3</span><span class="mtk1">,</span><span class="mtk6">5</span><span class="mtk1">,</span><span class="mtk6">6</span><span class="mtk1">]:</span>
<span class="mtk1">        </span><span class="mtk1">qc</span><span class="mtk1">.cx(</span><span class="mtk1">main</span><span class="mtk1">[</span><span class="mtk6">1</span><span class="mtk1">], </span><span class="mtk1">main</span><span class="mtk1">[</span><span class="mtk1">idx</span><span class="mtk1">])</span>

<span class="mtk1">    </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">idx</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> [</span><span class="mtk6">4</span><span class="mtk1">,</span><span class="mtk6">5</span><span class="mtk1">,</span><span class="mtk6">6</span><span class="mtk1">]:</span>
<span class="mtk1">        </span><span class="mtk1">qc</span><span class="mtk1">.cx(</span><span class="mtk1">main</span><span class="mtk1">[</span><span class="mtk6">2</span><span class="mtk1">], </span><span class="mtk1">main</span><span class="mtk1">[</span><span class="mtk1">idx</span><span class="mtk1">])</span>

<span class="mtk1">    </span><span class="mtk8">rand_bit_flip</span><span class="mtk1">(</span><span class="mtk1">qc</span><span class="mtk1">, </span><span class="mtk1">main</span><span class="mtk1">, </span><span class="mtk9 mtki">seed</span><span class="mtk1">)</span>

<span class="mtk1">    </span><span class="mtk1">qc</span><span class="mtk1">.h(</span><span class="mtk1">anc_x</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">qc</span><span class="mtk1">.h(</span><span class="mtk1">anc_z</span><span class="mtk1">)</span>

<span class="mtk1">    </span><span class="mtk1">norms</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> [[</span><span class="mtk6">1</span><span class="mtk1">, </span><span class="mtk6">0</span><span class="mtk1">, </span><span class="mtk6">0</span><span class="mtk1">, </span><span class="mtk6">1</span><span class="mtk1">, </span><span class="mtk6">1</span><span class="mtk1">, </span><span class="mtk6">1</span><span class="mtk1">, </span><span class="mtk6">0</span><span class="mtk1">],</span>
<span class="mtk1">             [</span><span class="mtk6">0</span><span class="mtk1">, </span><span class="mtk6">1</span><span class="mtk1">, </span><span class="mtk6">0</span><span class="mtk1">, </span><span class="mtk6">1</span><span class="mtk1">, </span><span class="mtk6">0</span><span class="mtk1">, </span><span class="mtk6">1</span><span class="mtk1">, </span><span class="mtk6">1</span><span class="mtk1">],</span>
<span class="mtk1">             [</span><span class="mtk6">0</span><span class="mtk1">, </span><span class="mtk6">0</span><span class="mtk1">, </span><span class="mtk6">1</span><span class="mtk1">, </span><span class="mtk6">0</span><span class="mtk1">, </span><span class="mtk6">1</span><span class="mtk1">, </span><span class="mtk6">1</span><span class="mtk1">, </span><span class="mtk6">1</span><span class="mtk1">]]</span>

<span class="mtk1">    </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">i</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8 mtku">range</span><span class="mtk1">(</span><span class="mtk6">3</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">j</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8 mtku">range</span><span class="mtk1">(</span><span class="mtk8">len</span><span class="mtk1">(</span><span class="mtk1">norms</span><span class="mtk1">[</span><span class="mtk1">i</span><span class="mtk1">])):</span>
<span class="mtk1">            </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk1">norms</span><span class="mtk1">[</span><span class="mtk1">i</span><span class="mtk1">][</span><span class="mtk1">j</span><span class="mtk1">] </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">:</span>
<span class="mtk1">                </span><span class="mtk1">qc</span><span class="mtk1">.cx(</span><span class="mtk1">anc_x</span><span class="mtk1">[</span><span class="mtk1">i</span><span class="mtk1">], </span><span class="mtk1">main</span><span class="mtk1">[</span><span class="mtk1">j</span><span class="mtk1">])</span>
<span class="mtk1">                </span><span class="mtk1">qc</span><span class="mtk1">.cz(</span><span class="mtk1">anc_z</span><span class="mtk1">[</span><span class="mtk1">i</span><span class="mtk1">], </span><span class="mtk1">main</span><span class="mtk1">[</span><span class="mtk1">j</span><span class="mtk1">])</span>

<span class="mtk1">    </span><span class="mtk1">qc</span><span class="mtk1">.h(</span><span class="mtk1">anc_x</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">qc</span><span class="mtk1">.h(</span><span class="mtk1">anc_z</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">qc</span><span class="mtk1">.measure(</span><span class="mtk1">anc_x</span><span class="mtk1">, </span><span class="mtk1">syn_x</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">qc</span><span class="mtk1">.measure(</span><span class="mtk1">anc_z</span><span class="mtk1">, </span><span class="mtk1">syn_z</span><span class="mtk1">)</span>

<span class="mtk1">    </span><span class="mtk8">run_insts</span><span class="mtk1">(</span><span class="mtk1">qc</span><span class="mtk1">, </span><span class="mtk1">main</span><span class="mtk1">, </span><span class="mtk1">res</span><span class="mtk1">, </span><span class="mtk9 mtki">insts</span><span class="mtk1">)</span>

<span class="mtk1">    </span><span class="mtk1">qc</span><span class="mtk1">.measure(</span><span class="mtk1">res</span><span class="mtk1">, </span><span class="mtk1">ans</span><span class="mtk1">)</span>

<span class="mtk1">    </span><span class="mtk1">cc</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> transpile(</span><span class="mtk1">qc</span><span class="mtk1">, </span><span class="mtk1">sv_sim</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">result</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">sv_sim</span><span class="mtk1">.run(</span><span class="mtk1">cc</span><span class="mtk1">).result()</span>
<span class="mtk1">    </span><span class="mtk1">sv</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> [</span><span class="mtk5">*</span><span class="mtk1">result</span><span class="mtk1">.get_counts()][</span><span class="mtk6">0</span><span class="mtk1">]</span>
<span class="mtk1">    </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk1">sv</span><span class="mtk1">[</span><span class="mtk5">-</span><span class="mtk6">1</span><span class="mtk1">]</span>
</code></pre></div><p>Esta función genera el mismo circuito cuántico que <code>enc_bit</code>, pero usando un qbit <code>res</code> adicional y un registro clásico para medir dicho qbit al final. El circuito se inicializa como antes y usa la misma semilla para <code>rand_bit_flip</code>. Además, se realizan las mismas 6 mediciones en <code>anc_x</code> y <code>anc_z</code>. Está aquí donde se nos permite agregar puertas cuánticas entre los qbits <code>main</code> y <code>res</code> antes de medir el qbit <code>res</code>.</p><p>Las puertas que podemos usar son estas:</p><ul><li>Puertas de Pauli (X, Y, Z)</li><li>Puertas controladas (CX, CY, CZ)</li><li>Puerta de Hadamard (H)</li></ul><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">run_insts</span><span class="mtk1">(</span><span class="mtk9 mtki">qc</span><span class="mtk1">, </span><span class="mtk9 mtki">main</span><span class="mtk1">, </span><span class="mtk9 mtki">res</span><span class="mtk1">, </span><span class="mtk9 mtki">insts</span><span class="mtk1">):</span>
<span class="mtk1">    </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">inst</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk9 mtki">insts</span><span class="mtk1">:</span>
<span class="mtk1">        </span><span class="mtk1">toks</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">inst</span><span class="mtk1">.split(</span><span class="mtk4">' '</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk8">len</span><span class="mtk1">(</span><span class="mtk1">toks</span><span class="mtk1">) </span><span class="mtk5">&lt;</span><span class="mtk1"> </span><span class="mtk6">2</span><span class="mtk1"> </span><span class="mtk5">or</span><span class="mtk1"> </span><span class="mtk8">len</span><span class="mtk1">(</span><span class="mtk1">toks</span><span class="mtk1">) </span><span class="mtk5">&gt;</span><span class="mtk1"> </span><span class="mtk6">3</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk5">continue</span>
<span class="mtk1">        </span><span class="mtk1">arg1</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk9 mtki">res</span><span class="mtk1"> </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk1">toks</span><span class="mtk1">[</span><span class="mtk6">1</span><span class="mtk1">] </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk4">'r'</span><span class="mtk1"> </span><span class="mtk5">else</span><span class="mtk1"> </span><span class="mtk9 mtki">main</span><span class="mtk1">[</span><span class="mtk8 mtku">int</span><span class="mtk1">(</span><span class="mtk1">toks</span><span class="mtk1">[</span><span class="mtk6">1</span><span class="mtk1">])]</span>
<span class="mtk1">        </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk8">len</span><span class="mtk1">(</span><span class="mtk1">toks</span><span class="mtk1">) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">3</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk1">arg2</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk9 mtki">res</span><span class="mtk1"> </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk1">toks</span><span class="mtk1">[</span><span class="mtk6">2</span><span class="mtk1">] </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk4">'r'</span><span class="mtk1"> </span><span class="mtk5">else</span><span class="mtk1"> </span><span class="mtk9 mtki">main</span><span class="mtk1">[</span><span class="mtk8 mtku">int</span><span class="mtk1">(</span><span class="mtk1">toks</span><span class="mtk1">[</span><span class="mtk6">2</span><span class="mtk1">])]</span>  
<span class="mtk1">        </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk1">toks</span><span class="mtk1">[</span><span class="mtk6">0</span><span class="mtk1">] </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk4">'x'</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk9 mtki">qc</span><span class="mtk1">.x(</span><span class="mtk1">arg1</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk5">elif</span><span class="mtk1"> </span><span class="mtk1">toks</span><span class="mtk1">[</span><span class="mtk6">0</span><span class="mtk1">] </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk4">'y'</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk9 mtki">qc</span><span class="mtk1">.y(</span><span class="mtk1">arg1</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk5">elif</span><span class="mtk1"> </span><span class="mtk1">toks</span><span class="mtk1">[</span><span class="mtk6">0</span><span class="mtk1">] </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk4">'z'</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk9 mtki">qc</span><span class="mtk1">.z(</span><span class="mtk1">arg1</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk5">elif</span><span class="mtk1"> </span><span class="mtk1">toks</span><span class="mtk1">[</span><span class="mtk6">0</span><span class="mtk1">] </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk4">'h'</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk9 mtki">qc</span><span class="mtk1">.h(</span><span class="mtk1">arg1</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk5">elif</span><span class="mtk1"> </span><span class="mtk1">toks</span><span class="mtk1">[</span><span class="mtk6">0</span><span class="mtk1">] </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk4">'cx'</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk9 mtki">qc</span><span class="mtk1">.cx(</span><span class="mtk1">arg1</span><span class="mtk1">, </span><span class="mtk1">arg2</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk5">elif</span><span class="mtk1"> </span><span class="mtk1">toks</span><span class="mtk1">[</span><span class="mtk6">0</span><span class="mtk1">] </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk4">'cy'</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk9 mtki">qc</span><span class="mtk1">.cy(</span><span class="mtk1">arg1</span><span class="mtk1">, </span><span class="mtk1">arg2</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk5">elif</span><span class="mtk1"> </span><span class="mtk1">toks</span><span class="mtk1">[</span><span class="mtk6">0</span><span class="mtk1">] </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk4">'cz'</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk9 mtki">qc</span><span class="mtk1">.cz(</span><span class="mtk1">arg1</span><span class="mtk1">, </span><span class="mtk1">arg2</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk5">else</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk8">exit</span><span class="mtk1">()</span>
</code></pre></div><p>Entonces, con todo esto, debemos encontrar una manera de determinar si el circuito cuántico se inicializó con <code>main[6]</code> puesto a $\ket{0}$ o a $\ket{1}$ Para obtener los bits de la tecla AES.</p><h2 id="contexto">Contexto</h2><p>Este reto necesita ciertos conocimientos sobre computación cuántica. Probablemente, todavía no esté preparado para escribir sobre estos conceptos cuánticos de manera rigurosa aquí, pero puedo enumerar algunos recursos que me parecieron buenos para comprender estos conceptos:</p><ul><li><a target="_blank" href="https://en.wikipedia.org/wiki/Quantum_logic_gate">Quantum logic gate</a></li><li><a target="_blank" href="https://www.bluequbit.io/quantum-circuit">Introduction to Quantum Circuit: Everything You Need to Know</a></li><li><a target="_blank" href="https://www.youtube.com/watch?v=tsbCSkvHhMo">Quantum Computing Course – Math and Theory for Beginners</a></li><li><a target="_blank" href="https://github.com/Qiskit/textbook">Qiskit/textbook</a></li></ul><p>Intentaré expresar algunos conceptos clave en caso de que no desee sumergirse en los enlaces anteriores:</p><ul><li><p>En computación cuántica, los qbit no tienen un valor concreto, tienen un estado de superposición. Esto significa que pueden tener cualquier valor, hasta que se mida el qbit. Una vez que se observa un qbit, colapsa a un valor (<code>0</code> o <code>1</code>) y no se puede cambiar. Y esto sucede con cierta probabilidad, que puede expresarse como $\ket{\psi} = \alpha \cdot \ket{0} + \beta \cdot \ket{1}$, donde $|\alpha|^2$ y $|\beta|^2$ representar la probabilidad de colapsar a <code>0</code> o a <code>1</code>, por lo que $|\alpha|^2 + |\beta|^2 = 1$</p></li><li><p>Una puerta de Hadamard (H) produce un &ldquo;cambio de base&rdquo;:</p><ul><li><p>$H \ket{0} = \displaystyle\frac{1}{\sqrt{2}} \big(\ket{0} + \ket{1}\big) \equiv \ket{+}$</p></li><li><p>$H \ket{1} = \displaystyle\frac{1}{\sqrt{2}} \big(\ket{0} - \ket{1}\big) \equiv \ket{-}$</p></li></ul></li><li><p>Medir un qbit que ha sido transformado por una puerta de Hadamard tiene un 50% de posibilidades de colapsar a <code>0</code> y a <code>1</code></p></li><li><p>Las puertas de Pauli (X, Y, Z) se comportan de la siguiente manera:</p><ul><li><p>$X \ket{\psi} = X(\alpha \cdot \ket{0} + \beta \cdot \ket{1}) = \beta \cdot \ket{0} + \alpha \cdot \ket{1}$</p></li><li><p>$Y \ket{\psi} = Y(\alpha \cdot \ket{0} + \beta \cdot \ket{1}) = - \mathrm{i} \cdot \beta \cdot \ket{0} + \mathrm{i} \cdot \alpha \cdot \ket{1}$</p></li><li><p>$Z \ket{\psi} = Z(\alpha \cdot \ket{0} + \beta \cdot \ket{1}) = \alpha \cdot \ket{0} - \beta \cdot \ket{1}$</p></li></ul></li><li><p>Las puertas controladas (CX, CY, CZ) implican dos qbits: el qbit de control y el qbit objetivo. Si el qbit de control es $\ket{1}$ la operación (X, Y o Z) se realiza en el qbit objetivo.</p></li><li><p>Una aplicación directa de la puerta CX (también conocida como CNOT) es el <a target="_blank" href="https://en.wikipedia.org/wiki/Bell_state">estado de Bell</a>, que es una forma de entrelazamiento cuántico:</p></li></ul><p><img alt="two-wrongs 1" src="/images/other/two-wrongs-1.webp"></p><p>El circuito anterior tiene 3 estados diferentes:</p><ul><li><p>Estado inicial: $\ket{0} \otimes \ket{0} \equiv \ket{00}$</p></li><li><p>Después de la puerta H: $(H \ket{0}) \otimes \ket{0} = \left(\displaystyle\frac{\ket{0} + \ket{1}}{\sqrt{2}} \right) \otimes \ket{0} = \displaystyle\frac{\ket{00} + \ket{10}}{\sqrt{2}}$</p></li><li><p>Después de la puerta CNOT: $\mathrm{CNOT} \left(\displaystyle\frac{\ket{00} + \ket{10}}{\sqrt{2}}\right) = \displaystyle\frac{\ket{00} + \ket{11}}{\sqrt{2}} \equiv \ket{\Phi^+}$</p></li></ul><p>En este punto, ambos qbits están entrelazados, lo que significa que si medimos un <code>0</code> en el primer qbit, el segundo qbit tendrá un <code>0</code> también, y viceversa. Lo mismo sucede para un valor de <code>1</code>. Ambos qbits colapsarán al mismo estado.</p><h2 id="solución">Solución</h2><p>Al final, mi solución no requería mucho conocimiento sobre computación cuántica. En cambio, lo que hice fue encontrar patrones probando dinámicamente el circuito dado.</p><p>De hecho los circuitos generados por <code>enc_bit</code> y <code>measure_bit</code> son muy complejos para analizarlos a mano. Este es un ejemplo para un circuito que codifica un bit <code>1</code> con una semilla que es 15 módulo $3 \times 7$:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight" style="line-height:1">               ┌───┐                                          ┌───┐
q254_0: ───────┤ H ├──────────────■────■─────────■────────────┤ X ├───────────■────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────&nbsp;&nbsp;
               ├───┤              │    │         │            └─┬─┘     ┌───┐ │                           ┌───┐                                                           ┌───┐
q254_1: ───────┤ H ├──────────────┼────┼────■────┼─────────■────┼────■──┤ X ├─┼───────────────────────────┤ X ├─────────■─────────────────────────────────────────────────┤ X ├────────────────────────────────
               ├───┤              │    │    │    │         │    │    │  └───┘ │                           └─┬─┘┌───┐    │                                                 └─┬─┘                ┌───┐
q254_2: ───────┤ H ├──────────────┼────┼────┼────┼────■────┼────┼────┼────■───┼────────■────────────────────┼──┤ X ├────┼───────■───────────────────────────────────────────┼──────────────────┤ X ├───────────
               └───┘       ┌───┐┌─┴─┐  │  ┌─┴─┐  │    │    │    │    │    │   │ ┌───┐  │                    │  └─┬─┘    │ ┌───┐ │                                           │                  └─┬─┘
q254_3: ───────────────────┤ X ├┤ X ├──┼──┤ X ├──┼────┼────┼────┼────┼────┼───┼─┤ X ├──┼───■────────────────┼────┼──────┼─┤ X ├─┼────────────■──────────────────────────────┼────────────────────┼─────────────
                           └─┬─┘├───┤┌─┴─┐└───┘  │  ┌─┴─┐  │    │    │    │   │ └─┬─┘  │   │ ┌───┐          │    │      │ └─┬─┘ │ ┌───┐      │                              │                    │
q254_4: ─────────────────────┼──┤ X ├┤ X ├───────┼──┤ X ├──┼────┼────┼────┼───┼───┼────┼───┼─┤ X ├─■────────┼────┼──────┼───┼───┼─┤ X ├──────┼───────■──────────────────────┼────────────────────┼─────────────
                             │  └─┬─┘└───┘     ┌─┴─┐└───┘┌─┴─┐  │    │  ┌─┴─┐ │   │    │   │ └─┬─┘ │ ┌───┐  │    │      │   │   │ └─┬─┘      │ ┌───┐ │               ┌───┐  │                    │
q254_5: ─────────────────────┼────┼────────────┤ X ├─────┤ X ├──┼────┼──┤ X ├─┼───┼────┼───┼───┼───┼─┤ X ├──┼────┼───■──┼───┼───┼───┼────────┼─┤ X ├─┼─────■─────────┤ X ├──┼───■────────────────┼─────────────
        ┌─────────────────┐  │    │            └───┘     └───┘  │  ┌─┴─┐└───┘ │   │  ┌─┴─┐ │   │   │ └─┬─┘  │    │   │  │   │   │   │        │ └─┬─┘ │     │ ┌───┐   └─┬─┘  │   │ ┌───┐          │
q254_6: ┤ Initialize(0,1) ├──■────■─────────────────────────────┼──┤ X ├──────┼───┼──┤ X ├─┼───┼───┼───┼────┼────┼───┼──┼───┼───┼───┼────────┼───┼───┼─────┼─┤ X ├─■───┼────┼───┼─┤ X ├──────■───┼─────────────
        └──────┬───┬──────┘                                     │  └───┘      │   │  └───┘ │   │   │   │    │    │   │  │   │   │   │  ┌───┐ │   │   │ ┌─┐ │ └─┬─┘ │   │    │   │ └─┬─┘      │   │
q255_0: ───────┤ H ├────────────────────────────────────────────■─────────────┼───■────────┼───■───┼───■────┼────┼───┼──┼───┼───┼───┼──┤ H ├─┼───┼───┼─┤M├─┼───┼───┼───┼────┼───┼───┼────────┼───┼─────────────
               ├───┤                                                          │            │       │        │    │   │  │   │   │   │  └───┘ │   │   │ └╥┘ │   │   │   │    │   │   │  ┌───┐ │   │  ┌─┐
q255_1: ───────┤ H ├──────────────────────────────────────────────────────────┼────────────┼───────┼────────■────┼───┼──┼───■───┼───┼────────┼───■───┼──╫──┼───■───┼───┼────■───┼───┼──┤ H ├─┼───┼──┤M├────────
               ├───┤                                                          │            │       │             │   │  │       │   │        │       │  ║  │       │   │        │   │  └───┘ │   │  └╥┘┌───┐┌─┐
q255_2: ───────┤ H ├──────────────────────────────────────────────────────────┼────────────┼───────┼─────────────■───┼──┼───────┼───■────────┼───────┼──╫──┼───────┼───■────────┼───■────────┼───■───╫─┤ H ├┤M├
               ├───┤                                                          │            │       │                 │  │ ┌───┐ │  ┌─┐       │       │  ║  │       │            │            │       ║ └───┘└╥┘
q256_0: ───────┤ H ├──────────────────────────────────────────────────────────■────────────■───────■─────────────────■──┼─┤ H ├─┼──┤M├───────┼───────┼──╫──┼───────┼────────────┼────────────┼───────╫───────╫─
               ├───┤                                                                                                    │ └───┘ │  └╥┘       │       │  ║  │       │ ┌───┐ ┌─┐  │            │       ║       ║
q256_1: ───────┤ H ├────────────────────────────────────────────────────────────────────────────────────────────────────■───────┼───╫────────■───────┼──╫──■───────■─┤ H ├─┤M├──┼────────────┼───────╫───────╫─
               ├───┤                                                                                                            │   ║                │  ║            └───┘ └╥┘  │            │ ┌───┐ ║  ┌─┐  ║
q256_2: ───────┤ H ├────────────────────────────────────────────────────────────────────────────────────────────────────────────■───╫────────────────■──╫───────────────────╫───■────────────■─┤ H ├─╫──┤M├──╫─
               └───┘                                                                                                                ║                   ║                   ║                  └───┘ ║  └╥┘  ║
 c62: 3/════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╬═══════════════════╩═══════════════════╬════════════════════════╩═══╬═══╩═
                                                                                                                                    ║                   0                   ║                        1   ║   2
 c63: 3/════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╩═══════════════════════════════════════╩════════════════════════════╩═════
                                                                                                                                    0                                       1                            2</code></pre></div><p>En realidad, este es un circuito de <a target="_blank" href="https://en.wikipedia.org/wiki/Quantum_error_correction">corrección de errores cuánticos</a>, pero no es tan relevante para resolver el reto.</p><p>Entonces, recordemos que hay 21 semillas posibles (estamos considerando módulo $3 \times 7$), aunque 7 de ellas son equivalentes. Luego, tenemos un bit <code>0</code> o un bit <code>1</code>. Eso nos da 42 casos. Usé el siguiente código para obtener estas ideas:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">seed</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8 mtku">range</span><span class="mtk1">(</span><span class="mtk6">21</span><span class="mtk1">):</span>
<span class="mtk1">    </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">bit</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8 mtku">range</span><span class="mtk1">(</span><span class="mtk6">2</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk8">print</span><span class="mtk1">(</span><span class="mtk7 mtki">f</span><span class="mtk4">'</span><span class="mtk6">{</span><span class="mtk1">bit</span><span class="mtk1"> = </span><span class="mtk6">}</span><span class="mtk4">; </span><span class="mtk6">{</span><span class="mtk1">seed</span><span class="mtk1"> = </span><span class="mtk7 mtki">:2d</span><span class="mtk6">}</span><span class="mtk4">; enc = </span><span class="mtk6">{</span><span class="mtk8">enc_bit</span><span class="mtk1">(</span><span class="mtk8 mtku">str</span><span class="mtk1">(</span><span class="mtk1">bit</span><span class="mtk1">), </span><span class="mtk1">seed</span><span class="mtk1">)</span><span class="mtk6">}</span><span class="mtk4">'</span><span class="mtk1">)</span>  
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">python3</span> <span class="mtku">test.py</span>
bit = 0; seed =  0; enc = 001 000  
bit = 1; seed =  0; enc = 001 000
bit = 0; seed =  1; enc = 000 010
bit = 1; seed =  1; enc = 000 010
bit = 0; seed =  2; enc = 000 000
bit = 1; seed =  2; enc = 000 000
bit = 0; seed =  3; enc = 011 000
bit = 1; seed =  3; enc = 011 000
bit = 0; seed =  4; enc = 000 101
bit = 1; seed =  4; enc = 000 101
bit = 0; seed =  5; enc = 000 000
bit = 1; seed =  5; enc = 000 000
bit = 0; seed =  6; enc = 110 000
bit = 1; seed =  6; enc = 110 000
bit = 0; seed =  7; enc = 000 001
bit = 1; seed =  7; enc = 000 001
bit = 0; seed =  8; enc = 000 000
bit = 1; seed =  8; enc = 000 000
bit = 0; seed =  9; enc = 100 000
bit = 1; seed =  9; enc = 100 000
bit = 0; seed = 10; enc = 000 011
bit = 1; seed = 10; enc = 000 011
bit = 0; seed = 11; enc = 000 000
bit = 1; seed = 11; enc = 000 000
bit = 0; seed = 12; enc = 111 000
bit = 1; seed = 12; enc = 111 000
bit = 0; seed = 13; enc = 000 110
bit = 1; seed = 13; enc = 000 110
bit = 0; seed = 14; enc = 000 000
bit = 1; seed = 14; enc = 000 000
bit = 0; seed = 15; enc = 010 000
bit = 1; seed = 15; enc = 010 000
bit = 0; seed = 16; enc = 000 100
bit = 1; seed = 16; enc = 000 100
bit = 0; seed = 17; enc = 000 000
bit = 1; seed = 17; enc = 000 000
bit = 0; seed = 18; enc = 101 000
bit = 1; seed = 18; enc = 101 000
bit = 0; seed = 19; enc = 000 111
bit = 1; seed = 19; enc = 000 111
bit = 0; seed = 20; enc = 000 000
bit = 1; seed = 20; enc = 000 000
</code></pre></div><p>Como se puede ver, la salida de <code>enc_bit</code> es siempre la misma para cada semilla, sin importar el bit codificado. Además, hay que tener en cuenta que no hay dos salidas iguales (excepto para <code>seed % 3 == 2</code>). Como resultado, si se nos da una cadena de mediciones de 6 bits, podemos saber directamente qué semilla se usó para <code>rand_bit_flip</code>.</p><p>Recordemos que en cada byte, ocultaremos una medición (la primera). Esto significa que tendremos un 50% de posibilidades de adivinar el primer bit correctamente. Como la clave de AES está compuesta por 16 bytes, terminaremos la solución con una fuerza bruta de 16 bits.</p><p>Ahora, debemos saber si la inicialización de <code>main[6]</code> fue $\ket{0}$ o $\ket{1}$. Para esto, podemos usar el sentido común. ¿Qué pasa si &ldquo;deshacemos&rdquo; las operaciones del circuito? Sorprendentemente, funcionó.</p><p>Observe que el <code>anc_x</code> y <code>anc_z</code> ya se midieron, por lo que no los necesitaremos en absoluto. El enfoque a seguir es aplicar las puertas cuánticas inversas en orden inverso. Esta vez, las puertas inversas son las propias puertas (es decir, el inverso de CX es CX, el inverso de H es H&mldr;). Además, debemos agregar la puerta adicional de <code>rand_bit_flip</code>, ya que conocemos la semilla.</p><p>Finalmente, agregaremos una puerta CX entre <code>main[6]</code> (control) y <code>res</code> (objetivo), de manera que si <code>main[6]</code> se decodifica como $\ket{0}$, tendremos un $\ket{0}$ en <code>res</code>; y si <code>main[6]</code> se decodifica como $\ket{1}$, actuará en <code>res</code> para tener también $\ket{1}$.</p><h3 id="implementación">Implementación</h3><p>En primer lugar, nos conectamos al reto, tomamos la <em>flag</em> cifrada y establecemos las medidas ocultas (con el truco anterior):</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">io</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">get_process</span><span class="mtk1">()</span>

<span class="mtk1">io</span><span class="mtk1">.</span><span class="mtk8">sendlineafter</span><span class="mtk1">(</span><span class="mtk7 mtki">b</span><span class="mtk4">'Select a sensor index to remove from each bit: '</span><span class="mtk1">, </span><span class="mtk7 mtki">b</span><span class="mtk4">'0 -6 -12 -18 -24 -30 -36 -42'</span><span class="mtk1">)</span>  
<span class="mtk1">io</span><span class="mtk1">.</span><span class="mtk8">recvuntil</span><span class="mtk1">(</span><span class="mtk7 mtki">b</span><span class="mtk4">"Here's your flag: b'"</span><span class="mtk1">)</span>
<span class="mtk1">enc_flag</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">bytes</span><span class="mtk1">.</span><span class="mtk8">fromhex</span><span class="mtk1">(</span><span class="mtk1">io</span><span class="mtk1">.</span><span class="mtk8">recvuntilS</span><span class="mtk1">(</span><span class="mtk7 mtki">b</span><span class="mtk4">"'"</span><span class="mtk1">, </span><span class="mtk9 mtki">drop</span><span class="mtk5">=</span><span class="mtk6">True</span><span class="mtk1">))</span>
</code></pre></div><p>Luego, definimos el mapeo entre salidas de medición y puertas adicionales de <code>rand_bit_flip</code>, usando el formato de <code>run_insts</code> (para <code>000000</code>, no hay puerta adicional). También definimos la lista de puertas en orden inverso, con el CX final entre <code>main[6]</code> y <code>res</code>:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">rands</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> {</span>
<span class="mtk1">    </span><span class="mtk4">'000000'</span><span class="mtk1">: [],</span>
<span class="mtk1">    </span><span class="mtk4">'001000'</span><span class="mtk1">: [</span><span class="mtk4">'x 0'</span><span class="mtk1">],</span>  
<span class="mtk1">    </span><span class="mtk4">'000010'</span><span class="mtk1">: [</span><span class="mtk4">'z 1'</span><span class="mtk1">],</span>
<span class="mtk1">    </span><span class="mtk4">'011000'</span><span class="mtk1">: [</span><span class="mtk4">'x 3'</span><span class="mtk1">],</span>
<span class="mtk1">    </span><span class="mtk4">'000101'</span><span class="mtk1">: [</span><span class="mtk4">'z 4'</span><span class="mtk1">],</span>
<span class="mtk1">    </span><span class="mtk4">'110000'</span><span class="mtk1">: [</span><span class="mtk4">'x 6'</span><span class="mtk1">],</span>
<span class="mtk1">    </span><span class="mtk4">'000001'</span><span class="mtk1">: [</span><span class="mtk4">'z 0'</span><span class="mtk1">],</span>
<span class="mtk1">    </span><span class="mtk4">'100000'</span><span class="mtk1">: [</span><span class="mtk4">'x 2'</span><span class="mtk1">],</span>
<span class="mtk1">    </span><span class="mtk4">'000011'</span><span class="mtk1">: [</span><span class="mtk4">'z 3'</span><span class="mtk1">],</span>
<span class="mtk1">    </span><span class="mtk4">'111000'</span><span class="mtk1">: [</span><span class="mtk4">'x 5'</span><span class="mtk1">],</span>
<span class="mtk1">    </span><span class="mtk4">'000110'</span><span class="mtk1">: [</span><span class="mtk4">'z 6'</span><span class="mtk1">],</span>
<span class="mtk1">    </span><span class="mtk4">'010000'</span><span class="mtk1">: [</span><span class="mtk4">'x 1'</span><span class="mtk1">],</span>
<span class="mtk1">    </span><span class="mtk4">'000100'</span><span class="mtk1">: [</span><span class="mtk4">'z 2'</span><span class="mtk1">],</span>
<span class="mtk1">    </span><span class="mtk4">'101000'</span><span class="mtk1">: [</span><span class="mtk4">'x 4'</span><span class="mtk1">],</span>
<span class="mtk1">    </span><span class="mtk4">'000111'</span><span class="mtk1">: [</span><span class="mtk4">'z 5'</span><span class="mtk1">],</span>
<span class="mtk1">}</span>

<span class="mtk1">rev_insts</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> [</span>
<span class="mtk1">    </span><span class="mtk4">'cx 2 6'</span><span class="mtk1">,</span>
<span class="mtk1">    </span><span class="mtk4">'cx 2 5'</span><span class="mtk1">,</span>
<span class="mtk1">    </span><span class="mtk4">'cx 2 4'</span><span class="mtk1">,</span>
<span class="mtk1">    </span><span class="mtk4">'cx 1 6'</span><span class="mtk1">,</span>
<span class="mtk1">    </span><span class="mtk4">'cx 1 5'</span><span class="mtk1">,</span>
<span class="mtk1">    </span><span class="mtk4">'cx 1 3'</span><span class="mtk1">,</span>
<span class="mtk1">    </span><span class="mtk4">'cx 0 5'</span><span class="mtk1">,</span>
<span class="mtk1">    </span><span class="mtk4">'cx 0 4'</span><span class="mtk1">,</span>
<span class="mtk1">    </span><span class="mtk4">'cx 0 3'</span><span class="mtk1">,</span>
<span class="mtk1">    </span><span class="mtk4">'cx 6 4'</span><span class="mtk1">,</span>
<span class="mtk1">    </span><span class="mtk4">'cx 6 3'</span><span class="mtk1">,</span>
<span class="mtk1">    </span><span class="mtk4">'h 2'</span><span class="mtk1">,</span>
<span class="mtk1">    </span><span class="mtk4">'h 1'</span><span class="mtk1">,</span>
<span class="mtk1">    </span><span class="mtk4">'h 0'</span><span class="mtk1">,</span>
<span class="mtk1">    </span><span class="mtk4">'cx 6 r'</span><span class="mtk1">,</span>
<span class="mtk1">]</span>
</code></pre></div><p>A continuación, para cada medición de cada uno de los 8 bits, creamos la lista de instrucciones y recibimos la medición de <code>res</code>, que debería ser el estado de <code>main[6]</code>:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">key</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">bytearray</span><span class="mtk1">()</span>
<span class="mtk1">prog</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">io</span><span class="mtk1">.</span><span class="mtk8">progress</span><span class="mtk1">(</span><span class="mtk4">'Bytes'</span><span class="mtk1">)</span>

<span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">b</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8 mtku">range</span><span class="mtk1">(</span><span class="mtk6">16</span><span class="mtk1">):</span>
<span class="mtk1">    </span><span class="mtk1">prog</span><span class="mtk1">.</span><span class="mtk8">status</span><span class="mtk1">(</span><span class="mtk7 mtki">f</span><span class="mtk4">'</span><span class="mtk6">{</span><span class="mtk1">b</span><span class="mtk1"> </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">1}</span><span class="mtk4"> / 16'</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">io</span><span class="mtk1">.</span><span class="mtk8">recvuntil</span><span class="mtk1">(</span><span class="mtk7 mtki">b</span><span class="mtk4">'Sensor measurements: '</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">all_sensors</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">io</span><span class="mtk1">.</span><span class="mtk8">recvlineS</span><span class="mtk1">().</span><span class="mtk8">strip</span><span class="mtk1">().</span><span class="mtk8">replace</span><span class="mtk1">(</span><span class="mtk4">'?'</span><span class="mtk1">, </span><span class="mtk4">'0'</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">sensors</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> [</span><span class="mtk1">all_sensors</span><span class="mtk1">[</span><span class="mtk1">i</span><span class="mtk1"> : </span><span class="mtk1">i</span><span class="mtk1"> </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">6</span><span class="mtk1">] </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">i</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8 mtku">range</span><span class="mtk1">(</span><span class="mtk6">0</span><span class="mtk1">, </span><span class="mtk6">8</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1"> </span><span class="mtk6">6</span><span class="mtk1">, </span><span class="mtk6">6</span><span class="mtk1">)]</span>
<span class="mtk1">    </span><span class="mtk1">io</span><span class="mtk1">.</span><span class="mtk8">recvuntil</span><span class="mtk1">(</span><span class="mtk7 mtki">b</span><span class="mtk4">'You can only touch main or res. Use an integer to</span><span class="mtk4"> index main, or r for res.</span><span class="mtk6">\n</span><span class="mtk4">'</span><span class="mtk1">)</span>  

<span class="mtk1">    </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">i</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8 mtku">range</span><span class="mtk1">(</span><span class="mtk6">8</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk1">insts</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk4">';'</span><span class="mtk1">.</span><span class="mtk8">join</span><span class="mtk1">(</span><span class="mtk1">rands</span><span class="mtk1">[</span><span class="mtk1">sensors</span><span class="mtk1">[</span><span class="mtk1">i</span><span class="mtk1">]] </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk1">rev_insts</span><span class="mtk1">).</span><span class="mtk8">encode</span><span class="mtk1">()</span>
<span class="mtk1">        </span><span class="mtk1">io</span><span class="mtk1">.</span><span class="mtk8">sendline</span><span class="mtk1">(</span><span class="mtk1">insts</span><span class="mtk1">)</span>

<span class="mtk1">    </span><span class="mtk1">io</span><span class="mtk1">.</span><span class="mtk8">recvuntil</span><span class="mtk1">(</span><span class="mtk7 mtki">b</span><span class="mtk4">'Your byte: '</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">key</span><span class="mtk1">.</span><span class="mtk8">append</span><span class="mtk1">(</span><span class="mtk8 mtku">int</span><span class="mtk1">(</span><span class="mtk1">io</span><span class="mtk1">.</span><span class="mtk8">recvlineS</span><span class="mtk1">(), </span><span class="mtk6">2</span><span class="mtk1">))</span>

<span class="mtk1">prog</span><span class="mtk1">.</span><span class="mtk8">success</span><span class="mtk1">(</span><span class="mtk7 mtki">f</span><span class="mtk4">'16 / 16'</span><span class="mtk1">)</span>
<span class="mtk1">io</span><span class="mtk1">.</span><span class="mtk8">info</span><span class="mtk1">(</span><span class="mtk7 mtki">f</span><span class="mtk4">'Almost </span><span class="mtk6">{</span><span class="mtk1">key</span><span class="mtk1"> = </span><span class="mtk6">}</span><span class="mtk4">'</span><span class="mtk1">)</span>
</code></pre></div><p>Finalmente, aplicamos una fuerza bruta de 16 bits sobre el bit más significativo de cada byte de la clave de AES hasta que obtengamos la <em>flag</em>:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">p</span><span class="mtk1"> </span><span class="mtk7">in</span><span class="mtk1"> </span><span class="mtk8 mtku">product</span><span class="mtk1">(</span><span class="mtk8 mtku">range</span><span class="mtk1">(</span><span class="mtk6">2</span><span class="mtk1">), </span><span class="mtk9 mtki">repeat</span><span class="mtk5">=</span><span class="mtk6">16</span><span class="mtk1">):</span>
<span class="mtk1">    </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">i</span><span class="mtk1">, </span><span class="mtk1">b</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8 mtku">enumerate</span><span class="mtk1">(</span><span class="mtk1">p</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk1">key</span><span class="mtk1">[</span><span class="mtk1">i</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> (</span><span class="mtk1">b</span><span class="mtk1"> </span><span class="mtk5">&lt;&lt;</span><span class="mtk1"> </span><span class="mtk6">7</span><span class="mtk1">) </span><span class="mtk5">|</span><span class="mtk1"> (</span><span class="mtk1">key</span><span class="mtk1">[</span><span class="mtk1">i</span><span class="mtk1">] </span><span class="mtk5">&amp;</span><span class="mtk1"> </span><span class="mtk7 mtki">0x</span><span class="mtk6">7f</span><span class="mtk1">)</span>

<span class="mtk1">    </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk7 mtki">b</span><span class="mtk4">'corctf{'</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> (</span><span class="mtk1">flag</span><span class="mtk1"> </span><span class="mtk5">:=</span><span class="mtk1"> </span><span class="mtk8 mtku">AES</span><span class="mtk1">.</span><span class="mtk8">new</span><span class="mtk1">(</span><span class="mtk1">key</span><span class="mtk1">, </span><span class="mtk8 mtku">AES</span><span class="mtk1">.</span><span class="mtk1">MODE_ECB</span><span class="mtk1">).</span><span class="mtk8">decrypt</span><span class="mtk1">(</span><span class="mtk1">enc_flag</span><span class="mtk1">)):</span>  
<span class="mtk1">        </span><span class="mtk1">io</span><span class="mtk1">.</span><span class="mtk8">success</span><span class="mtk1">(</span><span class="mtk7 mtki">f</span><span class="mtk4">'</span><span class="mtk6">{</span><span class="mtk1">key</span><span class="mtk1"> = </span><span class="mtk6">}</span><span class="mtk4">'</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk1">io</span><span class="mtk1">.</span><span class="mtk8">success</span><span class="mtk1">(</span><span class="mtk7 mtki">f</span><span class="mtk4">'Flag: </span><span class="mtk6">{</span><span class="mtk1">flag</span><span class="mtk1">.</span><span class="mtk8">decode</span><span class="mtk1">()</span><span class="mtk6">}</span><span class="mtk4">'</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk5">break</span>
</code></pre></div><h2 id="_flag_"><em>Flag</em></h2><p>Si ejecutamos el <em>script</em>, encontraremos la <em>flag</em>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">python3</span> <span class="mtku">solve.py</span> be.ax 32422
[<span class="code-green">+</span>] Opening connection to be.ax on port 32422: Done
[<span class="code-green">+</span>] Starting local process '/usr/bin/bash': pid 358568
[<span class="code-blue">*</span>] Stopped process '/usr/bin/bash' (pid 358568)
[<span class="code-green">+</span>] Bytes: 16 / 16
[<span class="code-blue">*</span>] Almost key = bytearray(b'5\xc8(f\xe4U\x88v\xd25\xc9\xa1F\xc6\xc8\x8c')  
[<span class="code-green">+</span>] key = bytearray(b'5\xc8(\xe6\xe4U\x88v\xd25\xc9\xa1F\xc6\xc8\x8c')
[<span class="code-green">+</span>] Flag: corctf{c0rr3ct_CORr3Ct!nG_9aenq}
[<span class="code-blue">*</span>] Closed connection to be.ax port 32422
</code></pre></div><p>El <em>script</em> completo se puede encontrar aquí: <a target="_blank" href="https://github.com/7Rocky/CTF-scripts/tree/main/corCTF/two-wrongs/solve.py"><code>solve.py</code></a>.</p><div class="mt6 instapaper_ignoref"></div></div><aside aria-label="aside" class="w-20-l aside-desktop"><div class="bg-card pa3 nested-list-reset nested-copy-line-height nested-links" style="position:sticky;top:5rem;padding-bottom:0"><p class="f5 b pb2" style="border-bottom:5px solid var(--background);margin:0">Contenidos</p><nav id="TableOfContents"><ul><li><a href="#análisis-del-código-fuente">Análisis del código fuente</a><ul><li><a href="#codificación-de-bits">Codificación de bits</a></li></ul></li><li><a href="#contexto">Contexto</a></li><li><a href="#solución">Solución</a><ul><li><a href="#implementación">Implementación</a></li></ul></li><li><a href="#_flag_"><em>Flag</em></a></li></ul></nav><div class="bg-card" style="border-top:5px solid var(--background)"><a class="bmc-btn w-100" target="_blank" href="http://buymeacoffee.com/7Rocky" style="padding:0" title="Buy me a beer">🍺 <span class="bmc-btn-text" style="font-family:Cookie!important;color:#fff">Buy me a beer</span></a></div></div></aside></article></main><footer class="bottom-0 w-100" role="contentinfo"><div class="tc mw8 ph3" style="margin:auto"><form style="background-color:var(--background-card)" class="tc mw8 pv3 mb3" action="https://mailchi.mp/59ffae939360/7rockys-blog-weekly-newsletter" target="popupwindow" onsubmit='return window.open("https://mailchi.mp/59ffae939360/7rockys-blog-weekly-newsletter"),!0'><h3 class="tc">7Rocky's Blog Weekly Newsletter</h3><p class="tc"><input class="f5 pv3 ph3 bn" style="background-color:var(--background);color:inherit;font-weight:700;line-height:normal" type="submit" value="Recibe un resumen semanal del blog"></p><input type="hidden" value="1" name="embed">
<input style="display:none;color:var(--header)" type="submit" value="Suscribirse"><p class="tc"><a href="/en/newsletters/" target="_blank" title="View letter archive">Ver historial de resúmenes</a></p><p class="tc">impulsado por <a href="http://www.mailchimp.com" target="_blank" title="Mailchimp">Mailchimp</a></p></form></div><div class="bg-black w-100 pa3" role="contentinfo"><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://7rocky.github.io/" title="https://7rocky.github.io/">&copy; Blog de 7Rocky. Ciberseguridad y Mates 2024</a><div style="margin-top:8px"><div><div><a href="https://www.linkedin.com/in/roberto-gesteira-minarro/" target="_blank" class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel="noopener" aria-label="follow on LinkedIn——Opens in a new window"><svg height="30" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="30" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
<span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</span></a><a href="https://github.com/7Rocky" target="_blank" class="link-transition github link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel="noopener" aria-label="follow on GitHub——Opens in a new window"><svg height="30" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="30" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg>
<span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a></div></div></div></div></div></footer></body></html>