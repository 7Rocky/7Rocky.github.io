<!doctype html><html lang="es"><head><title>PICtureThis | 7Rocky</title>
<meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="author" content="Blog de 7Rocky. Ciberseguridad y Mates"><meta name="description" content="HackOn CTF 2024. Análisis de _malware_"><meta name="image" content="https://7rocky.github.io/images/reversing.png"><meta name="robots" content="index, follow"><meta name="viewport" content="width=device-width,minimum-scale=1"><meta itemprop="description" content="HackOn CTF 2024. Análisis de _malware_"><meta itemprop="keywords" content><meta itemprop="name" content="PICtureThis"><meta property="article:published_time" content><meta property="og:author" content="Blog de 7Rocky. Ciberseguridad y Mates"><meta property="og:description" content="HackOn CTF 2024. Análisis de _malware_"><meta property="og:image" content="https://7rocky.github.io/images/reversing.png"><meta property="og:locale" content="es_ES"><meta property="og:site_name" content="Blog de 7Rocky. Ciberseguridad y Mates"><meta property="og:title" content="PICtureThis"><meta property="og:type" content="website"><meta property="og:url" content="https://7rocky.github.io/ctf/other/hackon-ctf/picturethis/"><meta name="twitter:author" content="Blog de 7Rocky. Ciberseguridad y Mates"><meta name="twitter:card" content="HackOn CTF 2024. Análisis de _malware_"><meta name="twitter:description" content="HackOn CTF 2024. Análisis de _malware_"><meta name="twitter:image" content="https://7rocky.github.io/images/reversing.png"><meta name="twitter:title" content="PICtureThis"><link href="/favicon.ico" rel="shortcut icon" type="image/x-icon"><link href="/css/style.css" rel="stylesheet"><link href="/css/main.css" rel="stylesheet"><link href="/css/code.css" rel="stylesheet"><link href="https://7rocky.github.io/ctf/other/hackon-ctf/picturethis/" rel="canonical"><script async src="https://www.googletagmanager.com/gtag/js?id=G-Z1HQGH3M4D"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-Z1HQGH3M4D")}</script></head><body class="ma0 production"><header style="position:sticky;top:0;z-index:9"><div class="bg-black"><nav class="ph4-ns" id="navigation" role="navigation"><div class="flex-l justify-between items-center center"><a class="f3 fw2 hover-white no-underline white-90 dib" href="/" title="7Rocky">7Rocky</a><div class="flex-l items-center"><a href="/search" target class="link-transition link dib z-999 pt3 pt0-l mr1 search-link" title="Buscar" rel="noopener" aria-label="Buscar"><svg height="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 487.95 487.95" style="enable-background:new 0 0 487.95 487.95"><g><g><path d="M481.8 453l-140-140.1c27.6-33.1 44.2-75.4 44.2-121.6C386 85.9 299.5.2 193.1.2S0 86 0 191.4s86.5 191.1 192.9 191.1c45.2.0 86.8-15.5 119.8-41.4l140.5 140.5c8.2 8.2 20.4 8.2 28.6.0C490 473.4 490 461.2 481.8 453zM41 191.4c0-82.8 68.2-150.1 151.9-150.1s151.9 67.3 151.9 150.1-68.2 150.1-151.9 150.1S41 274.1 41 191.4z" style="fill-rule:evenodd;clip-rule:evenodd;fill:#a9a9b3"/></g></g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/></svg>
</a><a class="link-transition lang link dib z-999 pt3 pt0-l mr3" href="#" title="es"><img alt="es" height="30px" src="/images/es.png" width="30px">
</a><a class="link-transition lang link dib z-999 pt3 pt0-l" href="/en/ctf/other/hackon-ctf/picturethis/" title="en"><img alt="en" height="30px" src="/images/en.png" style="border:4px solid#000;border-radius:100%" width="30px"></a><ul class="pl0 ml3 mr3" style="line-height:30px"><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href="/ctf/" title="CTF">CTF</a></li><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href="/htb/" title="HTB">HTB</a></li><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href="/imc/" title="IMC">IMC</a></li></ul><a href="https://www.linkedin.com/in/roberto-gesteira-minarro/" target="_blank" class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel="noopener" aria-label="follow on LinkedIn——Opens in a new window"><svg height="30" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
<span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</span></a><a href="https://github.com/7Rocky" target="_blank" class="link-transition github link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel="noopener" aria-label="follow on GitHub——Opens in a new window"><svg height="30" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg>
<span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a></div></div></nav></div></header><main class="pb5" role="main" style="min-height:720px"><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-80-l"><a aria-label="aside" class="instapaper_ignoref b tracked" href="../" style="font-size:1.2rem">&lt;- HACKON CTF</a><div id="sharing" class="mt3"><a aria-label="share on Facebook" class="facebook no-underline" href="https://www.facebook.com/sharer.php?u=https://7rocky.github.io/ctf/other/hackon-ctf/picturethis/" title="share on Facebook"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765 50.32h6.744V33.998h4.499l.596-5.624h-5.095l.007-2.816c0-1.466.14-2.253 2.244-2.253h2.812V17.68h-4.5c-5.405.0-7.307 2.729-7.307 7.317v3.377h-3.369v5.625h3.369V50.32zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg>
</a><a aria-label="share on Twitter" class="twitter no-underline" href="https://twitter.com/share?url=https://7rocky.github.io/ctf/other/hackon-ctf/picturethis/&amp;text=PICtureThis" title="share on Twitter"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</a><a aria-label="share on LinkedIn" class="linkedin no-underline" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://7rocky.github.io/ctf/other/hackon-ctf/picturethis/&amp;title=PICtureThis" title="share on LinkedIn"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a></div><h1 class="f1 mt3 mb1">PICtureThis</h1><p class="mb4 f6 dib tracked">28 minutos de lectura</p></header><aside aria-label="aside" class="w-20-l mt6-l aside-mobile"><div class="bg-card pa3 nested-list-reset nested-copy-line-height nested-links" style="position:sticky;top:5rem;padding-bottom:0"><p class="f5 b pb2" style="border-bottom:5px solid var(--background);margin:0">Contenidos</p><nav id="TableOfContents"><ul><li><a href="#análisis-de-mainexe">Análisis de <code>main.exe</code></a><ul><li><a href="#primera-comprobación">Primera comprobación</a></li><li><a href="#segunda-comprobación">Segunda comprobación</a></li><li><a href="#últimas-comprobaciones">Últimas comprobaciones</a></li></ul></li><li><a href="#análisis-de-burpeesdll">Análisis de <code>burpees.dll</code></a></li><li><a href="#final-de-mainexe">Final de <code>main.exe</code></a></li><li><a href="#_flag_"><em>Flag</em></a></li></ul></nav><div class="bg-card" style="border-top:5px solid var(--background)"><a class="bmc-btn w-100" target="_blank" href="http://buymeacoffee.com/7Rocky" style="padding:0" title="Buy me a beer">🍺 <span class="bmc-btn-text" style="font-family:Cookie!important;color:#fff">Buy me a beer</span></a></div></div></aside><div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img pr4-l w-80-l"><p>En este reto nos dan un Windows PE llamado <code>main.exe</code> y una DLL cifrada (<code>ciphered.dll</code>):</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">file</span> <span class="code-dark-blue">*</span>
ciphered.dll: data
main.exe:     PE32+ executable (console) x86-64 (stripped to external PDB), for MS Windows  
</code></pre></div><h2 id="análisis-de-mainexe">Análisis de <code>main.exe</code></h2><p>De momento, podemos comenzar por abrir <code>main.exe</code> en Ghidra y mirar las <em>strings</em>. Rápidamente vemos una que indica cómo se tiene que ejecutar el programa <code>main.exe</code>:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">Funcionamiento: ./reto.exe &lt;input_string&gt;  
</code></pre></div><p>Si buscamos por referencias a esta <em>string</em>, llegaremos a la función principal:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">undefined8 </span><span class="mtk8">FUN_14000243f</span><span class="mtk1">(undefined8 </span><span class="mtk9 mtki">param_1</span><span class="mtk1">, </span><span class="mtk8">undefined1</span><span class="mtk1"> (</span><span class="mtk5">*</span><span class="mtk9 mtki">param_2</span><span class="mtk1">)[</span><span class="mtk6">10</span><span class="mtk1">], undefined8 </span><span class="mtk9 mtki">param_3</span><span class="mtk1">, undefined8 </span><span class="mtk9 mtki">param_4</span><span class="mtk1">) {</span>  
<span class="mtk1">  </span><span class="mtk7 mtki">bool</span><span class="mtk1"> bVar1;</span>
<span class="mtk1">  undefined8 uVar2;</span>
<span class="mtk1">  undefined7 extraout_var;</span>
<span class="mtk1">  </span><span class="mtk8">undefined1</span><span class="mtk1"> (</span><span class="mtk5">*</span><span class="mtk1">pauVar3)[</span><span class="mtk6">10</span><span class="mtk1">];</span>
<span class="mtk1">  </span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">local_58[</span><span class="mtk6">4</span><span class="mtk1">];</span>
<span class="mtk1">  </span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">local_38;</span>
<span class="mtk1">  ulonglong local_28;</span>
<span class="mtk1">  </span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">local_20;</span>
<span class="mtk1">  </span><span class="mtk7 mtki">int</span><span class="mtk1"> local_14;</span>
<span class="mtk1">  </span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">local_10;</span>

<span class="mtk1">  pauVar3 </span><span class="mtk5">=</span><span class="mtk1"> param_2;</span>
<span class="mtk1">  </span><span class="mtk8">FUN_140002610</span><span class="mtk1">();</span>

<span class="mtk1">  </span><span class="mtk5">if</span><span class="mtk1"> (</span><span class="mtk5">*</span><span class="mtk1">(longlong </span><span class="mtk5">*</span><span class="mtk1">) (</span><span class="mtk5">*</span><span class="mtk1">param_2 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">8</span><span class="mtk1">) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">) {</span>
<span class="mtk1">    </span><span class="mtk8">FUN_140001550</span><span class="mtk1">(</span><span class="mtk4">"Funcionamiento: ./reto.exe &lt;input_string&gt;</span><span class="mtk6">\n</span><span class="mtk4">"</span><span class="mtk1">, pauVar3, param_3, param_4);</span>
<span class="mtk1">    uVar2 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">;</span>
<span class="mtk1">  } </span><span class="mtk5">else</span><span class="mtk1"> {</span>
<span class="mtk1">    local_20 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">_strdup</span><span class="mtk1">(</span><span class="mtk5">*</span><span class="mtk1">(</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">**</span><span class="mtk1">) (</span><span class="mtk5">*</span><span class="mtk1">param_2 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">8</span><span class="mtk1">));</span>
<span class="mtk1">    local_10 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">strtok</span><span class="mtk1">(</span><span class="mtk5">*</span><span class="mtk1">(</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">**</span><span class="mtk1">) (</span><span class="mtk5">*</span><span class="mtk1">param_2 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">8</span><span class="mtk1">), </span><span class="mtk4">"/"</span><span class="mtk1">);</span>
<span class="mtk1">    local_14 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">;</span>

<span class="mtk1">    </span><span class="mtk5">while</span><span class="mtk1"> (local_10 </span><span class="mtk5">!=</span><span class="mtk1"> </span><span class="mtk6">NULL</span><span class="mtk1">) {</span>
<span class="mtk1">      local_58[local_14] </span><span class="mtk5">=</span><span class="mtk1"> local_10;</span>
<span class="mtk1">      local_10 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">strtok</span><span class="mtk1">(</span><span class="mtk6">NULL</span><span class="mtk1">, </span><span class="mtk4">"/"</span><span class="mtk1">);</span>
<span class="mtk1">      local_14 </span><span class="mtk5">=</span><span class="mtk1"> local_14 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">;</span>
<span class="mtk1">    }</span>

<span class="mtk1">    local_28 </span><span class="mtk5">=</span><span class="mtk1"> (ulonglong) (byte) local_58[</span><span class="mtk6">0</span><span class="mtk1">][</span><span class="mtk6">3</span><span class="mtk1">];</span>
<span class="mtk1">    uVar2 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">FUN_140001613</span><span class="mtk1">(local_58[</span><span class="mtk6">0</span><span class="mtk1">]);</span>

<span class="mtk1">    </span><span class="mtk5">if</span><span class="mtk1"> ((</span><span class="mtk7 mtki">int</span><span class="mtk1">) uVar2 </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">) {</span>
<span class="mtk1">      uVar2 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">;</span>
<span class="mtk1">    } </span><span class="mtk5">else</span><span class="mtk1"> {</span>
<span class="mtk1">      bVar1 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">FUN_140001cb3</span><span class="mtk1">((byte) local_28, local_58[</span><span class="mtk6">1</span><span class="mtk1">], param_3, param_4);</span>

<span class="mtk1">      </span><span class="mtk5">if</span><span class="mtk1"> ((</span><span class="mtk7 mtki">int</span><span class="mtk1">) </span><span class="mtk8">CONCAT71</span><span class="mtk1">(extraout_var, bVar1) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">) {</span>
<span class="mtk1">        uVar2 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">;</span>
<span class="mtk1">      } </span><span class="mtk5">else</span><span class="mtk1"> {</span>
<span class="mtk1">        </span><span class="mtk8">FUN_140001fa2</span><span class="mtk1">(local_58[</span><span class="mtk6">3</span><span class="mtk1">], local_58[</span><span class="mtk6">2</span><span class="mtk1">]);</span>
<span class="mtk1">        </span><span class="mtk8">FUN_1400020c9</span><span class="mtk1">(local_38, (longlong) local_20, param_3, param_4);</span>
<span class="mtk1">        uVar2 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">;</span>
<span class="mtk1">      }</span>
<span class="mtk1">    }</span>
<span class="mtk1">  }</span>

<span class="mtk1">  </span><span class="mtk5">return</span><span class="mtk1"> uVar2;</span>
<span class="mtk1">}</span>
</code></pre></div><p>En este punto, podemos renombrar algunas variables y funciones para que tengan nombres más descriptivos y cambiar algunos tipos de variable:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">undefined8 </span><span class="mtk8">main</span><span class="mtk1">(</span><span class="mtk7 mtki">int</span><span class="mtk1"> </span><span class="mtk9 mtki">argc</span><span class="mtk1">, </span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">**</span><span class="mtk9 mtki">argv</span><span class="mtk1">, undefined8 </span><span class="mtk9 mtki">param_3</span><span class="mtk1">, undefined8 </span><span class="mtk9 mtki">param_4</span><span class="mtk1">) {</span>
<span class="mtk1">  </span><span class="mtk7 mtki">bool</span><span class="mtk1"> bVar1;</span>
<span class="mtk1">  undefined8 ret;</span>
<span class="mtk1">  undefined7 extraout_var;</span>
<span class="mtk1">  </span><span class="mtk8">undefined1</span><span class="mtk1"> (</span><span class="mtk5">*</span><span class="mtk1">pauVar2)[</span><span class="mtk6">10</span><span class="mtk1">];</span>
<span class="mtk1">  </span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">parts [</span><span class="mtk6">4</span><span class="mtk1">];</span>
<span class="mtk1">  </span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">local_38;</span>
<span class="mtk1">  ulonglong local_28;</span>
<span class="mtk1">  </span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">input_string;</span>
<span class="mtk1">  </span><span class="mtk7 mtki">int</span><span class="mtk1"> i;</span>
<span class="mtk1">  </span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">tok;</span>

<span class="mtk1">  pauVar2 </span><span class="mtk5">=</span><span class="mtk1"> (</span><span class="mtk8">undefined1</span><span class="mtk1"> (</span><span class="mtk5">*</span><span class="mtk1">) [</span><span class="mtk6">10</span><span class="mtk1">]) argv;</span>
<span class="mtk1">  </span><span class="mtk8">FUN_140002610</span><span class="mtk1">();</span>

<span class="mtk1">  </span><span class="mtk5">if</span><span class="mtk1"> (argv[</span><span class="mtk6">1</span><span class="mtk1">] </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">NULL</span><span class="mtk1">) {</span>
<span class="mtk1">    </span><span class="mtk8">do_print</span><span class="mtk1">(</span><span class="mtk4">"Funcionamiento: ./reto.exe &lt;input_string&gt;</span><span class="mtk6">\n</span><span class="mtk4">"</span><span class="mtk1">, pauVar2, param_3, param_4);</span>  
<span class="mtk1">    ret </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">;</span>
<span class="mtk1">  } </span><span class="mtk5">else</span><span class="mtk1"> {</span>
<span class="mtk1">    input_string </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">_strdup</span><span class="mtk1">(argv[</span><span class="mtk6">1</span><span class="mtk1">]);</span>
<span class="mtk1">    tok </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">strtok</span><span class="mtk1">(argv[</span><span class="mtk6">1</span><span class="mtk1">], </span><span class="mtk4">"/"</span><span class="mtk1">);</span>
<span class="mtk1">    i </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">;</span>

<span class="mtk1">    </span><span class="mtk5">while</span><span class="mtk1"> (tok </span><span class="mtk5">!=</span><span class="mtk1"> </span><span class="mtk6">NULL</span><span class="mtk1">) {</span>
<span class="mtk1">      parts[i] </span><span class="mtk5">=</span><span class="mtk1"> tok;</span>
<span class="mtk1">      tok </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">strtok</span><span class="mtk1">(</span><span class="mtk6">NULL</span><span class="mtk1">, </span><span class="mtk4">"/"</span><span class="mtk1">);</span>
<span class="mtk1">      i</span><span class="mtk5">++</span><span class="mtk6">1</span><span class="mtk1">;</span>
<span class="mtk1">    }</span>

<span class="mtk1">    local_28 </span><span class="mtk5">=</span><span class="mtk1"> (ulonglong)(byte)parts[</span><span class="mtk6">0</span><span class="mtk1">][</span><span class="mtk6">3</span><span class="mtk1">];</span>
<span class="mtk1">    ret </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">FUN_140001613</span><span class="mtk1">(parts[</span><span class="mtk6">0</span><span class="mtk1">]);</span>

<span class="mtk1">    </span><span class="mtk5">if</span><span class="mtk1"> ((</span><span class="mtk7 mtki">int</span><span class="mtk1">) ret </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">) {</span>
<span class="mtk1">      ret </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">;</span>
<span class="mtk1">    } </span><span class="mtk5">else</span><span class="mtk1"> {</span>
<span class="mtk1">      bVar1 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">FUN_140001cb3</span><span class="mtk1">((byte) local_28, parts[</span><span class="mtk6">1</span><span class="mtk1">], param_3, param_4);</span>

<span class="mtk1">      </span><span class="mtk5">if</span><span class="mtk1"> ((</span><span class="mtk7 mtki">int</span><span class="mtk1">) </span><span class="mtk8">CONCAT71</span><span class="mtk1">(extraout_var, bVar1) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">) {</span>
<span class="mtk1">        ret </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">;</span>
<span class="mtk1">      } </span><span class="mtk5">else</span><span class="mtk1"> {</span>
<span class="mtk1">        </span><span class="mtk8">FUN_140001fa2</span><span class="mtk1">(parts[</span><span class="mtk6">3</span><span class="mtk1">], parts[</span><span class="mtk6">2</span><span class="mtk1">]);</span>
<span class="mtk1">        </span><span class="mtk8">FUN_1400020c9</span><span class="mtk1">(local_38, input_string, param_3, param_4);</span>
<span class="mtk1">        ret </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">;</span>
<span class="mtk1">      }</span>
<span class="mtk1">    }</span>
<span class="mtk1">  }</span>

<span class="mtk1">  </span><span class="mtk5">return</span><span class="mtk1"> ret;</span>
<span class="mtk1">}</span>
</code></pre></div><p>Vemos que divide el <code>input_string</code> en 4 partes usando <code>/</code> como separador. Estas partes se pasan por funciones que devuelven <code>0</code> ó <code>1</code>.</p><h3 id="primera-comprobación">Primera comprobación</h3><p>La función que comprueba la primera parte es la siguiente:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">undefined8 </span><span class="mtk8">FUN_140001613</span><span class="mtk1">(</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk9 mtki">param_1</span><span class="mtk1">) {</span>
<span class="mtk1">  </span><span class="mtk7 mtki">size_t</span><span class="mtk1"> sVar1;</span>
<span class="mtk1">  undefined8 uVar2;</span>
<span class="mtk1">  ulonglong uVar3;</span>
<span class="mtk1">  ulonglong local_88[</span><span class="mtk6">4</span><span class="mtk1">];</span>
<span class="mtk1">  undefined8 local_68;</span>
<span class="mtk1">  undefined8 local_60;</span>
<span class="mtk1">  undefined8 local_58;</span>
<span class="mtk1">  undefined8 local_50;</span>
<span class="mtk1">  undefined8 local_48;</span>
<span class="mtk1">  undefined8 local_40;</span>
<span class="mtk1">  undefined8 local_38;</span>
<span class="mtk1">  byte local_22;</span>
<span class="mtk1">  byte local_21;</span>
<span class="mtk1">  </span><span class="mtk7 mtki">int</span><span class="mtk1"> local_20;</span>
<span class="mtk1">  </span><span class="mtk7 mtki">int</span><span class="mtk1"> i;</span>

<span class="mtk1">  sVar1 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">strlen</span><span class="mtk1">(param_1);</span>
<span class="mtk1">  local_20 </span><span class="mtk5">=</span><span class="mtk1"> (</span><span class="mtk7 mtki">int</span><span class="mtk1">) sVar1;</span>

<span class="mtk1">  </span><span class="mtk5">if</span><span class="mtk1"> (local_20 </span><span class="mtk5">&lt;</span><span class="mtk1"> </span><span class="mtk6">4</span><span class="mtk1">) {</span>
<span class="mtk1">    uVar2 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">;</span>
<span class="mtk1">  } </span><span class="mtk5">else</span><span class="mtk1"> {</span>
<span class="mtk1">    local_21 </span><span class="mtk5">=</span><span class="mtk1"> param_1[</span><span class="mtk6">3</span><span class="mtk1">];</span>
<span class="mtk1">    local_22 </span><span class="mtk5">=</span><span class="mtk1"> param_1[(longlong) local_20 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk5">-</span><span class="mtk6">1</span><span class="mtk1">];</span>
<span class="mtk1">    local_88[</span><span class="mtk6">0</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">1c</span><span class="mtk1">;</span>
<span class="mtk1">    local_88[</span><span class="mtk6">1</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">b</span><span class="mtk1">;</span>
<span class="mtk1">    local_88[</span><span class="mtk6">2</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">19</span><span class="mtk1">;</span>
<span class="mtk1">    local_88[</span><span class="mtk6">3</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">3f</span><span class="mtk1">;</span>
<span class="mtk1">    local_68 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">17</span><span class="mtk1">;</span>
<span class="mtk1">    local_60 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">1e</span><span class="mtk1">;</span>
<span class="mtk1">    local_58 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">1c</span><span class="mtk1">;</span>
<span class="mtk1">    local_50 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">14</span><span class="mtk1">;</span>
<span class="mtk1">    local_48 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">10</span><span class="mtk1">;</span>
<span class="mtk1">    local_40 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">11</span><span class="mtk1">;</span>
<span class="mtk1">    local_38 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">3f</span><span class="mtk1">;</span>

<span class="mtk1">    </span><span class="mtk5">for</span><span class="mtk1"> (i </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">; uVar3 </span><span class="mtk5">=</span><span class="mtk1"> (ulonglong) i, sVar1 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">strlen</span><span class="mtk1">(param_1), uVar3 </span><span class="mtk5">&lt;</span><span class="mtk1"> sVar1 </span><span class="mtk5">-</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">; i </span><span class="mtk5">=</span><span class="mtk1"> i </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">) {</span>  
<span class="mtk1">      param_1[i] </span><span class="mtk5">=</span><span class="mtk1"> param_1[i] </span><span class="mtk5">^</span><span class="mtk1"> local_21;</span>
<span class="mtk1">      param_1[i] </span><span class="mtk5">=</span><span class="mtk1"> param_1[i] </span><span class="mtk5">^</span><span class="mtk1"> local_22;</span>

<span class="mtk1">      </span><span class="mtk5">if</span><span class="mtk1"> ((ulonglong) (byte) param_1[i] </span><span class="mtk5">!=</span><span class="mtk1"> local_88[i]) {</span>
<span class="mtk1">        </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">;</span>
<span class="mtk1">      }</span>
<span class="mtk1">    }</span>

<span class="mtk1">    uVar2 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">;</span>
<span class="mtk1">  }</span>

<span class="mtk1">  </span><span class="mtk5">return</span><span class="mtk1"> uVar2;</span>
<span class="mtk1">}</span>
</code></pre></div><p>Esta es una función relativamente sencilla que comprueba que al cifrar la parte de <code>input_string</code> con un cierto algoritmo basado en XOR, el resultado coincide con los bytes que aparecen en las variables <code>local_..</code>. Como clave de XOR, se utiliza el cuarto carácter de <code>param_1</code> y el último:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">    local_21 </span><span class="mtk5">=</span><span class="mtk1"> param_1[</span><span class="mtk6">3</span><span class="mtk1">];</span>
<span class="mtk1">    local_22 </span><span class="mtk5">=</span><span class="mtk1"> param_1[(longlong) local_20 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk5">-</span><span class="mtk6">1</span><span class="mtk1">];</span>  
</code></pre></div><p>Cada carácter se cifra con estas dos claves. Con esto, podemos averiguar ya cuál es el último carácter de la parte de <code>input_string</code>. Para el índice <code>0</code>, tenemos que <code>param_1[i] = param_1[i] ^ local_21</code> va a ser <code>0</code> porque inicialmente <code>param_1[3]</code> coincide con <code>local_21</code>. Entonces, al aplicar XOR con <code>local_22</code> (el último carácter de la parte de <code>input_string</code>), tiene que dar <code>local_88[3] = 0x3f</code>, por lo que <code>local_22</code> es <code>0x3f</code>, que corresponde con <code>?</code>.</p><p>Sabiendo esto, podemos programar el algoritmo de descifrado y aplicar fuerza bruta en <code>local_21</code> (256 posibilidades):</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">python3</span> -q
&gt;&gt;&gt; local_22 = 0x3f
&gt;&gt;&gt; expected = bytes([0x1c, 0xb, 0x19, 0x3f, 0x17, 0x1e, 0x1c, 0x14, 0x10, 0x11, 0x3f])  
&gt;&gt;&gt;
&gt;&gt;&gt; for local_21 in range(256):
...     prev = bytearray(len(expected))
...     for i in range(len(prev)):
...         prev[i] = expected[i] ^ local_21 ^ local_22
...     prev[-1] = 0x3f
...     print(local_21, bytes(prev))
...
0 b'#4&\x00(!#+/.?'
1 b'"5\'\x01) "*./?'
...
63 b'\x1c\x0b\x19?\x17\x1e\x1c\x14\x10\x11?'
64 b'ctf@hackon?'
65 b'bugAi`bjno?'
66 b'avdBjcaiml?'
67 b'`weCkb`hlm?'
68 b'gpbDlegokj?'
69 b'fqcEmdfnjk?'
70 b'er`Fngemih?'
71 b'dsaGofdlhi?'
72 b'k|nH`ikcgf?'
73 b'j}oIahjbfg?'
74 b'i~lJbkiaed?'
75 b'h\x7fmKcjh`de?'
76 b'oxjLdmogcb?'
77 b'nykMelnfbc?'
78 b'mzhNfomea`?'
79 b'l{iOgnld`a?'
80 b'sdvPxqs{\x7f~?'
81 b'rewQyprz~\x7f?'
82 b'qftRzsqy}|?'
83 b'pguS{rpx|}?'
84 b'w`rT|uw\x7f{z?'
85 b'vasU}tv~z{?'
86 b'ubpV~wu}yx?'
87 b'tcqW\x7fvt|xy?'
88 b'{l~Xpy{swv?'
89 b'zm\x7fYqxzrvw?'
90 b'yn|Zr{yqut?'
91 b'xo}[szxptu?'
92 b'\x7fhz\\t}\x7fwsr?'
93 b'~i{]u|~vrs?'
94 b'}jx^v\x7f}uqp?'
95 b'|ky_w~|tpq?'
96 b'CTF`HACKON?'
97 b'BUGaI@BJNO?'
98 b'AVDbJCAIML?'
99 b'@WEcKB@HLM?'
100 b'GPBdLEGOKJ?'
101 b'FQCeMDFNJK?'
102 b'ER@fNGEMIH?'
103 b'DSAgOFDLHI?'
104 b'K\\Nh@IKCGF?'
105 b'J]OiAHJBFG?'
106 b'I^LjBKIAED?'
107 b'H_MkCJH@DE?'
108 b'OXJlDMOGCB?'
109 b'NYKmELNFBC?'
110 b'MZHnFOMEA@?'
111 b'L[IoGNLD@A?'
112 b'SDVpXQS[_^?'
113 b'REWqYPRZ^_?'
114 b'QFTrZSQY]\\?'
115 b'PGUs[RPX\\]?'
116 b'W@Rt\\UW_[Z?'
117 b'VASu]TV^Z[?'
118 b'UBPv^WU]YX?'
119 b'TCQw_VT\\XY?'
120 b'[L^xPY[SWV?'
121 b'ZM_yQXZRVW?'
122 b'YN\\zR[YQUT?'
123 b'XO]{SZXPTU?'
124 b'_HZ|T]_WSR?'
125 b'^I[}U\\^VRS?'
126 b']JX~V_]UQP?'
127 b'\\KY\x7fW^\\TPQ?'
128 b'\xa3\xb4\xa6\x80\xa8\xa1\xa3\xab\xaf\xae?'
...
</code></pre></div><p>Aquí vemos dos <em>strings</em> que podrían cuadrar: <code>ctf@hackon?</code> y <code>CTF`HACKON?</code>, aunque claramente la primera tiene más sentido.</p><h3 id="segunda-comprobación">Segunda comprobación</h3><p>Para esta segunda comprobación, la parte de <code>input_string</code> se divide en dos subpartes, separadas por <code>_</code>:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk7 mtki">bool</span><span class="mtk1"> </span><span class="mtk8">FUN_140001cb3</span><span class="mtk1">(byte </span><span class="mtk9 mtki">param_1</span><span class="mtk1">, </span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk9 mtki">param_2</span><span class="mtk1">, undefined8 </span><span class="mtk9 mtki">param_3</span><span class="mtk1">, undefined8 </span><span class="mtk9 mtki">param_4</span><span class="mtk1">) {</span>
<span class="mtk1">  undefined </span><span class="mtk5">*</span><span class="mtk1">puVar1;</span>
<span class="mtk1">  </span><span class="mtk8">undefined1</span><span class="mtk1"> (</span><span class="mtk5">*</span><span class="mtk1">pauVar2)[</span><span class="mtk6">10</span><span class="mtk1">];</span>
<span class="mtk1">  undefined8 uVar3;</span>
<span class="mtk1">  </span><span class="mtk7 mtki">bool</span><span class="mtk1"> bVar4;</span>
<span class="mtk1">  DWORD local_44;</span>
<span class="mtk1">  </span><span class="mtk8">undefined1</span><span class="mtk1"> (</span><span class="mtk5">*</span><span class="mtk1">local_40)[</span><span class="mtk6">10</span><span class="mtk1">];</span>
<span class="mtk1">  </span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">local_38;</span>
<span class="mtk1">  longlong local_30;</span>
<span class="mtk1">  HANDLE local_28;</span>
<span class="mtk1">  LPVOID local_20;</span>
<span class="mtk1">  </span><span class="mtk7 mtki">int</span><span class="mtk1"> local_14;</span>
<span class="mtk1">  </span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">local_10;</span>
<span class="mtk1">  </span>
<span class="mtk1">  puVar1 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">&amp;</span><span class="mtk1">DAT_14000a041;</span>
<span class="mtk1">  local_10 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">strtok</span><span class="mtk1">(param_2, </span><span class="mtk4">"_"</span><span class="mtk1">);</span>
<span class="mtk1">  local_14 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">;</span>
<span class="mtk1"> </span>
<span class="mtk1">  </span><span class="mtk5">while</span><span class="mtk1"> (local_10 </span><span class="mtk5">!=</span><span class="mtk1"> </span><span class="mtk6">NULL</span><span class="mtk1">) {</span>
<span class="mtk1">    (</span><span class="mtk5">&amp;</span><span class="mtk1">local_38) [local_14] </span><span class="mtk5">=</span><span class="mtk1"> local_10;</span>
<span class="mtk1">    puVar1 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">&amp;</span><span class="mtk1">DAT_14000a000;</span>
<span class="mtk1">    local_10 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">strtok</span><span class="mtk1">(</span><span class="mtk6">NULL</span><span class="mtk1">, </span><span class="mtk4">"/"</span><span class="mtk1">);</span>
<span class="mtk1">    local_14 </span><span class="mtk5">=</span><span class="mtk1"> local_14 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">;</span>
<span class="mtk1">  }</span>

<span class="mtk1">  local_40 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">NULL</span><span class="mtk1">;</span>
<span class="mtk1">  local_20 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">FUN_140001765</span><span class="mtk1">(</span><span class="mtk5">&amp;</span><span class="mtk1">local_40, puVar1, param_3, param_4);</span>
<span class="mtk1">  </span><span class="mtk8">VirtualProtect</span><span class="mtk1">(</span><span class="mtk5">&amp;</span><span class="mtk1">DAT_140009280, (ulonglong) DAT_140009820, (</span><span class="mtk7 mtki">uint</span><span class="mtk1">) param_1, </span><span class="mtk5">&amp;</span><span class="mtk1">local_44);</span>
<span class="mtk1">  </span><span class="mtk8">FUN_14000185e</span><span class="mtk1">(</span><span class="mtk5">0x</span><span class="mtk6">140009280</span><span class="mtk1">, (ulonglong) DAT_140009820, local_20, local_40, (</span><span class="mtk1">longlong) local_38, local_30);</span>  
<span class="mtk1">  </span><span class="mtk8">VirtualProtect</span><span class="mtk1">(</span><span class="mtk5">&amp;</span><span class="mtk1">DAT_140009280, (ulonglong) DAT_140009820, </span><span class="mtk5">0x</span><span class="mtk6">40</span><span class="mtk1">, </span><span class="mtk5">&amp;</span><span class="mtk1">local_44);</span>
<span class="mtk1">  uVar3 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">;</span>
<span class="mtk1">  puVar1 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">&amp;</span><span class="mtk1">DAT_140009280;</span>
<span class="mtk1">  pauVar2 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">NULL</span><span class="mtk1">;</span>
<span class="mtk1">  local_28 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">CreateThread</span><span class="mtk1">(</span><span class="mtk6">NULL</span><span class="mtk1">, </span><span class="mtk6">0</span><span class="mtk1">, (LPTHREAD_START_ROUTINE) </span><span class="mtk5">&amp;</span><span class="mtk1">DAT_140009280, </span><span class="mtk6">NULL</span><span class="mtk1">, </span><span class="mtk6">0</span><span class="mtk1">, </span><span class="mtk6">NULL</span><span class="mtk1">);</span>
<span class="mtk1">  bVar4 </span><span class="mtk5">=</span><span class="mtk1"> local_28 </span><span class="mtk5">!=</span><span class="mtk1"> </span><span class="mtk6">NULL</span><span class="mtk1">;</span>

<span class="mtk1">  </span><span class="mtk5">if</span><span class="mtk1"> (bVar4) {</span>
<span class="mtk1">    </span><span class="mtk8">WaitForSingleObject</span><span class="mtk1">(local_28, </span><span class="mtk5">0x</span><span class="mtk6">ffffffff</span><span class="mtk1">);</span>
<span class="mtk1">  } </span><span class="mtk5">else</span><span class="mtk1"> {</span>
<span class="mtk1">    </span><span class="mtk8">do_print</span><span class="mtk1">(</span><span class="mtk4">"Failed to create a thread</span><span class="mtk6">\n</span><span class="mtk4">"</span><span class="mtk1">, pauVar2, puVar1, uVar3);</span>
<span class="mtk1">  }</span>

<span class="mtk1">  </span><span class="mtk5">return</span><span class="mtk1"> bVar4;</span>
<span class="mtk1">}</span>
</code></pre></div><p>Luego, llama a la función <code>FUN_140001765</code>, que abre y lee el archivo <code>ciphered.dll</code>:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">LPVOID </span><span class="mtk8">FUN_140001765</span><span class="mtk1">(</span><span class="mtk8">undefined1</span><span class="mtk1"> (</span><span class="mtk5">**</span><span class="mtk9 mtki">param_1</span><span class="mtk1">)[</span><span class="mtk6">10</span><span class="mtk1">], undefined8 </span><span class="mtk9 mtki">param_2</span><span class="mtk1">, undefined8 </span><span class="mtk9 mtki">param_3</span><span class="mtk1">, undefined8 </span><span class="mtk9 mtki">param_4</span><span class="mtk1">) {</span>  
<span class="mtk1">  </span><span class="mtk7 mtki">long</span><span class="mtk1"> lVar1;</span>
<span class="mtk1">  FILE </span><span class="mtk5">*</span><span class="mtk1">_File;</span>
<span class="mtk1">  LPVOID _DstBuf;</span>
<span class="mtk1">  </span><span class="mtk8">undefined1</span><span class="mtk1"> (</span><span class="mtk5">**</span><span class="mtk1">ppauVar2)[</span><span class="mtk6">10</span><span class="mtk1">];</span>
<span class="mtk1">  </span><span class="mtk8">undefined1</span><span class="mtk1"> (</span><span class="mtk5">*</span><span class="mtk1">pauVar3)[</span><span class="mtk6">10</span><span class="mtk1">];</span>
<span class="mtk1">  undefined8 uVar4;</span>
<span class="mtk1">  undefined8 uVar5;</span>
<span class="mtk1">  </span>
<span class="mtk1">  pauVar3 </span><span class="mtk5">=</span><span class="mtk1"> (</span><span class="mtk8">undefined1</span><span class="mtk1"> (</span><span class="mtk5">*</span><span class="mtk1">) [</span><span class="mtk6">10</span><span class="mtk1">]) </span><span class="mtk5">&amp;</span><span class="mtk1">DAT_14000a002;</span>
<span class="mtk1">  _File </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">fopen</span><span class="mtk1">(</span><span class="mtk4">"ciphered.dll"</span><span class="mtk1">, </span><span class="mtk4">"rb"</span><span class="mtk1">);</span>

<span class="mtk1">  </span><span class="mtk5">if</span><span class="mtk1"> (_File </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">NULL</span><span class="mtk1">) {</span>
<span class="mtk1">    </span><span class="mtk8">do_print</span><span class="mtk1">(</span><span class="mtk4">"Failed to open the DLL</span><span class="mtk6">\n</span><span class="mtk4">"</span><span class="mtk1">, pauVar3, param_3, param_4);</span>
<span class="mtk1">    _DstBuf </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">NULL</span><span class="mtk1">;</span>
<span class="mtk1">  } </span><span class="mtk5">else</span><span class="mtk1"> {</span>
<span class="mtk1">    </span><span class="mtk8">fseek</span><span class="mtk1">(_File, </span><span class="mtk6">0</span><span class="mtk1">, </span><span class="mtk6">2</span><span class="mtk1">);</span>
<span class="mtk1">    lVar1 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">ftell</span><span class="mtk1">(_File);</span>
<span class="mtk1">    </span><span class="mtk5">*</span><span class="mtk1">param_1 </span><span class="mtk5">=</span><span class="mtk1"> (</span><span class="mtk8">undefined1</span><span class="mtk1"> (</span><span class="mtk5">*</span><span class="mtk1">) [</span><span class="mtk6">10</span><span class="mtk1">]) (longlong)l Var1;</span>
<span class="mtk1">    </span><span class="mtk8">rewind</span><span class="mtk1">(_File);</span>
<span class="mtk1">    pauVar3 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">param_1;</span>
<span class="mtk1">    uVar5 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">40</span><span class="mtk1">;</span>
<span class="mtk1">    uVar4 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">3000</span><span class="mtk1">;</span>
<span class="mtk1">    _DstBuf </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">VirtualAlloc</span><span class="mtk1">(</span><span class="mtk6">NULL</span><span class="mtk1">, (SIZE_T) pauVar3, </span><span class="mtk5">0x</span><span class="mtk6">3000</span><span class="mtk1">, </span><span class="mtk5">0x</span><span class="mtk6">40</span><span class="mtk1">);</span>

<span class="mtk1">    </span><span class="mtk5">if</span><span class="mtk1"> (_DstBuf </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">NULL</span><span class="mtk1">) {</span>
<span class="mtk1">      </span><span class="mtk8">do_print</span><span class="mtk1">(</span><span class="mtk4">"Failed to alloc space</span><span class="mtk6">\n</span><span class="mtk4">"</span><span class="mtk1">, pauVar3, uVar4, uVar5);</span>
<span class="mtk1">      _DstBuf </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">NULL</span><span class="mtk1">;</span>
<span class="mtk1">    } </span><span class="mtk5">else</span><span class="mtk1"> {</span>
<span class="mtk1">      ppauVar2 </span><span class="mtk5">=</span><span class="mtk1"> (</span><span class="mtk8">undefined1</span><span class="mtk1"> (</span><span class="mtk5">**</span><span class="mtk1">) [</span><span class="mtk6">10</span><span class="mtk1">]) </span><span class="mtk8">fread</span><span class="mtk1">(_DstBuf, </span><span class="mtk6">1</span><span class="mtk1">,( </span><span class="mtk7 mtki">size_t</span><span class="mtk1">) </span><span class="mtk5">*</span><span class="mtk1">param_1, _File);</span>

<span class="mtk1">      </span><span class="mtk5">if</span><span class="mtk1"> (param_1 </span><span class="mtk5">!=</span><span class="mtk1"> ppauVar2) {</span>
<span class="mtk1">        </span><span class="mtk8">fclose</span><span class="mtk1">(_File);</span>
<span class="mtk1">      }</span>
<span class="mtk1">    }</span>
<span class="mtk1">  }</span>

<span class="mtk1">  </span><span class="mtk5">return</span><span class="mtk1"> _DstBuf;</span>
<span class="mtk1">}</span>
</code></pre></div><p>Además, la función anterior realiza <code>VirtualProtect</code> sobre una dirección de memoria, y luego llama a <code>FUN_14000185e</code> con una de las subpartes:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk7 mtki">void</span><span class="mtk1"> </span><span class="mtk8">FUN_14000185e</span><span class="mtk1">(</span><span class="mtk8 mtku">longlong</span><span class="mtk1"> </span><span class="mtk9 mtki">param_1</span><span class="mtk1">, </span><span class="mtk8 mtku">ulonglong</span><span class="mtk1"> </span><span class="mtk9 mtki">param_2</span><span class="mtk1">, </span><span class="mtk8 mtku">undefined8</span><span class="mtk1"> </span><span class="mtk9 mtki">param_3</span><span class="mtk1">, </span><span class="mtk8 mtku">undefined8</span><span class="mtk1"> </span><span class="mtk9 mtki">param_4</span><span class="mtk1">, </span><span class="mtk8 mtku">longlong</span><span class="mtk1"> </span><span class="mtk9 mtki">param_5</span><span class="mtk1">, </span><span class="mtk8 mtku">longlong</span><span class="mtk1"> </span><span class="mtk9 mtki">param_6</span><span class="mtk1">) {</span>  
<span class="mtk1">  undefined local_res18 [</span><span class="mtk6">16</span><span class="mtk1">];</span>
<span class="mtk1">  ulonglong local_28;</span>
<span class="mtk1">  ulonglong local_20;</span>
<span class="mtk1">  ulonglong local_18;</span>
<span class="mtk1">  ulonglong local_10;</span>
<span class="mtk1">  </span>
<span class="mtk1">  </span><span class="mtk5">for</span><span class="mtk1"> (local_10 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">; local_10 </span><span class="mtk5">&lt;</span><span class="mtk1"> param_2; local_10 </span><span class="mtk5">=</span><span class="mtk1"> local_10 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">) {</span>
<span class="mtk1">    </span><span class="mtk5">if</span><span class="mtk1"> (((((</span><span class="mtk5">*</span><span class="mtk1">(</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">)(local_10 </span><span class="mtk5">+</span><span class="mtk1"> param_1) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk5">-0x</span><span class="mtk6">78</span><span class="mtk1">) </span><span class="mtk5">&amp;&amp;</span><span class="mtk1"> (</span><span class="mtk5">*</span><span class="mtk1">(</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">)(param_1 </span><span class="mtk5">+</span><span class="mtk1"> local_10 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk5">-0x</span><span class="mtk6">78</span><span class="mtk1">))</span>
<span class="mtk1">         </span><span class="mtk5">&amp;&amp;</span><span class="mtk1"> (</span><span class="mtk5">*</span><span class="mtk1">(</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">)(param_1 </span><span class="mtk5">+</span><span class="mtk1"> local_10 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">2</span><span class="mtk1">) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk5">-0x</span><span class="mtk6">78</span><span class="mtk1">)) </span><span class="mtk5">&amp;&amp;</span>
<span class="mtk1">        ((</span><span class="mtk5">*</span><span class="mtk1">(</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">)(param_1 </span><span class="mtk5">+</span><span class="mtk1"> local_10 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">3</span><span class="mtk1">) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk5">-0x</span><span class="mtk6">78</span><span class="mtk1"> </span><span class="mtk5">&amp;&amp;</span><span class="mtk1"> (</span><span class="mtk5">*</span><span class="mtk1">(</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">)(param_1 </span><span class="mtk5">+</span><span class="mtk1"> local_10 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">4</span><span class="mtk1">) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk5">-0x</span><span class="mtk6">78</span><span class="mtk1">)</span>
<span class="mtk1">         ))) </span><span class="mtk5">&amp;&amp;</span><span class="mtk1"> ((</span><span class="mtk5">*</span><span class="mtk1">(</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">)(param_1 </span><span class="mtk5">+</span><span class="mtk1"> local_10 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">5</span><span class="mtk1">) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk5">-0x</span><span class="mtk6">78</span><span class="mtk1"> </span><span class="mtk5">&amp;&amp;</span>
<span class="mtk1">                 ((</span><span class="mtk5">*</span><span class="mtk1">(</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">)(param_1 </span><span class="mtk5">+</span><span class="mtk1"> local_10 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">6</span><span class="mtk1">) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk5">-0x</span><span class="mtk6">78</span><span class="mtk1"> </span><span class="mtk5">&amp;&amp;</span>
<span class="mtk1">                  (</span><span class="mtk5">*</span><span class="mtk1">(</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">)(param_1 </span><span class="mtk5">+</span><span class="mtk1"> local_10 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">7</span><span class="mtk1">) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk5">-0x</span><span class="mtk6">78</span><span class="mtk1">)))))) {</span>
<span class="mtk1">      </span><span class="mtk5">for</span><span class="mtk1"> (local_18 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">; local_18 </span><span class="mtk5">&lt;</span><span class="mtk1"> </span><span class="mtk6">8</span><span class="mtk1">; local_18 </span><span class="mtk5">=</span><span class="mtk1"> local_18 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">) {</span>
<span class="mtk1">        </span><span class="mtk5">*</span><span class="mtk1">(undefined </span><span class="mtk5">*</span><span class="mtk1">)(param_1 </span><span class="mtk5">+</span><span class="mtk1"> local_18 </span><span class="mtk5">+</span><span class="mtk1"> local_10) </span><span class="mtk5">=</span><span class="mtk1"> local_res18[local_18];</span>
<span class="mtk1">      }</span>
<span class="mtk1">    }</span>

<span class="mtk1">    </span><span class="mtk5">if</span><span class="mtk1"> (((((</span><span class="mtk5">*</span><span class="mtk1">(</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">)(local_10 </span><span class="mtk5">+</span><span class="mtk1"> param_1) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk5">-0x</span><span class="mtk6">56</span><span class="mtk1">) </span><span class="mtk5">&amp;&amp;</span><span class="mtk1"> (</span><span class="mtk5">*</span><span class="mtk1">(</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">)(param_1 </span><span class="mtk5">+</span><span class="mtk1"> local_10 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk5">-0x</span><span class="mtk6">45</span><span class="mtk1">))</span>
<span class="mtk1">         </span><span class="mtk5">&amp;&amp;</span><span class="mtk1"> (</span><span class="mtk5">*</span><span class="mtk1">(</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">)(param_1 </span><span class="mtk5">+</span><span class="mtk1"> local_10 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">2</span><span class="mtk1">) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk5">-0x</span><span class="mtk6">55</span><span class="mtk1">)) </span><span class="mtk5">&amp;&amp;</span>
<span class="mtk1">        (((</span><span class="mtk5">*</span><span class="mtk1">(</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">)(param_1 </span><span class="mtk5">+</span><span class="mtk1"> local_10 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">3</span><span class="mtk1">) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk5">-0x</span><span class="mtk6">55</span><span class="mtk1"> </span><span class="mtk5">&amp;&amp;</span>
<span class="mtk1">          (</span><span class="mtk5">*</span><span class="mtk1">(</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">)(param_1 </span><span class="mtk5">+</span><span class="mtk1"> local_10 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">4</span><span class="mtk1">) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk5">-0x</span><span class="mtk6">56</span><span class="mtk1">)) </span><span class="mtk5">&amp;&amp;</span>
<span class="mtk1">         ((</span><span class="mtk5">*</span><span class="mtk1">(</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">)(param_1 </span><span class="mtk5">+</span><span class="mtk1"> local_10 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">5</span><span class="mtk1">) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk5">-0x</span><span class="mtk6">45</span><span class="mtk1"> </span><span class="mtk5">&amp;&amp;</span>
<span class="mtk1">          ((</span><span class="mtk5">*</span><span class="mtk1">(</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">)(param_1 </span><span class="mtk5">+</span><span class="mtk1"> local_10 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">6</span><span class="mtk1">) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk5">-0x</span><span class="mtk6">55</span><span class="mtk1"> </span><span class="mtk5">&amp;&amp;</span>
<span class="mtk1">           (</span><span class="mtk5">*</span><span class="mtk1">(</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">)(param_1 </span><span class="mtk5">+</span><span class="mtk1"> local_10 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">7</span><span class="mtk1">) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk5">-0x</span><span class="mtk6">55</span><span class="mtk1">)))))))) </span><span class="mtk5">&amp;&amp;</span>
<span class="mtk1">       (((</span><span class="mtk5">*</span><span class="mtk1">(</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">)(param_1 </span><span class="mtk5">+</span><span class="mtk1"> local_10 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">8</span><span class="mtk1">) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk5">-0x</span><span class="mtk6">56</span><span class="mtk1"> </span><span class="mtk5">&amp;&amp;</span>
<span class="mtk1">         (((</span><span class="mtk5">*</span><span class="mtk1">(</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">)(param_1 </span><span class="mtk5">+</span><span class="mtk1"> local_10 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">9</span><span class="mtk1">) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk5">-0x</span><span class="mtk6">45</span><span class="mtk1"> </span><span class="mtk5">&amp;&amp;</span>
<span class="mtk1">           (</span><span class="mtk5">*</span><span class="mtk1">(</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">)(param_1 </span><span class="mtk5">+</span><span class="mtk1"> local_10 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">10</span><span class="mtk1">) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk5">-0x</span><span class="mtk6">55</span><span class="mtk1">)) </span><span class="mtk5">&amp;&amp;</span>
<span class="mtk1">          (</span><span class="mtk5">*</span><span class="mtk1">(</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">)(param_1 </span><span class="mtk5">+</span><span class="mtk1"> local_10 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">b</span><span class="mtk1">) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk5">-0x</span><span class="mtk6">55</span><span class="mtk1">)))) </span><span class="mtk5">&amp;&amp;</span>
<span class="mtk1">        (((</span><span class="mtk5">*</span><span class="mtk1">(</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">)(param_1 </span><span class="mtk5">+</span><span class="mtk1"> local_10 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">c</span><span class="mtk1">) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk5">-0x</span><span class="mtk6">56</span><span class="mtk1"> </span><span class="mtk5">&amp;&amp;</span>
<span class="mtk1">          (</span><span class="mtk5">*</span><span class="mtk1">(</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">)(param_1 </span><span class="mtk5">+</span><span class="mtk1"> local_10 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">d</span><span class="mtk1">) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk5">-0x</span><span class="mtk6">45</span><span class="mtk1">)) </span><span class="mtk5">&amp;&amp;</span>
<span class="mtk1">         ((</span><span class="mtk5">*</span><span class="mtk1">(</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">)(param_1 </span><span class="mtk5">+</span><span class="mtk1"> local_10 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">e</span><span class="mtk1">) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk5">-0x</span><span class="mtk6">55</span><span class="mtk1"> </span><span class="mtk5">&amp;&amp;</span>
<span class="mtk1">          (</span><span class="mtk5">*</span><span class="mtk1">(</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">)(param_1 </span><span class="mtk5">+</span><span class="mtk1"> local_10 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">f</span><span class="mtk1">) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk5">-0x</span><span class="mtk6">55</span><span class="mtk1">)))))))) {</span>
<span class="mtk1">      </span><span class="mtk5">for</span><span class="mtk1"> (local_20 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">; local_20 </span><span class="mtk5">&lt;</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">10</span><span class="mtk1">; local_20 </span><span class="mtk5">=</span><span class="mtk1"> local_20 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">) {</span>
<span class="mtk1">        </span><span class="mtk5">*</span><span class="mtk1">(undefined </span><span class="mtk5">*</span><span class="mtk1">)(param_1 </span><span class="mtk5">+</span><span class="mtk1"> local_20 </span><span class="mtk5">+</span><span class="mtk1"> local_10) </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">(undefined </span><span class="mtk5">*</span><span class="mtk1">)(local_20 </span><span class="mtk5">+</span><span class="mtk1"> param_5);</span>
<span class="mtk1">      }</span>
<span class="mtk1">    }</span>
<span class="mtk1">    </span><span class="mtk5">if</span><span class="mtk1"> (((((</span><span class="mtk5">*</span><span class="mtk1">(</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">)(local_10 </span><span class="mtk5">+</span><span class="mtk1"> param_1) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk4">'w'</span><span class="mtk1">) </span><span class="mtk5">&amp;&amp;</span><span class="mtk1"> (</span><span class="mtk5">*</span><span class="mtk1">(</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">)(param_1 </span><span class="mtk5">+</span><span class="mtk1"> local_10 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk4">'w'</span><span class="mtk1">)) </span><span class="mtk5">&amp;&amp;</span>
<span class="mtk1">         ((</span><span class="mtk5">*</span><span class="mtk1">(</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">)(param_1 </span><span class="mtk5">+</span><span class="mtk1"> local_10 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">2</span><span class="mtk1">) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk4">'w'</span><span class="mtk1"> </span><span class="mtk5">&amp;&amp;</span>
<span class="mtk1">          ((((</span><span class="mtk5">*</span><span class="mtk1">(</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">)(param_1 </span><span class="mtk5">+</span><span class="mtk1"> local_10 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">3</span><span class="mtk1">) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk4">'w'</span><span class="mtk1"> </span><span class="mtk5">&amp;&amp;</span><span class="mtk1"> (</span><span class="mtk5">*</span><span class="mtk1">(</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">)(param_1 </span><span class="mtk5">+</span><span class="mtk1"> local_10 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">4</span><span class="mtk1">) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk4">'w'</span><span class="mtk1">)</span>
<span class="mtk1">             ) </span><span class="mtk5">&amp;&amp;</span><span class="mtk1"> (</span><span class="mtk5">*</span><span class="mtk1">(</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">)(param_1 </span><span class="mtk5">+</span><span class="mtk1"> local_10 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">5</span><span class="mtk1">) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk4">'w'</span><span class="mtk1">)) </span><span class="mtk5">&amp;&amp;</span>
<span class="mtk1">           ((</span><span class="mtk5">*</span><span class="mtk1">(</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">)(param_1 </span><span class="mtk5">+</span><span class="mtk1"> local_10 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">6</span><span class="mtk1">) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk4">'w'</span><span class="mtk1"> </span><span class="mtk5">&amp;&amp;</span><span class="mtk1"> (</span><span class="mtk5">*</span><span class="mtk1">(</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">)(param_1 </span><span class="mtk5">+</span><span class="mtk1"> local_10 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">7</span><span class="mtk1">) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk4">'w'</span><span class="mtk1">))</span>
<span class="mtk1">           )))))) </span><span class="mtk5">&amp;&amp;</span><span class="mtk1"> (</span><span class="mtk5">*</span><span class="mtk1">(</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">)(param_1 </span><span class="mtk5">+</span><span class="mtk1"> local_10 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">8</span><span class="mtk1">) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk4">'w'</span><span class="mtk1">)) </span><span class="mtk5">&amp;&amp;</span>
<span class="mtk1">       ((</span><span class="mtk5">*</span><span class="mtk1">(</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">)(param_1 </span><span class="mtk5">+</span><span class="mtk1"> local_10 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">9</span><span class="mtk1">) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk4">'w'</span><span class="mtk1"> </span><span class="mtk5">&amp;&amp;</span><span class="mtk1"> (</span><span class="mtk5">*</span><span class="mtk1">(</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">)(param_1 </span><span class="mtk5">+</span><span class="mtk1"> local_10 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">10</span><span class="mtk1">) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk4">'w'</span><span class="mtk1">))))</span>
<span class="mtk1">    {</span>
<span class="mtk1">      </span><span class="mtk5">for</span><span class="mtk1"> (local_28 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">; local_28 </span><span class="mtk5">&lt;</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">b</span><span class="mtk1">; local_28 </span><span class="mtk5">=</span><span class="mtk1"> local_28 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">) {</span>
<span class="mtk1">        </span><span class="mtk5">*</span><span class="mtk1">(undefined </span><span class="mtk5">*</span><span class="mtk1">)(param_1 </span><span class="mtk5">+</span><span class="mtk1"> local_28 </span><span class="mtk5">+</span><span class="mtk1"> local_10) </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">(undefined </span><span class="mtk5">*</span><span class="mtk1">)(local_28 </span><span class="mtk5">+</span><span class="mtk1"> param_6);</span>
<span class="mtk1">      }</span>
<span class="mtk1">    }</span>
<span class="mtk1">  }</span>
<span class="mtk1">}</span>
</code></pre></div><p>Esta función parece complicada, pero lo que hace es buscar unas <em>strings</em> determinadas en <code>main.exe</code> y reemplaza algunos caracteres de la región de memoria con dirección <code>0x140009280</code> por caracteres de la subparte que recibe como argumento:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">strings</span> <span class="mtku">main.exe</span> | <span class="code-dark-green">grep</span> wwwww
<span class="code-red">wwwwwwwwww</span>w

<span class="code-cyan">$</span> <span class="code-dark-green">xxd</span> <span class="mtku">main.exe</span> | <span class="code-dark-green">grep</span> -C 4 wwwww
000084f0: 4989 c949 89d0 31c0 eb0e 660f 1f44 0000  I..I..1...f..D..  
00008500: 4883 c001 38ca 7518 410f b614 0141 0fb6  H...8.u.A....A..
00008510: 0c00 84d2 75ea 0fb6 c1f7 d8c3 0f1f 4000  ....u.........@.
00008520: 0fb6 c229 c8c3 9090 9090 9090 9090 9090  ...)............
00008530: 7777 7777 7777 7777 7777 7700 c390 9090  <span class="code-red">wwwwwwwwww</span>w.....
00008540: aabb abab aabb abab aabb abab aabb abab  ................
00008550: c390 9090 9090 9090 9090 9090 9090 9090  ................
00008560: 4155 4154 5557 5648 be6d 7376 6372 742e  AUATUWVH.msvcrt.
00008570: 6453 4881 ec88 0000 00e8 22fd ffff 488d  dSH......."...H.
</code></pre></div><p>En esta dirección <code>0x140009280</code> es donde se realiza <code>VirtualProtect</code>, y además, después se ejecuta un <em>thread</em> en esta misma dirección. Por tanto, el contenido que hay en esta región de memoria es <em>shellcode</em>. En Ghidra, podemos ir a esta dirección y descompilarlo para ver el <em>shellcode</em> en C:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk7 mtki">void</span><span class="mtk1"> </span><span class="mtk8">UndefinedFunction_140009280</span><span class="mtk1">() {</span>
<span class="mtk1">  </span><span class="mtk8">FUN_140009560</span><span class="mtk1">();</span>
<span class="mtk1">}</span>

<span class="mtk1">undefined8 </span><span class="mtk8">FUN_140009560</span><span class="mtk1">() {</span>
<span class="mtk1">  byte </span><span class="mtk5">*</span><span class="mtk1">pbVar1;</span>
<span class="mtk1">  </span><span class="mtk7 mtki">int</span><span class="mtk1"> iVar2;</span>
<span class="mtk1">  longlong lVar3;</span>
<span class="mtk1">  code </span><span class="mtk5">*</span><span class="mtk1">pcVar4;</span>
<span class="mtk1">  code </span><span class="mtk5">*</span><span class="mtk1">pcVar5;</span>
<span class="mtk1">  code </span><span class="mtk5">*</span><span class="mtk1">pcVar6;</span>
<span class="mtk1">  undefined8 uVar7;</span>
<span class="mtk1">  byte </span><span class="mtk5">*</span><span class="mtk1">pbVar8;</span>
<span class="mtk1">  undefined8 in_stack_ffffffffffffff68;</span>
<span class="mtk1">  undefined4 uVar9;</span>
<span class="mtk1">  undefined local_78[</span><span class="mtk6">6</span><span class="mtk1">];</span>
<span class="mtk1">  undefined8 local_72;</span>
<span class="mtk1">  undefined2 local_6a;</span>
<span class="mtk1">  undefined8 local_68;</span>
<span class="mtk1">  undefined2 local_60;</span>
<span class="mtk1">  undefined local_5e;</span>
<span class="mtk1">  undefined8 local_5d;</span>
<span class="mtk1">  undefined4 local_55;</span>
<span class="mtk1">  undefined8 local_51;</span>
<span class="mtk1">  undefined4 local_49;</span>
<span class="mtk1">  undefined8 local_45;</span>
<span class="mtk1">  undefined4 local_3d;</span>
<span class="mtk1">  undefined local_39;</span>

<span class="mtk1">  uVar9 </span><span class="mtk5">=</span><span class="mtk1"> (undefined4) ((ulonglong) in_stack_ffffffffffffff</span><span class="mtk1">68 </span><span class="mtk5">&gt;&gt;</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">20</span><span class="mtk1">);</span>
<span class="mtk1">  lVar3 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">FUN_1400092a0</span><span class="mtk1">();</span>
<span class="mtk1">  local_39 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">;</span>
<span class="mtk1">  local_3d </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">41797261</span><span class="mtk1">;</span>
<span class="mtk1">  local_45 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">7262694c64616f4c</span><span class="mtk1">;</span>
<span class="mtk1">  pcVar4 </span><span class="mtk5">=</span><span class="mtk1"> (code </span><span class="mtk5">*</span><span class="mtk1">) </span><span class="mtk8">FUN_140009330</span><span class="mtk1">(lVar3, (ulonglong) </span><span class="mtk5">&amp;</span><span class="mtk1">local_45);</span>
<span class="mtk1">  local_68 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">642e74726376736d</span><span class="mtk1">;</span>
<span class="mtk1">  local_60 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">6c6c</span><span class="mtk1">;</span>
<span class="mtk1">  local_5e </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">;</span>
<span class="mtk1">  (</span><span class="mtk5">*</span><span class="mtk1">pcVar4)(</span><span class="mtk5">&amp;</span><span class="mtk1">local_68);</span>
<span class="mtk1">  local_5d </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">6946657461657243</span><span class="mtk1">;</span>
<span class="mtk1">  local_55 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">41656c</span><span class="mtk1">;</span>
<span class="mtk1">  pcVar4 </span><span class="mtk5">=</span><span class="mtk1"> (code </span><span class="mtk5">*</span><span class="mtk1">) </span><span class="mtk8">FUN_140009330</span><span class="mtk1">(lVar3, (ulonglong) </span><span class="mtk5">&amp;</span><span class="mtk1">local_5d);</span>
<span class="mtk1">  local_6a </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">65</span><span class="mtk1">;</span>
<span class="mtk1">  local_72 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">6c69466574697257</span><span class="mtk1">;</span>
<span class="mtk1">  pcVar5 </span><span class="mtk5">=</span><span class="mtk1"> (code </span><span class="mtk5">*</span><span class="mtk1">) </span><span class="mtk8">FUN_140009330</span><span class="mtk1">(lVar3, (ulonglong) </span><span class="mtk5">&amp;</span><span class="mtk1">local_72);</span>
<span class="mtk1">  local_49 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">656c64</span><span class="mtk1">;</span>
<span class="mtk1">  local_51 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">6e614865736f6c43</span><span class="mtk1">;</span>
<span class="mtk1">  pcVar6 </span><span class="mtk5">=</span><span class="mtk1"> (code </span><span class="mtk5">*</span><span class="mtk1">) </span><span class="mtk8">FUN_140009330</span><span class="mtk1">(lVar3, (ulonglong) </span><span class="mtk5">&amp;</span><span class="mtk1">local_51);</span>
<span class="mtk1">  pbVar8 </span><span class="mtk5">=</span><span class="mtk1"> DAT_1400094e0;</span>
<span class="mtk1">  uVar7 </span><span class="mtk5">=</span><span class="mtk1"> (</span><span class="mtk5">*</span><span class="mtk1">pcVar4)(DAT_140009530, </span><span class="mtk5">0x</span><span class="mtk6">40000000</span><span class="mtk1">, </span><span class="mtk6">0</span><span class="mtk1">, </span><span class="mtk6">0</span><span class="mtk1">, </span><span class="mtk8">CONCAT44</span><span class="mtk1">(uVar9, </span><span class="mtk6">2</span><span class="mtk1">), </span><span class="mtk5">0x</span><span class="mtk6">80</span><span class="mtk1">, </span><span class="mtk6">0</span><span class="mtk1">);</span>

<span class="mtk1">  </span><span class="mtk5">if</span><span class="mtk1"> (((((DAT_140009540 </span><span class="mtk5">==</span><span class="mtk1"> pbVar8[</span><span class="mtk5">0x</span><span class="mtk6">2ec9c</span><span class="mtk1">]) </span><span class="mtk5">&amp;&amp;</span><span class="mtk1"> (DAT_140009541 </span><span class="mtk5">==</span><span class="mtk1"> pbVar8[</span><span class="mtk5">0x</span><span class="mtk6">35</span><span class="mtk1">])) </span><span class="mtk5">&amp;&amp;</span>
<span class="mtk1">       (DAT_140009542 </span><span class="mtk5">==</span><span class="mtk1"> pbVar8[</span><span class="mtk5">0x</span><span class="mtk6">104</span><span class="mtk1">])) </span><span class="mtk5">&amp;&amp;</span>
<span class="mtk1">      (((DAT_140009543 </span><span class="mtk5">==</span><span class="mtk1"> pbVar8[</span><span class="mtk5">0x</span><span class="mtk6">63d1</span><span class="mtk1">] </span><span class="mtk5">&amp;&amp;</span><span class="mtk1"> (DAT_140009544 </span><span class="mtk5">==</span><span class="mtk1"> pbVar8[</span><span class="mtk5">0x</span><span class="mtk6">18864</span><span class="mtk1">])) </span><span class="mtk5">&amp;&amp;</span>
<span class="mtk1">       ((DAT_140009545 </span><span class="mtk5">==</span><span class="mtk1"> pbVar8[</span><span class="mtk5">0x</span><span class="mtk6">1d76c</span><span class="mtk1">] </span><span class="mtk5">&amp;&amp;</span>
<span class="mtk1">        ((DAT_140009546 </span><span class="mtk5">==</span><span class="mtk1"> pbVar8[</span><span class="mtk5">0x</span><span class="mtk6">1a1c6</span><span class="mtk1">] </span><span class="mtk5">&amp;&amp;</span><span class="mtk1"> (DAT_140009547 </span><span class="mtk5">==</span><span class="mtk1"> pbVar8[</span><span class="mtk5">0x</span><span class="mtk6">1a117</span><span class="mtk1">])))))))) </span><span class="mtk5">&amp;&amp;</span>  
<span class="mtk1">     ((DAT_140009548 </span><span class="mtk5">==</span><span class="mtk1"> pbVar8[</span><span class="mtk5">0x</span><span class="mtk6">14501</span><span class="mtk1">] </span><span class="mtk5">&amp;&amp;</span>
<span class="mtk1">      (((((DAT_140009549 </span><span class="mtk5">==</span><span class="mtk1"> pbVar8[</span><span class="mtk5">0x</span><span class="mtk6">13163</span><span class="mtk1">] </span><span class="mtk5">&amp;&amp;</span><span class="mtk1"> (DAT_14000954a </span><span class="mtk5">==</span><span class="mtk1"> pbVar8[</span><span class="mtk5">0x</span><span class="mtk6">178c2</span><span class="mtk1">])) </span><span class="mtk5">&amp;&amp;</span>
<span class="mtk1">         (DAT_14000954b </span><span class="mtk5">==</span><span class="mtk1"> pbVar8[</span><span class="mtk5">0x</span><span class="mtk6">13949</span><span class="mtk1">])) </span><span class="mtk5">&amp;&amp;</span>
<span class="mtk1">        ((DAT_14000954c </span><span class="mtk5">==</span><span class="mtk1"> pbVar8[</span><span class="mtk5">0x</span><span class="mtk6">1116d</span><span class="mtk1">] </span><span class="mtk5">&amp;&amp;</span><span class="mtk1"> (DAT_14000954d </span><span class="mtk5">==</span><span class="mtk1"> pbVar8[</span><span class="mtk5">0x</span><span class="mtk6">11bf6</span><span class="mtk1">])))) </span><span class="mtk5">&amp;&amp;</span>
<span class="mtk1">       ((DAT_14000954e </span><span class="mtk5">==</span><span class="mtk1"> pbVar8[</span><span class="mtk5">0x</span><span class="mtk6">fc29</span><span class="mtk1">] </span><span class="mtk5">&amp;&amp;</span><span class="mtk1"> (DAT_14000954f </span><span class="mtk5">==</span><span class="mtk1"> pbVar8[</span><span class="mtk5">0x</span><span class="mtk6">ec7c</span><span class="mtk1">])))))))) {</span>
<span class="mtk1">    </span><span class="mtk8">FUN_140009400</span><span class="mtk1">(</span><span class="mtk5">0x</span><span class="mtk6">140009540</span><span class="mtk1">, </span><span class="mtk5">0x</span><span class="mtk6">10</span><span class="mtk1">, pbVar8, </span><span class="mtk5">0x</span><span class="mtk6">6cebf</span><span class="mtk1">);</span>
<span class="mtk1">  }</span>

<span class="mtk1">  pbVar1 </span><span class="mtk5">=</span><span class="mtk1"> pbVar8 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">6cebf</span><span class="mtk1">;</span>

<span class="mtk1">  </span><span class="mtk5">do</span><span class="mtk1"> {</span>
<span class="mtk1">    iVar2 </span><span class="mtk5">=</span><span class="mtk1"> (</span><span class="mtk5">*</span><span class="mtk1">pcVar5)(uVar7, pbVar8, </span><span class="mtk6">1</span><span class="mtk1">, local_78, </span><span class="mtk6">0</span><span class="mtk1">);</span>
<span class="mtk1">    </span><span class="mtk5">if</span><span class="mtk1"> (iVar2 </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">) </span><span class="mtk5">break</span><span class="mtk1">;</span>
<span class="mtk1">    pbVar8 </span><span class="mtk5">=</span><span class="mtk1"> pbVar8 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">;</span>
<span class="mtk1">  } </span><span class="mtk5">while</span><span class="mtk1"> (pbVar8 </span><span class="mtk5">!=</span><span class="mtk1"> pbVar1);</span>

<span class="mtk1">  (</span><span class="mtk5">*</span><span class="mtk1">pcVar6)(uVar7);</span>

<span class="mtk1">  </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">;</span>
<span class="mtk1">}</span>
</code></pre></div><p>Por un lado, vemos dígitos hexadecimales que se corresponden con caracteres ASCII imprimibles y contienen esta información:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">python3</span> -q
&gt;&gt;&gt; from pwn import p8, p16, p32, p64
&gt;&gt;&gt; p64(0x7262694c64616f4c) + p32(0x41797261)  
b'LoadLibraryA'
&gt;&gt;&gt; p64(0x642e74726376736d) + p16(0x6c6c)
b'msvcrt.dll'
&gt;&gt;&gt; p64(0x6946657461657243) + p32(0x41656c)
b'CreateFileA\x00'
&gt;&gt;&gt; p64(0x6c69466574697257) + p8(0x65)
b'WriteFile'
&gt;&gt;&gt; p64(0x6e614865736f6c43) + p32(0x656c64)
b'CloseHandle\x00'
</code></pre></div><p>Entonces, podemos deducir que está llamando a estas funciones de la API de Windows. Además, vemos comprobaciones sobre unas ciertas direcciones como <code>DAT140009530</code>. Si miramos qué hay en estas direcciones, encontraremos los caracteres <code>w</code> de antes:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">140009530 77 77 77    ds     "wwwwwwwwwww"  
          77 77 77
          77 77 77
14000953c c3          ??     C3h
14000953d 90          ??     90h
14000953e 90          ??     90h
14000953f 90          ??     90h
140009540 aa          ??     AAh
140009541 bb          ??     BBh
140009542 ab          ??     ABh
140009543 ab          ??     ABh
140009544 aa          ??     AAh
140009545 bb          ??     BBh
140009546 ab          ??     ABh
140009547 ab          ??     ABh
140009548 aa          ??     AAh
140009549 bb          ??     BBh
14000954a ab          ??     ABh
14000954b ab          ??     ABh
14000954c aa          ??     AAh
14000954d bb          ??     BBh
14000954e ab          ??     ABh
14000954f ab          ??     ABh
140009550 c3          ??     C3h
140009551 90          ??     90h
140009552 90          ??     90h
140009553 90          ??     90h
140009554 90          ??     90h
...
</code></pre></div><p>Y esto se comprueba con <code>pbVar8</code>, que contiene la dirección <code>DAT_1400094e0</code>:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">1400094e0 88          ??     88h  
1400094e1 88          ??     88h
1400094e2 88          ??     88h
1400094e3 88          ??     88h
1400094e4 88          ??     88h
1400094e5 88          ??     88h
1400094e6 88          ??     88h
1400094e7 88          ??     88h
1400094e8 c3          ??     C3h
1400094e9 90          ??     90h
1400094ea 90          ??     90h
</code></pre></div><p>En este punto podríamos depurar con x64dbg, y nos daríamos cuenta de que en esa región de memoria se guarda la dirección en la que se escribe la DLL cifrada. En el código aparece aquí (<code>-0x78</code> es <code>0x88</code>):</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">  </span><span class="mtk5">for</span><span class="mtk1"> (local_10 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">; local_10 </span><span class="mtk5">&lt;</span><span class="mtk1"> param_2; local_10 </span><span class="mtk5">=</span><span class="mtk1"> local_10 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">) {</span>
<span class="mtk1">    </span><span class="mtk5">if</span><span class="mtk1"> (((((</span><span class="mtk5">*</span><span class="mtk1">(</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">)(local_10 </span><span class="mtk5">+</span><span class="mtk1"> param_1) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk5">-0x</span><span class="mtk6">78</span><span class="mtk1">) </span><span class="mtk5">&amp;&amp;</span><span class="mtk1"> (</span><span class="mtk5">*</span><span class="mtk1">(</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">)(param_1 </span><span class="mtk5">+</span><span class="mtk1"> local_10 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk5">-0x</span><span class="mtk6">78</span><span class="mtk1">))</span>  
<span class="mtk1">         </span><span class="mtk5">&amp;&amp;</span><span class="mtk1"> (</span><span class="mtk5">*</span><span class="mtk1">(</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">)(param_1 </span><span class="mtk5">+</span><span class="mtk1"> local_10 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">2</span><span class="mtk1">) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk5">-0x</span><span class="mtk6">78</span><span class="mtk1">)) </span><span class="mtk5">&amp;&amp;</span>
<span class="mtk1">        ((</span><span class="mtk5">*</span><span class="mtk1">(</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">)(param_1 </span><span class="mtk5">+</span><span class="mtk1"> local_10 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">3</span><span class="mtk1">) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk5">-0x</span><span class="mtk6">78</span><span class="mtk1"> </span><span class="mtk5">&amp;&amp;</span><span class="mtk1"> (</span><span class="mtk5">*</span><span class="mtk1">(</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">)(param_1 </span><span class="mtk5">+</span><span class="mtk1"> local_10 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">4</span><span class="mtk1">) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk5">-0x</span><span class="mtk6">78</span><span class="mtk1">)</span>
<span class="mtk1">         ))) </span><span class="mtk5">&amp;&amp;</span><span class="mtk1"> ((</span><span class="mtk5">*</span><span class="mtk1">(</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">)(param_1 </span><span class="mtk5">+</span><span class="mtk1"> local_10 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">5</span><span class="mtk1">) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk5">-0x</span><span class="mtk6">78</span><span class="mtk1"> </span><span class="mtk5">&amp;&amp;</span>
<span class="mtk1">                 ((</span><span class="mtk5">*</span><span class="mtk1">(</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">)(param_1 </span><span class="mtk5">+</span><span class="mtk1"> local_10 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">6</span><span class="mtk1">) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk5">-0x</span><span class="mtk6">78</span><span class="mtk1"> </span><span class="mtk5">&amp;&amp;</span>
<span class="mtk1">                  (</span><span class="mtk5">*</span><span class="mtk1">(</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">)(param_1 </span><span class="mtk5">+</span><span class="mtk1"> local_10 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">7</span><span class="mtk1">) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk5">-0x</span><span class="mtk6">78</span><span class="mtk1">)))))) {</span>
<span class="mtk1">      </span><span class="mtk5">for</span><span class="mtk1"> (local_18 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">; local_18 </span><span class="mtk5">&lt;</span><span class="mtk1"> </span><span class="mtk6">8</span><span class="mtk1">; local_18 </span><span class="mtk5">=</span><span class="mtk1"> local_18 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">) {</span>
<span class="mtk1">        </span><span class="mtk5">*</span><span class="mtk1">(undefined </span><span class="mtk5">*</span><span class="mtk1">)(param_1 </span><span class="mtk5">+</span><span class="mtk1"> local_18 </span><span class="mtk5">+</span><span class="mtk1"> local_10) </span><span class="mtk5">=</span><span class="mtk1"> local_res18[local_18];</span>
<span class="mtk1">      }</span>
<span class="mtk1">    }</span>
</code></pre></div><p>Y recordemos que esta función se llama después de leer <code>ciphered.dll</code>, cuya dirección está en <code>local_20</code>:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">  local_20 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">FUN_140001765</span><span class="mtk1">(</span><span class="mtk5">&amp;</span><span class="mtk1">local_40, puVar1, param_3, param_4);</span>
<span class="mtk1">  </span><span class="mtk8">VirtualProtect</span><span class="mtk1">(</span><span class="mtk5">&amp;</span><span class="mtk1">DAT_140009280, (ulonglong) DAT_140009820, (</span><span class="mtk7 mtki">uint</span><span class="mtk1">) param_1, </span><span class="mtk5">&amp;</span><span class="mtk1">local_44);</span>
<span class="mtk1">  </span><span class="mtk8">FUN_14000185e</span><span class="mtk1">(</span><span class="mtk5">0x</span><span class="mtk6">140009280</span><span class="mtk1">, (ulonglong) DAT_140009820, local_20, local_40, (</span><span class="mtk1">longlong) local_38, local_30);</span>  
<span class="mtk1">  </span><span class="mtk8">VirtualProtect</span><span class="mtk1">(</span><span class="mtk5">&amp;</span><span class="mtk1">DAT_140009280, (ulonglong) DAT_140009820, </span><span class="mtk5">0x</span><span class="mtk6">40</span><span class="mtk1">, </span><span class="mtk5">&amp;</span><span class="mtk1">local_44);</span>
</code></pre></div><p>Entonces, ya sabemos qué caracteres deben ir ahí para poder pasar el <code>if</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">python3</span> -q
&gt;&gt;&gt; with open('ciphered.dll', 'rb') as f:
...     ciphered_dll = f.read()
...
&gt;&gt;&gt; pbVar8 = ciphered_dll
&gt;&gt;&gt; bytes([pbVar8[0x2ec9c], pbVar8[0x35], pbVar8[0x104], pbVar8[0x63d1], pbVar8[0x18864], pbVar8[0x1d76c], pbVar8[0x1a1c6], pbVar8[0x1a117], pbVar8[0x14501], pbVar8[0x13163], pbVar8[0x178c2], pbVar8[0x13949], pbVar8[0x1116d], pbVar8[0x11bf6], pbVar8[0xfc29], pbVar8[0xec7c]])  
b'd0n0t8ruT3,th1nk'
</code></pre></div><p>Con esta subparte, se llama a la función <code>FUN_140009400</code> con el contenido de la DLL cifrada, para descifrarla. Y después, se escribe como archivo con <code>WriteFile</code>.</p><p>Realizando pruebas en local con el depurador, descubrimos que la segunda subparte indica el nombre del archivo en el que escribir la DLL descifrada.</p><p>Entonces, de momento tenemos esta <code>input_string</code>: <code>ctf@hackon?/d0n0t8ruT3,th1nk_filename/</code>.</p><h3 id="últimas-comprobaciones">Últimas comprobaciones</h3><p>La siguiente función que se ejecuta en el <code>main</code> es <code>FUN_140001fa2</code>, usando como argumentos la cuarta parte y la tercera parte (en ese orden):</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk7 mtki">void</span><span class="mtk1"> </span><span class="mtk8">FUN_140001fa2</span><span class="mtk1">(</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk9 mtki">param_1</span><span class="mtk1">, </span><span class="mtk8 mtku">undefined</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk9 mtki">param_2</span><span class="mtk1">) {</span>
<span class="mtk1">  DWORD DVar1;</span>
<span class="mtk1">  HANDLE hFileMappingObject;</span>
<span class="mtk1">  </span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">_Dest;</span>
<span class="mtk1">  undefined8 uVar2;</span>
<span class="mtk1">  undefined8 uVar3;</span>
<span class="mtk1">  </span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">local_res8;</span>

<span class="mtk1">  uVar3 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">;</span>
<span class="mtk1">  uVar2 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">4</span><span class="mtk1">;</span>
<span class="mtk1">  hFileMappingObject </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">CreateFileMappingA</span><span class="mtk1">((HANDLE) </span><span class="mtk5">0x</span><span class="mtk6">ffffffffffffffff</span><span class="mtk1">, </span><span class="mtk6">NULL</span><span class="mtk1">, </span><span class="mtk6">4</span><span class="mtk1">, </span><span class="mtk6">0</span><span class="mtk1">, </span><span class="mtk5">0x</span><span class="mtk6">1000</span><span class="mtk1">, </span><span class="mtk4">"SharedMemory"</span><span class="mtk1">);</span>

<span class="mtk1">  </span><span class="mtk5">if</span><span class="mtk1"> (hFileMappingObject </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">NULL</span><span class="mtk1">) {</span>
<span class="mtk1">    DVar1 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">GetLastError</span><span class="mtk1">();</span>
<span class="mtk1">    </span><span class="mtk8">do_print</span><span class="mtk1">(</span><span class="mtk4">"Failed to create shared memory: </span><span class="mtk6">%d\n</span><span class="mtk4">"</span><span class="mtk1">, (</span><span class="mtk8">undefined1</span><span class="mtk1"> (</span><span class="mtk5">*</span><span class="mtk1">) [</span><span class="mtk6">10</span><span class="mtk1">]) (ulonglong) DVar1, uVar2, uVar3);</span>  
<span class="mtk1">  } </span><span class="mtk5">else</span><span class="mtk1"> {</span>
<span class="mtk1">    uVar3 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">;</span>
<span class="mtk1">    uVar2 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">;</span>
<span class="mtk1">    _Dest </span><span class="mtk5">=</span><span class="mtk1"> (</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">) </span><span class="mtk8">MapViewOfFile</span><span class="mtk1">(hFileMappingObject, </span><span class="mtk6">2</span><span class="mtk1">, </span><span class="mtk6">0</span><span class="mtk1">, </span><span class="mtk6">0</span><span class="mtk1">, </span><span class="mtk5">0x</span><span class="mtk6">1000</span><span class="mtk1">);</span>

<span class="mtk1">    </span><span class="mtk5">if</span><span class="mtk1"> (_Dest </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">NULL</span><span class="mtk1">) {</span>
<span class="mtk1">      DVar1 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">GetLastError</span><span class="mtk1">();</span>
<span class="mtk1">      </span><span class="mtk8">do_print</span><span class="mtk1">(</span><span class="mtk4">"Failed to map view of file: </span><span class="mtk6">%d\n</span><span class="mtk4">"</span><span class="mtk1">, (</span><span class="mtk8">undefined1</span><span class="mtk1"> (</span><span class="mtk5">*</span><span class="mtk1">) [</span><span class="mtk6">10</span><span class="mtk1">]) (ulonglong) DVar1, uVar2, uVar3);</span>
<span class="mtk1">      </span><span class="mtk8">CloseHandle</span><span class="mtk1">(hFileMappingObject);</span>
<span class="mtk1">    } </span><span class="mtk5">else</span><span class="mtk1"> {</span>
<span class="mtk1">      local_res8 </span><span class="mtk5">=</span><span class="mtk1"> param_1;</span>

<span class="mtk1">      </span><span class="mtk5">if</span><span class="mtk1"> (param_1 </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">NULL</span><span class="mtk1">) {</span>
<span class="mtk1">        local_res8 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk4">"almost:D"</span><span class="mtk1">;</span>
<span class="mtk1">      }</span>

<span class="mtk1">      </span><span class="mtk8">strcpy</span><span class="mtk1">(_Dest,local_res8);</span>
<span class="mtk1">      </span><span class="mtk8">FUN_140001e22</span><span class="mtk1">(param_2);</span>
<span class="mtk1">      </span><span class="mtk8">UnmapViewOfFile</span><span class="mtk1">(_Dest);</span>
<span class="mtk1">      </span><span class="mtk8">CloseHandle</span><span class="mtk1">(hFileMappingObject);</span>
<span class="mtk1">    }</span>
<span class="mtk1">  }</span>
<span class="mtk1">}</span>
</code></pre></div><p>En esta función se crea una región de memoria compartida llamada <code>Shared Memory</code>. Luego, copia <code>param_1</code> (la cuarta parte de <code>input_string</code>) en dicha región de memoria compartida y ejecuta <code>FUN_140001e22</code> sobre la <code>param_2</code> (la tercera parte):</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">undefined8 </span><span class="mtk8">FUN_140001e22</span><span class="mtk1">(undefined </span><span class="mtk5">*</span><span class="mtk9 mtki">param_1</span><span class="mtk1">) {</span>
<span class="mtk1">  LPTHREAD_START_ROUTINE lpStartAddress;</span>
<span class="mtk1">  undefined8 uVar1;</span>
<span class="mtk1">  HANDLE hHandle;</span>
<span class="mtk1">  </span><span class="mtk8">undefined1</span><span class="mtk1"> (</span><span class="mtk5">*</span><span class="mtk1">pauVar2)[</span><span class="mtk6">10</span><span class="mtk1">];</span>
<span class="mtk1">  ulonglong local_10;</span>

<span class="mtk1">  lpStartAddress </span><span class="mtk5">=</span><span class="mtk1"> (LPTHREAD_START_ROUTINE) </span><span class="mtk8">VirtualAlloc</span><span class="mtk1">(</span><span class="mtk6">NULL</span><span class="mtk1">, (ulonglong) DAT_140009260, </span><span class="mtk5">0x</span><span class="mtk6">3000</span><span class="mtk1">, </span><span class="mtk5">0x</span><span class="mtk6">40</span><span class="mtk1">);</span>  

<span class="mtk1">  </span><span class="mtk5">if</span><span class="mtk1"> (lpStartAddress </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">NULL</span><span class="mtk1">) {</span>
<span class="mtk1">    uVar1 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">;</span>
<span class="mtk1">  } </span><span class="mtk5">else</span><span class="mtk1"> {</span>
<span class="mtk1">    </span><span class="mtk8">memcpy</span><span class="mtk1">(lpStartAddress, </span><span class="mtk5">&amp;</span><span class="mtk1">DAT_140009020, (ulonglong) DAT_140009260);</span>

<span class="mtk1">    </span><span class="mtk5">for</span><span class="mtk1"> (local_10 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">; local_10 </span><span class="mtk5">&lt;</span><span class="mtk1"> DAT_140009260; local_10 </span><span class="mtk5">=</span><span class="mtk1"> local_10 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">) {</span>
<span class="mtk1">      lpStartAddress[local_10] </span><span class="mtk5">=</span><span class="mtk1"> (PTHREAD_START_ROUTINE) ((byte) lpStartAddress[lo</span><span class="mtk1">cal_10] </span><span class="mtk5">^</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">33</span><span class="mtk1">);</span>
<span class="mtk1">    }</span>

<span class="mtk1">    lpStartAddress[</span><span class="mtk5">0x</span><span class="mtk6">93</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> (PTHREAD_START_ROUTINE) </span><span class="mtk5">*</span><span class="mtk1">param_1;</span>
<span class="mtk1">    lpStartAddress[</span><span class="mtk5">0x</span><span class="mtk6">1da</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> (PTHREAD_START_ROUTINE) param_1[</span><span class="mtk6">1</span><span class="mtk1">];</span>
<span class="mtk1">    lpStartAddress[</span><span class="mtk5">0x</span><span class="mtk6">1e2</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> (PTHREAD_START_ROUTINE) (param_1[</span><span class="mtk6">4</span><span class="mtk1">] </span><span class="mtk5">-</span><span class="mtk1"> </span><span class="mtk6">2</span><span class="mtk1">);</span>
<span class="mtk1">    lpStartAddress[</span><span class="mtk5">0x</span><span class="mtk6">1e3</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> (PTHREAD_START_ROUTINE) (param_1[</span><span class="mtk6">2</span><span class="mtk1">] </span><span class="mtk5">-</span><span class="mtk1"> </span><span class="mtk6">3</span><span class="mtk1">);</span>
<span class="mtk1">    lpStartAddress[</span><span class="mtk5">0x</span><span class="mtk6">1e5</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> (PTHREAD_START_ROUTINE) param_1[</span><span class="mtk6">3</span><span class="mtk1">];</span>
<span class="mtk1">    uVar1 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">;</span>
<span class="mtk1">    pauVar2 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">NULL</span><span class="mtk1">;</span>
<span class="mtk1">    hHandle </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">CreateThread</span><span class="mtk1">(</span><span class="mtk6">NULL</span><span class="mtk1">, </span><span class="mtk6">0</span><span class="mtk1">, lpStartAddress, </span><span class="mtk6">NULL</span><span class="mtk1">, </span><span class="mtk6">0</span><span class="mtk1">, </span><span class="mtk6">NULL</span><span class="mtk1">);</span>

<span class="mtk1">    </span><span class="mtk5">if</span><span class="mtk1"> (hHandle </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">NULL</span><span class="mtk1">) {</span>
<span class="mtk1">      </span><span class="mtk8">do_print</span><span class="mtk1">(</span><span class="mtk4">"Failed to create a thread</span><span class="mtk6">\n</span><span class="mtk4">"</span><span class="mtk1">, pauVar2, lpStartAddress, uVar1);</span>
<span class="mtk1">      uVar1 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">;</span>
<span class="mtk1">    } </span><span class="mtk5">else</span><span class="mtk1"> {</span>
<span class="mtk1">      </span><span class="mtk8">WaitForSingleObject</span><span class="mtk1">(hHandle, </span><span class="mtk5">0x</span><span class="mtk6">ffffffff</span><span class="mtk1">);</span>
<span class="mtk1">      uVar1 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">;</span>
<span class="mtk1">    }</span>
<span class="mtk1">  }</span>

<span class="mtk1">  </span><span class="mtk5">return</span><span class="mtk1"> uVar1;</span>
<span class="mtk1">}</span>
</code></pre></div><p>Aquí vemos que se asigna una región de memoria dinámica con <code>VirtualAlloc</code>, luego se copian datos de <code>DAT_140009020</code> con <code>memcpy</code> y se descifra con XOR (clave <code>0x33</code>). A continuación, se toman 5 caracteres de <code>param_1</code> para ponerlos en el <em>buffer</em> descifrado. Por último, se crea un <em>thread</em> y se ejecuta sobre este <em>buffer</em>. Por tanto, de nuevo, se está ejecutando un <em>shellcode</em>.</p><p>De este <em>shellcode</em> necesitamos alterar los bytes <code>0x93</code>, <code>0x1da</code>, <code>0x1e2</code>, <code>0x1e3</code>, y <code>0x1e5</code>. Podemos descifrar el <em>shellcode</em> y luego desensamblarlo con <code>pwntools</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">python3</span> -q
&gt;&gt;&gt; from pwn import xor
&gt;&gt;&gt; ct_shellcode = b'\x64\x7b\xba\xd4\x7b\xb0\xd7\xc3\x7b\xb0\xdf\x13\xdb\x9c\x32\x33\x33\x7b\xba\xcf\x6c\xf0\x55\x1d\x3c\x2c\xb7\x33\x33\x33\x33\x33\x56\x7b\xb8\x37\x16\x53\x33\x33\x33\x7b\xb8\x73\x2b\x7f\xb8\x63\x13\x7e\xb6\xe1\x47\x56\x55\x1d\x3c\x2c\xb7\x33\x33\x33\x33\x33\x72\x3c\x84\x71\x7b\x7e\xb8\x71\x63\x77\xbe\x7b\xcc\x7a\xbe\x7b\x32\x02\xf3\x76\x3c\x84\xfa\x7a\x32\xfa\xd8\x2b\x3c\x2c\x73\x33\xb0\xdb\x13\x7a\xba\xfb\x7b\xab\x7b\x32\xe3\x7a\x0a\xfa\x47\x2f\x7b\xb0\xf2\x32\xba\xf1\x72\x3c\x85\x33\xf2\xf9\x3e\x0f\x53\x44\xec\x7b\x32\xe3\x7a\xba\xfb\x7a\x0a\xfa\x46\xd7\x0e\x68\x8f\x79\x59\x47\x3f\xf0\xb8\x21\x7e\xb6\xe1\x46\x96\x7f\xba\xe3\xf0\x7e\xb8\x61\x13\x7f\xba\xe3\xf0\xa3\xa3\xa3\xa3\xa3\xa3\xa3\xa3\xa3\x7b\xb6\xfa\x3c\xb7\x88\x33\x33\x33\x64\x7a\xba\xfa\x7a\xba\xe1\x65\x60\x7b\x50\x72\x0f\xb8\xb7\x32\xbb\x33\x33\x33\x7b\x32\xfb\xb8\x43\x2f\x7b\x32\xfd\xc4\xf1\x33\x33\xcc\xcc\x47\x59\xb8\x7b\x2b\xbe\x62\xcc\xb6\xfa\x47\x66\x77\xb8\x73\x13\x77\xb8\x6b\x17\x7e\x32\xfb\x7e\x32\xf8\x7a\xbe\x6f\xa3\x37\x3c\x2c\x77\x33\x33\x72\xb8\x33\x7f\xba\xe4\x7f\x32\xfb\x7b\x1a\xf4\xd8\x35\x55\xa3\x0b\xf9\x46\x7f\x7b\xba\xf1\x7b\xb0\xf3\x32\x3c\x85\x7f\x0b\xcc\x3c\x85\x21\xb7\xe1\x46\xda\x3c\x85\xe2\xc4\xe9\xb6\xe1\x47\x05\x7a\xb0\xf3\x37\x7a\xb0\xf0\x31\x7a\x0a\xeb\x46\xf0\x68\x02\xf3\x6d\x6c\xf0\x3c\x2c\x77\x33\x33\xb8\x73\x23\x77\x3c\x84\xe1\x68\x7a\x1a\xf1\x71\xb8\x37\xa5\x6d\x6c\x7b\x32\xfb\xf0\x3c\x2c\x33\x1a\xf9\xb6\xe1\x46\xf9\x72\x3c\x84\x30\x68\xb8\x37\xb5\x6d\x6c\x7f\x32\xfb\xf0\x02\xf3\xf0\xa3\xa3\xa3\xa3\xa3\xa3\xa3\xa3\xa3\x7a\xba\xfa\x7a\xba\xe3\x02\xf3\xd8\x3d\x55\x3c\x2c\x77\x33\x33\x7b\xb0\xf3\x32\x0b\xf9\x46\x2b\x72\x3c\x85\x27\x32\x72\x3c\x85\x3f\x33\xb7\xe1\x46\xd9\x3c\x85\xf2\xc4\xeb\xf0\x3c\x2c\x73\x33\x3c\x85\xf1\x1a\xfb\xf0\xa3\xa3\xa3\xa3\xa3\xa3\xa3\xa3\xa3\xa3\x7b\xb0\xdf\x7b\xdb\x64\xcd\xcc\xcc\x7b\xbe\x67\x17\x00\xf5\x77\x17\x0c\x33\x7b\xba\xf2\xf4\x77\x17\x08\xf0\x41\x4a\x72\x7b\x8b\x7f\x5c\xf0\xf0\x7f\xf0\x51\x41\x7b\xba\x77\x17\x00\xdb\x8d\xcd\xcc\xcc\xf4\x77\x17\x1c\x57\x5f\x5f\x33\x7b\xbe\x7f\x17\x14\x7b\x89\x51\x46\x41\x43\x56\x56\x40\x1d\x7b\xba\x67\x17\x14\xcc\xe3\x7b\xb0\xf7\x7b\xf0\xa3\xa3\xa3\xa3\xa3\xa3\xa3\xa3\xa3\xa3\xa3\xcc\xcc\xcc\xcc\xcc\xcc\xcc\xcc\x33\x33\x33\x33\x33\x33\x33\x33\xcc\xcc\xcc\xcc\xcc\xcc\xcc\xcc\x33\x33\x33\x33\x33\x33\x33\x00'  
&gt;&gt;&gt; shellcode = xor(ct_shellcode, 0x33)
&gt;&gt;&gt; shellcode
b"WH\x89\xe7H\x83\xe4\xf0H\x83\xec \xe8\xaf\x01\x00\x00H\x89\xfc_\xc3f.\x0f\x1f\x84\x00\x00\x00\x00\x00eH\x8b\x04%`\x00\x00\x00H\x8b@\x18L\x8bP M\x85\xd2tef.\x0f\x1f\x84\x00\x00\x00\x00\x00A\x0f\xb7BHM\x8bBPD\x8dH\xffI\x8dH\x011\xc0E\x0f\xb7\xc9I\x01\xc9\xeb\x18\x0f\x1f@\x00\x83\xe8 I\x89\xc8H\x98H\x01\xd0I9\xc9t\x1cH\x83\xc1\x01\x89\xc2A\x0f\xb6\x00\xc1\xca\r&lt;`w\xdfH\x01\xd0I\x89\xc8I9\xc9u\xe4=[\xbcJjt\x0c\xc3\x8b\x12M\x85\xd2u\xa5L\x89\xd0\xc3M\x8bR L\x89\xd0\xc3\x90\x90\x90\x90\x90\x90\x90\x90\x90H\x85\xc9\x0f\x84\xbb\x00\x00\x00WI\x89\xc9I\x89\xd2VSHcA&lt;\x8b\x84\x01\x88\x00\x00\x00H\x01\xc8\x8bp\x1cH\x01\xce\xf7\xc2\x00\x00\xff\xfftj\x8bH\x18\x8dQ\xff\x85\xc9tUD\x8b@ D\x8bX$M\x01\xc8M\x01\xcbI\x8d\\\x90\x04\x0f\x1fD\x00\x00A\x8b\x00L\x89\xd7L\x01\xc8H)\xc7\xeb\x06f\x908\xcauLH\x89\xc2H\x83\xc0\x01\x0f\xb6L8\xff\x0f\xb6\x12\x84\xd2u\xe9\x0f\xb6\xd1\xf7\xda\x85\xd2t6I\x83\xc0\x04I\x83\xc3\x02I9\xd8u\xc3[1\xc0^_\xc3\x0f\x1fD\x00\x00\x8b@\x10D\x0f\xb7\xd2[I)\xc2B\x8b\x04\x96^_H\x01\xc8\xc3\x0f\x1f\x00)\xca\x85\xd2u\xcaA\x0f\xb7\x03[\x8b\x04\x86^_L\x01\xc8\xc31\xc0\xc3\x90\x90\x90\x90\x90\x90\x90\x90\x90I\x89\xc9I\x89\xd01\xc0\xeb\x0ef\x0f\x1fD\x00\x00H\x83\xc0\x018\xcau\x18A\x0f\xb6\x14\x01A\x0f\xb6\x0c\x00\x84\xd2u\xea\x0f\xb6\xc1\xf7\xd8\xc3\x0f\x1f@\x00\x0f\xb6\xc2)\xc8\xc3\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90H\x83\xecH\xe8W\xfe\xff\xffH\x8dT$3\xc6D$?\x00H\x89\xc1\xc7D$;\xc3ryAH\xb8Lo\xc3\xc3L\xc3brH\x89D$3\xe8\xbe\xfe\xff\xff\xc7D$/dll\x00H\x8dL$'H\xbaburpees.H\x89T$'\xff\xd0H\x83\xc4H\xc3\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\xff\xff\xff\xff\xff\xff\xff\xff\x00\x00\x00\x00\x00\x00\x00\x00\xff\xff\xff\xff\xff\xff\xff\xff\x00\x00\x00\x00\x00\x00\x003"
&gt;&gt;&gt; shellcode.hex()
'574889e74883e4f04883ec20e8af0100004889fc5fc3662e0f1f84000000000065488b042560000000488b40184c8b50204d85d27465662e0f1f840000000000410fb742484d8b4250448d48ff498d480131c0450fb7c94901c9eb180f1f400083e8204989c848984801d04939c9741c4883c10189c2410fb600c1ca0d3c6077df4801d04989c84939c975e43d5bbc4a6a740cc38b124d85d275a54c89d0c34d8b52204c89d0c39090909090909090904885c90f84bb000000574989c94989d256534863413c8b8401880000004801c88b701c4801cef7c20000ffff746a8b48188d51ff85c97455448b4020448b58244d01c84d01cb498d5c90040f1f440000418b004c89d74c01c84829c7eb06669038ca754c4889c24883c0010fb64c38ff0fb61284d275e90fb6d1f7da85d274364983c0044983c3024939d875c35b31c05e5fc30f1f4400008b4010440fb7d25b4929c2428b04965e5f4801c8c30f1f0029ca85d275ca410fb7035b8b04865e5f4c01c8c331c0c39090909090909090904989c94989d031c0eb0e660f1f4400004883c00138ca7518410fb61401410fb60c0084d275ea0fb6c1f7d8c30f1f40000fb6c229c8c3909090909090909090904883ec48e857feffff488d542433c644243f004889c1c744243bc372794148b84c6fc3c34cc362724889442433e8befeffffc744242f646c6c00488d4c242748ba627572706565732e4889542427ffd04883c448c39090909090909090909090ffffffffffffffff0000000000000000ffffffffffffffff0000000000000033'
</code></pre></div><p>Si nos fijamos en las <em>strings</em> del <em>shellcode</em>, aparece por un lado <code>burpees</code> y por otro <code>dll</code>. Al depurar en x64dbg, sí que se ve claramente la <em>string</em> <code>burpees.dll</code> intentando cargarse. Por tanto, sabemos que el nombre de la DLL descifrada debe ser <code>burpees.dll</code> (esta es la segunda subparte de la segunda parte de <code>input_string</code>).</p><p>Por otro lado, este es un extracto el desensamblado del <em>shellcode</em>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">pwn</span> disasm $shellcode
   0:    57                       <span class="code-dark-green">push</span>   <span class="code-dark-red">edi</span>
   1:    48                       <span class="code-dark-green">dec</span>    <span class="code-dark-red">eax</span>
   2:    89 e7                    <span class="code-dark-green">mov</span>    <span class="code-dark-red">edi</span>,  <span class="code-dark-red">esp</span>
   4:    48                       <span class="code-dark-green">dec</span>    <span class="code-dark-red">eax</span>
   5:    83 e4 f0                 <span class="code-dark-green">and</span>    <span class="code-dark-red">esp</span>,  <span class="code-dark-blue">0xfffffff0</span>
   8:    48                       <span class="code-dark-green">dec</span>    <span class="code-dark-red">eax</span>
   ...
  81:    48                       <span class="code-dark-green">dec</span>    <span class="code-dark-red">eax</span>
  82:    01 d0                    <span class="code-dark-green">add</span>    <span class="code-dark-red">eax</span>,  <span class="code-dark-red">edx</span>
  84:    49                       <span class="code-dark-green">dec</span>    <span class="code-dark-red">ecx</span>
  85:    89 c8                    <span class="code-dark-green">mov</span>    <span class="code-dark-red">eax</span>,  <span class="code-dark-red">ecx</span>
  87:    49                       <span class="code-dark-green">dec</span>    <span class="code-dark-red">ecx</span>
  88:    39 c9                    <span class="code-dark-green">cmp</span>    <span class="code-dark-red">ecx</span>,  <span class="code-dark-red">ecx</span>
  8a:    75 e4                    <span class="code-dark-green">jne</span>    <span class="code-dark-blue">0x70</span>
  8c:    3d 5b bc 4a 6a           <span class="code-dark-green">cmp</span>    <span class="code-dark-red">eax</span>,  <span class="code-dark-blue">0x6a4abc5b</span>
  91:    74 0c                    <span class="code-dark-green">je</span>     <span class="code-dark-blue">0x9f</span>
  93:    c3                       <span class="code-dark-green">ret</span>
  94:    8b 12                    <span class="code-dark-green">mov</span>    <span class="code-dark-red">edx</span>,  DWORD PTR [<span class="code-dark-red">edx</span>]
  96:    4d                       <span class="code-dark-green">dec</span>    <span class="code-dark-red">ebp</span>
  97:    85 d2                    <span class="code-dark-green">test</span>   <span class="code-dark-red">edx</span>,  <span class="code-dark-red">edx</span>
  99:    75 a5                    <span class="code-dark-green">jne</span>    <span class="code-dark-blue">0x40</span>
  ...
 1d3:    48                       <span class="code-dark-green">dec</span>    <span class="code-dark-red">eax</span>
 1d4:    89 c1                    <span class="code-dark-green">mov</span>    <span class="code-dark-red">ecx</span>,  <span class="code-dark-red">eax</span>
 1d6:    c7 44 24 3b c3 72 79 41          <span class="code-dark-green">mov</span>    DWORD PTR [<span class="code-dark-red">esp</span>+<span class="code-dark-blue">0x3b</span>],  <span class="code-dark-blue">0x417972c3</span>  
 1de:    48                       <span class="code-dark-green">dec</span>    <span class="code-dark-red">eax</span>
 1df:    b8 4c 6f c3 c3           <span class="code-dark-green">mov</span>    <span class="code-dark-red">eax</span>,  <span class="code-dark-blue">0xc3c36f4c</span>
 1e4:    4c                       <span class="code-dark-green">dec</span>    <span class="code-dark-red">esp</span>
 1e5:    c3                       <span class="code-dark-green">ret</span>
 1e6:    62 72 48                 <span class="code-dark-green">bound</span>  <span class="code-dark-red">esi</span>,  <span class="code-dark-red">QWORD</span> PTR [<span class="code-dark-red">edx</span>+<span class="code-dark-blue">0x48</span>]
 1e9:    89 44 24 33              <span class="code-dark-green">mov</span>    DWORD PTR [<span class="code-dark-red">esp</span>+<span class="code-dark-blue">0x33</span>],  <span class="code-dark-red">eax</span>
 1ed:    e8 be fe ff ff           <span class="code-dark-green">call</span>   <span class="code-dark-blue">0xb0</span>
 1f2:    c7 44 24 2f 64 6c 6c <span class="code-dark-red">00</span>          <span class="code-dark-green">mov</span>    DWORD PTR [<span class="code-dark-red">esp</span>+<span class="code-dark-blue">0x2f</span>],  <span class="code-dark-blue">0x6c6c64</span>
 1fa:    48                       <span class="code-dark-green">dec</span>    <span class="code-dark-red">eax</span>
 1fb:    8d 4c 24 27              <span class="code-dark-green">lea</span>    <span class="code-dark-red">ecx</span>,  [<span class="code-dark-red">esp</span>+<span class="code-dark-blue">0x27</span>]
 1ff:    48                       <span class="code-dark-green">dec</span>    <span class="code-dark-red">eax</span>
 200:    ba 62 75 72 70           <span class="code-dark-green">mov</span>    <span class="code-dark-red">edx</span>,  <span class="code-dark-blue">0x70727562</span>
 205:    65 65 73 2e              <span class="code-dark-green">gs</span> <span class="code-dark-red">gs</span> <span class="code-dark-red">jae</span> <span class="code-dark-blue">0x237</span>
 209:    48                       <span class="code-dark-green">dec</span>    <span class="code-dark-red">eax</span>
 20a:    89 54 24 27              <span class="code-dark-green">mov</span>    DWORD PTR [<span class="code-dark-red">esp</span>+<span class="code-dark-blue">0x27</span>],  <span class="code-dark-red">edx</span>
 20e:    ff d0                    <span class="code-dark-green">call</span>   <span class="code-dark-red">eax</span>
 ...
</code></pre></div><p>Esta fue una parte un poco <em>guessy</em> en cierto sentido. El tema es que tenemos que modificar 5 bytes de este <em>shellcode</em>. Por un lado, hay algunos dígitos hexadecimales que, como antes, son caracteres ASCII imprimibles:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">python3</span> -q
&gt;&gt;&gt; from pwn import p8, p16, p32, p64  
&gt;&gt;&gt; p32(0x417972c3)
b'\xc3ryA'
&gt;&gt;&gt; p32(0xc3c36f4c)
b'Lo\xc3\xc3'
&gt;&gt;&gt; p32(0x6c6c64)
b'dll\x00'
&gt;&gt;&gt; p32(0x70727562)
b'burp'
&gt;&gt;&gt; bytes.fromhex('65 65 73 2e')
b'ees.'
</code></pre></div><p>Vemos tres caracteres <code>\xc3</code> que estan en posiciones de las que tenemos que modificar. Y parece claro que la <em>string</em> que tienen que formar es <code>LoadLibraryA</code> (como la que se ejecutaba antes). Entonces, podemos ver que:</p><ul><li>En <code>0x1da</code> tiene que ir <code>a</code>. Por tanto, <code>param_1[1] = 'a'</code>.</li><li>En <code>0x1e2</code> tiene que ir <code>a</code>. Por tanto, <code>param_1[4] = 'a' + 2 = 'c'</code>.</li><li>En <code>0x1e3</code> tiene que ir <code>d</code>. Por tanto, <code>param_1[2] = 'd' + 3 = 'g'</code>.</li></ul><p>Con esto, solo nos queda parchear las intrucciones <code>ret</code> que aparecen en <code>0x93</code> y <code>0x1e5</code>. Y lo que tenemos de momento es que la tercera parte de <code>input_string</code> es algo como <code>?ag?c</code>, nos falta averiguar las interrogaciones.</p><p>Aquí, lo que pensé fue en poner instrucciones de ensamblador que fueran de un solo byte y que no modificaran mucho el programa en sí. Vemos algunos ejemplos en el propio <em>shellcode</em> (como <code>48</code>, que es <code>dec eax</code>; <code>49</code>, que es <code>dec ecx</code>; <code>4c</code>, que es <code>dec esp</code>&mldr;).</p><p>Después de un rato probando, llegué a la conclusión de que la tercera parte debía de ser una palabra, y se me ocurrió usar <code>49</code> (<code>dec ecx</code>) como instrucción para <code>0x1e5</code>. Y así tenía <code>?agIc</code> como tercera parte de <code>input_string</code>. Y aquí me imaginé que la palabra clave sería <code>Magic</code>, que al final son instrucciones que no afectan mucho al <em>shellcode</em>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">pwn</span> disasm 4d
   0:    4d                       <span class="code-dark-green">dec</span>    <span class="code-dark-red">ebp</span>  

<span class="code-cyan">$</span> <span class="code-dark-green">pwn</span> disasm 69
   0:    69                       <span class="code-dark-cyan">.byte</span> <span class="code-dark-blue">0x69</span>
</code></pre></div><h2 id="análisis-de-burpeesdll">Análisis de <code>burpees.dll</code></h2><p>Bueno, entonces el <em>shellcode</em> anterior se ejecuta y carga la librería <code>burpees.dll</code>, como habíamos deducido. En este punto, se abre una ventana con un teclado numérico para poner un PIN.</p><p>Si miramos el código descompilado en Ghidra, veremos una función <code>WinMain</code>:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk7 mtki">int</span><span class="mtk1"> __stdcall </span><span class="mtk8">WinMain</span><span class="mtk1">(HINSTANCE </span><span class="mtk9 mtki">hInstance</span><span class="mtk1">, HINSTANCE </span><span class="mtk9 mtki">hPrevInstance</span><span class="mtk1">, LPSTR </span><span class="mtk9 mtki">lpCmdLine</span><span class="mtk1">, </span><span class="mtk7 mtki">int</span><span class="mtk1"> </span><span class="mtk9 mtki">nShowCmd</span><span class="mtk1">) {</span>
<span class="mtk1">  </span><span class="mtk3">// ...</span>
<span class="mtk1">  </span>
<span class="mtk1">                    </span><span class="mtk3">// 0x1d87  1  WinMain</span>
<span class="mtk1">  local_24 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">2073656570727542</span><span class="mtk1">;</span>
<span class="mtk1">  local_1c </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">4c4c44</span><span class="mtk1">;</span>
<span class="mtk1">  local_78._0_4_ </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">;</span>
<span class="mtk1">  local_78._4_4_ </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">;</span>
<span class="mtk1">  local_68._0_4_ </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">;</span>
<span class="mtk1">  local_68._4_4_ </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">;</span>
<span class="mtk1">  local_58 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">NULL</span><span class="mtk1">;</span>
<span class="mtk1">  local_50 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">NULL</span><span class="mtk1">;</span>
<span class="mtk1">  local_40 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">NULL</span><span class="mtk1">;</span>
<span class="mtk1">  local_70 </span><span class="mtk5">=</span><span class="mtk1"> (WNDPROC) </span><span class="mtk5">&amp;</span><span class="mtk1">WindowProc;</span>
<span class="mtk1">  local_38 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">&amp;</span><span class="mtk1">local_24;</span>
<span class="mtk1">  local_48 </span><span class="mtk5">=</span><span class="mtk1"> (HBRUSH)</span><span class="mtk5">0x</span><span class="mtk6">6</span><span class="mtk1">;</span>
<span class="mtk1">  local_60 </span><span class="mtk5">=</span><span class="mtk1"> hInstance;</span>
<span class="mtk1">  </span><span class="mtk8">RegisterClassA</span><span class="mtk1">((WNDCLASSA </span><span class="mtk5">*</span><span class="mtk1">) local_78);</span>
<span class="mtk1">  local_18 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">CreateWindowExA</span><span class="mtk1">(</span><span class="mtk6">0</span><span class="mtk1">, (LPCSTR) </span><span class="mtk5">&amp;</span><span class="mtk1">local_24, </span><span class="mtk4">"Es como foook, solo hazlos"</span><span class="mtk1">, </span><span class="mtk5">0x</span><span class="mtk6">cf0000</span><span class="mtk1">, </span><span class="mtk5">-0x</span><span class="mtk6">80000000</span><span class="mtk1">, </span><span class="mtk5">-0x</span><span class="mtk6">80000000</span><span class="mtk1">, </span><span class="mtk5">0x</span><span class="mtk6">14f</span><span class="mtk1">, </span><span class="mtk6">400</span><span class="mtk1">, </span><span class="mtk6">NULL</span><span class="mtk1">, </span><span class="mtk6">NULL</span><span class="mtk1">, hInstance, </span><span class="mtk6">NULL</span><span class="mtk1">);</span>

<span class="mtk1">  </span><span class="mtk5">if</span><span class="mtk1"> (local_18 </span><span class="mtk5">!=</span><span class="mtk1"> </span><span class="mtk6">NULL</span><span class="mtk1">) {</span>
<span class="mtk1">    local_c8[</span><span class="mtk6">0</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">82</span><span class="mtk1">;</span>
<span class="mtk1">    local_c8[</span><span class="mtk6">1</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">113</span><span class="mtk1">;</span>
<span class="mtk1">    local_c8[</span><span class="mtk6">2</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">3c</span><span class="mtk1">;</span>
<span class="mtk1">    local_c8[</span><span class="mtk6">3</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">e1</span><span class="mtk1">;</span>
<span class="mtk1">    local_b8 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">82</span><span class="mtk1">;</span>
<span class="mtk1">    local_b4 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">e1</span><span class="mtk1">;</span>
<span class="mtk1">    local_b0 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">200</span><span class="mtk1">;</span>
<span class="mtk1">    local_ac </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">e1</span><span class="mtk1">;</span>
<span class="mtk1">    local_a8 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">3c</span><span class="mtk1">;</span>
<span class="mtk1">    local_a4 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">af</span><span class="mtk1">;</span>
<span class="mtk1">    local_a0 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">82</span><span class="mtk1">;</span>
<span class="mtk1">    local_9c </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">af</span><span class="mtk1">;</span>
<span class="mtk1">    local_98 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">200</span><span class="mtk1">;</span>
<span class="mtk1">    local_94 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">af</span><span class="mtk1">;</span>
<span class="mtk1">    local_90 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">3c</span><span class="mtk1">;</span>
<span class="mtk1">    local_8c </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">7d</span><span class="mtk1">;</span>
<span class="mtk1">    local_88 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">82</span><span class="mtk1">;</span>
<span class="mtk1">    local_84 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">7d</span><span class="mtk1">;</span>
<span class="mtk1">    local_80 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">200</span><span class="mtk1">;</span>
<span class="mtk1">    local_7c </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">7d</span><span class="mtk1">;</span>

<span class="mtk1">    </span><span class="mtk5">for</span><span class="mtk1"> (local_c </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">; local_c </span><span class="mtk5">&lt;</span><span class="mtk1"> </span><span class="mtk6">10</span><span class="mtk1">; local_c </span><span class="mtk5">=</span><span class="mtk1"> local_c </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">) {</span>
<span class="mtk1">      local_fa </span><span class="mtk5">=</span><span class="mtk1"> (</span><span class="mtk7 mtki">char</span><span class="mtk1">)l ocal_c </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk4">'0'</span><span class="mtk1">;</span>
<span class="mtk1">      local_f9 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">;</span>
<span class="mtk1">      </span><span class="mtk8">CreateWindowExA</span><span class="mtk1">(</span><span class="mtk6">0</span><span class="mtk1">, </span><span class="mtk4">"BUTTON"</span><span class="mtk1">, </span><span class="mtk5">&amp;</span><span class="mtk1">local_fa, </span><span class="mtk5">0x</span><span class="mtk6">50010001</span><span class="mtk1">, local_c8[(longlong) local_c </span><span class="mtk5">*</span><span class="mtk1"> </span><span class="mtk6">2</span><span class="mtk1">], local_c8[(longlong) local_c </span><span class="mtk5">*</span><span class="mtk1"> </span><span class="mtk6">2</span><span class="mtk1"> </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">], </span><span class="mtk5">0x</span><span class="mtk6">3c</span><span class="mtk1">, </span><span class="mtk5">0x</span><span class="mtk6">28</span><span class="mtk1">, local_18, (HMENU) (longlong) (local_c </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">1000</span><span class="mtk1">), </span><span class="mtk6">NULL</span><span class="mtk1">, </span><span class="mtk6">NULL</span><span class="mtk1">);</span>  
<span class="mtk1">    }</span>

<span class="mtk1">    </span><span class="mtk8">ShowWindow</span><span class="mtk1">(local_18, nShowCmd);</span>
<span class="mtk1">    local_f8._0_8_ </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">NULL</span><span class="mtk1">;</span>
<span class="mtk1">    local_f8._8_4_ </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">;</span>
<span class="mtk1">    local_f8._12_4_ </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">;</span>
<span class="mtk1">    local_e8 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">;</span>
<span class="mtk1">    local_e0 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">;</span>
<span class="mtk1">    local_d8._0_4_ </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">;</span>
<span class="mtk1">    local_d8._4_4_ </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">;</span>
<span class="mtk1">    local_d0.x </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">;</span>
<span class="mtk1">    local_d0.y </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">;</span>

<span class="mtk1">    </span><span class="mtk5">while</span><span class="mtk1"> (BVar1 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">GetMessageA</span><span class="mtk1">((LPMSG) local_f8, </span><span class="mtk6">NULL</span><span class="mtk1">, </span><span class="mtk6">0</span><span class="mtk1">, </span><span class="mtk6">0</span><span class="mtk1">), BVar1 </span><span class="mtk5">!=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">) {</span>
<span class="mtk1">      </span><span class="mtk8">TranslateMessage</span><span class="mtk1">((MSG </span><span class="mtk5">*</span><span class="mtk1">) local_f8);</span>
<span class="mtk1">      </span><span class="mtk8">DispatchMessageA</span><span class="mtk1">((MSG </span><span class="mtk5">*</span><span class="mtk1">) local_f8);</span>
<span class="mtk1">    }</span>
<span class="mtk1">  }</span>

<span class="mtk1">  </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">;</span>
<span class="mtk1">}</span>
</code></pre></div><p>Y la función que gestiona la ventana es <code>WindowProc</code>:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk8 mtku">LRESULT</span><span class="mtk1"> </span><span class="mtk8">UndefinedFunction_2c5ac2455</span><span class="mtk1">(</span><span class="mtk8 mtku">HWND</span><span class="mtk1"> </span><span class="mtk9 mtki">param_1</span><span class="mtk1">, </span><span class="mtk7 mtki">uint</span><span class="mtk1"> </span><span class="mtk9 mtki">param_2</span><span class="mtk1">, </span><span class="mtk8 mtku">WPARAM</span><span class="mtk1"> </span><span class="mtk9 mtki">param_3</span><span class="mtk1">, </span><span class="mtk8 mtku">LPARAM</span><span class="mtk1"> </span><span class="mtk9 mtki">param_4</span><span class="mtk1">) {</span>
<span class="mtk1">  undefined8 uVar1;</span>
<span class="mtk1">  undefined8 uVar2;</span>
<span class="mtk1">  </span><span class="mtk7 mtki">int</span><span class="mtk1"> iVar3;</span>
<span class="mtk1">  longlong lVar4;</span>
<span class="mtk1">  tm </span><span class="mtk5">*</span><span class="mtk1">ptVar5;</span>
<span class="mtk1">  LRESULT LVar6;</span>
<span class="mtk1">  </span><span class="mtk7 mtki">uint</span><span class="mtk1"> uStack_5c;</span>
<span class="mtk1">  </span><span class="mtk7 mtki">int</span><span class="mtk1"> iStack_58;</span>
<span class="mtk1">  </span><span class="mtk7 mtki">int</span><span class="mtk1"> iStack_54;</span>
<span class="mtk1">  </span><span class="mtk7 mtki">char</span><span class="mtk1"> acStack_41 [</span><span class="mtk6">9</span><span class="mtk1">];</span>
<span class="mtk1">  </span><span class="mtk7 mtki">time_t</span><span class="mtk1"> tStack_38;</span>
<span class="mtk1">  </span><span class="mtk7 mtki">int</span><span class="mtk1"> iStack_2c;</span>
<span class="mtk1">  </span><span class="mtk7 mtki">uint</span><span class="mtk1"> uStack_28;</span>
<span class="mtk1">  </span><span class="mtk7 mtki">uint</span><span class="mtk1"> uStack_24;</span>
<span class="mtk1">  </span><span class="mtk7 mtki">int</span><span class="mtk1"> iStack_20;</span>
<span class="mtk1">  </span><span class="mtk7 mtki">uint</span><span class="mtk1"> uStack_1c;</span>
<span class="mtk1">  </span>
<span class="mtk1">  </span><span class="mtk5">if</span><span class="mtk1"> (param_2 </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">111</span><span class="mtk1">) {</span>
<span class="mtk1">    </span><span class="mtk5">if</span><span class="mtk1"> (((commandCount </span><span class="mtk5">&lt;</span><span class="mtk1"> </span><span class="mtk6">8</span><span class="mtk1">) </span><span class="mtk5">&amp;&amp;</span><span class="mtk1"> (uStack_1c </span><span class="mtk5">=</span><span class="mtk1"> (</span><span class="mtk7 mtki">uint</span><span class="mtk1">) param_3 </span><span class="mtk5">&amp;</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">ffff</span><span class="mtk1">, </span><span class="mtk6">999</span><span class="mtk1"> </span><span class="mtk5">&lt;</span><span class="mtk1"> uStack_1c)) </span><span class="mtk5">&amp;&amp;</span><span class="mtk1"> (uStack_1c </span><span class="mtk5">&lt;</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">3f2</span><span class="mtk1">)) {</span>
<span class="mtk1">      iStack_20 </span><span class="mtk5">=</span><span class="mtk1"> uStack_1c </span><span class="mtk5">-</span><span class="mtk1"> </span><span class="mtk6">1000</span><span class="mtk1">;</span>
<span class="mtk1">      lVar4 </span><span class="mtk5">=</span><span class="mtk1"> (longlong)commandCount;</span>
<span class="mtk1">      commandCount </span><span class="mtk5">=</span><span class="mtk1"> commandCount </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">;</span>
<span class="mtk1">      (</span><span class="mtk5">&amp;</span><span class="mtk1">pin)[lVar4] </span><span class="mtk5">=</span><span class="mtk1"> (</span><span class="mtk7 mtki">char</span><span class="mtk1">) iStack_20 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk4">'0'</span><span class="mtk1">;</span>
<span class="mtk1">      (</span><span class="mtk5">&amp;</span><span class="mtk1">pin)[commandCount] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">;</span>
<span class="mtk1">    }</span>

<span class="mtk1">    </span><span class="mtk5">if</span><span class="mtk1"> (commandCount </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">8</span><span class="mtk1">) {</span>
<span class="mtk1">      tStack_38 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">time</span><span class="mtk1">(</span><span class="mtk6">NULL</span><span class="mtk1">);</span>
<span class="mtk1">      ptVar5 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">localtime</span><span class="mtk1">(</span><span class="mtk5">&amp;</span><span class="mtk1">tStack_38);</span>
<span class="mtk1">      uVar1._0_4_ </span><span class="mtk5">=</span><span class="mtk1"> ptVar5-&gt;tm_hour;</span>
<span class="mtk1">      uVar1._4_4_ </span><span class="mtk5">=</span><span class="mtk1"> ptVar5-&gt;tm_mday;</span>
<span class="mtk1">      uVar2._0_4_ </span><span class="mtk5">=</span><span class="mtk1"> ptVar5-&gt;tm_mon;</span>
<span class="mtk1">      uVar2._4_4_ </span><span class="mtk5">=</span><span class="mtk1"> ptVar5-&gt;tm_year;</span>
<span class="mtk1">      uStack_5c </span><span class="mtk5">=</span><span class="mtk1"> (</span><span class="mtk7 mtki">uint</span><span class="mtk1">) ((ulonglong) uVar1 </span><span class="mtk5">&gt;&gt;</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">20</span><span class="mtk1">);</span>
<span class="mtk1">      uStack_24 </span><span class="mtk5">=</span><span class="mtk1"> uStack_5c;</span>
<span class="mtk1">      iStack_58 </span><span class="mtk5">=</span><span class="mtk1"> (</span><span class="mtk7 mtki">int</span><span class="mtk1">) uVar2;</span>
<span class="mtk1">      uStack_28 </span><span class="mtk5">=</span><span class="mtk1"> iStack_58 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">;</span>
<span class="mtk1">      iStack_54 </span><span class="mtk5">=</span><span class="mtk1"> (</span><span class="mtk7 mtki">int</span><span class="mtk1">) ((ulonglong) uVar2 </span><span class="mtk5">&gt;&gt;</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">20</span><span class="mtk1">);</span>
<span class="mtk1">      iStack_2c </span><span class="mtk5">=</span><span class="mtk1"> iStack_54 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">76c</span><span class="mtk1">;</span>

<span class="mtk1">      </span><span class="mtk8">sprintf</span><span class="mtk1">(acStack_41, </span><span class="mtk4">"</span><span class="mtk6">%02d%02d%04d</span><span class="mtk4">"</span><span class="mtk1">, (ulonglong) uStack_5c, (ulonglong) uStack_28, iS</span><span class="mtk1">tack_2c);</span>
<span class="mtk1">      iVar3 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">strcmp</span><span class="mtk1">(</span><span class="mtk5">&amp;</span><span class="mtk1">pin, acStack_41);</span>

<span class="mtk1">      </span><span class="mtk5">if</span><span class="mtk1"> (iVar3 </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">) {</span>
<span class="mtk1">        </span><span class="mtk8">generateKeys</span><span class="mtk1">();</span>
<span class="mtk1">        </span><span class="mtk8">PostQuitMessage</span><span class="mtk1">(</span><span class="mtk6">0</span><span class="mtk1">);</span>

<span class="mtk1">        </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">;</span>
<span class="mtk1">      }</span>

<span class="mtk1">      </span><span class="mtk8">PostQuitMessage</span><span class="mtk1">(</span><span class="mtk6">0</span><span class="mtk1">);</span>

<span class="mtk1">      </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">;</span>
<span class="mtk1">    }</span>
<span class="mtk1">  } </span><span class="mtk5">else</span><span class="mtk1"> </span><span class="mtk5">if</span><span class="mtk1"> (param_2 </span><span class="mtk5">&lt;</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">112</span><span class="mtk1">) {</span>
<span class="mtk1">    </span><span class="mtk5">if</span><span class="mtk1"> (param_2 </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">) {</span>
<span class="mtk1">      </span><span class="mtk8">CreateWindowExA</span><span class="mtk1">(</span><span class="mtk6">0</span><span class="mtk1">, </span><span class="mtk4">"STATIC"</span><span class="mtk1">, </span><span class="mtk4">"Hoy hay gente saliendo de fiesta</span><span class="mtk6">\n</span><span class="mtk4"> y tu aqui... jugando un CTF...</span><span class="mtk6">\n</span><span class="mtk4"> Recuerda levantarte cada 30m para hacerte unos bu</span><span class="mtk4">rpees"</span><span class="mtk1">, </span><span class="mtk5">0x</span><span class="mtk6">50000001</span><span class="mtk1">, </span><span class="mtk6">10</span><span class="mtk1">, </span><span class="mtk5">0x</span><span class="mtk6">14</span><span class="mtk1">, </span><span class="mtk6">300</span><span class="mtk1">, </span><span class="mtk5">0x</span><span class="mtk6">4b</span><span class="mtk1">, param_1, </span><span class="mtk6">NULL</span><span class="mtk1">, </span><span class="mtk6">NULL</span><span class="mtk1">, </span><span class="mtk6">NULL</span><span class="mtk1">);</span>  
<span class="mtk1">    } </span><span class="mtk5">else</span><span class="mtk1"> {</span>
<span class="mtk1">      </span><span class="mtk5">if</span><span class="mtk1"> (param_2 </span><span class="mtk5">!=</span><span class="mtk1"> </span><span class="mtk6">2</span><span class="mtk1">) </span><span class="mtk5">goto</span><span class="mtk1"> LAB_2c5ac264f;</span>

<span class="mtk1">      </span><span class="mtk8">PostQuitMessage</span><span class="mtk1">(</span><span class="mtk6">0</span><span class="mtk1">);</span>
<span class="mtk1">    }</span>

<span class="mtk1">    </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">;</span>
<span class="mtk1">  }</span>

<span class="mtk1">LAB_2c5ac264f:</span>
<span class="mtk1">  LVar6 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">DefWindowProcA</span><span class="mtk1">(param_1,param_2,param_3,param_4);</span>

<span class="mtk1">  </span><span class="mtk5">return</span><span class="mtk1"> LVar6;</span>
<span class="mtk1">}</span>
</code></pre></div><p>Aquí vemos que el PIN es de 8 dígitos (<code>%02d%02d%04d</code>) y que se compara con <code>pin</code>, pero no está inicializado. Aún así, podemos poner un breakpoint en <code>strcmp</code> mediante x64dbg y mirarlo en el depurador:</p><p><img alt="PICtureThis 1" src="/images/other/HackOn%20CTF/PICtureThis-1.webp"></p><p>Aquí vemos claramente que el PIN es <code>18022024</code> (es la fecha actual en formato <code>ddmmyyyy</code>).</p><p>Vale, cuando ponemos el PIN correctamente, se ejecuta la función <code>generateKeys</code>:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk7 mtki">void</span><span class="mtk1"> </span><span class="mtk8">generateKeys</span><span class="mtk1">() {</span>
<span class="mtk1">  undefined local_118;</span>
<span class="mtk1">  </span><span class="mtk7 mtki">char</span><span class="mtk1"> local_117;</span>
<span class="mtk1">  undefined local_116;</span>
<span class="mtk1">  </span><span class="mtk7 mtki">char</span><span class="mtk1"> local_115;</span>
<span class="mtk1">  </span><span class="mtk7 mtki">char</span><span class="mtk1"> local_114;</span>
<span class="mtk1">  </span><span class="mtk7 mtki">char</span><span class="mtk1"> local_113;</span>
<span class="mtk1">  undefined local_112;</span>
<span class="mtk1">  </span><span class="mtk7 mtki">char</span><span class="mtk1"> local_111;</span>
<span class="mtk1">  </span><span class="mtk7 mtki">char</span><span class="mtk1"> local_110;</span>
<span class="mtk1">  undefined local_10f;</span>
<span class="mtk1">  undefined local_10e;</span>
<span class="mtk1">  </span><span class="mtk7 mtki">char</span><span class="mtk1"> local_10d;</span>
<span class="mtk1">  </span><span class="mtk7 mtki">char</span><span class="mtk1"> local_10c;</span>
<span class="mtk1">  </span><span class="mtk7 mtki">char</span><span class="mtk1"> local_10b;</span>
<span class="mtk1">  undefined local_10a;</span>
<span class="mtk1">  undefined local_109;</span>
<span class="mtk1">  undefined local_108;</span>
<span class="mtk1">  </span><span class="mtk7 mtki">int</span><span class="mtk1"> local_f8 [</span><span class="mtk6">32</span><span class="mtk1">];</span>
<span class="mtk1">  undefined8 local_78;</span>
<span class="mtk1">  undefined8 local_70;</span>
<span class="mtk1">  undefined8 local_68;</span>
<span class="mtk1">  undefined8 local_60;</span>
<span class="mtk1">  undefined8 local_58;</span>
<span class="mtk1">  undefined8 local_50;</span>
<span class="mtk1">  undefined8 local_48;</span>
<span class="mtk1">  undefined4 local_40;</span>
<span class="mtk1">  undefined2 local_3c;</span>
<span class="mtk1">  </span><span class="mtk7 mtki">void</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">local_30;</span>
<span class="mtk1">  LPVOID local_28;</span>
<span class="mtk1">  LPVOID local_20;</span>
<span class="mtk1">  HANDLE local_18;</span>
<span class="mtk1">  ulonglong local_10;</span>
<span class="mtk1">  </span>
<span class="mtk1">  local_18 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">OpenFileMappingA</span><span class="mtk1">(</span><span class="mtk6">4</span><span class="mtk1">, </span><span class="mtk6">0</span><span class="mtk1">, </span><span class="mtk4">"SharedMemory"</span><span class="mtk1">);</span>

<span class="mtk1">  </span><span class="mtk5">if</span><span class="mtk1"> (local_18 </span><span class="mtk5">!=</span><span class="mtk1"> </span><span class="mtk6">NULL</span><span class="mtk1">) {</span>
<span class="mtk1">    local_28 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">MapViewOfFile</span><span class="mtk1">(local_18, </span><span class="mtk6">4</span><span class="mtk1">, </span><span class="mtk6">0</span><span class="mtk1">, </span><span class="mtk6">0</span><span class="mtk1">, </span><span class="mtk5">0x</span><span class="mtk6">1000</span><span class="mtk1">);</span>
<span class="mtk1">    local_20 </span><span class="mtk5">=</span><span class="mtk1"> local_28;</span>

<span class="mtk1">    </span><span class="mtk5">if</span><span class="mtk1"> (local_28 </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">NULL</span><span class="mtk1">) {</span>
<span class="mtk1">      </span><span class="mtk8">CloseHandle</span><span class="mtk1">(local_18);</span>
<span class="mtk1">    } </span><span class="mtk5">else</span><span class="mtk1"> {</span>
<span class="mtk1">      local_78 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">6867666564636261</span><span class="mtk1">;</span>
<span class="mtk1">      local_70 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">706f6e6d6c6b6a69</span><span class="mtk1">;</span>
<span class="mtk1">      local_68 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">7877767574737271</span><span class="mtk1">;</span>
<span class="mtk1">      local_60 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">4645444342417a79</span><span class="mtk1">;</span>
<span class="mtk1">      local_58 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">4e4d4c4b4a494847</span><span class="mtk1">;</span>
<span class="mtk1">      local_50 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">565554535251504f</span><span class="mtk1">;</span>
<span class="mtk1">      local_48 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">333231305a595857</span><span class="mtk1">;</span>
<span class="mtk1">      local_40 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">37363534</span><span class="mtk1">;</span>
<span class="mtk1">      local_3c </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">38</span><span class="mtk1">;</span>
<span class="mtk1">      local_f8[</span><span class="mtk6">0</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">13</span><span class="mtk1">;</span>
<span class="mtk1">      local_f8[</span><span class="mtk6">1</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">7</span><span class="mtk1">;</span>
<span class="mtk1">      local_f8[</span><span class="mtk6">2</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">35</span><span class="mtk1">;</span>
<span class="mtk1">      local_f8[</span><span class="mtk6">3</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">12</span><span class="mtk1">;</span>
<span class="mtk1">      local_f8[</span><span class="mtk6">4</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">ffffffff</span><span class="mtk1">;</span>
<span class="mtk1">      local_f8[</span><span class="mtk6">5</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">c</span><span class="mtk1">;</span>
<span class="mtk1">      local_f8[</span><span class="mtk6">6</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">5</span><span class="mtk1">;</span>
<span class="mtk1">      local_f8[</span><span class="mtk6">7</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">ffffffff</span><span class="mtk1">;</span>
<span class="mtk1">      local_f8[</span><span class="mtk6">8</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">2</span><span class="mtk1">;</span>
<span class="mtk1">      local_f8[</span><span class="mtk6">9</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">13</span><span class="mtk1">;</span>
<span class="mtk1">      local_f8[</span><span class="mtk6">10</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">5</span><span class="mtk1">;</span>
<span class="mtk1">      local_f8[</span><span class="mtk6">11</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">ffffffff</span><span class="mtk1">;</span>
<span class="mtk1">      local_f8[</span><span class="mtk6">12</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">3</span><span class="mtk1">;</span>
<span class="mtk1">      local_f8[</span><span class="mtk6">13</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">11</span><span class="mtk1">;</span>
<span class="mtk1">      local_f8[</span><span class="mtk6">14</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">35</span><span class="mtk1">;</span>
<span class="mtk1">      local_f8[</span><span class="mtk6">15</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">15</span><span class="mtk1">;</span>
<span class="mtk1">      local_f8[</span><span class="mtk6">16</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">37</span><span class="mtk1">;</span>
<span class="mtk1">      local_f8[</span><span class="mtk6">17</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">12</span><span class="mtk1">;</span>
<span class="mtk1">      local_f8[</span><span class="mtk6">18</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">ffffffff</span><span class="mtk1">;</span>
<span class="mtk1">      local_f8[</span><span class="mtk6">19</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">c</span><span class="mtk1">;</span>
<span class="mtk1">      local_f8[</span><span class="mtk6">20</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">37</span><span class="mtk1">;</span>
<span class="mtk1">      local_f8[</span><span class="mtk6">21</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">ffffffff</span><span class="mtk1">;</span>
<span class="mtk1">      local_f8[</span><span class="mtk6">22</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">10</span><span class="mtk1">;</span>
<span class="mtk1">      local_f8[</span><span class="mtk6">23</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">10</span><span class="mtk1">;</span>
<span class="mtk1">      local_f8[</span><span class="mtk6">24</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">11</span><span class="mtk1">;</span>
<span class="mtk1">      local_f8[</span><span class="mtk6">25</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">38</span><span class="mtk1">;</span>
<span class="mtk1">      local_f8[</span><span class="mtk6">26</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">19</span><span class="mtk1">;</span>
<span class="mtk1">      local_f8[</span><span class="mtk6">27</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">18</span><span class="mtk1">;</span>
<span class="mtk1">      local_f8[</span><span class="mtk6">28</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">ffffffff</span><span class="mtk1">;</span>
<span class="mtk1">      local_f8[</span><span class="mtk6">29</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">34</span><span class="mtk1">;</span>
<span class="mtk1">      local_f8[</span><span class="mtk6">30</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">ffffffff</span><span class="mtk1">;</span>
<span class="mtk1">      local_f8[</span><span class="mtk6">31</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">34</span><span class="mtk1">;</span>
<span class="mtk1">      local_30 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">malloc</span><span class="mtk1">(</span><span class="mtk5">0x</span><span class="mtk6">21</span><span class="mtk1">);</span>

<span class="mtk1">      </span><span class="mtk5">for</span><span class="mtk1"> (local_10 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">; local_10 </span><span class="mtk5">&lt;</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">21</span><span class="mtk1">; local_10 </span><span class="mtk5">=</span><span class="mtk1"> local_10 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">) {</span>
<span class="mtk1">        </span><span class="mtk5">if</span><span class="mtk1"> (local_10 </span><span class="mtk5">&lt;</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">20</span><span class="mtk1">) {</span>
<span class="mtk1">          </span><span class="mtk5">if</span><span class="mtk1"> (local_f8[local_10] </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk5">-</span><span class="mtk6">1</span><span class="mtk1">) {</span>
<span class="mtk1">            </span><span class="mtk5">if</span><span class="mtk1"> (local_10 </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">1e</span><span class="mtk1">) {</span>
<span class="mtk1">              </span><span class="mtk5">*</span><span class="mtk1">(undefined </span><span class="mtk5">*</span><span class="mtk1">) ((longlong) local_30 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">1e</span><span class="mtk1">) </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">2e</span><span class="mtk1">;</span>
<span class="mtk1">            } </span><span class="mtk5">else</span><span class="mtk1"> {</span>
<span class="mtk1">              </span><span class="mtk5">*</span><span class="mtk1">(undefined </span><span class="mtk5">*</span><span class="mtk1">) (local_10 </span><span class="mtk5">+</span><span class="mtk1"> (longlong) local_30) </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">5f</span><span class="mtk1">;</span>
<span class="mtk1">            }</span>
<span class="mtk1">          } </span><span class="mtk5">else</span><span class="mtk1"> {</span>
<span class="mtk1">            </span><span class="mtk5">*</span><span class="mtk1">(undefined </span><span class="mtk5">*</span><span class="mtk1">) (local_10 </span><span class="mtk5">+</span><span class="mtk1"> (longlong) local_30) </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">(undefined </span><span class="mtk5">*</span><span class="mtk1">) ((longlong) </span><span class="mtk5">&amp;</span><span class="mtk1">local_78 </span><span class="mtk5">+</span><span class="mtk1"> (longlong) local_f8[local_10]);</span>  
<span class="mtk1">          }</span>
<span class="mtk1">        } </span><span class="mtk5">else</span><span class="mtk1"> {</span>
<span class="mtk1">          </span><span class="mtk5">*</span><span class="mtk1">(undefined </span><span class="mtk5">*</span><span class="mtk1">) (local_10 </span><span class="mtk5">+</span><span class="mtk1"> (longlong) local_30) </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">;</span>
<span class="mtk1">        }</span>
<span class="mtk1">      }</span>

<span class="mtk1">      </span><span class="mtk8">permutateDictionary</span><span class="mtk1">((</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">) </span><span class="mtk5">&amp;</span><span class="mtk1">local_78);</span>

<span class="mtk1">      local_118 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">5f</span><span class="mtk1">;</span>
<span class="mtk1">      local_117 </span><span class="mtk5">=</span><span class="mtk1"> (</span><span class="mtk7 mtki">char</span><span class="mtk1">) local_68 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk4">' '</span><span class="mtk1">;</span>
<span class="mtk1">      local_116 </span><span class="mtk5">=</span><span class="mtk1"> pin;</span>
<span class="mtk1">      local_115 </span><span class="mtk5">=</span><span class="mtk1"> local_68._4_1_ </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk4">'</span><span class="mtk6">\x06</span><span class="mtk4">'</span><span class="mtk1">;</span>
<span class="mtk1">      local_114 </span><span class="mtk5">=</span><span class="mtk1"> local_68._3_1_ </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk4">' '</span><span class="mtk1">;</span>
<span class="mtk1">      local_113 </span><span class="mtk5">=</span><span class="mtk1"> local_60._5_1_ </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk4">' '</span><span class="mtk1">;</span>
<span class="mtk1">      local_112 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">5f</span><span class="mtk1">;</span>
<span class="mtk1">      local_111 </span><span class="mtk5">=</span><span class="mtk1"> local_60._5_1_ </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk4">' '</span><span class="mtk1">;</span>
<span class="mtk1">      local_110 </span><span class="mtk5">=</span><span class="mtk1"> local_68._3_1_ </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk4">' '</span><span class="mtk1">;</span>
<span class="mtk1">      local_10f </span><span class="mtk5">=</span><span class="mtk1"> DAT_2c5acd022;</span>
<span class="mtk1">      local_10e </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">(undefined </span><span class="mtk5">*</span><span class="mtk1">) ((longlong) local_28 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">10</span><span class="mtk1">);</span>
<span class="mtk1">      local_10d </span><span class="mtk5">=</span><span class="mtk1"> local_68._4_1_ </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk4">'</span><span class="mtk6">\x06</span><span class="mtk4">'</span><span class="mtk1">;</span>
<span class="mtk1">      local_10c </span><span class="mtk5">=</span><span class="mtk1"> local_68._3_1_ </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk4">' '</span><span class="mtk1">;</span>
<span class="mtk1">      local_10b </span><span class="mtk5">=</span><span class="mtk1"> local_60._5_1_ </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk4">' '</span><span class="mtk1">;</span>
<span class="mtk1">      local_10a </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">(undefined </span><span class="mtk5">*</span><span class="mtk1">) ((longlong) local_28 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">14</span><span class="mtk1">);</span>
<span class="mtk1">      local_109 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">5f</span><span class="mtk1">;</span>
<span class="mtk1">      local_108 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">;</span>

<span class="mtk1">      </span><span class="mtk8">decryptBuffer</span><span class="mtk1">((longlong) </span><span class="mtk5">&amp;</span><span class="mtk1">local_118, (longlong) local_30);</span>
<span class="mtk1">    }</span>
<span class="mtk1">  }</span>
<span class="mtk1">}</span>
</code></pre></div><p>Aquí vemos algo interesante, y es que se está abriendo la región de memoria compartida llamada <code>SharedMemory</code> (la que creó antes el programa <code>main.exe</code>). De esta región de memoria compartida (donde se encuentra copiada la cuarta parte de <code>input_string</code>) solo se toman dos caracteres (índices <code>10</code> y <code>14</code>)</p><p>Y esta última función <code>decryptBuffer</code> recibe por un lado <code>local_118</code> (que debe ser algún tipo de clave, y es donde aparecen caracteres de la cuarta parte) y por otro lado <code>local_30</code> (que es un <em>buffer</em> de 32 bytes). En esta función se descifra un texto cifrado presente en la DLL y se escribe como <code>decrypted.html</code>:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">undefined8 </span><span class="mtk8">decryptBuffer</span><span class="mtk1">(longlong </span><span class="mtk9 mtki">param_1</span><span class="mtk1">, longlong </span><span class="mtk9 mtki">param_2</span><span class="mtk1">) {</span>
<span class="mtk1">  PUCHAR lpMem;</span>
<span class="mtk1">  undefined8 uVar1;</span>
<span class="mtk1">  </span><span class="mtk7 mtki">size_t</span><span class="mtk1"> sVar2;</span>
<span class="mtk1">  HANDLE hHeap;</span>
<span class="mtk1">  </span><span class="mtk7 mtki">uint</span><span class="mtk1"> local_3c;</span>
<span class="mtk1">  PUCHAR local_38;</span>
<span class="mtk1">  FILE </span><span class="mtk5">*</span><span class="mtk1">local_30;</span>
<span class="mtk1">  longlong local_28;</span>
<span class="mtk1">  longlong local_20;</span>
<span class="mtk1">  </span>
<span class="mtk1">  local_38 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">NULL</span><span class="mtk1">;</span>
<span class="mtk1">  local_3c </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">;</span>
<span class="mtk1">  local_28 </span><span class="mtk5">=</span><span class="mtk1"> param_2;</span>
<span class="mtk1">  local_20 </span><span class="mtk5">=</span><span class="mtk1"> param_1;</span>

<span class="mtk1">  uVar1 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">SimpleDecryption</span><span class="mtk1">(</span><span class="mtk5">0x</span><span class="mtk6">2c5ac9020</span><span class="mtk1">, ciphered_size, param_2, param_1, </span><span class="mtk5">&amp;</span><span class="mtk1">local_38, </span><span class="mtk5">&amp;</span><span class="mtk1">local_3c);</span>  

<span class="mtk1">  </span><span class="mtk5">if</span><span class="mtk1"> ((</span><span class="mtk7 mtki">int</span><span class="mtk1">)uVar1 </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">) {</span>
<span class="mtk1">    uVar1 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">ffffffff</span><span class="mtk1">;</span>
<span class="mtk1">  } </span><span class="mtk5">else</span><span class="mtk1"> {</span>
<span class="mtk1">    local_30 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">fopen</span><span class="mtk1">(</span><span class="mtk4">"decrypted.html"</span><span class="mtk1">, </span><span class="mtk4">"wb"</span><span class="mtk1">);</span>
<span class="mtk1">    sVar2 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">fwrite</span><span class="mtk1">(local_38, </span><span class="mtk6">1</span><span class="mtk1">, (ulonglong) local_3c,l ocal_30);</span>

<span class="mtk1">    </span><span class="mtk5">if</span><span class="mtk1"> (sVar2 </span><span class="mtk5">!=</span><span class="mtk1"> local_3c) {</span>
<span class="mtk1">      </span><span class="mtk8">fclose</span><span class="mtk1">(local_30);</span>
<span class="mtk1">    }</span>

<span class="mtk1">    </span><span class="mtk8">fclose</span><span class="mtk1">(local_30);</span>
<span class="mtk1">    lpMem </span><span class="mtk5">=</span><span class="mtk1"> local_38;</span>
<span class="mtk1">    hHeap </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">GetProcessHeap</span><span class="mtk1">();</span>
<span class="mtk1">    </span><span class="mtk8">HeapFree</span><span class="mtk1">(hHeap, </span><span class="mtk6">0</span><span class="mtk1">, lpMem);</span>
<span class="mtk1">    </span><span class="mtk8">system</span><span class="mtk1">(</span><span class="mtk4">"PAUSE"</span><span class="mtk1">);</span>
<span class="mtk1">    uVar1 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">;</span>
<span class="mtk1">  }</span>

<span class="mtk1">  </span><span class="mtk5">return</span><span class="mtk1"> uVar1;</span>
<span class="mtk1">}</span>
</code></pre></div><p>El tipo de cifrado es AES, y la clave es autogenerada por la DLL (se almacena en <code>local_30</code>). Entonces, el archivo <code>decrypted.html</code> se descifra correctamente. Su contenido contiene la <em>flag</em>, pero no es la verdadera aún. Y aquí termina todo lo que hace la DLL. EL código HTML resultante es:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk10">&lt;</span><span class="mtk1">!GOCTYPE |tml,</span>
<span class="mtk1">&lt;</span><span class="mtk5">html</span><span class="mtk1"> </span><span class="mtk8">lang</span><span class="mtk1">=</span><span class="mtk4">"en"</span><span class="mtk1">&gt;</span>
<span class="mtk1">&lt;</span><span class="mtk5">head</span><span class="mtk1">&gt;</span>
<span class="mtk1">&lt;</span><span class="mtk5">meta</span><span class="mtk1"> </span><span class="mtk8">charset</span><span class="mtk1">=</span><span class="mtk4">"UTF-8"</span><span class="mtk1">&gt;</span>
<span class="mtk1">&lt;</span><span class="mtk5">meta</span><span class="mtk1"> </span><span class="mtk8">name</span><span class="mtk1">=</span><span class="mtk4">"viewport"</span><span class="mtk1"> </span><span class="mtk8">content</span><span class="mtk1">=</span><span class="mtk4">"width=device-width, initial-scale=1.0"</span><span class="mtk1">&gt;</span>
<span class="mtk1">&lt;</span><span class="mtk5">title</span><span class="mtk1">&gt;Background Image Example&lt;/</span><span class="mtk5">title</span><span class="mtk1">&gt;</span>
<span class="mtk1">&lt;</span><span class="mtk5">style</span><span class="mtk1">&gt;</span>
<span class="mtk1">    </span><span class="mtk5">body</span><span class="mtk1"> {</span>
<span class="mtk1">        </span><span class="mtk7 mtki">background-image</span><span class="mtk1">: </span><span class="mtk7">url</span><span class="mtk1">(</span><span class="mtk4">'</span><span class="mtk4 detected-link">https://media.tenor.com/9vBAObrjRTgAAAAe/sad-yoshi</span><span class="mtk4 detected-link">.png</span><span class="mtk4">'</span><span class="mtk1">); </span><span class="mtk3">/* Ruta de la imagen de fondo */</span>  
<span class="mtk1">        </span><span class="mtk7 mtki">background-size</span><span class="mtk1">: </span><span class="mtk7">cover</span><span class="mtk1">; </span><span class="mtk3">/* Ajustar la imagen para cubrir todo el fondo */</span>
<span class="mtk1">        </span><span class="mtk7 mtki">background-repeat</span><span class="mtk1">: </span><span class="mtk7">no-repeat</span><span class="mtk1">; </span><span class="mtk3">/* Evitar que la imagen se repita */</span>
<span class="mtk1">    }</span>
<span class="mtk1">    </span><span class="mtk3">/* Puedes agregar estilos adicionales para el </span><span class="mtk3">contenido de la pÃ¡gina */</span>
<span class="mtk1">    </span><span class="mtk8">.flag</span><span class="mtk1"> {</span>
<span class="mtk1">        </span><span class="mtk3">/* Estilos para el contenido */</span>
<span class="mtk1">        </span><span class="mtk7 mtki">color</span><span class="mtk1">: </span><span class="mtk1 dyn-rule-4-0 colorpicker-color-decoration"> </span><span class="mtk7">white</span><span class="mtk1">;</span>
<span class="mtk1">        </span><span class="mtk7 mtki">text-align</span><span class="mtk1">: </span><span class="mtk7">center</span><span class="mtk1">;</span>
<span class="mtk1">        </span><span class="mtk7 mtki">padding</span><span class="mtk1">: </span><span class="mtk6">20</span><span class="mtk5">px</span><span class="mtk1">;</span>
<span class="mtk1">    }</span>
<span class="mtk1">&lt;/</span><span class="mtk5">style</span><span class="mtk1">&gt;</span>
<span class="mtk1">&lt;/</span><span class="mtk5">head</span><span class="mtk1">&gt;</span>
<span class="mtk1">&lt;</span><span class="mtk5">body</span><span class="mtk1">&gt;</span>

<span class="mtk1">&lt;</span><span class="mtk5">div</span><span class="mtk1"> </span><span class="mtk8">class</span><span class="mtk1">=</span><span class="mtk4">"flag"</span><span class="mtk1">&gt;</span>
<span class="mtk1">    &lt;</span><span class="mtk5">h1</span><span class="mtk1">&gt;HackOn{casi_maestro_(no_es_flag_)}&lt;/</span><span class="mtk5">h1</span><span class="mtk1">&gt;</span>
<span class="mtk1">    &lt;</span><span class="mtk5">p</span><span class="mtk1">&gt;Well done mate!&lt;/</span><span class="mtk5">p</span><span class="mtk1">&gt;</span>
<span class="mtk1">&lt;/</span><span class="mtk5">div</span><span class="mtk1">&gt;</span>

<span class="mtk1">&lt;/</span><span class="mtk5">body</span><span class="mtk1">&gt;</span>
<span class="mtk1">&lt;/</span><span class="mtk5">html</span><span class="mtk1">&gt;</span>
</code></pre></div><p>Como se puede ver, la cabecera no es del todo correcta, por lo que tiene que estar ocurriendo algo más.</p><h2 id="final-de-mainexe">Final de <code>main.exe</code></h2><p>Aún nos queda una función que se ejecuta en <code>main.exe</code>:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk7 mtki">void</span><span class="mtk1"> </span><span class="mtk8">FUN_1400020c9</span><span class="mtk1">(</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk9 mtki">param_1</span><span class="mtk1">, longlong </span><span class="mtk9 mtki">param_2</span><span class="mtk1">, undefined8 </span><span class="mtk9 mtki">param_3</span><span class="mtk1">, undefined8 </span><span class="mtk9 mtki">param_4</span><span class="mtk1">) {</span>  
<span class="mtk1">  </span><span class="mtk7 mtki">int</span><span class="mtk1"> iVar1;</span>
<span class="mtk1">  </span><span class="mtk7 mtki">size_t</span><span class="mtk1"> sVar2;</span>
<span class="mtk1">  </span><span class="mtk8">undefined1</span><span class="mtk1"> (</span><span class="mtk5">*</span><span class="mtk1">pauVar3)[</span><span class="mtk6">10</span><span class="mtk1">];</span>
<span class="mtk1">  undefined local_78[</span><span class="mtk6">26</span><span class="mtk1">];</span>
<span class="mtk1">  undefined local_5e;</span>
<span class="mtk1">  </span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">local_58;</span>
<span class="mtk1">  FILE </span><span class="mtk5">*</span><span class="mtk1">local_50;</span>
<span class="mtk1">  undefined4 local_44;</span>
<span class="mtk1">  LPVOID local_40;</span>
<span class="mtk1">  LPVOID local_38;</span>
<span class="mtk1">  </span><span class="mtk7 mtki">uint</span><span class="mtk1"> local_2c;</span>
<span class="mtk1">  FILE </span><span class="mtk5">*</span><span class="mtk1">local_28;</span>
<span class="mtk1">  undefined </span><span class="mtk5">*</span><span class="mtk1">local_20;</span>
<span class="mtk1">  ulonglong local_18;</span>
<span class="mtk1">  ulonglong local_10;</span>
<span class="mtk1">  </span>
<span class="mtk1">  local_20 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">&amp;</span><span class="mtk1">DAT_14000a0c1;</span>
<span class="mtk1">  iVar1 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">strcmp</span><span class="mtk1">(param_1, </span><span class="mtk4">"end"</span><span class="mtk1">);</span>

<span class="mtk1">  </span><span class="mtk5">if</span><span class="mtk1"> (iVar1 </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">) {</span>
<span class="mtk1">    local_78[</span><span class="mtk6">0</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">(undefined </span><span class="mtk5">*</span><span class="mtk1">) (param_2 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">1c</span><span class="mtk1">);</span>
<span class="mtk1">    local_78[</span><span class="mtk6">1</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">(undefined </span><span class="mtk5">*</span><span class="mtk1">) (param_2 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">4</span><span class="mtk1">);</span>
<span class="mtk1">    local_78[</span><span class="mtk6">2</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">(undefined </span><span class="mtk5">*</span><span class="mtk1">) (param_2 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">5</span><span class="mtk1">);</span>
<span class="mtk1">    local_78[</span><span class="mtk6">3</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">(undefined </span><span class="mtk5">*</span><span class="mtk1">) (param_2 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">32</span><span class="mtk1">);</span>
<span class="mtk1">    local_78[</span><span class="mtk6">4</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">(undefined </span><span class="mtk5">*</span><span class="mtk1">) (param_2 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">d</span><span class="mtk1">);</span>
<span class="mtk1">    local_78[</span><span class="mtk6">5</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">(undefined </span><span class="mtk5">*</span><span class="mtk1">) (param_2 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">2f</span><span class="mtk1">);</span>
<span class="mtk1">    local_78[</span><span class="mtk6">6</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">(undefined </span><span class="mtk5">*</span><span class="mtk1">) (param_2 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">2</span><span class="mtk1">);</span>
<span class="mtk1">    local_78[</span><span class="mtk6">7</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">(undefined </span><span class="mtk5">*</span><span class="mtk1">) (param_2 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">38</span><span class="mtk1">);</span>
<span class="mtk1">    local_78[</span><span class="mtk6">8</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">(undefined </span><span class="mtk5">*</span><span class="mtk1">) (param_2 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">1b</span><span class="mtk1">);</span>
<span class="mtk1">    local_78[</span><span class="mtk6">9</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">(undefined </span><span class="mtk5">*</span><span class="mtk1">) (param_2 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">2c</span><span class="mtk1">);</span>
<span class="mtk1">    local_78[</span><span class="mtk6">10</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">(undefined </span><span class="mtk5">*</span><span class="mtk1">) (param_2 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">30</span><span class="mtk1">);</span>
<span class="mtk1">    local_78[</span><span class="mtk6">11</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">(undefined </span><span class="mtk5">*</span><span class="mtk1">) (param_2 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">2f</span><span class="mtk1">);</span>
<span class="mtk1">    local_78[</span><span class="mtk6">12</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">(undefined </span><span class="mtk5">*</span><span class="mtk1">) (param_2 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">9</span><span class="mtk1">);</span>
<span class="mtk1">    local_78[</span><span class="mtk6">13</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">(undefined </span><span class="mtk5">*</span><span class="mtk1">) (param_2 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">19</span><span class="mtk1">);</span>
<span class="mtk1">    local_78[</span><span class="mtk6">14</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">(undefined </span><span class="mtk5">*</span><span class="mtk1">) (param_2 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">2b</span><span class="mtk1">);</span>
<span class="mtk1">    local_78[</span><span class="mtk6">15</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">(undefined </span><span class="mtk5">*</span><span class="mtk1">) (param_2 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">3b</span><span class="mtk1">);</span>
<span class="mtk1">    local_78[</span><span class="mtk6">16</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">(undefined </span><span class="mtk5">*</span><span class="mtk1">) (param_2 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">36</span><span class="mtk1">);</span>
<span class="mtk1">    local_78[</span><span class="mtk6">17</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">(undefined </span><span class="mtk5">*</span><span class="mtk1">) (param_2 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">1c</span><span class="mtk1">);</span>
<span class="mtk1">    local_78[</span><span class="mtk6">18</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">(undefined </span><span class="mtk5">*</span><span class="mtk1">) (param_2 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">11</span><span class="mtk1">);</span>
<span class="mtk1">    local_78[</span><span class="mtk6">19</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">(undefined </span><span class="mtk5">*</span><span class="mtk1">) (param_2 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">13</span><span class="mtk1">);</span>
<span class="mtk1">    local_78[</span><span class="mtk6">20</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">(undefined </span><span class="mtk5">*</span><span class="mtk1">) (param_2 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">12</span><span class="mtk1">);</span>
<span class="mtk1">    local_78[</span><span class="mtk6">21</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">(undefined </span><span class="mtk5">*</span><span class="mtk1">) (param_2 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">20</span><span class="mtk1">);</span>
<span class="mtk1">    local_78[</span><span class="mtk6">22</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">(undefined </span><span class="mtk5">*</span><span class="mtk1">) (param_2 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">40</span><span class="mtk1">);</span>
<span class="mtk1">    local_78[</span><span class="mtk6">23</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">(undefined </span><span class="mtk5">*</span><span class="mtk1">) (param_2 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">22</span><span class="mtk1">);</span>
<span class="mtk1">    local_78[</span><span class="mtk6">24</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">(undefined </span><span class="mtk5">*</span><span class="mtk1">) (param_2 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">3d</span><span class="mtk1">);</span>
<span class="mtk1">    local_78[</span><span class="mtk6">25</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">(undefined </span><span class="mtk5">*</span><span class="mtk1">) (param_2 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">2f</span><span class="mtk1">);</span>
<span class="mtk1">    local_5e </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">;</span>

<span class="mtk1">    pauVar3 </span><span class="mtk5">=</span><span class="mtk1"> (</span><span class="mtk8">undefined1</span><span class="mtk1"> (</span><span class="mtk5">*</span><span class="mtk1">) [</span><span class="mtk6">10</span><span class="mtk1">]) </span><span class="mtk5">&amp;</span><span class="mtk1">DAT_14000a002;</span>
<span class="mtk1">    local_28 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">fopen</span><span class="mtk1">(</span><span class="mtk4">"decrypted.html"</span><span class="mtk1">, </span><span class="mtk4">"rb"</span><span class="mtk1">);</span>

<span class="mtk1">    </span><span class="mtk5">if</span><span class="mtk1"> (local_28 </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">NULL</span><span class="mtk1">) {</span>
<span class="mtk1">      </span><span class="mtk8">do_print</span><span class="mtk1">(</span><span class="mtk4">"failed to open the .html"</span><span class="mtk1">, pauVar3, param_3,p aram_4);</span>
<span class="mtk1">    } </span><span class="mtk5">else</span><span class="mtk1"> {</span>
<span class="mtk1">      </span><span class="mtk8">fseek</span><span class="mtk1">(local_28, </span><span class="mtk6">0</span><span class="mtk1">, </span><span class="mtk6">2</span><span class="mtk1">);</span>
<span class="mtk1">      local_2c </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">ftell</span><span class="mtk1">(local_28);</span>
<span class="mtk1">      </span><span class="mtk8">rewind</span><span class="mtk1">(local_28);</span>
<span class="mtk1">      local_38 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">VirtualAlloc</span><span class="mtk1">(</span><span class="mtk6">NULL</span><span class="mtk1">,(ulonglong) local_2c, </span><span class="mtk5">0x</span><span class="mtk6">3000</span><span class="mtk1">, </span><span class="mtk5">0x</span><span class="mtk6">40</span><span class="mtk1">);</span>
<span class="mtk1">      sVar2 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">fread</span><span class="mtk1">(local_38, </span><span class="mtk6">1</span><span class="mtk1">, (ulonglong) local_2c, local_28);</span>

<span class="mtk1">      </span><span class="mtk5">if</span><span class="mtk1"> (sVar2 </span><span class="mtk5">!=</span><span class="mtk1"> local_2c) {</span>
<span class="mtk1">        </span><span class="mtk8">fclose</span><span class="mtk1">(local_28);</span>
<span class="mtk1">      }</span>

<span class="mtk1">      local_40 </span><span class="mtk5">=</span><span class="mtk1"> local_38;</span>
<span class="mtk1">      local_44 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">;</span>

<span class="mtk1">      </span><span class="mtk5">for</span><span class="mtk1"> (local_10 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">; local_10 </span><span class="mtk5">&lt;</span><span class="mtk1"> local_2c; local_10 </span><span class="mtk5">=</span><span class="mtk1"> local_10 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">) {</span>
<span class="mtk1">        </span><span class="mtk5">if</span><span class="mtk1"> ((((</span><span class="mtk5">*</span><span class="mtk1">(</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">) (local_10 </span><span class="mtk5">+</span><span class="mtk1"> (longlong) local_38) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk4">'c'</span><span class="mtk1">) </span><span class="mtk5">&amp;&amp;</span>
<span class="mtk1">             (</span><span class="mtk5">*</span><span class="mtk1">(</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">) ((longlong) local_38 </span><span class="mtk5">+</span><span class="mtk1"> local_10 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk4">'a'</span><span class="mtk1">)) </span><span class="mtk5">&amp;&amp;</span>
<span class="mtk1">            (</span><span class="mtk5">*</span><span class="mtk1">(</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">) ((longlong) local_38 </span><span class="mtk5">+</span><span class="mtk1"> local_10 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">2</span><span class="mtk1">) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk4">'s'</span><span class="mtk1">)) </span><span class="mtk5">&amp;&amp;</span>
<span class="mtk1">           ((</span><span class="mtk5">*</span><span class="mtk1">(</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">) ((longlong) local_38 </span><span class="mtk5">+</span><span class="mtk1"> local_10 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">3</span><span class="mtk1">) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk4">'i'</span><span class="mtk1"> </span><span class="mtk5">&amp;&amp;</span>
<span class="mtk1">            (</span><span class="mtk5">*</span><span class="mtk1">(</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">) ((longlong) local_38 </span><span class="mtk5">+</span><span class="mtk1"> local_10 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">4</span><span class="mtk1">) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk4">'_'</span><span class="mtk1">)))) {</span>

<span class="mtk1">          </span><span class="mtk5">for</span><span class="mtk1"> (local_18 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">; local_18 </span><span class="mtk5">&lt;</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">1a</span><span class="mtk1">; local_18 </span><span class="mtk5">=</span><span class="mtk1"> local_18 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">) {</span>
<span class="mtk1">            </span><span class="mtk5">*</span><span class="mtk1">(undefined </span><span class="mtk5">*</span><span class="mtk1">) (local_10 </span><span class="mtk5">+</span><span class="mtk1"> local_18 </span><span class="mtk5">+</span><span class="mtk1"> (longlong) local_38) </span><span class="mtk5">=</span><span class="mtk1"> local_78[local_18];</span>
<span class="mtk1">          }</span>
<span class="mtk1">        }</span>
<span class="mtk1">      }</span>

<span class="mtk1">      local_50 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">fopen</span><span class="mtk1">(</span><span class="mtk4">"decrypted.html"</span><span class="mtk1">, </span><span class="mtk4">"wb"</span><span class="mtk1">);</span>
<span class="mtk1">      sVar2 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">fwrite</span><span class="mtk1">(local_40, </span><span class="mtk6">1</span><span class="mtk1">, (ulonglong) local_2c, local_50);</span>

<span class="mtk1">      </span><span class="mtk5">if</span><span class="mtk1"> (sVar2 </span><span class="mtk5">!=</span><span class="mtk1"> local_2c) {</span>
<span class="mtk1">        </span><span class="mtk8">fclose</span><span class="mtk1">(local_50);</span>
<span class="mtk1">      }</span>

<span class="mtk1">      local_58 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk4">"decrypted.html"</span><span class="mtk1">;</span>
<span class="mtk1">      </span><span class="mtk8">ShellExecuteA</span><span class="mtk1">(</span><span class="mtk6">NULL</span><span class="mtk1">, </span><span class="mtk4">"open"</span><span class="mtk1">, </span><span class="mtk4">"decrypted.html"</span><span class="mtk1">, </span><span class="mtk6">NULL</span><span class="mtk1">, </span><span class="mtk6">NULL</span><span class="mtk1">, </span><span class="mtk6">1</span><span class="mtk1">);</span>
<span class="mtk1">    }</span>
<span class="mtk1">  }</span>
<span class="mtk1">}</span>
</code></pre></div><p>Aquí se vuelve a abrir el archivo <code>decrypted.html</code>. Además, se mira que el contenido de la variable <code>param_1</code> sea <code>"end"</code>. Esto nunca va a ocurrir en una ejecución normal, puesto que esta variable contiene la ruta absoluta al ejecutable (mirado desde x64dbg). Por tanto, necesitamos ejecutar el programa desde el depurador y saltarnos esta comprobación para poder ejecutar el resto del código.</p><p>Básicamente lo que hace es buscar la posición de la subcadena <code>"casi_"</code> y escribir ahí valores del vector <code>local_78</code>. En este vector aparecen caracteres de <code>param_2</code>, que es <code>input_string</code> al completo. Por tanto, podemos también realizar esta parte en Python:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">&gt;&gt;&gt; input_string = b'ctf@hackon?/d0n0t8ruT3,th1nk_burpees.dll/Magic/??????????????????'
&gt;&gt;&gt; bytes([input_string[0x1c], input_string[4], input_string[5], input_string[0x32], input_string[0xd], input_string[0x2f], input_string[2], input_string[0x38], input_string[0x1b], input_string[0x2c], input_string[0x30], input_string[0x2f], input_string[9], input_string[0x19], input_string[0x2b], input_string[0x3b], input_string[0x36], input_string[0x1c], input_string[0x11], input_string[0x13], input_string[0x12], input_string[0x20], input_string[0x40], input_string[0x22], input_string[0x3d], input_string[0x2f]])  
b'_ha?0?f?ki??n1g??_8urp?e??'
</code></pre></div><p>Pero nos faltan muchos caracteres. Podríamos echar un vistazo a la región de memoria compartida, que es de donde se saban dos bytes que se usan probablemente como IV del cifrado AES. Para ello, tenemos que poner un <em>breakpoint</em> después de poner el PIN y seguir la ejecución hasta llegar a la función <code>decryptBuffer</code>:</p><p><img alt="PICtureThis 2" src="/images/other/HackOn%20CTF/PICtureThis-2.webp"></p><p>Ahí vemos tanto la clave de AES como gran parte del IV. Los caracteres que faltan podemos deducir que son <code>u</code> y <code>s</code> para formar el IV <code>_n1ght_th0ughts_</code>.</p><p>Una vez tenemos esto, podemos ponerlo en Python de nuevo y ver cuál sería la <em>flag</em>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">&gt;&gt;&gt; input_string = b'ctf@hackon?/d0n0t8ruT3,th1nk_burpees.dll/Magic/_n1ght_th0ughts_'
&gt;&gt;&gt; bytes([input_string[0x1c], input_string[4], input_string[5], input_string[0x32], input_string[0xd], input_string[0x2f], input_string[2], input_string[0x38], input_string[0x1b], input_string[0x2c], input_string[0x30], input_string[0x2f], input_string[9], input_string[0x19], input_string[0x2b], input_string[0x3b], input_string[0x36], input_string[0x1c], input_string[0x11], input_string[0x13], input_string[0x12], input_string[0x20], input_string[0x40], input_string[0x22], input_string[0x3d], input_string[0x2f]])  
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
IndexError: index out of range
</code></pre></div><p>Bueno, como da <code>IndexError</code>, vamos a poner algún carácter más:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">&gt;&gt;&gt; input_string = b'ctf@hackon?/d0n0t8ruT3,th1nk_burpees.dll/Magic/_n1ght_th0ughts_**'
&gt;&gt;&gt; bytes([input_string[0x1c], input_string[4], input_string[5], input_string[0x32], input_string[0xd], input_string[0x2f], input_string[2], input_string[0x38], input_string[0x1b], input_string[0x2c], input_string[0x30], input_string[0x2f], input_string[9], input_string[0x19], input_string[0x2b], input_string[0x3b], input_string[0x36], input_string[0x1c], input_string[0x11], input_string[0x13], input_string[0x12], input_string[0x20], input_string[0x40], input_string[0x22], input_string[0x3d], input_string[0x2f]])  
b'_hag0_f0kin_n1ght_8urp*es_'
</code></pre></div><p>Aún queda un solo carácter que no tiene un valor claro, pero podemos pensar que es una <code>e</code>.</p><h2 id="_flag_"><em>Flag</em></h2><p>Si ejecutamos todo desde el depurador y saltamos la comprobación de <code>"end"</code>, se nos abrirá el documento HTML en un navegador mostrando la <em>flag</em> (aunque con el carácter raro):</p><p><img alt="PICtureThis 3" src="/images/other/HackOn%20CTF/PICtureThis-3.webp"></p><div class="mt6 instapaper_ignoref"></div></div><aside aria-label="aside" class="w-20-l aside-desktop"><div class="bg-card pa3 nested-list-reset nested-copy-line-height nested-links" style="position:sticky;top:5rem;padding-bottom:0"><p class="f5 b pb2" style="border-bottom:5px solid var(--background);margin:0">Contenidos</p><nav id="TableOfContents"><ul><li><a href="#análisis-de-mainexe">Análisis de <code>main.exe</code></a><ul><li><a href="#primera-comprobación">Primera comprobación</a></li><li><a href="#segunda-comprobación">Segunda comprobación</a></li><li><a href="#últimas-comprobaciones">Últimas comprobaciones</a></li></ul></li><li><a href="#análisis-de-burpeesdll">Análisis de <code>burpees.dll</code></a></li><li><a href="#final-de-mainexe">Final de <code>main.exe</code></a></li><li><a href="#_flag_"><em>Flag</em></a></li></ul></nav><div class="bg-card" style="border-top:5px solid var(--background)"><a class="bmc-btn w-100" target="_blank" href="http://buymeacoffee.com/7Rocky" style="padding:0" title="Buy me a beer">🍺 <span class="bmc-btn-text" style="font-family:Cookie!important;color:#fff">Buy me a beer</span></a></div></div></aside></article></main><footer class="bottom-0 w-100" role="contentinfo"><div class="tc mw8 ph3" style="margin:auto"><form style="background-color:var(--background-card)" class="tc mw8 pv3 mb3" action="https://mailchi.mp/59ffae939360/7rockys-blog-weekly-newsletter" target="popupwindow" onsubmit='return window.open("https://mailchi.mp/59ffae939360/7rockys-blog-weekly-newsletter"),!0'><h3 class="tc">7Rocky's Blog Weekly Newsletter</h3><p class="tc"><input class="f5 pv3 ph3 bn" style="background-color:var(--background);color:inherit;font-weight:700;line-height:normal" type="submit" value="Recibe un resumen semanal del blog"></p><input type="hidden" value="1" name="embed">
<input style="display:none;color:var(--header)" type="submit" value="Suscribirse"><p class="tc"><a href="/en/newsletters/" target="_blank" title="View letter archive">Ver historial de resúmenes</a></p><p class="tc">impulsado por <a href="http://www.mailchimp.com" target="_blank" title="Mailchimp">Mailchimp</a></p></form></div><div class="bg-black w-100 pa3" role="contentinfo"><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://7rocky.github.io/" title="https://7rocky.github.io/">&copy; Blog de 7Rocky. Ciberseguridad y Mates 2024</a><div style="margin-top:8px"><div><div><a href="https://www.linkedin.com/in/roberto-gesteira-minarro/" target="_blank" class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel="noopener" aria-label="follow on LinkedIn——Opens in a new window"><svg height="30" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
<span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</span></a><a href="https://github.com/7Rocky" target="_blank" class="link-transition github link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel="noopener" aria-label="follow on GitHub——Opens in a new window"><svg height="30" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg>
<span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a></div></div></div></div></div></footer></body></html>