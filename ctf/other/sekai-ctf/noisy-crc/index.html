<!doctype html><html lang="es"><head><title>Noisy CRC | 7Rocky</title>
<meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="author" content="Blog de 7Rocky. Ciberseguridad y Mates"><meta name="description" content="Sekai CTF 2023. CRC. Teorema Chino del Resto. Fuerza Bruta"><meta name="image" content="https://7rocky.github.io/images/cryptography.png"><meta name="robots" content="index, follow"><meta name="viewport" content="width=device-width,minimum-scale=1"><meta itemprop="description" content="Sekai CTF 2023. CRC. Teorema Chino del Resto. Fuerza Bruta"><meta itemprop="keywords" content><meta itemprop="name" content="Noisy CRC"><meta property="article:published_time" content><meta property="og:author" content="Blog de 7Rocky. Ciberseguridad y Mates"><meta property="og:description" content="Sekai CTF 2023. CRC. Teorema Chino del Resto. Fuerza Bruta"><meta property="og:image" content="https://7rocky.github.io/images/cryptography.png"><meta property="og:locale" content="es_ES"><meta property="og:site_name" content="Blog de 7Rocky. Ciberseguridad y Mates"><meta property="og:title" content="Noisy CRC"><meta property="og:type" content="website"><meta property="og:url" content="https://7rocky.github.io/ctf/other/sekai-ctf/noisy-crc/"><meta name="twitter:author" content="Blog de 7Rocky. Ciberseguridad y Mates"><meta name="twitter:card" content="Sekai CTF 2023. CRC. Teorema Chino del Resto. Fuerza Bruta"><meta name="twitter:description" content="Sekai CTF 2023. CRC. Teorema Chino del Resto. Fuerza Bruta"><meta name="twitter:image" content="https://7rocky.github.io/images/cryptography.png"><meta name="twitter:title" content="Noisy CRC"><link href="/favicon.ico" rel="shortcut icon" type="image/x-icon"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tachyons@4.12.0/css/tachyons.min.css" integrity="sha256-MgEf5i1a74lVzhT+1R6mBbWCUeUaxC8sQTaN5GY+CoI=" crossorigin="anonymous"><link href="/css/main.css" rel="stylesheet"><link href="/css/code.css" rel="stylesheet"><link href="https://7rocky.github.io/ctf/other/sekai-ctf/noisy-crc/" rel="canonical"><script async src="https://www.googletagmanager.com/gtag/js?id=G-Z1HQGH3M4D"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-Z1HQGH3M4D")}</script><script>MathJax={loader:{load:["[tex]/noerrors"]},options:{ignoreHtmlClass:"tex2jax_ignore",processHtmlClass:"tex2jax_process",skipHtmlTags:["noscript","pre","script","style","textarea"]},tex:{autoload:{color:[],colorv2:["color"]},displayMath:[["$$","$$"]],inlineMath:[["$","$"]],packages:{"[+]":["noerrors"]},processEnvironments:!0,processEscapes:!0}}</script><script type="text/javascript" src="//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script><div id="math-consts" style="display:none">$
\newcommand{\e}{e}
\newcommand{\N}[1][]{\mathbb{N}^{#1}}
\newcommand{\Q}[1][]{\mathbb{Q}^{#1}}
\newcommand{\R}[1][]{\mathbb{R}^{#1}}
\newcommand{\Z}[1][]{\mathbb{Z}^{#1}}
\newcommand{\C}[1][]{\mathbb{C}^{#1}}
\newcommand{\dx}{\,\mathrm{d}x}
\newcommand{\dy}{\,\mathrm{d}y}
\newcommand{\dz}{\,\mathrm{d}z}
\newcommand{\dt}{\,\mathrm{d}t}
\newcommand{\divides}{\, | \,}
\newcommand{\st}{\; | \;}
\renewcommand{\geq}{\geqslant}
\renewcommand{\leq}{\leqslant}
\renewcommand{\i}{\mathrm{i}}
\newcommand{\rank}{\mathop{\mathrm{rank}}}
\newcommand{\gcd}{\mathop{\mathrm{gcd}}}
\newcommand{\lcm}{\mathop{\mathrm{lcm}}}
\newcommand{\tr}{\mathop{\mathrm{tr}}}
\newcommand{\charField}{\mathop{\mathrm{char}}}
\newcommand{\Image}{\mathop{\mathrm{Im}}}
$</div><script src="/js/imc.js"></script><script>(async()=>await typeset(()=>[`#math-consts`]))()</script></head><body class="ma0 production"><header style="position:sticky;top:0;z-index:9"><div class="bg-black"><nav class="ph4-ns" id="navigation" role="navigation"><div class="flex-l justify-between items-center center"><a class="f3 fw2 hover-white no-underline white-90 dib" href="/" title="7Rocky">7Rocky</a><div class="flex-l items-center"><a href="/search" target class="link-transition link dib z-999 pt3 pt0-l mr1 search-link" title="Buscar" rel="noopener" aria-label="Buscar"><svg height="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 487.95 487.95" style="enable-background:new 0 0 487.95 487.95"><g><g><path d="M481.8 453l-140-140.1c27.6-33.1 44.2-75.4 44.2-121.6C386 85.9 299.5.2 193.1.2S0 86 0 191.4s86.5 191.1 192.9 191.1c45.2.0 86.8-15.5 119.8-41.4l140.5 140.5c8.2 8.2 20.4 8.2 28.6.0C490 473.4 490 461.2 481.8 453zM41 191.4c0-82.8 68.2-150.1 151.9-150.1s151.9 67.3 151.9 150.1-68.2 150.1-151.9 150.1S41 274.1 41 191.4z" style="fill-rule:evenodd;clip-rule:evenodd;fill:#a9a9b3"/></g></g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/></svg>
</a><a class="link-transition lang link dib z-999 pt3 pt0-l mr3" href="#" title="es"><img alt="es" height="30px" src="/images/es.png" width="30px">
</a><a class="link-transition lang link dib z-999 pt3 pt0-l" href="/en/ctf/other/sekai-ctf/noisy-crc/" title="en"><img alt="en" height="30px" src="/images/en.png" style="border:4px solid#000;border-radius:100%" width="30px"></a><ul class="pl0 ml3 mr3" style="line-height:30px"><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href="/ctf/" title="CTF">CTF</a></li><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href="/htb/" title="HTB">HTB</a></li><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href="/imc/" title="IMC">IMC</a></li></ul><a href="https://www.linkedin.com/in/roberto-gesteira-minarro/" target="_blank" class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel="noopener" aria-label="follow on LinkedIn——Opens in a new window"><svg height="30" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
<span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</span></a><a href="https://github.com/7Rocky" target="_blank" class="link-transition github link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel="noopener" aria-label="follow on GitHub——Opens in a new window"><svg height="30" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg>
<span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a></div></div></nav></div></header><main class="pb5" role="main" style="min-height:720px"><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-80-l"><a aria-label="aside" class="instapaper_ignoref b tracked" href="../" style="font-size:1.2rem">&lt;- SEKAI CTF</a><div id="sharing" class="mt3"><a aria-label="share on Facebook" class="facebook no-underline" href="https://www.facebook.com/sharer.php?u=https://7rocky.github.io/ctf/other/sekai-ctf/noisy-crc/" title="share on Facebook"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765 50.32h6.744V33.998h4.499l.596-5.624h-5.095l.007-2.816c0-1.466.14-2.253 2.244-2.253h2.812V17.68h-4.5c-5.405.0-7.307 2.729-7.307 7.317v3.377h-3.369v5.625h3.369V50.32zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg>
</a><a aria-label="share on Twitter" class="twitter no-underline" href="https://twitter.com/share?url=https://7rocky.github.io/ctf/other/sekai-ctf/noisy-crc/&amp;text=Noisy%20CRC" title="share on Twitter"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</a><a aria-label="share on LinkedIn" class="linkedin no-underline" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://7rocky.github.io/ctf/other/sekai-ctf/noisy-crc/&amp;title=Noisy%20CRC" title="share on LinkedIn"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a></div><h1 class="f1 mt3 mb1">Noisy CRC</h1><p class="mb4 f6 dib tracked">8 minutos de lectura</p></header><aside aria-label="aside" class="w-20-l mt6-l aside-mobile"><div class="bg-card pa3 nested-list-reset nested-copy-line-height nested-links" style="position:sticky;top:5rem;padding-bottom:0"><p class="f5 b pb2" style="border-bottom:5px solid var(--background);margin:0">Contenidos</p><nav id="TableOfContents"><ul><li><a href="#análisis-del-código-fuente">Análisis del código fuente</a></li><li><a href="#crc">CRC</a><ul><li><a href="#intuición">Intuición</a></li></ul></li><li><a href="#solución">Solución</a><ul><li><a href="#sin-aleatoriedad">Sin aleatoriedad</a></li><li><a href="#adaptación">Adaptación</a></li></ul></li><li><a href="#_flag_"><em>Flag</em></a></li></ul></nav><div class="bg-card" style="border-top:5px solid var(--background)"><a class="bmc-btn w-100" target="_blank" href="http://buymeacoffee.com/7Rocky" style="padding:0" title="Buy me a beer">🍺 <span class="bmc-btn-text" style="font-family:Cookie!important;color:#fff">Buy me a beer</span></a></div></div></aside><div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img pr4-l w-80-l"><p>Se nos proporciona el código fuente en Python del servidor:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk5">import</span><span class="mtk1"> </span><span class="mtk8 mtku">secrets</span>
<span class="mtk5">from</span><span class="mtk1"> </span><span class="mtk8 mtku">Crypto</span><span class="mtk1">.</span><span class="mtk8 mtku">Util</span><span class="mtk1">.</span><span class="mtk8 mtku">number</span><span class="mtk1"> </span><span class="mtk5">import</span><span class="mtk1"> </span><span class="mtk5">*</span>
<span class="mtk5">from</span><span class="mtk1"> </span><span class="mtk8 mtku">Crypto</span><span class="mtk1">.</span><span class="mtk8 mtku">Cipher</span><span class="mtk1"> </span><span class="mtk5">import</span><span class="mtk1"> </span><span class="mtk8 mtku">AES</span>
<span class="mtk5">from</span><span class="mtk1"> </span><span class="mtk8 mtku">hashlib</span><span class="mtk1"> </span><span class="mtk5">import</span><span class="mtk1"> </span><span class="mtk8">sha256</span>

<span class="mtk5">from</span><span class="mtk1"> flag </span><span class="mtk5">import</span><span class="mtk1"> </span><span class="mtk6">FLAG</span>

<span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">getCRC16</span><span class="mtk1">(</span><span class="mtk9 mtki">msg</span><span class="mtk1">, </span><span class="mtk9 mtki">gen_poly</span><span class="mtk1">):</span>
<span class="mtk1">    </span><span class="mtk5">assert</span><span class="mtk1"> (</span><span class="mtk6">1</span><span class="mtk1"> </span><span class="mtk5">&lt;&lt;</span><span class="mtk1"> </span><span class="mtk6">16</span><span class="mtk1">) </span><span class="mtk5">&lt;=</span><span class="mtk1"> </span><span class="mtk9 mtki">gen_poly</span><span class="mtk1"> </span><span class="mtk5">&lt;</span><span class="mtk1"> (</span><span class="mtk6">1</span><span class="mtk1"> </span><span class="mtk5">&lt;&lt;</span><span class="mtk1"> </span><span class="mtk6">17</span><span class="mtk1">)  </span><span class="mtk3"># check if deg = 16</span>
<span class="mtk1">    </span><span class="mtk1">msglen</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk9 mtki">msg</span><span class="mtk1">.bit_length()</span>

<span class="mtk1">    </span><span class="mtk9 mtki">msg</span><span class="mtk1"> </span><span class="mtk5">&lt;&lt;=</span><span class="mtk1"> </span><span class="mtk6">16</span>
<span class="mtk1">    </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">i</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8 mtku">range</span><span class="mtk1">(</span><span class="mtk1">msglen</span><span class="mtk1"> </span><span class="mtk5">-</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">, </span><span class="mtk5">-</span><span class="mtk6">1</span><span class="mtk1">, </span><span class="mtk5">-</span><span class="mtk6">1</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk5">if</span><span class="mtk1"> (</span><span class="mtk9 mtki">msg</span><span class="mtk1"> </span><span class="mtk5">&gt;&gt;</span><span class="mtk1"> (</span><span class="mtk1">i</span><span class="mtk1"> </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">16</span><span class="mtk1">)) </span><span class="mtk5">&amp;</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk9 mtki">msg</span><span class="mtk1"> </span><span class="mtk5">^=</span><span class="mtk1"> (</span><span class="mtk9 mtki">gen_poly</span><span class="mtk1"> </span><span class="mtk5">&lt;&lt;</span><span class="mtk1"> </span><span class="mtk1">i</span><span class="mtk1">)</span>

<span class="mtk1">    </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk9 mtki">msg</span>

<span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">oracle</span><span class="mtk1">(</span><span class="mtk9 mtki">secret</span><span class="mtk1">, </span><span class="mtk9 mtki">gen_poly</span><span class="mtk1">):</span>
<span class="mtk1">    </span><span class="mtk1">res</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> [</span><span class="mtk8 mtku">secrets</span><span class="mtk1">.</span><span class="mtk8">randbits</span><span class="mtk1">(</span><span class="mtk6">16</span><span class="mtk1">) </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">_</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8 mtku">range</span><span class="mtk1">(</span><span class="mtk6">3</span><span class="mtk1">)] </span>
<span class="mtk1">    </span><span class="mtk1">res</span><span class="mtk1">[</span><span class="mtk8 mtku">secrets</span><span class="mtk1">.</span><span class="mtk8">randbelow</span><span class="mtk1">(</span><span class="mtk6">3</span><span class="mtk1">)] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">getCRC16</span><span class="mtk1">(</span><span class="mtk9 mtki">secret</span><span class="mtk1">, </span><span class="mtk9 mtki">gen_poly</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk1">res</span>


<span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">main</span><span class="mtk1">():</span>
<span class="mtk1">    </span><span class="mtk1">key</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">secrets</span><span class="mtk1">.</span><span class="mtk8">randbits</span><span class="mtk1">(</span><span class="mtk6">512</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">cipher</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">AES</span><span class="mtk1">.</span><span class="mtk8">new</span><span class="mtk1">(</span><span class="mtk8">sha256</span><span class="mtk1">(</span><span class="mtk8">long_to_bytes</span><span class="mtk1">(</span><span class="mtk1">key</span><span class="mtk1">)).</span><span class="mtk8">digest</span><span class="mtk1">()[:</span><span class="mtk6">16</span><span class="mtk1">], </span><span class="mtk8 mtku">AES</span><span class="mtk1">.</span><span class="mtk1">MODE_CTR</span><span class="mtk1">, </span><span class="mtk9 mtki">nonce</span><span class="mtk5">=</span><span class="mtk7 mtki">b</span><span class="mtk4">"12345678"</span><span class="mtk1">)</span>  
<span class="mtk1">    </span><span class="mtk1">enc_flag</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">cipher</span><span class="mtk1">.</span><span class="mtk8">encrypt</span><span class="mtk1">(</span><span class="mtk6">FLAG</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk8">print</span><span class="mtk1">(</span><span class="mtk7 mtki">f</span><span class="mtk4">"Encrypted flag: </span><span class="mtk6">{</span><span class="mtk1">enc_flag</span><span class="mtk1">.</span><span class="mtk8">hex</span><span class="mtk1">()</span><span class="mtk6">}</span><span class="mtk4">"</span><span class="mtk1">)</span>

<span class="mtk1">    </span><span class="mtk1">used</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">set</span><span class="mtk1">({})</span>

<span class="mtk1">    </span><span class="mtk5">while</span><span class="mtk1"> </span><span class="mtk6">True</span><span class="mtk1">:</span>
<span class="mtk1">        </span><span class="mtk1">gen_poly</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">int</span><span class="mtk1">(</span><span class="mtk8">input</span><span class="mtk1">(</span><span class="mtk4">"Give me your generator polynomial: "</span><span class="mtk1">))</span>
<span class="mtk1">        </span><span class="mtk5">assert</span><span class="mtk1"> (</span><span class="mtk6">1</span><span class="mtk1"> </span><span class="mtk5">&lt;&lt;</span><span class="mtk1"> </span><span class="mtk6">16</span><span class="mtk1">) </span><span class="mtk5">&lt;=</span><span class="mtk1"> </span><span class="mtk1">gen_poly</span><span class="mtk1"> </span><span class="mtk5">&lt;</span><span class="mtk1"> (</span><span class="mtk6">1</span><span class="mtk1"> </span><span class="mtk5">&lt;&lt;</span><span class="mtk1"> </span><span class="mtk6">17</span><span class="mtk1">)  </span><span class="mtk3"># check if deg = 16</span>

<span class="mtk1">        </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk1">gen_poly</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk1">used</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk8">print</span><span class="mtk1">(</span><span class="mtk4">"No cheating"</span><span class="mtk1">)</span>
<span class="mtk1">            </span><span class="mtk8">exit</span><span class="mtk1">(</span><span class="mtk6">1</span><span class="mtk1">)</span>

<span class="mtk1">        </span><span class="mtk1">used</span><span class="mtk1">.</span><span class="mtk8">add</span><span class="mtk1">(</span><span class="mtk1">gen_poly</span><span class="mtk1">)</span>

<span class="mtk1">        </span><span class="mtk8">print</span><span class="mtk1">(</span><span class="mtk8">oracle</span><span class="mtk1">(</span><span class="mtk1">key</span><span class="mtk1">, </span><span class="mtk1">gen_poly</span><span class="mtk1">))</span>

<span class="mtk8">main</span><span class="mtk1">()</span>
</code></pre></div><h2 id="análisis-del-código-fuente">Análisis del código fuente</h2><p>Básicamente, crea una clave aleatoria de 512 bits que se utiliza para cifrar la <em>flag</em> con AES y se nos da la <em>flag</em> cifrada. La clave de AES se genera a partir del <em>hash</em> SHA256 de la clave, por lo que necesitamos encontrar la clave de 512 bits para descifrar la <em>flag</em>:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">main</span><span class="mtk1">():</span>
<span class="mtk1">    </span><span class="mtk1">key</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">secrets</span><span class="mtk1">.</span><span class="mtk8">randbits</span><span class="mtk1">(</span><span class="mtk6">512</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">cipher</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">AES</span><span class="mtk1">.</span><span class="mtk8">new</span><span class="mtk1">(</span><span class="mtk8">sha256</span><span class="mtk1">(</span><span class="mtk8">long_to_bytes</span><span class="mtk1">(</span><span class="mtk1">key</span><span class="mtk1">)).</span><span class="mtk8">digest</span><span class="mtk1">()[:</span><span class="mtk6">16</span><span class="mtk1">], </span><span class="mtk8 mtku">AES</span><span class="mtk1">.</span><span class="mtk1">MODE_CTR</span><span class="mtk1">, </span><span class="mtk9 mtki">nonce</span><span class="mtk5">=</span><span class="mtk7 mtki">b</span><span class="mtk4">"12345678"</span><span class="mtk1">)</span>  
<span class="mtk1">    </span><span class="mtk1">enc_flag</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">cipher</span><span class="mtk1">.</span><span class="mtk8">encrypt</span><span class="mtk1">(</span><span class="mtk6">FLAG</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk8">print</span><span class="mtk1">(</span><span class="mtk7 mtki">f</span><span class="mtk4">"Encrypted flag: </span><span class="mtk6">{</span><span class="mtk1">enc_flag</span><span class="mtk1">.</span><span class="mtk8">hex</span><span class="mtk1">()</span><span class="mtk6">}</span><span class="mtk4">"</span><span class="mtk1">)</span>
</code></pre></div><p>El servidor nos permite calcular el CRC (<em>Cyclic Redundancy Check</em>) de la clave de 512 bits con cualquier polinomio de grado 16 (representado por un número entero de 16 bits). En concreto, estamos ante CRC-16, ya que la salida será un número de 16 bits:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">    </span><span class="mtk1">used</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">set</span><span class="mtk1">({})</span>

<span class="mtk1">    </span><span class="mtk5">while</span><span class="mtk1"> </span><span class="mtk6">True</span><span class="mtk1">:</span>
<span class="mtk1">        </span><span class="mtk1">gen_poly</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">int</span><span class="mtk1">(</span><span class="mtk8">input</span><span class="mtk1">(</span><span class="mtk4">"Give me your generator polynomial: "</span><span class="mtk1">))</span>
<span class="mtk1">        </span><span class="mtk5">assert</span><span class="mtk1"> (</span><span class="mtk6">1</span><span class="mtk1"> </span><span class="mtk5">&lt;&lt;</span><span class="mtk1"> </span><span class="mtk6">16</span><span class="mtk1">) </span><span class="mtk5">&lt;=</span><span class="mtk1"> </span><span class="mtk1">gen_poly</span><span class="mtk1"> </span><span class="mtk5">&lt;</span><span class="mtk1"> (</span><span class="mtk6">1</span><span class="mtk1"> </span><span class="mtk5">&lt;&lt;</span><span class="mtk1"> </span><span class="mtk6">17</span><span class="mtk1">)  </span><span class="mtk3"># check if deg = 16</span>  

<span class="mtk1">        </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk1">gen_poly</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk1">used</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk8">print</span><span class="mtk1">(</span><span class="mtk4">"No cheating"</span><span class="mtk1">)</span>
<span class="mtk1">            </span><span class="mtk8">exit</span><span class="mtk1">(</span><span class="mtk6">1</span><span class="mtk1">)</span>

<span class="mtk1">        </span><span class="mtk1">used</span><span class="mtk1">.</span><span class="mtk8">add</span><span class="mtk1">(</span><span class="mtk1">gen_poly</span><span class="mtk1">)</span>

<span class="mtk1">        </span><span class="mtk8">print</span><span class="mtk1">(</span><span class="mtk8">oracle</span><span class="mtk1">(</span><span class="mtk1">key</span><span class="mtk1">, </span><span class="mtk1">gen_poly</span><span class="mtk1">))</span>
</code></pre></div><p>Desafortunadamente, el servidor no devuelve sólo el código CRC de la clave, sino dos valores aleatorios adicionales:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">oracle</span><span class="mtk1">(</span><span class="mtk9 mtki">secret</span><span class="mtk1">, </span><span class="mtk9 mtki">gen_poly</span><span class="mtk1">):</span>
<span class="mtk1">    </span><span class="mtk1">res</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> [</span><span class="mtk8 mtku">secrets</span><span class="mtk1">.</span><span class="mtk8">randbits</span><span class="mtk1">(</span><span class="mtk6">16</span><span class="mtk1">) </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">_</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8 mtku">range</span><span class="mtk1">(</span><span class="mtk6">3</span><span class="mtk1">)] </span>
<span class="mtk1">    </span><span class="mtk1">res</span><span class="mtk1">[</span><span class="mtk8 mtku">secrets</span><span class="mtk1">.</span><span class="mtk8">randbelow</span><span class="mtk1">(</span><span class="mtk6">3</span><span class="mtk1">)] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">getCRC16</span><span class="mtk1">(</span><span class="mtk9 mtki">secret</span><span class="mtk1">, </span><span class="mtk9 mtki">gen_poly</span><span class="mtk1">)</span>  
<span class="mtk1">    </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk1">res</span>
</code></pre></div><p>El algoritmo del CRC-16 es correcto:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">getCRC16</span><span class="mtk1">(</span><span class="mtk9 mtki">msg</span><span class="mtk1">, </span><span class="mtk9 mtki">gen_poly</span><span class="mtk1">):</span>
<span class="mtk1">    </span><span class="mtk5">assert</span><span class="mtk1"> (</span><span class="mtk6">1</span><span class="mtk1"> </span><span class="mtk5">&lt;&lt;</span><span class="mtk1"> </span><span class="mtk6">16</span><span class="mtk1">) </span><span class="mtk5">&lt;=</span><span class="mtk1"> </span><span class="mtk9 mtki">gen_poly</span><span class="mtk1"> </span><span class="mtk5">&lt;</span><span class="mtk1"> (</span><span class="mtk6">1</span><span class="mtk1"> </span><span class="mtk5">&lt;&lt;</span><span class="mtk1"> </span><span class="mtk6">17</span><span class="mtk1">)  </span><span class="mtk3"># check if deg = 16</span>  
<span class="mtk1">    </span><span class="mtk1">msglen</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk9 mtki">msg</span><span class="mtk1">.bit_length()</span>

<span class="mtk1">    </span><span class="mtk9 mtki">msg</span><span class="mtk1"> </span><span class="mtk5">&lt;&lt;=</span><span class="mtk1"> </span><span class="mtk6">16</span>
<span class="mtk1">    </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">i</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8 mtku">range</span><span class="mtk1">(</span><span class="mtk1">msglen</span><span class="mtk1"> </span><span class="mtk5">-</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">, </span><span class="mtk5">-</span><span class="mtk6">1</span><span class="mtk1">, </span><span class="mtk5">-</span><span class="mtk6">1</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk5">if</span><span class="mtk1"> (</span><span class="mtk9 mtki">msg</span><span class="mtk1"> </span><span class="mtk5">&gt;&gt;</span><span class="mtk1"> (</span><span class="mtk1">i</span><span class="mtk1"> </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">16</span><span class="mtk1">)) </span><span class="mtk5">&amp;</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk9 mtki">msg</span><span class="mtk1"> </span><span class="mtk5">^=</span><span class="mtk1"> (</span><span class="mtk9 mtki">gen_poly</span><span class="mtk1"> </span><span class="mtk5">&lt;&lt;</span><span class="mtk1"> </span><span class="mtk1">i</span><span class="mtk1">)</span>

<span class="mtk1">    </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk9 mtki">msg</span>
</code></pre></div><h2 id="crc">CRC</h2><p>Al leer sobre CRC, descubrí que tenía mucha relación con el Álgebra. De hecho, el código CRC es el resto de dividir los datos de entrada entre el polinomio generador. Si codificamos los bits de cada número como un polinomio con coeficientes en $\mathbb{F}_2$, el CRC es equivalente a calcular:</p><p class="scroll">$$
c(x) = x^N \cdot k(x) \mod{p(x)}
$$</p><p>Donde, $c(x)$ es el código CRC (la salida), $k(x)$ son los datos de entrada (la clave), $N = 16$ (CRC-16) y $p(x)$ es el polinomio generador.</p><h3 id="intuición">Intuición</h3><p>Suponiendo que sabemos qué salida es el código CRC real y qué salidas son aleatorias, podríamos construir un sistema de congruencias como este:</p><p class="scroll">$$
\begin{cases}
x^N \cdot k(x) \equiv c_1(x) \pmod{p_1(x)} \\\\
x^N \cdot k(x) \equiv c_2(x) \pmod{p_2(x)} \\\\
\dots \\\\
x^N \cdot k(x) \equiv c_n(x) \pmod{p_n(x)}
\end{cases}
$$</p><p>El sistema de congruencias anterior debería resultar familiar&mldr; Se puede resolver usando el Teorema Chino del Resto (CRT), pero usando polinomios en $\mathbb{F}_2[x]$ en lugar de números enteros. La solución será un polinomio</p><p class="scroll">$$
x^N \cdot k(x) \mod{\prod_{i=1}^n p_i(x)}
$$</p><p>Si $\prod_{i=1}^n p_i(x)$ es suficientemente grande (en $\mathbb{F}_2[x]$ esto equivale a que el grado del polinomio sea suficientemente grande), entonces $x^N \cdot k(x)$ será un polinomio de grado $N + 511$ (la clave tiene 512 bits, por lo que el polinomio asociado tiene grado 511).</p><h2 id="solución">Solución</h2><p>Entonces, vamos a programar la solución en Python y SageMath. Comenzaremos definiendo algunas funciones auxiliares:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">x</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> PolynomialRing(GF(</span><span class="mtk6">2</span><span class="mtk1">), </span><span class="mtk9 mtki">names</span><span class="mtk5">=</span><span class="mtk4">'x'</span><span class="mtk1">).gens()[</span><span class="mtk6">0</span><span class="mtk1">]</span>


<span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">num_to_poly</span><span class="mtk1">(</span><span class="mtk9 mtki">num</span><span class="mtk1">):</span>
<span class="mtk1">    </span><span class="mtk1">i</span><span class="mtk1">, </span><span class="mtk1">poly</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">, </span><span class="mtk6">0</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1"> </span><span class="mtk1">x</span>

<span class="mtk1">    </span><span class="mtk5">while</span><span class="mtk1"> </span><span class="mtk9 mtki">num</span><span class="mtk1"> </span><span class="mtk5">&gt;&gt;</span><span class="mtk1"> </span><span class="mtk1">i</span><span class="mtk1">:</span>
<span class="mtk1">        </span><span class="mtk1">poly</span><span class="mtk1"> </span><span class="mtk5">+=</span><span class="mtk1"> ((</span><span class="mtk9 mtki">num</span><span class="mtk1"> </span><span class="mtk5">&gt;&gt;</span><span class="mtk1"> </span><span class="mtk1">i</span><span class="mtk1">) </span><span class="mtk5">&amp;</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">) </span><span class="mtk5">*</span><span class="mtk1"> </span><span class="mtk1">x</span><span class="mtk1"> </span><span class="mtk5">**</span><span class="mtk1"> </span><span class="mtk1">i</span>
<span class="mtk1">        </span><span class="mtk1">i</span><span class="mtk1"> </span><span class="mtk5">+=</span><span class="mtk1"> </span><span class="mtk6">1</span>

<span class="mtk1">    </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk1">poly</span>


<span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">get_crc</span><span class="mtk1">(</span><span class="mtk9 mtki">poly</span><span class="mtk1">):</span>
<span class="mtk1">    </span><span class="mtk1">io</span><span class="mtk1">.</span><span class="mtk8">sendlineafter</span><span class="mtk1">(</span><span class="mtk7 mtki">b</span><span class="mtk4">'Give me your generator polynomial: '</span><span class="mtk1">, </span><span class="mtk8 mtku">str</span><span class="mtk1">(</span><span class="mtk9 mtki">poly</span><span class="mtk1">).</span><span class="mtk8">encode</span><span class="mtk1">())</span>  
<span class="mtk1">    </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk8">eval</span><span class="mtk1">(</span><span class="mtk1">io</span><span class="mtk1">.</span><span class="mtk8">recvline</span><span class="mtk1">().</span><span class="mtk8">decode</span><span class="mtk1">())</span>
</code></pre></div><h3 id="sin-aleatoriedad">Sin aleatoriedad</h3><p>Ahora, modificaremos el <em>script</em> del reto para poner el código CRC verdadero en el índice <code>1</code> de la lista:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">oracle</span><span class="mtk1">(</span><span class="mtk9 mtki">secret</span><span class="mtk1">, </span><span class="mtk9 mtki">gen_poly</span><span class="mtk1">):</span>
<span class="mtk1">    </span><span class="mtk1">res</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> [</span><span class="mtk8 mtku">secrets</span><span class="mtk1">.</span><span class="mtk8">randbits</span><span class="mtk1">(</span><span class="mtk6">16</span><span class="mtk1">) </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">_</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8 mtku">range</span><span class="mtk1">(</span><span class="mtk6">3</span><span class="mtk1">)] </span>  
<span class="mtk1">    </span><span class="mtk1">res</span><span class="mtk1">[</span><span class="mtk6">1</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">getCRC16</span><span class="mtk1">(</span><span class="mtk9 mtki">secret</span><span class="mtk1">, </span><span class="mtk9 mtki">gen_poly</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk1">res</span>
</code></pre></div><p>Entonces, sabemos exactamente dónde está el código CRC correcto y podemos intentar resolver el reto usando el CRT:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">io</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">process</span><span class="mtk1">([</span><span class="mtk4">'python3'</span><span class="mtk1">, </span><span class="mtk4">'chall copy.py'</span><span class="mtk1">])</span>
<span class="mtk1">io</span><span class="mtk1">.</span><span class="mtk8">recvuntil</span><span class="mtk1">(</span><span class="mtk7 mtki">b</span><span class="mtk4">'Encrypted flag: '</span><span class="mtk1">)</span>
<span class="mtk1">enc_flag</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">bytes</span><span class="mtk1">.</span><span class="mtk8">fromhex</span><span class="mtk1">(</span><span class="mtk1">io</span><span class="mtk1">.</span><span class="mtk8">recvline</span><span class="mtk1">().</span><span class="mtk8">decode</span><span class="mtk1">())</span>

<span class="mtk1">res</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">num_to_poly</span><span class="mtk1">(</span><span class="mtk6">0</span><span class="mtk1">)</span>
<span class="mtk1">poly</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">2</span><span class="mtk1"> </span><span class="mtk5">**</span><span class="mtk1"> </span><span class="mtk6">16</span>

<span class="mtk1">crcs</span><span class="mtk1">, </span><span class="mtk1">polys</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> [], []</span>

<span class="mtk5">while</span><span class="mtk1"> (</span><span class="mtk1">res</span><span class="mtk1"> </span><span class="mtk5">//</span><span class="mtk1"> (</span><span class="mtk1">x</span><span class="mtk1"> </span><span class="mtk5">**</span><span class="mtk1"> </span><span class="mtk6">16</span><span class="mtk1">)).degree() </span><span class="mtk5">&lt;</span><span class="mtk1"> </span><span class="mtk6">511</span><span class="mtk1"> </span><span class="mtk5">and</span><span class="mtk1"> </span><span class="mtk1">poly</span><span class="mtk1"> </span><span class="mtk5">&lt;</span><span class="mtk1"> </span><span class="mtk6">2</span><span class="mtk1"> </span><span class="mtk5">**</span><span class="mtk1"> </span><span class="mtk6">16</span><span class="mtk1"> </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">50</span><span class="mtk1">:</span>  
<span class="mtk1">    </span><span class="mtk1">crc</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">get_crc</span><span class="mtk1">(</span><span class="mtk1">poly</span><span class="mtk1">)[</span><span class="mtk6">1</span><span class="mtk1">]</span>
<span class="mtk1">    </span><span class="mtk1">crcs</span><span class="mtk1">.</span><span class="mtk8">append</span><span class="mtk1">(</span><span class="mtk8">num_to_poly</span><span class="mtk1">(</span><span class="mtk1">crc</span><span class="mtk1">))</span>
<span class="mtk1">    </span><span class="mtk1">polys</span><span class="mtk1">.</span><span class="mtk8">append</span><span class="mtk1">(</span><span class="mtk8">num_to_poly</span><span class="mtk1">(</span><span class="mtk1">poly</span><span class="mtk1">))</span>

<span class="mtk1">    </span><span class="mtk5">try</span><span class="mtk1">:</span>
<span class="mtk1">        </span><span class="mtk1">res</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> CRT(</span><span class="mtk1">crcs</span><span class="mtk1">, </span><span class="mtk1">polys</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk1">res</span><span class="mtk1"> </span><span class="mtk5">%</span><span class="mtk1"> (</span><span class="mtk1">x</span><span class="mtk1"> </span><span class="mtk5">**</span><span class="mtk1"> </span><span class="mtk6">16</span><span class="mtk1">) </span><span class="mtk5">!=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk1">io</span><span class="mtk1">.</span><span class="mtk8">failure</span><span class="mtk1">(</span><span class="mtk4">'This should not happen'</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk5">except</span><span class="mtk1"> </span><span class="mtk8 mtku">ValueError</span><span class="mtk1"> </span><span class="mtk5">as</span><span class="mtk1"> </span><span class="mtk1">e</span><span class="mtk1">:</span>
<span class="mtk1">        </span><span class="mtk1">io</span><span class="mtk1">.</span><span class="mtk8">failure</span><span class="mtk1">(</span><span class="mtk4">'This should not be reached'</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk5">pass</span>

<span class="mtk1">    </span><span class="mtk1">poly</span><span class="mtk1"> </span><span class="mtk5">+=</span><span class="mtk1"> </span><span class="mtk6">1</span>

<span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk1">poly</span><span class="mtk1"> </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">2</span><span class="mtk1"> </span><span class="mtk5">**</span><span class="mtk1"> </span><span class="mtk6">16</span><span class="mtk1"> </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">50</span><span class="mtk1">:</span>
<span class="mtk1">    </span><span class="mtk1">io</span><span class="mtk1">.</span><span class="mtk8">failure</span><span class="mtk1">(</span><span class="mtk4">'FAIL'</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk8">exit</span><span class="mtk1">(<span class="mtk6">1</span>)</span>
</code></pre></div><p>Si se encuentra la solución, entonces debemos dividir por $x^N$ y tomar los coeficientes del polinomio, que deberían ser los 512 bits de la clave utilizada para generar la clave de AES:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">res</span><span class="mtk1"> </span><span class="mtk5">//=</span><span class="mtk1"> </span><span class="mtk1">x</span><span class="mtk1"> </span><span class="mtk5">**</span><span class="mtk1"> </span><span class="mtk6">16</span>
<span class="mtk1">io</span><span class="mtk1">.</span><span class="mtk8">info</span><span class="mtk1">(</span><span class="mtk7 mtki">f</span><span class="mtk4">'Total results needed: </span><span class="mtk6">{</span><span class="mtk8">len</span><span class="mtk1">(</span><span class="mtk1">polys</span><span class="mtk1">)</span><span class="mtk6">}</span><span class="mtk4">'</span><span class="mtk1">)</span>
<span class="mtk1">coeffs</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">list</span><span class="mtk1">(</span><span class="mtk8 mtku">reversed</span><span class="mtk1">(</span><span class="mtk1">res</span><span class="mtk1">.coefficients(</span><span class="mtk9 mtki">sparse</span><span class="mtk5">=</span><span class="mtk6">False</span><span class="mtk1">)))</span>
<span class="mtk1">coeffs</span><span class="mtk1"> </span><span class="mtk5">+=</span><span class="mtk1"> [</span><span class="mtk6">0</span><span class="mtk1">] </span><span class="mtk5">*</span><span class="mtk1"> (</span><span class="mtk6">512</span><span class="mtk1"> </span><span class="mtk5">-</span><span class="mtk1"> </span><span class="mtk8">len</span><span class="mtk1">(</span><span class="mtk1">coeffs</span><span class="mtk1">))</span>
<span class="mtk1">key</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">int</span><span class="mtk1">(</span><span class="mtk4">''</span><span class="mtk1">.</span><span class="mtk8">join</span><span class="mtk1">(</span><span class="mtk8 mtku">map</span><span class="mtk1">(</span><span class="mtk8 mtku">str</span><span class="mtk1">, </span><span class="mtk1">coeffs</span><span class="mtk1">)), </span><span class="mtk6">2</span><span class="mtk1">)</span>

<span class="mtk1">cipher</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">AES</span><span class="mtk1">.</span><span class="mtk8">new</span><span class="mtk1">(</span><span class="mtk8">sha256</span><span class="mtk1">(</span><span class="mtk8">long_to_bytes</span><span class="mtk1">(</span><span class="mtk1">key</span><span class="mtk1">)).</span><span class="mtk8">digest</span><span class="mtk1">()[:</span><span class="mtk6">16</span><span class="mtk1">], </span><span class="mtk8 mtku">AES</span><span class="mtk1">.</span><span class="mtk1">MODE_CTR</span><span class="mtk1">, </span><span class="mtk9 mtki">nonce</span><span class="mtk5">=</span><span class="mtk7 mtki">b</span><span class="mtk4">'12345678'</span><span class="mtk1">)</span>  
<span class="mtk1">io</span><span class="mtk1">.</span><span class="mtk8">success</span><span class="mtk1">(</span><span class="mtk1">cipher</span><span class="mtk1">.</span><span class="mtk8">decrypt</span><span class="mtk1">(</span><span class="mtk1">enc_flag</span><span class="mtk1">).</span><span class="mtk8">decode</span><span class="mtk1">())</span>
</code></pre></div><p>Con este <em>script</em>, podemos encontrar la <em>flag</em> de prueba con nuestra versión modificada del reto:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-yellow">while</span> <span class="code-dark-green">true</span>; <span class="code-dark-yellow">do</span> <span class="code-dark-green">python3</span> <span class="mtku">solve_no_random.py</span> && <span class="code-dark-green">break</span>; <span class="code-dark-yellow">done</span>  
[<span class="code-green">+</span>] Starting local process '/usr/bin/python3': pid 2871946
[<span class="code-red">-</span>] FAIL
[<span class="code-blue">*</span>] Stopped process '/usr/bin/python3' (pid 2871946)
[<span class="code-green">+</span>] Starting local process '/usr/bin/python3': pid 2871975
[<span class="code-blue">*</span>] Total results needed: 44
[<span class="code-green">+</span>] SEKAI{flag}
[<span class="code-blue">*</span>] Stopped process '/usr/bin/python3' (pid 2871975)
</code></pre></div><p>El valor <em>hard-coded</em> <code>2 ** 16 + 50</code> viene de saber que el número de consultas necesarias para encontrar una solución es de 44, para evitar iteraciones innecesarias.</p><h3 id="adaptación">Adaptación</h3><p>Ahora que sabemos que el reto se puede resolver cuando sabemos dónde está el código CRC, debemos encontrar una manera de determinar todos los códigos CRC correctos a partir de las listas de tres valores (dos aleatorios y uno válido).</p><p>Después de resolver la serie de retos de <a target="_blank" href="../cryptography-1-2-3">cryptoGRAPHy</a>, estaba muy metido en la teoría de grafos. Dado que solo uno de cada tres resultados es válido y necesitamos al menos 44 resultados correctos, pensé en usar un algoritmo de búsqueda como búsqueda en profundidad (DFS) o búsqueda en anchura (BFS). Sin embargo, fueron difíciles de implementar porque los tres nodos (las tres salidas) de un paso están conectados con los tres nodos del siguiente paso, y no hay una manera clara de determinar si un nodo ha sido visitado o no, y cómo determinar los nodos adyacentes y validar si la ruta se mantiene&mldr;</p><p>Estaba tratando de evitar hacer un enfoque de fuerza bruta, porque eso sería un máximo de $3^{44}$ posibilidades, lo cual no es asequible. Sin embargo, podemos comenzar con fuerza bruta y cortar un camino siempre que el resultado del CRT no sea válido o no exista (en realidad, esto es una especie de DFS).</p><p>Pongamos un ejemplo donde la ruta correcta es <code>[0, 2, 1]</code>: Empezamos a probar con <code>[0, 0]</code>. Si el CRT es válido, entonces continuamos por <code>[0, 0, 0]</code>, <code>[0, 0, 1]</code> y <code>[0, 0, 2]</code>; de lo contrario, saltaríamos directamente a <code>[0, 1]</code> y luego a <code>[0, 1, 0]</code>, <code>[0, 1, 1]</code> y <code>[0, 1, 2]</code>. Digamos que <code>[0, 1, 1]</code> da un CRT correcto, así que lo guardaremos en una lista. Al final, probaremos todas las combinaciones posibles (eliminando las que ya no son posibles) y obtendremos una lista de resultados válidos (que incluye la combinación que contiene los índices de los códigos CRC verdaderos).</p><p>Este es el código relevante para este enfoque:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">brute_force</span><span class="mtk1">(</span><span class="mtk9 mtki">valid</span><span class="mtk1">, </span><span class="mtk9 mtki">index</span><span class="mtk1">):</span>
<span class="mtk1">    </span><span class="mtk1">new_valid</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> []</span>

<span class="mtk1">    </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">crc_list</span><span class="mtk1">, </span><span class="mtk1">poly_list</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk9 mtki">valid</span><span class="mtk1">:</span>
<span class="mtk1">        </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">crc</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk1">queries</span><span class="mtk1">[</span><span class="mtk9 mtki">index</span><span class="mtk1">]:</span>
<span class="mtk1">            </span><span class="mtk1">new_crc_list</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">crc_list</span><span class="mtk1"> </span><span class="mtk5">+</span><span class="mtk1"> [</span><span class="mtk8">num_to_poly</span><span class="mtk1">(</span><span class="mtk1">crc</span><span class="mtk1">)]</span>
<span class="mtk1">            </span><span class="mtk1">new_poly_list</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">poly_list</span><span class="mtk1"> </span><span class="mtk5">+</span><span class="mtk1"> [</span><span class="mtk8">num_to_poly</span><span class="mtk1">(</span><span class="mtk6">2</span><span class="mtk1"> </span><span class="mtk5">**</span><span class="mtk1"> </span><span class="mtk6">16</span><span class="mtk1"> </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk9 mtki">index</span><span class="mtk1">)]</span>
<span class="mtk1">            </span><span class="mtk5">try</span><span class="mtk1">:</span>
<span class="mtk1">                CRT(</span><span class="mtk1">new_crc_list</span><span class="mtk1">, </span><span class="mtk1">new_poly_list</span><span class="mtk1">)</span>
<span class="mtk1">                </span><span class="mtk1">new_valid</span><span class="mtk1">.</span><span class="mtk8">append</span><span class="mtk1">((</span><span class="mtk1">new_crc_list</span><span class="mtk1">, </span><span class="mtk1">new_poly_list</span><span class="mtk1">))</span>
<span class="mtk1">            </span><span class="mtk5">except</span><span class="mtk1"> </span><span class="mtk8 mtku">ValueError</span><span class="mtk1">:</span>
<span class="mtk1">                </span><span class="mtk5">continue</span>

<span class="mtk1">    </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk1">new_valid</span>


<span class="mtk1">valid_queries</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> [</span>
<span class="mtk1">    ([</span><span class="mtk8">num_to_poly</span><span class="mtk1">(</span><span class="mtk1">queries</span><span class="mtk1">[</span><span class="mtk6">0</span><span class="mtk1">][</span><span class="mtk6">0</span><span class="mtk1">])], [</span><span class="mtk8">num_to_poly</span><span class="mtk1">(</span><span class="mtk6">2</span><span class="mtk1"> </span><span class="mtk5">**</span><span class="mtk1"> </span><span class="mtk6">16</span><span class="mtk1">)]),</span>
<span class="mtk1">    ([</span><span class="mtk8">num_to_poly</span><span class="mtk1">(</span><span class="mtk1">queries</span><span class="mtk1">[</span><span class="mtk6">0</span><span class="mtk1">][</span><span class="mtk6">1</span><span class="mtk1">])], [</span><span class="mtk8">num_to_poly</span><span class="mtk1">(</span><span class="mtk6">2</span><span class="mtk1"> </span><span class="mtk5">**</span><span class="mtk1"> </span><span class="mtk6">16</span><span class="mtk1">)]),</span>
<span class="mtk1">    ([</span><span class="mtk8">num_to_poly</span><span class="mtk1">(</span><span class="mtk1">queries</span><span class="mtk1">[</span><span class="mtk6">0</span><span class="mtk1">][</span><span class="mtk6">2</span><span class="mtk1">])], [</span><span class="mtk8">num_to_poly</span><span class="mtk1">(</span><span class="mtk6">2</span><span class="mtk1"> </span><span class="mtk5">**</span><span class="mtk1"> </span><span class="mtk6">16</span><span class="mtk1">)])</span>
<span class="mtk1">]</span>

<span class="mtk1">round_prog</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">io</span><span class="mtk1">.</span><span class="mtk8">progress</span><span class="mtk1">(</span><span class="mtk4">'Round'</span><span class="mtk1">)</span>

<span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">r</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8 mtku">range</span><span class="mtk1">(</span><span class="mtk6">1</span><span class="mtk1">, </span><span class="mtk6">44</span><span class="mtk1">):</span>
<span class="mtk1">    </span><span class="mtk1">valid_queries</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">brute_force</span><span class="mtk1">(</span><span class="mtk1">valid_queries</span><span class="mtk1">, </span><span class="mtk1">r</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">round_prog</span><span class="mtk1">.</span><span class="mtk8">status</span><span class="mtk1">(</span><span class="mtk7 mtki">f</span><span class="mtk4">'</span><span class="mtk6">{</span><span class="mtk1">r</span><span class="mtk1"> </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">1}</span><span class="mtk4"> / 44. Current amount: </span><span class="mtk6">{</span><span class="mtk8">len</span><span class="mtk1">(</span><span class="mtk1">valid_queries</span><span class="mtk1">)</span><span class="mtk6">}</span><span class="mtk4">'</span><span class="mtk1">)</span>  
<span class="mtk1">    </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk8">len</span><span class="mtk1">(</span><span class="mtk1">valid_queries</span><span class="mtk1">) </span><span class="mtk5">&gt;</span><span class="mtk1"> </span><span class="mtk6">10000</span><span class="mtk1">:</span>
<span class="mtk1">        </span><span class="mtk1">round_prog</span><span class="mtk1">.</span><span class="mtk8">failure</span><span class="mtk1">()</span>
<span class="mtk1">        </span><span class="mtk8">exit</span><span class="mtk1">(</span><span class="mtk6">1</span><span class="mtk1">)</span>
</code></pre></div><p>Luego, sólo necesitamos tomar las listas válidas (una de ellas debería ser la que tenga todos los códigos CRC verdaderos) e intentar obtener la clave de AES a partir de los 512 coeficientes del polinomio resultado del CRT para descifrar la <em>flag</em>:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">crc_list</span><span class="mtk1">, </span><span class="mtk1">poly_list</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk1">valid_queries</span><span class="mtk1">:</span>
<span class="mtk1">    </span><span class="mtk1">res</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> CRT(</span><span class="mtk1">crc_list</span><span class="mtk1">, </span><span class="mtk1">poly_list</span><span class="mtk1">)</span>

<span class="mtk1">    </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk1">res</span><span class="mtk1"> </span><span class="mtk5">%</span><span class="mtk1"> (</span><span class="mtk1">x</span><span class="mtk1"> </span><span class="mtk5">**</span><span class="mtk1"> </span><span class="mtk6">16</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk5">continue</span>

<span class="mtk1">    </span><span class="mtk1">res</span><span class="mtk1"> </span><span class="mtk5">//=</span><span class="mtk1"> </span><span class="mtk1">x</span><span class="mtk1"> </span><span class="mtk5">**</span><span class="mtk1"> </span><span class="mtk6">16</span>

<span class="mtk1">    </span><span class="mtk1">coeffs</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">list</span><span class="mtk1">(</span><span class="mtk8 mtku">reversed</span><span class="mtk1">(</span><span class="mtk1">res</span><span class="mtk1">.coefficients(</span><span class="mtk9 mtki">sparse</span><span class="mtk5">=</span><span class="mtk6">False</span><span class="mtk1">)))</span>
<span class="mtk1">    </span><span class="mtk1">coeffs</span><span class="mtk1"> </span><span class="mtk5">+=</span><span class="mtk1"> [</span><span class="mtk6">0</span><span class="mtk1">] </span><span class="mtk5">*</span><span class="mtk1"> (</span><span class="mtk6">512</span><span class="mtk1"> </span><span class="mtk5">-</span><span class="mtk1"> </span><span class="mtk8">len</span><span class="mtk1">(</span><span class="mtk1">coeffs</span><span class="mtk1">))</span>
<span class="mtk1">    </span><span class="mtk1">key</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">int</span><span class="mtk1">(</span><span class="mtk4">''</span><span class="mtk1">.</span><span class="mtk8">join</span><span class="mtk1">(</span><span class="mtk8 mtku">map</span><span class="mtk1">(</span><span class="mtk8 mtku">str</span><span class="mtk1">, </span><span class="mtk1">coeffs</span><span class="mtk1">)), </span><span class="mtk6">2</span><span class="mtk1">)</span>

<span class="mtk1">    </span><span class="mtk1">cipher</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">AES</span><span class="mtk1">.</span><span class="mtk8">new</span><span class="mtk1">(</span><span class="mtk8">sha256</span><span class="mtk1">(</span><span class="mtk8">long_to_bytes</span><span class="mtk1">(</span><span class="mtk1">key</span><span class="mtk1">)).</span><span class="mtk8">digest</span><span class="mtk1">()[:</span><span class="mtk6">16</span><span class="mtk1">], </span><span class="mtk8 mtku">AES</span><span class="mtk1">.</span><span class="mtk1">MODE_CTR</span><span class="mtk1">, </span><span class="mtk9 mtki">nonce</span><span class="mtk5">=</span><span class="mtk7 mtki">b</span><span class="mtk4">'12345678'</span><span class="mtk1">)</span>  
<span class="mtk1">    </span><span class="mtk1">pt</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">cipher</span><span class="mtk1">.</span><span class="mtk8">decrypt</span><span class="mtk1">(</span><span class="mtk1">enc_flag</span><span class="mtk1">)</span>

<span class="mtk1">    </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk7 mtki">b</span><span class="mtk4">'SEKAI'</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk1">pt</span><span class="mtk1">:</span>
<span class="mtk1">        </span><span class="mtk1">io</span><span class="mtk1">.</span><span class="mtk8">success</span><span class="mtk1">(</span><span class="mtk7 mtki">f</span><span class="mtk4">'Flag: </span><span class="mtk6">{</span><span class="mtk1">pt</span><span class="mtk1">.</span><span class="mtk8">decode</span><span class="mtk1">()</span><span class="mtk6">}</span><span class="mtk4">'</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk5">break</span>
<span class="mtk5">else</span><span class="mtk1">:</span>
<span class="mtk1">    </span><span class="mtk1">io</span><span class="mtk1">.</span><span class="mtk8">failure</span><span class="mtk1">(</span><span class="mtk4">'FAIL'</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk8">exit</span><span class="mtk1">(</span><span class="mtk6">1</span><span class="mtk1">)</span>
</code></pre></div><p>Me sorprendió que el enfoque de fuerza bruta / DFS tardara alrededor de 2 minutos cuando se encontraba la respuesta. Sin embargo, estoy bastante seguro de que hay una manera de determinar qué salidas son códigos CRC válidos y cuáles no.</p><h2 id="_flag_"><em>Flag</em></h2><p>De todos modos, podemos ejecutar el <em>script</em> y obtener la <em>flag</em> después de un tiempo:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-yellow">while</span> <span class="code-dark-green">true</span>; <span class="code-dark-yellow">do</span> <span class="code-dark-yellow">time</span> <span class="code-dark-green">python3</span> <span class="mtku">solve.py</span> chals.sekai.team 3005 && <span class="code-dark-green">break</span>; <span class="code-dark-yellow">done</span>
[<span class="code-green">+</span>] Opening connection to chals.sekai.team on port 3005: Done
[<span class="code-blue">*</span>] Closed connection to chals.sekai.team port 3005
[<span class="code-green">+</span>] Round: 44 / 44. Current amount: 4608
[<span class="code-red">-</span>] FAIL
python3 solve.py chals.sekai.team 3005  116,84s user 0,63s system 96% cpu 2:01,11 total  
[<span class="code-green">+</span>] Opening connection to chals.sekai.team on port 3005: Done
[<span class="code-blue">*</span>] Closed connection to chals.sekai.team port 3005
[<span class="code-green">+</span>] Round: 44 / 44. Current amount: 864
[<span class="code-red">-</span>] FAIL
python3 solve.py chals.sekai.team 3005  52,71s user 0,58s system 93% cpu 57,000 total
[<span class="code-green">+</span>] Opening connection to chals.sekai.team on port 3005: Done
[<span class="code-blue">*</span>] Closed connection to chals.sekai.team port 3005
[<span class="code-red">-</span>] Round: Failed
python3 solve.py chals.sekai.team 3005  261,03s user 0,72s system 98% cpu 4:25,42 total
[<span class="code-green">+</span>] Opening connection to chals.sekai.team on port 3005: Done
[<span class="code-blue">*</span>] Closed connection to chals.sekai.team port 3005
[<span class="code-green">+</span>] Round: 44 / 44. Current amount: 2916
[<span class="code-green">+</span>] Flag: SEKAI{CrCrCRcRCRcrcrcRCrCrC}
python3 solve.py chals.sekai.team 3005  72,01s user 0,62s system 95% cpu 1:16,35 total
</code></pre></div><p>El <em>script</em> completo se puede encontrar aquí: <a target="_blank" href="https://github.com/7Rocky/CTF-scripts/tree/main/Sekai%20CTF/Noisy%20CRC/solve.py"><code>solve.py</code></a>.</p><div class="mt6 instapaper_ignoref"></div></div><aside aria-label="aside" class="w-20-l aside-desktop"><div class="bg-card pa3 nested-list-reset nested-copy-line-height nested-links" style="position:sticky;top:5rem;padding-bottom:0"><p class="f5 b pb2" style="border-bottom:5px solid var(--background);margin:0">Contenidos</p><nav id="TableOfContents"><ul><li><a href="#análisis-del-código-fuente">Análisis del código fuente</a></li><li><a href="#crc">CRC</a><ul><li><a href="#intuición">Intuición</a></li></ul></li><li><a href="#solución">Solución</a><ul><li><a href="#sin-aleatoriedad">Sin aleatoriedad</a></li><li><a href="#adaptación">Adaptación</a></li></ul></li><li><a href="#_flag_"><em>Flag</em></a></li></ul></nav><div class="bg-card" style="border-top:5px solid var(--background)"><a class="bmc-btn w-100" target="_blank" href="http://buymeacoffee.com/7Rocky" style="padding:0" title="Buy me a beer">🍺 <span class="bmc-btn-text" style="font-family:Cookie!important;color:#fff">Buy me a beer</span></a></div></div></aside></article></main><footer class="bottom-0 w-100" role="contentinfo"><div class="tc mw8 ph3" style="margin:auto"><form style="background-color:var(--background-card)" class="tc mw8 pv3 mb3" action="https://mailchi.mp/59ffae939360/7rockys-blog-weekly-newsletter" target="popupwindow" onsubmit='return window.open("https://mailchi.mp/59ffae939360/7rockys-blog-weekly-newsletter"),!0'><h3 class="tc">7Rocky's Blog Weekly Newsletter</h3><p class="tc"><input class="f5 pv3 ph3 bn" style="background-color:var(--background);color:inherit;font-weight:700;line-height:normal" type="submit" value="Recibe un resumen semanal del blog"></p><input type="hidden" value="1" name="embed">
<input style="display:none;color:var(--header)" type="submit" value="Suscribirse"><p class="tc"><a href="/en/newsletters/" target="_blank" title="View letter archive">Ver historial de resúmenes</a></p><p class="tc">impulsado por <a href="http://www.mailchimp.com" target="_blank" title="Mailchimp">Mailchimp</a></p></form></div><div class="bg-black w-100 pa3" role="contentinfo"><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://7rocky.github.io/" title="https://7rocky.github.io/">&copy; Blog de 7Rocky. Ciberseguridad y Mates 2024</a><div style="margin-top:8px"><div><div><a href="https://www.linkedin.com/in/roberto-gesteira-minarro/" target="_blank" class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel="noopener" aria-label="follow on LinkedIn——Opens in a new window"><svg height="30" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
<span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</span></a><a href="https://github.com/7Rocky" target="_blank" class="link-transition github link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel="noopener" aria-label="follow on GitHub——Opens in a new window"><svg height="30" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg>
<span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a></div></div></div></div></div></footer></body></html>