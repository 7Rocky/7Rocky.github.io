<!doctype html><html lang="es"><head><title>IRCware | 7Rocky</title>
<meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="author" content="Blog de 7Rocky. Ciberseguridad y Mates"><meta name="description" content="`strace`. Descifrado de contraseña"><meta name="image" content="https://7rocky.github.io/images/reversing.png"><meta name="robots" content="index, follow"><meta name="viewport" content="width=device-width,minimum-scale=1"><meta itemprop="description" content="`strace`. Descifrado de contraseña"><meta itemprop="keywords" content><meta itemprop="name" content="IRCware"><meta property="article:published_time" content><meta property="og:author" content="Blog de 7Rocky. Ciberseguridad y Mates"><meta property="og:description" content="`strace`. Descifrado de contraseña"><meta property="og:image" content="https://7rocky.github.io/images/reversing.png"><meta property="og:locale" content="es_ES"><meta property="og:site_name" content="Blog de 7Rocky. Ciberseguridad y Mates"><meta property="og:title" content="IRCware"><meta property="og:type" content="website"><meta property="og:url" content="https://7rocky.github.io/ctf/htb-challenges/reversing/ircware/"><meta name="twitter:author" content="Blog de 7Rocky. Ciberseguridad y Mates"><meta name="twitter:card" content="`strace`. Descifrado de contraseña"><meta name="twitter:description" content="`strace`. Descifrado de contraseña"><meta name="twitter:image" content="https://7rocky.github.io/images/reversing.png"><meta name="twitter:title" content="IRCware"><link href="/favicon.ico" rel="shortcut icon" type="image/x-icon"><link href="/css/style.css" rel="stylesheet"><link href="/css/main.css" rel="stylesheet"><link href="/css/code.css" rel="stylesheet"><link href="https://7rocky.github.io/ctf/htb-challenges/reversing/ircware/" rel="canonical"><script async src="https://www.googletagmanager.com/gtag/js?id=G-Z1HQGH3M4D"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-Z1HQGH3M4D",{anonymize_ip:!1})}</script></head><body class="ma0 production"><header style="position:sticky;top:0;z-index:9"><div class="bg-black"><nav class="ph4-ns" id="navigation" role="navigation"><div class="flex-l justify-between items-center center"><a class="f3 fw2 hover-white no-underline white-90 dib" href="/" title="7Rocky">7Rocky</a><div class="flex-l items-center"><a href="/search" target class="link-transition link dib z-999 pt3 pt0-l mr1 search-link" title="Buscar" rel="noopener" aria-label="Buscar"><svg height="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 487.95 487.95" style="enable-background:new 0 0 487.95 487.95"><g><g><path d="M481.8 453l-140-140.1c27.6-33.1 44.2-75.4 44.2-121.6C386 85.9 299.5.2 193.1.2S0 86 0 191.4s86.5 191.1 192.9 191.1c45.2.0 86.8-15.5 119.8-41.4l140.5 140.5c8.2 8.2 20.4 8.2 28.6.0C490 473.4 490 461.2 481.8 453zM41 191.4c0-82.8 68.2-150.1 151.9-150.1s151.9 67.3 151.9 150.1-68.2 150.1-151.9 150.1S41 274.1 41 191.4z" style="fill-rule:evenodd;clip-rule:evenodd;fill:#a9a9b3"/></g></g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/></svg></a><a class="link-transition lang link dib z-999 pt3 pt0-l mr3" href="#" title="es"><img alt="es" height="30px" src="/images/es.png" width="30px">
</a><a class="link-transition lang link dib z-999 pt3 pt0-l" href="/en/ctf/htb-challenges/reversing/ircware/" title="en"><img alt="en" height="30px" src="/images/en.png" style="border:4px solid#000;border-radius:100%" width="30px"></a><ul class="pl0 ml3 mr3" style="line-height:30px"><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href="/ctf/" title="CTF">CTF</a></li><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href="/htb/" title="HTB">HTB</a></li><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href="/imc/" title="IMC">IMC</a></li></ul><a href="https://www.linkedin.com/in/roberto-gesteira-minarro/" target="_blank" class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel="noopener" aria-label="follow on LinkedIn——Opens in a new window"><svg height="30" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg><span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a><a href="https://github.com/7Rocky" target="_blank" class="link-transition github link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel="noopener" aria-label="follow on GitHub——Opens in a new window"><svg height="30" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg><span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a></div></div></nav></div></header><main class="pb5" role="main" style="min-height:720px"><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-80-l"><a aria-label="aside" class="instapaper_ignoref b tracked" href="../" style="font-size:1.2rem">&lt;- REVERSING</a><div id="sharing" class="mt3"><a aria-label="share on Facebook" class="facebook no-underline" href="https://www.facebook.com/sharer.php?u=https://7rocky.github.io/ctf/htb-challenges/reversing/ircware/" title="share on Facebook"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765 50.32h6.744V33.998h4.499l.596-5.624h-5.095l.007-2.816c0-1.466.14-2.253 2.244-2.253h2.812V17.68h-4.5c-5.405.0-7.307 2.729-7.307 7.317v3.377h-3.369v5.625h3.369V50.32zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></a><a aria-label="share on Twitter" class="twitter no-underline" href="https://twitter.com/share?url=https://7rocky.github.io/ctf/htb-challenges/reversing/ircware/&amp;text=IRCware" title="share on Twitter"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a><a aria-label="share on LinkedIn" class="linkedin no-underline" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://7rocky.github.io/ctf/htb-challenges/reversing/ircware/&amp;title=IRCware" title="share on LinkedIn"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a></div><h1 class="f1 mt3 mb1">IRCware</h1><p class="mb4 f6 dib tracked">7 minutos de lectura</p></header><aside aria-label="aside" class="w-20-l mt6-l aside-mobile"><div class="bg-card pa3 nested-list-reset nested-copy-line-height nested-links" style="position:sticky;top:5rem;padding-bottom:0"><p class="f5 b pb2" style="border-bottom:5px solid var(--background);margin:0">Contenidos</p><nav id="TableOfContents"><ul><li><a href="#análisis-básico">Análisis básico</a></li><li><a href="#descompilación">Descompilación</a></li><li><a href="#descifrado">Descifrado</a></li><li><a href="#_flag_"><em>Flag</em></a></li></ul></nav><div class="bg-card" style="border-top:5px solid var(--background)"><a class="bmc-btn w-100" target="_blank" href="http://buymeacoffee.com/7Rocky" style="padding:0" title="Buy me a beer">🍺 <span class="bmc-btn-text" style="font-family:Cookie!important;color:#fff">Buy me a beer</span></a></div></div></aside><div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img pr4-l w-80-l"><p>Tenemos un binario llamado <code>ircware</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">file</span> <span class="mtku">ircware</span>
ircware: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, stripped  
</code></pre></div><h2 id="análisis-básico">Análisis básico</h2><p>Si lo abrimos en Ghidra de inmediato, el código en C descompilado será muy difícil de entender porque el binario está despojado de sus símbolos. En su lugar, podemos intentar ejecutarlo:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">./ircware</span>
EXCEPTION! ABORT  
</code></pre></div><p>Bueno, nada útil. Con <code>ltrace</code> podemos registrar todas las llamadas a funciones externas:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">ltrace</span> <span class="mtku">./ircware</span>
EXCEPTION! ABORT+++ exited (status 1) +++  
</code></pre></div><p>De nuevo, inútil. Finalmente, con <code>strace</code> podemos ver todas las llamadas al sistema:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">strace</span> <span class="mtku">./ircware</span>
execve("./ircware", ["./ircware"], 0x7ffc3604c900 /* 35 vars */) = 0
brk(NULL)                               = 0x2415000
arch_prctl(0x3001 /* ARCH_??? */, 0x7ffed94b1390) = -1 EINVAL (Invalid argument)
access("/etc/ld.so.preload", R_OK)      = -1 ENOENT (No such file or directory)
openat(AT_FDCWD, "/etc/ld.so.cache", O_RDONLY|O_CLOEXEC) = 3
fstat(3, {st_mode=S_IFREG|0644, st_size=37355, ...}) = 0
mmap(NULL, 37355, PROT_READ, MAP_PRIVATE, 3, 0) = 0x7f8415efc000
close(3)                                = 0
openat(AT_FDCWD, "/lib/x86_64-linux-gnu/libc.so.6", O_RDONLY|O_CLOEXEC) = 3
read(3, "\177ELF\2\1\1\3\0\0\0\0\0\0\0\0\3\0&gt;\0\1\0\0\0\300A\2\0\0\0\0\0"..., 832) = 832
pread64(3, "\6\0\0\0\4\0\0\0@\0\0\0\0\0\0\0@\0\0\0\0\0\0\0@\0\0\0\0\0\0\0"..., 784, 64) = 784
pread64(3, "\4\0\0\0\20\0\0\0\5\0\0\0GNU\0\2\0\0\300\4\0\0\0\3\0\0\0\0\0\0\0", 32, 848) = 32
pread64(3, "\4\0\0\0\24\0\0\0\3\0\0\0GNU\0\30x\346\264ur\f|Q\226\236i\253-'o"..., 68, 880) = 68
fstat(3, {st_mode=S_IFREG|0755, st_size=2029592, ...}) = 0
mmap(NULL, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7f8415efa000
pread64(3, "\6\0\0\0\4\0\0\0@\0\0\0\0\0\0\0@\0\0\0\0\0\0\0@\0\0\0\0\0\0\0"..., 784, 64) = 784
pread64(3, "\4\0\0\0\20\0\0\0\5\0\0\0GNU\0\2\0\0\300\4\0\0\0\3\0\0\0\0\0\0\0", 32, 848) = 32
pread64(3, "\4\0\0\0\24\0\0\0\3\0\0\0GNU\0\30x\346\264ur\f|Q\226\236i\253-'o"..., 68, 880) = 68
mmap(NULL, 2037344, PROT_READ, MAP_PRIVATE|MAP_DENYWRITE, 3, 0) = 0x7f8415d08000
mmap(0x7f8415d2a000, 1540096, PROT_READ|PROT_EXEC, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x22000) = 0x7f8415d2a000
mmap(0x7f8415ea2000, 319488, PROT_READ, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x19a000) = 0x7f8415ea2000
mmap(0x7f8415ef0000, 24576, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x1e7000) = 0x7f8415ef0000
mmap(0x7f8415ef6000, 13920, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOUS, -1, 0) = 0x7f8415ef6000
close(3)                                = 0
arch_prctl(ARCH_SET_FS, 0x7f8415efb4c0) = 0
mprotect(0x7f8415ef0000, 16384, PROT_READ) = 0
mprotect(0x600000, 4096, PROT_READ)     = 0
mprotect(0x7f8415f33000, 4096, PROT_READ) = 0
munmap(0x7f8415efc000, 37355)           = 0
getrandom("\x19\x21\xd8\x33", 4, 0)     = 4
socket(AF_INET, SOCK_STREAM, IPPROTO_IP) = 3
connect(3, {sa_family=AF_INET, sin_port=htons(8000), sin_addr=inet_addr("127.0.0.1")}, 16) = -1 ECONNREFUSED (Connection refused)  
write(1, "EXCEPTION! ABORT\0", 17EXCEPTION! ABORT)      = 17
exit(1)                                 = ?
+++ exited with 1 +++
</code></pre></div><p>Como se puede ver, el programa está tratando de conectarse a <code>127.0.0.1:8000</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight">connect(3, {sa_family=AF_INET, sin_port=htons(8000), sin_addr=inet_addr("127.0.0.1")}, 16) = -1 ECONNREFUSED (Connection refused)  
</code></pre></div><p>El programa falla porque no hay nada escuchando en ese puerto. Usemos <code>nc</code> para eso, en otra terminal:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">./ircware</span>  
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">nc</span> -nlvp 8000
Listening on 0.0.0.0 8000
Connection received on 127.0.0.1 43140  
NICK ircware_4056
USER ircware 0 * :ircware
JOIN #secret
</code></pre></div><p>Muy bien, parece que estamos conectados a un servidor (probablemente, IRC).</p><h2 id="descompilación">Descompilación</h2><p>Ahora en Ghidra, podemos buscar <em>strings</em> como <code>USER</code> o <code>NICK</code> y encontrar esta función a través de referencias cruzadas:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk7 mtki">void</span><span class="mtk1"> </span><span class="mtk8">FUN_00400349</span><span class="mtk1">() {</span>
<span class="mtk1">  </span><span class="mtk7 mtki">char</span><span class="mtk1"> cVar1;</span>
<span class="mtk1">  </span><span class="mtk7 mtki">char</span><span class="mtk1"> cVar2;</span>
<span class="mtk1">  byte bVar3;</span>
<span class="mtk1">  byte bVar4;</span>
<span class="mtk1">  </span><span class="mtk7 mtki">long</span><span class="mtk1"> lVar5;</span>
<span class="mtk1">  </span><span class="mtk7 mtki">long</span><span class="mtk1"> lVar6;</span>
<span class="mtk1">  ulong uVar7;</span>
<span class="mtk1">  </span><span class="mtk7 mtki">long</span><span class="mtk1"> lVar8;</span>
<span class="mtk1">  byte </span><span class="mtk5">*</span><span class="mtk1">pbVar9;</span>
<span class="mtk1">  </span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">pcVar10;</span>
<span class="mtk1">  </span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">pcVar11;</span>
<span class="mtk1">  byte </span><span class="mtk5">*</span><span class="mtk1">pbVar12;</span>
<span class="mtk1">  </span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">pcVar13;</span>
<span class="mtk1">  </span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">pcVar14;</span>
<span class="mtk1">  </span>
<span class="mtk1">  lVar8 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">1000</span><span class="mtk1">;</span>

<span class="mtk1">  </span><span class="mtk5">do</span><span class="mtk1"> {</span>
<span class="mtk1">    lVar6 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">-</span><span class="mtk1">lVar8;</span>
<span class="mtk1">    pcVar10 </span><span class="mtk5">=</span><span class="mtk1"> (</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">) (lVar6 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">6031a9</span><span class="mtk1">);</span>

<span class="mtk1">    </span><span class="mtk5">if</span><span class="mtk1"> (</span><span class="mtk5">*</span><span class="mtk1">pcVar10 </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk4">'</span><span class="mtk6">\0</span><span class="mtk4">'</span><span class="mtk1">) {</span>
<span class="mtk1">      </span><span class="mtk5">return</span><span class="mtk1">;</span>
<span class="mtk1">    }</span>

<span class="mtk1">    </span><span class="mtk5">if</span><span class="mtk1"> (</span><span class="mtk5">*</span><span class="mtk1">pcVar10 </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk4">'P'</span><span class="mtk1">) {</span>
<span class="mtk1">      lVar5 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">7</span><span class="mtk1">;</span>
<span class="mtk1">      pcVar11 </span><span class="mtk5">=</span><span class="mtk1"> pcVar10;</span>
<span class="mtk1">      pcVar13 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk4">"PING :"</span><span class="mtk1">;</span>

<span class="mtk1">      </span><span class="mtk5">do</span><span class="mtk1"> {</span>
<span class="mtk1">        </span><span class="mtk5">if</span><span class="mtk1"> (lVar5 </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">) </span><span class="mtk5">break</span><span class="mtk1">;</span>

<span class="mtk1">        lVar5 </span><span class="mtk5">=</span><span class="mtk1"> lVar5 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk5">-</span><span class="mtk6">1</span><span class="mtk1">;</span>
<span class="mtk1">        cVar1 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">pcVar11;</span>
<span class="mtk1">        cVar2 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">pcVar13;</span>
<span class="mtk1">        pcVar11 </span><span class="mtk5">=</span><span class="mtk1"> pcVar11 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">;</span>
<span class="mtk1">        pcVar13 </span><span class="mtk5">=</span><span class="mtk1"> pcVar13 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">;</span>
<span class="mtk1">      } </span><span class="mtk5">while</span><span class="mtk1"> (cVar1 </span><span class="mtk5">==</span><span class="mtk1"> cVar2);</span>

<span class="mtk1">      </span><span class="mtk5">if</span><span class="mtk1"> (lVar5 </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">) {</span>
<span class="mtk1">        DAT_006021aa </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">4f</span><span class="mtk1">;</span>
<span class="mtk1">        </span><span class="mtk8">FUN_004002fb</span><span class="mtk1">();</span>
<span class="mtk1">        lVar8 </span><span class="mtk5">=</span><span class="mtk1"> _DAT_00601010;</span>
<span class="mtk1">        _DAT_00601010 </span><span class="mtk5">=</span><span class="mtk1"> _DAT_00601010 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">;</span>

<span class="mtk1">        </span><span class="mtk5">if</span><span class="mtk1"> (lVar8 </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">) {</span>
<span class="mtk1">          </span><span class="mtk8">FUN_004002fb</span><span class="mtk1">();</span>
<span class="mtk1">          </span><span class="mtk8">FUN_004002fb</span><span class="mtk1">();</span>
<span class="mtk1">          </span><span class="mtk8">FUN_004002fb</span><span class="mtk1">();</span>
<span class="mtk1">        }</span>

<span class="mtk1">        </span><span class="mtk5">return</span><span class="mtk1">;</span>
<span class="mtk1">      }</span>

<span class="mtk1">      lVar5 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">18</span><span class="mtk1">;</span>
<span class="mtk1">      pcVar11 </span><span class="mtk5">=</span><span class="mtk1"> pcVar10;</span>
<span class="mtk1">      pcVar13 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk4">"PRIVMSG #secret :@pass "</span><span class="mtk1">;</span>

<span class="mtk1">      </span><span class="mtk5">do</span><span class="mtk1"> {</span>
<span class="mtk1">        </span><span class="mtk5">if</span><span class="mtk1"> (lVar5 </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">) </span><span class="mtk5">break</span><span class="mtk1">;</span>
<span class="mtk1">        lVar5 </span><span class="mtk5">=</span><span class="mtk1"> lVar5 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk5">-</span><span class="mtk6">1</span><span class="mtk1">;</span>
<span class="mtk1">        cVar1 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">pcVar11;</span>
<span class="mtk1">        cVar2 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">pcVar13;</span>
<span class="mtk1">        pcVar11 </span><span class="mtk5">=</span><span class="mtk1"> pcVar11 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">;</span>
<span class="mtk1">        pcVar13 </span><span class="mtk5">=</span><span class="mtk1"> pcVar13 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">;</span>
<span class="mtk1">      } </span><span class="mtk5">while</span><span class="mtk1"> (cVar1 </span><span class="mtk5">==</span><span class="mtk1"> cVar2);</span>

<span class="mtk1">      </span><span class="mtk5">if</span><span class="mtk1"> (lVar5 </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">) {</span>
<span class="mtk1">        pbVar12 </span><span class="mtk5">=</span><span class="mtk1"> (byte </span><span class="mtk5">*</span><span class="mtk1">) (lVar6 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">6031c0</span><span class="mtk1">);</span>
<span class="mtk1">        pcVar10 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk4">"RJJ3DSCP"</span><span class="mtk1">;</span>
<span class="mtk1">        pbVar9 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">&amp;</span><span class="mtk1">DAT_00601147;</span>
<span class="mtk1">        uVar7 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">;</span>
<span class="mtk1">        </span><span class="mtk5">break</span><span class="mtk1">;</span>
<span class="mtk1">      }</span>

<span class="mtk1">      lVar5 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">18</span><span class="mtk1">;</span>
<span class="mtk1">      pcVar11 </span><span class="mtk5">=</span><span class="mtk1"> pcVar10;</span>
<span class="mtk1">      pcVar13 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk4">"PRIVMSG #secret :@exec "</span><span class="mtk1">;</span>

<span class="mtk1">      </span><span class="mtk5">do</span><span class="mtk1"> {</span>
<span class="mtk1">        pcVar14 </span><span class="mtk5">=</span><span class="mtk1"> pcVar13;</span>

<span class="mtk1">        </span><span class="mtk5">if</span><span class="mtk1"> (lVar5 </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">) </span><span class="mtk5">break</span><span class="mtk1">;</span>

<span class="mtk1">        lVar5 </span><span class="mtk5">=</span><span class="mtk1"> lVar5 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk5">-</span><span class="mtk6">1</span><span class="mtk1">;</span>
<span class="mtk1">        pcVar14 </span><span class="mtk5">=</span><span class="mtk1"> pcVar13 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">;</span>
<span class="mtk1">        cVar1 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">pcVar11;</span>
<span class="mtk1">        cVar2 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">pcVar13;</span>
<span class="mtk1">        pcVar11 </span><span class="mtk5">=</span><span class="mtk1"> pcVar11 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">;</span>
<span class="mtk1">        pcVar13 </span><span class="mtk5">=</span><span class="mtk1"> pcVar14;</span>
<span class="mtk1">      } </span><span class="mtk5">while</span><span class="mtk1"> (cVar1 </span><span class="mtk5">==</span><span class="mtk1"> cVar2);</span>

<span class="mtk1">      </span><span class="mtk5">if</span><span class="mtk1"> (lVar5 </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">) {</span>
<span class="mtk1">        </span><span class="mtk5">if</span><span class="mtk1"> (_DAT_00601008 </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">) {</span>
<span class="mtk1">          </span><span class="mtk8">FUN_00400485</span><span class="mtk1">(pcVar14, </span><span class="mtk4">"Requires password"</span><span class="mtk1">, </span><span class="mtk5">&amp;</span><span class="mtk1">DAT_006021a9, </span><span class="mtk5">0x</span><span class="mtk6">12</span><span class="mtk1">);</span>
<span class="mtk1">          </span><span class="mtk5">return</span><span class="mtk1">;</span>
<span class="mtk1">        }</span>

<span class="mtk1">        DAT_0060108a </span><span class="mtk5">=</span><span class="mtk1"> lVar6 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">6031c0</span><span class="mtk1">;</span>
<span class="mtk1">        </span><span class="mtk8">FUN_00400592</span><span class="mtk1">();</span>
<span class="mtk1">        </span><span class="mtk5">return</span><span class="mtk1">;</span>
<span class="mtk1">      }</span>

<span class="mtk1">      lVar6 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">17</span><span class="mtk1">;</span>
<span class="mtk1">      pcVar11 </span><span class="mtk5">=</span><span class="mtk1"> pcVar10;</span>
<span class="mtk1">      pcVar13 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk4">"PRIVMSG #secret :@flag"</span><span class="mtk1">;</span>

<span class="mtk1">      </span><span class="mtk5">do</span><span class="mtk1"> {</span>
<span class="mtk1">        pcVar14 </span><span class="mtk5">=</span><span class="mtk1"> pcVar13;</span>

<span class="mtk1">        </span><span class="mtk5">if</span><span class="mtk1"> (lVar6 </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">) </span><span class="mtk5">break</span><span class="mtk1">;</span>

<span class="mtk1">        lVar6 </span><span class="mtk5">=</span><span class="mtk1"> lVar6 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk5">-</span><span class="mtk6">1</span><span class="mtk1">;</span>
<span class="mtk1">        pcVar14 </span><span class="mtk5">=</span><span class="mtk1"> pcVar13 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">;</span>
<span class="mtk1">        cVar1 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">pcVar11;</span>
<span class="mtk1">        cVar2 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">pcVar13;</span>
<span class="mtk1">        pcVar11 </span><span class="mtk5">=</span><span class="mtk1"> pcVar11 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">;</span>
<span class="mtk1">        pcVar13 </span><span class="mtk5">=</span><span class="mtk1"> pcVar14;</span>
<span class="mtk1">      } </span><span class="mtk5">while</span><span class="mtk1"> (cVar1 </span><span class="mtk5">==</span><span class="mtk1"> cVar2);</span>

<span class="mtk1">      </span><span class="mtk5">if</span><span class="mtk1"> (lVar6 </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">) {</span>
<span class="mtk1">        </span><span class="mtk5">if</span><span class="mtk1"> (_DAT_00601008 </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">) {</span>
<span class="mtk1">          </span><span class="mtk8">FUN_00400485</span><span class="mtk1">(pcVar14, </span><span class="mtk4">"Requires password"</span><span class="mtk1">, </span><span class="mtk5">&amp;</span><span class="mtk1">DAT_006021a9, </span><span class="mtk5">0x</span><span class="mtk6">12</span><span class="mtk1">);</span>
<span class="mtk1">          </span><span class="mtk5">return</span><span class="mtk1">;</span>
<span class="mtk1">        }</span>

<span class="mtk1">        </span><span class="mtk8">FUN_004004df</span><span class="mtk1">(pcVar14,pcVar10);</span>
<span class="mtk1">        </span><span class="mtk8">FUN_00400485</span><span class="mtk1">();</span>
<span class="mtk1">        </span><span class="mtk8">FUN_004004df</span><span class="mtk1">();</span>
<span class="mtk1">        </span><span class="mtk5">return</span><span class="mtk1">;</span>
<span class="mtk1">      }</span>
<span class="mtk1">    }</span>

<span class="mtk1">    lVar8 </span><span class="mtk5">=</span><span class="mtk1"> lVar8 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk5">-</span><span class="mtk6">1</span><span class="mtk1">;</span>

<span class="mtk1">    </span><span class="mtk5">if</span><span class="mtk1"> (lVar8 </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">) {</span>
<span class="mtk1">      </span><span class="mtk5">return</span><span class="mtk1">;</span>
<span class="mtk1">    }</span>
<span class="mtk1">  } </span><span class="mtk5">while</span><span class="mtk1"> (</span><span class="mtk6">true</span><span class="mtk1">);</span>

<span class="mtk1">LAB_00400401:</span>
<span class="mtk1">  bVar3 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">pbVar12;</span>
<span class="mtk1">  </span><span class="mtk5">*</span><span class="mtk1">pbVar9 </span><span class="mtk5">=</span><span class="mtk1"> bVar3;</span>

<span class="mtk1">  </span><span class="mtk5">if</span><span class="mtk1"> (((bVar3 </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">) </span><span class="mtk5">||</span><span class="mtk1"> (bVar3 </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">10</span><span class="mtk1">)) </span><span class="mtk5">||</span><span class="mtk1"> (bVar3 </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">d</span><span class="mtk1">)) {</span>
<span class="mtk1">    </span><span class="mtk5">if</span><span class="mtk1"> (uVar7 </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">8</span><span class="mtk1">) {</span>
<span class="mtk1">      _DAT_00601008 </span><span class="mtk5">=</span><span class="mtk1"> _DAT_00601008 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">;</span>
<span class="mtk1">      </span><span class="mtk8">FUN_00400485</span><span class="mtk1">(pcVar10, </span><span class="mtk4">"Accepted"</span><span class="mtk1">, </span><span class="mtk6">8</span><span class="mtk1">, </span><span class="mtk6">9</span><span class="mtk1">);</span>
<span class="mtk1">    } </span><span class="mtk5">else</span><span class="mtk1"> {</span>
<span class="mtk1">LAB_00400466:</span>
<span class="mtk1">      _DAT_00601008 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">;</span>
<span class="mtk1">      </span><span class="mtk8">FUN_00400485</span><span class="mtk1">(pcVar10, </span><span class="mtk4">"Rejected"</span><span class="mtk1">, uVar7, </span><span class="mtk6">9</span><span class="mtk1">);</span>
<span class="mtk1">    }</span>
<span class="mtk1">  </span>
<span class="mtk1">    </span><span class="mtk5">return</span><span class="mtk1">;</span>
<span class="mtk1">  }</span>

<span class="mtk1">  </span><span class="mtk5">if</span><span class="mtk1"> (</span><span class="mtk6">8</span><span class="mtk1"> </span><span class="mtk5">&lt;</span><span class="mtk1"> uVar7) </span><span class="mtk5">goto</span><span class="mtk1"> LAB_00400466;</span>

<span class="mtk1">  bVar4 </span><span class="mtk5">=</span><span class="mtk1"> bVar3;</span>

<span class="mtk1">  </span><span class="mtk5">if</span><span class="mtk1"> (((</span><span class="mtk5">0x</span><span class="mtk6">40</span><span class="mtk1"> </span><span class="mtk5">&lt;</span><span class="mtk1"> bVar3) </span><span class="mtk5">&amp;&amp;</span><span class="mtk1"> (bVar3 </span><span class="mtk5">&lt;</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">5b</span><span class="mtk1">)) </span><span class="mtk5">&amp;&amp;</span><span class="mtk1"> (bVar4 </span><span class="mtk5">=</span><span class="mtk1"> bVar3 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">11</span><span class="mtk1">, </span><span class="mtk5">0x</span><span class="mtk6">5a</span><span class="mtk1"> </span><span class="mtk5">&lt;</span><span class="mtk1"> bVar4)) {</span>  
<span class="mtk1">    bVar4 </span><span class="mtk5">=</span><span class="mtk1"> bVar3 </span><span class="mtk5">-</span><span class="mtk1"> </span><span class="mtk6">9</span><span class="mtk1">;</span>
<span class="mtk1">  }</span>

<span class="mtk1">  </span><span class="mtk5">if</span><span class="mtk1"> (</span><span class="mtk5">*</span><span class="mtk1">pcVar10 </span><span class="mtk5">!=</span><span class="mtk1"> bVar4) </span><span class="mtk5">goto</span><span class="mtk1"> LAB_00400466;</span>

<span class="mtk1">  uVar7 </span><span class="mtk5">=</span><span class="mtk1"> uVar7 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">;</span>
<span class="mtk1">  pbVar9 </span><span class="mtk5">=</span><span class="mtk1"> pbVar9 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">;</span>
<span class="mtk1">  pbVar12 </span><span class="mtk5">=</span><span class="mtk1"> pbVar12 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">;</span>
<span class="mtk1">  pcVar10 </span><span class="mtk5">=</span><span class="mtk1"> (</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">) ((byte </span><span class="mtk5">*</span><span class="mtk1">) pcVar10 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">);</span>

<span class="mtk1">  </span><span class="mtk5">goto</span><span class="mtk1"> LAB_00400401;</span>
<span class="mtk1">}</span>
</code></pre></div><p>Si analizamos el código un poco más en profundidad, la parte interesante está en la parte inferior. Podemos cambiar el nombre de algunas variables y cambiar tipos para que el código sea más legible:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">LAB_00400401:</span>
<span class="mtk1">  b </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">p_input_;</span>
<span class="mtk1">  </span><span class="mtk5">*</span><span class="mtk1">p_input </span><span class="mtk5">=</span><span class="mtk1"> b;</span>

<span class="mtk1">  </span><span class="mtk5">if</span><span class="mtk1"> (((b </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk4">'</span><span class="mtk6">\0</span><span class="mtk4">'</span><span class="mtk1">) </span><span class="mtk5">||</span><span class="mtk1"> (b </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk4">'</span><span class="mtk6">\n</span><span class="mtk4">'</span><span class="mtk1">)) </span><span class="mtk5">||</span><span class="mtk1"> (b </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk4">'</span><span class="mtk6">\r</span><span class="mtk4">'</span><span class="mtk1">)) {</span>
<span class="mtk1">    </span><span class="mtk5">if</span><span class="mtk1"> (i </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">8</span><span class="mtk1">) {</span>
<span class="mtk1">      _DAT_00601008 </span><span class="mtk5">=</span><span class="mtk1"> _DAT_00601008 </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">;</span>
<span class="mtk1">      </span><span class="mtk8">FUN_00400485</span><span class="mtk1">(expected, </span><span class="mtk4">"Accepted"</span><span class="mtk1">, </span><span class="mtk6">8</span><span class="mtk1">, </span><span class="mtk6">9</span><span class="mtk1">);</span>
<span class="mtk1">    } </span><span class="mtk5">else</span><span class="mtk1"> {</span>
<span class="mtk1">LAB_00400466:</span>
<span class="mtk1">      _DAT_00601008 </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">;</span>
<span class="mtk1">      </span><span class="mtk8">FUN_00400485</span><span class="mtk1">(expected, </span><span class="mtk4">"Rejected"</span><span class="mtk1">, i, </span><span class="mtk6">9</span><span class="mtk1">);</span>
<span class="mtk1">    }</span>

<span class="mtk1">    </span><span class="mtk5">return</span><span class="mtk1">;</span>
<span class="mtk1">  }</span>

<span class="mtk1">  </span><span class="mtk5">if</span><span class="mtk1"> (</span><span class="mtk6">8</span><span class="mtk1"> </span><span class="mtk5">&lt;</span><span class="mtk1"> i) </span><span class="mtk5">goto</span><span class="mtk1"> LAB_00400466;</span>

<span class="mtk1">  _b </span><span class="mtk5">=</span><span class="mtk1"> b;</span>

<span class="mtk1">  </span><span class="mtk5">if</span><span class="mtk1"> (((</span><span class="mtk4">'@'</span><span class="mtk1"> </span><span class="mtk5">&lt;</span><span class="mtk1"> b) </span><span class="mtk5">&amp;&amp;</span><span class="mtk1"> (b </span><span class="mtk5">&lt;</span><span class="mtk1"> </span><span class="mtk4">'['</span><span class="mtk1">)) </span><span class="mtk5">&amp;&amp;</span><span class="mtk1"> (_b </span><span class="mtk5">=</span><span class="mtk1"> b </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">11</span><span class="mtk1">, </span><span class="mtk4">'Z'</span><span class="mtk1"> </span><span class="mtk5">&lt;</span><span class="mtk1"> _b)) {</span>  
<span class="mtk1">    _b </span><span class="mtk5">=</span><span class="mtk1"> b </span><span class="mtk5">-</span><span class="mtk1"> </span><span class="mtk6">9</span><span class="mtk1">;</span>
<span class="mtk1">  }</span>

<span class="mtk1">  </span><span class="mtk5">if</span><span class="mtk1"> (</span><span class="mtk5">*</span><span class="mtk1">expected </span><span class="mtk5">!=</span><span class="mtk1"> _b) </span><span class="mtk5">goto</span><span class="mtk1"> LAB_00400466;</span>

<span class="mtk1">  i </span><span class="mtk5">=</span><span class="mtk1"> i </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">;</span>
<span class="mtk1">  p_input </span><span class="mtk5">=</span><span class="mtk1"> p_input </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">;</span>
<span class="mtk1">  p_input_ </span><span class="mtk5">=</span><span class="mtk1"> p_input_ </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">;</span>
<span class="mtk1">  expected </span><span class="mtk5">=</span><span class="mtk1"> (</span><span class="mtk7 mtki">char</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1">) ((byte </span><span class="mtk5">*</span><span class="mtk1">) expected </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">);</span>

<span class="mtk1">  </span><span class="mtk5">goto</span><span class="mtk1"> LAB_00400401;</span>
<span class="mtk1">}</span>
</code></pre></div><p>Y también, la variable nombrada <code>expected</code> contiene <code>"RJJ3DSCP"</code>, en unas líneas más arriba.</p><p>Básicamente, tenemos un bucle sobre los caracteres de una contraseña, que se verifican uno por uno. Si después de las operaciones, el byte de resultado no coincide con el esperado, el programa dirá <code>"Rejected"</code>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">nc</span> -nlvp 8000
Listening on 0.0.0.0 8000
Connection received on 127.0.0.1 37534  
NICK ircware_1552
USER ircware 0 * :ircware
JOIN #secret
PRIVMSG #secret :@pass ABCD
PRIVMSG #secret :Rejected
PRIVMSG #secret :@pass RJJ3DSCP
PRIVMSG #secret :Rejected
</code></pre></div><h2 id="descifrado">Descifrado</h2><p><code>"RJJ3DSCP"</code> no es la contraseña, es el resultado esperado de las operaciones aplicadas a cada byte de la contraseña. Estas son las operaciones:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">  _b </span><span class="mtk5">=</span><span class="mtk1"> b;</span>

<span class="mtk1">  </span><span class="mtk5">if</span><span class="mtk1"> (((</span><span class="mtk4">'@'</span><span class="mtk1"> </span><span class="mtk5">&lt;</span><span class="mtk1"> b) </span><span class="mtk5">&amp;&amp;</span><span class="mtk1"> (b </span><span class="mtk5">&lt;</span><span class="mtk1"> </span><span class="mtk4">'['</span><span class="mtk1">)) </span><span class="mtk5">&amp;&amp;</span><span class="mtk1"> (_b </span><span class="mtk5">=</span><span class="mtk1"> b </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">11</span><span class="mtk1">, </span><span class="mtk4">'Z'</span><span class="mtk1"> </span><span class="mtk5">&lt;</span><span class="mtk1"> _b)) {</span>  
<span class="mtk1">    _b </span><span class="mtk5">=</span><span class="mtk1"> b </span><span class="mtk5">-</span><span class="mtk1"> </span><span class="mtk6">9</span><span class="mtk1">;</span>
<span class="mtk1">  }</span>
</code></pre></div><p>En lugar de revertir las operaciones, escribiré un poco de código en C usando el algoritmo anterior e intentaré encontrar qué bytes de entrada dan el resultado esperado <code>"RJJ3DSCP"</code>:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk5">#include</span><span class="mtk1"> </span><span class="mtk4">&lt;stdio.h&gt;</span>

<span class="mtk7 mtki">void</span><span class="mtk1"> </span><span class="mtk8">main</span><span class="mtk1">() {</span>
<span class="mtk1">        </span><span class="mtk7 mtki">int</span><span class="mtk1"> i;</span>
<span class="mtk1">        </span><span class="mtk7 mtki">char</span><span class="mtk1"> b;</span>
<span class="mtk1">        </span><span class="mtk7 mtki">char</span><span class="mtk1"> _b;</span>
<span class="mtk1">        </span><span class="mtk7 mtki">char</span><span class="mtk1"> expected[</span><span class="mtk6">8</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk4">"RJJ3DSCP"</span><span class="mtk1">;</span>

<span class="mtk1">        </span><span class="mtk5">for</span><span class="mtk1"> (i </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">; i </span><span class="mtk5">&lt;</span><span class="mtk1"> </span><span class="mtk6">8</span><span class="mtk1">; i</span><span class="mtk5">++</span><span class="mtk1">) {</span>
<span class="mtk1">                </span><span class="mtk5">for</span><span class="mtk1"> (b </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">; b </span><span class="mtk5">&lt;</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">7f</span><span class="mtk1">; b</span><span class="mtk5">++</span><span class="mtk1">) {</span>
<span class="mtk1">                        _b </span><span class="mtk5">=</span><span class="mtk1"> b;</span>

<span class="mtk1">                        </span><span class="mtk5">if</span><span class="mtk1"> (((</span><span class="mtk4">'@'</span><span class="mtk1"> </span><span class="mtk5">&lt;</span><span class="mtk1"> b) </span><span class="mtk5">&amp;&amp;</span><span class="mtk1"> (b </span><span class="mtk5">&lt;</span><span class="mtk1"> </span><span class="mtk4">'['</span><span class="mtk1">)) </span><span class="mtk5">&amp;&amp;</span><span class="mtk1"> (_b </span><span class="mtk5">=</span><span class="mtk1"> b </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk5">0x</span><span class="mtk6">11</span><span class="mtk1">, </span><span class="mtk4">'Z'</span><span class="mtk1"> </span><span class="mtk5">&lt;</span><span class="mtk1"> _b)) {</span>  
<span class="mtk1">                                _b </span><span class="mtk5">=</span><span class="mtk1"> b </span><span class="mtk5">-</span><span class="mtk1"> </span><span class="mtk6">9</span><span class="mtk1">;</span>
<span class="mtk1">                        }</span>

<span class="mtk1">                        </span><span class="mtk5">if</span><span class="mtk1"> (_b </span><span class="mtk5">==</span><span class="mtk1"> expected[i]) {</span>
<span class="mtk1">                                </span><span class="mtk8">putchar</span><span class="mtk1">(b);</span>
<span class="mtk1">                                </span><span class="mtk5">break</span><span class="mtk1">;</span>
<span class="mtk1">                        }</span>
<span class="mtk1">                }</span>
<span class="mtk1">        }</span>

<span class="mtk1">        </span><span class="mtk8">putchar</span><span class="mtk1">(</span><span class="mtk4">'\n'</span><span class="mtk1">);</span>
<span class="mtk1">}</span>
</code></pre></div><p>Una vez compilado y ejecutado, encontramos la contraseña esperada:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">gcc</span> <span class="mtku">solve.c</span>; <span class="code-dark-green">./a.out</span>  
ASS3MBLY
</code></pre></div><h2 id="_flag_"><em>Flag</em></h2><p>Ahora, si ingresamos esta contraseña, veremos el indicador con el comando correspondiente (también podemos ejecutar comandos con <code>/bin/sh</code>):</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">nc</span> -nlvp 8000
Listening on 0.0.0.0 8000
Connection received on 127.0.0.1 46910
NICK ircware_2760
USER ircware 0 * :ircware
JOIN #secret
PRIVMSG #secret :@pass ASS3MBLY
PRIVMSG #secret :Accepted
PRIVMSG #secret :@exec ASS3MBLY
PRIVMSG #secret :/bin/sh: 1: ASS3MBLY: not found
PRIVMSG #secret :Done!
PRIVMSG #secret :@exec whoami
PRIVMSG #secret :rocky
PRIVMSG #secret :Done!
PRIVMSG #secret :@flag
PRIVMSG #secret :HTB{m1N1m411st1C_fL4g_pR0v1d3r_b0T}  
</code></pre></div><div class="mt6 instapaper_ignoref"></div></div><aside aria-label="aside" class="w-20-l aside-desktop"><div class="bg-card pa3 nested-list-reset nested-copy-line-height nested-links" style="position:sticky;top:5rem;padding-bottom:0"><p class="f5 b pb2" style="border-bottom:5px solid var(--background);margin:0">Contenidos</p><nav id="TableOfContents"><ul><li><a href="#análisis-básico">Análisis básico</a></li><li><a href="#descompilación">Descompilación</a></li><li><a href="#descifrado">Descifrado</a></li><li><a href="#_flag_"><em>Flag</em></a></li></ul></nav><div class="bg-card" style="border-top:5px solid var(--background)"><a class="bmc-btn w-100" target="_blank" href="http://buymeacoffee.com/7Rocky" style="padding:0" title="Buy me a beer">🍺 <span class="bmc-btn-text" style="font-family:Cookie!important;color:#fff">Buy me a beer</span></a></div></div></aside></article></main><footer class="bottom-0 w-100" role="contentinfo"><div class="tc mw8 ph3" style="margin:auto"><form style="background-color:var(--background-card)" class="tc mw8 pv3 mb3" action="https://mailchi.mp/59ffae939360/7rockys-blog-weekly-newsletter" target="popupwindow" onsubmit='return window.open("https://mailchi.mp/59ffae939360/7rockys-blog-weekly-newsletter"),!0'><h3 class="tc">7Rocky's Blog Weekly Newsletter</h3><p class="tc"><input class="f5 pv3 ph3 bn" style="background-color:var(--background);color:inherit;font-weight:700;line-height:normal" type="submit" value="Recibe un resumen semanal del blog"></p><input type="hidden" value="1" name="embed">
<input style="display:none;color:var(--header)" type="submit" value="Suscribirse"><p class="tc"><a href="/en/newsletters/" target="_blank" title="View letter archive">Ver historial de resúmenes</a></p><p class="tc">impulsado por <a href="http://www.mailchimp.com" target="_blank" title="Mailchimp">Mailchimp</a></p></form></div><div class="bg-black w-100 pa3" role="contentinfo"><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://7rocky.github.io/" title="https://7rocky.github.io/">&copy; Blog de 7Rocky. Ciberseguridad y Mates 2023</a><div style="margin-top:8px"><div><div><a href="https://www.linkedin.com/in/roberto-gesteira-minarro/" target="_blank" class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel="noopener" aria-label="follow on LinkedIn——Opens in a new window"><svg height="30" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg><span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a><a href="https://github.com/7Rocky" target="_blank" class="link-transition github link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel="noopener" aria-label="follow on GitHub——Opens in a new window"><svg height="30" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg><span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a></div></div></div></div></div></footer></body></html>