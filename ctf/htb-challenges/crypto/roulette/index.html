<!doctype html><html lang="es"><head><title>Roulette | 7Rocky</title>
<meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="author" content="Blog de 7Rocky. Ciberseguridad y Mates"><meta name="description" content="PRNG. Mersenne Twister personalizado. Sistema de ecuaciones con variables binarias"><meta name="image" content="https://7rocky.github.io/images/cryptography.png"><meta name="robots" content="index, follow"><meta name="viewport" content="width=device-width,minimum-scale=1"><meta itemprop="description" content="PRNG. Mersenne Twister personalizado. Sistema de ecuaciones con variables binarias"><meta itemprop="keywords" content><meta itemprop="name" content="Roulette"><meta property="article:published_time" content><meta property="og:author" content="Blog de 7Rocky. Ciberseguridad y Mates"><meta property="og:description" content="PRNG. Mersenne Twister personalizado. Sistema de ecuaciones con variables binarias"><meta property="og:image" content="https://7rocky.github.io/images/cryptography.png"><meta property="og:locale" content="es_ES"><meta property="og:site_name" content="Blog de 7Rocky. Ciberseguridad y Mates"><meta property="og:title" content="Roulette"><meta property="og:type" content="website"><meta property="og:url" content="https://7rocky.github.io/ctf/htb-challenges/crypto/roulette/"><meta name="twitter:author" content="Blog de 7Rocky. Ciberseguridad y Mates"><meta name="twitter:card" content="PRNG. Mersenne Twister personalizado. Sistema de ecuaciones con variables binarias"><meta name="twitter:description" content="PRNG. Mersenne Twister personalizado. Sistema de ecuaciones con variables binarias"><meta name="twitter:image" content="https://7rocky.github.io/images/cryptography.png"><meta name="twitter:title" content="Roulette"><link href="/favicon.ico" rel="shortcut icon" type="image/x-icon"><link href="/css/style.css" rel="stylesheet"><link href="/css/main.css" rel="stylesheet"><link href="/css/code.css" rel="stylesheet"><link href="https://7rocky.github.io/ctf/htb-challenges/crypto/roulette/" rel="canonical"><script async src="https://www.googletagmanager.com/gtag/js?id=G-Z1HQGH3M4D"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-Z1HQGH3M4D",{anonymize_ip:!1})}</script><script>MathJax={loader:{load:["[tex]/noerrors"]},options:{ignoreHtmlClass:"tex2jax_ignore",processHtmlClass:"tex2jax_process",skipHtmlTags:["noscript","pre","script","style","textarea"]},tex:{autoload:{color:[],colorv2:["color"]},displayMath:[["$$","$$"]],inlineMath:[["$","$"]],packages:{"[+]":["noerrors"]},processEnvironments:!0,processEscapes:!0}}</script><script type="text/javascript" src="//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script><div id="math-consts" style="display:none">$
\newcommand{\e}{e}
\newcommand{\N}[1][]{\mathbb{N}^{#1}}
\newcommand{\Q}[1][]{\mathbb{Q}^{#1}}
\newcommand{\R}[1][]{\mathbb{R}^{#1}}
\newcommand{\Z}[1][]{\mathbb{Z}^{#1}}
\newcommand{\C}[1][]{\mathbb{C}^{#1}}
\newcommand{\dx}{\,\mathrm{d}x}
\newcommand{\dy}{\,\mathrm{d}y}
\newcommand{\dz}{\,\mathrm{d}z}
\newcommand{\dt}{\,\mathrm{d}t}
\newcommand{\divides}{\, | \,}
\newcommand{\st}{\; | \;}
\renewcommand{\geq}{\geqslant}
\renewcommand{\leq}{\leqslant}
\renewcommand{\i}{\mathrm{i}}
\newcommand{\rank}{\mathop{\mathrm{rank}}}
\newcommand{\gcd}{\mathop{\mathrm{gcd}}}
\newcommand{\tr}{\mathop{\mathrm{tr}}}
\newcommand{\charField}{\mathop{\mathrm{char}}}
\newcommand{\Image}{\mathop{\mathrm{Im}}}
$</div><script src="/js/imc.js"></script><script>(async()=>await typeset(()=>[`#math-consts`]))()</script></head><body class="ma0 production"><header style="position:sticky;top:0;z-index:9"><div class="bg-black"><nav class="ph4-ns" id="navigation" role="navigation"><div class="flex-l justify-between items-center center"><a class="f3 fw2 hover-white no-underline white-90 dib" href="/" title="7Rocky">7Rocky</a><div class="flex-l items-center"><a href="/search" target class="link-transition link dib z-999 pt3 pt0-l mr1 search-link" title="Buscar" rel="noopener" aria-label="Buscar"><svg height="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 487.95 487.95" style="enable-background:new 0 0 487.95 487.95"><g><g><path d="M481.8 453l-140-140.1c27.6-33.1 44.2-75.4 44.2-121.6C386 85.9 299.5.2 193.1.2S0 86 0 191.4s86.5 191.1 192.9 191.1c45.2.0 86.8-15.5 119.8-41.4l140.5 140.5c8.2 8.2 20.4 8.2 28.6.0C490 473.4 490 461.2 481.8 453zM41 191.4c0-82.8 68.2-150.1 151.9-150.1s151.9 67.3 151.9 150.1-68.2 150.1-151.9 150.1S41 274.1 41 191.4z" style="fill-rule:evenodd;clip-rule:evenodd;fill:#a9a9b3"/></g></g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/></svg></a><a class="link-transition lang link dib z-999 pt3 pt0-l mr3" href="#" title="es"><img alt="es" height="30px" src="/images/es.png" width="30px">
</a><a class="link-transition lang link dib z-999 pt3 pt0-l" href="/en/ctf/htb-challenges/crypto/roulette/" title="en"><img alt="en" height="30px" src="/images/en.png" style="border:4px solid#000;border-radius:100%" width="30px"></a><ul class="pl0 ml3 mr3" style="line-height:30px"><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href="/ctf/" title="CTF">CTF</a></li><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href="/htb/" title="HTB">HTB</a></li><li class="list f5 f4-ns fw4 dib pr2 pl2"><a class="hover-white no-underline white-90" href="/imc/" title="IMC">IMC</a></li></ul><a href="https://www.linkedin.com/in/roberto-gesteira-minarro/" target="_blank" class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel="noopener" aria-label="follow on LinkedIn——Opens in a new window"><svg height="30" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg><span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a><a href="https://github.com/7Rocky" target="_blank" class="link-transition github link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel="noopener" aria-label="follow on GitHub——Opens in a new window"><svg height="30" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg><span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a></div></div></nav></div></header><main class="pb5" role="main" style="min-height:720px"><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-80-l"><a aria-label="aside" class="instapaper_ignoref b tracked" href="../" style="font-size:1.2rem">&lt;- CRYPTO</a><div id="sharing" class="mt3"><a aria-label="share on Facebook" class="facebook no-underline" href="https://www.facebook.com/sharer.php?u=https://7rocky.github.io/ctf/htb-challenges/crypto/roulette/" title="share on Facebook"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765 50.32h6.744V33.998h4.499l.596-5.624h-5.095l.007-2.816c0-1.466.14-2.253 2.244-2.253h2.812V17.68h-4.5c-5.405.0-7.307 2.729-7.307 7.317v3.377h-3.369v5.625h3.369V50.32zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></a><a aria-label="share on Twitter" class="twitter no-underline" href="https://twitter.com/share?url=https://7rocky.github.io/ctf/htb-challenges/crypto/roulette/&amp;text=Roulette" title="share on Twitter"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a><a aria-label="share on LinkedIn" class="linkedin no-underline" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://7rocky.github.io/ctf/htb-challenges/crypto/roulette/&amp;title=Roulette" title="share on LinkedIn"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></a></div><h1 class="f1 mt3 mb1">Roulette</h1><p class="mb4 f6 dib tracked">17 minutos de lectura</p></header><aside aria-label="aside" class="w-20-l mt6-l aside-mobile"><div class="bg-card pa3 nested-list-reset nested-copy-line-height nested-links" style="position:sticky;top:5rem;padding-bottom:0"><p class="f5 b pb2" style="border-bottom:5px solid var(--background);margin:0">Contenidos</p><nav id="TableOfContents"><ul><li><a href="#configuración-del-entorno">Configuración del entorno</a></li><li><a href="#análisis-del-código-fuente">Análisis del código fuente</a></li><li><a href="#prng">PRNG</a><ul><li><a href="#generación-del-estado">Generación del estado</a></li><li><a href="#salidas-aleatorias">Salidas aleatorias</a></li><li><a href="#_twister_"><em>Twister</em></a></li><li><a href="#modelo-del-prng">Modelo del PRNG</a></li></ul></li><li><a href="#solución">Solución</a></li><li><a href="#_flag_"><em>Flag</em></a></li></ul></nav><div class="bg-card" style="border-top:5px solid var(--background)"><a class="bmc-btn w-100" target="_blank" href="http://buymeacoffee.com/7Rocky" style="padding:0" title="Buy me a beer">🍺 <span class="bmc-btn-text" style="font-family:Cookie!important;color:#fff">Buy me a beer</span></a></div></div></aside><div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img pr4-l w-80-l"><p>Se nos proporciona el código fuente del servidor en Python:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk5">import</span><span class="mtk1"> </span><span class="mtk8 mtku">socketserver</span>
<span class="mtk5">import</span><span class="mtk1"> </span><span class="mtk8 mtku">signal</span>
<span class="mtk5">from</span><span class="mtk1"> </span><span class="mtk8 mtku">twister</span><span class="mtk1"> </span><span class="mtk5">import</span><span class="mtk1"> </span><span class="mtk8 mtku">Twister</span>

<span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">handle</span><span class="mtk1">(</span><span class="mtk9 mtki">self</span><span class="mtk1">):</span>
<span class="mtk1">    </span><span class="mtk8 mtku">signal</span><span class="mtk1">.</span><span class="mtk8">alarm</span><span class="mtk1">(</span><span class="mtk6">500</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk9 mtki">self</span><span class="mtk1">.write(</span><span class="mtk4">"Welcome to the Casino"</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk9 mtki">self</span><span class="mtk1">.write(</span><span class="mtk4">"We are playing roulette today"</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">money</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">50</span>
<span class="mtk1">    </span><span class="mtk1">random</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">Twister</span><span class="mtk1">()</span>
<span class="mtk1">    </span><span class="mtk9 mtki">self</span><span class="mtk1">.write(</span><span class="mtk4">"The wheel stops on a number between 0 and 31."</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk9 mtki">self</span><span class="mtk1">.write(</span><span class="mtk4">"</span><span class="mtk6">\n</span><span class="mtk4">"</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk5">while</span><span class="mtk1"> </span><span class="mtk1">money</span><span class="mtk1"> </span><span class="mtk5">&gt;</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">:</span>
<span class="mtk1">        </span><span class="mtk9 mtki">self</span><span class="mtk1">.write(</span><span class="mtk4">"You have </span><span class="mtk6">{}</span><span class="mtk4"> coins"</span><span class="mtk1">.</span><span class="mtk8">format</span><span class="mtk1">(</span><span class="mtk1">money</span><span class="mtk1">))</span>
<span class="mtk1">        </span><span class="mtk9 mtki">self</span><span class="mtk1">.write(</span><span class="mtk4">"What would you like to bet on:"</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk9 mtki">self</span><span class="mtk1">.write(</span><span class="mtk4">"1) Even"</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk9 mtki">self</span><span class="mtk1">.write(</span><span class="mtk4">"2) Odd"</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk9 mtki">self</span><span class="mtk1">.write(</span><span class="mtk4">"3) Number"</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk1">option</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">int</span><span class="mtk1">(</span><span class="mtk9 mtki">self</span><span class="mtk1">.query(</span><span class="mtk4">"Option: "</span><span class="mtk1">).strip())</span>
<span class="mtk1">        </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk1">option</span><span class="mtk1"> </span><span class="mtk5">&lt;</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1"> </span><span class="mtk5">or</span><span class="mtk1"> </span><span class="mtk1">option</span><span class="mtk1"> </span><span class="mtk5">&gt;</span><span class="mtk1"> </span><span class="mtk6">3</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk9 mtki">self</span><span class="mtk1">.write(</span><span class="mtk4">"Invalid Option."</span><span class="mtk1">)</span>
<span class="mtk1">            </span><span class="mtk9 mtki">self</span><span class="mtk1">.close()</span>
<span class="mtk1">            </span><span class="mtk5">return</span>
<span class="mtk1">        </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk1">option</span><span class="mtk1"> </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">3</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk1">guess</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">int</span><span class="mtk1">(</span><span class="mtk9 mtki">self</span><span class="mtk1">.query(</span><span class="mtk4">"Pick a number: "</span><span class="mtk1">).strip())</span>
<span class="mtk1">        </span><span class="mtk1">bet</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">int</span><span class="mtk1">(</span><span class="mtk9 mtki">self</span><span class="mtk1">.query(</span><span class="mtk4">"Bet: "</span><span class="mtk1">).strip())</span>
<span class="mtk1">        </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk1">bet</span><span class="mtk1"> </span><span class="mtk5">&lt;=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1"> </span><span class="mtk5">or</span><span class="mtk1"> </span><span class="mtk1">bet</span><span class="mtk1"> </span><span class="mtk5">&gt;</span><span class="mtk1"> </span><span class="mtk1">money</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk9 mtki">self</span><span class="mtk1">.write(</span><span class="mtk4">"Invalid Bet."</span><span class="mtk1">)</span>
<span class="mtk1">            </span><span class="mtk9 mtki">self</span><span class="mtk1">.close()</span>
<span class="mtk1">            </span><span class="mtk5">return</span>
<span class="mtk1">        </span><span class="mtk1">number</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">random</span><span class="mtk1">.</span><span class="mtk8">rand</span><span class="mtk1">() </span><span class="mtk5">%</span><span class="mtk1"> </span><span class="mtk6">32</span>
<span class="mtk1">        </span><span class="mtk9 mtki">self</span><span class="mtk1">.write(</span><span class="mtk4">"The wheel stops at </span><span class="mtk6">{}</span><span class="mtk4">"</span><span class="mtk1">.</span><span class="mtk8">format</span><span class="mtk1">(</span><span class="mtk1">number</span><span class="mtk1">))</span>
<span class="mtk1">        </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk1">option</span><span class="mtk1"> </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk1">number</span><span class="mtk1"> </span><span class="mtk5">%</span><span class="mtk1"> </span><span class="mtk6">2</span><span class="mtk1"> </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">:</span>
<span class="mtk1">                </span><span class="mtk1">money</span><span class="mtk1"> </span><span class="mtk5">+=</span><span class="mtk1"> </span><span class="mtk1">bet</span>
<span class="mtk1">            </span><span class="mtk5">else</span><span class="mtk1">:</span>
<span class="mtk1">                </span><span class="mtk1">money</span><span class="mtk1"> </span><span class="mtk5">-=</span><span class="mtk1"> </span><span class="mtk1">bet</span>
<span class="mtk1">        </span><span class="mtk5">elif</span><span class="mtk1"> </span><span class="mtk1">option</span><span class="mtk1"> </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">2</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk1">number</span><span class="mtk1"> </span><span class="mtk5">%</span><span class="mtk1"> </span><span class="mtk6">2</span><span class="mtk1"> </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">:</span>
<span class="mtk1">                </span><span class="mtk1">money</span><span class="mtk1"> </span><span class="mtk5">+=</span><span class="mtk1"> </span><span class="mtk1">bet</span>
<span class="mtk1">            </span><span class="mtk5">else</span><span class="mtk1">:</span>
<span class="mtk1">                </span><span class="mtk1">money</span><span class="mtk1"> </span><span class="mtk5">-=</span><span class="mtk1"> </span><span class="mtk1">bet</span>
<span class="mtk1">        </span><span class="mtk5">elif</span><span class="mtk1"> </span><span class="mtk1">option</span><span class="mtk1"> </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">3</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk1">number</span><span class="mtk1"> </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk1">guess</span><span class="mtk1">:</span>
<span class="mtk1">                </span><span class="mtk1">money</span><span class="mtk1"> </span><span class="mtk5">+=</span><span class="mtk1"> </span><span class="mtk1">bet</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1"> </span><span class="mtk6">10</span>
<span class="mtk1">            </span><span class="mtk5">else</span><span class="mtk1">:</span>
<span class="mtk1">                </span><span class="mtk1">money</span><span class="mtk1"> </span><span class="mtk5">-=</span><span class="mtk1"> </span><span class="mtk1">bet</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1"> </span><span class="mtk6">10</span>

<span class="mtk1">        </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk1">money</span><span class="mtk1"> </span><span class="mtk5">&gt;=</span><span class="mtk1"> </span><span class="mtk6">10000000000000</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk9 mtki">self</span><span class="mtk1">.write(</span><span class="mtk4">"Congrats, you beat the house."</span><span class="mtk1">)</span>
<span class="mtk1">            </span><span class="mtk9 mtki">self</span><span class="mtk1">.write(</span><span class="mtk4">"Here's your reward: </span><span class="mtk6">{}</span><span class="mtk4">"</span><span class="mtk1">.</span><span class="mtk8">format</span><span class="mtk1">(</span><span class="mtk8">open</span><span class="mtk1">(</span><span class="mtk4">"flag.txt"</span><span class="mtk1">, </span><span class="mtk4">"rb"</span><span class="mtk1">).</span><span class="mtk8">read</span><span class="mtk1">()))</span>  
<span class="mtk1">            </span><span class="mtk9 mtki">self</span><span class="mtk1">.close()</span>
<span class="mtk1">            </span><span class="mtk5">return</span>
<span class="mtk1">    </span><span class="mtk9 mtki">self</span><span class="mtk1">.write(</span><span class="mtk4">"You ran out of money. Better luck next time."</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk9 mtki">self</span><span class="mtk1">.close()</span>

<span class="mtk7 mtki">class</span><span class="mtk1"> </span><span class="mtk8 mtku">RequestHandler</span><span class="mtk1">(</span><span class="mtk8 mtku">socketserver</span><span class="mtk1">.</span><span class="mtk8 mtku">BaseRequestHandler</span><span class="mtk1">):</span>
<span class="mtk1">    </span><span class="mtk1">handle</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">handle</span>

<span class="mtk1">    </span><span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">read</span><span class="mtk1">(</span><span class="mtk9 mtki">self</span><span class="mtk1">, </span><span class="mtk9 mtki">until</span><span class="mtk5">=</span><span class="mtk4">'</span><span class="mtk6">\n</span><span class="mtk4">'</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk1">out</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk4">''</span>
<span class="mtk1">        </span><span class="mtk5">while</span><span class="mtk1"> </span><span class="mtk5">not</span><span class="mtk1"> </span><span class="mtk1">out</span><span class="mtk1">.</span><span class="mtk8">endswith</span><span class="mtk1">(</span><span class="mtk9 mtki">until</span><span class="mtk1">):</span>
<span class="mtk1">            </span><span class="mtk1">out</span><span class="mtk1"> </span><span class="mtk5">+=</span><span class="mtk1"> </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">request</span><span class="mtk1">.recv(</span><span class="mtk6">1</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk1">out</span><span class="mtk1">[:</span><span class="mtk5">-</span><span class="mtk8">len</span><span class="mtk1">(</span><span class="mtk9 mtki">until</span><span class="mtk1">)]</span>

<span class="mtk1">    </span><span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">query</span><span class="mtk1">(</span><span class="mtk9 mtki">self</span><span class="mtk1">, </span><span class="mtk9 mtki">string</span><span class="mtk5">=</span><span class="mtk4">''</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk8">write</span><span class="mtk1">(</span><span class="mtk9 mtki">string</span><span class="mtk1">, </span><span class="mtk9 mtki">newline</span><span class="mtk5">=</span><span class="mtk6">False</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk8">read</span><span class="mtk1">()</span>

<span class="mtk1">    </span><span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">write</span><span class="mtk1">(</span><span class="mtk9 mtki">self</span><span class="mtk1">, </span><span class="mtk9 mtki">string</span><span class="mtk1">, </span><span class="mtk9 mtki">newline</span><span class="mtk5">=</span><span class="mtk6">True</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">request</span><span class="mtk1">.sendall(</span><span class="mtk9 mtki">string</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk9 mtki">newline</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">request</span><span class="mtk1">.sendall(</span><span class="mtk4">'</span><span class="mtk6">\n</span><span class="mtk4">'</span><span class="mtk1">)</span>

<span class="mtk1">    </span><span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">close</span><span class="mtk1">(</span><span class="mtk9 mtki">self</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">request</span><span class="mtk1">.close()</span>

<span class="mtk7 mtki">class</span><span class="mtk1"> </span><span class="mtk8 mtku">Server</span><span class="mtk1">(</span><span class="mtk8 mtku">socketserver</span><span class="mtk1">.</span><span class="mtk8 mtku">ForkingTCPServer</span><span class="mtk1">):</span>

<span class="mtk1">    </span><span class="mtk1">allow_reuse_address</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">True</span>

<span class="mtk1">    </span><span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">handle_error</span><span class="mtk1">(</span><span class="mtk9 mtki">self</span><span class="mtk1">, </span><span class="mtk9 mtki">request</span><span class="mtk1">, </span><span class="mtk9 mtki">client_address</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk9 mtki">self</span><span class="mtk1">.request.close()</span>

<span class="mtk1">port</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">31337</span>
<span class="mtk1">server</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">Server</span><span class="mtk1">((</span><span class="mtk4">'0.0.0.0'</span><span class="mtk1">, </span><span class="mtk1">port</span><span class="mtk1">), </span><span class="mtk8 mtku">RequestHandler</span><span class="mtk1">)</span>
<span class="mtk1">server</span><span class="mtk1">.</span><span class="mtk8">serve_forever</span><span class="mtk1">()</span>
</code></pre></div><p>El servidor usa una clase llamada <code>Twister</code> como generador de números pseudo-aleatorios (PRNG):</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk5">import</span><span class="mtk1"> </span><span class="mtk8 mtku">os</span>
<span class="mtk5">import</span><span class="mtk1"> </span><span class="mtk8 mtku">random</span>

<span class="mtk1">N</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">128</span>
<span class="mtk1">M</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">30</span>
<span class="mtk1">b</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">32</span>
<span class="mtk1">MAGIC</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk7 mtki">0x</span><span class="mtk6">b249b015</span>
<span class="mtk1">mask</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> (</span><span class="mtk6">1</span><span class="mtk1"> </span><span class="mtk5">&lt;&lt;</span><span class="mtk1"> </span><span class="mtk1">b</span><span class="mtk1">) </span><span class="mtk5">-</span><span class="mtk1"> </span><span class="mtk6">1</span>

<span class="mtk7 mtki">class</span><span class="mtk1"> </span><span class="mtk8 mtku">Twister</span><span class="mtk1">:</span>
<span class="mtk1">    </span><span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">rol</span><span class="mtk1">(</span><span class="mtk9 mtki">self</span><span class="mtk1">, </span><span class="mtk9 mtki">x</span><span class="mtk1">, </span><span class="mtk9 mtki">d</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk1">ans</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> (</span><span class="mtk9 mtki">x</span><span class="mtk1"> </span><span class="mtk5">&lt;&lt;</span><span class="mtk1"> </span><span class="mtk9 mtki">d</span><span class="mtk1">) </span><span class="mtk5">&amp;</span><span class="mtk1"> </span><span class="mtk1">mask</span>
<span class="mtk1">        </span><span class="mtk1">ans</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">ans</span><span class="mtk1"> </span><span class="mtk5">|</span><span class="mtk1"> (</span><span class="mtk9 mtki">x</span><span class="mtk1"> </span><span class="mtk5">&gt;&gt;</span><span class="mtk1"> (</span><span class="mtk1">b</span><span class="mtk1"> </span><span class="mtk5">-</span><span class="mtk1"> </span><span class="mtk9 mtki">d</span><span class="mtk1">))</span>
<span class="mtk1">        </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk1">ans</span><span class="mtk1"> </span><span class="mtk5">&amp;</span><span class="mtk1"> </span><span class="mtk1">mask</span>

<span class="mtk1">    </span><span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk7">__init__</span><span class="mtk1">(</span><span class="mtk9 mtki">self</span><span class="mtk1">, </span><span class="mtk9 mtki">state</span><span class="mtk5">=</span><span class="mtk6">None</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">index</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">N</span>
<span class="mtk1">        </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk9 mtki">state</span><span class="mtk1"> </span><span class="mtk5">is</span><span class="mtk1"> </span><span class="mtk5">not</span><span class="mtk1"> </span><span class="mtk6">None</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk5">assert</span><span class="mtk1"> </span><span class="mtk8">len</span><span class="mtk1">(</span><span class="mtk9 mtki">state</span><span class="mtk1">) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk1">N</span>
<span class="mtk1">            </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">STATE</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk9 mtki">state</span><span class="mtk1">[:]</span>
<span class="mtk1">        </span><span class="mtk5">else</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">STATE</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> [</span><span class="mtk6">0</span><span class="mtk1">] </span><span class="mtk5">*</span><span class="mtk1"> </span><span class="mtk1">N</span>
<span class="mtk1">            </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">i</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8 mtku">range</span><span class="mtk1">(</span><span class="mtk1">N</span><span class="mtk1">):</span>
<span class="mtk1">                </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">STATE</span><span class="mtk1">[</span><span class="mtk1">i</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">int</span><span class="mtk1">(</span><span class="mtk8 mtku">os</span><span class="mtk1">.</span><span class="mtk8">urandom</span><span class="mtk1">(</span><span class="mtk6">4</span><span class="mtk1">).encode(</span><span class="mtk4">'hex'</span><span class="mtk1">), </span><span class="mtk6">16</span><span class="mtk1">)</span>  
<span class="mtk1">            </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">i</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8 mtku">range</span><span class="mtk1">(</span><span class="mtk1">N</span><span class="mtk1">):</span>
<span class="mtk1">                </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">STATE</span><span class="mtk1">[</span><span class="mtk1">i</span><span class="mtk1">] </span><span class="mtk5">^=</span><span class="mtk1"> </span><span class="mtk8 mtku">random</span><span class="mtk1">.</span><span class="mtk1">getrandbits</span><span class="mtk1">(</span><span class="mtk6">32</span><span class="mtk1">)</span>

<span class="mtk1">    </span><span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">twist</span><span class="mtk1">(</span><span class="mtk9 mtki">self</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">i</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8 mtku">range</span><span class="mtk1">(</span><span class="mtk1">N</span><span class="mtk1">):</span>
<span class="mtk1">            </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">STATE</span><span class="mtk1">[</span><span class="mtk1">i</span><span class="mtk1">] </span><span class="mtk5">^=</span><span class="mtk1"> </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk8">rol</span><span class="mtk1">(</span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">STATE</span><span class="mtk1">[(</span><span class="mtk1">i</span><span class="mtk5">+</span><span class="mtk6">1</span><span class="mtk1">) </span><span class="mtk5">%</span><span class="mtk1"> </span><span class="mtk1">N</span><span class="mtk1">], </span><span class="mtk6">3</span><span class="mtk1">)</span>
<span class="mtk1">            </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">STATE</span><span class="mtk1">[</span><span class="mtk1">i</span><span class="mtk1">] </span><span class="mtk5">^=</span><span class="mtk1"> </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk8">rol</span><span class="mtk1">(</span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">STATE</span><span class="mtk1">[(</span><span class="mtk1">i</span><span class="mtk5">+</span><span class="mtk1">M</span><span class="mtk1">) </span><span class="mtk5">%</span><span class="mtk1"> </span><span class="mtk1">N</span><span class="mtk1">], </span><span class="mtk1">b</span><span class="mtk1"> </span><span class="mtk5">-</span><span class="mtk1"> </span><span class="mtk6">9</span><span class="mtk1">)</span>
<span class="mtk1">            </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">STATE</span><span class="mtk1">[</span><span class="mtk1">i</span><span class="mtk1">] </span><span class="mtk5">^=</span><span class="mtk1"> </span><span class="mtk1">MAGIC</span>

<span class="mtk1">    </span><span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">rand</span><span class="mtk1">(</span><span class="mtk9 mtki">self</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">index</span><span class="mtk1"> </span><span class="mtk5">&gt;=</span><span class="mtk1"> </span><span class="mtk1">N</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk8">twist</span><span class="mtk1">()</span>
<span class="mtk1">            </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">index</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">0</span>
<span class="mtk1">        </span><span class="mtk1">y</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">STATE</span><span class="mtk1">[</span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">index</span><span class="mtk1">]</span>
<span class="mtk1">        </span><span class="mtk1">y</span><span class="mtk1"> </span><span class="mtk5">^=</span><span class="mtk1"> </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk8">rol</span><span class="mtk1">(</span><span class="mtk1">y</span><span class="mtk1">, </span><span class="mtk6">7</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk1">y</span><span class="mtk1"> </span><span class="mtk5">^=</span><span class="mtk1"> </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk8">rol</span><span class="mtk1">(</span><span class="mtk1">y</span><span class="mtk1">, </span><span class="mtk1">b</span><span class="mtk1"> </span><span class="mtk5">-</span><span class="mtk1"> </span><span class="mtk6">15</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">index</span><span class="mtk1"> </span><span class="mtk5">+=</span><span class="mtk1"> </span><span class="mtk6">1</span>

<span class="mtk1">        </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk1">y</span><span class="mtk1"> </span><span class="mtk5">&amp;</span><span class="mtk1"> </span><span class="mtk1">mask</span>
</code></pre></div><h2 id="configuración-del-entorno">Configuración del entorno</h2><p>En primer lugar, el código Python anterior funciona en Python versión 2. Para arreglarlo y que funcione con Python 3, necesitaremos modificar esta instrucción de <code>twister.py</code>:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk8">+       self.STATE[i] = int(os.urandom(4).hex(), 16)</span>
<span class="mtk5">-       self.STATE[i] = int(os.urandom(4).encode('hex</span><span class="mtk5">'), 16)</span>  
</code></pre></div><p>Y para hacer que <code>roulette.py</code> funcione en local, decidí eliminar el servidor de <em>socket</em> y solo usar funciones <code>print</code> e <code>input</code>:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk5">import</span><span class="mtk1"> </span><span class="mtk8 mtku">signal</span>
<span class="mtk5">from</span><span class="mtk1"> </span><span class="mtk8 mtku">twister</span><span class="mtk1"> </span><span class="mtk5">import</span><span class="mtk1"> </span><span class="mtk8 mtku">Twister</span>


<span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">handle</span><span class="mtk1">():</span>
<span class="mtk1">    </span><span class="mtk8 mtku">signal</span><span class="mtk1">.</span><span class="mtk8">alarm</span><span class="mtk1">(</span><span class="mtk6">500</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk8">print</span><span class="mtk1">(</span><span class="mtk4">"Welcome to the Casino"</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk8">print</span><span class="mtk1">(</span><span class="mtk4">"We are playing roulette today"</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">money</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">50</span>
<span class="mtk1">    </span><span class="mtk1">random</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">Twister</span><span class="mtk1">()</span>
<span class="mtk1">    </span><span class="mtk8">print</span><span class="mtk1">(</span><span class="mtk4">"The wheel stops on a number between 0 and 31."</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk8">print</span><span class="mtk1">(</span><span class="mtk4">"</span><span class="mtk6">\n</span><span class="mtk4">"</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk5">while</span><span class="mtk1"> </span><span class="mtk1">money</span><span class="mtk1"> </span><span class="mtk5">&gt;</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">:</span>
<span class="mtk1">        </span><span class="mtk8">print</span><span class="mtk1">(</span><span class="mtk4">"You have </span><span class="mtk6">{}</span><span class="mtk4"> coins"</span><span class="mtk1">.</span><span class="mtk8">format</span><span class="mtk1">(</span><span class="mtk1">money</span><span class="mtk1">))</span>
<span class="mtk1">        </span><span class="mtk8">print</span><span class="mtk1">(</span><span class="mtk4">"What would you like to bet on:"</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk8">print</span><span class="mtk1">(</span><span class="mtk4">"1) Even"</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk8">print</span><span class="mtk1">(</span><span class="mtk4">"2) Odd"</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk8">print</span><span class="mtk1">(</span><span class="mtk4">"3) Number"</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk1">option</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">int</span><span class="mtk1">(</span><span class="mtk8">input</span><span class="mtk1">(</span><span class="mtk4">"Option: "</span><span class="mtk1">).</span><span class="mtk8">strip</span><span class="mtk1">())</span>
<span class="mtk1">        </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk1">option</span><span class="mtk1"> </span><span class="mtk5">&lt;</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1"> </span><span class="mtk5">or</span><span class="mtk1"> </span><span class="mtk1">option</span><span class="mtk1"> </span><span class="mtk5">&gt;</span><span class="mtk1"> </span><span class="mtk6">3</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk8">print</span><span class="mtk1">(</span><span class="mtk4">"Invalid Option."</span><span class="mtk1">)</span>
<span class="mtk1">            </span><span class="mtk8">exit</span><span class="mtk1">()</span>
<span class="mtk1">        </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk1">option</span><span class="mtk1"> </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">3</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk1">guess</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">int</span><span class="mtk1">(</span><span class="mtk8">input</span><span class="mtk1">(</span><span class="mtk4">"Pick a number: "</span><span class="mtk1">).</span><span class="mtk8">strip</span><span class="mtk1">())</span>
<span class="mtk1">        </span><span class="mtk1">bet</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">int</span><span class="mtk1">(</span><span class="mtk8">input</span><span class="mtk1">(</span><span class="mtk4">"Bet: "</span><span class="mtk1">).</span><span class="mtk8">strip</span><span class="mtk1">())</span>
<span class="mtk1">        </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk1">bet</span><span class="mtk1"> </span><span class="mtk5">&lt;=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1"> </span><span class="mtk5">or</span><span class="mtk1"> </span><span class="mtk1">bet</span><span class="mtk1"> </span><span class="mtk5">&gt;</span><span class="mtk1"> </span><span class="mtk1">money</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk8">print</span><span class="mtk1">(</span><span class="mtk4">"Invalid Bet."</span><span class="mtk1">)</span>
<span class="mtk1">            </span><span class="mtk8">exit</span><span class="mtk1">()</span>
<span class="mtk1">        </span><span class="mtk1">number</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">random</span><span class="mtk1">.</span><span class="mtk8">rand</span><span class="mtk1">() </span><span class="mtk5">%</span><span class="mtk1"> </span><span class="mtk6">32</span>
<span class="mtk1">        </span><span class="mtk8">print</span><span class="mtk1">(</span><span class="mtk4">"The wheel stops at </span><span class="mtk6">{}</span><span class="mtk4">"</span><span class="mtk1">.</span><span class="mtk8">format</span><span class="mtk1">(</span><span class="mtk1">number</span><span class="mtk1">))</span>
<span class="mtk1">        </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk1">option</span><span class="mtk1"> </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk1">number</span><span class="mtk1"> </span><span class="mtk5">%</span><span class="mtk1"> </span><span class="mtk6">2</span><span class="mtk1"> </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">:</span>
<span class="mtk1">                </span><span class="mtk1">money</span><span class="mtk1"> </span><span class="mtk5">+=</span><span class="mtk1"> </span><span class="mtk1">bet</span>
<span class="mtk1">            </span><span class="mtk5">else</span><span class="mtk1">:</span>
<span class="mtk1">                </span><span class="mtk1">money</span><span class="mtk1"> </span><span class="mtk5">-=</span><span class="mtk1"> </span><span class="mtk1">bet</span>
<span class="mtk1">        </span><span class="mtk5">elif</span><span class="mtk1"> </span><span class="mtk1">option</span><span class="mtk1"> </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">2</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk1">number</span><span class="mtk1"> </span><span class="mtk5">%</span><span class="mtk1"> </span><span class="mtk6">2</span><span class="mtk1"> </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">:</span>
<span class="mtk1">                </span><span class="mtk1">money</span><span class="mtk1"> </span><span class="mtk5">+=</span><span class="mtk1"> </span><span class="mtk1">bet</span>
<span class="mtk1">            </span><span class="mtk5">else</span><span class="mtk1">:</span>
<span class="mtk1">                </span><span class="mtk1">money</span><span class="mtk1"> </span><span class="mtk5">-=</span><span class="mtk1"> </span><span class="mtk1">bet</span>
<span class="mtk1">        </span><span class="mtk5">elif</span><span class="mtk1"> </span><span class="mtk1">option</span><span class="mtk1"> </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">3</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk1">number</span><span class="mtk1"> </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk1">guess</span><span class="mtk1">:</span>
<span class="mtk1">                </span><span class="mtk1">money</span><span class="mtk1"> </span><span class="mtk5">+=</span><span class="mtk1"> </span><span class="mtk1">bet</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1"> </span><span class="mtk6">10</span>
<span class="mtk1">            </span><span class="mtk5">else</span><span class="mtk1">:</span>
<span class="mtk1">                </span><span class="mtk1">money</span><span class="mtk1"> </span><span class="mtk5">-=</span><span class="mtk1"> </span><span class="mtk1">bet</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1"> </span><span class="mtk6">10</span>

<span class="mtk1">        </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk1">money</span><span class="mtk1"> </span><span class="mtk5">&gt;=</span><span class="mtk1"> </span><span class="mtk6">10000000000000</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk8">print</span><span class="mtk1">(</span><span class="mtk4">"Congrats, you beat the house."</span><span class="mtk1">)</span>
<span class="mtk1">            </span><span class="mtk8">print</span><span class="mtk1">(</span><span class="mtk4">"Here's your reward: </span><span class="mtk6">{}</span><span class="mtk4">"</span><span class="mtk1">.</span><span class="mtk8">format</span><span class="mtk1">(</span><span class="mtk8">open</span><span class="mtk1">(</span><span class="mtk4">"flag.txt"</span><span class="mtk1">).</span><span class="mtk8">read</span><span class="mtk1">()))</span>  
<span class="mtk1">            </span><span class="mtk8">exit</span><span class="mtk1">()</span>
<span class="mtk1">    </span><span class="mtk8">print</span><span class="mtk1">(</span><span class="mtk4">"You ran out of money. Better luck next time."</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk8">exit</span><span class="mtk1">()</span>


<span class="mtk8">handle</span><span class="mtk1">()</span>
</code></pre></div><h2 id="análisis-del-código-fuente">Análisis del código fuente</h2><p>El servidor simula una ruleta y nos da la oportunidad de apostar. La rueda se detiene en un número entre <code>0</code> y <code>31</code>. Tenemos tres opciones:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">python3</span> <span class="mtku">roulette.py</span>
Welcome to the Casino
We are playing roulette today
The wheel stops on a number between 0 and 31.  


You have 50 coins
What would you like to bet on:
1) Even
2) Odd
3) Number
Option:
</code></pre></div><p>Luego, se nos pregunta qué cantidad de dinero queremos apostar. El servidor verificará si ganamos o perdemos la ronda:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">        </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk1">option</span><span class="mtk1"> </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">3</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk1">guess</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">int</span><span class="mtk1">(</span><span class="mtk8">input</span><span class="mtk1">(</span><span class="mtk4">"Pick a number: "</span><span class="mtk1">).</span><span class="mtk8">strip</span><span class="mtk1">())</span>  
<span class="mtk1">        </span><span class="mtk1">bet</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">int</span><span class="mtk1">(</span><span class="mtk8">input</span><span class="mtk1">(</span><span class="mtk4">"Bet: "</span><span class="mtk1">).</span><span class="mtk8">strip</span><span class="mtk1">())</span>
<span class="mtk1">        </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk1">bet</span><span class="mtk1"> </span><span class="mtk5">&lt;=</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1"> </span><span class="mtk5">or</span><span class="mtk1"> </span><span class="mtk1">bet</span><span class="mtk1"> </span><span class="mtk5">&gt;</span><span class="mtk1"> </span><span class="mtk1">money</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk8">print</span><span class="mtk1">(</span><span class="mtk4">"Invalid Bet."</span><span class="mtk1">)</span>
<span class="mtk1">            </span><span class="mtk8">exit</span><span class="mtk1">()</span>
<span class="mtk1">        </span><span class="mtk1">number</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">random</span><span class="mtk1">.</span><span class="mtk8">rand</span><span class="mtk1">() </span><span class="mtk5">%</span><span class="mtk1"> </span><span class="mtk6">32</span>
<span class="mtk1">        </span><span class="mtk8">print</span><span class="mtk1">(</span><span class="mtk4">"The wheel stops at </span><span class="mtk6">{}</span><span class="mtk4">"</span><span class="mtk1">.</span><span class="mtk8">format</span><span class="mtk1">(</span><span class="mtk1">number</span><span class="mtk1">))</span>
<span class="mtk1">        </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk1">option</span><span class="mtk1"> </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk1">number</span><span class="mtk1"> </span><span class="mtk5">%</span><span class="mtk1"> </span><span class="mtk6">2</span><span class="mtk1"> </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">0</span><span class="mtk1">:</span>
<span class="mtk1">                </span><span class="mtk1">money</span><span class="mtk1"> </span><span class="mtk5">+=</span><span class="mtk1"> </span><span class="mtk1">bet</span>
<span class="mtk1">            </span><span class="mtk5">else</span><span class="mtk1">:</span>
<span class="mtk1">                </span><span class="mtk1">money</span><span class="mtk1"> </span><span class="mtk5">-=</span><span class="mtk1"> </span><span class="mtk1">bet</span>
<span class="mtk1">        </span><span class="mtk5">elif</span><span class="mtk1"> </span><span class="mtk1">option</span><span class="mtk1"> </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">2</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk1">number</span><span class="mtk1"> </span><span class="mtk5">%</span><span class="mtk1"> </span><span class="mtk6">2</span><span class="mtk1"> </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">:</span>
<span class="mtk1">                </span><span class="mtk1">money</span><span class="mtk1"> </span><span class="mtk5">+=</span><span class="mtk1"> </span><span class="mtk1">bet</span>
<span class="mtk1">            </span><span class="mtk5">else</span><span class="mtk1">:</span>
<span class="mtk1">                </span><span class="mtk1">money</span><span class="mtk1"> </span><span class="mtk5">-=</span><span class="mtk1"> </span><span class="mtk1">bet</span>
<span class="mtk1">        </span><span class="mtk5">elif</span><span class="mtk1"> </span><span class="mtk1">option</span><span class="mtk1"> </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk6">3</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk1">number</span><span class="mtk1"> </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk1">guess</span><span class="mtk1">:</span>
<span class="mtk1">                </span><span class="mtk1">money</span><span class="mtk1"> </span><span class="mtk5">+=</span><span class="mtk1"> </span><span class="mtk1">bet</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1"> </span><span class="mtk6">10</span>
<span class="mtk1">            </span><span class="mtk5">else</span><span class="mtk1">:</span>
<span class="mtk1">                </span><span class="mtk1">money</span><span class="mtk1"> </span><span class="mtk5">-=</span><span class="mtk1"> </span><span class="mtk1">bet</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1"> </span><span class="mtk6">10</span>
</code></pre></div><p>Para la opción <code>3</code>, la apuesta se multiplica por <code>10</code>, ya que es más difícil adivinar el número exacto (probabilidad de $1/32$) que la paridad del número (probabilidad de $1/2$).</p><p>Obtendremos la <em>flag</em> cuando lleguemos a <code>10000000000000</code> monedas ($10^{13}$).</p><p>Como limitación, hay un <em>timeout</em> de 500 segundos (8 minutos y 20 segundos):</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">    </span><span class="mtk8 mtku">signal</span><span class="mtk1">.</span><span class="mtk8">alarm</span><span class="mtk1">(</span><span class="mtk6">500</span><span class="mtk1">)</span>  
</code></pre></div><p>Por lo tanto, no será suficiente usar las opciones <code>1</code> y <code>2</code> para obtener la <em>flag</em>, ya que necesitaremos muchas rondas. Solo para probarlo, supongamos que tenemos una forma de predecir la paridad del número de cada ronda, y tenemos $C$ monedas en la ronda $k$. Apostaremos la cantidad máxima de dinero que tenemos en cada ronda para maximizar los resultados. Sea $M_k = C$, entonces:</p><p class="scroll">$$
\begin{align}
M_{k + 1} & = M_k + M_k & = 2 C \\
M_{k + 2} & = M_{k + 1} + M_{k + 1} & = 4 C \\
M_{k + 3} & = M_{k + 2} + M_{k + 2} & = 8 C \\
\dots \\
M_{k + n} & = M_{k + n - 1} + M_{k + n - 1} & = 2^n C
\end{align}
$$</p><p>Así, conseguimos que $M_{k + n} = 2^n C = 10^{13}$, luego $n = \log_{2}{\frac{10^{13}}{C}}$. Por tanto, asumiendo $C = 1$, necesitaremos un mínimo de $n = 44$ para obtener más de $10^{13}$ monedas.</p><p>En cambio, es mejor usar la opción <code>3</code>, donde la apuesta se multiplica por $10$:</p><p class="scroll">$$
\begin{align}
M_{k + 1} & = M_k + 10 \cdot M_k & = 11 C \\
M_{k + 2} & = M_{k + 1} + 10 \cdot M_{k + 1} & = 121 C \\
M_{k + 3} & = M_{k + 2} + 10 \cdot M_{k + 2} & = 1331 C \\
\dots \\
M_{k + n} & = M_{k + n - 1} + 10 \cdot M_{k + n - 1} & = 11^n C
\end{align}
$$</p><p>Ahora tenemos que $M_{k + n} = 11^n C = 10^{13}$, por lo que $n = \log_{11}{\frac{10^{13}}{C}}$, que resulta en $n = 13$ para $C = 1$.</p><p>Bueno. De todos modos, ambos enfoques son factibles. Pero para implementarlos, necesitaremos predecir las salidas del PRNG.</p><h2 id="prng">PRNG</h2><p>El servidor usa la clase <code>Twister</code> como PRNG:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">    </span><span class="mtk1">random</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">Twister</span><span class="mtk1">()</span>  
</code></pre></div><p>Para cada ronda, el siguiente paso del PRNG se calcula con <code>random.rand</code>, aunque el resultado se reduce $\mod{32}$ (es decir, se nos dan los 5 bits menos significativos de las salidas):</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">        </span><span class="mtk1">number</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">random</span><span class="mtk1">.</span><span class="mtk8">rand</span><span class="mtk1">() </span><span class="mtk5">%</span><span class="mtk1"> </span><span class="mtk6">32</span>
<span class="mtk1">        </span><span class="mtk8">print</span><span class="mtk1">(</span><span class="mtk4">"The wheel stops at </span><span class="mtk6">{}</span><span class="mtk4">"</span><span class="mtk1">.</span><span class="mtk8">format</span><span class="mtk1">(</span><span class="mtk1">number</span><span class="mtk1">))</span>  
</code></pre></div><p>No importa si ganamos o perdemos, el resultado siempre se muestra.</p><h3 id="generación-del-estado">Generación del estado</h3><p>Cuando la clase <code>Twister</code> se instancia, el atributo <code>STATE</code> se genera de forma aleatoria:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">    </span><span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk7">__init__</span><span class="mtk1">(</span><span class="mtk9 mtki">self</span><span class="mtk1">, </span><span class="mtk9 mtki">state</span><span class="mtk5">=</span><span class="mtk6">None</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">index</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">N</span>
<span class="mtk1">        </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk9 mtki">state</span><span class="mtk1"> </span><span class="mtk5">is</span><span class="mtk1"> </span><span class="mtk5">not</span><span class="mtk1"> </span><span class="mtk6">None</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk5">assert</span><span class="mtk1"> </span><span class="mtk8">len</span><span class="mtk1">(</span><span class="mtk9 mtki">state</span><span class="mtk1">) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk1">N</span>
<span class="mtk1">            </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">STATE</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk9 mtki">state</span><span class="mtk1">[:]</span>
<span class="mtk1">        </span><span class="mtk5">else</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">STATE</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> [</span><span class="mtk6">0</span><span class="mtk1">] </span><span class="mtk5">*</span><span class="mtk1"> </span><span class="mtk1">N</span>
<span class="mtk1">            </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">i</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8 mtku">range</span><span class="mtk1">(</span><span class="mtk1">N</span><span class="mtk1">):</span>
<span class="mtk1">                </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">STATE</span><span class="mtk1">[</span><span class="mtk1">i</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">int</span><span class="mtk1">(</span><span class="mtk8 mtku">os</span><span class="mtk1">.</span><span class="mtk8">urandom</span><span class="mtk1">(</span><span class="mtk6">4</span><span class="mtk1">).</span><span class="mtk8">hex</span><span class="mtk1">(), </span><span class="mtk6">16</span><span class="mtk1">)</span>  
<span class="mtk1">            </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">i</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8 mtku">range</span><span class="mtk1">(</span><span class="mtk1">N</span><span class="mtk1">):</span>
<span class="mtk1">                </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">STATE</span><span class="mtk1">[</span><span class="mtk1">i</span><span class="mtk1">] </span><span class="mtk5">^=</span><span class="mtk1"> </span><span class="mtk8 mtku">random</span><span class="mtk1">.</span><span class="mtk1">getrandbits</span><span class="mtk1">(</span><span class="mtk6">32</span><span class="mtk1">)</span>
</code></pre></div><p>El <code>STATE</code> se compone de 128 valores (<code>N = 128</code>), que son enteros de 32 bits (4 bytes). Se emplea <code>os.urandom</code>, que es un generador de números aleatorios criptográficamente seguro. El uso de <code>random.getrandbits(32)</code> no es relevante, ya que el <code>STATE</code> se genera solo una vez.</p><h3 id="salidas-aleatorias">Salidas aleatorias</h3><p>Este es el método <code>rand</code> (donde <code>b = 32</code> y <code>mask = 0xffffffff</code>):</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">    </span><span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">rand</span><span class="mtk1">(</span><span class="mtk9 mtki">self</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">index</span><span class="mtk1"> </span><span class="mtk5">&gt;=</span><span class="mtk1"> </span><span class="mtk1">N</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk8">twist</span><span class="mtk1">()</span>
<span class="mtk1">            </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">index</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">0</span>
<span class="mtk1">        </span><span class="mtk1">y</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">STATE</span><span class="mtk1">[</span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">index</span><span class="mtk1">]</span>  
<span class="mtk1">        </span><span class="mtk1">y</span><span class="mtk1"> </span><span class="mtk5">^=</span><span class="mtk1"> </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk8">rol</span><span class="mtk1">(</span><span class="mtk1">y</span><span class="mtk1">, </span><span class="mtk6">7</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk1">y</span><span class="mtk1"> </span><span class="mtk5">^=</span><span class="mtk1"> </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk8">rol</span><span class="mtk1">(</span><span class="mtk1">y</span><span class="mtk1">, </span><span class="mtk1">b</span><span class="mtk1"> </span><span class="mtk5">-</span><span class="mtk1"> </span><span class="mtk6">15</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">index</span><span class="mtk1"> </span><span class="mtk5">+=</span><span class="mtk1"> </span><span class="mtk6">1</span>

<span class="mtk1">        </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk1">y</span><span class="mtk1"> </span><span class="mtk5">&amp;</span><span class="mtk1"> </span><span class="mtk1">mask</span>
</code></pre></div><p>Olvidemos el bloque <code>if</code> de momento, el método <code>rand</code> toma un número determinado del <code>STATE</code> (en <code>self.index</code>) y realiza algunas operaciones binarias. Esto es <code>rol</code> (rotación hacia la izquierda):</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">    </span><span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">rol</span><span class="mtk1">(</span><span class="mtk9 mtki">self</span><span class="mtk1">, </span><span class="mtk9 mtki">x</span><span class="mtk1">, </span><span class="mtk9 mtki">d</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk1">ans</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> (</span><span class="mtk9 mtki">x</span><span class="mtk1"> </span><span class="mtk5">&lt;&lt;</span><span class="mtk1"> </span><span class="mtk9 mtki">d</span><span class="mtk1">) </span><span class="mtk5">&amp;</span><span class="mtk1"> </span><span class="mtk1">mask</span>
<span class="mtk1">        </span><span class="mtk1">ans</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">ans</span><span class="mtk1"> </span><span class="mtk5">|</span><span class="mtk1"> (</span><span class="mtk9 mtki">x</span><span class="mtk1"> </span><span class="mtk5">&gt;&gt;</span><span class="mtk1"> (</span><span class="mtk1">b</span><span class="mtk1"> </span><span class="mtk5">-</span><span class="mtk1"> </span><span class="mtk9 mtki">d</span><span class="mtk1">))</span>  
<span class="mtk1">        </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk1">ans</span><span class="mtk1"> </span><span class="mtk5">&amp;</span><span class="mtk1"> </span><span class="mtk1">mask</span>
</code></pre></div><p>Digamos que $(y_0, y_1, \dots, y_{30}, y_{31})$ son los bits de <code>STATE[self.index]</code> ($y_{31}$ es el bit más significativo). En otras palabras,</p><p><code>STATE[self.index]</code> $= \displaystyle\sum_{i = 0}^{31} y_i \cdot 2^i$</p><p>Entonces, <code>self.rol(y, 7)</code> es $(y_{25}, y_{26}, \dots, y_{31}, y_0, y_1, \dots, y_{24})$.</p><p>Por razones de simplicidad, calcularemos los valores intermedios:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">        </span><span class="mtk1">y</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">STATE</span><span class="mtk1">[</span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">index</span><span class="mtk1">]</span>  
<span class="mtk1">        </span><span class="mtk1">r</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk8">rol</span><span class="mtk1">(</span><span class="mtk1">y</span><span class="mtk1">, </span><span class="mtk6">7</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk1">s</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">y</span><span class="mtk1"> </span><span class="mtk5">^</span><span class="mtk1"> </span><span class="mtk1">r</span>
<span class="mtk1">        </span><span class="mtk1">t</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk8">rol</span><span class="mtk1">(</span><span class="mtk1">s</span><span class="mtk1">, </span><span class="mtk1">b</span><span class="mtk1"> </span><span class="mtk5">-</span><span class="mtk1"> </span><span class="mtk6">15</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk1">u</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">s</span><span class="mtk1"> </span><span class="mtk5">^</span><span class="mtk1"> </span><span class="mtk1">t</span>
</code></pre></div><p>Ahora podemos decir que $r_i = y_{i + 25}$. Entonces tenemos que $s_i = y_i \oplus r_i = y_i \oplus y_{i + 25}$.</p><p>Después, $t_i = s_{i + 15} = y_{i + 15} \oplus y_{i + 40}$, que se traduce en $t_i = y_{i + 8} \oplus y_{i + 15}$ ya que $40 \equiv 8 \pmod{32}$.</p><p>Finalmente, $u_i = s_i \oplus t_i$, que es lo mismo que</p><p class="scroll">$$
u_i = y_i \oplus y_{i + 8} \oplus y_{i + 15} \oplus y_{i + 25}
$$</p><p>Recordemos que solo se nos muestran los últimos 5 bits, por lo que sabemos $(u_0, u_1, u_2, u_3, u_4)$ después de cada ronda:</p><p class="scroll">$$
\begin{cases}
u_0 & = y_0 \oplus y_8 \oplus y_{15} \oplus y_{25} \\
u_1 & = y_1 \oplus y_9 \oplus y_{16} \oplus y_{26} \\
u_2 & = y_2 \oplus y_{10} \oplus y_{17} \oplus y_{27} \\
u_3 & = y_3 \oplus y_{11} \oplus y_{18} \oplus y_{28} \\
u_4 & = y_4 \oplus y_{12} \oplus y_{19} \oplus y_{29}
\end{cases}
$$</p><p>Podemos verificar que las expresiones anteriores sean correctas usando Python (cargando <code>twister.py</code>):</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">python3</span> -i <span class="mtku">twister.py</span>
&gt;&gt;&gt; random = Twister()
&gt;&gt;&gt; random.index = 0
&gt;&gt;&gt;
&gt;&gt;&gt; def bits(n):
...     return list(map(int, f'{n:032b}'))[::-1]
...
&gt;&gt;&gt; y = bits(random.STATE[0])
&gt;&gt;&gt; output = random.rand() % 32
&gt;&gt;&gt; u = bits(output)[:5]
&gt;&gt;&gt; for i in range(5):
...     print(u[i] == y[i] ^ y[i + 8] ^ y[i + 15] ^ y[i + 25])  
...
True
True
True
True
True
&gt;&gt;&gt;
</code></pre></div><p>Podemos realizar las mismas verificaciones para los 128 valores del estado:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">python3</span> -i <span class="mtku">twister.py</span>
&gt;&gt;&gt; random = Twister()
&gt;&gt;&gt; random.index = 0
&gt;&gt;&gt;
&gt;&gt;&gt; def bits(n):
...     return list(map(int, f'{n:032b}'))[::-1]
...
&gt;&gt;&gt; for k in range(128):
...     y = bits(random.STATE[k])
...     output = random.rand() % 32
...     u = bits(output)[:5]
...     for i in range(5):
...         assert u[i] == y[i] ^ y[i + 8] ^ y[i + 15] ^ y[i + 25]  
...
&gt;&gt;&gt;
</code></pre></div><p>Hay que tener en cuenta que estamos haciendo trampa, porque estamos tomando el valor actual del estado y guardándolo en la variable <code>y</code>. Para resolver el reto, nuestro objetivo es recuperar la variable <code>y</code> a partir de los valores de <code>u</code>, que son los valores que el servidor muestra en cada ronda.</p><p>Para cada ronda, obtendremos 5 ecuaciones que involucran 20 variables binarias (es decir, $y_i \in \{0, 1\}$). Esto significa que podemos trabajar en $\mathbb{F}_2$, cuál es el cuerpo finito de dos elementos, donde AND es la multiplicación y XOR es la suma.</p><p>Dado que el estado está compuesto por 128 números de 32 bits, modelaremos el estado como un total de 4096 variables binarias. Una vez que completemos 128 rondas, tendremos un total de 640 ecuaciones que involucran 2560 variables. Esto no es suficiente para recuperar completamente el estado.</p><h3 id="_twister_"><em>Twister</em></h3><p>Además, si el algoritmo PRNG regresara a <code>self.STATE[0]</code> sin ninguna modificación, el PRNG tendría un ciclo de 128 rondas, siendo fácilmente comprometido. Sin embargo, hay un paso de <em>twist</em> cuando <code>self.index</code> es igual a <code>N</code> (<code>128</code>):</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">    </span><span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">twist</span><span class="mtk1">(</span><span class="mtk9 mtki">self</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">i</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8 mtku">range</span><span class="mtk1">(</span><span class="mtk1">N</span><span class="mtk1">):</span>
<span class="mtk1">            </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">STATE</span><span class="mtk1">[</span><span class="mtk1">i</span><span class="mtk1">] </span><span class="mtk5">^=</span><span class="mtk1"> </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk8">rol</span><span class="mtk1">(</span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">STATE</span><span class="mtk1">[(</span><span class="mtk1">i</span><span class="mtk5">+</span><span class="mtk6">1</span><span class="mtk1">) </span><span class="mtk5">%</span><span class="mtk1"> </span><span class="mtk1">N</span><span class="mtk1">], </span><span class="mtk6">3</span><span class="mtk1">)</span>
<span class="mtk1">            </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">STATE</span><span class="mtk1">[</span><span class="mtk1">i</span><span class="mtk1">] </span><span class="mtk5">^=</span><span class="mtk1"> </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk8">rol</span><span class="mtk1">(</span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">STATE</span><span class="mtk1">[(</span><span class="mtk1">i</span><span class="mtk5">+</span><span class="mtk1">M</span><span class="mtk1">) </span><span class="mtk5">%</span><span class="mtk1"> </span><span class="mtk1">N</span><span class="mtk1">], </span><span class="mtk1">b</span><span class="mtk1"> </span><span class="mtk5">-</span><span class="mtk1"> </span><span class="mtk6">9</span><span class="mtk1">)</span>  
<span class="mtk1">            </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">STATE</span><span class="mtk1">[</span><span class="mtk1">i</span><span class="mtk1">] </span><span class="mtk5">^=</span><span class="mtk1"> </span><span class="mtk1">MAGIC</span>
</code></pre></div><p>Cada valor de estado se actualiza utilizando XOR y <code>self.rol</code> respecto al siguiente valor de estado a la derecha y al valor a 30 posiciones a la derecha (<code>M = 30</code>). Luego, el resultado se ajusta con un valor <code>MAGIC</code>. Podríamos expresar el código de Python anterior en términos matemáticos para comprender mejor cómo funciona el método <code>twist</code>. Sin embargo, no es relevante para resolver el reto, ya que usaremos cálculos simbólicos.</p><p>Además, es muy complejo modelar el método <code>twist</code> en términos matemáticos, ya que <code>STATE[98]</code> se actualizará según <code>STATE[99]</code> y <code>STATE[0]</code> (se da la vuelta); y este valor de <code>STATE[0]</code> se actualizó dentro de la misma llamada a <code>twist</code>, por lo que tendremos algunos casos especiales (desde <code>STATE[98]</code> hasta <code>STATE[127]</code>) que deberían ser considerados si se quisieran escribir las ecuaciones a mano.</p><p>El método <code>twist</code> obligará a todas las variables a aparecer al menos una vez en las ecuaciones posteriores, de modo que el sistema de ecuaciones que resolveremos tiene una solución única.</p><p>Además, la primera llamada a <code>rand</code> llamará a <code>twist</code> porque <code>self.index = N</code> cuando se instancia la clase. Esto no ocasiona problemas, ya que se puede asumir que el estado inicial es el que se obtiene después de esta llamada inicial a <code>twist</code>.</p><p>En este punto, podemos decir que esta clase <code>Twister</code> implementa una variante de <a href="https://en.wikipedia.org/wiki/Mersenne_Twister">Mersenne Twister</a>, que es un PRNG usado en el módulo <a href="https://docs.python.org/es/3/library/random.html"><code>random</code></a> de Python, por ejemplo.</p><h3 id="modelo-del-prng">Modelo del PRNG</h3><p>Ya sabemos que el estado del PRNG puede interpretarse como una lista de 4096 variables binarias. Además, todas las operaciones involucradas son XOR y rotaciones hacia la izquierda, que se pueden adaptar fácilmente a $\mathbb{F}_2$. Usaremos SageMath para trabajar con un polinomio booleano en este cuerpo:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">F</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> GF(</span><span class="mtk6">2</span><span class="mtk1">)</span>
<span class="mtk1">P</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> BooleanPolynomialRing(</span><span class="mtk9 mtki">names</span><span class="mtk5">=</span><span class="mtk4">','</span><span class="mtk1">.</span><span class="mtk8">join</span><span class="mtk1">(</span><span class="mtk7 mtki">f</span><span class="mtk4">'y</span><span class="mtk6">{</span><span class="mtk1">i</span><span class="mtk6">}</span><span class="mtk4">'</span><span class="mtk1"> </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">i</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8 mtku">range</span><span class="mtk1">(</span><span class="mtk1">N</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1"> </span><span class="mtk1">b</span><span class="mtk1">)))</span>  
</code></pre></div><p>Luego, podemos tomar las variables del polinomio y usarlas para crear un estado variable:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">    </span><span class="mtk1">var_state</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> []</span>

<span class="mtk1">    </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">k</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8 mtku">range</span><span class="mtk1">(</span><span class="mtk6">0</span><span class="mtk1">, </span><span class="mtk1">N</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1"> </span><span class="mtk1">b</span><span class="mtk1">, </span><span class="mtk1">b</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk1">var_state</span><span class="mtk1">.</span><span class="mtk8">append</span><span class="mtk1">([</span><span class="mtk1">P</span><span class="mtk1">.gens()[</span><span class="mtk1">i</span><span class="mtk1">] </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">i</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8 mtku">range</span><span class="mtk1">(</span><span class="mtk1">k</span><span class="mtk1">, </span><span class="mtk1">k</span><span class="mtk1"> </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk1">b</span><span class="mtk1">)])</span>  

<span class="mtk1">    </span><span class="mtk1">var_twister</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">VarTwister</span><span class="mtk1">(</span><span class="mtk1">var_state</span><span class="mtk1">)</span>
</code></pre></div><p>Como se puede ver, estoy usando una clase <code>VarTwister</code>, que es solo una clase <code>Twister</code> que funciona con variables binarias en SageMath:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">bits</span><span class="mtk1">(</span><span class="mtk9 mtki">n</span><span class="mtk1">):</span>
<span class="mtk1">    </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk8 mtku">list</span><span class="mtk1">(</span><span class="mtk8 mtku">map</span><span class="mtk1">(</span><span class="mtk1">F</span><span class="mtk1">, </span><span class="mtk7 mtki">f</span><span class="mtk4">'</span><span class="mtk6">{</span><span class="mtk9 mtki">n</span><span class="mtk7 mtki">:032b</span><span class="mtk6">}</span><span class="mtk4">'</span><span class="mtk1">))[::</span><span class="mtk5">-</span><span class="mtk6">1</span><span class="mtk1">]</span>


<span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">xor</span><span class="mtk1">(</span><span class="mtk9 mtki">a</span><span class="mtk1">, </span><span class="mtk9 mtki">b</span><span class="mtk1">):</span>
<span class="mtk1">    </span><span class="mtk5">return</span><span class="mtk1"> [</span><span class="mtk1">a_i</span><span class="mtk1"> </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk1">b_i</span><span class="mtk1"> </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">a_i</span><span class="mtk1">, </span><span class="mtk1">b_i</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8 mtku">zip</span><span class="mtk1">(</span><span class="mtk9 mtki">a</span><span class="mtk1">, </span><span class="mtk9 mtki">b</span><span class="mtk1">)]</span>


<span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">rol</span><span class="mtk1">(</span><span class="mtk9 mtki">x</span><span class="mtk1">, </span><span class="mtk9 mtki">d</span><span class="mtk1">):</span>
<span class="mtk1">    </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk9 mtki">x</span><span class="mtk1">[</span><span class="mtk5">-</span><span class="mtk9 mtki">d</span><span class="mtk1">:] </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk9 mtki">x</span><span class="mtk1">[:</span><span class="mtk5">-</span><span class="mtk9 mtki">d</span><span class="mtk1">]</span>


<span class="mtk7 mtki">class</span><span class="mtk1"> </span><span class="mtk8 mtku">VarTwister</span><span class="mtk1">:</span>
<span class="mtk1">    </span><span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk7">__init__</span><span class="mtk1">(</span><span class="mtk9 mtki">self</span><span class="mtk1">, </span><span class="mtk9 mtki">state</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">index</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">0</span>
<span class="mtk1">        </span><span class="mtk5">assert</span><span class="mtk1"> </span><span class="mtk8">len</span><span class="mtk1">(</span><span class="mtk9 mtki">state</span><span class="mtk1">) </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk1">N</span>
<span class="mtk1">        </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">STATE</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk9 mtki">state</span><span class="mtk1">[:]</span>

<span class="mtk1">    </span><span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">twist</span><span class="mtk1">(</span><span class="mtk9 mtki">self</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">i</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8 mtku">range</span><span class="mtk1">(</span><span class="mtk1">N</span><span class="mtk1">):</span>
<span class="mtk1">            </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">STATE</span><span class="mtk1">[</span><span class="mtk1">i</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">xor</span><span class="mtk1">(</span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">STATE</span><span class="mtk1">[</span><span class="mtk1">i</span><span class="mtk1">], </span><span class="mtk8">rol</span><span class="mtk1">(</span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">STATE</span><span class="mtk1">[(</span><span class="mtk1">i</span><span class="mtk1"> </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">) </span><span class="mtk5">%</span><span class="mtk1"> </span><span class="mtk1">N</span><span class="mtk1">], </span><span class="mtk6">3</span><span class="mtk1">))</span>
<span class="mtk1">            </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">STATE</span><span class="mtk1">[</span><span class="mtk1">i</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">xor</span><span class="mtk1">(</span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">STATE</span><span class="mtk1">[</span><span class="mtk1">i</span><span class="mtk1">], </span><span class="mtk8">rol</span><span class="mtk1">(</span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">STATE</span><span class="mtk1">[(</span><span class="mtk1">i</span><span class="mtk1"> </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk1">M</span><span class="mtk1">) </span><span class="mtk5">%</span><span class="mtk1"> </span><span class="mtk1">N</span><span class="mtk1">], </span><span class="mtk1">b</span><span class="mtk1"> </span><span class="mtk5">-</span><span class="mtk1"> </span><span class="mtk6">9</span><span class="mtk1">))</span>  
<span class="mtk1">            </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">STATE</span><span class="mtk1">[</span><span class="mtk1">i</span><span class="mtk1">] </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">xor</span><span class="mtk1">(</span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">STATE</span><span class="mtk1">[</span><span class="mtk1">i</span><span class="mtk1">], </span><span class="mtk8">bits</span><span class="mtk1">(</span><span class="mtk1">MAGIC</span><span class="mtk1">))</span>

<span class="mtk1">    </span><span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">rand</span><span class="mtk1">(</span><span class="mtk9 mtki">self</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">index</span><span class="mtk1"> </span><span class="mtk5">&gt;=</span><span class="mtk1"> </span><span class="mtk1">N</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk8">twist</span><span class="mtk1">()</span>
<span class="mtk1">            </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">index</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">0</span>

<span class="mtk1">        </span><span class="mtk1">y</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">STATE</span><span class="mtk1">[</span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">index</span><span class="mtk1">]</span>
<span class="mtk1">        </span><span class="mtk1">y</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">xor</span><span class="mtk1">(</span><span class="mtk1">y</span><span class="mtk1">, </span><span class="mtk8">rol</span><span class="mtk1">(</span><span class="mtk1">y</span><span class="mtk1">, </span><span class="mtk6">7</span><span class="mtk1">))</span>
<span class="mtk1">        </span><span class="mtk1">y</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">xor</span><span class="mtk1">(</span><span class="mtk1">y</span><span class="mtk1">, </span><span class="mtk8">rol</span><span class="mtk1">(</span><span class="mtk1">y</span><span class="mtk1">, </span><span class="mtk1">b</span><span class="mtk1"> </span><span class="mtk5">-</span><span class="mtk1"> </span><span class="mtk6">15</span><span class="mtk1">))</span>
<span class="mtk1">        </span><span class="mtk9 mtki">self</span><span class="mtk1">.</span><span class="mtk1">index</span><span class="mtk1"> </span><span class="mtk5">+=</span><span class="mtk1"> </span><span class="mtk6">1</span>
<span class="mtk1">        </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk1">y</span><span class="mtk1">[:</span><span class="mtk1">b</span><span class="mtk1">]</span>
</code></pre></div><p>Obsérvese que también las funciones <code>xor</code> y <code>rol</code> han cambiado un poco.</p><p>En este punto, cada vez que usemos <code>var_twister.rand</code>, SageMath realizará todos los cálculos simbólicamente con las 4096 variables. Como resultado, podemos solicitar al menos 4096 bits de salidas del PRNG para que podamos igualar las ecuaciones anteriores con los bits. Al final, resolveremos un sistema de ecuaciones en 4096 variables binarias, cuya solución es el estado inicial del PRNG.</p><p>Veamos si las ecuaciones escritas a mano coinciden con las de SageMath:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">sage</span> -q
<span class="sage-blue">sage: </span>N = <span class="sage-blue">128</span>
<span class="sage-blue">sage: </span>M = <span class="sage-blue">30</span>
<span class="sage-blue">sage: </span>b = <span class="sage-blue">32</span>
<span class="sage-blue">sage: </span>MAGIC = <span class="sage-blue">0xb249b015</span>
<span class="sage-blue">sage:</span>
<span class="sage-blue">sage: </span>F = GF(<span class="sage-blue">2</span>)
<span class="sage-blue">sage: </span>P = BooleanPolynomialRing(names=<span class="code-bg-white sage-red">','</span>.join(<span class="code-bg-white sage-red">f'y<span class="sage-light-blue">{</span></span>i<span class="code-bg-white sage-red"><span class="sage-light-blue">}</span>'</span> <span class="sage-green">for</span> i <span class="sage-green">in</span> <span class="sage-turkish">range</span>(N * b)))
<span class="sage-blue">sage:</span>
<span class="sage-blue">sage:</span> <span class="sage-green">def</span> <span class="sage-deep-blue">bits</span>(n):
<span class="sage-blue">....: </span>    <span class="sage-green">return</span> <span class="sage-turkish">list</span>(<span class="sage-turkish">map</span>(F, <span class="code-bg-white sage-red">f'<span class="sage-light-blue">{</span></span>n<span class="code-bg-white sage-red"><span class="sage-light-blue">:</span>032b<span class="sage-light-blue">}</span>'</span>))[::-<span class="sage-blue">1</span>]
<span class="sage-blue">....:</span>
<span class="sage-blue">sage:</span> <span class="sage-green">def</span> <span class="sage-deep-blue">xor</span>(a, b):
<span class="sage-blue">....: </span>    <span class="sage-green">return</span> [a_i + b_i <span class="sage-green">for</span> a_i, b_i <span class="sage-green">in</span> <span class="sage-turkish">zip</span>(a, b)]
<span class="sage-blue">....:</span>
<span class="sage-blue">sage:</span> <span class="sage-green">def</span> <span class="sage-deep-blue">rol</span>(x, d):
<span class="sage-blue">....: </span>    <span class="sage-green">return</span> x[-d:] + x[:-d]
<span class="sage-blue">....:</span>
<span class="sage-blue">sage:</span> <span class="sage-green">class</span> <span class="sage-red-purple">VarTwister</span>:
<span class="sage-blue">....: </span>    <span class="sage-green">def</span> <span class="sage-deep-blue">__init__</span>(<span class="sage-turkish">self</span>, state):
<span class="sage-blue">....: </span>        <span class="sage-turkish">self</span>.index = <span class="sage-blue">0</span>
<span class="sage-blue">....: </span>        <span class="sage-green">assert</span> <span class="sage-turkish">len</span>(state) == N
<span class="sage-blue">....: </span>        <span class="sage-turkish">self</span>.STATE = state[:]
<span class="sage-blue">....:</span>
<span class="sage-blue">....: </span>    <span class="sage-green">def</span> <span class="sage-deep-blue">twist</span>(<span class="sage-turkish">self</span>):
<span class="sage-blue">....: </span>        <span class="sage-green">for</span> i <span class="sage-green">in</span> <span class="sage-turkish">range</span>(N):
<span class="sage-blue">....: </span>            <span class="sage-turkish">self</span>.STATE[i] = xor(<span class="sage-turkish">self</span>.STATE[i], rol(<span class="sage-turkish">self</span>.STATE[(i + <span class="sage-blue">1</span>) % N], <span class="sage-blue">3</span>))
<span class="sage-blue">....: </span>            <span class="sage-turkish">self</span>.STATE[i] = xor(<span class="sage-turkish">self</span>.STATE[i], rol(<span class="sage-turkish">self</span>.STATE[(i + M) % N], b - <span class="sage-blue">9</span>))  
<span class="sage-blue">....: </span>            <span class="sage-turkish">self</span>.STATE[i] = xor(<span class="sage-turkish">self</span>.STATE[i], bits(MAGIC))
<span class="sage-blue">....:</span>
<span class="sage-blue">....: </span>    <span class="sage-green">def</span> <span class="sage-deep-blue">rand</span>(<span class="sage-turkish">self</span>):
<span class="sage-blue">....: </span>        <span class="sage-green">if</span> <span class="sage-turkish">self</span>.index &gt;= N:
<span class="sage-blue">....: </span>            <span class="sage-turkish">self</span>.twist()
<span class="sage-blue">....: </span>            <span class="sage-turkish">self</span>.index = <span class="sage-blue">0</span>
<span class="sage-blue">....:</span>
<span class="sage-blue">....: </span>        y = <span class="sage-turkish">self</span>.STATE[<span class="sage-turkish">self</span>.index]
<span class="sage-blue">....: </span>        y = xor(y, rol(y, <span class="sage-blue">7</span>))
<span class="sage-blue">....: </span>        y = xor(y, rol(y, b - <span class="sage-blue">15</span>))
<span class="sage-blue">....: </span>        <span class="sage-turkish">self</span>.index += <span class="sage-blue">1</span>
<span class="sage-blue">....: </span>        <span class="sage-green">return</span> y[:b]
<span class="sage-blue">....:</span>
<span class="sage-blue">sage: </span>var_state = []
<span class="sage-blue">sage:</span>
<span class="sage-blue">sage:</span> <span class="sage-green">for</span> k <span class="sage-green">in</span> <span class="sage-turkish">range</span>(<span class="sage-blue">0</span>, N * b, b):
<span class="sage-blue">....: </span>        var_state.append([P.gens()[i] <span class="sage-green">for</span> i <span class="sage-green">in</span> <span class="sage-turkish">range</span>(k, k + b)])
<span class="sage-blue">....:</span>
<span class="sage-blue">sage: </span>var_twister = VarTwister(var_state)
<span class="sage-blue">sage: </span>u = var_twister.rand()
<span class="sage-blue">sage:</span>
<span class="sage-blue">sage: </span>u[<span class="sage-blue">0</span>]
y0 + y8 + y15 + y25
<span class="sage-blue">sage: </span>u[<span class="sage-blue">1</span>]
y1 + y9 + y16 + y26
<span class="sage-blue">sage: </span>u[<span class="sage-blue">2</span>]
y2 + y10 + y17 + y27
<span class="sage-blue">sage: </span>u[<span class="sage-blue">3</span>]
y3 + y11 + y18 + y28
<span class="sage-blue">sage: </span>u[<span class="sage-blue">4</span>]
y4 + y12 + y19 + y29
</code></pre></div><p>¡Perfecto, es correcto!</p><h2 id="solución">Solución</h2><p>Usaremos esta función de ayuda para apostar:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">EVEN</span><span class="mtk1">, </span><span class="mtk1">ODD</span><span class="mtk1">, </span><span class="mtk1">NUMBER</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">1</span><span class="mtk1">, </span><span class="mtk6">2</span><span class="mtk1">, </span><span class="mtk6">3</span>


<span class="mtk7 mtki">def</span><span class="mtk1"> </span><span class="mtk8">bet</span><span class="mtk1">(</span><span class="mtk9 mtki">option</span><span class="mtk5">=</span><span class="mtk1">ODD</span><span class="mtk1">, </span><span class="mtk9 mtki">amount</span><span class="mtk5">=</span><span class="mtk6">1</span><span class="mtk1">, </span><span class="mtk9 mtki">number</span><span class="mtk5">=</span><span class="mtk6">0</span><span class="mtk1">):</span>
<span class="mtk1">    </span><span class="mtk1">io</span><span class="mtk1">.</span><span class="mtk8">sendlineafter</span><span class="mtk1">(</span><span class="mtk7 mtki">b</span><span class="mtk4">'Option: '</span><span class="mtk1">, </span><span class="mtk8 mtku">str</span><span class="mtk1">(</span><span class="mtk9 mtki">option</span><span class="mtk1">).</span><span class="mtk8">encode</span><span class="mtk1">())</span>

<span class="mtk1">    </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk9 mtki">option</span><span class="mtk1"> </span><span class="mtk5">==</span><span class="mtk1"> </span><span class="mtk1">NUMBER</span><span class="mtk1">:</span>
<span class="mtk1">        </span><span class="mtk1">io</span><span class="mtk1">.</span><span class="mtk8">sendlineafter</span><span class="mtk1">(</span><span class="mtk7 mtki">b</span><span class="mtk4">'Pick a number: '</span><span class="mtk1">, </span><span class="mtk8 mtku">str</span><span class="mtk1">(</span><span class="mtk9 mtki">number</span><span class="mtk1">).</span><span class="mtk8">encode</span><span class="mtk1">())</span>  

<span class="mtk1">    </span><span class="mtk1">io</span><span class="mtk1">.</span><span class="mtk8">sendlineafter</span><span class="mtk1">(</span><span class="mtk7 mtki">b</span><span class="mtk4">'Bet: '</span><span class="mtk1">, </span><span class="mtk8 mtku">str</span><span class="mtk1">(</span><span class="mtk9 mtki">amount</span><span class="mtk1">).</span><span class="mtk8">encode</span><span class="mtk1">())</span>
<span class="mtk1">    </span><span class="mtk1">io</span><span class="mtk1">.</span><span class="mtk8">recvuntil</span><span class="mtk1">(</span><span class="mtk7 mtki">b</span><span class="mtk4">'The wheel stops at '</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">output</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">int</span><span class="mtk1">(</span><span class="mtk1">io</span><span class="mtk1">.</span><span class="mtk8">recvline</span><span class="mtk1">().</span><span class="mtk8">decode</span><span class="mtk1">())</span>
<span class="mtk1">    </span><span class="mtk1">data</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">io</span><span class="mtk1">.</span><span class="mtk8">recvline</span><span class="mtk1">()</span>

<span class="mtk1">    </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk7 mtki">b</span><span class="mtk4">'You have '</span><span class="mtk1"> </span><span class="mtk5">not</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk1">data</span><span class="mtk1">:</span>
<span class="mtk1">        </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk1">output</span><span class="mtk1">, </span><span class="mtk1">target</span>

<span class="mtk1">    </span><span class="mtk1">coins</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">int</span><span class="mtk1">(</span><span class="mtk1">data</span><span class="mtk1">.</span><span class="mtk8">decode</span><span class="mtk1">().</span><span class="mtk8">split</span><span class="mtk1">(</span><span class="mtk4">' '</span><span class="mtk1">)[</span><span class="mtk6">2</span><span class="mtk1">])</span>
<span class="mtk1">    </span><span class="mtk5">return</span><span class="mtk1"> </span><span class="mtk1">output</span><span class="mtk1">, </span><span class="mtk1">coins</span>
</code></pre></div><p>Ahora necesitamos obtener al menos 4096 ecuaciones para resolver el sistema de 4096 variables binarias del estado del PRNG. Hay que tener en cuenta que en cada ronda obtenemos 5 bits y podemos modelar 5 ecuaciones. Por lo tanto, necesitaremos un mínimo de $\lceil 4096/5 \rceil = 820$ rondas para obtener suficientes ecuaciones:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">    </span><span class="mtk1">outputs</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> []</span>
<span class="mtk1">    </span><span class="mtk1">equations</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> []</span>
<span class="mtk1">    </span><span class="mtk1">u_values</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> []</span>

<span class="mtk1">    </span><span class="mtk1">round_prog</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">io</span><span class="mtk1">.</span><span class="mtk8">progress</span><span class="mtk1">(</span><span class="mtk4">'Round'</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">coins_prog</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">io</span><span class="mtk1">.</span><span class="mtk8">progress</span><span class="mtk1">(</span><span class="mtk4">'Coins'</span><span class="mtk1">)</span>

<span class="mtk1">    </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">r</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8 mtku">range</span><span class="mtk1">(</span><span class="mtk1">rounds</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk1">round_prog</span><span class="mtk1">.</span><span class="mtk8">status</span><span class="mtk1">(</span><span class="mtk7 mtki">f</span><span class="mtk4">'</span><span class="mtk6">{</span><span class="mtk1">r</span><span class="mtk1"> </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk6">1}</span><span class="mtk4"> / </span><span class="mtk6">{</span><span class="mtk1">rounds</span><span class="mtk6">}</span><span class="mtk4">'</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk1">coins_prog</span><span class="mtk1">.</span><span class="mtk8">status</span><span class="mtk1">(</span><span class="mtk7 mtki">f</span><span class="mtk4">'</span><span class="mtk6">{</span><span class="mtk1">coins</span><span class="mtk6">}</span><span class="mtk4">'</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk1">y</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">var_twister</span><span class="mtk1">.</span><span class="mtk8">rand</span><span class="mtk1">()</span>

<span class="mtk1">        </span><span class="mtk5">try</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk1">output</span><span class="mtk1">, </span><span class="mtk1">coins</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">bet</span><span class="mtk1">()</span>
<span class="mtk1">        </span><span class="mtk5">except</span><span class="mtk1"> </span><span class="mtk8 mtku">EOFError</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk1">coins_prog</span><span class="mtk1">.</span><span class="mtk8">failure</span><span class="mtk1">(</span><span class="mtk4">'0'</span><span class="mtk1">)</span>
<span class="mtk1">            </span><span class="mtk1">io</span><span class="mtk1">.</span><span class="mtk8">warning</span><span class="mtk1">(</span><span class="mtk4">'Try better luck next time'</span><span class="mtk1">)</span>  
<span class="mtk1">            </span><span class="mtk8">exit</span><span class="mtk1">()</span>

<span class="mtk1">        </span><span class="mtk1">outputs</span><span class="mtk1">.</span><span class="mtk8">append</span><span class="mtk1">(</span><span class="mtk1">output</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk1">u</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">bits</span><span class="mtk1">(</span><span class="mtk1">output</span><span class="mtk1">)</span>

<span class="mtk1">        </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">i</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8 mtku">range</span><span class="mtk1">(</span><span class="mtk6">5</span><span class="mtk1">):</span>
<span class="mtk1">            </span><span class="mtk1">equations</span><span class="mtk1">.</span><span class="mtk8">append</span><span class="mtk1">(</span><span class="mtk1">y</span><span class="mtk1">[</span><span class="mtk1">i</span><span class="mtk1">])</span>
<span class="mtk1">            </span><span class="mtk1">u_values</span><span class="mtk1">.</span><span class="mtk8">append</span><span class="mtk1">(</span><span class="mtk1">u</span><span class="mtk1">[</span><span class="mtk1">i</span><span class="mtk1">])</span>

<span class="mtk1">    </span><span class="mtk1">round_prog</span><span class="mtk1">.</span><span class="mtk8">success</span><span class="mtk1">(</span><span class="mtk7 mtki">f</span><span class="mtk4">'</span><span class="mtk6">{</span><span class="mtk1">rounds</span><span class="mtk6">}</span><span class="mtk4"> / </span><span class="mtk6">{</span><span class="mtk1">rounds</span><span class="mtk6">}</span><span class="mtk4">'</span><span class="mtk1">)</span>
</code></pre></div><p>Como se puede ver, solo estamos usando <code>var_twister.rand</code> al mismo tiempo que obtenemos una nueva salida del PRNG. Luego, agregamos la ecuación resultante a la lista <code>equations</code> y los valores de $u_i$ en <code>u_values</code>.</p><p>Nótese que estamos usando <code>bet()</code>, que por defecto apuesta por un número impar y solo 1 moneda. Necesitamos considerar el caso en el que nos quedamos sin dinero antes de completar todas las rondas (el bloque <code>try</code>-<code>except</code>).</p><p>Una vez que tenemos todos los valores necesarios, podemos usar algunas funciones de SageMath para convertir todas las ecuaciones a una matriz de coeficientes $A$ en $\mathbb{F}_2$ y resolver una ecuación matricial para todos los bits $u_i$ recogidos en <code>u_values</code>:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">    </span><span class="mtk1">io</span><span class="mtk1">.</span><span class="mtk8">info</span><span class="mtk1">(</span><span class="mtk4">'Solving matrix equation'</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">A</span><span class="mtk1">, </span><span class="mtk1">_</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> Sequence(</span><span class="mtk1">equations</span><span class="mtk1">).coefficient_matrix(</span><span class="mtk9 mtki">sparse</span><span class="mtk5">=</span><span class="mtk6">False</span><span class="mtk1">)</span>  
<span class="mtk1">    </span><span class="mtk1">S</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">A</span><span class="mtk1">.solve_right(vector(</span><span class="mtk1">F</span><span class="mtk1">, </span><span class="mtk1">u_values</span><span class="mtk1">))</span>

<span class="mtk1">    </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk1">A</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1"> </span><span class="mtk1">S</span><span class="mtk1"> </span><span class="mtk5">!=</span><span class="mtk1"> vector(</span><span class="mtk1">F</span><span class="mtk1">, </span><span class="mtk1">u_values</span><span class="mtk1">):</span>
<span class="mtk1">        </span><span class="mtk1">io</span><span class="mtk1">.</span><span class="mtk8">failure</span><span class="mtk1">(</span><span class="mtk4">'Failed to solve matrix equation'</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk8">exit</span><span class="mtk1">()</span>
</code></pre></div><p>Una vez aquí, y habiendo verificado que la matriz de coeficientes $A$ por los bits de estado $S$ dan como resultado el vector <code>u_values</code>, podemos transformar los 4096 bits en 128 valores de 32 bits para inicializar un objeto <code>Twister</code>:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">    </span><span class="mtk1">state</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> [</span><span class="mtk8">sum</span><span class="mtk1">(</span><span class="mtk8 mtku">int</span><span class="mtk1">(</span><span class="mtk1">y_i</span><span class="mtk1">) </span><span class="mtk5">*</span><span class="mtk1"> </span><span class="mtk6">2</span><span class="mtk1"> </span><span class="mtk5">**</span><span class="mtk1"> </span><span class="mtk1">i</span><span class="mtk1"> </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">i</span><span class="mtk1">, </span><span class="mtk1">y_i</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8 mtku">enumerate</span><span class="mtk1">(</span><span class="mtk1">S</span><span class="mtk1">[</span><span class="mtk1">k</span><span class="mtk1">:</span><span class="mtk1">k</span><span class="mtk1"> </span><span class="mtk5">+</span><span class="mtk1"> </span><span class="mtk1">b</span><span class="mtk1">])) </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">k</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk8 mtku">range</span><span class="mtk1">(</span><span class="mtk6">0</span><span class="mtk1">, </span><span class="mtk1">N</span><span class="mtk1"> </span><span class="mtk5">*</span><span class="mtk1"> </span><span class="mtk1">b</span><span class="mtk1">, </span><span class="mtk1">b</span><span class="mtk1">)]</span>  
<span class="mtk1">    </span><span class="mtk1">io</span><span class="mtk1">.</span><span class="mtk8">info</span><span class="mtk1">(</span><span class="mtk4">'Got possible state bits'</span><span class="mtk1">)</span>

<span class="mtk1">    </span><span class="mtk1">twister</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8 mtku">Twister</span><span class="mtk1">(</span><span class="mtk1">state</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">twister</span><span class="mtk1">.</span><span class="mtk1">index</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">0</span>
</code></pre></div><p>En este punto, el PRNG debe inicializarse en la primera semilla (después de primer <code>twist</code>, de ahí que forcemos que <code>twister.index = 0</code>). Luego, necesitamos calcular tantas salidas como hayamos recolectado, y afirmar que coinciden:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">    </span><span class="mtk5">for</span><span class="mtk1"> </span><span class="mtk1">output</span><span class="mtk1"> </span><span class="mtk5">in</span><span class="mtk1"> </span><span class="mtk1">outputs</span><span class="mtk1">:</span>
<span class="mtk1">        </span><span class="mtk1">guess</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">twister</span><span class="mtk1">.</span><span class="mtk8">rand</span><span class="mtk1">() </span><span class="mtk5">%</span><span class="mtk1"> </span><span class="mtk6">32</span>

<span class="mtk1">        </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk1">output</span><span class="mtk1"> </span><span class="mtk5">!=</span><span class="mtk1"> </span><span class="mtk1">guess</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk1">io</span><span class="mtk1">.</span><span class="mtk8">failure</span><span class="mtk1">(</span><span class="mtk4">'Some known guessed output is wrong'</span><span class="mtk1">)</span>  
<span class="mtk1">            </span><span class="mtk8">exit</span><span class="mtk1">()</span>

<span class="mtk1">    </span><span class="mtk1">io</span><span class="mtk1">.</span><span class="mtk8">success</span><span class="mtk1">(</span><span class="mtk4">'Verified all state bits'</span><span class="mtk1">)</span>
</code></pre></div><p>Con esto, hemos verificado que el estado del PRNG es adecuado para generar todas las salidas recolectadas. Además, dado que hemos usado más de 4096 ecuaciones, es probable que la solución que tenemos sea única, lo que significa que tenemos el estado exacto del PRNG. Esto también significa que las salidas futuras coincidirán con el PRNG del servidor, y podremos ganar el juego en unas pocas rondas:</p><div class="highlight"><pre tabindex="0" style="color:#fff;background-color:#1d1e19;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="mtk1">    </span><span class="mtk1">r</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk6">0</span>

<span class="mtk1">    </span><span class="mtk5">while</span><span class="mtk1"> </span><span class="mtk1">coins</span><span class="mtk1"> </span><span class="mtk5">&lt;</span><span class="mtk1"> </span><span class="mtk1">target</span><span class="mtk1">:</span>
<span class="mtk1">        </span><span class="mtk1">guess</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk1">twister</span><span class="mtk1">.</span><span class="mtk8">rand</span><span class="mtk1">() </span><span class="mtk5">%</span><span class="mtk1"> </span><span class="mtk6">32</span>
<span class="mtk1">        </span><span class="mtk1">output</span><span class="mtk1">, </span><span class="mtk1">coins</span><span class="mtk1"> </span><span class="mtk5">=</span><span class="mtk1"> </span><span class="mtk8">bet</span><span class="mtk1">(</span><span class="mtk9 mtki">option</span><span class="mtk5">=</span><span class="mtk1">NUMBER</span><span class="mtk1">, </span><span class="mtk9 mtki">amount</span><span class="mtk5">=</span><span class="mtk1">coins</span><span class="mtk1">, </span><span class="mtk9 mtki">number</span><span class="mtk5">=</span><span class="mtk1">guess</span><span class="mtk1">)</span>  

<span class="mtk1">        </span><span class="mtk5">if</span><span class="mtk1"> </span><span class="mtk1">output</span><span class="mtk1"> </span><span class="mtk5">!=</span><span class="mtk1"> </span><span class="mtk1">guess</span><span class="mtk1">:</span>
<span class="mtk1">            </span><span class="mtk1">io</span><span class="mtk1">.</span><span class="mtk8">failure</span><span class="mtk1">(</span><span class="mtk4">'Some unknown guessed output is wrong'</span><span class="mtk1">)</span>
<span class="mtk1">            </span><span class="mtk8">exit</span><span class="mtk1">()</span>

<span class="mtk1">        </span><span class="mtk1">coins_prog</span><span class="mtk1">.</span><span class="mtk8">status</span><span class="mtk1">(</span><span class="mtk7 mtki">f</span><span class="mtk4">'</span><span class="mtk6">{</span><span class="mtk1">coins</span><span class="mtk6">}</span><span class="mtk4">'</span><span class="mtk1">)</span>
<span class="mtk1">        </span><span class="mtk1">r</span><span class="mtk1"> </span><span class="mtk5">+=</span><span class="mtk1"> </span><span class="mtk6">1</span>

<span class="mtk1">    </span><span class="mtk1">coins_prog</span><span class="mtk1">.</span><span class="mtk8">success</span><span class="mtk1">(</span><span class="mtk7 mtki">f</span><span class="mtk4">'&gt;= </span><span class="mtk6">{</span><span class="mtk1">coins</span><span class="mtk6">}</span><span class="mtk4">'</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">io</span><span class="mtk1">.</span><span class="mtk8">success</span><span class="mtk1">(</span><span class="mtk7 mtki">f</span><span class="mtk4">'Winning rounds: </span><span class="mtk6">{</span><span class="mtk1">r</span><span class="mtk6">}</span><span class="mtk4">'</span><span class="mtk1">)</span>
<span class="mtk1">    </span><span class="mtk1">io</span><span class="mtk1">.</span><span class="mtk8">success</span><span class="mtk1">(</span><span class="mtk1">io</span><span class="mtk1">.</span><span class="mtk8">recvline</span><span class="mtk1">().</span><span class="mtk8">decode</span><span class="mtk1">())</span>
</code></pre></div><p>Con todo esto, podemos tratar de resolver el reto en local:</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">echo</span> <span class="code-dark-yellow">'HTB{f4k3_fl4g_f0r_t3st1ng}'</span> &gt; flag.txt

<span class="code-cyan">$</span> <span class="code-dark-green">python3</span> <span class="mtku">solve.py</span>
[<span class="code-green">+</span>] Starting local process '/usr/bin/python3': pid 817021
[<span class="code-green">+</span>] Round: 820 / 820
[<span class="code-green">+</span>] Coins: &gt;= 10000000000000
[<span class="code-blue">*</span>] Solving matrix equation
[<span class="code-blue">*</span>] Got possible state bits
[<span class="code-green">+</span>] Verified all state bits
[<span class="code-green">+</span>] Winning rounds: 12
[<span class="code-green">+</span>] Here's your reward: HTB{f4k3_fl4g_f0r_t3st1ng}
[<span class="code-blue">*</span>] Process '/usr/bin/python3' stopped with exit code 0 (pid 817021)  
</code></pre></div><p>¡Impresionante, hemos ganado! Y el tiempo no fue una restricción al final, ha tardado menos de 10 segundos.</p><h2 id="_flag_"><em>Flag</em></h2><p>Probemos de en la instancia remota (tarda alrededor de 3 minutos):</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000!important;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="no-highlight"><span class="code-cyan">$</span> <span class="code-dark-green">python3</span> <span class="mtku">solve.py</span> 143.110.169.131:32215
[<span class="code-green">+</span>] Opening connection to 143.110.169.131 on port 32215: Done
[<span class="code-green">+</span>] Round: 820 / 820
[<span class="code-green">+</span>] Coins: &gt;= 10000000000000
[<span class="code-blue">*</span>] Solving matrix equation
[<span class="code-blue">*</span>] Got possible state bits
[<span class="code-green">+</span>] Verified all state bits
[<span class="code-green">+</span>] Winning rounds: 11
[<span class="code-green">+</span>] Here's your reward: HTB{Y0u_c4n_n0w_br43k_m3rs3nn3_tw1st3r_!!!!}  
[<span class="code-blue">*</span>] Closed connection to 143.110.169.131 port 32215
</code></pre></div><p>El <em>script</em> completo se puede encontrar aquí: <a href="https://github.com/7Rocky/HackTheBox-scripts/tree/main/Challenges/Crypto/Roulette/solve.py"><code>solve.py</code></a>.</p><div class="mt6 instapaper_ignoref"></div></div><aside aria-label="aside" class="w-20-l aside-desktop"><div class="bg-card pa3 nested-list-reset nested-copy-line-height nested-links" style="position:sticky;top:5rem;padding-bottom:0"><p class="f5 b pb2" style="border-bottom:5px solid var(--background);margin:0">Contenidos</p><nav id="TableOfContents"><ul><li><a href="#configuración-del-entorno">Configuración del entorno</a></li><li><a href="#análisis-del-código-fuente">Análisis del código fuente</a></li><li><a href="#prng">PRNG</a><ul><li><a href="#generación-del-estado">Generación del estado</a></li><li><a href="#salidas-aleatorias">Salidas aleatorias</a></li><li><a href="#_twister_"><em>Twister</em></a></li><li><a href="#modelo-del-prng">Modelo del PRNG</a></li></ul></li><li><a href="#solución">Solución</a></li><li><a href="#_flag_"><em>Flag</em></a></li></ul></nav><div class="bg-card" style="border-top:5px solid var(--background)"><a class="bmc-btn w-100" target="_blank" href="http://buymeacoffee.com/7Rocky" style="padding:0" title="Buy me a beer">🍺 <span class="bmc-btn-text" style="font-family:Cookie!important;color:#fff">Buy me a beer</span></a></div></div></aside></article></main><footer class="bottom-0 w-100" role="contentinfo"><div class="tc mw8 ph3" style="margin:auto"><form style="background-color:var(--background-card)" class="tc mw8 pv3 mb3" action="https://tinyletter.com/7Rocky" method="post" target="popupwindow" onsubmit='return window.open("https://tinyletter.com/7Rocky","popupwindow","scrollbars=yes,width=800,height=600"),!0'><h3 class="tc">Recibe un resumen semanal del blog</h3><p class="tc"><label for="tlemail"></label></p><p class="tc"><input type="text" class="w-80 f5 pv3 ph3 bg-light-gray bn search" placeholder="Introduce tu correo electrónico" name="email" id="tlemail">
<input class="f5 pv3 ph3 bn" style="background-color:var(--background);color:inherit;font-weight:700;line-height:normal" type="submit" value="Submit"></p><input type="hidden" value="1" name="embed">
<input style="display:none;color:var(--header)" type="submit" value="Suscribirse"><p class="tc">impulsado por <a href="https://tinyletter.com" target="_blank" title="TinyLetter">TinyLetter</a></p><p class="tc"><a href="/en/newsletters/" target="_blank" title="View letter archive">Ver historial de resúmenes</a></p></form></div><div class="bg-black w-100 pa3" role="contentinfo"><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://7rocky.github.io/" title="https://7rocky.github.io/">&copy; Blog de 7Rocky. Ciberseguridad y Mates 2023</a><div style="margin-top:8px"><div><div><a href="https://www.linkedin.com/in/roberto-gesteira-minarro/" target="_blank" class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel="noopener" aria-label="follow on LinkedIn——Opens in a new window"><svg height="30" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg><span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a><a href="https://github.com/7Rocky" target="_blank" class="link-transition github link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel="noopener" aria-label="follow on GitHub——Opens in a new window"><svg height="30" style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg><span class="new-window"><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" width="8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg></span></a></div></div></div></div></div></footer></body></html>